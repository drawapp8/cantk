function browser(){}browser.init=function(){var t=navigator.userAgent,e=navigator.appVersion;browser={};browser.ie9=t.indexOf("MSIE 9.0")>=0;browser.ie10=t.indexOf("MSIE 10.0")>=0;browser.ie=t.indexOf("MSIE")>=0||t.indexOf("Trident")>=0;browser.oldIE=t.indexOf("MSIE 8.0")>=0||t.indexOf("MSIE 7.0")>=0||t.indexOf("MSIE 6.0")>=0;browser.android=t.indexOf("Android")>=0&&t.indexOf("Linux")>=0;browser.iPhone=t.indexOf("iPhone")>=0;browser.iPad=t.indexOf("iPad")>=0;browser.blackberry=t.indexOf("BlackBerry")>=0;browser.firefoxMobile=t.indexOf("Mobile")>=0&&t.indexOf("Firefox")>=0;browser.firefoxOS=t.indexOf("Mobile")>=0&&t.indexOf("Firefox")>=0&&t.indexOf("Android")<0;browser.windowPhone=t.indexOf("Windows Phone")>=0;browser.webkit=t.indexOf("WebKit")>=0;browser.weixin=t.indexOf("MicroMessenger")>=0;browser.weibo=t.indexOf("weibo")>=0;browser.qq=t.indexOf("QQ")>=0;if(browser.iPhone){var i=t.match(/iPhone; CPU iPhone OS \d+/g);if(i&&i.length){browser.iOSVersion=parseInt(i[0].match(/\d+/g)[0])}}function n(){var t=navigator.userAgent;var e=["AppleWebKit/","AppleWebKit ","AppleWebKit","MSIE ","Firefox/","Safari/","Opera ","Opera/"];for(var i=0;i<e.length;i++){var n=e[i];var r=t.indexOf(n);if(r>=0){var a=t.substr(r+n.length);var o=parseFloat(a);return o}}return 1}browser.number=n();browser.isAudioSupportLoop=true;if(browser.isIPhone&&browser.iOSVersion<6){browser.isAudioSupportLoop=false}if(browser.oldIE||browser.ie9){window.console={};window.console.log=function(t){}}browser.isMobile=browser.android||browser.iPhone||browser.blackberry||browser.windowPhone||browser.firefoxMobile;if(browser.isMobile){window.console.logStr="";window.console.logR=window.console.log;window.console.getLog=function(){return window.console.logStr};window.console.log=function(t){window.console.logStr+=t+"\n";window.console.logR(t);return}}console.log(navigator.userAgent);window.isSpecialBrowser=browser.qq||browser.weibo||browser.weixin;return};function isQQ(){return browser.qq}function isWeiBo(){return browser.weibo}function isWeiXin(){return browser.weixin}function isWebkit(){return browser.webkit}function isOldIE(){return browser.oldIE}function isIE(){return browser.ie}if(browser.oldIE){console.log("oldIE "+browser.oldIE)}function isMobile(){return browser.isMobile}function isAndroid(){return browser.android}function isIPhone(){return browser.iPhone}function isIPad(){return browser.ipad}function isWinPhone(){return browser.windowPhone}function isBlackBerry(){return browser.blackberry}function isFirefoxMobile(){return browser.firefoxMobile}function isFirefoxOS(){return browser.firefoxOS}function isPhoneGap(){return(window.cordova||window.Cordova||window.PhoneGap||window.phonegap)&&/^file:\/{3}[^\/]/i.test(window.location.href)&&/ios|iphone|ipod|ipad|android/i.test(navigator.userAgent)}function isTizen(){return window.tizen}function browserVersion(){return browser.number}browser.init();function CantkRT(){}CantkRT.isNative=function(){return!!CantkRT.rt};CantkRT.init=function(t){function e(){try{CantkRT.rt=cordova.require("com.tangide.cantk.CantkRuntime")}catch(e){console.log("com.tangide.cantk.CantkRuntime not found.")}if(CantkRT.rt){CantkRT.rt.init();CantkRT.setShowFPS(true)}t()}if(window.cordova){document.addEventListener("deviceready",e,false)}else{window.addEventListener("load",t,false)}return};CantkRT.getViewPort=function(){var t;var e;if(CantkRT.rt){return CantkRT.rt.getViewPort()}else{if(typeof window.innerWidth!="undefined"){t=window.innerWidth;e=window.innerHeight}else if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){t=document.documentElement.clientWidth;e=document.documentElement.clientHeight}else{t=document.getElementsByTagName("body")[0].clientWidth;e=document.getElementsByTagName("body")[0].clientHeight}}return{width:t,height:e}};CantkRT.getMainCanvas=function(){var t=null;if(CantkRT.canvas){return CantkRT.canvas}if(CantkRT.rt){t=CantkRT.rt.createCanvas();console.log("CantkRT.rt.createCanvas")}else{t=document.createElement("canvas");t.id="main-canvas";t.style.zIndex=0;document.body.appendChild(t);t.flush=function(){}}CantkRT.canvas=t;return t};CantkRT.isResSupportCrossOrgin=function(t){return t&&(t.indexOf("upaiyun.com")>0||t.indexOf("bcs.duapp.com")>0)};CantkRT.createImage=function(t,e,i){var n=null;if(CantkRT.rt){n=CantkRT.rt.createImage(t,e,i)}else{n=new Image;n.onload=function(){if(e){e(n)}};n.onerror=function(t){if(t){console.log(this.src+" load error: "+t.message)}else{console.log(this.src+" load error")}if(n.crossOrigin){var e=n.src;n.crossOrigin=null;n.src=null;n.src=e;console.log("try without image.crossOrigin:"+e);return}if(i){i(n)}};if(CantkRT.isResSupportCrossOrgin(t)){n.crossOrigin="Anonymous"}n.src=t}return n};CantkRT.createImageFromCanvas=function(t,e,i){if(!t){if(i){i()}return null}if(CantkRT.rt){return CantkRT.rt.createImage(t.toDataURL(),e,i)}else{if(e){e(t)}return t}};CantkRT.setShowFPS=function(t){console.log("CantkRT.setShowFPS");if(CantkRT.rt){return CantkRT.rt.setShowFPS(t)}else{return}};CantkRT.createSoundEffect=function(t,e,i){if(CantkRT.rt){return CantkRT.rt.createSoundEffect(t,e,i)}return null};CantkRT.createSoundMusic=function(t,e,i){if(CantkRT.rt){return CantkRT.rt.createSoundMusic(t,e,i)}return null};CantkRT.createSingleLineTextEditor=function(){if(CantkRT.rt){return CantkRT.rt.createSingleLineTextEditor()}return null};CantkRT.createMultiLineTextEditor=function(){if(CantkRT.rt){return CantkRT.rt.createMultiLineTextEditor()}return null};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;CantkRT.requestAnimFrame=function(t){return window.requestAnimationFrame(t)};Object.defineProperty(Array.prototype,"remove",{enumerable:false,value:function(t,e){for(var i=0;i<this.length;++i){if(this[i]===t){this.splice(i,1);if(!e)break}}return this}});Object.defineProperty(Array.prototype,"insert",{enumerable:false,value:function(t,e){if(t>=0&&t<this.length){this.splice(t,0,e)}else{this.push(e)}return this}});Object.defineProperty(Array.prototype,"indexOf",{enumerable:false,value:function(t){var e=this.length;for(var i=0;i<e;++i){if(this[i]===t){return i}}return-1}});Object.defineProperty(Array.prototype,"find",{enumerable:false,value:function(t){var e=this.length;for(var i=0;i<e;++i){var n=this[i];if(t(n)){return n}}return null}});Object.defineProperty(Array.prototype,"binarySearch",{enumerable:false,value:function(t,e){var i=0;var n=0;var r=0;var a=this.length-1;while(n<=a){i=n+a>>1;r=e(this[i],t);if(r<0){n=i+1;continue}if(r>0){a=i-1;continue}return i}return-1}});Object.defineProperty(Array.prototype,"has",{enumerable:false,value:function(t){return this.indexOf(t)>=0}});Object.defineProperty(Array.prototype,"destroyData",{enumerable:false,value:function(){for(var t=0;t<this.length;t++){var e=this[t];if(!e||typeof e!="object"){continue}if(e.destroy&&typeof e.destroy=="function"){e.destroy()}}this.length=0;return this}});Object.defineProperty(Array.prototype,"clear",{enumerable:false,value:function(t){if(t){this.destroyData()}this.length=0;return this}});Object.defineProperty(Array.prototype,"copy",{enumerable:false,value:function(t){this.clear();for(var e=0;e<t.length;++e){var i=t[e];if(i&&i.dup){i=i.dup()}this.push(i)}return this}});function makeUniqRandArray(t,e){if(t>=e){return null}var i=[];var n=e-t+1;for(var r=0;r<n;r++){do{var a=t+Math.floor(Math.random()*n);if(!i.has(a)){i.push(a);break}}while(1)}return i}function fixRect(t){if(t.w<0){t.x=t.x+t.w;t.w=-t.w}if(t.h<0){t.y=t.y+t.h;t.h=-t.h}return t}function isPointInRect(t,e){return t.x>=e.x&&t.y>=e.y&&t.x<e.x+e.w&&t.y<e.y+e.h}function cantkAddEventListener(t,e){if(window.attachEvent){window.attachEvent(t,e)}else if(window.addEventListener){window.addEventListener(t,e)}else{document.addEventListener(t,e,true)}return}String.prototype.replaceAll=function(t,e,i){if(!RegExp.prototype.isPrototypeOf(t)){return this.replace(new RegExp(t,i?"gi":"g"),e)}else{return this.replace(t,e)}};function fixJson(t){var e=0;var i="";t=t.replaceAll("<br>","");var n=t.length;for(e=0;e<n;e++){var r=t.charAt(e);if(r==="“"||r==="”"){r='"'}i=i+r}return i}String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$|^\n+|\n+$/g,"")};String.prototype.startWith=function(t){var e=this;return e.indexOf(t)==0};String.prototype.endWith=function(t){var e=this;return e.substring(e.length-t.length,e.length)==t};String.prototype.isImageFileName=function(){var t=this.toLowerCase();return t.endWith(".png")||t.endWith(".jpg")||t.endWith("jpeg")};function drawDashedRect(t,e,i,n,r){var a=8;var o=4;t.beginPath();drawDashedLine(t,{x:e,y:i},{x:n+e,y:i},a,o);drawDashedLine(t,{x:e,y:r+i},{x:n+e,y:r+i},a,o);drawDashedLine(t,{x:e,y:i},{x:e,y:r+i},a,o);drawDashedLine(t,{x:n+e,y:i},{x:n+e,y:r+i},a,o);return}function drawDashedLine(t,e,i,n,r){if(!t||!e||!i||!n)return;var a=e.x;var o=e.y;t.moveTo(a,o);if(!r){t.lineTo(i.x,i.y);return}var s=i.x-e.x;var h=i.y-e.y;var l=Math.sqrt(s*s+h*h);var u=Math.atan(h/s);t.save();t.translate(e.x,e.y);t.rotate(u);if(i.x<e.x){t.translate(-l,0)}t.moveTo(0,0);a=0;while(a<l){a+=n;if(a>l){a=l}t.lineTo(a,0);if(a==l){break}a+=r;if(a>l){a=l}t.moveTo(a,0)}t.restore();return}var C_ARROW_NONE=0;var C_ARROW_NORMAL=1;var C_ARROW_CIRCLE=2;var C_ARROW_RECT=3;var C_ARROW_DIAMOND=4;var C_ARROW_TRI=5;var C_ARROW_FILL_CIRCLE=1<<8|C_ARROW_CIRCLE;var C_ARROW_FILL_RECT=1<<8|C_ARROW_RECT;var C_ARROW_FILL_DIAMOND=1<<8|C_ARROW_DIAMOND;var C_ARROW_FILL_TRI=1<<8|C_ARROW_TRI;function drawArrowHeaderNormal(t,e){t.translate(-e/2,0);t.moveTo(-e/2,-e/2);t.lineTo(e/2,0);t.lineTo(-e/2,e/2);t.stroke();t.beginPath();return}function drawArrowHeaderTri(t,e){t.translate(-e/2,0);t.moveTo(e/2,0);t.lineTo(-e/2,-e/2);t.lineTo(-e/2,e/2);t.lineTo(e/2,0);return}function drawArrowHeaderCircle(t,e){t.translate(-e/2,0);t.arc(0,0,e/2,Math.PI*2,0);return}function drawArrowHeaderRect(t,e){t.translate(-e/2,0);t.rect(-e/2,-e/2,e,e);return}function drawArrowHeaderRRect(t,e){t.translate(-e/2,0);t.rotate(Math.PI/4);t.rect(-e/2,-e/2,e,e);return}var arrow_draw_header=[null,drawArrowHeaderNormal,drawArrowHeaderCircle,drawArrowHeaderRect,drawArrowHeaderRRect,drawArrowHeaderTri];function drawArrow(t,e,i,n,r){var a=10;if(!t||!i||!n)return;var o=e>>8;e=e&255;if(e<=0||e>=arrow_draw_header.length){return}if(r){a=r}var s=(n.y-i.y)/(n.x-i.x);var h=Math.atan(s);if(n.x<i.x){h=h+Math.PI}var l=t.fillStyle;var u=t.strokeStyle;t.save();t.translate(n.x,n.y);t.rotate(h);t.beginPath();a=a+t.lineWidth-1;arrow_draw_header[e](t,a);t.closePath();if(o){t.fillStyle=u}else{t.fillStyle="White"}if(e>1){t.fill()}t.stroke();t.restore();t.fillStyle=l;t.strokeStyle=u;return}var gCacheCanvas=null;function CacheCanvasGet(t,e){if(!gCacheCanvas){gCacheCanvas=document.createElement("canvas");gCacheCanvas.type="backend_canvas";gCacheCanvas.width=t;gCacheCanvas.height=e}if(gCacheCanvas){if(gCacheCanvas.width<t){gCacheCanvas.width=t}if(gCacheCanvas.height<e){gCacheCanvas.height=e}}return gCacheCanvas}if(isWebkit()){drawNinePatchEx=function(t,e,i,n,r,a,o,s,h,l){var u=0;var c=0;var p=0;var f=0;var m=0;var d=0;var g=0;var y=0;if(!e){t.fillRect(o,s,h,l);return}if(!r||r>e.width){r=e.width}if(!a||a>e.height){a=e.height}if(h<r&&l<a){t.drawImage(e,i,n,r,a,o,s,h,l);return}p=Math.floor(r/3);f=Math.floor(a/3);m=r-p-p;d=a-f-f;g=h-p-p;y=l-f-f;t.drawImage(e,i,n,p,f,o,s,p,f);t.drawImage(e,i+r-p,n,p,f,o+h-p,s,p,f);t.drawImage(e,i,n+a-f,p,f,o,s+l-f,p,f);t.drawImage(e,i+r-p,n+a-f,p,f,o+h-p,s+l-f,p,f);if(g>0){t.drawImage(e,i+p,n,m,f,o+p,s,g,f);t.drawImage(e,i+p,n+a-f,m,f,o+p,s+l-f,g,f)}if(y>0){t.drawImage(e,i,n+f,p,d,o,s+f,p,y);t.drawImage(e,i+r-p,n+f,p,d,o+h-p,s+f,p,y)}if(g>0&&y>0){t.drawImage(e,i+p,n+f,m,d,o+p,s+f,g,y)}return}}else{drawNinePatchEx=function(t,e,i,n,r,a,o,s,h,l){var u=0;var c=0;var p=0;var f=0;var m=0;var d=0;var g=0;var y=0;if(!e){t.fillRect(o,s,h,l);return}if(!r||r>e.width){r=e.width}if(!a||a>e.height){a=e.height}if(h<r&&l<a){t.drawImage(e,i,n,r,a,o,s,h,l);return}p=Math.floor(r/3);f=Math.floor(a/3);m=r-p-p;d=a-f-f;g=h-p-p;y=l-f-f;t.drawImage(e,i,n,p,f,o,s,p,f);t.drawImage(e,i+r-p,n,p,f,o+h-p,s,p,f);t.drawImage(e,i,n+a-f,p,f,o,s+l-f,p,f);t.drawImage(e,i+r-p,n+a-f,p,f,o+h-p,s+l-f,p,f);if(g>0){t.drawImage(e,i+p,n,m,f,o+p-1,s,g+2,f);t.drawImage(e,i+p,n+a-f,m,f,o+p-1,s+l-f,g+2,f)}if(y>0){t.drawImage(e,i,n+f,p,d,o,s+f-.5,p,y+1);t.drawImage(e,i+r-p,n+f,p,d,o+h-p,s+f-.5,p,y+1)}if(g>0&&y>0){t.drawImage(e,i+p,n+f,m,d,o+p-1,s+f-1,g+2,y+2)}return}}function drawNinePatch(t,e,i,n,r,a){if(!e){t.fillRect(i,n,r,a);return}return drawNinePatchEx(t,e,0,0,e.width,e.height,i,n,r,a)}function drawNinePatchIcon(t,e,i,n,r,a){var o=e.getImage();var s=e.getX();var h=e.getY();var l=e.getWidth();var u=e.getHeight();if(!o){t.fillRect(i,n,r,a);return}return drawNinePatchEx(t,o,s,h,l,u,i,n,r,a)}function RoundRect(){}RoundRect.TL=1;RoundRect.TR=2;RoundRect.BL=4;RoundRect.BR=8;function drawRoundRect(t,e,i,n,r){var a=e>>1;var o=i>>1;if(e<0||i<0){return}if(!r){r=RoundRect.TL|RoundRect.TR|RoundRect.BL|RoundRect.BR}if((n>=a||n>=o)&&r===(RoundRect.TL|RoundRect.TR|RoundRect.BL|RoundRect.BR)){t.arc(a,o,Math.min(o,a),0,Math.PI*2);return}if(n){if(r&RoundRect.TL){t.arc(n,n,n,Math.PI,1.5*Math.PI,false)}else{t.moveTo(0,0)}if(r&RoundRect.TR){t.lineTo(e-n,0);t.arc(e-n,n,n,1.5*Math.PI,2*Math.PI,false)}else{t.lineTo(e,0)}if(r&RoundRect.BR){t.lineTo(e,i-n);t.arc(e-n,i-n,n,0,.5*Math.PI,false)}else{t.lineTo(e,i)}if(r&RoundRect.BL){t.lineTo(n,i);t.arc(n,i-n,n,.5*Math.PI,Math.PI,false)}else{t.lineTo(0,i)}if(r&RoundRect.TL){t.lineTo(0,n)}else{t.lineTo(0,0)}}else{t.rect(0,0,e,i)}return}function cantkGetViewPort(){return CantkRT.getViewPort()}if(!window.orgViewPort){window.orgViewPort=cantkGetViewPort()}function layoutText(t,e,i,n,r){if(n<=0||!i){return[]}var a=0;var o=0;var s=0;var h=0;var l="";var u=[];var c=i.split("\n");var p=new TextLayout(t);for(a=0;a<c.length;a++){var f=c[a];if(f){p.setText(f);while(p.hasNext()){var m=p.nextLine(n,e,r);u.push(m.text)}}else{u.push(" ")}}return u}function codeIsLetter(t){return t>=97&&t<=122||t>=65&&t<=90}function TextLayout(t){this.canvas=t;this.setText=function(t){this.str=t;this.startOffset=0;this.lineInfo={text:"",width:0};return};this.canBreakBefore=function(t){if(t===" "||t==="	"||t==="."||t==="]"||t===")"||t==="}"||t===","||t==="?"||t===";"||t===":"||t==="!"||t==='"'||t==="'"||t==="。"||t==="？"||t==="、"||t==="”"||t==="’"||t==="】"||t==="》"||t==="〉"||t==="〕"||t==="）"||t==="："||t==="；"||t==="，"){return false}return true};this.hasNext=function(){return this.startOffset<this.str.length};this.nextLine=function(e,i,n){var r=false;var a="";var o=this.str;var s=this.startOffset;var h=o.length;var l=Math.floor(e/i*.75);var u=h-this.startOffset;if(u<1){this.lineInfo.text="";this.lineInfo.width=0;return null}if(u<l){a=o.substr(this.startOffset,u);this.lineInfo.text=a;this.lineInfo.width=t.measureText(a).width;this.startOffset=this.startOffset+a.length;return this.lineInfo}if(l>3){l=l-3}a=o.substr(this.startOffset,l);var c=0;var p=null;var f=0;var m=null;var d=t.measureText(a).width;var n=n?n:Math.floor(e*.3);var g=2*i;var y=e+n;var v=e-g;for(s=this.startOffset+l;s<h;s++){p=o.charAt(s);c=o.charCodeAt(s);if(p==="	"){p=" "}a+=p;f=t.measureText(p).width;d=d+1+f;if(p=="'"){continue}if(d>y){break}if(d<v){continue}if(codeIsLetter(c)){continue}if(c==32){if(d>=e){break}var _=0;for(var I=s+1;I<h;I++){c=o.charCodeAt(I);if(codeIsLetter(c)){_++}else{break}}if(_>7){break}else{continue}}if(s+1<h){m=o.charAt(s+1);if(d>=e&&this.canBreakBefore(m)){break}}}this.lineInfo.text=a;this.lineInfo.width=t.measureText(a).width;this.startOffset=this.startOffset+a.length;return this.lineInfo};return this}function getXMLHttpRequest(){if(typeof window==="undefined"){throw new Error("no window object present")}else if(window.XMLHttpRequest){return window.XMLHttpRequest}else if(window.ActiveXObject){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var e=0;e<t.length;e++){try{var i=new window.ActiveXObject(t[e]);return function(){if(i){var n=i;i=null;return n}else{return new window.ActiveXObject(t[e])}}}catch(n){}}throw new Error("ajax not supported in this browser")}else{throw new Error("ajax not supported in this browser")}}function createXMLHttpRequest(){if(!window.XMLHttpRequest){window.XMLHttpRequest=getXMLHttpRequest()}return new XMLHttpRequest}function httpDownloadFile(t,e,i){var n={};n.url=t;n.method="GET";n.responseType="blob";n.autoProxy=i;n.onDone=function(i,n,r){saveAs(r,t.basename());if(e){e(i,n,r)}};httpDoRequest(n);return}function httpDoRequest(t){var e=createXMLHttpRequest();if(!t||!t.url){return false}var i=t.url;var n=t.data;var r=t.method?t.method:"GET";var a=i.indexOf("http")===0&&i.indexOf(window.location.hostname)<0;if(a){if(t.autoProxy){i="/proxy.php?url="+window.btoa(encodeURIComponent(i));console.log("use proxy:"+i)}else{e.crossOrigin="Anonymous";if(t.withCredentials){e.withCredentials=true;console.log("cross domain info.withCredentials=true")}}}if(t.responseType){e.responseType=t.responseType}if(t.dataType){e.dataType=t.dataType}e.open(r,i,true);if(t.noCache){e.setRequestHeader("If-Modified-Since","0")}if(t.headers){for(var o in t.headers){var s=t.headers[o];e.setRequestHeader(o,s)}}if(e){if(!e.onprogress){e.onreadystatechange=function(){if(t.onProgress){t.onProgress(e)}if(e.readyState===4){if(t.onDone){if(t.responseType&&t.responseType.toLowerCase()==="blob"){t.onDone(true,e,e.response)}else{t.onDone(true,e,e.responseText)}}}return}}else{e.onprogress=function(i){var n=i.total;if(t.onProgress){t.onProgress(e)}console.log("get:"+n)};e.onload=function(i){if(t.onDone){t.onDone(true,e,i.target.responseText)}};e.onerror=function(i){if(t.onDone){t.onDone(false,e,e.responseText)}}}e.send(t.data?t.data:null)}return true}function httpGetURL(t,e,i,n){var r={};r.url=t;r.onDone=e;r.autoProxy=i;r.withCredentials=n;httpDoRequest(r);return}function httpPostURL(t,e,i,n,r){var a={};a.url=t;a.onDone=i;a.method="POST";a.data=e;a.autoProxy=n;a.withCredentials=r;httpDoRequest(a);return}function httpGetJSON(t,e,i,n){httpGetURL(t,function(i,n,r){var a=null;if(i){try{a=JSON.parse(r)}catch(o){console.log("JSON.parse failed： url="+t+" data:"+r)}}e(a)},i,n);return}function cantkRestoreViewPort(){cantkInitViewPort(1);return}function cantkSetViewPortWidth(t){var e="";var i=document.getElementsByTagName("head")[0];var n=document.querySelector("meta[name=viewport]");if(!n){n=document.createElement("meta");n.name="viewport";i.appendChild(n)}var r="width="+t+"; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;";n.setAttribute("content",r);return}function cantkInitViewPort(t){var e="";var i=document.createElement("meta");var n=document.getElementsByTagName("head")[0];if(window.devicePixelRatio&&window.devicePixelRatio>2){window.realDevicePixelRatio=window.devicePixelRatio;window.devicePixelRatio=2}var r=window.devicePixelRatio?window.devicePixelRatio:1;t=t?t:1/r;var a="initial-scale="+t+", minimum-scale="+t+", maximum-scale="+t+", user-scalable=0";if(isIPhone()){e="width=device-width, "+a}else if(isAndroid()){var o=browserVersion();if(o<537||isWeiXin()||isWeiBo()||isQQ()){window.devicePixelRatio=window.realDevicePixelRatio;e="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"}else{e="width=device-width, "+a}}else if(isFirefoxMobile()){var s=cantkGetViewPort();e="width="+s.width+", "+a}else{e="width=device-width, "+a}i.name="viewport";i.content=e;console.log("viewport: "+e);n.appendChild(i);return}function cantkLog(t){console.log(t);return}var gDelayScripts=new Array;function cantkDelayLoadScript(t){gDelayScripts.push(t);return}function loadDelayScriptsNow(){var t=0;var e=null;var i=null;var n=document.head?document.head:document.body;for(t=0;t<gDelayScripts.length;t++){i=gDelayScripts[t];e=document.createElement("script");e.src=i;n.appendChild(e);console.log("Load: "+i)}gDelayScripts.clear();return}function loadScriptOnce(t){var e=document.scripts;if(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.src&&n.src.indexOf(t)>=0){console.log("script is loaded: "+t);return}}}var r=document.head?document.head:document.body;var a=document.createElement("script");a.src=t;r.appendChild(a);console.log("load script: "+t);return}setTimeout(function(){loadDelayScriptsNow();return},800);function delayLoadScripts(t){if(t){dappSetResHostName(t)}return}function getScriptByUrl(t){var e=document.getElementsByTagName("script");if(e){for(var i=0;i<e.length;i++){var n=e[i];var r=n.src;if(r.indexOf(t)>=0){return n}}}return null}function isScriptLoaded(t){return getScriptByUrl(t)!=null}Locales={};Locales.getLanguageName=function(){var t="";if(navigator.language){t=navigator.language}else if(navigator.userLanguage){t=navigator.userLanguage}t=t.toLowerCase();return t};function cantkGetLocale(){return Locales.getLanguageName()}var requestAnimFrame=CantkRT.requestAnimFrame;function getQueryParameter(t){var t=t+"=";var e=window.location.search.substring(1);if(e.length>0){begin=e.indexOf(t);if(begin!=-1){begin+=t.length;end=e.indexOf("&",begin);if(end==-1){end=e.length}var i=e.substring(begin,end);return decodeURI(i)}}return null}function cantkGetQueryParam(t){return getQueryParameter(t)}function getFontSizeInFont(t){var e=12;var i=t.match(/\d+px/g);if(i){e=parseInt(i[0])}else{var n=t.match(/\d+pt/g);if(n){e=parseInt(n[0])*1.5}}return e}function basename(t){return t.replace(/\\/g,"/").replace(/.*\//,"")}function dirname(t){return t.replace(/\\/g,"/").replace(/\/[^\/]*$/,"")}String.prototype.basename=function(t){var e=this.replace(/\\/g,"/").replace(/.*\//,"");if(t){var i=e.lastIndexOf(".");if(i>=0){e=e.substr(0,i)}}return e};String.prototype.extname=function(){var t="";var e=this.lastIndexOf(".");if(e>=0){t=this.substr(e+1)}return t};String.prototype.dirname=function(){return this.replace(/\\/g,"/").replace(/\/[^\/]*$/,"")};function cantkIsFullscreen(){return document.fullscreenElement||document.mozFullScreen||document.webkitIsFullScreen}function cantkRequestFullscreen(t){function e(e){if(t){t(cantkIsFullscreen())}console.log("fullscreenchange:"+cantkIsFullscreen());return true}if(cantkIsFullscreen()){e();return true}var i=document.documentElement;if(document.documentElement.requestFullscreen){i.addEventListener("fullscreenchange",e,true);return i.requestFullscreen()}else if(document.documentElement.mozRequestFullScreen){i.addEventListener("mozfullscreenchange",e,true);return i.mozRequestFullScreen()}else if(document.documentElement.webkitRequestFullScreen){i.addEventListener("webkitfullscreenchange",e,true);return i.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}return false}function saveStrToFile(t,e){function i(){return window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder}try{var n=i();var r=new n;r.append(e);saveAs(r.getBlob("text/plain;charset="+document.characterSet),t)}catch(a){var r=new Blob([e],{type:"text/plain;charset="+document.characterSet});saveAs(r,t)}return}function readLocalTextFile(t,e){function i(i){try{var n=new FileReader;n.onload=function(e){var i=e.target.result;if(t){t(i)}return};n.onerror=function(t){if(e){e(t)}return};n.readAsText(i);n=null}catch(r){if(e){e(null)}}}var n=document.createElement("input");n.type="file";n.multiple=false;n.onchange=function(t){if(this.files&&this.files.length){var e=this.files[0];if(e&&(!e.type||e.type.indexOf("text")>=0)){i(e)}else{console.log("Not text file.")}}};n.click();n=null;return}Math.distanceBetween=function(t,e){var i=e.x-t.x;var n=e.y-t.y;var r=Math.sqrt(i*i+n*n);return r};Math.lineAngle=function(t,e){var i=e.x-t.x;var n=e.y-t.y;var r=Math.sqrt(i*i+n*n);if(i==0&&n==0){return 0}if(i==0){if(n<0){return 1.5*Math.PI}else{return.5*Math.PI}}if(n==0){if(i<0){return Math.PI}else{return 0}}if(i>0){if(n>0){return Math.asin(n/r)}else{return 2*Math.PI-Math.asin(Math.abs(n)/r)}}else{if(n>0){return Math.PI-Math.asin(Math.abs(n)/r)}else{return Math.PI+Math.asin(Math.abs(n)/r)}}};Math.translatePoint=function(t,e,i){var n=t.x;var r=t.y;if(e<.5*Math.PI){n=n+i*Math.cos(e);r=r+i*Math.sin(e)}else if(e<Math.PI){var a=Math.PI-e;n=n-i*Math.cos(a);r=r+i*Math.sin(a)}else if(e<1.5*Math.PI){var a=e-Math.PI;n=n-i*Math.cos(a);r=r-i*Math.sin(a)}else{var a=2*Math.PI-e;n=n+i*Math.cos(a);r=r-i*Math.sin(a)}return{x:n,y:r}};Math.rotatePoint=function(t,e){var i={};i.x=t.x*Math.cos(e)+t.y*Math.sin(e);i.y=t.y*Math.cos(e)-t.x*Math.sin(e);return i};function dataURLToBlob(t){var e=";base64,";if(t.indexOf(e)==-1){var i=t.split(",");var n=i[0].split(":")[1];var r=decodeURIComponent(i[1]);return new Blob([r],{type:n})}var i=t.split(e);var n=i[0].split(":")[1];var r=window.atob(i[1]);var a=r.length;var o=new Uint8Array(a);for(var s=0;s<a;++s){o[s]=r.charCodeAt(s)}return new Blob([o],{type:n})}window.makeUniqRandArray=makeUniqRandArray;window.cantkGetQueryParam=cantkGetQueryParam;function isWebAudioSupported(){return typeof AudioContext!=="undefined"||typeof webkitAudioContext!=="undefined"}window.sendStatistics=function(t){window.magicData=t;return};window.setStatisticsData=function(t){window.magicData=t;return}(function(t){"use strict";function e(t,e){var i=(t&65535)+(e&65535),n=(t>>16)+(e>>16)+(i>>16);return n<<16|i&65535}function i(t,e){return t<<e|t>>>32-e}function n(t,n,r,a,o,s){return e(i(e(e(n,t),e(a,s)),o),r)}function r(t,e,i,r,a,o,s){return n(e&i|~e&r,t,e,a,o,s)}function a(t,e,i,r,a,o,s){return n(e&r|i&~r,t,e,a,o,s)}function o(t,e,i,r,a,o,s){return n(e^i^r,t,e,a,o,s)}function s(t,e,i,r,a,o,s){return n(i^(e|~r),t,e,a,o,s)}function h(t,i){t[i>>5]|=128<<i%32;t[(i+64>>>9<<4)+14]=i;var n,h,l,u,c,p=1732584193,f=-271733879,m=-1732584194,d=271733878;for(n=0;n<t.length;n+=16){h=p;l=f;u=m;c=d;p=r(p,f,m,d,t[n],7,-680876936);d=r(d,p,f,m,t[n+1],12,-389564586);m=r(m,d,p,f,t[n+2],17,606105819);f=r(f,m,d,p,t[n+3],22,-1044525330);p=r(p,f,m,d,t[n+4],7,-176418897);d=r(d,p,f,m,t[n+5],12,1200080426);m=r(m,d,p,f,t[n+6],17,-1473231341);f=r(f,m,d,p,t[n+7],22,-45705983);p=r(p,f,m,d,t[n+8],7,1770035416);d=r(d,p,f,m,t[n+9],12,-1958414417);m=r(m,d,p,f,t[n+10],17,-42063);f=r(f,m,d,p,t[n+11],22,-1990404162);p=r(p,f,m,d,t[n+12],7,1804603682);d=r(d,p,f,m,t[n+13],12,-40341101);m=r(m,d,p,f,t[n+14],17,-1502002290);f=r(f,m,d,p,t[n+15],22,1236535329);p=a(p,f,m,d,t[n+1],5,-165796510);d=a(d,p,f,m,t[n+6],9,-1069501632);m=a(m,d,p,f,t[n+11],14,643717713);f=a(f,m,d,p,t[n],20,-373897302);p=a(p,f,m,d,t[n+5],5,-701558691);d=a(d,p,f,m,t[n+10],9,38016083);m=a(m,d,p,f,t[n+15],14,-660478335);f=a(f,m,d,p,t[n+4],20,-405537848);p=a(p,f,m,d,t[n+9],5,568446438);d=a(d,p,f,m,t[n+14],9,-1019803690);m=a(m,d,p,f,t[n+3],14,-187363961);f=a(f,m,d,p,t[n+8],20,1163531501);p=a(p,f,m,d,t[n+13],5,-1444681467);d=a(d,p,f,m,t[n+2],9,-51403784);m=a(m,d,p,f,t[n+7],14,1735328473);f=a(f,m,d,p,t[n+12],20,-1926607734);p=o(p,f,m,d,t[n+5],4,-378558);d=o(d,p,f,m,t[n+8],11,-2022574463);m=o(m,d,p,f,t[n+11],16,1839030562);f=o(f,m,d,p,t[n+14],23,-35309556);p=o(p,f,m,d,t[n+1],4,-1530992060);d=o(d,p,f,m,t[n+4],11,1272893353);m=o(m,d,p,f,t[n+7],16,-155497632);f=o(f,m,d,p,t[n+10],23,-1094730640);p=o(p,f,m,d,t[n+13],4,681279174);d=o(d,p,f,m,t[n],11,-358537222);m=o(m,d,p,f,t[n+3],16,-722521979);f=o(f,m,d,p,t[n+6],23,76029189);p=o(p,f,m,d,t[n+9],4,-640364487);d=o(d,p,f,m,t[n+12],11,-421815835);m=o(m,d,p,f,t[n+15],16,530742520);f=o(f,m,d,p,t[n+2],23,-995338651);p=s(p,f,m,d,t[n],6,-198630844);d=s(d,p,f,m,t[n+7],10,1126891415);m=s(m,d,p,f,t[n+14],15,-1416354905);f=s(f,m,d,p,t[n+5],21,-57434055);p=s(p,f,m,d,t[n+12],6,1700485571);d=s(d,p,f,m,t[n+3],10,-1894986606);m=s(m,d,p,f,t[n+10],15,-1051523);f=s(f,m,d,p,t[n+1],21,-2054922799);p=s(p,f,m,d,t[n+8],6,1873313359);d=s(d,p,f,m,t[n+15],10,-30611744);m=s(m,d,p,f,t[n+6],15,-1560198380);f=s(f,m,d,p,t[n+13],21,1309151649);p=s(p,f,m,d,t[n+4],6,-145523070);d=s(d,p,f,m,t[n+11],10,-1120210379);m=s(m,d,p,f,t[n+2],15,718787259);f=s(f,m,d,p,t[n+9],21,-343485551);p=e(p,h);f=e(f,l);m=e(m,u);d=e(d,c)}return[p,f,m,d]}function l(t){var e,i="";for(e=0;e<t.length*32;e+=8){i+=String.fromCharCode(t[e>>5]>>>e%32&255)}return i}function u(t){var e,i=[];i[(t.length>>2)-1]=undefined;for(e=0;e<i.length;e+=1){i[e]=0}for(e=0;e<t.length*8;e+=8){i[e>>5]|=(t.charCodeAt(e/8)&255)<<e%32}return i}function c(t){return l(h(u(t),t.length*8))}function p(t,e){var i,n=u(t),r=[],a=[],o;r[15]=a[15]=undefined;if(n.length>16){n=h(n,t.length*8)}for(i=0;i<16;i+=1){r[i]=n[i]^909522486;a[i]=n[i]^1549556828}o=h(r.concat(u(e)),512+e.length*8);return l(h(a.concat(o),512+128))}function f(t){var e="0123456789abcdef",i="",n,r;for(r=0;r<t.length;r+=1){n=t.charCodeAt(r);i+=e.charAt(n>>>4&15)+e.charAt(n&15)}return i}function m(t){return unescape(encodeURIComponent(t))}function d(t){return c(m(t))}function g(t){return f(d(t))}function y(t,e){return p(m(t),m(e))}function v(t,e){return f(y(t,e))}function _(t,e,i){if(!e){if(!i){return g(t)}return d(t)}if(!i){return v(e,t)}return y(e,t)}if(typeof define==="function"&&define.amd){define(function(){return _})}else{t.md5=_}window.md5=_;window.sum=_}(this));function showFileDialog(t,e,i,n){var r=document.createElement("input");var a=document.getElementById("defform");if(!a){a=document.createElement("form");a.id="defform";document.body.appendChild(a)}a.appendChild(r);r.type="file";r.accept=t;r.multiple=e;r.capture=i;r.onchange=function(t){if(n){n(this.files)}a.removeChild(r)};r.click()}function Rect(t,e,i,n){this.x=t;this.y=e;this.w=i;this.h=n;return this}Rect.prototype.clone=Rect.prototype.dup=function(){return new Rect(this.x,this.y,this.w,this.h)};function Point(t,e){this.x=t;this.y=e;return this}Point.prototype.dup=function(){return new Point(this.x,this.y)};Point.prototype.copy=function(t){this.x=t.x;this.y=t.y;return};function pointEqual(t,e){return t.x===e.x&&t.y===e.y}Rect.intersection=function(t,e){var i=Math.max(t.x,e.x);var n=Math.min(t.x+t.w,e.x+e.w);if(i<=n){var r=Math.max(t.y,e.y);var a=Math.min(t.y+t.h,e.y+e.h);if(r<=a){return new Rect(i,r,n-i,a-r)}}return null};Rect.hasIntersection=function(t,e){var i=Math.max(t.x,e.x);var n=Math.min(t.x+t.w,e.x+e.w);if(i<=n){var r=Math.max(t.y,e.y);var a=Math.min(t.y+t.h,e.y+e.h);if(r<=a){return true}}return false};Rect.difference=function(t,e){var i=Rect.intersection(t,e);if(!i||!i.h||!i.w){return[t.clone()]}var n=[];var r=t.y;var a=t.h;var o=t.x+t.w;var s=t.y+t.h;var h=e.x+e.w;var l=e.y+e.h;if(e.y>t.y){n.push(new Rect(t.x,t.y,t.w,e.y-t.y));r=e.y;a-=e.y-t.y}if(l<s){n.push(new Rect(t.x,l,t.w,s-l));a=l-r}if(e.x>t.x){n.push(new Rect(t.x,r,e.x-t.x,a))}if(h<o){n.push(new Rect(h,r,o-h,a))}return n};Rect.subtract2=function(t,e,i){var n=[];var r=Rect.difference(t,e);for(var a=0;a<r.length;a++){var o=Rect.difference(r[a],i);n=n.concat(o)}return n};if(typeof KeyEvent==="undefined"){var KeyEvent={DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_BACK_BUTTON:115,DOM_VK_MENU_BUTTON:118,DOM_VK_SEARCH_BUTTON:120,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,
DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}}KeyEvent.DOM_VK_BACK=225;var C_EVT_POINTER_DOWN=1;var C_EVT_POINTER_MOVE=0;var C_EVT_POINTER_UP=-1;var C_EVT_KEY_DOWN=2;var C_EVT_KEY_UP=3;var C_EVT_DOUBLE_CLICK=4;var C_EVT_CONTEXT_MENU=5;var C_EVT_LONG_PRESS=6;var C_EVT_SCALE=7;var gCancelDefaultAction=false;function canvasAttachManager(t,e,i){if(window.cantkRTV8){window.pointer.emitPointers(t)}else if(!t.isNative){window.pointer.emitPointers(t)}function n(t){return t?t:window.event}function r(t){t=n(t);var i=t.keyCode;if(i===KeyEvent.DOM_VK_F5||i===KeyEvent.DOM_VK_F12||i===KeyEvent.DOM_VK_F11){return true}if(targetIsEditor(t)){return true}if(!e.preprocessEvent(C_EVT_KEY_DOWN,t,i)){return true}e.onKeyDown(i);if(i===KeyEvent.DOM_VK_F8){var r={scale:1,rotation:0};r.isStart=true;e.onGesture(r);r.isStart=false;r.isChange=true;e.onGesture(r);r.isChange=false;r.isEnd=true;e.onGesture(r)}return returnDefaultAction(t)}function a(t){t=n(t);var i=t.keyCode;if(i===KeyEvent.DOM_VK_F5||i===KeyEvent.DOM_VK_F12||i===KeyEvent.DOM_VK_F11){return true}if(targetIsEditor(t)){return true}if(!e.preprocessEvent(C_EVT_KEY_UP,t,i)){return true}e.onKeyUp(i);return returnDefaultAction(t)}if(isTizen()){document.addEventListener("tizenhwkey",function(t){if(t.keyName=="back"){e.onKeyDown(KeyEvent.DOM_VK_BACK_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_BACK_BUTTON);console.log("tizenhwkey back button.")}else if(t.keyName=="menu"){e.onKeyDown(KeyEvent.DOM_VK_MENU_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_MENU_BUTTON);console.log("tizenhwkey menu button.")}})}else if(isPhoneGap()){function o(){e.onKeyDown(KeyEvent.DOM_VK_BACK_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_BACK_BUTTON);return true}function s(){e.onKeyDown(KeyEvent.DOM_VK_MENU_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_MENU_BUTTON);return true}function h(){e.onKeyDown(KeyEvent.DOM_VK_SEARCH_BUTTON);e.onKeyUp(KeyEvent.DOM_VK_SEARCH_BUTTON);return true}document.addEventListener("backbutton",o,false);document.addEventListener("menubutton",s,false);document.addEventListener("searchbutton",h,false)}else if(!isMobile()){cantkAddEventListener("keyup",a);cantkAddEventListener("keydown",r);function l(t){t=window.event||t;if(EditorElement.imeOpen)return true;if(t&&t.target&&t.target.localName!=="canvas"){return cancelDefaultAction(t)}var i=t.wheelDelta?t.wheelDelta:0;if(i){if(e.onWheel(i)){return cancelDefaultAction(t)}}return true}cantkAddEventListener("mousewheel",l);cantkAddEventListener("DOMMouseScroll",l)}function u(t){var e=Math.max(t.pageX,t.x);var i=Math.max(t.pageY,t.y);return{x:e,y:i}}function c(t){return t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches.length>1}function p(){var t={};t.x=e.lastPointerPoint.x;t.y=e.lastPointerPoint.y;return t}function f(t){var i=t.getPointerList();if(c(t)){console.log("onPointerDown Multi touch.");return cancelDefaultAction(t)}if(isRightMouseEvent(t.originalEvent)){console.log("Right button.");return cancelDefaultAction(t)}var n=i[0];var r=u(n);var a=n.identifier||0;if(e.preprocessEvent(C_EVT_POINTER_DOWN,t,r)){e.onPointerDown(r)}return cancelDefaultAction(t)}function m(t){var i=t.getPointerList();if(c(t)){console.log("onPointerMove Multi touch.");return cancelDefaultAction(t)}if(isRightMouseEvent(t.originalEvent)){console.log("Right button.");return cancelDefaultAction(t)}var n=i[0];var r=u(n);if(e.preprocessEvent(C_EVT_POINTER_MOVE,t,r)){e.onPointerMove(r)}return cancelDefaultAction(t)}function d(t){if(c(t)){console.log("onPointerUp Multi touch.");return cancelDefaultAction(t)}var i=p();if(isRightMouseEvent(t.originalEvent)){console.log("Right mouse up");if(e.preprocessEvent(C_EVT_CONTEXT_MENU,t,i)){e.onContextMenu(i)}return true}else{if(e.preprocessEvent(C_EVT_POINTER_UP,t,i)){e.onPointerUp(i)}}return cancelDefaultAction(t)}t.addEventListener("pointerdown",f,false);t.addEventListener("pointermove",m,false);t.addEventListener("pointerup",d,false);function g(t){var i=t.scale;var n={scale:i,rotation:0};n.isChange=false;n.isStart=t.scaleStart;n.isEnd=t.scaleEnd;if(n.isStart){console.log("scaleStart")}if(n.isEnd){console.log("scaleEnd")}e.onGesture(n);console.log("onGestureScale:"+i);return}function y(t){var i={};i.x=e.lastPointerPoint.x;i.y=e.lastPointerPoint.y;e.onLongPress(i);console.log("onGestureLongPress");return cancelDefaultAction(t)}function v(t){var i=p();e.onDoubleClick(i);console.log("onGestureDoubleTap");return cancelDefaultAction(t)}if(i.type==AppBase.TYPE_WEBAPP||i.type==AppBase.TYPE_PREVIEW){document.oncontextmenu=function(t){var i=t.target;if(i&&i.tagName==="CANVAS"){var n={};n.x=t.x+getScrollLeft();n.y=t.y+getScrollTop();e.onPointerDown(n);e.onLongPress(n);e.onPointerUp(n);console.log("onGestureLongPress");return cancelDefaultAction(t)}else{return true}}}t.addEventListener("gesturedoubletap",v);t.addEventListener("gesturelongpress",y);t.addEventListener("gesturescale",g);var _=cantkGetViewPort();var I=screen.height;function w(){}function x(){}function S(){var t=cantkGetViewPort();if(_.width!=t.width||_.height!=t.height){if(_.width===t.width){if(_.height<t.height){x()}else{w()}return}i.onSizeChanged();_=t}}window.onresize=function(t){setTimeout(S,50);return};var C=window.orientation;function T(){if(C!==window.orientation){i.onSizeChanged();C=window.orientation}}window.onorientationchange=function(t){setTimeout(T,50);return};document.ontouchend=function(t){return true};return}function cancelDefaultAction(t){var e=t?t:window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}return false}function filterResults(t,e,i){var n=t?t:0;if(e&&(!n||n>e))n=e;return i&&(!n||n>i)?i:n}function getScrollLeft(){return filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}function getScrollTop(){return filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function isRightMouseEvent(t){var e=false;if(t.which===null){e=t.button>2&&t.button!==4}else{e=t.which>2&&t.which!==2}return e}function setCancelDefaultAction(t){gCancelDefaultAction=t;return}function returnDefaultAction(t){return gCancelDefaultAction?cancelDefaultAction(t):true}function targetIsEditor(t){var e=t.srcElement?t.srcElement:t.target;var i=e.localName?e.localName:e.tagName;i=i.toLowerCase();if(i!="body"&&i!="canvas"){return true}return false}function targetIsCanvas(t){var e=t.srcElement?t.srcElement:t.target;var i=e.localName?e.localName:e.tagName;i=i.toLowerCase();if(i==="canvas"){return true}return false}window.Modernizr=function(t,e,i){var n="2.5.3",r={},a=e.documentElement,o="modernizr",s=e.createElement(o),h=s.style,l,u={}.toString,c=" -webkit- -moz- -o- -ms- ".split(" "),p={},f={},m={},d=[],g=d.slice,y,v=function(t,i,n,r){var s,h,l,u=e.createElement("div"),c=e.body,p=c?c:e.createElement("body");if(parseInt(n,10)){while(n--){l=e.createElement("div");l.id=r?r[n]:o+(n+1);u.appendChild(l)}}s=["&#173;","<style>",t,"</style>"].join("");u.id=o;(c?u:p).innerHTML+=s;p.appendChild(u);if(!c){p.style.background="";a.appendChild(p)}h=i(u,t);!c?p.parentNode.removeChild(p):u.parentNode.removeChild(u);return!!h},_={}.hasOwnProperty,I;if(!S(_,"undefined")&&!S(_.call,"undefined")){I=function(t,e){return _.call(t,e)}}else{I=function(t,e){return e in t&&S(t.constructor.prototype[e],"undefined")}}if(!Function.prototype.bind){Function.prototype.bind=function A(t){var e=this;if(typeof e!="function"){throw new TypeError}var i=g.call(arguments,1),n=function(){if(this instanceof n){var r=function(){};r.prototype=e.prototype;var a=new r;var o=e.apply(a,i.concat(g.call(arguments)));if(Object(o)===o){return o}return a}else{return e.apply(t,i.concat(g.call(arguments)))}};return n}}function w(t){h.cssText=t}function x(t,e){return w(c.join(t+";")+(e||""))}function S(t,e){return typeof t===e}function C(t,e){return!!~(""+t).indexOf(e)}function T(t,e,n){for(var r in t){var a=e[t[r]];if(a!==i){if(n===false)return t[r];if(S(a,"function")){return a.bind(n||e)}return a}}return false}var b=function(i,n){var a=i.join(""),o=n.length;v(a,function(i,n){var a=e.styleSheets[e.styleSheets.length-1],s=a?a.cssRules&&a.cssRules[0]?a.cssRules[0].cssText:a.cssText||"":"",h=i.childNodes,l={};while(o--){l[h[o].id]=h[o]}r["touch"]="ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch||(l["touch"]&&l["touch"].offsetTop)===9},o,n)}([,["@media (",c.join("touch-enabled),("),o,")","{#touch{top:9px;position:absolute}}"].join("")],[,"touch"]);p["touch"]=function(){return r["touch"]};for(var D in p){if(I(p,D)){y=D.toLowerCase();r[y]=p[D]();d.push((r[y]?"":"no-")+y)}}w("");s=l=null;r._version=n;r._prefixes=c;r.testStyles=v;return r}(this,this.document);(function(t){var e=1;function i(t,e,i){this.screenX=i.screenX||0;this.screenY=i.screenY||0;this.pageX=i.pageX||0;this.pageY=i.pageY||0;this.x=i.x||0;this.y=i.y||0;this.clientX=i.clientX||0;this.clientY=i.clientY||0;this.tiltX=i.tiltX||0;this.tiltY=i.tiltY||0;this.pressure=i.pressure||0;this.hwTimestamp=i.hwTimestamp||0;this.pointerType=e;this.identifier=t}var n={TOUCH:"touch",MOUSE:"mouse",PEN:"pen"};function r(t){t.target.mouseEvent=t}function a(t){t.target.mouseEvent=null}function o(t){t.target.touchList=t.targetTouches}function s(){var t=[];var r;if(this.touchList){for(var a=0;a<this.touchList.length;a++){var o=this.touchList[a];r=new i(o.identifier+2,n.TOUCH,o);t.push(r)}}else if(this.msPointerList){for(var s in this.msPointerList){if(!this.msPointerList.hasOwnProperty(s))continue;r=this.msPointerList[s];r=new i(s,r.textPointerType,r);t.push(r)}}if(this.mouseEvent){t.push(new i(e,n.MOUSE,this.mouseEvent))}return t}function h(t,e,i){var n={};for(var r in i){n[r]=i[r]}n.type=t;n.target=e;if(e.dispatchCustomEvent){e.dispatchCustomEvent(n)}else{e.dispatchEvent(n)}}function l(t){t.preventDefault();r(t);var e={pointerType:"mouse",getPointerList:s.bind(this),originalEvent:t};h("pointerdown",t.target,e)}function u(t){t.preventDefault();r(t);var e={pointerType:"mouse",getPointerList:s.bind(this),originalEvent:t};h("pointermove",t.target,e)}function c(t){t.preventDefault();r(t);var e={pointerType:"mouse",getPointerList:s.bind(this),originalEvent:t};h("pointerup",t.target,e)}function p(t){t.preventDefault();o(t);var e={pointerType:"touch",getPointerList:s.bind(this),originalEvent:t};h("pointerdown",t.target,e)}function f(t){t.preventDefault();o(t);var e={pointerType:"touch",getPointerList:s.bind(this),originalEvent:t};h("pointermove",t.target,e)}function m(t){t.preventDefault();o(t);var e={pointerType:"touch",getPointerList:s.bind(this),originalEvent:t};h("pointerup",t.target,e)}function d(t){if(t.target.mouseEvent){t.preventDefault();var e={pointerType:"mouse",getPointerList:s.bind(this),originalEvent:t};h("pointerup",t.target,e)}}function g(t){if(t.pointerType==2){t.textPointerType=n.TOUCH}else if(t.pointerType==3){t.textPointerType=n.PEN}else if(t.pointerType==4){t.textPointerType=n.MOUSE}if(t.textPointerType==n.MOUSE){t.target.msMouseDown=true}if(!t.target.msPointerList)t.target.msPointerList={};t.target.msPointerList[t.pointerId]=t;var e={pointerType:t.textPointerType,getPointerList:s.bind(this),originalEvent:t};h("pointerdown",t.target,e)}function y(t){if(t.pointerType==2){t.textPointerType=n.TOUCH}else if(t.pointerType==3){t.textPointerType=n.PEN}else if(t.pointerType==4){t.textPointerType=n.MOUSE}if(t.textPointerType==n.MOUSE&&!t.target.msMouseDown){return}if(!t.target.msPointerList)t.target.msPointerList={};t.target.msPointerList[t.pointerId]=t;var e={pointerType:t.textPointerType,getPointerList:s.bind(this),originalEvent:t};h("pointermove",t.target,e)}function v(t){if(t.target.msPointerList){delete t.target.msPointerList[t.pointerId]}if(t.pointerType==2){t.textPointerType=n.TOUCH}else if(t.pointerType==3){t.textPointerType=n.PEN}else if(t.pointerType==4){t.textPointerType=n.MOUSE}if(t.textPointerType==n.MOUSE){t.target.msMouseDown=false}var e={pointerType:t.textPointerType,getPointerList:s.bind(this),originalEvent:t};h("pointerup",t.target,e)}function _(t){if(!t.isPointerEmitter){if(x()){t.addEventListener("pointerdown",g);t.addEventListener("pointermove",y);t.addEventListener("pointerup",v)}else if(w()){t.addEventListener("MSPointerDown",g);t.addEventListener("MSPointerMove",y);t.addEventListener("MSPointerUp",v)}else{if(I()){t.addEventListener("touchstart",p);t.addEventListener("touchmove",f);t.addEventListener("touchend",m)}if(!isAndroid()){t.addEventListener("mousedown",l);t.addEventListener("mousemove",u);t.addEventListener("mouseup",c);t.addEventListener("mouseout",d)}}t.listeners={};t.addEventListener=function(e,i,n){var r=t.listeners[e]?t.listeners[e]:[];r.push(i);t.listeners[e]=r;return};t.dispatchCustomEvent=function(e){var i=e.type;var n=t.listeners[i]?t.listeners[i]:[];for(var r=0;r<n.length;r++){var a=n[r];a(e)}return};for(var e in Gesture._gestureHandlers){var i=Gesture._gestureHandlers[e];if(i){i(t)}}t.isPointerEmitter=true}}function I(){return Modernizr.touch}function w(){return window.navigator.msPointerEnabled}function x(){return window.navigator.pointerEnabled}t.pointer={emitPointers:_};function S(t,e){var i=t.prototype.addEventListener;t.prototype.addEventListener=function(t,n,r){e.call(this,t,n,r);i.call(this,t,n,r)}}t._createCustomEvent=h;t._augmentAddEventListener=S;t.PointerTypes=n})(window);(function(t){function e(t,e,i){if(t.indexOf("gesture")===0){var n=Gesture._gestureHandlers[t];if(n){n(this)}else{console.error("Warning: no handler found for {{evt}}.".replace("{{evt}}",t))}}}t.Gesture=t.Gesture||{};t.Gesture._gestureHandlers=t.Gesture._gestureHandlers||{}})(window);(function(t){var e=isMobile()?500:300;var i=30;function n(t){this.x=t.clientX;this.y=t.clientY}n.prototype.calculateSquaredDistance=function(t){var e=this.x-t.clientX;var i=this.y-t.clientY;return e*e+i*i};function r(t){var r=t.getPointerList();if(r.length!=1)return;var a=new Date;var o=t.originalEvent&&isRightMouseEvent(t.originalEvent);if(a-this.lastDownTime<e&&this.lastPosition&&this.lastPosition.calculateSquaredDistance(r[0])<i*i&&!o){this.isDoubleTap=true;this.eTarget=t.target}this.lastPosition=new n(r[0]);this.lastDownTime=a}function a(t){if(this.isDoubleTap){this.isDoubleTap=false;this.lastDownTime=0;this.lastPosition=null;var e={};clearTimeout(this.longPressTimer);window._createCustomEvent("gesturedoubletap",this.eTarget,e)}}function o(t){t.addEventListener("pointerdown",r);t.addEventListener("pointerup",a)}t.Gesture._gestureHandlers.gesturedoubletap=o})(window);(function(t){var e=600;var i=5;function n(t){this.x=t.clientX;this.y=t.clientY}n.prototype.calculateSquaredDistance=function(t){var e=this.x-t.clientX;var i=this.y-t.clientY;return e*e+i*i};function r(t){clearTimeout(this.longPressTimer);var i=t.getPointerList();if(i.length===1){t.target.longpressInitPosition=new n(i[0]);this.longPressTimer=setTimeout(function(){payload={};window._createCustomEvent("gesturelongpress",t.target,payload)},e)}}function a(t){var e=t.getPointerList();if(t.pointerType===PointerTypes.MOUSE){clearTimeout(this.longPressTimer)}else if(e.length===1){var n=t.target.longpressInitPosition;if(n&&n.calculateSquaredDistance(e[0])>i*i){clearTimeout(this.longPressTimer)}}}function o(t){clearTimeout(this.longPressTimer)}function s(t){t.addEventListener("pointerdown",r);t.addEventListener("pointermove",a);t.addEventListener("pointerup",o)}t.Gesture._gestureHandlers.gesturelongpress=s})(window);(function(t){var e=.2;function i(t,e){this.p1=t;this.p2=e}i.prototype.center=function(){return[(this.p1.pageX+this.p2.pageX)/2,(this.p1.pageY+this.p2.pageY)/2]};i.prototype.span=function(){var t=this.p1.pageX-this.p2.pageX;var e=this.p1.pageY-this.p2.pageY;return Math.sqrt(t*t+e*e)};i.prototype.scaleSince=function(t){var e=this.span();var i=t.span();if(i===0){return 0}else return e/i};function n(t){var e=t.getPointerList();if(e.length==2){t.target.scaleReferencePair=new i(e[0],e[1]);var n={scale:1,scaleStart:true};window._createCustomEvent("gesturescale",t.target,n);this.isGestureScale=true}else{this.isGestureScale=false}}function r(t){var n=t.getPointerList();if(n.length==2&&t.target.scaleReferencePair){var r=new i(n[0],n[1]);var a=r.scaleSince(t.target.scaleReferencePair);if(Math.abs(1-a)>e){var o={scale:a,centerX:(t.target.scaleReferencePair.p1.clientX+t.target.scaleReferencePair.p2.clientX)/2,centerY:(t.target.scaleReferencePair.p1.clientY+t.target.scaleReferencePair.p2.clientY)/2};window._createCustomEvent("gesturescale",t.target,o)}}}function a(t){if(this.isGestureScale){var e={scale:1,scaleEnd:true};window._createCustomEvent("gesturescale",t.target,e)}t.target.scaleReferencePair=null}function o(t){t.addEventListener("pointerdown",n);t.addEventListener("pointermove",r);t.addEventListener("pointerup",a)}t.Gesture._gestureHandlers.gesturescale=o})(window);(function(){"use strict";var t=null;var e=true;var i=false;f();if(e){var n=typeof t.createGain==="undefined"?t.createGainNode():t.createGain();n.gain.value=1;n.connect(t.destination)}var r=function(){this.init()};r.prototype={init:function(){var n=this||a;n._codecs={};n._howls=[];n._muted=false;n._volume=1;n.iOSAutoEnable=true;n.noAudio=i;n.usingWebAudio=e;n.ctx=t;if(!i){n._setupCodecs()}return n},volume:function(t){var i=this||a;t=parseFloat(t);if(typeof t!=="undefined"&&t>=0&&t<=1){i._volume=t;if(e){n.gain.value=t}for(var r=0;r<i._howls.length;r++){if(!i._howls[r]._webAudio){var o=i._howls[r]._getSoundIds();for(var s=0;s<o.length;s++){var h=i._howls[r]._soundById(o[s]);if(h&&h._node){h._node.volume=h._volume*t}}}}return i}return i._volume},mute:function(t){var i=this||a;i._muted=t;if(e){n.gain.value=t?0:i._volume}for(var r=0;r<i._howls.length;r++){if(!i._howls[r]._webAudio){var o=i._howls[r]._getSoundIds();for(var s=0;s<o.length;s++){var h=i._howls[r]._soundById(o[s]);if(h&&h._node){h._node.muted=t?true:h._muted}}}}return i},codecs:function(t){return(this||a)._codecs[t]},_setupCodecs:function(){var t=this||a;var e=new Audio;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,"");t._codecs={mp3:!!(i||e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")};console.log("codec:"+JSON.stringify(t._codecs,null,"	"));return t},_enableiOSAudio:function(){var e=this||a;if(t&&(e._iOSEnabled||!/iPhone|iPad|iPod/i.test(navigator.userAgent))){return}e._iOSEnabled=false;var i=function(){var n=t.createBuffer(1,1,22050);var r=t.createBufferSource();r.buffer=n;r.connect(t.destination);if(typeof r.start==="undefined"){r.noteOn(0)}else{r.start(0)}setTimeout(function(){if(r.playbackState===r.PLAYING_STATE||r.playbackState===r.FINISHED_STATE){e._iOSEnabled=true;e.iOSAutoEnable=false;window.removeEventListener("touchstart",i,false)}},0)};window.addEventListener("touchstart",i,false);return e}};var a=new r;var o=function(t){var e=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}e.init(t)};o.prototype={init:function(i){var n=this;n._autoplay=i.autoplay||false;n._ext=i.ext||null;n._html5=i.html5||false;n._muted=i.mute||false;n._loop=i.loop||false;n._pool=i.pool||5;n._preload=typeof i.preload==="boolean"?i.preload:true;n._rate=i.rate||1;n._sprite=i.sprite||{};n._src=typeof i.src!=="string"?i.src:[i.src];n._volume=i.volume!==undefined?i.volume:1;n._duration=0;n._loaded=false;n._sounds=[];n._endTimers={};n._onend=i.onend?[{fn:i.onend}]:[];n._onfaded=i.onfaded?[{fn:i.onfaded}]:[];n._onload=i.onload?[{fn:i.onload}]:[];n._onloaderror=i.onloaderror?[{fn:i.onloaderror}]:[];n._onpause=i.onpause?[{fn:i.onpause}]:[];n._onplay=i.onplay?[{fn:i.onplay}]:[];n._webAudio=e&&!n._html5;if(typeof t!=="undefined"&&t&&a.iOSAutoEnable){a._enableiOSAudio()}a._howls.push(n);if(n._preload){n.load()}return n},load:function(){var t=this;var e=null;if(i){t._emit("loaderror");return}if(typeof t._src==="string"){t._src=[t._src]}for(var n=0;n<t._src.length;n++){var r,o;if(t._ext&&t._ext[n]){r=t._ext[n]}else{o=t._src[n];r=/^data:audio\/([^;,]+);/i.exec(o);if(!r){r=/\.([^.]+)$/.exec(o.split("?",1)[0])}if(r){r=r[1].toLowerCase()}if(r==="php"){r=o.extname()}}if(a.codecs(r)){e=t._src[n];break}else{console.log("not found codecs for:"+t._src[n])}}if(!e){t._emit("loaderror");return}t._src=e;new s(t);if(t._webAudio){l(t)}return t},play:function(e){var i=this;var n=arguments;var r=null;if(typeof e==="number"){r=e;e=null}else if(typeof e==="undefined"){e="__default";var o=0;for(var s=0;s<i._sounds.length;s++){if(i._sounds[s]._paused&&!i._sounds[s]._ended){o++;r=i._sounds[s]._id}}if(o===1){e=null}else{r=null}}var h=r?i._soundById(r):i._inactiveSound();if(!h){return null}if(r&&!e){e=h._sprite||"__default"}if(!i._loaded&&!i._sprite[e]){i.once("load",function(){i.play(i._soundById(h._id)?h._id:undefined)});return h._id}if(r&&!h._paused){return h._id}var l=h._seek>0?h._seek:i._sprite[e][0]/1e3;var u=(i._sprite[e][0]+i._sprite[e][1])/1e3-l;var c=function(){var n=!!(h._loop||i._sprite[e][2]);i._emit("end",h._id);if(!i._webAudio&&n){i.stop(h._id).play(h._id)}if(i._webAudio&&n){i._emit("play",h._id);h._seek=h._start||0;h._playStart=t.currentTime;i._endTimers[h._id]=setTimeout(c,(h._stop-h._start)*1e3/Math.abs(i._rate))}if(i._webAudio&&!n){h._paused=true;h._ended=true;h._seek=h._start||0;i._clearTimer(h._id);h._node.bufferSource=null}if(!i._webAudio&&!n){i.stop(h._id)}};i._endTimers[h._id]=setTimeout(c,u*1e3/Math.abs(i._rate));h._paused=false;h._ended=false;h._sprite=e;h._seek=l;h._start=i._sprite[e][0]/1e3;h._stop=(i._sprite[e][0]+i._sprite[e][1])/1e3;h._loop=!!(h._loop||i._sprite[e][2]);var p=h._node;if(i._webAudio){var f=function(){i._refreshBuffer(h);var e=h._muted||i._muted?0:h._volume*a.volume();p.gain.setValueAtTime(e,t.currentTime);h._playStart=t.currentTime;if(typeof p.bufferSource.start==="undefined"){p.bufferSource.noteGrainOn(0,l,u)}else{p.bufferSource.start(0,l,u)}if(!i._endTimers[h._id]){i._endTimers[h._id]=setTimeout(c,u*1e3/Math.abs(i._rate))}if(!n[1]){setTimeout(function(){i._emit("play",h._id)},0)}};if(i._loaded){f()}else{i.once("load",f);i._clearTimer(h._id)}}else{var m=function(){p.currentTime=l;p.muted=h._muted||i._muted||a._muted||p.muted;p.volume=h._volume*a.volume();p.playbackRate=i._rate;setTimeout(function(){p.play();if(!n[1]){i._emit("play",h._id)}},0)};if(p.readyState===4||!p.readyState&&navigator.isCocoonJS){m()}else{var d=function(){i._endTimers[h._id]=setTimeout(c,u*1e3/Math.abs(i._rate));m();p.removeEventListener("canplaythrough",d,false)};p.addEventListener("canplaythrough",d,false);i._clearTimer(h._id)}}return h._id},pause:function(t){var e=this;if(!e._loaded){e.once("play",function(){e.pause(t)});return e}var i=e._getSoundIds(t);for(var n=0;n<i.length;n++){e._clearTimer(i[n]);var r=e._soundById(i[n]);if(r&&!r._paused){r._seek=e.seek(i[n]);r._paused=true;if(e._webAudio){if(!r._node.bufferSource){return e}if(typeof r._node.bufferSource.stop==="undefined"){r._node.bufferSource.noteOff(0)}else{r._node.bufferSource.stop(0)}r._node.bufferSource=null}else if(!isNaN(r._node.duration)){r._node.pause()}if(!arguments[1]){e._emit("pause",r._id)}}}return e},stop:function(t){var e=this;if(!e._loaded){if(typeof e._sounds[0]._sprite!=="undefined"){e.once("play",function(){e.stop(t)})}return e}var i=e._getSoundIds(t);for(var n=0;n<i.length;n++){e._clearTimer(i[n]);var r=e._soundById(i[n]);if(r&&!r._paused){r._seek=r._start||0;r._paused=true;r._ended=true;if(e._webAudio&&r._node){if(!r._node.bufferSource){return e}if(typeof r._node.bufferSource.stop==="undefined"){r._node.bufferSource.noteOff(0)}else{r._node.bufferSource.stop(0)}r._node.bufferSource=null}else if(r._node&&!isNaN(r._node.duration)){r._node.pause();r._node.currentTime=r._start||0}}}return e},mute:function(e,i){var n=this;if(!n._loaded){n.once("play",function(){n.mute(e,i)});return n}if(typeof i==="undefined"){if(typeof e==="boolean"){n._muted=e}else{return n._muted}}var r=n._getSoundIds(i);for(var o=0;o<r.length;o++){var s=n._soundById(r[o]);if(s){s._muted=e;if(n._webAudio&&s._node){s._node.gain.setValueAtTime(e?0:s._volume*a.volume(),t.currentTime)}else if(s._node){s._node.muted=a._muted?true:e}}}return n},volume:function(){var e=this;var i=arguments;var n,r;if(i.length===0){return e._volume}else if(i.length===1){var o=e._getSoundIds();var s=o.indexOf(i[0]);if(s>=0){r=parseInt(i[0],10)}else{n=parseFloat(i[0])}}else if(i.length===2){n=parseFloat(i[0]);r=parseInt(i[1],10)}var h;if(typeof n!=="undefined"&&n>=0&&n<=1){if(!e._loaded){e.once("play",function(){e.volume.apply(e,i)});return e}if(typeof r==="undefined"){e._volume=n}r=e._getSoundIds(r);for(var l=0;l<r.length;l++){h=e._soundById(r[l]);if(h){h._volume=n;if(e._webAudio&&h._node){h._node.gain.setValueAtTime(n*a.volume(),t.currentTime)}else if(h._node){h._node.volume=n*a.volume()}}}}else{h=r?e._soundById(r):e._sounds[0];return h?h._volume:0}return e},fade:function(e,i,n,r){var a=this;if(!a._loaded){a.once("play",function(){a.fade(e,i,n,r)});return a}a.volume(e,r);var o=a._getSoundIds(r);for(var s=0;s<o.length;s++){var h=a._soundById(o[s]);if(h){if(a._webAudio){var l=t.currentTime;var u=l+n/1e3;h._volume=e;h._node.gain.setValueAtTime(e,l);h._node.gain.linearRampToValueAtTime(i,u);setTimeout(function(e,n){setTimeout(function(){n._volume=i;a._emit("faded",e)},u-t.currentTime>0?Math.ceil((u-t.currentTime)*1e3):0)}.bind(a,o[s],h),n)}else{var c=Math.abs(e-i);var p=e>i?"out":"in";var f=c/.01;var m=n/f;(function(){var t=e;var n=setInterval(function(e){t+=p==="in"?.01:-.01;t=Math.max(0,t);t=Math.min(1,t);t=Math.round(t*100)/100;a.volume(t,e);if(t===i){clearInterval(n);a._emit("faded",e)}}.bind(a,o[s]),m)})()}}}return a},loop:function(){var t=this;var e=arguments;var i,n,r;if(e.length===0){return t._loop}else if(e.length===1){if(typeof e[0]==="boolean"){i=e[0];t._loop=i}else{r=t._soundById(parseInt(e[0],10));return r?r._loop:false}}else if(e.length===2){i=e[0];n=parseInt(e[1],10)}var a=t._getSoundIds(n);for(var o=0;o<a.length;o++){r=t._soundById(a[o]);if(r){r._loop=i;if(t._webAudio&&r._node){r._node.bufferSource.loop=i}}}return t},seek:function(){var e=this;var i=arguments;var n,r;if(i.length===0){r=e._sounds[0]._id}else if(i.length===1){var a=e._getSoundIds();var o=a.indexOf(i[0]);if(o>=0){r=parseInt(i[0],10)}else{r=e._sounds[0]._id;n=parseFloat(i[0])}}else if(i.length===2){n=parseFloat(i[0]);r=parseInt(i[1],10)}if(typeof r==="undefined"){return e}if(!e._loaded){e.once("load",function(){e.seek.apply(e,i)});return e}var s=e._soundById(r);if(s){if(n>=0){var h=e.playing(r);if(h){e.pause(r,true)}s._seek=n;e._clearTimer(r);if(h){e.play(r,true)}}else{if(e._webAudio){return s._seek+e.playing(r)?t.currentTime-s._playStart:0}else{return s._node.currentTime}}}return e},playing:function(t){var e=this;var i=e._soundById(t)||e._sounds[0];return i?!i._paused:false},duration:function(){return this._duration},unload:function(){var t=this;var e=t._sounds;for(var i=0;i<e.length;i++){if(!e[i]._paused){t.stop(e[i]._id);t._emit("end",e[i]._id)}if(!t._webAudio){e[i]._node.src="";e[i]._node.removeEventListener("error",e[i]._errorFn,false);e[i]._node.removeEventListener("canplaythrough",e[i]._loadFn,false)}delete e[i]._node;t._clearTimer(e[i]._id);var n=a._howls.indexOf(t);if(n>=0){a._howls.splice(n,1)}}if(h){delete h[t._src]}t=null;return null},on:function(t,e,i){var n=this;var r=n["_on"+t];if(typeof e==="function"){r.push({id:i,fn:e})}return n},off:function(t,e,i){var n=this;var r=n["_on"+t];if(e){for(var a=0;a<r.length;a++){if(e===r[a].fn&&i===r[a].id){r.splice(a,1);break}}}else{r=[]}return n},once:function(t,e,i){var n=this;var r=function(){e.apply(n,arguments);n.off(t,r,i)};n.on(t,r,i);return n},_emit:function(t,e,i){var n=this;var r=n["_on"+t];for(var a=0;a<r.length;a++){if(!r[a].id||r[a].id===e){setTimeout(function(t){t.call(this,e,i)}.bind(n,r[a].fn),0)}}console.log("howler emit:"+t);return n},_clearTimer:function(t){var e=this;if(e._endTimers[t]){clearTimeout(e._endTimers[t]);delete e._endTimers[t]}return e},_soundById:function(t){var e=this;for(var i=0;i<e._sounds.length;i++){if(t===e._sounds[i]._id){return e._sounds[i]}}return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++){if(t._sounds[e]._ended){return t._sounds[e].reset()}}return new s(t)},_drain:function(){var t=this;var e=t._pool;var i=0;var n=0;if(t._sounds.length<e){return}for(n=0;n<t._sounds.length;n++){if(t._sounds[n]._ended){i++}}for(n=t._sounds.length-1;n>=0;n--){if(i<=e){return}if(t._sounds[n]._ended){if(t._webAudio&&t._sounds[n]._node){t._sounds[n]._node.disconnect(0)}t._sounds.splice(n,1);i--}}},_getSoundIds:function(t){var e=this;if(typeof t==="undefined"){var i=[];for(var n=0;n<e._sounds.length;n++){i.push(e._sounds[n]._id)}return i}else{return[t]}},_refreshBuffer:function(e){var i=this;e._node.bufferSource=t.createBufferSource();e._node.bufferSource.buffer=h[i._src];if(e._panner){e._node.bufferSource.connect(e._panner)}else{e._node.bufferSource.connect(e._node)}e._node.bufferSource.loop=e._loop;if(e._loop){e._node.bufferSource.loopStart=e._start||0;e._node.bufferSource.loopEnd=e._stop}e._node.bufferSource.playbackRate.value=i._rate;return i}};var s=function(t){this._parent=t;this.init()};s.prototype={init:function(){var t=this;var e=t._parent;t._muted=e._muted;t._loop=e._loop;t._volume=e._volume;t._muted=e._muted;t._seek=0;t._paused=true;t._ended=true;t._id=Math.round(Date.now()*Math.random());e._sounds.push(t);t.create();return t},create:function(){var e=this;var i=e._parent;var r=a._muted||e._muted||e._parent._muted?0:e._volume*a.volume();if(i._webAudio){e._node=typeof t.createGain==="undefined"?t.createGainNode():t.createGain();e._node.gain.setValueAtTime(r,t.currentTime);e._node.paused=true;e._node.connect(n)}else{e._node=new Audio;e._errorFn=e._errorListener.bind(e);e._node.addEventListener("error",e._errorFn,false);e._loadFn=e._loadListener.bind(e);e._node.addEventListener("canplaythrough",e._loadFn,false);e._node.src=i._src;e._node.preload="auto";e._node.volume=r;e._node.load()}return e},reset:function(){var t=this;var e=t._parent;t._muted=e._muted;t._loop=e._loop;t._volume=e._volume;t._muted=e._muted;t._seek=0;t._paused=true;t._ended=true;t._sprite=null;t._id=Math.round(Date.now()*Math.random());return t},_errorListener:function(){var t=this;if(t._node.error&&t._node.error.code===4){a.noAudio=true}t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0);t._node.removeEventListener("error",t._errorListener,false)},_loadListener:function(){var t=this;var e=t._parent;e._duration=Math.ceil(t._node.duration*10)/10;if(Object.keys(e._sprite).length===0){e._sprite={__default:[0,e._duration*1e3]}}if(!e._loaded){e._loaded=true;e._emit("load")}if(e._autoplay){e.play()}t._node.removeEventListener("canplaythrough",t._loadFn,false)}};if(e){var h={};var l=function(t){var e=t._src;if(h[e]){t._duration=h[e].duration;p(t);return}if(/^data:[^;]+;base64,/.test(e)){var i=atob(e.split(",")[1]);var n=new Uint8Array(i.length);for(var r=0;r<i.length;++r){n[r]=i.charCodeAt(r)}c(n.buffer,t)}else{var a=new XMLHttpRequest;a.crossOrigin="Anonymous";a.open("GET",e,true);a.responseType="arraybuffer";
a.onload=function(){c(a.response,t)};a.onerror=function(){if(t._webAudio){t._html5=true;t._webAudio=false;t._sounds=[];delete h[e];t.load()}};u(a)}};var u=function(t){try{t.send()}catch(e){t.onerror()}};var c=function(e,i){console.log("to decodeAudioData: "+i._src+" length:"+e.byteLength);t.decodeAudioData(e,function(t){if(t){h[i._src]=t;p(i,t);console.log("load "+i._src+" duration:"+t.duration)}else{console.log("load "+i._src+" error buffer is null")}},function(){i._emit("loaderror");console.log("load "+i._src+" error: decodeAudioData failed.")})};var p=function(t,e){if(e&&!t._duration){t._duration=e.duration}if(Object.keys(t._sprite).length===0){t._sprite={__default:[0,t._duration*1e3]}}if(!t._loaded){t._loaded=true;t._emit("load")}if(t._autoplay){t.play()}}}function f(){try{if(typeof AudioContext!=="undefined"){t=new AudioContext;console.log("AudioContext supported")}else if(typeof webkitAudioContext!=="undefined"){t=new webkitAudioContext;console.log("webkitAudioContext supported")}else{e=false;console.log("Web Audio not supported")}}catch(n){e=false;console.log(JSON.stringify(n))}if(!e){if(typeof Audio!=="undefined"){try{new Audio}catch(n){i=true}}else{i=true}}if(i){console.log("No Audio Support.")}if(!e){console.log("Not Using WebAudio")}}if(typeof define==="function"&&define.amd){define("howler",function(){return{Howler:a,Howl:o}})}if(typeof exports!=="undefined"){exports.Howler=a;exports.Howl=o}if(typeof window!=="undefined"){window.HowlerGlobal=r;window.Howler=a;window.Howl=o;window.Sound=s}})();var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(t){if(t==null)return"";var e="";var i,n,r,a,o,s,h;var l=0;t=LZString.compress(t);while(l<t.length*2){if(l%2==0){i=t.charCodeAt(l/2)>>8;n=t.charCodeAt(l/2)&255;if(l/2+1<t.length)r=t.charCodeAt(l/2+1)>>8;else r=NaN}else{i=t.charCodeAt((l-1)/2)&255;if((l+1)/2<t.length){n=t.charCodeAt((l+1)/2)>>8;r=t.charCodeAt((l+1)/2)&255}else n=r=NaN}l+=3;a=i>>2;o=(i&3)<<4|n>>4;s=(n&15)<<2|r>>6;h=r&63;if(isNaN(n)){s=h=64}else if(isNaN(r)){h=64}e=e+LZString._keyStr.charAt(a)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(h)}return e},decompressFromBase64:function(t){if(t==null)return"";var e="",i=0,n,r,a,o,s,h,l,u,c=0,p=LZString._f;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<t.length){s=LZString._keyStr.indexOf(t.charAt(c++));h=LZString._keyStr.indexOf(t.charAt(c++));l=LZString._keyStr.indexOf(t.charAt(c++));u=LZString._keyStr.indexOf(t.charAt(c++));r=s<<2|h>>4;a=(h&15)<<4|l>>2;o=(l&3)<<6|u;if(i%2==0){n=r<<8;if(l!=64){e+=p(n|a)}if(u!=64){n=o<<8}}else{e=e+p(n|r);if(l!=64){n=a<<8}if(u!=64){e+=p(n|o)}}i+=3}return LZString.decompress(e)},compressToUTF16:function(t){if(t==null)return"";var e="",i,n,r,a=0,o=LZString._f;t=LZString.compress(t);for(i=0;i<t.length;i++){n=t.charCodeAt(i);switch(a++){case 0:e+=o((n>>1)+32);r=(n&1)<<14;break;case 1:e+=o(r+(n>>2)+32);r=(n&3)<<13;break;case 2:e+=o(r+(n>>3)+32);r=(n&7)<<12;break;case 3:e+=o(r+(n>>4)+32);r=(n&15)<<11;break;case 4:e+=o(r+(n>>5)+32);r=(n&31)<<10;break;case 5:e+=o(r+(n>>6)+32);r=(n&63)<<9;break;case 6:e+=o(r+(n>>7)+32);r=(n&127)<<8;break;case 7:e+=o(r+(n>>8)+32);r=(n&255)<<7;break;case 8:e+=o(r+(n>>9)+32);r=(n&511)<<6;break;case 9:e+=o(r+(n>>10)+32);r=(n&1023)<<5;break;case 10:e+=o(r+(n>>11)+32);r=(n&2047)<<4;break;case 11:e+=o(r+(n>>12)+32);r=(n&4095)<<3;break;case 12:e+=o(r+(n>>13)+32);r=(n&8191)<<2;break;case 13:e+=o(r+(n>>14)+32);r=(n&16383)<<1;break;case 14:e+=o(r+(n>>15)+32,(n&32767)+32);a=0;break}}return e+o(r+32)},decompressFromUTF16:function(t){if(t==null)return"";var e="",i,n,r=0,a=0,o=LZString._f;while(a<t.length){n=t.charCodeAt(a)-32;switch(r++){case 0:i=n<<1;break;case 1:e+=o(i|n>>14);i=(n&16383)<<2;break;case 2:e+=o(i|n>>13);i=(n&8191)<<3;break;case 3:e+=o(i|n>>12);i=(n&4095)<<4;break;case 4:e+=o(i|n>>11);i=(n&2047)<<5;break;case 5:e+=o(i|n>>10);i=(n&1023)<<6;break;case 6:e+=o(i|n>>9);i=(n&511)<<7;break;case 7:e+=o(i|n>>8);i=(n&255)<<8;break;case 8:e+=o(i|n>>7);i=(n&127)<<9;break;case 9:e+=o(i|n>>6);i=(n&63)<<10;break;case 10:e+=o(i|n>>5);i=(n&31)<<11;break;case 11:e+=o(i|n>>4);i=(n&15)<<12;break;case 12:e+=o(i|n>>3);i=(n&7)<<13;break;case 13:e+=o(i|n>>2);i=(n&3)<<14;break;case 14:e+=o(i|n>>1);i=(n&1)<<15;break;case 15:e+=o(i|n);r=0;break}a++}return LZString.decompress(e)},compress:function(t){if(t==null)return"";var e,i,n={},r={},a="",o="",s="",h=2,l=3,u=2,c="",p=0,f=0,m,d=LZString._f;for(m=0;m<t.length;m+=1){a=t.charAt(m);if(!Object.prototype.hasOwnProperty.call(n,a)){n[a]=l++;r[a]=true}o=s+a;if(Object.prototype.hasOwnProperty.call(n,o)){s=o}else{if(Object.prototype.hasOwnProperty.call(r,s)){if(s.charCodeAt(0)<256){for(e=0;e<u;e++){p=p<<1;if(f==15){f=0;c+=d(p);p=0}else{f++}}i=s.charCodeAt(0);for(e=0;e<8;e++){p=p<<1|i&1;if(f==15){f=0;c+=d(p);p=0}else{f++}i=i>>1}}else{i=1;for(e=0;e<u;e++){p=p<<1|i;if(f==15){f=0;c+=d(p);p=0}else{f++}i=0}i=s.charCodeAt(0);for(e=0;e<16;e++){p=p<<1|i&1;if(f==15){f=0;c+=d(p);p=0}else{f++}i=i>>1}}h--;if(h==0){h=Math.pow(2,u);u++}delete r[s]}else{i=n[s];for(e=0;e<u;e++){p=p<<1|i&1;if(f==15){f=0;c+=d(p);p=0}else{f++}i=i>>1}}h--;if(h==0){h=Math.pow(2,u);u++}n[o]=l++;s=String(a)}}if(s!==""){if(Object.prototype.hasOwnProperty.call(r,s)){if(s.charCodeAt(0)<256){for(e=0;e<u;e++){p=p<<1;if(f==15){f=0;c+=d(p);p=0}else{f++}}i=s.charCodeAt(0);for(e=0;e<8;e++){p=p<<1|i&1;if(f==15){f=0;c+=d(p);p=0}else{f++}i=i>>1}}else{i=1;for(e=0;e<u;e++){p=p<<1|i;if(f==15){f=0;c+=d(p);p=0}else{f++}i=0}i=s.charCodeAt(0);for(e=0;e<16;e++){p=p<<1|i&1;if(f==15){f=0;c+=d(p);p=0}else{f++}i=i>>1}}h--;if(h==0){h=Math.pow(2,u);u++}delete r[s]}else{i=n[s];for(e=0;e<u;e++){p=p<<1|i&1;if(f==15){f=0;c+=d(p);p=0}else{f++}i=i>>1}}h--;if(h==0){h=Math.pow(2,u);u++}}i=2;for(e=0;e<u;e++){p=p<<1|i&1;if(f==15){f=0;c+=d(p);p=0}else{f++}i=i>>1}while(true){p=p<<1;if(f==15){c+=d(p);break}else f++}return c},decompress:function(t){if(t==null)return"";if(t=="")return null;var e=[],i,n=4,r=4,a=3,o="",s="",h,l,u,c,p,f,m,d=LZString._f,g={string:t,val:t.charCodeAt(0),position:32768,index:1};for(h=0;h<3;h+=1){e[h]=h}u=0;p=Math.pow(2,2);f=1;while(f!=p){c=g.val&g.position;g.position>>=1;if(g.position==0){g.position=32768;g.val=g.string.charCodeAt(g.index++)}u|=(c>0?1:0)*f;f<<=1}switch(i=u){case 0:u=0;p=Math.pow(2,8);f=1;while(f!=p){c=g.val&g.position;g.position>>=1;if(g.position==0){g.position=32768;g.val=g.string.charCodeAt(g.index++)}u|=(c>0?1:0)*f;f<<=1}m=d(u);break;case 1:u=0;p=Math.pow(2,16);f=1;while(f!=p){c=g.val&g.position;g.position>>=1;if(g.position==0){g.position=32768;g.val=g.string.charCodeAt(g.index++)}u|=(c>0?1:0)*f;f<<=1}m=d(u);break;case 2:return""}e[3]=m;l=s=m;while(true){if(g.index>g.string.length){return""}u=0;p=Math.pow(2,a);f=1;while(f!=p){c=g.val&g.position;g.position>>=1;if(g.position==0){g.position=32768;g.val=g.string.charCodeAt(g.index++)}u|=(c>0?1:0)*f;f<<=1}switch(m=u){case 0:u=0;p=Math.pow(2,8);f=1;while(f!=p){c=g.val&g.position;g.position>>=1;if(g.position==0){g.position=32768;g.val=g.string.charCodeAt(g.index++)}u|=(c>0?1:0)*f;f<<=1}e[r++]=d(u);m=r-1;n--;break;case 1:u=0;p=Math.pow(2,16);f=1;while(f!=p){c=g.val&g.position;g.position>>=1;if(g.position==0){g.position=32768;g.val=g.string.charCodeAt(g.index++)}u|=(c>0?1:0)*f;f<<=1}e[r++]=d(u);m=r-1;n--;break;case 2:return s}if(n==0){n=Math.pow(2,a);a++}if(e[m]){o=e[m]}else{if(m===r){o=l+l.charAt(0)}else{return null}}s+=o;e[r++]=l+o.charAt(0);n--;l=o;if(n==0){n=Math.pow(2,a);a++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}function strCompress(t){var e="";try{e=t?LZString.compress(t):""}catch(i){console.log("strCompress: "+i.message)}return e}function strDecompress(t){var e="";try{e=t?LZString.decompress(t):""}catch(i){console.log("strDecompress: "+i.message)}return e}var QRCode;(function(){function t(t){this.mode=i.MODE_8BIT_BYTE;this.data=t;this.parsedData=[];for(var e=0,n=this.data.length;e<n;e++){var r=[];var a=this.data.charCodeAt(e);if(a>65536){r[0]=240|(a&1835008)>>>18;r[1]=128|(a&258048)>>>12;r[2]=128|(a&4032)>>>6;r[3]=128|a&63}else if(a>2048){r[0]=224|(a&61440)>>>12;r[1]=128|(a&4032)>>>6;r[2]=128|a&63}else if(a>128){r[0]=192|(a&1984)>>>6;r[1]=128|a&63}else{r[0]=a}this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData);if(this.parsedData.length!=this.data.length){this.parsedData.unshift(191);this.parsedData.unshift(187);this.parsedData.unshift(239)}}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,i=this.parsedData.length;e<i;e++){t.put(this.parsedData[e],8)}}};function e(t,e){this.typeNumber=t;this.errorCorrectLevel=e;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}e.prototype={addData:function(e){var i=new t(e);this.dataList.push(i);this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e){throw new Error(t+","+e)}return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(false,this.getBestMaskPattern())},makeImpl:function(t,i){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[n][r]=null}}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(t,i);if(this.typeNumber>=7){this.setupTypeNumber(t)}if(this.dataCache==null){this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)}this.mapData(this.dataCache,i)},setupPositionProbePattern:function(t,e){for(var i=-1;i<=7;i++){if(t+i<=-1||this.moduleCount<=t+i)continue;for(var n=-1;n<=7;n++){if(e+n<=-1||this.moduleCount<=e+n)continue;if(0<=i&&i<=6&&(n==0||n==6)||0<=n&&n<=6&&(i==0||i==6)||2<=i&&i<=4&&2<=n&&n<=4){this.modules[t+i][e+n]=true}else{this.modules[t+i][e+n]=false}}}},getBestMaskPattern:function(){var t=0;var e=0;for(var i=0;i<8;i++){this.makeImpl(true,i);var n=a.getLostPoint(this);if(i==0||t>n){t=n;e=i}}return e},createMovieClip:function(t,e,i){var n=t.createEmptyMovieClip(e,i);var r=1;this.make();for(var a=0;a<this.modules.length;a++){var o=a*r;for(var s=0;s<this.modules[a].length;s++){var h=s*r;var l=this.modules[a][s];if(l){n.beginFill(0,100);n.moveTo(h,o);n.lineTo(h+r,o);n.lineTo(h+r,o+r);n.lineTo(h,o+r);n.endFill()}}}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++){if(this.modules[t][6]!=null){continue}this.modules[t][6]=t%2==0}for(var e=8;e<this.moduleCount-8;e++){if(this.modules[6][e]!=null){continue}this.modules[6][e]=e%2==0}},setupPositionAdjustPattern:function(){var t=a.getPatternPosition(this.typeNumber);for(var e=0;e<t.length;e++){for(var i=0;i<t.length;i++){var n=t[e];var r=t[i];if(this.modules[n][r]!=null){continue}for(var o=-2;o<=2;o++){for(var s=-2;s<=2;s++){if(o==-2||o==2||s==-2||s==2||o==0&&s==0){this.modules[n+o][r+s]=true}else{this.modules[n+o][r+s]=false}}}}}},setupTypeNumber:function(t){var e=a.getBCHTypeNumber(this.typeNumber);for(var i=0;i<18;i++){var n=!t&&(e>>i&1)==1;this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=n}for(var i=0;i<18;i++){var n=!t&&(e>>i&1)==1;this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=n}},setupTypeInfo:function(t,e){var i=this.errorCorrectLevel<<3|e;var n=a.getBCHTypeInfo(i);for(var r=0;r<15;r++){var o=!t&&(n>>r&1)==1;if(r<6){this.modules[r][8]=o}else if(r<8){this.modules[r+1][8]=o}else{this.modules[this.moduleCount-15+r][8]=o}}for(var r=0;r<15;r++){var o=!t&&(n>>r&1)==1;if(r<8){this.modules[8][this.moduleCount-r-1]=o}else if(r<9){this.modules[8][15-r-1+1]=o}else{this.modules[8][15-r-1]=o}}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){var i=-1;var n=this.moduleCount-1;var r=7;var o=0;for(var s=this.moduleCount-1;s>0;s-=2){if(s==6)s--;while(true){for(var h=0;h<2;h++){if(this.modules[n][s-h]==null){var l=false;if(o<t.length){l=(t[o]>>>r&1)==1}var u=a.getMask(e,n,s-h);if(u){l=!l}this.modules[n][s-h]=l;r--;if(r==-1){o++;r=7}}}n+=i;if(n<0||this.moduleCount<=n){n-=i;i=-i;break}}}}};e.PAD0=236;e.PAD1=17;e.createData=function(t,i,n){var r=l.getRSBlocks(t,i);var o=new u;for(var s=0;s<n.length;s++){var h=n[s];o.put(h.mode,4);o.put(h.getLength(),a.getLengthInBits(h.mode,t));h.write(o)}var c=0;for(var s=0;s<r.length;s++){c+=r[s].dataCount}if(o.getLengthInBits()>c*8){throw new Error("code length overflow. ("+o.getLengthInBits()+">"+c*8+")")}if(o.getLengthInBits()+4<=c*8){o.put(0,4)}while(o.getLengthInBits()%8!=0){o.putBit(false)}while(true){if(o.getLengthInBits()>=c*8){break}o.put(e.PAD0,8);if(o.getLengthInBits()>=c*8){break}o.put(e.PAD1,8)}return e.createBytes(o,r)};e.createBytes=function(t,e){var i=0;var n=0;var r=0;var o=new Array(e.length);var s=new Array(e.length);for(var l=0;l<e.length;l++){var u=e[l].dataCount;var c=e[l].totalCount-u;n=Math.max(n,u);r=Math.max(r,c);o[l]=new Array(u);for(var p=0;p<o[l].length;p++){o[l][p]=255&t.buffer[p+i]}i+=u;var f=a.getErrorCorrectPolynomial(c);var m=new h(o[l],f.getLength()-1);var d=m.mod(f);s[l]=new Array(f.getLength()-1);for(var p=0;p<s[l].length;p++){var g=p+d.getLength()-s[l].length;s[l][p]=g>=0?d.get(g):0}}var y=0;for(var p=0;p<e.length;p++){y+=e[p].totalCount}var v=new Array(y);var _=0;for(var p=0;p<n;p++){for(var l=0;l<e.length;l++){if(p<o[l].length){v[_++]=o[l][p]}}}for(var p=0;p<r;p++){for(var l=0;l<e.length;l++){if(p<s[l].length){v[_++]=s[l][p]}}}return v};var i={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3};var n={L:1,M:0,Q:3,H:2};var r={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var a={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1<<10|1<<8|1<<5|1<<4|1<<2|1<<1|1<<0,G18:1<<12|1<<11|1<<10|1<<9|1<<8|1<<5|1<<2|1<<0,G15_MASK:1<<14|1<<12|1<<10|1<<4|1<<1,getBCHTypeInfo:function(t){var e=t<<10;while(a.getBCHDigit(e)-a.getBCHDigit(a.G15)>=0){e^=a.G15<<a.getBCHDigit(e)-a.getBCHDigit(a.G15)}return(t<<10|e)^a.G15_MASK},getBCHTypeNumber:function(t){var e=t<<12;while(a.getBCHDigit(e)-a.getBCHDigit(a.G18)>=0){e^=a.G18<<a.getBCHDigit(e)-a.getBCHDigit(a.G18)}return t<<12|e},getBCHDigit:function(t){var e=0;while(t!=0){e++;t>>>=1}return e},getPatternPosition:function(t){return a.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,i){switch(t){case r.PATTERN000:return(e+i)%2==0;case r.PATTERN001:return e%2==0;case r.PATTERN010:return i%3==0;case r.PATTERN011:return(e+i)%3==0;case r.PATTERN100:return(Math.floor(e/2)+Math.floor(i/3))%2==0;case r.PATTERN101:return e*i%2+e*i%3==0;case r.PATTERN110:return(e*i%2+e*i%3)%2==0;case r.PATTERN111:return(e*i%3+(e+i)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){var e=new h([1],0);for(var i=0;i<t;i++){e=e.multiply(new h([1,o.gexp(i)],0))}return e},getLengthInBits:function(t,e){if(1<=e&&e<10){switch(t){case i.MODE_NUMBER:return 10;case i.MODE_ALPHA_NUM:return 9;case i.MODE_8BIT_BYTE:return 8;case i.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}}else if(e<27){switch(t){case i.MODE_NUMBER:return 12;case i.MODE_ALPHA_NUM:return 11;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}}else if(e<41){switch(t){case i.MODE_NUMBER:return 14;case i.MODE_ALPHA_NUM:return 13;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}else{throw new Error("type:"+e)}},getLostPoint:function(t){var e=t.getModuleCount();var i=0;for(var n=0;n<e;n++){for(var r=0;r<e;r++){var a=0;var o=t.isDark(n,r);for(var s=-1;s<=1;s++){if(n+s<0||e<=n+s){continue}for(var h=-1;h<=1;h++){if(r+h<0||e<=r+h){continue}if(s==0&&h==0){continue}if(o==t.isDark(n+s,r+h)){a++}}}if(a>5){i+=3+a-5}}}for(var n=0;n<e-1;n++){for(var r=0;r<e-1;r++){var l=0;if(t.isDark(n,r))l++;if(t.isDark(n+1,r))l++;if(t.isDark(n,r+1))l++;if(t.isDark(n+1,r+1))l++;if(l==0||l==4){i+=3}}}for(var n=0;n<e;n++){for(var r=0;r<e-6;r++){if(t.isDark(n,r)&&!t.isDark(n,r+1)&&t.isDark(n,r+2)&&t.isDark(n,r+3)&&t.isDark(n,r+4)&&!t.isDark(n,r+5)&&t.isDark(n,r+6)){i+=40}}}for(var r=0;r<e;r++){for(var n=0;n<e-6;n++){if(t.isDark(n,r)&&!t.isDark(n+1,r)&&t.isDark(n+2,r)&&t.isDark(n+3,r)&&t.isDark(n+4,r)&&!t.isDark(n+5,r)&&t.isDark(n+6,r)){i+=40}}}var u=0;for(var r=0;r<e;r++){for(var n=0;n<e;n++){if(t.isDark(n,r)){u++}}}var c=Math.abs(100*u/e/e-50)/5;i+=c*10;return i}};var o={glog:function(t){if(t<1){throw new Error("glog("+t+")")}return o.LOG_TABLE[t]},gexp:function(t){while(t<0){t+=255}while(t>=256){t-=255}return o.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var s=0;s<8;s++){o.EXP_TABLE[s]=1<<s}for(var s=8;s<256;s++){o.EXP_TABLE[s]=o.EXP_TABLE[s-4]^o.EXP_TABLE[s-5]^o.EXP_TABLE[s-6]^o.EXP_TABLE[s-8]}for(var s=0;s<255;s++){o.LOG_TABLE[o.EXP_TABLE[s]]=s}function h(t,e){if(t.length==undefined){throw new Error(t.length+"/"+e)}var i=0;while(i<t.length&&t[i]==0){i++}this.num=new Array(t.length-i+e);for(var n=0;n<t.length-i;n++){this.num[n]=t[n+i]}}h.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){var e=new Array(this.getLength()+t.getLength()-1);for(var i=0;i<this.getLength();i++){for(var n=0;n<t.getLength();n++){e[i+n]^=o.gexp(o.glog(this.get(i))+o.glog(t.get(n)))}}return new h(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0){return this}var e=o.glog(this.get(0))-o.glog(t.get(0));var i=new Array(this.getLength());for(var n=0;n<this.getLength();n++){i[n]=this.get(n)}for(var n=0;n<t.getLength();n++){i[n]^=o.gexp(o.glog(t.get(n))+e)}return new h(i,0).mod(t)}};function l(t,e){this.totalCount=t;this.dataCount=e}l.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];l.getRSBlocks=function(t,e){var i=l.getRsBlockTable(t,e);if(i==undefined){throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e)}var n=i.length/3;var r=[];for(var a=0;a<n;a++){var o=i[a*3+0];var s=i[a*3+1];var h=i[a*3+2];for(var u=0;u<o;u++){r.push(new l(s,h))}}return r};l.getRsBlockTable=function(t,e){switch(e){case n.L:return l.RS_BLOCK_TABLE[(t-1)*4+0];case n.M:return l.RS_BLOCK_TABLE[(t-1)*4+1];case n.Q:return l.RS_BLOCK_TABLE[(t-1)*4+2];case n.H:return l.RS_BLOCK_TABLE[(t-1)*4+3];default:return undefined}};function u(){this.buffer=[];this.length=0}u.prototype={get:function(t){var e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)==1},put:function(t,e){for(var i=0;i<e;i++){this.putBit((t>>>e-i-1&1)==1)}},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);if(this.buffer.length<=e){this.buffer.push(0)}if(t){this.buffer[e]|=128>>>this.length%8}this.length++}};var c=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function p(){return typeof CanvasRenderingContext2D!="undefined"}function f(){var t=false;var e=navigator.userAgent;if(/android/i.test(e)){t=true;aMat=e.toString().match(/android ([0-9]\.[0-9])/i);if(aMat&&aMat[1]){t=parseFloat(aMat[1])}}return t}var m=function(){var t=function(t,e){this._el=t;this._htOption=e};t.prototype.draw=function(t){var e=this._htOption;var i=this._el;var n=t.getModuleCount();var r=Math.floor(e.width/n);var a=Math.floor(e.height/n);this.clear();function o(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)if(e.hasOwnProperty(n))i.setAttribute(n,e[n]);return i}var s=o("svg",{viewBox:"0 0 "+String(n)+" "+String(n),width:"100%",height:"100%",fill:e.colorLight});s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");i.appendChild(s);s.appendChild(o("rect",{fill:e.colorDark,width:"1",height:"1",id:"template"}));for(var h=0;h<n;h++){for(var l=0;l<n;l++){if(t.isDark(h,l)){var u=o("use",{x:String(h),y:String(l)});u.setAttributeNS("http://www.w3.org/1999/xlink","href","#template");s.appendChild(u)}}}};t.prototype.clear=function(){while(this._el.hasChildNodes())this._el.removeChild(this._el.lastChild)};return t}();var d=document.documentElement.tagName.toLowerCase()==="svg";var g=d?m:!p()?function(){var t=function(t,e){this._el=t;this._htOption=e};t.prototype.draw=function(t){var e=this._htOption;var i=this._el;var n=t.getModuleCount();var r=Math.floor(e.width/n);var a=Math.floor(e.height/n);var o=['<table style="border:0;border-collapse:collapse;">'];for(var s=0;s<n;s++){o.push("<tr>");for(var h=0;h<n;h++){o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+r+"px;height:"+a+"px;background-color:"+(t.isDark(s,h)?e.colorDark:e.colorLight)+';"></td>')}o.push("</tr>")}o.push("</table>");i.innerHTML=o.join("");var l=i.childNodes[0];var u=(e.width-l.offsetWidth)/2;var c=(e.height-l.offsetHeight)/2;if(u>0&&c>0){l.style.margin=c+"px "+u+"px"}};t.prototype.clear=function(){this._el.innerHTML=""};return t}():function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png");this._elImage.style.display="block";this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio;var i=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,n,r,a,o,s,h,l,u){if("nodeName"in t&&/img/i.test(t.nodeName)){for(var c=arguments.length-1;c>=1;c--){arguments[c]=arguments[c]*e}}else if(typeof l=="undefined"){arguments[1]*=e;arguments[2]*=e;arguments[3]*=e;arguments[4]*=e}i.apply(this,arguments)}}function n(t,e){var i=this;i._fFail=e;i._fSuccess=t;if(i._bSupportDataURI===null){var n=document.createElement("img");var r=function(){i._bSupportDataURI=false;if(i._fFail){_fFail.call(i)}};var a=function(){i._bSupportDataURI=true;if(i._fSuccess){i._fSuccess.call(i)}};n.onabort=r;n.onerror=r;n.onload=a;n.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";return}else if(i._bSupportDataURI===true&&i._fSuccess){i._fSuccess.call(i)}else if(i._bSupportDataURI===false&&i._fFail){i._fFail.call(i)}}var r=function(t,e){this._bIsPainted=false;this._android=f();this._htOption=e;this._elCanvas=document.createElement("canvas");this._elCanvas.width=e.width;this._elCanvas.height=e.height;t.appendChild(this._elCanvas);this._el=t;this._oContext=this._elCanvas.getContext("2d");this._bIsPainted=false;this._elImage=document.createElement("img");this._elImage.alt="Scan me!";this._elImage.style.display="none";this._el.appendChild(this._elImage);this._bSupportDataURI=null};r.prototype.draw=function(t){var e=this._elImage;var i=this._oContext;var n=this._htOption;var r=t.getModuleCount();var a=n.width/r;var o=n.height/r;var s=Math.round(a);var h=Math.round(o);e.style.display="none";this.clear();for(var l=0;l<r;l++){for(var u=0;u<r;u++){var c=t.isDark(l,u);var p=u*a;var f=l*o;i.strokeStyle=c?n.colorDark:n.colorLight;i.lineWidth=1;i.fillStyle=c?n.colorDark:n.colorLight;i.fillRect(p,f,a,o);i.strokeRect(Math.floor(p)+.5,Math.floor(f)+.5,s,h);i.strokeRect(Math.ceil(p)-.5,Math.ceil(f)-.5,s,h)}}this._bIsPainted=true};r.prototype.makeImage=function(){if(this._bIsPainted){n.call(this,t)}};r.prototype.isPainted=function(){return this._bIsPainted};r.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height);this._bIsPainted=false};r.prototype.round=function(t){if(!t){return t}return Math.floor(t*1e3)/1e3};return r}();function y(t,e){var i=1;var r=v(t);for(var a=0,o=c.length;a<=o;a++){var s=0;switch(e){case n.L:s=c[a][0];break;case n.M:s=c[a][1];break;case n.Q:s=c[a][2];break;case n.H:s=c[a][3];break}if(r<=s){break}else{i++}}if(i>c.length){throw new Error("Too long data")}return i}function v(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}QRCode=function(t,e){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H};if(typeof e==="string"){e={text:e}}if(e){for(var i in e){this._htOption[i]=e[i]}}if(typeof t=="string"){t=document.getElementById(t)}if(!t){t=document.createElement("div")}this._android=f();this._el=t;this._oQRCode=null;this._oDrawing=new g(this._el,this._htOption);if(this._htOption.text){this.makeCode(this._htOption.text)}};QRCode.prototype.makeCode=function(t){this._oQRCode=new e(y(t,this._htOption.correctLevel),this._htOption.correctLevel);this._oQRCode.addData(t);this._oQRCode.make();this._el.title=t;this._oDrawing.draw(this._oQRCode);this.makeImage()};QRCode.prototype.getImageSrc=function(){return this._oDrawing._elCanvas.toDataURL("image/png")};QRCode.makeImageDataURL=function(t,e,i){var n=new QRCode(null,{text:t,width:e,height:i});var r=n.getImageSrc();n._oDrawing._elImage=null;n._oDrawing._elCanvas=null;n._oDrawing=null;n=null;return r};QRCode.prototype.makeImage=function(){if(typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)){this._oDrawing.makeImage()}};QRCode.prototype.clear=function(){this._oDrawing.clear()};QRCode.CorrectLevel=n;window.QRCode=QRCode})();function AppBase(t,e){this.win=null;this.view=null;this.type=e;this.minHeight=0;AppBase.type=e;this.getView=function(){return this.view};this.setMinHeight=function(t){this.minHeight=t;return};this.exec=function(t){t.doit();delete t;return};this.init=function(){if(this.type===AppBase.TYPE_INLINE_EDITOR){this.isInlineEdit=true}else{this.isInlineEdit=false}this.canvas=CantkRT.getMainCanvas();this.adjustCanvasSize();this.manager=WWindowManager.create(this,this.canvas);canvasAttachManager(this.canvas,this.manager,this);return};this.onShapeSelected=function(t){return};this.onSizeChanged=function(){return};this.adjustCanvasSize=function(){var t=0;var e=0;var i=this.canvas;var n=cantkGetViewPort();switch(this.type){case AppBase.TYPE_GENERAL:{t=n.width;e=n.height}case AppBase.TYPE_WEBAPP:{t=n.width;e=n.height;break}case AppBase.TYPE_PREVIEW:{t=n.width;e=n.height;this.setMinHeight(1500);break}default:{if(!this.minHeight){this.setMinHeight(800)}t=n.width-20;e=n.height;break}}e=Math.max(e,this.minHeight);this.resizeCanvasTo(t,e);return};this.resizeCanvasTo=function(t,e){var i=this.canvas;i.width=t;i.height=e;i.style.top=0;i.style.left=0;i.style.position="absolute";return};this.loadData=function(t){return this.view.loadFromJson(t)};this.exitApp=function(){console.log("exitApp");return};this.init();return this}AppBase.isDevApp=function(){return AppBase.type===AppBase.TYPE_PC_EDITOR||AppBase.type===AppBase.TYPE_MOBILE_EDITOR||AppBase.type===AppBase.TYPE_INLINE_EDITOR};AppBase.TYPE_GENERAL=0;AppBase.TYPE_WEBAPP=1;AppBase.TYPE_PREVIEW=2;AppBase.TYPE_PC_VIEWER=3;AppBase.TYPE_PC_EDITOR=4;AppBase.TYPE_MOBILE_EDITOR=5;AppBase.TYPE_INLINE_EDITOR=6;function WImage(t){if(t){this.setImageSrc(t)}return}WImage.caches={};WImage.nullImage=new Image;WImage.onload=function(){};WImage.prototype.initFromJson=function(t,e,i){var n=t.indexOf("#");var r=t.substr(0,n);var a=t.substr(n+1);var o=dirname(r);var s=e.file?e.file:e.meta.image;var h=o+"/"+s;var l=e.frames[a];if(!l){console.log("not found src: "+t);return}var u=l.frame||l;if(!u){alert("Invalid src: "+t);return}this.rotated=l.rotated;if(l.trimmed){u.trimmed=true;u.ox=l.spriteSourceSize.x;u.oy=l.spriteSourceSize.y;u.rw=l.sourceSize.w;u.rh=l.sourceSize.h}else{u.trimmed=false;u.ox=0;u.oy=0;u.rw=0;u.rh=0}var c=this;this.rect=u;WImage.onload();ResLoader.loadImage(h,function(t){c.image=t;if(i){i(t)}});return};WImage.prototype.initFromRowColIndex=function(t,e,i){var n=this;var r=parseInt(e[1]);var a=parseInt(e[2]);var o=parseInt(e[3]);e=null;this.image=ResLoader.loadImage(t,function(t){var e=Math.round(t.width/a);var s=Math.round(t.height/r);var h=Math.floor(t.width/a);var l=Math.floor(t.height/r);var u=o%a;var c=Math.floor(o/a);n.rect={};n.rect.x=u*e;n.rect.y=c*s;n.rect.w=h;n.rect.h=l;n.image=t;if(i){i(t)}WImage.onload()});return};WImage.prototype.initFromXYWH=function(t,e,i){var n=this;var r=parseInt(e[1]);var a=parseInt(e[2]);var o=parseInt(e[3]);var s=parseInt(e[4]);e=null;
this.image=ResLoader.loadImage(t,function(t){n.rect={};n.rect.x=r;n.rect.y=a;n.rect.w=o;n.rect.h=s;n.image=t;if(i){i(t)}WImage.onload()});return};WImage.prototype.setImage=function(t){this.image=t;return this};WImage.prototype.setImageSrc=function(t,e){if(!t){this.src=t;this.image=WImage.nullImage;return}if(t.indexOf("data:")===0){this.src=t;this.rect=null;this.image=CantkRT.createImage(t,e);return}t=ResLoader.toAbsURL(t);this.src=t;WImage.caches[t]=this;var i=this;var n=t.indexOf("#");if(n>0){var r=t.substr(n+1);var a=r.match(/r([0-9]+)c([0-9]+)i([0-9]+)/i);var o=r.match(/x([0-9]+)y([0-9]+)w([0-9]+)h([0-9]+)/i);if(!a&&!o){var s=t.substr(0,n);ResLoader.loadJson(s,function(n){i.initFromJson(t,n,e)})}else{t=t.substr(0,n);if(a){this.initFromRowColIndex(t,a,e)}if(o){this.initFromXYWH(t,o,e)}a=null;o=null}}else{this.image=ResLoader.loadImage(t,function(t){i.rect={};i.rect.x=0;i.rect.y=0;i.rect.w=t.width;i.rect.h=t.height;i.image=t;if(e){e(t)}WImage.onload()})}return};WImage.prototype.getImageRect=function(){if(!this.rect){this.rect={x:0,y:0,w:0,h:0}}if(!this.rect.w&&this.image){this.rect.w=this.image.width;this.rect.h=this.image.height}return this.rect};WImage.prototype.getImageSrc=function(){return this.src};WImage.prototype.getRealImageSrc=function(){return this.image?this.image.src:this.src};WImage.prototype.getImage=function(){var t=this.image;return t&&t.width>0?t:null};WImage.isValid=function(t){return t&&t.image&&t.image.width&&t.image.height};WImage.create=function(t,e){var i=WImage.caches[t];if(i){if(e){e(i.getImage())}}else{i=new WImage;i.setImageSrc(t,e)}return i};WImage.createWithImage=function(t){var e=new WImage;e.setImage(t);return e};function cantkSetOnImageLoad(t){if(t){WImage.onload=t}return}WImage.DISPLAY_CENTER=0;WImage.DISPLAY_TILE=1;WImage.DISPLAY_9PATCH=2;WImage.DISPLAY_SCALE=3;WImage.DISPLAY_AUTO=4;WImage.DISPLAY_DEFAULT=5;WImage.DISPLAY_SCALE_KEEP_RATIO=6;WImage.DISPLAY_TILE_V=7;WImage.DISPLAY_TILE_H=8;WImage.DISPLAY_AUTO_SIZE_DOWN=9;WImage.DISPLAY_FIT_WIDTH=10;WImage.DISPLAY_FIT_HEIGHT=11;WImage.prototype.draw=function(t,e,i,n,r,a){var o=this.getImage();var s=this.getImageRect();return WImage.draw(t,o,e,i,n,r,a,s)};WImage.draw=function(t,e,i,n,r,a,o,s){if(!e)return;if(!s){s={};s.x=0;s.y=0;s.w=e.width;s.h=e.height}if(!s.ox){s.ox=0}if(!s.oy){s.oy=0}if(!s.rw){s.rw=s.w}if(!s.rh){s.rh=s.h}var h=s.rw;var l=s.rh;if(h<=0||l<=0){return}var u=0;var c=0;var p=s.w;var f=s.h;var m=s.x;var d=s.y;var g=s.ox;var y=s.oy;if(s.trimmed){g=s.ox;y=s.oy}switch(i){case WImage.DISPLAY_CENTER:{u=Math.floor(n+(a-h>>1))+g;c=Math.floor(r+(o-l>>1))+y;t.drawImage(e,m,d,p,f,u,c,p,f);break}case WImage.DISPLAY_AUTO_SIZE_DOWN:{var v=Math.min(Math.min(a/h,o/l),1);var _=h*v;var I=l*v;u=a-_>>1;c=o-I>>1;u+=Math.round(g*v);c+=Math.round(y*v);a=Math.round(p*v);o=Math.round(f*v);t.drawImage(e,m,d,p,f,u,c,a,o);break}case WImage.DISPLAY_SCALE:{var w=a/h;var x=o/l;u=Math.round(n+g*w);c=Math.round(r+y*x);a=Math.round(p*w);o=Math.round(f*x);t.drawImage(e,m,d,p,f,u,c,a,o);break}case WImage.DISPLAY_AUTO:{var v=Math.min(a/h,o/l);var _=Math.round(h*v);var I=Math.round(l*v);u=n+(a-_>>1);c=r+(o-I>>1);u+=Math.round(g*v);c+=Math.round(y*v);a=Math.round(p*v);o=Math.round(f*v);t.drawImage(e,m,d,p,f,u,c,a,o);break}case WImage.DISPLAY_9PATCH:{u=n+g;c=r+y;a-=h-p;o-=l-f;if(h>=a&&l>=o){t.drawImage(e,m,d,p,f,u,c,a,o)}else{drawNinePatchEx(t,e,m,d,p,f,u,c,a,o)}break}case WImage.DISPLAY_SCALE_KEEP_RATIO:{var v=Math.max(a/h,o/l);u=Math.round(n+g*v);c=Math.round(r+y*v);a=Math.round(p*v);o=Math.round(f*v);t.drawImage(e,m,d,p,f,u,c,a,o);break}case WImage.DISPLAY_TILE:{u=n;c=r;h=p;l=f;var S=n+a;var C=r+o;while(c<C){u=n;f=Math.min(C-c,l);while(u<S){p=Math.min(S-u,h);t.drawImage(e,m,d,p,f,u,c,p,f);u=u+p}c=c+f}break}case WImage.DISPLAY_TILE_H:{var S=n+a;u=n;h=p;l=f;f=Math.min(o,l);while(u<S){p=Math.min(S-u,h);t.drawImage(e,m,d,p,f,u,r,p,f);u=u+p}break}case WImage.DISPLAY_TILE_V:{var C=r+o;c=r;h=p;l=f;p=Math.min(a,h);while(c<C){f=Math.min(C-c,l);t.drawImage(e,m,d,p,f,n,c,p,f);c=c+f}break}case WImage.DISPLAY_FIT_WIDTH:{var v=a/h;u=Math.round(n+g*v);c=Math.round(r+y*v);a=Math.round(p*v);o=Math.round(f*v);t.drawImage(e,m,d,p,f,u,c,a,o);break}case WImage.DISPLAY_FIT_HEIGHT:{var v=o/l;u=Math.round(n+g*v);c=Math.round(r+y*v);a=Math.round(p*v);o=Math.round(f*v);t.drawImage(e,m,d,p,f,u,c,a,o);break}default:{u=n+g;c=r+y;t.drawImage(e,m,d,p,f,u,c,p,f);break}}return};function WWidget(){}WWidget.STATE_NORMAL="state-normal";WWidget.STATE_ACTIVE="state-active";WWidget.STATE_OVER="state-over";WWidget.STATE_DISABLE="state-disable";WWidget.STATE_DISABLE_SELECTED="state-disable-selected";WWidget.STATE_SELECTED="state-selected";WWidget.STATE_NORMAL_CURRENT="state-normal-current";WWidget.TYPE_NONE=0;WWidget.TYPE_USER=13;WWidget.TYPE_FRAME="frame";WWidget.TYPE_FRAMES="frames";WWidget.TYPE_TOOLBAR="toolbar";WWidget.TYPE_TITLEBAR="titlebar";WWidget.TYPE_MINIMIZE_BUTTON="button.minimize";WWidget.TYPE_FLOAT_MENU_BAR="float-menubar";WWidget.TYPE_POPUP="popup";WWidget.TYPE_DIALOG="dialog";WWidget.TYPE_WINDOW="window";WWidget.TYPE_VBOX="vbox";WWidget.TYPE_HBOX="hbox";WWidget.TYPE_MENU="menu";WWidget.TYPE_MENU_BAR="menu-bar";WWidget.TYPE_MENU_BUTTON="menubar.button";WWidget.TYPE_GRID_ITEM="grid-item";WWidget.TYPE_MENU_ITEM="menu.item";WWidget.TYPE_MENU_BAR_ITEM="menubar.item";WWidget.TYPE_CONTEXT_MENU_ITEM="contextmenu.item";WWidget.TYPE_CONTEXT_MENU_BAR="contextmenu-bar";WWidget.TYPE_VSCROLL_BAR="vscroll-bar";WWidget.TYPE_HSCROLL_BAR="hscroll-bar";WWidget.TYPE_SCROLL_VIEW="scroll-view";WWidget.TYPE_GRID_VIEW="grid-view";WWidget.TYPE_LIST_VIEW="list-view";WWidget.TYPE_LIST_ITEM="list-item";WWidget.TYPE_IMAGE_VIEW="image-view";WWidget.TYPE_TREE_VIEW="tree-view";WWidget.TYPE_TREE_ITEM="tree-item";WWidget.TYPE_ACCORDION="accordion";WWidget.TYPE_ACCORDION_ITEM="accordion-item";WWidget.TYPE_PROPERTY_TITLE="property-title";WWidget.TYPE_PROPERTY_SHEET="property-sheet";WWidget.TYPE_PROPERTY_SHEETS="property-sheets";WWidget.TYPE_VIEW_BASE="view-base";WWidget.TYPE_COMPONENT_MENU_ITEM="menuitem.component";WWidget.TYPE_WINDOW_MENU_ITEM="menuitem.window";WWidget.TYPE_MESSAGE_BOX="messagebox";WWidget.TYPE_ICON_TEXT="icon-text";WWidget.TYPE_BUTTON="button";WWidget.TYPE_LABEL="label";WWidget.TYPE_LINK="link";WWidget.TYPE_EDIT="edit";WWidget.TYPE_TEXT_AREA="text-area";WWidget.TYPE_COMBOBOX="combobox";WWidget.TYPE_SLIDER="slider";WWidget.TYPE_PROGRESSBAR="progressbar";WWidget.TYPE_RADIO_BUTTON="radio-button";WWidget.TYPE_CHECK_BUTTON="check-button";WWidget.TYPE_COLOR_BUTTON="color-button";WWidget.TYPE_COLOR_TILE="color-tile";WWidget.TYPE_TAB_BUTTON="tab-button";WWidget.TYPE_TAB_CONTROL="tab-control";WWidget.TYPE_TAB_BUTTON_GROUP="tab-button-group";WWidget.TYPE_TIPS="tips";WWidget.TYPE_HLAYOUT="h-layout";WWidget.TYPE_VLAYOUT="v-layout";WWidget.TYPE_BUTTON_GROUP="button-group";WWidget.TYPE_COMBOBOX_POUP="combobox-popup";WWidget.TYPE_COMBOBOX_POUP_ITEM="combobox-popup-item";WWidget.TYPE_COLOR_EDIT="color-edit";WWidget.TYPE_RANGE_EDIT="range-edit";WWidget.TYPE_FILENAME_EDIT="filename-edit";WWidget.TYPE_FILENAMES_EDIT="filenames-edit";WWidget.TYPE_CANVAS_IMAGE="canvas-image";WWidget.TYPE_ICON_BUTTON="icon-button";WWidget.BORDER_STYLE_NONE=0;WWidget.BORDER_STYLE_LEFT=1;WWidget.BORDER_STYLE_RIGHT=2;WWidget.BORDER_STYLE_TOP=4;WWidget.BORDER_STYLE_BOTTOM=8;WWidget.BORDER_STYLE_ALL=65535;WWidget.prototype={};WWidget.prototype.init=function(t,e,i,n,r){this.text="";this.tag=null;this.tips=null;this.enable=true;this.visible=true;this.parent=t;this.checkEnable=null;this.children=[];this.point={x:0,y:0};this.rect={x:e,y:i,w:n,h:r};this.setState(WWidget.STATE_NORMAL);this.imageDiplay=WImage.DISPLAY_9PATCH;this.borderStyle=WWidget.BORDER_STYLE_ALL;if(this.parent!==null){var a=t.border?t.border:0;var o=t.rect.w-2*a;var s=t.rect.h-2*a;if(e>0&&e<1){this.rect.x=o*e+a}if(n>0&&n<=1){this.rect.w=o*n}if(i>0&&i<1){this.rect.y=s*i+a}if(r>0&&r<=1){this.rect.h=s*r}t.appendChild(this)}return this};WWidget.prototype.useTheme=function(t){this.themeType=t;return this};WWidget.prototype.setSelectable=function(t){this.selectable=t;return true};WWidget.prototype.setNeedRelayout=function(t){this.needRelayout=t;return};WWidget.prototype.onAppendChild=function(t){};WWidget.prototype.appendChild=function(t){t.parent=this;this.children.push(t);this.onAppendChild(t);this.needRelayout=true;return};WWidget.prototype.getWindowManager=function(){return WWindowManager.getInstance()};WWidget.prototype.getFrameRate=function(){return WWindowManager.getInstance().getFrameRate()};WWidget.prototype.showFPS=function(t){return WWindowManager.getInstance().showFPS(t)};WWidget.prototype.isPointerDown=function(){return WWindowManager.getInstance().isPointerDown()};WWidget.prototype.isClicked=function(){return WWindowManager.getInstance().isClicked()};WWidget.prototype.isAltDown=function(){return WWindowManager.getInstance().isAltDown()};WWidget.prototype.isCtrlDown=function(){return WWindowManager.getInstance().isCtrlDown()};WWidget.prototype.getApp=function(){return WWindowManager.getInstance().getApp()};WWidget.prototype.getCanvas2D=function(){return WWindowManager.getInstance().getCanvas2D()};WWidget.prototype.getCanvas=function(){return WWindowManager.getInstance().getCanvas()};WWidget.prototype.getLastPointerPoint=function(){return WWindowManager.getInstance().getLastPointerPoint()};WWidget.prototype.getTopWindow=function(){return this.getWindow()};WWidget.prototype.getWindow=function(){if(this.parent){return this.parent.getWindow()}return this};WWidget.prototype.getParent=function(){return this.parent};WWidget.prototype.getX=function(){return this.rect.x};WWidget.prototype.getY=function(){return this.rect.y};WWidget.prototype.getWidth=function(){return this.rect.w};WWidget.prototype.getHeight=function(){return this.rect.h};WWidget.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.getParent();while(n!=null){t+=n.getX();e+=n.getY();if(n.isScrollView){t=t-n.xOffset;e=e-n.yOffset}n=n.getParent()}i.x=t;i.y=e;return i};WWidget.prototype.getAbsPosition=function(){var t=this.rect.x;var e=this.rect.y;for(var i=this.parent;i;i=i.parent){t=t+i.rect.x;e=e+i.rect.y}return{x:t,y:e}};WWidget.prototype.translatePoint=function(t){var e=this.getAbsPosition();return{x:t.x-e.x,y:t.y-e.y}};WWidget.prototype.postRedrawAll=function(){WWindowManager.getInstance().postRedraw(null);return};WWidget.prototype.postRedraw=function(t){WWindowManager.getInstance().postRedraw(null);return};WWidget.prototype.redraw=function(t){var e=this.getAbsPosition();if(!t){t={x:0,y:0,w:this.rect.w,h:this.rect.h}}t.x=e.x+t.x;t.y=e.y+t.y;WWindowManager.getInstance().redraw(t);return};WWidget.prototype.isPointIn=function(t){return isPointInRect(t,this.rect)};WWidget.prototype.findTargetWidgetEx=function(t,e){if(!this.visible||!this.isPointIn(t)){return null}if(e&&this.children.length>0){var i=this.children.length-1;var n=this.point;n.x=t.x-this.rect.x;n.y=t.y-this.rect.y;for(var r=i;r>=0;r--){var a=this.children[r];var o=a.findTargetWidget(n);if(o!==null){return o}}}return this};WWidget.prototype.findTargetWidget=function(t){return this.findTargetWidgetEx(t,true)};WWidget.widgetsPool={};WWidget.getWidget=function(t){var e=WWidget.widgetsPool[t];if(e&&e.length){return e.pop()}return null};WWidget.putWidget=function(t){if(t){var e=t.type;var i=WWidget.widgetsPool[e];if(!i){WWidget.widgetsPool[e]=[];i=WWidget.widgetsPool[e]}t.themeType=null;t.userData=null;t.handleGesture=null;t.handleClicked=null;t.handleLongPressed=null;t.handleDoubleClicked=null;t.handleContextMenu=null;t.handleKeyUp=null;t.handleKeyDown=null;t.handleWheel=null;t.onChanged=null;t.onChanging=null;t.clickHandler=null;t.stateChangedHandler=null;if(t.onBeforePaint){t.onBeforePaint=null}if(t.onAfterPaint){t.onAfterPaint=null}if(t.onGetText){t.onGetText=null}i.push(t)}return};WWidget.prototype.onRemoved=function(){};WWidget.prototype.removeChild=function(t){t.remove();return this};WWidget.prototype.remove=function(){var t=this.parent;if(t){t.children.remove(this);if(t.target===this){t.target=null}this.parent=null;this.onRemoved();t.setNeedRelayout(true)}return this};WWidget.prototype.cleanUp=function(){};WWidget.prototype.destroy=function(){if(this.children.length){this.destroyChildren()}this.remove();this.cleanUp();WWidget.putWidget(this);return};WWidget.prototype.destroyChildren=function(){var t=this.children.length;for(var e=0;e<t;e++){var i=this.children[0];i.destroy()}this.target=null;this.children.length=[];this.setNeedRelayout(true);return};WWidget.prototype.forEachChild=function(t){var e=this.children.length;for(var i=0;i<e;i++){var n=this.children[i];t(n)}return};WWidget.prototype.setTextOf=function(t,e,i){var n=this.lookup(t,true);if(n){n.setText(e,i)}else{console.log("not found "+t)}return n};WWidget.prototype.setValueOf=function(t,e,i){var n=this.lookup(t,true);if(n){n.setValue(e,i)}else{console.log("not found "+t)}return n};WWidget.prototype.setVisibleOf=function(t,e){var i=this.lookup(t,true);if(i){i.setVisible(e)}else{console.log("not found "+t)}return i};WWidget.prototype.setValue=function(t){return this.setText(t)};WWidget.prototype.getValue=function(){return this.getText()};WWidget.prototype.setText=function(t){this.text=t||t===0?t.toString():"";this.setNeedRelayout(true);return this};WWidget.prototype.getText=function(){if(this.onGetText){return this.onGetText()}return this.text};WWidget.prototype.setTips=function(t){this.tips=t;return this};WWidget.prototype.getTips=function(){return this.tips};WWidget.prototype.setInputTips=function(t){this.inputTips=t;return this};WWidget.prototype.getInputTips=function(){return this.inputTips};WWidget.prototype.drawInputTips=function(t){var e=this.rect.h;var i=this.rect.w;var n=this.rect.h>>1;var r=this.leftMargin||2;var a=this.getText();var o=this.getInputTips();if(a||!o||this.type!==WWidget.TYPE_EDIT||this.editing){return}var s=this.getStyle();t.save();t.font=s.font;t.fillStyle="#E0E0E0";t.beginPath();t.rect(0,0,i-r,e);t.clip();t.textAlign="left";t.textBaseline="middle";t.fillText(o,r,n);t.restore();return};WWidget.prototype.drawTips=function(t){var e=this.getTips();if(e){var i=this.getStyle();var n=this.rect.w>>1;var r=this.rect.h>>1;t.textAlign="center";t.textBaseline="middle";t.font=i.font?i.font:"10pt bold sans-serif";t.fillStyle=i.textColor?i.textColor:"Black";t.fillText(e,n,r)}return this};WWidget.prototype.setID=function(t){this.id=t;return this};WWidget.prototype.getID=function(){return this.id};WWidget.prototype.setName=function(t){this.name=t;return this};WWidget.prototype.getName=function(){return this.name};WWidget.prototype.setTag=function(t){this.tag=t;return this};WWidget.prototype.getTag=function(){return this.tag};WWidget.prototype.setUserData=function(t){this.userData=t;return this};WWidget.prototype.getUserData=function(){return this.userData};WWidget.prototype.setEnable=function(t){this.enable=t;return this};WWidget.prototype.onStateChanged=function(t){if(this.stateChangedHandler){this.stateChangedHandler(t)}return this};WWidget.prototype.setState=function(t){if(this.state!==t){this.state=t;this.onStateChanged(t);if(t===WWidget.STATE_OVER){WWindowManager.getInstance().setTipsWidget(this)}}return this};WWidget.prototype.measure=function(t){return};WWidget.prototype.onMoved=function(){};WWidget.prototype.move=function(t,e){this.rect.x=t;this.rect.y=e;this.onMoved();return this};WWidget.prototype.moveToCenter=function(t,e){var i=this.parent.rect.w;var n=this.parent.rect.h;if(t){this.rect.x=i-this.rect.w>>1}if(e){this.rect.y=n-this.rect.h>>1}return this};WWidget.prototype.moveToBottom=function(t){var e=this.parent.rect.h;this.rect.y=e-this.rect.h-t;return this};WWidget.prototype.moveDelta=function(t,e){this.rect.x=this.rect.x+t;this.rect.y=this.rect.y+e;this.onMoved();return this};WWidget.prototype.onSized=function(t,e){};WWidget.prototype.resize=function(t,e){this.rect.w=t;this.rect.h=e;this.onSized();this.setNeedRelayout(true);return this};WWidget.prototype.setStateChangedHandler=function(t){this.stateChangedHandler=t;return this};WWidget.prototype.setClickedHandler=function(t){this.clickHandler=t;return this};WWidget.prototype.setKeyDoneHandler=function(t){this.handleKeyDown=t;return this};WWidget.prototype.setKeyUpHandler=function(t){this.handleKeyUp=t;return this};WWidget.prototype.onClicked=function(t){if(this.handleClicked){this.handleClicked(t)}if(this.clickHandler){this.clickHandler(this,t)}this.postRedraw();return this.clickHandler!=null};WWidget.prototype.lookup=function(t,e){var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(r.id===t){return r}}if(e){for(var n=0;n<i;n++){var r=this.children[n];var a=r.lookup(t,e);if(a){return a}}}return null};WWidget.prototype.relayout=function(t,e){return this};WWidget.prototype.setLineWidth=function(t){this.lineWidth=t;return this};WWidget.prototype.getLineWidth=function(t){return this.lineWidth?this.lineWidth:t.lineWidth};WWidget.prototype.setRoundRadius=function(t){this.roundRadius=t;return this};WWidget.prototype.ensureTheme=function(){if(this.themeType){this.theme=WThemeManager.get(this.themeType)}else{this.theme=WThemeManager.get(this.type)}return this};WWidget.prototype.getStyle=function(t){var e=null;this.ensureTheme();var i=t?t:this.state;if(this.enable){e=this.theme[i]}else{if(i===WWidget.STATE_SELECTED){e=this.theme[WWidget.STATE_DISABLE_SELECTED]}if(!e){e=this.theme[WWidget.STATE_DISABLE]}}if(!e){e=this.theme[WWidget.STATE_NORMAL]}return e};WWidget.prototype.setImageDisplay=function(t){this.imageDiplay=t;return this};WWidget.prototype.setBorderStyle=function(t){this.borderStyle=t;return this};WWidget.prototype.paintBackground=function(t){var e=this.rect;var i=this.getStyle();if(!i)return;if(i.bgImage){var n=i.bgImage.getImage();var r=i.bgImage.getImageRect();if(n){i.bgImage.draw(t,this.imageDiplay,0,0,e.w,e.h,r)}}else{t.beginPath();if(this.roundRadius){drawRoundRect(t,e.w,e.h,this.roundRadius)}else{t.rect(0,0,e.w,e.h)}if(i.fillColor){t.fillStyle=i.fillColor;t.fill()}var a=this.getLineWidth(i);if(!a||!i.lineColor||this.borderStyle===WWidget.BORDER_STYLE_NONE){}else{var o=function(e,i){t.moveTo(e.x,e.y);t.lineTo(i.x,i.y)};t.beginPath();if(this.borderStyle&WWidget.BORDER_STYLE_LEFT){if(a===1){t.translate(.5,0)}o({x:0,y:0},{x:0,y:e.h})}if(this.borderStyle&WWidget.BORDER_STYLE_RIGHT){if(a===1){t.translate(-.5,0)}o({x:e.w,y:0},{x:e.w,y:e.h})}if(this.borderStyle&WWidget.BORDER_STYLE_TOP){if(a===1){t.translate(0,.5)}o({x:0,y:0},{x:e.w,y:0})}if(this.borderStyle&WWidget.BORDER_STYLE_BOTTOM){if(a===1){t.translate(0,-.5)}o({x:0,y:e.h},{x:e.w,y:e.h})}t.lineWidth=a;t.strokeStyle=i.lineColor;t.stroke()}t.beginPath()}return};WWidget.prototype.paintSelf=function(t){return this};WWidget.prototype.beforePaint=function(t){if(this.onBeforePaint){this.onBeforePaint(t)}return this};WWidget.prototype.afterPaint=function(t){if(this.onAfterPaint){this.onAfterPaint(t)}return this};WWidget.prototype.setPaintFocusLater=function(t){this.paintFocusLater=t;return this};WWidget.prototype.paintChildren=function(t){if(this.paintFocusLater){this.paintChildrenFocusLater(t)}else{this.paintChildrenDefault(t)}return this};WWidget.prototype.paintChildrenDefault=function(t){var e=this.children.length;for(var i=0;i<e;i++){var n=this.children[i];n.draw(t)}return};WWidget.prototype.paintChildrenFocusLater=function(t){var e=null;var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(r.state===WWidget.STATE_OVER){e=r}else{r.draw(t)}}if(e){e.draw(t)}return};WWidget.prototype.ensureImages=function(){return};WWidget.prototype.draw=function(t){if(!this.visible){return}if(this.checkEnable){this.setEnable(this.checkEnable())}this.ensureImages();t.save();this.relayout(t,false);t.translate(this.rect.x,this.rect.y);this.beforePaint(t);this.paintBackground(t);this.paintSelf(t);this.paintChildren(t);this.drawInputTips(t);this.afterPaint(t);t.closePath();t.restore();return};WWidget.prototype.setVisible=function(t){this.visible=t;return this};WWidget.prototype.isVisible=function(){return this.visible};WWidget.prototype.onShow=function(t){return true};WWidget.prototype.show=function(t){var t=!!t;if(t!=this.visible){this.visible=t;this.onShow(t)}return this};WWidget.prototype.showAll=function(t){var e=this.children.length;this.show(t);for(var i=0;i<e;i++){var n=this.children[i];n.showAll(t)}if(!this.parent){this.postRedraw()}return this};WWidget.prototype.selectAllChildren=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.checkable){i.setChecked(t)}}return this};WWidget.prototype.closeWindow=function(t){this.getWindow().close(t);return this};WWidget.prototype.findTarget=function(t){var e=this.getAbsPosition();this.point.x=t.x-e.x;this.point.y=t.y-e.y;var i=this.children.length;if(i>0){for(var n=i-1;n>=0;n--){var r=this.children[n];if(!r.visible){continue}if(isPointInRect(this.point,r.rect)){return r}}}return null};WWidget.prototype.onPointerDown=function(t){if(!this.enable)return false;var e=this.findTarget(t);if(this.target){if(this.target!==e){this.target.setState(WWidget.STATE_NORMAL)}}if(e){e.setState(WWidget.STATE_ACTIVE);e.onPointerDown(t)}else{if(this.state!==WWidget.STATE_DISABLE){this.setState(WWidget.STATE_ACTIVE)}}this.target=e;return true};WWidget.prototype.onPointerMove=function(t){if(!this.enable)return false;var e=this.findTarget(t);this.pointerOverr=isPointInRect(t,this.rect);if(this.target){if(this.target.state===WWidget.STATE_OVER||this.target.state===WWidget.STATE_ACTIVE){if(this.target!==e){this.target.setState(WWidget.STATE_NORMAL)}}this.target.onPointerMove(t)}if(e){if(this.isPointerDown()){e.setState(WWidget.STATE_ACTIVE)}else{e.setState(WWidget.STATE_OVER)}}if(this.target!==e){this.postRedraw();this.target=e;if(this.target){this.target.onPointerMove(t)}}return true};WWidget.prototype.onPointerUp=function(t){if(this.enable){var e=this.target;if(e){if(e.state!==WWidget.STATE_DISABLE){e.onPointerUp(t)}}if(this.isClicked()){try{this.onClicked(t)}catch(i){console.debug("stack:",i.stack);console.debug("this.onClicked:"+i.message)}}}if(this.selectable){this.setState(WWidget.STATE_SELECTED)}else{this.setState(WWidget.STATE_OVER)}return true};WWidget.prototype.onKeyDown=function(t){if(this.target){this.target.onKeyDown(t)}if(this.handleKeyDown){this.handleKeyDown(t)}console.log("onKeyUp WWidget:"+this.type+" code="+t);return};WWidget.prototype.onKeyUp=function(t){if(this.target){this.target.onKeyUp(t)}if(this.handleKeyUp){this.handleKeyUp(t)}console.log("onKeyUp WWidget:"+this.type+" code="+t);return};WWidget.prototype.onWheel=function(t){if(this.target){return this.target.onWheel(t)}if(this.handleWheel){return this.handleWheel(t)}return false};WWidget.prototype.onDoubleClick=function(t){var e=null;if(this.grabWidget){e=this.grabWidget}else{e=this.findTarget(t)}if(e){e.onDoubleClick(t);this.target=e}if(this.state!==WWidget.STATE_DISABLE&&this.handleDoubleClicked){this.handleDoubleClicked(t)}return};WWidget.prototype.onContextMenu=function(t){var e=this.findTarget(t);if(e){e.onContextMenu(t);this.target=e}if(this.state!==WWidget.STATE_DISABLE&&this.handleContextMenu){this.handleContextMenu(t)}return};WWidget.prototype.onLongPress=function(t){var e=this.findTarget(t);if(e){e.onLongPress(t);this.target=e}if(this.state!==WWidget.STATE_DISABLE&&this.handleLongPressed){this.handleLongPressed(t)}return};WWidget.prototype.onGesture=function(t){var e=this.findTarget(point);if(e){e.onGesture(t)}if(this.state!==WWidget.STATE_DISABLE&&this.handleGesture){this.handleGesture(t)}return};function WThemeManager(){}WThemeManager.newStyle=function(t,e,i,n,r){var a={};if(t){a.font=t}if(r){a.bgImage=r}if(e){a.fillColor=e}if(i){a.textColor=i}if(n){a.lineColor=n}return a};WThemeManager.newTheme=function(){var t={};t[WWidget.STATE_NORMAL]=WThemeManager.newStyle("13pt bold sans-serif ",null,"#000000","#000000");t[WWidget.STATE_ACTIVE]=WThemeManager.newStyle("13pt bold sans-serif ",null,"#000000");t[WWidget.STATE_OVER]=WThemeManager.newStyle("13pt bold sans-serif ",null,"#000000");t[WWidget.STATE_DISABLE]=WThemeManager.newStyle("13pt bold sans-serif ",null,"Gray");t[WWidget.STATE_SELECTED]=WThemeManager.newStyle("13pt bold sans-serif ",null,"Gray");return t};WThemeManager.themes={};WThemeManager.imagesURL=null;WThemeManager.defaultTheme=WThemeManager.newTheme();WThemeManager.themeURL="/ide/images/light/theme.json";WThemeManager.setImagesURL=function(t){WThemeManager.imagesURL=t;return};WThemeManager.getIconImageURL=function(){return WThemeManager.imagesURL};WThemeManager.getBgImageURL=function(){return WThemeManager.imagesURL};WThemeManager.imagesCache={};WThemeManager.getImage=function(t){var e=WThemeManager.imagesCache[t];if(!e){e=new WImage;e.setImageSrc(t)}return e};WThemeManager.getIconImage=function(t){if(!WThemeManager.imagesURL){return null}var e=WThemeManager.imagesURL+"#"+t+".png";return this.getImage(e)};WThemeManager.getBgImage=function(t){if(!WThemeManager.imagesURL){return null}var e=WThemeManager.imagesURL+"#"+t;return this.getImage(e)};WThemeManager.setTheme=function(t){WebStorage.set("wtkTheme",t);location.href=location.href;return};WThemeManager.getThemeURL=function(){var t=getQueryParameter("theme-url");if(t){return t}var e=getQueryParameter("theme");if(e){return"/ide/images/"+e+"/theme.json"}var i=WebStorage.get("wtkTheme");if(i){return"/ide/images/"+i+"/theme.json"}return WThemeManager.themeURL};WThemeManager.loadTheme=function(t,e){var i=dirname(t);var n=i+"/"+(e.imagesURL?e.imagesURL:"images.json");WThemeManager.setImagesURL(n);var r=e.widgets;for(var a in r){var o=r[a];for(var s in o){var h=o[s];if(h.bgImage){h.bgImage=WThemeManager.getBgImage(h.bgImage)}if(h.fgImage){h.fgImage=WThemeManager.getBgImage(h.fgImage)}if(h.bgImageTips){h.bgImageTips=WThemeManager.getBgImage(h.bgImageTips)}if(h.font){h.fontSize=getFontSizeInFont(h.font);if(h.fontSize){h.fontSize=12}}}}WThemeManager.themes=r;WThemeManager.themesLoaded=true;WThemeManager.jqueryTheme=e.jqueryTheme;WThemeManager.codeEditorTheme=e.codeEditorTheme;if(WThemeManager.overrideThemeData){WThemeManager.mergeTheme(WThemeManager.overrideThemeData)}return};WThemeManager.setOverrideThemeData=function(t){if(WThemeManager.themesLoaded){WThemeManager.mergeTheme(t)}else{WThemeManager.overrideThemeData=t}return};WThemeManager.mergeTheme=function(t){for(var e in t){var i=t[e];for(var n in i){var r=i[n];if(r.bgImage){r.bgImage=WThemeManager.getImage(r.bgImage)}if(r.fgImage){r.fgImage=WThemeManager.getImage(r.fgImage)}if(r.bgImageTips){r.bgImageTips=WThemeManager.getImage(r.bgImageTips)}if(r.font){r.fontSize=getFontSizeInFont(r.font);if(r.fontSize){r.fontSize=12}}}WThemeManager.themes[e]=t[e]}return};WThemeManager.getCodeEditorTheme=function(){return WThemeManager.codeEditorTheme};WThemeManager.getJQueryTheme=function(){return WThemeManager.jqueryTheme};WThemeManager.loadThemeURL=function(t){if(!t){t=WThemeManager.getThemeURL()}httpGetJSON(t,function e(i){WThemeManager.loadTheme(t,i);var n=WWindowManager.getInstance();if(n){n.postRedraw()}});return};WThemeManager.exist=function(t){return WThemeManager.themes[t]!=null};WThemeManager.dump=function(){var t=JSON.stringify(WThemeManager.themes,null,"	");console.log(t);return};WThemeManager.get=function(t,e){t=t.toString();var i=WThemeManager.themes[t];if(!i){if(e){WThemeManager.themes[t]=WThemeManager.newTheme();i=WThemeManager.themes[t]}else{i=WThemeManager.defaultTheme}}return i};WThemeManager.set=function(t,e,i,n,r,a,o){if(e===null){WThemeManager.setOneState(t,WWidget.STATE_NORMAL,i,n,r,a,o);WThemeManager.setOneState(t,WWidget.STATE_ACTIVE,i,n,r,a,o);WThemeManager.setOneState(t,WWidget.STATE_OVER,i,n,r,a,o);WThemeManager.setOneState(t,WWidget.STATE_SELECTED,i,n,r,a,o);WThemeManager.setOneState(t,WWidget.STATE_DISABLE,i,n,r,a,o)}else{WThemeManager.setOneState(t,e,i,n,r,a,o)}return};WThemeManager.setOneState=function(t,e,i,n,r,a,o){t=t.toString();var s=WThemeManager.themes[t];if(!s){s=WThemeManager.newTheme();WThemeManager.themes[t]=s}if(i){s[e].font=i}if(n){s[e].textColor=n}if(bgColor){s[e].fillColor=bgColor}if(a){s[e].lineColor=a}if(o){s[e].bgImage=o}return};function WWindow(){}WWindow.prototype=new WWidget;WWindow.prototype.init=function(t,e,i,n,r){this.type=this.type?this.type:WWidget.TYPE_WINDOW;WWidget.prototype.init.call(this,null,e,i,n,r);this.grabWidget=null;this.manager=t?t:WWindowManager.getInstance();var a=this;setTimeout(function(){a.manager.addWindow(a)},0);return this};WWindow.prototype.grab=function(t){this.grabWidget=t;this.manager.grab(this);return this};WWindow.prototype.ungrab=function(){this.grabWidget=null;this.manager.ungrab(this);return this};WWindow.prototype.moveToCenter=function(){var t=cantkGetViewPort();var e=Math.min(this.manager.w,t.width);var i=Math.min(this.manager.h,t.height);var n=(e-this.rect.w)/2;var r=(i-this.rect.h)/2+getScrollTop();this.rect.x=n;this.rect.y=r;return this};WWindow.prototype.onPointerDown=function(t){this.pointerDown=true;if(this.grabWidget){this.grabWidget.onPointerDown(t)}else{WWidget.prototype.onPointerDown.call(this,t)}this.postRedraw();return};WWindow.prototype.onPointerMove=function(t){if(this.grabWidget){this.grabWidget.onPointerMove(t)}else{WWidget.prototype.onPointerMove.call(this,t)}this.postRedraw();return};WWindow.prototype.onPointerUp=function(t){if(!this.pointerDown){return}if(this.grabWidget){this.grabWidget.onPointerUp(t)}else{WWidget.prototype.onPointerUp.call(this,t)}this.pointerDown=false;this.postRedraw();return};WWindow.prototype.onContextMenu=function(t){if(this.grabWidget){this.grabWidget.onContextMenu(t)}else{WWidget.prototype.onContextMenu.call(this,t)}return};WWindow.prototype.onKeyDown=function(t){if(this.grabWidget){this.grabWidget.onKeyDown(t)}else{WWidget.prototype.onKeyDown.call(this,t)}return};WWindow.prototype.onKeyUp=function(t){if(this.grabWidget){this.grabWidget.onKeyUp(t)}else{WWidget.prototype.onKeyUp.call(this,t)}return};WWindow.prototype.beforePaint=function(t){t.beginPath();t.rect(0,0,this.rect.w,this.rect.h);t.clip();t.beginPath();return};WWindow.prototype.show=function(t){WWidget.prototype.show.call(this,t);return this};WWindow.prototype.close=function(t){var e=this;setTimeout(function(){e.closeSync(t)},10);return this};WWindow.prototype.closeSync=function(t){if(this.onClosed){this.onClosed(t)}this.manager.ungrab(this);this.manager.removeWindow(this);this.destroy();return};WWindow.create=function(t,e,i,n,r){var a=new WWindow;this.onClosed=null;return a.init(t,e,i,n,r)};function WViewBase(){}WViewBase.prototype=new WWidget;WViewBase.prototype.init=function(t,e,i,n,r){WWidget.prototype.init.call(this,t,e,i,n,r);this.xscale=1;this.yscale=1;this.allShapes=[];this.autoResize=false;this.pointerDownPosition={x:0,y:0};this.lastPointerPosition={x:0,y:0};this.style=WThemeManager.newStyle("13pt bold sans-serif","White","Black","Black",null);this.md="ma"+"gic"+"Da"+"ta";return this};WViewBase.prototype.getStyle=function(){return this.style};WViewBase.prototype.getScale=function(){return this.xscale};WViewBase.prototype.getViewScale=function(){return this.getScale()};WViewBase.prototype.onShapeSelected=function(t){this.getApp().onShapeSelected(t);return};WViewBase.prototype.setAutoResize=function(){this.autoResize=true;return};WViewBase.prototype.initPage=function(t,e){var i={};i.index=t?t:0;i.shapes=e?e:[];return i};WViewBase.prototype.getPages=function(){return this.pages};WViewBase.prototype.newPage=function(){var t=this.getPageNr();var e=this.currentPage+1;var i=this.initPage(e,null);this.pages.push(i);this.saveCurrentPage();if(t>1){for(var n=t;n>e;n--){this.pages[n]=this.pages[n-1]}this.pages[e]=i}this.currentPage=e;this.showCurrentPage();this.getApp().updateContextMenu();return};WViewBase.prototype.removeCurrentPage=function(){var t=this.getPageNr();if(t>1){this.removePage(this.currentPage)}else{this.allShapes.clear()}this.getApp().updateContextMenu();return};WViewBase.prototype.removePage=function(t){var e=this.getPageNr();if(t<0||t>=e){t=this.currentPage}var i=this.pages[t];if(this.pages.length>1){this.pages.remove(i)}if(t<=this.currentPage&&this.currentPage>=0){
this.currentPage--}this.showCurrentPage();this.getApp().updateContextMenu();return};WViewBase.prototype.saveCurrentPage=function(){var t=new Array;for(var e=0;e<this.allShapes.length;e++){var i=this.allShapes[e];t.push(i.toJson())}this.pages[this.currentPage]=this.initPage(this.currentPage,t);return};WViewBase.prototype.setMetaInfo=function(t){this.meta=t;return};WViewBase.prototype.getMetaInfo=function(){return this.meta};WViewBase.prototype.getAppIcon=function(){return this.meta.general.appIcon};WViewBase.prototype.getAppName=function(){return this.meta.general.appname};WViewBase.prototype.getAppDesc=function(){return this.meta.general.appdesc};WViewBase.prototype.getAppID=function(){return this.meta.general.appID};WViewBase.generateDocID=function(){return Math.round(Math.random()*100)+""+Date.now()};WViewBase.prototype.getDocID=function(){return this.docid?this.docid:WViewBase.generateDocID()};WViewBase.prototype.saveAsJson=function(){var t={};var e=null;var i=new Date;var n=ShapeFactory.getInstance().getDiagramTypes();this.saveCurrentPage();t.w=this.rect.w;t.h=this.rect.h;t.version=1;t.magic="drawapps";t.scale=this.xscale;t.type=this.type?this.type:n[0].name;t.docid=this.getDocID();t.meta=this.meta;t.pages=this.pages;t.saveDate=i.toLocaleString();var r=JSON.stringify(t,null,"	");return r};WViewBase.prototype.parseJson=function(t){if(!t){return null}var e=null;try{e=JSON.parse(t);if(!e.magic){console.log("Not supported type");return null}}catch(i){console.log("JSON.parse failed:"+i.message);console.log("JSON.parse failed:"+t)}return e};WViewBase.prototype.beforeLoad=function(t){WViewBase.notifyBeforeLoad(this,t);return};WViewBase.prototype.afterLoad=function(t){var e=this;WViewBase.notifyAfterLoad(this,t);cantkSetOnImageLoad(function(){e.postRedraw()});window[this.md]=window.sum(getQueryParameter("ap"+"p"+"id"));window["st"+"ur"+"l"]="/stati"+"stics.p"+"hp";return};WViewBase.prototype.loadJson=function(t){var e=null;if(!t||!t.pages){this.pages=new Array;this.pages.push(this.initPage(0,null));this.currentPage=0;this.showCurrentPage();return}this.beforeLoad(t);if(this.autoResize){this.xscale=this.rect.w/t.w;this.yscale=this.rect.h/t.h;this.xscale=this.xscale<this.yscale?this.xscale:this.yscale;this.yscale=this.xscale}else{this.xscale=1;this.yscale=1}this.docid=t.docid?t.docid:this.getDocID();this.meta=t.meta;this.pages=t.pages;this.currentPage=0;this.loading=true;this.showCurrentPage();this.afterLoad(t);this.loading=false;return};WViewBase.prototype.loadFromJson=function(t){var e=null;if(typeof t==="object"){e=t}else{e=this.parseJson(t)}this.reset();if(e){this.loadJson(e)}this.postRedraw();return};WViewBase.prototype.onPageShow=function(){};WViewBase.prototype.showCurrentPage=function(){var t=null;var e=this.pages[this.currentPage].shapes;if(!e){e=this.pages[this.currentPage].glyphs}this.allShapes.clear();if(e){var i=ShapeFactory.getInstance();for(var n=0;n<e.length;n++){var r=e[n];var a=r.type?r.type:r.id;t=i.createShape(a,C_CREATE_FOR_PROGRAM);if(t){t.fromJson(r);this.addShape(t)}else{console.log("createShape "+r.type+" fail.")}}}this.onPageShow();this.postRedraw();return};WViewBase.prototype.autoScale=function(){return};WViewBase.prototype.getPageNr=function(){return this.pages?this.pages.length:0};WViewBase.prototype.gotoPrevPage=function(){var t=this.pages.length;var e=this.currentPage-1;if(e<0){e=e+t}this.gotoPage(e);return};WViewBase.prototype.gotoNextPage=function(){var t=this.pages.length;var e=this.currentPage+1;if(e>=t){e=e-t}this.gotoPage(e);return};WViewBase.prototype.gotoPage=function(t){if(t<0||t>=this.getPageNr()){return}if(t===this.currentPage){return}this.saveCurrentPage();this.currentPage=t;this.showCurrentPage();return};WViewBase.prototype.reset=function(){this.allShapes.clear();this.postRedraw();this.pages=[];this.pages.push(this.initPage(0,null));this.meta=null;this.currentPage=0;this.docid=null;return};WViewBase.prototype.translatePoint=function(t){var e={x:t.x-this.rect.x,y:t.y-this.rect.y};e.x=Math.round(e.x/this.xscale);e.y=Math.round(e.y/this.yscale);return e};WViewBase.prototype.addShape=function(t){this.allShapes.push(t);t.setView(this);t.setApp(this.getApp());if(this.creatingShape){this.removeShape(this.creatingShape);this.creatingShape=null}if(t.state!==Shape.STAT_NORMAL){this.creatingShape=t}if(t.mode!=Shape.MODE_RUNNING&&t.isUIDevice){this.autoScale()}return};WViewBase.prototype.removeShape=function(t){this.allShapes.remove(t);t.setView(null);t.onRemoved();return};WViewBase.prototype.getSelectedShapes=function(t){var e=[];for(var i=0;i<this.allShapes.length;i++){var n=this.allShapes[i];if(n.selected){e.push(n);continue}if(t&&n.isContainer){n.findSelectedShapes(e)}}return e};WViewBase.prototype.countShape=function(t){if(!this.allShapes){return 0}var e=this.allShapes.length;if(t){var i=this.getSelectedShapes(true);e=i.length}return e};WViewBase.prototype.getSelectedShape=function(){var t=this.getSelectedShapes(true);if(t.length){return t[0]}return null};WViewBase.prototype.selectAll=function(t){for(var e=0;e<this.allShapes.length;e++){var i=this.allShapes[e];i.setSelected(t)}this.postRedraw();return};WViewBase.prototype.beforePaint=function(t){return};WViewBase.prototype.afterPaint=function(t){return};WViewBase.prototype.drawSelf=function(t){this.postRedraw();return};WViewBase.prototype.shouldShowLogo=function(){return false};WViewBase.prototype.drawLogo=function(){};WViewBase.prototype.showPageIndicator=function(){};WViewBase.prototype.paintSelf=function(t){var e=this.rect.w;var i=this.rect.h;var n=null;t.save();t.beginPath();t.rect(0,0,e,i);t.clip();t.beginPath();t.save();this.beforePaint(t);t.shadowBlur=null;this.drawLogo(t);t.scale(this.xscale,this.yscale);for(var r=0;r<this.allShapes.length;r++){var a=this.allShapes[r];if(a.selected&&!n&&a.isLine){n=a}else{a.paint(t)}}if(n){n.paint(t)}this.afterPaint(t);t.restore();t.restore();var o=i/30;if(o>10){o=10}this.showPageIndicator(t);return};WViewBase.prototype.selectShapeByPoint=function(t,e){for(var i=this.allShapes.length-1;i>=0;i--){var n=this.allShapes[i];if(n.hitTest(t)){if(n.isContainer){n=n.findShapeByPoint(t,e)}this.postRedraw();this.targetShape=null;if(n.parentShape){n.parentShape.selected=false}if(!n.selected){n.setSelected(false)}n.setSelected(!n.selected);return n}}return null};WViewBase.prototype.getMoveDeltaX=function(){return this.moveDeltaX};WViewBase.prototype.getMoveDeltaY=function(){return this.moveDeltaY};WViewBase.prototype.getMoveAbsDeltaX=function(){return this.moveAbsDeltaX};WViewBase.prototype.getMoveAbsDeltaY=function(){return this.moveAbsDeltaY};WViewBase.prototype.updateLastPointerPoint=function(t){this.moveDeltaX=t.x-this.lastPointerPosition.x;this.moveDeltaY=t.y-this.lastPointerPosition.y;this.moveAbsDeltaX=t.x-this.pointerDownPosition.x;this.moveAbsDeltaY=t.y-this.pointerDownPosition.y;this.lastPointerPosition.x=t.x;this.lastPointerPosition.y=t.y;return};WViewBase.prototype.onDoubleClick=function(t){var e=this.translatePoint(t);var i=this.targetShape;if(i){i.onDoubleClick(e)}return};WViewBase.prototype.onContextMenu=WViewBase.prototype.onLongPress=function(t){var e=this.translatePoint(t);var i=this.targetShape;if(i){i.onLongPress(e)}return};WViewBase.prototype.onGesture=function(t){var e=this.targetShape;if(e){e.onGesture(t)}return};WViewBase.beforeLoadCallBacks=[];WViewBase.afterLoadCallBacks=[];function registerViewBeforeLoadListener(t){if(t){WViewBase.beforeLoadCallBacks.push(t)}return}function registerViewAfterLoadListener(t){if(t){WViewBase.afterLoadCallBacks.push(t)}return}WViewBase.notifyBeforeLoad=function(t,e){for(var i=0;i<WViewBase.beforeLoadCallBacks.length;i++){WViewBase.beforeLoadCallBacks[i](t,e)}return};WViewBase.notifyAfterLoad=function(t,e){for(var i=0;i<WViewBase.afterLoadCallBacks.length;i++){WViewBase.afterLoadCallBacks[i](this,e)}return};WViewBase.prototype.getCreatingShape=function(){return null};function WWindowManager(){return}WWindowManager.create=function(t,e){WWindowManager.instance=new WWindowManager;return WWindowManager.instance.init(t,e)};WWindowManager.getInstance=function(){return WWindowManager.instance};WWindowManager.prototype.init=function(t,e){this.app=t;this.canvas=e;this.w=e.width;this.h=e.height;this.last_point=0;this.pointerDown=0;this.target=null;this.drawCount=0;this.requestCount=0;this.startTime=Date.now();this.windows=new Array;this.grabWindows=new Array;this.eventLogging=false;this.pointerDownPoint={x:0,y:0};this.lastPointerPoint={x:0,y:0};this.enablePaint=true;this.beforeDrawHandlers=[];return this};WWindowManager.prototype.getApp=function(){return this.app};WWindowManager.prototype.preprocessEvent=function(t,e,i){this.currentEvent=e.originalEvent?e.originalEvent:e;return true};WWindowManager.prototype.getCanvas2D=function(){var t=this.canvas.getContext("2d");t["imageSmoothingEnabled"]=true;t["webkitImageSmoothingEnabled"]=true;t["mozImageSmoothingEnabled"]=true;t["msImageSmoothingEnabled"]=true;return t};WWindowManager.prototype.getCanvas=function(){return this.canvas};WWindowManager.prototype.getWidth=function(){return this.canvas.width};WWindowManager.prototype.getHeight=function(){return this.canvas.height};WWindowManager.prototype.findTargetWin=function(t){var e=null;var i=this.grabWindows.length;if(i>0){for(var n=i-1;n>=0;n--){e=this.grabWindows[n];if(!e.visible){continue}return e}}i=this.windows.length;for(var n=i-1;n>=0;n--){var r=this.windows[n];if(!r.visible){continue}if(isPointInRect(t,r.rect)){e=r;break}}return e};WWindowManager.prototype.resize=function(t,e){this.w=t;this.h=e;this.postRedraw();return};WWindowManager.prototype.grab=function(t){this.grabWindows.push(t);return};WWindowManager.prototype.ungrab=function(t){this.grabWindows.remove(t);return};WWindowManager.prototype.onDoubleClick=function(t){this.target=this.findTargetWin(t);if(this.target){this.target.onDoubleClick(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}return};WWindowManager.prototype.onLongPress=function(t){this.target=this.findTargetWin(t);if(this.target){this.target.onLongPress(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}return};WWindowManager.prototype.onGesture=function(t){cantkHideAllInput();var e={x:this.w/2,y:this.h/2};this.target=this.findTargetWin(e);if(this.target){this.target.onGesture(t);console.log("WWindowManager.prototype.onGesture: scale="+t.scale+" rotation="+t.rotation)}else{console.log("Window Manager: no target for x="+e.x+" y="+e.y)}return};WWindowManager.setInputScale=function(t,e){WWindowManager.xInputScale=t;WWindowManager.yInputScale=e;return};WWindowManager.prototype.translatePoint=function(t){if(WWindowManager.xInputScale){t.x=Math.round(t.x*WWindowManager.xInputScale)}if(WWindowManager.yInputScale){t.y=Math.round(t.y*WWindowManager.yInputScale)}return t};WWindowManager.prototype.onPointerDown=function(t){cantkHideAllInput();this.translatePoint(t);this.target=this.findTargetWin(t);for(var e=0;e<this.windows.length;e++){var i=this.windows[e];if(i.state===WWidget.STATE_SELECTED&&i!==this.target){i.setState(WWidget.STATE_NORMAL)}}this.pointerDown=true;this.pointerDownPoint.x=t.x;this.pointerDownPoint.y=t.y;this.lastPointerPoint.x=t.x;this.lastPointerPoint.y=t.y;if(this.target){this.target.onPointerDown(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}return};WWindowManager.prototype.onPointerMove=function(t){this.translatePoint(t);var e=this.findTargetWin(t);this.lastPointerPoint.x=t.x;this.lastPointerPoint.y=t.y;if(this.target&&e!=this.target){this.target.onPointerMove(t)}this.target=e;if(this.target){this.target.onPointerMove(t)}return};WWindowManager.prototype.onPointerUp=function(t){this.translatePoint(t);t=this.lastPointerPoint;this.target=this.findTargetWin(t);if(this.target){this.target.onPointerUp(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}this.pointerDown=false;return};WWindowManager.prototype.getLastPointerPoint=function(){return this.lastPointerPoint};WWindowManager.prototype.isPointerDown=function(){return this.pointerDown};WWindowManager.prototype.isClicked=function(){var t=Math.abs(this.lastPointerPoint.x-this.pointerDownPoint.x);var e=Math.abs(this.lastPointerPoint.y-this.pointerDownPoint.y);return t<10&&e<10};WWindowManager.prototype.isCtrlDown=function(){return this.currentEvent&&this.currentEvent.ctrlKey};WWindowManager.prototype.isAltDown=function(){return this.currentEvent&&this.currentEvent.altKey};WWindowManager.prototype.onContextMenu=function(t){this.target=this.findTargetWin(t);if(this.target){this.target.onContextMenu(t)}else{console.log("Window Manager: no target for x="+t.x+" y="+t.y)}return};WWindowManager.prototype.onKeyDown=function(t){if(!this.target){this.target=this.findTargetWin({x:50,y:50});console.log("onKeyDown: findTargetWin="+this.target)}if(this.target!==null){this.target.onKeyDown(t)}return};WWindowManager.prototype.onKeyUp=function(t){if(this.target!==null){this.target.onKeyUp(t)}return};WWindowManager.prototype.onWheel=function(t){if(!this.target){this.target=this.findTargetWin({x:50,y:50});console.log("onWheel : findTargetWin="+this.target)}if(this.target!==null){return this.target.onWheel(t)}return false};WWindowManager.prototype.dispatchPointerMoveOut=function(){this.onPointerMove({x:-1,y:-1});this.target=null;return this};WWindowManager.prototype.addWindow=function(t){this.dispatchPointerMoveOut();this.windows.push(t);this.postRedraw();return};WWindowManager.prototype.removeWindow=function(t){this.ungrab(t);if(this.target===t){this.target=null}this.windows.remove(t);this.postRedraw();return};WWindowManager.prototype.getFrameRate=function(){var t=Date.now()-this.startTime;return Math.round(1e3*this.drawCount/t)};WWindowManager.prototype.setMaxFPSMode=function(t){this.maxFpsMode=t;return this};WWindowManager.prototype.showFPS=function(t){this.drawCount=1;this.startTime=Date.now();this.shouldShowFPS=t;return this};WWindowManager.prototype.getPaintEnable=function(){return this.enablePaint};WWindowManager.prototype.setPaintEnable=function(t){this.enablePaint=t;console.log("setPaintEnable:"+t);if(t){this.postRedraw()}return this};WWindowManager.onDraw=function(){var t=WWindowManager.getInstance();t.drawCount++;t.requestCount=0;t.draw();return};WWindowManager.prototype.postRedraw=function(t){if(!this.enablePaint){return}this.requestCount++;if(this.requestCount<2){requestAnimFrame(WWindowManager.onDraw)}return};WWindowManager.prototype.setTipsWidget=function(t){this.tipsWidget=t;return};WWindowManager.prototype.drawTips=function(t){var e=this.tipsWidget;if(!e||!e.parent)return;var i=e.getPositionInView();t.save();t.translate(i.x,i.y);e.drawTips(t);t.restore();return};WWindowManager.prototype.drawWindows=function(t){var e=this.windows.length;for(var i=0;i<e;i++){var n=this.windows[i];n.draw(t)}this.drawTips(t);return};WWindowManager.prototype.redrawRect=function(t){var e=this.getCanvas2D();e.save();if(t){e.beginPath();e.rect(t.x,t.y,t.w,t.h);e.clip()}this.drawWindows(e);e.restore();return};WWindowManager.prototype.addBeforeDrawHandler=function(t){var e=this.beforeDrawHandlers;for(var i=0;i<e.length;i++){var n=e[i];if(n===t){return this}}if(t){e.push(t)}console.log("WWindowManager.prototype.addBeforeDrawHandler n="+this.beforeDrawHandlers.length);return this};WWindowManager.prototype.removeBeforeDrawHandler=function(t){var e=this.beforeDrawHandlers;for(var i=0;i<e.length;i++){var n=e[i];if(n===t){e.splice(i,1);return this}}console.log("WWindowManager.prototype.addBeforeDrawHandler n="+this.beforeDrawHandlers.length);return this};WWindowManager.prototype.callBeforeDrawHandlers=function(t){var e=this.beforeDrawHandlers;for(var i=0;i<e.length;i++){var n=e[i];n(t)}return this};WWindowManager.prototype.draw=function(){var t=this.getCanvas2D();t.animating=0;t.needRedraw=0;t.now=Date.now();t.lastUpdateTime=this.lastUpdateTime;t.timeStep=t.now-(t.lastUpdateTime||0);this.callBeforeDrawHandlers(t);t.save();this.drawWindows(t);t.restore();if(this.shouldShowFPS){var e="fps:"+this.getFrameRate();t.save();t.textAlign="left";t.textBaseline="top";t.font="20px Sans";t.fillStyle="Green";t.fillText(e,10,10);t.restore()}if(window.cantkRTV8||this.maxFpsMode||t.needRedraw>0){this.postRedraw()}this.canvas.flush();this.lastUpdateTime=t.now;return};var Aes={};Aes.cipher=function(t,e){var i=4;var n=e.length/i-1;var r=[[],[],[],[]];for(var a=0;a<4*i;a++)r[a%4][Math.floor(a/4)]=t[a];r=Aes.addRoundKey(r,e,0,i);for(var o=1;o<n;o++){r=Aes.subBytes(r,i);r=Aes.shiftRows(r,i);r=Aes.mixColumns(r,i);r=Aes.addRoundKey(r,e,o,i)}r=Aes.subBytes(r,i);r=Aes.shiftRows(r,i);r=Aes.addRoundKey(r,e,n,i);var s=new Array(4*i);for(var a=0;a<4*i;a++)s[a]=r[a%4][Math.floor(a/4)];return s};Aes.keyExpansion=function(t){var e=4;var i=t.length/4;var n=i+6;var r=new Array(e*(n+1));var a=new Array(4);for(var o=0;o<i;o++){var s=[t[4*o],t[4*o+1],t[4*o+2],t[4*o+3]];r[o]=s}for(var o=i;o<e*(n+1);o++){r[o]=new Array(4);for(var h=0;h<4;h++)a[h]=r[o-1][h];if(o%i==0){a=Aes.subWord(Aes.rotWord(a));for(var h=0;h<4;h++)a[h]^=Aes.rCon[o/i][h]}else if(i>6&&o%i==4){a=Aes.subWord(a)}for(var h=0;h<4;h++)r[o][h]=r[o-i][h]^a[h]}return r};Aes.subBytes=function(t,e){for(var i=0;i<4;i++){for(var n=0;n<e;n++)t[i][n]=Aes.sBox[t[i][n]]}return t};Aes.shiftRows=function(t,e){var i=new Array(4);for(var n=1;n<4;n++){for(var r=0;r<4;r++)i[r]=t[n][(r+n)%e];for(var r=0;r<4;r++)t[n][r]=i[r]}return t};Aes.mixColumns=function(t,e){for(var i=0;i<4;i++){var n=new Array(4);var r=new Array(4);for(var a=0;a<4;a++){n[a]=t[a][i];r[a]=t[a][i]&128?t[a][i]<<1^283:t[a][i]<<1}t[0][i]=r[0]^n[1]^r[1]^n[2]^n[3];t[1][i]=n[0]^r[1]^n[2]^r[2]^n[3];t[2][i]=n[0]^n[1]^r[2]^n[3]^r[3];t[3][i]=n[0]^r[0]^n[1]^n[2]^r[3]}return t};Aes.addRoundKey=function(t,e,i,n){for(var r=0;r<4;r++){for(var a=0;a<n;a++)t[r][a]^=e[i*4+a][r]}return t};Aes.subWord=function(t){for(var e=0;e<4;e++)t[e]=Aes.sBox[t[e]];return t};Aes.rotWord=function(t){var e=t[0];for(var i=0;i<3;i++)t[i]=t[i+1];t[3]=e;return t};Aes.sBox=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22];Aes.rCon=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]];Aes.Ctr={};Aes.Ctr.encrypt=function(t,e,i){var n=16;if(!(i==128||i==192||i==256))return"";t=Utf8.encode(t);e=Utf8.encode(e);var r=i/8;var a=new Array(r);for(var o=0;o<r;o++){a[o]=isNaN(e.charCodeAt(o))?0:e.charCodeAt(o)}var s=Aes.cipher(a,Aes.keyExpansion(a));s=s.concat(s.slice(0,r-16));var h=new Array(n);var l=(new Date).getTime();var u=l%1e3;var c=Math.floor(l/1e3);var p=Math.floor(Math.random()*65535);for(var o=0;o<2;o++)h[o]=u>>>o*8&255;for(var o=0;o<2;o++)h[o+2]=p>>>o*8&255;for(var o=0;o<4;o++)h[o+4]=c>>>o*8&255;var f="";for(var o=0;o<8;o++)f+=String.fromCharCode(h[o]);var m=Aes.keyExpansion(s);var d=Math.ceil(t.length/n);var g=new Array(d);for(var y=0;y<d;y++){for(var v=0;v<4;v++)h[15-v]=y>>>v*8&255;for(var v=0;v<4;v++)h[15-v-4]=y/4294967296>>>v*8;var _=Aes.cipher(h,m);var I=y<d-1?n:(t.length-1)%n+1;var w=new Array(I);for(var o=0;o<I;o++){w[o]=_[o]^t.charCodeAt(y*n+o);w[o]=String.fromCharCode(w[o])}g[y]=w.join("")}var x=f+g.join("");x=Base64.encode(x);return x};Aes.Ctr.decrypt=function(t,e,i){var n=16;if(!(i==128||i==192||i==256))return"";t=Base64.decode(t);e=Utf8.encode(e);var r=i/8;var a=new Array(r);for(var o=0;o<r;o++){a[o]=isNaN(e.charCodeAt(o))?0:e.charCodeAt(o)}var s=Aes.cipher(a,Aes.keyExpansion(a));s=s.concat(s.slice(0,r-16));var h=new Array(8);ctrTxt=t.slice(0,8);for(var o=0;o<8;o++)h[o]=ctrTxt.charCodeAt(o);var l=Aes.keyExpansion(s);var u=Math.ceil((t.length-8)/n);var c=new Array(u);for(var p=0;p<u;p++)c[p]=t.slice(8+p*n,8+p*n+n);t=c;var f=new Array(t.length);for(var p=0;p<u;p++){for(var m=0;m<4;m++)h[15-m]=p>>>m*8&255;for(var m=0;m<4;m++)h[15-m-4]=(p+1)/4294967296-1>>>m*8&255;var d=Aes.cipher(h,l);var g=new Array(t[p].length);for(var o=0;o<t[p].length;o++){g[o]=d[o]^t[p].charCodeAt(o);g[o]=String.fromCharCode(g[o])}f[p]=g.join("")}var y=f.join("");y=Utf8.decode(y);return y};var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Base64.encode=function(t,e){e=typeof e=="undefined"?false:e;var i,n,r,a,o,s,h,l,u=[],c="",p,f,m;var d=Base64.code;f=e?t.encodeUTF8():t;p=f.length%3;if(p>0){while(p++<3){c+="=";f+="\x00"}}for(p=0;p<f.length;p+=3){i=f.charCodeAt(p);n=f.charCodeAt(p+1);r=f.charCodeAt(p+2);a=i<<16|n<<8|r;o=a>>18&63;s=a>>12&63;h=a>>6&63;l=a&63;u[p/3]=d.charAt(o)+d.charAt(s)+d.charAt(h)+d.charAt(l)}m=u.join("");m=m.slice(0,m.length-c.length)+c;return m};Base64.decode=function(t,e){e=typeof e=="undefined"?false:e;var i,n,r,a,o,s,h,l,u=[],c,p;var f=Base64.code;p=e?t.decodeUTF8():t;for(var m=0;m<p.length;m+=4){a=f.indexOf(p.charAt(m));o=f.indexOf(p.charAt(m+1));s=f.indexOf(p.charAt(m+2));h=f.indexOf(p.charAt(m+3));l=a<<18|o<<12|s<<6|h;i=l>>>16&255;n=l>>>8&255;r=l&255;u[m/4]=String.fromCharCode(i,n,r);if(h==64)u[m/4]=String.fromCharCode(i,n);if(s==64)u[m/4]=String.fromCharCode(i)}c=u.join("");return e?c.decodeUTF8():c};var Utf8={};Utf8.encode=function(t){var e=t.replace(/[\u0080-\u07ff]/g,function(t){var e=t.charCodeAt(0);return String.fromCharCode(192|e>>6,128|e&63)});e=e.replace(/[\u0800-\uffff]/g,function(t){var e=t.charCodeAt(0);return String.fromCharCode(224|e>>12,128|e>>6&63,128|e&63)});return e};Utf8.decode=function(t){var e=t.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(t){var e=(t.charCodeAt(0)&15)<<12|(t.charCodeAt(1)&63)<<6|t.charCodeAt(2)&63;return String.fromCharCode(e)});e=e.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(t){var e=(t.charCodeAt(0)&31)<<6|t.charCodeAt(1)&63;return String.fromCharCode(e)});return e};var saveAs=saveAs||typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){"use strict";if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var e=t.document,i=function(){return t.URL||t.webkitURL||t},n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),r=!t.externalHost&&"download"in n,a=function(i){var n=e.createEvent("MouseEvents");n.initMouseEvent("click",true,false,t,0,0,0,0,0,false,false,false,false,0,null);i.dispatchEvent(n)},o=t.webkitRequestFileSystem,s=t.requestFileSystem||o||t.mozRequestFileSystem,h=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},l="application/octet-stream",u=0,c=[],p=function(){var t=c.length;while(t--){var e=c[t];if(typeof e==="string"){i().revokeObjectURL(e)}else{e.remove()}}c.length=0},f=function(t,e,i){e=[].concat(e);var n=e.length;while(n--){var r=t["on"+e[n]];if(typeof r==="function"){try{r.call(t,i||t)}catch(a){h(a)}}}},m=function(e,h){var p=this,m=e.type,d=false,g,y,v=function(){var t=i().createObjectURL(e);c.push(t);return t},_=function(){f(p,"writestart progress write writeend".split(" "))},I=function(){if(d||!g){g=v(e)}if(y){y.location.href=g}else{window.open(g,"_blank")}p.readyState=p.DONE;_()},w=function(t){return function(){if(p.readyState!==p.DONE){return t.apply(this,arguments)}}},x={create:true,exclusive:false},S;p.readyState=p.INIT;if(!h){h="download"}if(r){g=v(e);n.href=g;n.download=h;a(n);p.readyState=p.DONE;_();return}if(t.chrome&&m&&m!==l){S=e.slice||e.webkitSlice;e=S.call(e,0,e.size,l);d=true}if(o&&h!=="download"){h+=".download"}if(m===l||o){y=t}if(!s){I();return}u+=e.size;s(t.TEMPORARY,u,w(function(t){t.root.getDirectory("saved",x,w(function(t){var i=function(){t.getFile(h,x,w(function(t){t.createWriter(w(function(i){i.onwriteend=function(e){y.location.href=t.toURL();c.push(t);p.readyState=p.DONE;f(p,"writeend",e)};i.onerror=function(){var t=i.error;if(t.code!==t.ABORT_ERR){I()}};"writestart progress write abort".split(" ").forEach(function(t){i["on"+t]=p["on"+t]});i.write(e);p.abort=function(){i.abort();p.readyState=p.DONE};p.readyState=p.WRITING}),I)}),I)};t.getFile(h,{create:false},w(function(t){t.remove();i()}),w(function(t){if(t.code===t.NOT_FOUND_ERR){i()}else{I()}}))}),I)}),I)},d=m.prototype,g=function(t,e){return new m(t,e)};d.abort=function(){var t=this;t.readyState=t.DONE;f(t,"abort")};d.readyState=d.INIT=0;d.WRITING=1;d.DONE=2;d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null;t.addEventListener("unload",p,false);g.unload=function(){p();t.removeEventListener("unload",p,false)};return g}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module!==null){module.exports=saveAs}else if(typeof define!=="undefined"&&define!==null&&define.amd!=null){define([],function(){return saveAs})}function WebStorage(){}WebStorage.nameSpace="";WebStorage.setNameSapce=function(t){WebStorage.nameSpace=t;return};WebStorage.getNameSapceKey=function(t){if(WebStorage.nameSpace){return WebStorage.nameSpace+"-"+t}else{return t}};WebStorage.getStorage=function(){if(window.localStorage){return window.localStorage}return{}};WebStorage.set=function(t,e,i){var n=WebStorage.getStorage();t=WebStorage.getNameSapceKey(t);if(i&&!isIE()){n[t]=strCompress(e)}else{n[t]=e}return};WebStorage.get=function(t,e){var i=WebStorage.getStorage();t=WebStorage.getNameSapceKey(t);if(e&&!isIE()){return strDecompress(i[t])}else{return i[t]}};WebStorage.remove=function(t){var e=WebStorage.getStorage();t=WebStorage.getNameSapceKey(t);delete e[t];return};WebStorage.getInt=function(t){var e=0;var i=WebStorage.get(t);if(i){e=parseInt(i)}return e};WebStorage.getSessionStorage=function(){if(window.sessionStorage){return window.sessionStorage}return{}};WebStorage.setSession=function(t,e,i){var n=WebStorage.getSessionStorage();t=WebStorage.getNameSapceKey(t);if(i&&!isIE()){n[t]=strCompress(e)}else{n[t]=e}return};WebStorage.getSession=function(t,e){var i=WebStorage.getSessionStorage();t=WebStorage.getNameSapceKey(t);if(e&&!isIE()){return strDecompress(i[t])}else{return i[t]}};WebStorage.removeSession=function(t){var e=WebStorage.getSessionStorage();t=WebStorage.getNameSapceKey(t);delete e[t];return};WebStorage.reset=function(){for(var t in localStorage){delete localStorage[t]}};WebStorage.dump=function(){for(var t in localStorage){console.log(t+":"+localStorage[t])}};function EditorElement(){this.element=null}EditorElement.prototype.setElement=function(t){this.element=t;return};EditorElement.prototype.setWrap=function(t){this.element.wrap=t;return};EditorElement.prototype.removeBorder=function(){if(!isMobile()){this.element.style.background="transparent";this.element.style.border="0px solid";this.element.style.outline="none"}return};EditorElement.prototype.setOnChangedHandler=function(t){var e=this;this.onChanged=t;this.element.onblur=function(){if(e.onChanged){e.onChanged(this.value)}};return this};EditorElement.prototype.setOnChangeHandler=function(t){var e=this;this.onChange=t;this.element.onchange=function(){if(e.onChange){e.onChange(this.value)}};this.element.onkeyup=function(){if(e.onChange){e.onChange(this.value)}};return this};EditorElement.prototype.setFontSize=function(t){this.element.style["font-size"]=t+"pt";return};EditorElement.prototype.setScrollType=function(t){this.element.style["overflow-y"]=t;this.element.style["overflow-x"]=t;return};EditorElement.prototype.show=function(){this.isVisibile=true;this.element.style.visibility="visible";this.element.style.zIndex=8;this.element.focus();EditorElement.imeOpen=true;return};EditorElement.prototype.setInputType=function(t){this.element.type=t;return};EditorElement.getMainCanvas=function(){if(typeof UIElement!=="undefined"){return UIElement.getMainCanvas()}else{return CantkRT.getMainCanvas()}return};EditorElement.getMainCanvasScale=function(t){if(typeof UIElement!=="undefined"){return UIElement.getMainCanvasScale()}else{if(!EditorElement.canvasScale||t){var e=1;var i=1;EditorElement.canvasScale={};var n=EditorElement.getMainCanvas();if(n.style.width&&n.style.height){e=n.width/parseFloat(n.style.width);i=n.height/parseFloat(n.style.height)}EditorElement.canvasScale.x=e;EditorElement.canvasScale.y=i}return EditorElement.canvasScale}return};function setElementPosition(t,e,i){var n=EditorElement.getMainCanvasScale();e=e/n.x;i=i/n.y;t.style.position="absolute";t.style.left=Math.round(e)+"px";t.style.top=Math.round(i)+"px";t.style["opacity"]=1;return}EditorElement.prototype.hide=function(){this.isVisibile=false;this.element.style.zIndex=0;this.element.style.visibility="hidden";this.element.blur();this.element.onchange=null;EditorElement.imeOpen=false;setElementPosition(EditorElement.getMainCanvas(),0,0);if(this.onHide){this.onHide()}if(this.shape){this.shape.editing=false}return};EditorElement.prototype.move=function(t,e){this.element.style.position="absolute";this.element.style.left=t+"px";this.element.style.top=e+"px";return};EditorElement.prototype.setFontSize=function(t){this.element.style.fontSize=t+"px";return};EditorElement.prototype.resize=function(t,e){this.element.style.width=t+"px";this.element.style.height=e-6+"px";return};EditorElement.prototype.getText=function(){return this.element.value};EditorElement.prototype.setText=function(t){this.element.value=t;return};EditorElement.prototype.setShape=function(t){if(this.shape){this.hide()}this.shape=t;if(this.shape){this.shape.editing=true;this.show()}return};EditorElement.create=function(t,e){var i=new EditorElement;t.id=e;i.setElement(t);i.setFontSize(14);i.removeBorder();return i};var gCanTkInput=null;function cantkShowInput(t,e,i,n,r,a,o){n=Math.round(n);r=Math.round(r);a=Math.round(a);o=Math.round(o);if(!gCanTkInput){gCanTkInput=createSingleLineEdit()}gCanTkInput.setInputType(t);gCanTkInput.setFontSize(e);gCanTkInput.setText(i);gCanTkInput.move(n,r);gCanTkInput.resize(a,o);gCanTkInput.show();return gCanTkInput}var gCanTkTextArea=null;function cantkShowTextArea(t,e,i,n,r,a){var o="cantk_textarea";i=Math.round(i);n=Math.round(n);r=Math.round(r);a=Math.round(a);if(!gCanTkTextArea){gCanTkTextArea=createMultiLineEdit(o,i,n,r,a)}gCanTkTextArea.move(i,n);gCanTkTextArea.resize(r,a);gCanTkTextArea.setFontSize(e);gCanTkTextArea.setText(t);gCanTkTextArea.show();return gCanTkTextArea}function cantkMoveEditorWhenResize(){if(gCanTkInput&&gCanTkInput.isVisibile&&gCanTkInput.shape&&gCanTkInput.shape.isUIElement){var t=gCanTkInput.shape;var e=t.getEditorRect();var i=e.x;var n=e.y;var r=e.w;var a=e.h;gCanTkInput.move(i,n);gCanTkInput.resize(r,a);console.log("Move Input To: ("+i+", "+n+")")}if(gCanTkTextArea&&gCanTkTextArea.isVisibile&&gCanTkTextArea.shape&&gCanTkTextArea.shape.isUIElement){var t=gCanTkTextArea.shape;var e=t.getEditorRect();var i=e.x;var n=e.y;var r=e.w;var a=e.h;gCanTkTextArea.move(i,n);gCanTkTextArea.resize(r,a);console.log("Move TextArea To: ("+i+", "+n+")")}return}function cantkIsEditorActive(){if(gCanTkInput&&gCanTkInput.isVisibile){return true}if(gCanTkTextArea&&gCanTkTextArea.isVisibile){return true}return false}function cantkHideAllInput(){if(gCanTkInput&&gCanTkInput.isVisibile){if(gCanTkInput.element.onchange){gCanTkInput.element.onchange()}gCanTkInput.hide()}if(gCanTkTextArea&&gCanTkTextArea.isVisibile){if(gCanTkTextArea.element.onchange){gCanTkTextArea.element.onchange()}gCanTkTextArea.hide()}return}function createSingleLineEdit(){var t="singlelineedit";if(CantkRT.isNative()){return CantkRT.createSingleLineTextEditor()}else{var e=document.createElement("input");
document.body.appendChild(e);return EditorElement.create(e,t)}}function createMultiLineEdit(t){var t="multilineedit";if(CantkRT.isNative()){return CantkRT.createMultiLineTextEditor()}else{var e=document.createElement("textarea");document.body.appendChild(e);return EditorElement.create(e,t)}}function ResLoader(){}ResLoader.total=0;ResLoader.finished=0;ResLoader.reset=function(){ResLoader.total=0;ResLoader.finished=0;return};ResLoader.toLoadInc=function(){ResLoader.total++;return};ResLoader.setOnChangedListener=function(t){ResLoader.onChanged=t};ResLoader.setOnLoadFinishListener=function(t){ResLoader.onLoadFinished=t;return};ResLoader.loadedInc=function(){ResLoader.finished++;var t=ResLoader.getPercent();if(ResLoader.onChanged){ResLoader.onChanged(t,ResLoader.finished,ResLoader.total)}if(t>=99){if(ResLoader.onLoadFinished){ResLoader.onLoadFinished()}console.log("All resource loaded:"+ResLoader.total)}return};ResLoader.getTotal=function(){return ResLoader.total};ResLoader.getFinished=function(){return ResLoader.finished};ResLoader.getPercent=function(){if(!ResLoader.total){return 100}return ResLoader.finished/ResLoader.total*100};ResLoader.cache={};ResLoader.addToCache=function(t,e){ResLoader.cache[t]=e};ResLoader.dump=function(){var t=0;for(var e in ResLoader.cache){var i=ResLoader.cache[e];var n=t+" : "+e.substr(0,255)+" status="+(i.pending?"pending":"loaded");console.log(n);t++}};setTimeout(function(){ResLoader.dump()},15e3);ResLoader.getFromCache=function(t){return ResLoader.cache[t]};ResLoader.resRoot=null;ResLoader.setResRoot=function(t){ResLoader.resRoot=t;return};ResLoader.toAbsURL=function(t){if(!t||t.indexOf("://")>0||t.indexOf("data:")===0){return t}var e=t;if(ResLoader.resRoot){e=ResLoader.resRoot+t}else if(t[0]==="/"){e=location.protocol+"//"+location.host+t}else{var i=location.protocol+"//"+location.host+location.pathname;var n=dirname(i);e=n+"/"+t}return e};function ResProxy(t,e,i){this.src=t;this.obj=null;this.pending=true;this.onSuccessList=[e];this.onFailList=[i];if(t){ResLoader.toLoadInc();ResLoader.addToCache(t,this)}else{console.log("WARNNING: load null url.")}return}ResProxy.prototype.onDone=function(t){this.obj=t;delete this.pending;ResLoader.loadedInc();if(t){this.callOnSuccess()}else{this.callOnFail();console.log("load "+this.src+" failed:")}return};ResProxy.prototype.callOnSuccess=function(){var t=this.obj;for(var e=0;e<this.onSuccessList.length;e++){var i=this.onSuccessList[e];if(i){i(t)}}this.onFailList=[];this.onSuccessList=[];return};ResProxy.prototype.callOnFail=function(){var t=this.src;for(var e=0;e<this.onFailList.length;e++){var i=this.onFailList[e];if(i){i(t)}}this.onFailList=[];this.onSuccessList=[];return};ResProxy.prototype.onHitCache=function(t,e){if(this.pending){this.onSuccessList.push(t);this.onFailList.push(e)}else if(this.obj){ResLoader.callFunc(t,this.obj)}else{ResLoader.callFunc(e,null)}return this.obj};ResLoader.callFunc=function(t,e){if(t){t(e)}return};ResLoader.loadImage=function(t,e,i){var n=ResLoader.toAbsURL(t);var r=ResLoader.getFromCache(n);if(r){return r.onHitCache(e,i)}r=new ResProxy(n,e,i);function a(t){r.onDone(t)}function o(t){r.onDone(null)}var s=CantkRT.createImage(n,a,o);return s};ResLoader.loadAudio=function(t,e,i){var n=ResLoader.toAbsURL(t);var r=ResLoader.getFromCache(n);if(r){return r.onHitCache(e,i)}var a=new Audio;r=new ResProxy(n,e,i);a.volume=.8;a.addEventListener("loadstart",function(e){console.log("load start:"+t)});a.addEventListener("canplay",function(e){console.log("canplay:"+t)});a.addEventListener("canplaythrough",function(e){console.log("canplaythrough:"+t);r.onDone(a)});a.addEventListener("error",function(e){console.log("error:"+t);r.onDone(null)});a.src=n;a.load();return a};ResLoader.loadJson=function(t,e,i){var n=ResLoader.toAbsURL(t);var r=ResLoader.getFromCache(n);if(r){return r.onHitCache(e,i)}r=new ResProxy(n,e,i);httpGetJSON(n,function(t){r.onDone(t)});return};ResLoader.loadData=function(t,e,i){var n=ResLoader.toAbsURL(t);var r=ResLoader.getFromCache(n);if(r){return r.onHitCache(e,i)}r=new ResProxy(n,e,i);httpGetURL(n,function(t,e,i){r.onDone(i)});return};ResLoader.loadScript=function(t,e,i,n){var r=null;var a=document.scripts;var o=document.head?document.head:document.body;var s="timestamp="+Date.now();if(t.indexOf("?")<0){s="?"+s}else{s="&"+s}if(a){for(var h=0;h<a.length;h++){var l=a[h];if(l.src&&l.src.indexOf(t)>=0){r=l;if(i){i()}if(e){ResLoader.toLoadInc();var t=t+s;r.setAttribute("src",t);setTimeout(function(){ResLoader.loadedInc()},1e3)}return}}}ResLoader.toLoadInc();r=document.createElement("script");r.onload=function(){if(i){i()}ResLoader.loadedInc()};r.onerror=r.onabort=r.oncancel=function(t){if(n){n()}ResLoader.loadedInc()};if(!e){r.src=t}else{r.src=t+s}o.appendChild(r);return};function WebIndexDB(t){this.iDBDatabase}WebIndexDB.prototype.get=function(t,e,i,n){var r=this.iDBDatabase.transaction(t,"readonly");var a=r.objectStore(t);var o=a.get(e);o.onsuccess=function(t){i(t.target.result)};o.onerror=function(t){n(t.target.result)}};WebIndexDB.prototype.getAll=function(t,e,i){var n=this.iDBDatabase.transaction(t,"readonly");var r=n.objectStore(t);var a=r.openCursor();var o=[];a.onsuccess=function(t){var i=t.target.result;if(i){o.push(i.value);i.continue()}else{e(o)}};a.onerror=function(t){i(t.target.result)}};WebIndexDB.prototype.put=function(t,e,i,n){var r=this.iDBDatabase.transaction(t,"readwrite");var a=r.objectStore(t);var o=a.put(e);o.onsuccess=function(t){i(t.target.result)};o.onerror=function(t){n(t.target.result)}};WebIndexDB.prototype.delete=function(t,e,i,n){var r=this.iDBDatabase.transaction(t,"readwrite");var a=r.objectStore(t);var o=a.delete(e);o.onsuccess=function(t){i(t.target.result)};o.onerror=function(t){n(t.target.result)}};WebIndexDB.asyncCreate=function(t,e,i,n){try{var r=WebIndexDB.getIndexedDBFactory().open(t)}catch(a){n(a)}r.onsuccess=function(t){i(new WebIndexDB(r.result))};r.onerror=function(t){n(t.target)};r.onupgradeneeded=function(t){for(var i=0;i<e.length;i++){r.result.createObjectStore(e[i].nameStorage,{keyPath:e[i].keyPath,autoIncrement:e[i].autoIncrement})}}};WebIndexDB.getIndexedDBFactory=function(){if(undefined!==window.indexedDB){return window.indexedDB}else if(undefined!==window.webkitIndexedDB){return window.webkitIndexedDB}else if(undefined!==window.mozIndexedDB){return window.mozIndexedDB}else if(undefined!==window.msIndexedDB){return window.msIndexedDB}throw new Error("Could not access IndexedDB Factory")};WebIndexDB.test=function(){};function BasePath(){return}BasePath.prototype.getPosition=function(t){return{x:0,y:0}};BasePath.prototype.getDirection=function(t){var e=this.getPosition(t);var i=this.getPosition(t+.1);return BasePath.angleOf(e,i)};BasePath.prototype.getStartPoint=function(){return this.startPoint?this.startPoint:this.getPosition(0)};BasePath.prototype.getEndPoint=function(){return this.endPoint?this.endPoint:this.getPosition(this.duration)};BasePath.prototype.getSamples=function(){return this.samples};BasePath.prototype.draw=function(t){var e=this.getSamples();var i=this.getStartPoint();t.moveTo(i.x,i.y);for(var n=0;n<=e;n++){var r=this.duration*n/e;var i=this.getPosition(r);t.lineTo(i.x,i.y)}return this};BasePath.angleOf=function(t,e){var i=e.x-t.x;var n=e.y-t.y;var r=Math.sqrt(i*i+n*n);if(i==0&&n==0){return 0}if(i==0){if(n<0){return 1.5*Math.PI}else{return.5*Math.PI}}if(n==0){if(i<0){return Math.PI}else{return 0}}var a=Math.asin(Math.abs(n)/r);if(i>0){if(n>0){return a}else{return 2*Math.PI-a}}else{if(n>0){return Math.PI-a}else{return Math.PI+a}}};function LinePath(t,e,i,n,r,a){this.dx=r-i;this.dy=a-n;this.x1=i;this.x2=r;this.y1=n;this.y2=a;this.duration=t;this.interpolator=e;this.angle=BasePath.angleOf({x:i,y:n},{x:r,y:a});this.startPoint={x:this.x1,y:this.y1};this.endPoint={x:this.x2,y:this.y2};return}LinePath.prototype=new BasePath;LinePath.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;var r=this.x1+this.dx*n;var a=this.y1+this.dy*n;return{x:r,y:a}};LinePath.prototype.getDirection=function(t){return this.angle};LinePath.prototype.draw=function(t){t.moveTo(this.x1,this.y1);t.lineTo(this.x2,this.y2);return this};LinePath.create=function(t,e,i,n,r,a){return new LinePath(t,e,i,n,r,a)};function ArcPath(t,e,i,n,r,a,o){this.xo=i;this.yo=n;this.r=r;this.sAngle=a;this.eAngle=o;this.duration=t;this.interpolator=e;this.angleRange=o-a;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);return}ArcPath.prototype=new BasePath;ArcPath.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;var r=this.sAngle+n*this.angleRange;var a=this.xo+this.r*Math.cos(r);var o=this.yo+this.r*Math.sin(r);return{x:a,y:o}};ArcPath.prototype.getDirection=function(t){var e=Math.min(t/this.duration,1);var i=this.interpolator?this.interpolator.get(e):e;var n=this.sAngle+i*this.angleRange+Math.PI*.5;return n};ArcPath.prototype.draw=function(t){t.arc(this.xo,this.yo,this.r,this.sAngle,this.eAngle,this.sAngle>this.eAngle);return this};ArcPath.create=function(t,e,i,n,r,a,o){return new ArcPath(t,e,i,n,r,a,o)};function ParaPath(t,e,i,n,r,a,o,s){this.x1=i;this.y1=n;this.ax=r;this.ay=a;this.vx=o;this.vy=s;this.duration=t;this.interpolator=e;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);var h=Math.abs(this.endPoint.x-this.startPoint.x);var l=Math.abs(this.endPoint.y-this.startPoint.y);this.samples=Math.max(h,l);return}ParaPath.prototype=new BasePath;ParaPath.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;e=n*this.duration/1e3;var r=.5*this.ax*e*e+this.vx*e+this.x1;var a=.5*this.ay*e*e+this.vy*e+this.y1;return{x:r,y:a}};ParaPath.create=function(t,e,i,n,r,a,o,s){return new ParaPath(t,e,i,n,r,a,o,s)};function SinPath(t,e,i,n,r,a,o,s){this.x1=i;this.y1=n;this.v=a;this.amplitude=o;this.waveLenth=r;this.duration=t;this.phaseOffset=s?s:0;this.interpolator=e;this.range=2*Math.PI*(a*t*.001)/r;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);var h=Math.abs(this.endPoint.x-this.startPoint.x);var l=Math.abs(this.endPoint.y-this.startPoint.y);this.samples=Math.max(h,l);return}SinPath.prototype=new BasePath;SinPath.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;e=n*this.duration;var r=e*this.v/1e3+this.x1;var a=this.amplitude*Math.sin(n*this.range+this.phaseOffset)+this.y1;return{x:r,y:a}};SinPath.create=function(t,e,i,n,r,a,o,s){return new SinPath(t,e,i,n,r,a,o,s)};function Bezier3Path(t,e,i,n,r,a,o,s,h,l){this.x1=i;this.y1=n;this.x2=r;this.y2=a;this.x3=o;this.y3=s;this.x4=h;this.y4=l;this.duration=t;this.interpolator=e;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);return}Bezier3Path.prototype=new BasePath;Bezier3Path.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;e=n;var r=e*e;var a=r*e;var o=1-n;var s=o*o;var h=s*o;var l=this.x1*h+3*e*this.x2*s+3*this.x3*o*r+this.x4*a;var u=this.y1*h+3*e*this.y2*s+3*this.y3*o*r+this.y4*a;return{x:l,y:u}};Bezier3Path.prototype.draw=function(t){t.moveTo(this.x1,this.y1);t.bezierCurveTo(this.x2,this.y2,this.x3,this.y3,this.x4,this.y4)};Bezier3Path.create=function(t,e,i,n,r,a,o,s,h,l){return new Bezier3Path(t,e,i,n,r,a,o,s,h,l)};function Bezier2Path(t,e,i,n,r,a,o,s){this.x1=i;this.y1=n;this.x2=r;this.y2=a;this.x3=o;this.y3=s;this.duration=t;this.interpolator=e;this.startPoint=this.getPosition(0);this.endPoint=this.getPosition(t);return}Bezier2Path.prototype=new BasePath;Bezier2Path.prototype.getPosition=function(t){var e=t;var i=Math.min(e/this.duration,1);var n=this.interpolator?this.interpolator.get(i):i;e=n;var r=e*e;var a=1-n;var o=a*a;var s=this.x1*o+2*this.x2*e*a+this.x3*r;var h=this.y1*o+2*this.y2*e*a+this.y3*r;return{x:s,y:h}};Bezier2Path.prototype.draw=function(t){t.moveTo(this.x1,this.y1);t.quadraticCurveTo(this.x2,this.y2,this.x3,this.y3)};Bezier2Path.create=function(t,e,i,n,r,a,o,s){return new Bezier2Path(t,e,i,n,r,a,o,s)};function PathAnimation(t,e){this.startPoint={x:t,y:e};this.endPoint={x:t,y:e};this.duration=0;this.paths=[];return}PathAnimation.prototype.getStartPoint=function(){return this.startPoint};PathAnimation.prototype.getEndPoint=function(){return this.endPoint};PathAnimation.prototype.addPath=function(t){this.paths.push({path:t,startTime:this.duration});this.endPoint=t.getEndPoint();this.duration+=t.duration;return this};PathAnimation.prototype.addLine=function(t,e,i,n){return this.addPath(LinePath.create(t,e,i.x,i.y,n.x,n.y))};PathAnimation.prototype.addArc=function(t,e,i,n,r,a){return this.addPath(ArcPath.create(t,e,i.x,i.y,n,r,a))};PathAnimation.prototype.addPara=function(t,e,i,n,r){return this.addPath(ParaPath.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};PathAnimation.prototype.addSin=function(t,e,i,n,r,a,o){return this.addPath(SinPath.create(t,e,i.x,i.y,n,r,a,o))};PathAnimation.prototype.addBezier=function(t,e,i,n,r,a){return this.addPath(Bezier3Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y,a.x,a.y))};PathAnimation.prototype.addQuad=function(t,e,i,n,r){return this.addPath(Bezier2Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};PathAnimation.prototype.getDuration=function(){return this.duration};PathAnimation.prototype.getPathInfoByTime=function(t){var e=0;var i=this.paths;var n=i.length;for(var r=0;r<n;r++){var a=i[r];var o=a.path;var s=a.startTime;if(t>=s&&t<s+o.duration){return a}}return null};PathAnimation.prototype.getPosition=function(t){var e=this.getPathInfoByTime(t);return e?e.path.getPosition(t-e.startTime):this.endPoint};PathAnimation.prototype.getDirection=function(t){var e=this.getPathInfoByTime(t);return e?e.path.getDirection(t-e.startTime):0};PathAnimation.prototype.draw=function(t){var e=this.paths;var i=e.length;for(var n=0;n<i;n++){var r=e[n];t.beginPath();r.path.draw(t);t.stroke()}return this};PathAnimation.prototype.forEach=function(t){var e=this.paths;var i=e.length;for(var n=0;n<i;n++){t(e[n])}return this};function Command(){this.count=0;this.doit=function(){this.count=this.count+1;console.log("command: doit "+this.count);return};this.undo=function(){this.count=this.count-1;console.log("command: undo "+this.count);return}}function CompositeCommand(){}CompositeCommand.prototype.init=function(){this.cmds=[];return this};CompositeCommand.prototype.addCommand=function(t){this.cmds.push(t);return this};CompositeCommand.prototype.destroy=function(){return this.clear()};CompositeCommand.prototype.clear=function(){this.cmds.clear();return this};CompositeCommand.prototype.doit=function(){for(var t=0;t<this.cmds.length;t++){var e=this.cmds[t];e.doit()}return this};CompositeCommand.prototype.undo=function(){for(var t=0;t<this.cmds.length;t++){var e=this.cmds[t];e.undo()}return this};CompositeCommand.create=function(){var t=new CompositeCommand;return t.init()};function CommandHistory(){this.listeners=new Array;this.redos=[];this.undos=[];this.maxUndos=20;this.setMaxUndos=function(t){this.maxUndos=t;return};this.clear=function(){this.redos.clear();this.undos.clear();return};this.notify=function(){for(var t=0;t<this.listeners.length;t++){var e=this.listeners[t];e.onChanged(this.redos.length,this.undos.length)}return};this.exec=function(t){t.doit();this.undos.push(t);this.redos.clear();this.notify();if(this.undos.length>this.maxUndos){var t=this.undos.shift();delete t}return};this.redo=function(){if(this.redos.length>0){var t=this.redos.pop();t.doit();this.undos.push(t);this.notify()}return};this.undo=function(){if(this.undos.length>0){var t=this.undos.pop();t.undo();this.redos.push(t);this.notify()}return};this.countRedo=function(){return this.redos.length};this.countUndo=function(){return this.undos.length};this.addListener=function(t){this.listeners.push(t);return};this.removeListener=function(t){this.listeners.remove(t);return};return}(function(){var root=this;if(!root.CanTK){root.CanTK={}}var gCantkBuildDate="2015年 09月 30日 星期三 10:30:39 CST";console.log("cantk build date: "+gCantkBuildDate);function webappInit(t){cantkRegisterUIElements();if(t===AppBase.TYPE_PREVIEW){document.body.style.overflow="scroll"}else{document.body.style.overflow="hidden"}return}function WebApp(t){var e=["main_canvas",t];AppBase.apply(this,e);webappInit(t);this.onCanvasSized=function(t,e){this.win.resize(t,e);this.view.resize(t,e);return};this.onSizeChanged=function(){var t=cantkGetViewPort();if(t.width===this.viewPort.width&&t.height===this.viewPort.height){console.log("onSizeChanged: size is not changed.");return}this.adjustCanvasSize();var e=this.canvas.width;var i=this.canvas.height;console.log("onSizeChanged: w="+e+" h="+i);this.manager.resize(e,i);this.win.resize(e,i);this.view.resize(e,i);this.view.resizeWindowManager(e,i);this.view.moveEditor();this.viewPort=t};this.exitApp=function(){if(isTizen()){tizen.application.getCurrentApplication().exit()}else if(navigator.app){navigator.app.exitApp()}console.log("exitApp");return};this.viewPort=cantkGetViewPort();return this}WebApp.prototype.runWithURL=function(t){var e={};var i=this;e.url=t;e.headers={};e.method="GET";e.noCache=true;e.onDone=function(t,e,n){var r=e.responseText;i.runWithData(r);return};httpDoRequest(e);console.log("dataURL:"+t);return};WebApp.prototype.createWindow=function(){var t=0;var e=0;var i=this.canvas.width;var n=this.canvas.height;this.win=WWindow.create(this.manager,0,0,i,n);this.view=WAppView.create(this.win,t,e,i,n,this);this.view.forPreview=this.type===AppBase.TYPE_PREVIEW;this.win.paintBackground=function(t){};if(!this.view.forPreview){this.view.paintBackground=function(t){}}var r=this.view;this.win.onGesture=function(t){return r.onGesture(t)};return};WebApp.prototype.showWindow=function(){this.view.showIt();this.win.showAll(1);var t=this.view.getMeta();if(t&&t.general){var e=t.general.appname;document.title=e;if(isIPhone()||isIPad()){var i=document.getElementsByTagName("title");if(i&&i.length){var n=i[0];n.innerHTML=e}}}return};WebApp.prototype.runWithData=function(t){this.createWindow();this.view.loadFromJson(t);this.showWindow();return};WebApp.prototype.previewWithDeviceData=function(t){this.createWindow();this.view.beforeLoad(t);this.view.fixDeviceConfig(t);this.view.meta=t.meta;this.view.device=ShapeFactoryGet().createShape(t.type,C_CREATE_FOR_PROGRAM);this.view.deviceJson=t;this.view.afterLoad(t);this.showWindow();return};WebApp.prototype.runWithDeviceData=function(t){this.createWindow();this.view.fixDeviceConfig(t);this.view.device=t;this.view.meta=t.meta;this.view.createWindowManager=function(){var e=null;var i=this.getWindowManager();e=i;this.beforeLoad(t);i=ShapeFactoryGet().createShape(e.type,C_CREATE_FOR_PROGRAM);i.fromJson(e);this.afterLoad(t);return i};this.showWindow();return};function webappRunWithData(t){var e=new WebApp(AppBase.TYPE_WEBAPP);e.runWithData(t);return e}function webappRunWithDeviceData(t){var e=new WebApp(AppBase.TYPE_WEBAPP);e.runWithDeviceData(t);return e}function webappPreviewWithDeviceData(t){var e=new WebApp(AppBase.TYPE_PREVIEW);e.previewWithDeviceData(t);return e}function webappPreviewWithData(t){var e=new WebApp(AppBase.TYPE_PREVIEW);e.runWithData(t);return e}function webappRunWithURL(t){var e=new WebApp(AppBase.TYPE_WEBAPP);e.runWithURL(t);return e}function webappPreviewWithURL(t){var e=new WebApp(AppBase.TYPE_PREVIEW);e.runWithURL(t);return e}function shapeFixImagePath(t,e,i){var n=e.version;var r=e.platform;var a=e.lcdDensity;var o=i.version;var s=i.platform;var h=i.lcdDensity;for(var l in t.images){var u=t.images[l];if(l==="display"){continue}var c=u;if(c){c=c.replaceAll("/"+n+"/","/"+o+"/");c=c.replaceAll("/"+r+"/","/"+s+"/");c=c.replaceAll("/"+a+"/","/"+h+"/");t.images[l]=c}}if(t.children){for(var p=0;p<t.children.length;p++){shapeFixImagePath(t.children[p],e,i)}}return}function WAppView(){}WAppView.prototype=new WViewBase;WAppView.prototype.init=function(t,e,i,n,r,a){this.app=a;this.type="app-view";WViewBase.prototype.init.call(this,t,e,i,n,r);this.forPreview=false;this.platform="windowphone";if(isAndroid()){this.platform="android"}else if(isIPhone()){this.platform="iphone"}return this};WAppView.prototype.clearBg=function(t,e){var i=this.rect;t.fillStyle=e;t.fillRect(i.x,i.y,i.w,i.h)};WAppView.prototype.showPageIndicator=function(t){return};WAppView.prototype.showLogo=function(t){return};WAppView.prototype.drawGrid=function(t){return};WAppView.prototype.onGesture=function(t){if(this.windowManager){var e=this.windowManager.getCurrentFrame();if(e){e.onGesture(t)}}return};WAppView.prototype.setTarget=function(t){for(var e=this.allShapes.length-1;e>=0;e--){var i=this.allShapes[e];if(t!==i){i.setSelected(false)}}this.targetShape=t;return};WAppView.prototype.onPointerDown=function(t){var e=this.translatePoint(t);this.pointerDownPosition.x=e.x;this.pointerDownPosition.y=e.y;this.lastPointerPosition.x=e.x;this.lastPointerPosition.y=e.y;this.updateLastPointerPoint(e);for(var i=this.allShapes.length-1;i>=0;i--){var n=this.allShapes[i];if(n.onPointerDown(e)){this.setTarget(n);break}}this.postRedraw();return};WAppView.prototype.onPointerMove=function(t){var e=this.translatePoint(t);this.updateLastPointerPoint(e);if(this.targetShape){this.targetShape.onPointerMove(e);if(this.targetShape.pointerDown){this.postRedraw()}return}return};WAppView.prototype.onPointerUp=function(t){var e=this.translatePoint(t);this.updateLastPointerPoint(e);if(this.targetShape){this.targetShape.onPointerUp(e);this.postRedraw()}return};WAppView.prototype.onKeyDown=function(t){if(!this.targetShape&&this.allShapes&&this.allShapes.length){this.targetShape=this.allShapes[0]}if(this.targetShape){this.targetShape.onKeyDown(t);this.postRedraw()}return};WAppView.prototype.onKeyUp=function(t){if(this.targetShape){this.targetShape.onKeyUp(t);this.postRedraw()}return};WAppView.prototype.extractDevices=function(t){this.devices=[];for(var e=0;e<t.pages.length;e++){var i=t.pages[e];for(var n=0;n<i.shapes.length;n++){var r=i.shapes[n];if(r.type==="ui-device"){if(!this.forPreview){r.images={display:0};this.fixDeviceConfig(r)}var a=ShapeFactoryGet().createShape(r.type,C_CREATE_FOR_PROGRAM);if(a){a.fromJson(r)}this.devices.push(a)}}}return this.devices.length};WAppView.prototype.getDevice=function(){if(!this.device){for(var t=0;t<this.devices.length;t++){var e=this.devices[t];var i=e.config;if(!e.config)continue;if(i.platform!=this.platform)continue;this.device=e}if(!this.device){this.device=this.devices[0]}}return this.device};WAppView.prototype.getScreen=function(){if(!this.screen){var t=this.getDevice();for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIScreen){this.screen=i}}}return this.screen};WAppView.prototype.getWindowManager=function(t){if(!this.windowManager){var e=this.getScreen();for(var i=0;i<e.children.length;i++){var n=e.children[i];if(n.isUIWindowManager){this.windowManager=n;if(t){e.children.remove(n);n.parentShape=null}break}}}return this.windowManager};WAppView.prototype.detectDeviceConfig=function(){if(this.detectedDeviceConfig){return this.detectedDeviceConfig}var t=cantkDetectDeviceConfig();t.screenW=this.rect.w;t.screenH=this.rect.h;this.detectedDeviceConfig=t;console.log("deviceConfig.lcdDensity:"+t.lcdDensity);console.log("deviceConfig.platform:"+t.platform);console.log("deviceConfig.screenW:"+t.screenW);console.log("deviceConfig.screenH:"+t.screenH);return t};WAppView.prototype.showIt=function(){if(this.forPreview){this.showDevice()}else{this.showWindowManager()}this.targetShape=this.getWindowManager();console.log("Set targetShape: "+this.targetShape.type);var t=this;setTimeout(function(){t.postRedraw()},500);setTimeout(function(){t.postRedraw()},1e3);setTimeout(function(){t.postRedraw()},2e3);setTimeout(function(){t.postRedraw()},3e3);return};WAppView.prototype.showDevice=function(){var t=0;var e=0;var i=this.rect.w;var n=this.rect.h;var r=this.getDevice();UIElement.disableGetRelativePathOfURL=true;var a=this.deviceJson?this.deviceJson:r.toJson();UIElement.disableGetRelativePathOfURL=false;var o=null;for(var s=0;s<a.children.length;s++){var h=a.children[s];if(h.type==="ui-screen"){o=h}}a.children.clear();a.children.push(o);this.device=r=ShapeFactoryGet().createShape(a.type,C_CREATE_FOR_PROGRAM);r.fromJson(a);var l=cantkGetViewPort();if(r.h<l.height&&r.w<l.width){e=(l.height-r.h)/2;document.body.style.overflow="hidden"}t=(i-r.w)/2;r.move(t,e);r.setMode(Shape.MODE_RUNNING,true);this.addShape(r);var u=this.getWindowManager();this.runApp(u);return};WAppView.prototype.getDeviceConfig=function(){var t=this.getDevice();return t?t.config:null};WAppView.prototype.resizeWindowManager=function(t,e){if(this.windowManager){this.windowManager.resize(t,e);console.log("this.windowManager.x="+this.windowManager.x);console.log("this.windowManager.y="+this.windowManager.y);console.log("this.windowManager.w="+this.windowManager.w);console.log("this.windowManager.h="+this.windowManager.h);var i=this.windowManager;setTimeout(function(){i.relayoutChildren();i.postRedraw()},200)}return};WAppView.prototype.moveEditor=function(){setTimeout(function(){cantkMoveEditorWhenResize()},300);cantkMoveEditorWhenResize();return};WAppView.prototype.createWindowManager=function(){return this.getWindowManager(true)};WAppView.prototype.fixDeviceConfig=function(t){var e=t.config;var i=this.detectDeviceConfig();if(this.app.type===AppBase.TYPE_PREVIEW){i.lcdDensity=e.lcdDensity;console.log("run in preview mode.")}if(i.platform!==e.platform&&i.version!==e.version&&i.lcdDensity!==e.lcdDensity){shapeFixImagePath(t,e,i)}return};WAppView.prototype.loadUserScripts=function(){if(this.meta){var t=this.meta.extlibs;var e=window.location.href.indexOf("appid=preview")>0;if(t){for(var i=0;i<t.length;i++){ResLoader.loadScript(t[i],e)}}}return};WAppView.prototype.runApp=function(t){this.loadUserScripts();t.systemInit();t.postRedraw();return};WAppView.prototype.showWindowManager=function(){var t=null;var e=this.rect.w;var i=this.rect.h;var n=this.detectDeviceConfig();t=this.createWindowManager();t.deviceConfig=this.getDeviceConfig();if(this.app.type===AppBase.TYPE_PREVIEW){n.lcdDensity=t.deviceConfig.lcdDensity}if(this.meta&&this.meta.general){var r=this.meta.general;var a=r.orientation;t.forcePortrait=false;t.forceLandscape=false;if(a==="landscape"&&t.w>t.h){t.forceLandscape=true}else if(a==="portrait"&&t.h>t.w){t.forcePortrait=true}t.screenScaleMode=r.screenscale}this.addShape(t);t.setDeviceConfig(n);t.setMode(Shape.MODE_RUNNING,true);t.move(0,0);t.resize(e,i);this.runApp(t);this.windowManager=t;console.log("w:"+e+" h:"+i);return};WAppView.prototype.getMeta=function(){return this.meta};WAppView.prototype.loadJson=function(t){this.meta=t?t.meta:null;this.beforeLoad(t);if(!t||!t.pages||!this.extractDevices(t)){console.log("It is not a valid webapp.");return}this.afterLoad(t);return;var e=t.docid;var i=document.createElement("script");i.src="http://appusage.duapp.com/count?appid="+e;var n=document.head?document.head:document.body;n.appendChild(i);return};WAppView.create=function(t,e,i,n,r,a){var o=new WAppView;return o.init(t,e,i,n,r,a)};function dappGetText(t){return t}function dappIsEditorApp(){return false}if(isWeiXin()){document.addEventListener("WeixinJSBridgeReady",function t(){})}window.webappSetLocaleStrings=webappSetLocaleStrings;window.webappPreviewWithURL=webappPreviewWithURL;window.webappPreviewWithData=webappPreviewWithData;window.webappPreviewWithDeviceData=webappPreviewWithDeviceData;window.webappRunWithURL=webappRunWithURL;window.webappRunWithData=webappRunWithData;window.webappRunWithDeviceData=webappRunWithDeviceData;var gCanTKLogoImageSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAACXCAYAAADqD16ZAAAABGdBTUEAALGPC/xhBQAACjtpQ0NQUGhvdG9zaG9wIElDQyBwcm9maWxlAABIiZ2Wd1RT2RaHz703vVCSEIqU0GtoUgJIDb1IkS4qMQkQSsCQACI2RFRwRFGRpggyKOCAo0ORsSKKhQFRsesEGUTUcXAUG5ZJZK0Z37x5782b3x/3fmufvc/dZ+991roAkPyDBcJMWAmADKFYFOHnxYiNi2dgBwEM8AADbADgcLOzQhb4RgKZAnzYjGyZE/gXvboOIPn7KtM/jMEA/5+UuVkiMQBQmIzn8vjZXBkXyTg9V5wlt0/JmLY0Tc4wSs4iWYIyVpNz8ixbfPaZZQ858zKEPBnLc87iZfDk3CfjjTkSvoyRYBkX5wj4uTK+JmODdEmGQMZv5LEZfE42ACiS3C7mc1NkbC1jkigygi3jeQDgSMlf8NIvWMzPE8sPxc7MWi4SJKeIGSZcU4aNkxOL4c/PTeeLxcwwDjeNI+Ix2JkZWRzhcgBmz/xZFHltGbIiO9g4OTgwbS1tvijUf138m5L3dpZehH/uGUQf+MP2V36ZDQCwpmW12fqHbWkVAF3rAVC7/YfNYC8AirK+dQ59cR66fF5SxOIsZyur3NxcSwGfaykv6O/6nw5/Q198z1K+3e/lYXjzkziSdDFDXjduZnqmRMTIzuJw+Qzmn4f4Hwf+dR4WEfwkvogvlEVEy6ZMIEyWtVvIE4gFmUKGQPifmvgPw/6k2bmWidr4EdCWWAKlIRpAfh4AKCoRIAl7ZCvQ730LxkcD+c2L0ZmYnfvPgv59V7hM/sgWJH+OY0dEMrgSUc7smvxaAjQgAEVAA+pAG+gDE8AEtsARuAAP4AMCQSiIBHFgMeCCFJABRCAXFIC1oBiUgq1gJ6gGdaARNIM2cBh0gWPgNDgHLoHLYATcAVIwDp6AKfAKzEAQhIXIEBVSh3QgQ8gcsoVYkBvkAwVDEVAclAglQ0JIAhVA66BS"+"qByqhuqhZuhb6Ch0GroADUO3oFFoEvoVegcjMAmmwVqwEWwFs2BPOAiOhBfByfAyOB8ugrfAlXADfBDuhE/Dl+ARWAo/gacRgBAROqKLMBEWwkZCkXgkCREhq5ASpAJpQNqQHqQfuYpIkafIWxQGRUUxUEyUC8ofFYXiopahVqE2o6pRB1CdqD7UVdQoagr1EU1Ga6LN0c7oAHQsOhmdiy5GV6Cb0B3os+gR9Dj6FQaDoWOMMY4Yf0wcJhWzArMZsxvTjjmFGcaMYaaxWKw61hzrig3FcrBibDG2CnsQexJ7BTuOfYMj4nRwtjhfXDxOiCvEVeBacCdwV3ATuBm8Et4Q74wPxfPwy/Fl+EZ8D34IP46fISgTjAmuhEhCKmEtoZLQRjhLuEt4QSQS9YhOxHCigLiGWEk8RDxPHCW+JVFIZiQ2KYEkIW0h7SedIt0ivSCTyUZkD3I8WUzeQm4mnyHfJ79RoCpYKgQo8BRWK9QodCpcUXimiFc0VPRUXKyYr1iheERxSPGpEl7JSImtxFFapVSjdFTphtK0MlXZRjlUOUN5s3KL8gXlRxQsxYjiQ+FRiij7KGcoY1SEqk9lU7nUddRG6lnqOA1DM6YF0FJppbRvaIO0KRWKip1KtEqeSo3KcRUpHaEb0QPo6fQy+mH6dfo7VS1VT1W+6ibVNtUrqq/V5qh5qPHVStTa1UbU3qkz1H3U09S3qXep39NAaZhphGvkauzROKvxdA5tjssc7pySOYfn3NaENc00IzRXaO7THNCc1tLW8tPK0qrSOqP1VJuu7aGdqr1D+4T2pA5Vx01HoLND56TOY4YKw5ORzqhk9DGmdDV1/XUluvW6g7ozesZ6UXqFeu169/QJ+iz9JP0d+r36UwY6BiEGBQatBrcN8YYswxTDXYb9hq+NjI1ijDYYdRk9MlYzDjDON241vmtCNnE3WWbSYHLNFGPKMk0z3W162Qw2szdLMasxGzKHzR3MBea7zYct0BZOFkKLBosbTBLTk5nDbGWOWtIt"+"gy0LLbssn1kZWMVbbbPqt/pobW+dbt1ofceGYhNoU2jTY/OrrZkt17bG9tpc8lzfuavnds99bmdux7fbY3fTnmofYr/Bvtf+g4Ojg8ihzWHS0cAx0bHW8QaLxgpjbWadd0I7eTmtdjrm9NbZwVnsfNj5FxemS5pLi8ujecbz+PMa54256rlyXOtdpW4Mt0S3vW5Sd113jnuD+wMPfQ+eR5PHhKepZ6rnQc9nXtZeIq8Or9dsZ/ZK9ilvxNvPu8R70IfiE+VT7XPfV8832bfVd8rP3m+F3yl/tH+Q/zb/GwFaAdyA5oCpQMfAlYF9QaSgBUHVQQ+CzYJFwT0hcEhgyPaQu/MN5wvnd4WC0IDQ7aH3wozDloV9H44JDwuvCX8YYRNRENG/gLpgyYKWBa8ivSLLIu9EmURJonqjFaMTopujX8d4x5THSGOtYlfGXorTiBPEdcdj46Pjm+KnF/os3LlwPME+oTjh+iLjRXmLLizWWJy++PgSxSWcJUcS0YkxiS2J7zmhnAbO9NKApbVLp7hs7i7uE54Hbwdvku/KL+dPJLkmlSc9SnZN3p48meKeUpHyVMAWVAuep/qn1qW+TgtN25/2KT0mvT0Dl5GYcVRIEaYJ+zK1M/Myh7PMs4qzpMucl+1cNiUKEjVlQ9mLsrvFNNnP1IDERLJeMprjllOT8yY3OvdInnKeMG9gudnyTcsn8n3zv16BWsFd0VugW7C2YHSl58r6VdCqpat6V+uvLlo9vsZvzYG1hLVpa38otC4sL3y5LmZdT5FW0ZqisfV+61uLFYpFxTc2uGyo24jaKNg4uGnupqpNH0t4JRdLrUsrSt9v5m6++JXNV5VffdqStGWwzKFsz1bMVuHW69vctx0oVy7PLx/bHrK9cwdjR8mOlzuX7LxQYVdRt4uwS7JLWhlc2V1lULW16n11SvVIjVdNe61m7aba17t5u6/s8djTVqdVV1r3bq9g7816v/rOBqOGin2YfTn7HjZGN/Z/zfq6uUmjqbTpw37hfumB"+"iAN9zY7NzS2aLWWtcKukdfJgwsHL33h/093GbKtvp7eXHgKHJIcef5v47fXDQYd7j7COtH1n+F1tB7WjpBPqXN451ZXSJe2O6x4+Gni0t8elp+N7y+/3H9M9VnNc5XjZCcKJohOfTuafnD6Vderp6eTTY71Leu+ciT1zrS+8b/Bs0Nnz53zPnen37D953vX8sQvOF45eZF3suuRwqXPAfqDjB/sfOgYdBjuHHIe6Lztd7hmeN3ziivuV01e9r567FnDt0sj8keHrUddv3ki4Ib3Ju/noVvqt57dzbs/cWXMXfbfkntK9ivua9xt+NP2xXeogPT7qPTrwYMGDO2PcsSc/Zf/0frzoIflhxYTORPMj20fHJn0nLz9e+Hj8SdaTmafFPyv/XPvM5Nl3v3j8MjAVOzX+XPT806+bX6i/2P/S7mXvdNj0/VcZr2Zel7xRf3PgLett/7uYdxMzue+x7ys/mH7o+Rj08e6njE+ffgP3hPP74FSqLwAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH3wMbAh83mWfR6wAAFhxJREFUeNrtnXuMHVd9xz+/mbsPx7t+JE6c2F4nsWMHgsJLhfAohdBCiOMkJCoFSlFVUbVCILXiTyhqVP7gUZCgFVJR1QZREaWIV5K1eRYSoTSlpNAUaMImcZOs14/1c+31Pu69c779Y87dnb07c2fu9d2HnflJ48edmTPn/L6/95xzxiTtAy4D6oABNWKq+P8HwDngXWZ2igRJuhz4R2A78D4ze1ISZkYzSfoE8ArgI2b2jCQAzAxJBuwB/ha4x8y+1nTvTuCvgd2JfgLI968OPAR8wcyqiftC4OvAFYl7GmT+vmHgi2Y22fTMRt9uBP4OmAY+bGYH0sYoaRPwBeAq4BYzqyWvS7T3LuDjwD3ANwNgPeD8QAS82R9rfScF"+"bPKAzDXm6UPAncCr/EBSme/pNcDtwA8k7TGzRoca54eAlwK7Uu79EvB+oNf30xLCYcANwGeAW1KYvAd4gx/HrD9m/PEK4FPAW5of6Pu2Bvh7f/5W4JOSejPGuBZ4JXAz8Iik/sb4Esy/CfgacCNwTYOZ6yVdKmmjpEFJhySdlPRq/9ul/hprQvwqxfSgpAf8vz/WBFDy+vs0T1OS7kmcM0kf8Of+IuXeX/h7Xun7tFHShsSxV9I9knY13RdKOujHc40f36CkAUlrJX3aP/PdaRyVdJc//1FJ3/L/fmPG+LZI+q/EGD+X5JmkqyU9nTj/obR2kDQuaULSdRmdavz9P5KmJd0t6Trf6K8lXZFx3/2SnpP0N4lOfNYzyST9WQsA/kPSrKQdCcAGJa3zfwcp2tkAYEzSCUkbU9r9rH/me5rHKKlf0uP+/HoPviQ9kiZkHoBfStov6fv+2lt9WxVJX/K/fcX//eG2AUgw/48kOUnfSZz7sm/4E55BaQCc8B29TdJZf/19npF3FQBgp///9iZpatD7MzRAkn4l6b99W49K+s/EfbekjPGd/twHfTuDXtsl6W0pYDcAeFhSn9fYqqQrvYZK0tv82OcAqNAGeTu2AfiIt68VSZ8Eerx9xp/7JzN7LqWJPmCjme2T9LvAl4H3eif5vYTdzqMT3ilv9rb97d5GK+N6B4wAkfcTg8Bx4HPAMeDfG3baj7EP+BegCvwWcL1vu9+3d7+kLWY2m/Kc7WY2K+lPga8CDwA7fZDwA9/vbCpggt6tfLovRULul3RG0g3JKErSY/6eyRYa8DMvUZsz+vSBFhow5n3AVm9W3pmQzj0ZGn5/gTHe23TPFklPSPpNor2v+mvHJV3tf7snqQFByniSUUbzQNf58KnuvfgGYGPieANwGnivpBuaooUFbfqOHzOz1wPf8lFE4/nNFAJrgG9I+oGkHyaO7wN/5a+bzRhPjw+vZ8zs28C7vDbsk/R5D0xD+n8beAdw1kdm6xPjWwu8x2vDrZJuSoyx"+"Mb4wYTHeB4wBf2lmz6dEaKmDPQ0cylDnD3pz8SEze97MJszsdOJ4DPi0V/dvNN17zndGDXPWyAHM7G7gk/78TMpzPwM87WPsHcC1iWOnF4hHE2as2VwdAdQIC81snw9Pnwb+EPgHoFdSL/DHwBngY2Z20MzOJMY3ZWb/Cnzfm6c/8Pc0cpJRDxyJPGebmd2XiIiqvj9nyZDyrR6Yw2ZWbzq3w/9z1MxqGYlLnwepH3jWzJw/f5mXoMPN9yba2A6cMrOzKe1u8venCYYBB80sak5+gMZ4xhJ9abR5hfcHg8CvfFtbgTAr4fL39wHbvFaN+eeG3ic5MzvS9Jxkn9b5vOpYAwTSQrisCKjVtVm/5d1bpO1uU5FntDPGIm2n/W6je3dfksxyS1pWqlWAe32oVS/5sazUC+yreOnfUfJjZSjwkUBJK0PPBD4kKmll6GgAHC35sGI0XmpAqQEXKRVLZcYrPlW/YMmCtga8TJ2K/5Br2akJIKr4dPqULzZdOAKmmPmDV8W1L7lVBoCMs4dbplYnGgA44OSFBsAiibfVxX/nRFYtydPJBgARcQX0wra1q8gEycBFiv+RLRinABd4DThWes0uW6B8k3gciAKvASdLtnUXAUW5V51MAnCq5FqXzVC+BiwwQaUGdFMBGj6gIADRhZ4LrMa4oIAGHB4aHlEwNDwCMF6yrbtOIAeAKjAJ8y/lz5I+o6CkpfEB08STFOYAOEf6bISSOrRBOWWImWYNKAHoqvQLqWV2PtOsAZNeLUrqQgQUe+FcEzR5YQNgrKr6T3MSJrXs3pwPaExHmercBMX1Dp2dAFfHLFjysowRZy8KwQ1Y0dS/qz2wwY2xuKfM9XFSnF2FmQ3MNgNwruMoSA5kBNt3QaUHojq2HJLp4nJ0uLUfk3BaHoUQ8bRKd3wMXD3xQsJDExQqQ5wbGh6ZngNgaHhkenTv7nMd9Siqo8nT9H/phwSbN+d5/27ynwAYtHnGLJ+dD5j485eh2gzWP7A4B4iUZ4ION/6RnBHX"+"2avJSgWqs7j/exLbOoSOHWM5VEDOQRDApk3zZmm5opwTh9HUBKwZTBcOl6tEpwBG9+4mGN27u3HieEeCZAHUqujUClS0bWW8sDt9FM1MYWH6jE5FLcMg4cv/Q8MjNEoR+B/VERPqETrx4nm3704dgdosBCle1hQHBEYuAMkwFOKCXGemNDQ49eJ5p+NOj3sHnDZ1vRGRWSsATqQBcKQjAASEPbgGAGYXPQA6dTg92LA4OnBRLhuOpgHwv51pgKC3H06O+3Xr4cWvASePYD29i7hl5qPy1jGxvL9dBMCxjk1QTy+aOAEzVQhfBACcPgqV3nTuKjU3a6bFAAwNj5wkfjnTPvX2obOn0PRZrNJz8ZugiePQu2aRvJrFEZBcSxN0cmh4ZDxNAxp+oM3eKFbHs6dh8jQENi8G3TpWHQDHsN6+1BKFXK4deaaRA8wlYqN7d+PD0SPEKw/bjIIq6MxpENiafujv71qYr5pDJ8bjhG+1mKAzJ6DSt1g4LHbAOQCMN3KAZCmicw1oJGO9vdQffoBgxw0wPd2d1HTqLAztIth9I8y0XyusP/dLdPygLxd0QZMsjHOAqI6tWZudhFnLlwGHFhQSmk6OdlqQs81D1L74cZiegjDowmBBBxyVD76fvk99BU1Ptx3iztz7UWYeGCbc3gPdqlFVegiu3OnDHS0KcApUZQ+2AqDztQK1KnbldrpWGgsCsBHssis6b2LTVsKr+wiu2tW9erXwdib9VFwJbSkoLTVg7DwrZF30dPIj0nm2YcvnzBVPys1R1MMLhKSVepTUnsmkUYZoDcBYKwDK5Urnw39fhqBgGaIEoMsIyMU+oIUJqg8Nj5zIBMBnw7WSmx26gCjXZ40nk7A0DZi7qKROfL7yfP3RprwrFYByscb5BIGt7f8i3gZ5YVJJbZQo2swBsgAoHXHHPkB5FZgjRQAofcB55H05CIwXAeBQycrziIKs1IAVdcI5Jmi8BGDJzI8VyYILaUDphDtCIDcJmwJmkknYIgD8ybnFAyW1"+"54FzkrAJoJZMwtJKERBv3nem5GgHEVBrAM6QUuZJM0E1j1ZJRckSy5Ky6XQ7AJwuudoW/4u8izpdasBSakD+jKqJUgOWiv/m9wfqIgClBnSgATlJ2BlSdifOAqCMgtpEoIAPODo0PKJcABIz5EpqIwnLAaBOxo40QQt7VW7m3Q4GTq3ygGqWVckC4CTl5h1tJGG5y5JqNH+sIQeAMV+7KKlQEgByLV1wrV0NOF1qQPEQVM6vjs/GYLZdH3CWcnpKYXIOrPW7gMYHjAoDcKYEoI0cwDU+DZV51czQ8EhxHzA0PDJJuX9QQRM0vzVBC8p8yRV0clNJi01QTh3iGCycEZcJQOKiclv7omFoRB4CC5YlFcmE51ArqQAA9dy1B0c6MUGlBhTLwojq5C2fGi8BWKocwO+QaNZ9DSjniBZRAOedcBvLksooqMs5APkTso6VACyRDSqwRygk9oYofUB3FcCviml52cmh4ZGZtgEYGh6pUW5rX8gH5KTBR7OSsEwAEheXb8Zasx/niuUAaUlYJgCJi1d+qrrO5ys9WmL2N6akt3QALdde523qsLKhaN1ha9fH/q23P94Kp539IvoHIFraom6BELSlEOftAbNyGuAEV24l+slDVAcGCF/xemzbtdi6KwCH1WpQXezb3MkjuGMvUH/yMWq/+gm2advSbVOgQsuSDp8PAKMraHuwSwbRxHFq//wpamFIsPEKgpe/jvB1b4WXvIbgmp0x048fpP7rR6k98WPqv/kpOnU03sHlkkFszUDuTqod5wANJxx0zsPVqwEQLzvs6cPWx5sjqTpN/eEHqT94LwxsIHrTHs5dKmqPfxdNTmDrNsVMH1g/bxfc0uzq3ZgPWmBVzHlpwOrJBSzer97WbYD1l6Jajdq/fZ3atgp22RZsw5UxYMu8xVmBLSrHL1wNyIqKFEEQEFy5neDyEORQtPzTmOb2h7PONSAvClq9eYC8eXFuxb4jWSAJOwXMZiVhLQHwN9UpZ0q3UEYVqgFlJWF5pYiGnJVF"+"uSwAIuIdubIp961ikd31SgCywlCXx3+O5qXjeU54wU7fJcURj1X8dBTn8kLQXN4V2Q31SMl0sDA2N1FN1CdFbcYRVdX8CZkl0YBjLzZmLxBrQX1W1KagXo1wtcZaABGE1vbmHJ1owEVvgizwB4aLhKtBfUbxUW3ajNUgqEDBrYFPlhqQZ8vxZmVK1GZFfdrFUo6w0OLrOt8I+FCrEDQ3CvI3P3cxmRYLIAjjjTVmTonJIxFnD0VMjjtmJqK4tFCBoGLn+zGQOgW2fChigs74jG7jhRYmWmAYmvuuS1T1pmU2tuWNOZ0WQtBT2KwUpUITnIsA8BvgZn+8HXgLsGY1liYs9ObCz1iOZuOjNi2iquLM1X960ViSr62cBX4MfBd4BP+tgPMFoDo0PPIE8ATw+dG9u/s9CHcBe4EtKy7sYWwyopqoTUN9xlGfdvHLMPloJYhj9yWg54B9wDeAR4eGR6pN5Zw8RS1OiQ89JH+7xWvGzcDl/uhbcoF3sa0e3FwhmnFUp+OoJaqDSdj52/A0mvFByVEv6fuHhkcezuNR1wDIAacCvBTYDdzkj1cDA8sBhuRDye4zfQJ43B8/9Sb5ybRF1x26qq4wfwHqo3t3h57x64HXALcDdwIblsL2L8GHJI8D3wYeBH7hA5HJoeER16mkL7kGFDRXdwK/703WOqCHVl/dXR6q++ME8D3ga0PDI987H7OyKgAoANBrgd/xx7XA1cDgMj1+AngeOOCjlUeGhkd+sULR8rIzvtlcAWz3ALzcO/O3LkHecRT4kWf4L4EXhoZHDi6XpK86DcgAw4Be4BLg94C7vf9Y2+EjTns7/k3P+CnijfO0kkxfNQC0AdQbgHcC7wCu8g6++WNl0z77HPNx+beHhkcevwAS9lXN+EXSefD263fLeC3iJqRXAQ6znwseC8x+tu3Bpw6stFm5KGn09usXx4p7dm86duvuyxZde8f1F1LJanXSgduuY8e+haWUsVt2WK0nsJAgtMCCKIirOaFzkaTIybmrh59Z"+"NBXuwN6d7Bh+tgQgSc/fdh1X73sm5fedKAgtDIJ4DxhnoRmBTKERhCYFLi6jB6a5crrDcAZOmBOKLP4yrJPJQeCcHOYibd/3bOG+XFQAvLBnF9v3P73o96fevoW1fYOBAswUM1XxR9KDOElTgMxAgd+TKgDU2KcndVBmQkgmZ5gkIg9QJMPJcEGEpqem3a4fvVC4rxeFBhy6bZfVKhYYFgSxBIeKGR9iMmSBDDMpnvKhBcUGtTGu+D7/L18Jjd8MyCQjMsOBRQ45mVxPTW7L/qd1QWjAc3uu45r9C9X2uVt3YJWQgABD4BQzMwgaUh0iAkSAEcSzamyex9nT/NTE2IWMnmd1c4UotVJkFj/TNPdSXQinwGsJOCDCyZmTCOPdgOpyEEVc850Dyw/A2J5dbG1Sy5E3bWPNuj4UBGZBYDgMFJgsIPDMhkCxGcGQealuV6JzR5DcPNvaF634loYsYJIJw5z3LxEO57yfIUARTkHNafv+xT5l7NZdbP3O093XgMM3baF6+RoLrccUEuBkJsKYoQow88xe0LalSDIp0toOScLCHqN/wJAhV8dcXfGshmhu/a5wC3XD0kfe3IfFfbbGJDhziHharnlwAkSEq6uu/kNndNXPjyUE9zq27n+mMwCeffMlhJV+qwxcGUA0J9E4NSrvQbxSRPOKvEwkQdhnDGwIsJ55DWh8z9FF8fKhqC5cXSjyE6mbNaUTbWkYPrP4283xgipZMKcxTrKoMjUZXfXD0c414ODdN0LkKorqfWaE8QjNZAv2yFyRyeENANauTwBgKYz1ywliUGJAVCf+O/Lfee6C+YqfZbH1wpAssjCcJaC+7Vu/zry55TthuTrIBXEI6BdFxYqd5SAL8y/l+qx2irevVImQhRBWsFBGj8x/9zeOh1wkXF3m6gnNaWw/oPmettAWzf8pL6MACqTIrPV2ljkv5esufrYhKXftT7uaoC79XgyQpNjMzYSDEIudrgC/5svVRTRnwhKguCZQLFs9fdBreWzLhGf0jt0N"+"KPtAFbS6yhapJqgLEZU1BbuNT9RGdXB1h4sS5qvVjumGkNWBWTOx7aGR9n3A6B27DUcvRmWllgEtKwBZgDRplXOx2509J6pTrSTT6maqbnso+wV+axMUlwBaJUJp2ScZSZAKZK7ZyVb2/ynYbvvPUZNbsdgcByFYaFR6oTYjiOLf09rJMxyVIkKQcLsqaNPb3eBBLYDK+387fub8nqOENHofYHOud/F9PlptKTBBIRlabdT4aFrk5icFrUAXfFbUImrQeWuASavA+kvzM2nlDzMU9MYDdBFysR2Ym521RLO0Fkiv5c++y5PwVAAO3vkStj3w1IJgYMWYX6/Hi7CDAHr7sYF12KWbCa7YSu+WbfQO9mITh4jGR4lOHkbnJqA6HQNW6cHCyhIi0HLtgMem9TK+1N5te+Apxu56qbmas5TKYpHajTJqKs33Z7U1Vx61jZss2HotNnQdwebtBJu3YpdvQQMb1Ltug/UNrCWMqmjiuKLjY6bx54mOHCA6NEI09gyaPNWJHc0foxqKZvh6RPO4VID/2SYoqjsC5tIIdcG5Zt2f3lYUiZ4egpe/Tr13/Als3QFhBSxAclCvoUpFVHqhpxfrH6Cy+RrxsjfSA3DkAFMPfpHaz/b7rQ3Cjsx8S/tssWJicRKXiIQK+9CgpfOde52RCUAzI9VmhNPc1sJnWQCXDErrNqKeHqk6K82cEzNToladT1MX3hsf6y5TsGYQWcq57GdmjSn9MGQBssXtkShMMHr79da2BlhCzaSWzC8SJuaB4FJzBimuCdSqolZtMLuYlFanUVRrZQDUZh/TY3RvgrTQ2CiZEbRy1JVWrcfNLpsD7vJzlid+DnywJetsRNkmyDkzVlsBYvWRmeWuolRHeYBZYzcQlTC0AKARimbETXnhVCUnAyuZXwiAnPJUi0w9aKE2sgtj7u4KI9B6N824SmftAzA/36OkltmaxZXRrBqtcrxApaXjKO1/G6Fopi1vmQ0HSxwYauVldGn7pcZeEpbN/5p6M5/3/0AEyIegdW3GAAAAAElFTkSuQmCC";
var gCanTkProgressBarBgSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAYCAYAAAA/OUfnAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAlSURBVHjaYvj//z8DDDPQi8PAwPAfCZPOGRBXI3MAAAAA//8DAGr0uUcMH0twAAAAAElFTkSuQmCC";var gCanTKProgressBarFgSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAVCAYAAACDp1Q5AAAACXBIWXMAAC4jAAAuIwF4pT92AAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABESURBVHjaYvz//z8DDDA+D1NkgXFYGBgYWJE57Dg5HMgcTpwcXMq0GfYiOFcZnJGVfUfm/MApg1vZT5yc33BvI4cBYAAdfxGoWJfDUwAAAABJRU5ErkJggg==";if(!window.CanTK){window.CanTK={}}window.CanTK.config={logoImageSrc:gCanTKLogoImageSrc,progressBarBgSrc:gCanTkProgressBarBgSrc,progressBarFgSrc:gCanTKProgressBarFgSrc};function Shape(){return}Shape.MODE_EDITING=0;Shape.MODE_RUNNING=1;Shape.MODE_PREVIEW=2;Shape.HIT_TEST_NONE=0;Shape.HIT_TEST_TL=1;Shape.HIT_TEST_TM=2;Shape.HIT_TEST_TR=3;Shape.HIT_TEST_ML=4;Shape.HIT_TEST_MR=5;Shape.HIT_TEST_BL=6;Shape.HIT_TEST_BM=7;Shape.HIT_TEST_BR=8;Shape.HIT_TEST_HANDLE=9;Shape.HIT_TEST_WORKAREA=10;Shape.HIT_TEST_ROTATION=11;Shape.HIT_TEST_MOVE=12;Shape.HIT_TEST_MAX=13;Shape.HIT_TEST_MM=-1;Shape.ALIGN_LEFT=1;Shape.ALIGN_RIGHT=2;Shape.ALIGN_TOP=3;Shape.ALIGN_BOTTOM=4;Shape.ALIGN_CENTER=5;Shape.ALIGN_MIDDLE=6;Shape.ALIGN_TO_SAME_WIDTH=7;Shape.ALIGN_TO_SAME_HEIGHT=8;Shape.ALIGN_DIST_VER=9;Shape.ALIGN_DIST_HOR=10;Shape.STAT_CREATING_0=0;Shape.STAT_CREATING_1=1;Shape.STAT_CREATING_2=2;Shape.STAT_NORMAL=3;Shape.TEXT_NONE=0;Shape.TEXT_INPUT=1;Shape.TEXT_TEXTAREA=2;Shape.prototype.setNearRange=function(t){this.nearRange=t;return this};Shape.prototype.getNearRange=function(){return this.nearRange?this.nearRange:20};Shape.prototype.findNear=function(t){return null};Shape.prototype.getCreatingShape=function(){return this.view?this.view.getCreatingShape():null};Shape.prototype.getTextCookie=function(t){return 0};Shape.isTransparentColor=function(t){return!t||t==="rgba(0,0,0,0)"};Shape.prototype.isFillColorTransparent=function(){return Shape.isTransparentColor(this.style.fillColor)};Shape.prototype.isStrokeColorTransparent=function(){return Shape.isTransparentColor(this.style.lineColor)};Shape.prototype.isTextColorTransparent=function(){return Shape.isTransparentColor(this.style.textColor)};Shape.prototype.setParent=function(t){this.parentShape=t;return this};Shape.prototype.getParent=function(t){if(t){for(var e=this.parentShape;e!=null;e=e.parentShape){if(e.name===t||e.type===t){return e}}}return t?null:this.parentShape};Shape.prototype.textEditable=function(t){return true};Shape.prototype.setInputType=function(t){this.inputType=t;return this};Shape.prototype.editText=function(t){if(this.textType&&this.textEditable(t)){var e=this.getPositionInView();var i=this.getRealScale();var n=this.view.rect.x;var r=this.view.rect.y;var a=e.x*i+n;var o=this.getWidth()*i;var s=this.getHeight()*i;var h=this.getTextCookie(t);var l=this;var u=null;var c=this.text;var p=this.inputType?this.inputType:"text";if(this.textType===Shape.TEXT_INPUT){var f=e.y*i+s/3+r;if(o<60){o=60}u=cantkShowInput(p,12,c,a,f,o,24)}else{var f=e.y*i+r;if(s<60){s=60}u=cantkShowTextArea(c,12,a,f,o,s)}l.editing=true;function m(t){if(l.text!==t){l.exec(new SetTextCommand(l,t,0));l.postRedraw()}u.hide();l.editing=false;u.setOnChangedHandler(null);return}u.setOnChangedHandler(m)}return};Shape.prototype.exec=function(t){if(this.app){this.app.exec(t)}else{t.doit();delete t}return};Shape.prototype.setTextTitle=function(t){this.textTitle=t;return this};Shape.prototype.initShape=function(t,e,i,n,r){this.w=i;this.h=n;this.x=t;this.y=e;this.type=r;this.text="";this.app=null;this.view=null;this.rotation=0;this.saveDx=0;this.saveDy=0;this.scaleX=1;this.scaleY=1;this.parentShape=null;this.pointerDown=false;this.selected=false;this.userMovable=true;this.userResizable=true;this.hignlighted=false;this.state=Shape.STAT_NORMAL;this.hitTestResult=Shape.HIT_TEST_NONE;this.lastPosition=new Point(0,0);this.selectMarkPoint=new Point(0,0);this.textType=Shape.TEXT_INPUT;this.setDefaultStyle();this.setTextAlignV("middle");this.setTextAlignH("center");return};Shape.prototype.setDefaultStyle=function(){this.style=new ShapeStyle;this.setStyle(Shape.getDefaultStyle());return this};Shape.prototype.setState=function(t){this.state=t;return this};Shape.prototype.setTextType=function(t){this.textType=t;return this};Shape.prototype.isSelected=function(){return this.selected};Shape.prototype.userRemovable=function(){return true};Shape.prototype.intersectWithRect=function(t){var e=false;var i=this.getX();var n=this.getY();var r=this.getWidth();var a=this.getHeight();var o={x:i,y:n};var s={x:i+r,y:n+a};var h={x:i+r,y:n};var l={x:i,y:n+a};return isPointInRect(o,t)||isPointInRect(s,t)||isPointInRect(h,t)||isPointInRect(l,t)};Shape.prototype.isThisInRect=function(t){var e=false;var i=this.getX();var n=this.getY();var r=this.getWidth();var a=this.getHeight();if(i>=t.x&&i<t.x+t.w&&(n>=t.y&&n<t.y+t.h)){e=true}return e};Shape.prototype.snapToGrid=function(t,e){var i=t;var n=e;if(this.view){return this.view.snapToGrid(t,e)}else{return{x:i,y:n}}};Shape.prototype.isClicked=function(){if(this.view){return this.view.isClicked()}return false};Shape.prototype.isAltDown=function(){if(this.view){return this.view.isAltDown()}return false};Shape.prototype.isCtrlDown=function(){if(this.view){return this.view.isCtrlDown()}return false};Shape.prototype.showIconPreview=function(t){return true};Shape.prototype.onMoving=function(){};Shape.prototype.onMoved=function(){};Shape.prototype.onSized=function(){};Shape.prototype.onUserMoved=function(t,e){};Shape.prototype.onUserResized=function(){};Shape.prototype.fixChildPosition=function(t){var e=this.w;var i=this.h;var n=t.x>=0?t.x:0;var r=t.y>=0?t.y:0;if(n+t.w>e){n=e-t.w}if(r+t.h>i){r=i-t.h}t.x=n;t.y=r;return};Shape.prototype.fixPosition=function(){if(!this.parentShape){return}this.parentShape.fixChildPosition(this);return};Shape.prototype.move=function(t,e){if(this.x!=t||this.y!=e){this.x=t;this.y=e;if(!this.isIcon){this.fixPosition();this.onMoved()}this.setPosition(t,e)}return};Shape.prototype.moveDelta=function(t,e){this.move(this.x+t,this.y+e);return};Shape.prototype.getWidth=function(){return this.w};Shape.prototype.getHeight=function(){return this.h};Shape.prototype.getPositionInScreen=function(){var t={x:0,y:0};var e=this.getRealScale();var i=this.getPositionInView();if(this.view){t=this.view.getAbsPosition()}i.x=t.x+i.x*e;i.y=t.y+i.y*e;return i};Shape.prototype.getRealScale=function(){return this.view?this.view.getScale():1};Shape.prototype.getAbsPosition=function(){var t=this.getPositionInView();if(this.view){var e=this.view.getAbsPosition();t.x=t.x+e.x;t.y=t.y+e.y}return t};Shape.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.parentShape;while(n!=null){t+=n.getX();e+=n.getY();n=n.parentShape}i.x=t;i.y=e;return i};Shape.prototype.getXinView=function(){var t=this.getPositionInView().x;return t};Shape.prototype.getYinView=function(){var t=this.getPositionInView().y;return t};Shape.prototype.getX=function(){return this.x};Shape.prototype.getY=function(){return this.y};Shape.prototype.align=function(t,e){return};Shape.prototype.setRotatable=function(t){this.rotatable=t;return this};Shape.prototype.setScaleX=function(t){this.scaleX=t;return this};Shape.prototype.setScaleY=function(t){this.scaleY=t;return this};Shape.prototype.getScaleX=function(){return this.scaleX!==undefined?this.scaleX:this.scale};Shape.prototype.getScaleY=function(){return this.scaleY!==undefined?this.scaleY:this.scale};Shape.prototype.setScale=function(t,e){e=e?e:t;if(t)this.scaleX=t;if(e)this.scaleY=e;return this};Shape.prototype.getRotation=function(){return this.rotation};Shape.prototype.setRotation=function(t){this.rotation=t;return this};Shape.prototype.getOpacity=function(){return this.opacity};Shape.prototype.setOpacity=function(t){this.opacity=Math.max(0,t);this.opacity=Math.min(1,this.opacity);return this};Shape.prototype.setStyle=function(t){this.style.copy(t);this.textNeedRelayout=true;return this};Shape.prototype.getStyle=function(){return this.style};Shape.prototype.setName=function(t){this.name=t;return this};Shape.prototype.getName=function(){return this.name};Shape.prototype.getLocaleText=function(t){return t};Shape.prototype.getLocaleInputTips=function(t){return dappGetText(t)};Shape.prototype.setNeedRelayoutText=function(){this.textNeedRelayout=true;return this};Shape.prototype.setTextAlignH=function(t){this.hTextAlign=t;return this};Shape.prototype.setTextAlignV=function(t){this.vTextAlign=t;return this};Shape.prototype.getTextAlignH=function(){var t=this.hTextAlign?this.hTextAlign:"left";return t};Shape.prototype.getTextAlignV=function(){var t=this.vTextAlign?this.vTextAlign:"top";return t};Shape.prototype.toText=function(t){if(t!==null&&t!=undefined){return t+""}else{return""}};Shape.prototype.setText=function(t){this.text=this.toText(t);this.textNeedRelayout=true;return this};Shape.prototype.setText2=function(t){this.text2=t;return this};Shape.prototype.setText3=function(t){this.text3=t;return this};Shape.prototype.getText=function(){return this.text};Shape.prototype.getApp=function(){return this.app};Shape.prototype.getView=function(){return this.view};Shape.prototype.setApp=function(t){this.app=t;return this};Shape.prototype.setView=function(t){this.view=t;return this};Shape.prototype.redrawSelf=function(){if(this.view){var t=this.getRealScale();var e=this.getPositionInView();var i={x:e.x*t,y:e.y*t,w:this.w*t,h:this.h*t};this.view.redraw(i)}return};Shape.prototype.postRedraw=function(t){if(this.view){this.view.postRedraw(t)}return};Shape.prototype.beforePropertyChanged=function(){return};Shape.prototype.afterPropertyChanged=function(){return};Shape.prototype.showProperty=function(){return};Shape.prototype.setSelectedMarkSize=function(t){this.selectedMarkSize=t;return};Shape.prototype.createSelectedMark=function(t,e,i,n){var r=this.selectedMarkSize?this.selectedMarkSize:10;if(n){r=r+r}t.rect(e-r,i-r,r*2,r*2);return};Shape.prototype.isInSelectedMark=function(t,e,i,n){t.beginPath();this.createSelectedMark(t,e,i);return t.isPointInPath(n.x,n.y)};Shape.prototype.paint=function(t){this.paintSelf(t);if(this.near){var e=this.near.point;var i=this.getNearRange();t.beginPath();t.arc(e.x,e.y,4,0,Math.PI*2);t.fillStyle="Red";t.fill();t.beginPath();t.lineWidth=2;t.arc(e.x,e.y,i,0,Math.PI*2);t.strokeStyle="Black";t.stroke()}return};Shape.prototype.paintSelf=function(t){return};Shape.prototype.setSelected=function(t){if(t){this.selectedTime=Date.now()}if(this.selected===t){return}this.selected=t;if(this.view&&this.view.onShapeSelected){this.view.onShapeSelected(this)}return};Shape.prototype.isVisible=function(){return true};Shape.prototype.findNearPoint=function(t){var e=null;for(var i=0;i<100;i++){e=this.getNearPoint(i);if(!e){break}if(isPointInRect(e,t)){var n={shape:this};n.nearPointIndex=i;n.point={x:e.x,y:e.y};return n}}return null};Shape.prototype.dup=function(){var t=ShapeFactoryGet().createShape(this.type,C_CREATE_FOR_PROGRAM);t.fromJson(this.toJson());t.state=Shape.STAT_NORMAL;return t};Shape.prototype.hitTest=function(t){return Shape.HIT_TEST_NONE};Shape.prototype.showProperty=function(){return};Shape.prototype.onLongPress=function(t){return};Shape.prototype.onGesture=function(t){};Shape.prototype.onDoubleClick=function(t){if(this.textType!=Shape.TEXT_NONE){this.editText(t)}else{this.showProperty()}return true};Shape.prototype.onPointerDown=function(t){this.pointerDown=true;this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.handlePointerEvent(t,C_EVT_POINTER_DOWN);return true};Shape.prototype.handlePointerEvent=function(t,e){return false};Shape.prototype.onPointerMove=function(t){if(this.hitTestResult){this.handlePointerEvent(t,C_EVT_POINTER_MOVE);return true}return false};Shape.prototype.onPointerUp=function(t){if(this.hitTestResult){this.handlePointerEvent(t,C_EVT_POINTER_UP);this.hitTestResult=Shape.HIT_TEST_NONE;return true}this.pointerDown=false;return false};Shape.prototype.onKeyDown=function(t){console.log("onKeyUp Widget: code="+t);return};Shape.prototype.onKeyUp=function(t){console.log("onKeyUp Widget: code="+t);return};Shape.prototype.canBeComponent=function(){return false};Shape.prototype.shouldShowContextMenu=function(){return true};Shape.prototype.toJson=function(){return null};Shape.prototype.fromJson=function(t){return this};Shape.prototype.afterApplyFormat=function(){return};Shape.prototype.applyFormat=function(t){if(!t){return}for(var e in t){var i=t[e];var n=typeof i;if(n==="function"||n==="object"||n==="undefined"){continue}if(e=="type"){continue}if(n==="number"||n==="string"||n==="boolean"){this[e]=i}}if(t.images){for(var e in t.images){var i=t.images[e];if(e==="display"){this.images[e]=i}else{var r=i.getImageSrc();this.setImage(e,r)}}}if(t.style){this.style.fromJson(t.style)}this.afterApplyFormat();this.textNeedRelayout=true;return};Shape.prototype.setUserMovable=function(t){this.userMovable=t;return this};Shape.prototype.setUserResizable=function(t){this.userResizable=t;return this};Shape.prototype.isUserMovable=function(){return this.userMovable&&!this.isLocked()};Shape.prototype.isUserResizable=function(){return this.userResizable};function splitText(t){t=t.replaceAll("\r\n","\n");t=t.replaceAll("\r","\n");return t.split("\n--\n")}Shape.onRestacked=function(t,e){};function restackShapeInArray(t,e){var i=0;var n=0;var r=null;var a=0;var o=null;for(var s=0;s<t.length;s++){r=t[s];if(r.selected){i++;if(!o){o=r;n=s}}}if(i>1||!o){return}a=n+e;if(a<0||a>=t.length){return}t[n]=t[a];t[a]=o;Shape.onRestacked(t,o);return}function getParentShapeOfShape(t,e){var i=t.parentShape?t.parentShape:t.container;if(!i){i=e}return i}function getParentShapeOfShapes(t){if(!t||t.length===0){return null}var e=t[0];var i=e.parentShape;for(var n=0;n<t.length;n++){var r=t[n];if(r.parentShape!=i){return null}}return i?i:e.view}Shape.prototype.getTextColor=function(t){return this.style.textColor};Shape.prototype.getBgColor=function(t){return this.style.fillColor};Shape.prototype.getLineColor=function(t){return this.style.lineColor};Shape.prototype.defaultDrawText=function(t){var e=this.getWidth(true);var i=this.getLocaleText(this.text);if(!i||this.editing){return}t.save();t.beginPath();t.lineWidth=1;t.font=this.style.getFont();t.fillStyle=this.getTextColor();t.strokeStyle=this.getLineColor();var n=i.split(/\n/);if(n.length<2){if(t.measureText(i).width<1.2*e){this.draw1LText(t)}else{this.drawMLText(t)}}else{this.drawMLText(t)}t.restore();return};Shape.prototype.draw1LText=function(t,e){var i=this.getLocaleText(this.text);if(!i||this.editing){return}var n=0;var r=0;var a=this.hMargin;var o=this.getWidth(true);var s=this.getTextAlignH();var h=this.getTextAlignV();var l=this.style.textU;var u=this.style.fontSize;var c=t.measureText(i).width;var p=0;var f=0;var m=Math.min(c,o);switch(h){case"middle":{r=this.h>>1;t.textBaseline="middle";if(l){f=Math.floor(r+u*.8)}break}case"bottom":{r=this.h-this.vMargin;t.textBaseline="bottom";if(l){f=r}break}default:{r=this.vMargin;t.textBaseline="top";if(l){f=Math.floor(r+u*1.5)}break}}switch(s){case"center":{n=this.w>>1;t.textAlign="center";if(l){p=Math.max(this.w-c>>1,0)}break}case"right":{n=this.w-this.hMargin;t.textAlign="right";if(l){p=Math.max(this.w-c-a,0)}break}default:{n=this.hMargin;t.textAlign="left";if(l){p=n}break}}if(l){t.moveTo(p,f);t.lineTo(p+m,f);t.stroke()}t.fillText(i,n,r,o);return c};Shape.prototype.drawMLText=function(t,e){this.layoutText(t);if(!this.lines){return}var i=0;var n=0;var r=0;var a=0;var o=0;var s=this.vMargin;var h=this.hMargin;var l=this.getWidth(true);var u=this.getTextAlignH();var c=this.getTextAlignV();var p=this.style.textU;var f=this.style.fontSize;var m=this.getTextLineHeight();var d=this.getTextHeight();t.textBaseline="top";switch(c){case"middle":{n=this.h-d>>1;break}case"bottom":{n=this.h-d-s;break}default:{n=s;break}}n=n<0?0:n;for(var g=0;g<this.lines.length;g++){var y=this.lines[g];if(!y||y==" "){n+=f;continue}if(n+m>=this.h&&!e){break}var v=t.measureText(y).width;o=Math.min(v,l);a=Math.floor(n+(f+m)/2);switch(u){case"center":{i=this.w>>1;t.textAlign="center";if(p){r=Math.max(this.w-v>>1,0)}break}case"right":{i=this.w-h;t.textAlign="right";if(p){r=Math.max(this.w-v-h,0)}break}default:{i=h;t.textAlign="left";if(p){r=i}break}}if(p){t.moveTo(r,a);t.lineTo(r+o,a);t.stroke()}t.fillText(y,i,n,l);n+=m}return};Shape.prototype.getTextHeight=function(){var t=0;var e=this.style.fontSize;var i=this.getTextLineHeight();if(!this.text||!this.lines){return i}for(var n=0;n<this.lines.length;n++){var r=this.lines[n];if(!r||r==" "){t+=e}else{t+=i}}return t};Shape.prototype.getTextLineHeight=function(){return Math.floor(this.style.fontSize*1.5)};Shape.prototype.setTextShadow=function(t){this.textShadow=t;return this};Shape.prototype.isValid=function(){return!this.isInvalid};Shape.prototype.canCopy=function(){return true};Shape.prototype.onDestroy=function(){};Shape.prototype.onRemoved=function(t){};Shape.prototype.destroy=function(){var t=this.parentShape;if(t){if(t.targetShape===this){t.targetShape=null}if(t.pointerEventTarget===this){t.pointerEventTarget=null}this.parentShape=null}if(this.container){this.container=null}this.app=null;this.view=null;if(this.children){this.children.clear(true);this.children=null}if(this.images){this.images=null}if(this.events){this.events=null}if(this.style){this.style=null}this.onDestroy();this.isInvalid=true;this.jsonData=null;return};var C_LINE_STYLE_0=255<<8|0;var C_LINE_STYLE_1=2<<8|4;var C_LINE_STYLE_2=4<<8|4;var C_LINE_STYLE_3=8<<8|8;var C_LINE_STYLE_4=10<<8|10;function resetShapeStyle(t){t.lineStyle=65280;t.lineWidth=2;t.lineColor="Orange";t.fillColor="White";t.textColor="Blue";t.fontSize=24;t.fontFamily="sans";t.arrowSize=12;t.firstArrowType=0;t.secondArrowType=0;t.textB=0;t.textI=0;t.textU=0;t.enableShadow=false;t.shadow={x:0,y:0,blur:8,color:"Black"};t.listener=null;return t}function createShapeStyle(){var t=new ShapeStyle;return resetShapeStyle(t)}function ShapeStyle(){}ShapeStyle.prototype.getFont=function(){var t="";if(this.textI){t="italic  "}if(this.textB){t=t+"bold "}t=t+this.fontSize+'pt "'+this.fontFamily+'"';return t};ShapeStyle.prototype.setListener=function(t){this.listener=t;return};ShapeStyle.prototype.notify=function(){if(this.listener){this.listener.setNewStyle(this)}return};ShapeStyle.prototype.setLineStyle=function(t){this.lineStyle=t;return};ShapeStyle.prototype.setLineWidth=function(t){this.lineWidth=t>0?t:1;return};ShapeStyle.prototype.setLineColor=function(t){this.lineColor=t;return};ShapeStyle.prototype.setFillColor=function(t){this.fillColor=t;return};ShapeStyle.prototype.setTextColor=function(t){this.textColor=t;return};ShapeStyle.prototype.setFontSize=function(t){var e=Math.max(t,6);this.fontSize=e;return};ShapeStyle.prototype.setFontFamily=function(t){this.fontFamily=t?t:"serif";return};ShapeStyle.prototype.setFirstArrowType=function(t){this.firstArrowType=t;return};ShapeStyle.prototype.setSecondArrowType=function(t){this.secondArrowType=t;return};ShapeStyle.prototype.setArrowSize=function(t){this.arrowSize=t;return};ShapeStyle.prototype.setTextB=function(t){this.textB=t;return};ShapeStyle.prototype.setTextU=function(t){this.textU=t;return};ShapeStyle.prototype.setTextI=function(t){this.textI=t;return};ShapeStyle.prototype.setShadow=function(t,e){this.enableShadow=t;this.shadow=e;return};ShapeStyle.prototype.getStrokeStyle=function(t){var e=this.strokeColor;return e};ShapeStyle.prototype.getGradFillStyle=function(t,e,i,n,r){var a=this.fillColor;if(!a){return"White"}if(typeof a==="string"){return a}else if(a.data){return a.data[0]}else{return"White"}};ShapeStyle.prototype.copy=function(t){var e=t.toJson();this.fromJson(e);return};ShapeStyle.prototype.toJson=function(){var t=new Object;for(var e in this){var i=this[e];var n=typeof i;if(n==="function"||n==="object"||n==="undefined"){continue}if(n==="number"||n==="string"||n==="boolean"){t[e]=i}}if(this.enableShadow){t.shadow=this.shadow}else{delete t.enableShadow}delete t.enableGradient;if(!this.textI){delete t.textI}if(!this.textU){delete t.textU}if(!this.textB){delete t.textB}delete t.textAlignment;return t};ShapeStyle.prototype.fromJson=function(t){resetShapeStyle(this);if(t.ls){this.lineStyle=t.ls;this.lineWidth=t.lw;this.lineColor=t.lc;this.fillColor=t.fc;this.textColor=t.tc;this.fontSize=t.fs;this.fontFamily=t.fm!=undefined?t.fm:"serif";this.arrowSize=t.as;this.firstArrowType=t.fat;this.secondArrowType=t.sat;this.textB=t.b;this.textI=t.i;this.textU=t.u;this.enableShadow=t.es}else{for(var e in t){var i=t[e];var n=typeof i;if(n==="function"||n==="undefined"){continue}this[e]=i}}if(this.enableShadow){this.shadow=t.shadow;if(!this.shadow){this.enableShadow=false}}return};ShapeStyle.prototype.dup=function(){var t=new ShapeStyle;t.copy(this);return t};ShapeStyle.prototype.equalTo=function(t){var e=JSON.stringify(this.toJson());var i=JSON.stringify(t.toJson());return e===i};Shape.defaultStyle=null;Shape.getDefaultStyle=function(){if(Shape.defaultStyle){return Shape.defaultStyle}Shape.defaultStyle=createShapeStyle();return Shape.defaultStyle};Shape.saveDefaultStyle=function(){var t=Shape.getDefaultStyle();var e=t.toJson();WebStorage.set("defaultShapeStyle",JSON.stringify(e));return};Shape.loadDefaultStyle=function(){var t=false;var e=Shape.getDefaultStyle();if(WebStorage.get("defaultShapeStyle")){var i=JSON.parse(WebStorage.get("defaultShapeStyle"));e.fromJson(i);t=true}return t};ShapeStyle.createFromJson=function(t){var e=new ShapeStyle;for(var i in t){var n=t[i];var r=typeof n;if(r==="function"||r==="undefined"){continue}e[i]=n}return e};Shape.iconShapeStyle=null;Shape.getIconShapeStyle=function(){if(!Shape.iconShapeStyle){Shape.iconShapeStyle=createShapeStyle();Shape.iconShapeStyle.setLineWidth(1);Shape.iconShapeStyle.setFontSize(8);Shape.iconShapeStyle.setLineColor("Black");Shape.iconShapeStyle.setFillColor("White");Shape.iconShapeStyle.setTextColor("Black")}return Shape.iconShapeStyle};function RShape(){return}RShape.selectMarkColor="Orange";RShape.setSelectMarkColor=function(t){RShape.selectMarkColor=t;return};RShape.prototype=new Shape;RShape.prototype.MIN_SIZE=10;RShape.prototype.isRect=true;RShape.prototype.initRShape=function(t,e,i,n,r){this.initShape(t,e,i,n,r);this.opacity=1;this.hMargin=0;this.vMargin=0;this.rotation=0;this.image=null;this.imageUrl="";this.lastPosition={x:0,y:0};this.pointerDownPosition={x:0,y:0};this.defWidth=200;this.defHeight=60;this.pointerDown=false;this.enable=true;this.visible=true;this.events={};this.pivotX=.5;this.pivotY=.5;if(i===0||n===0){this.w=this.MIN_SIZE;this.h=this.MIN_SIZE;this.setState(Shape.STAT_CREATING_0)}return};RShape.prototype.onPointerDown=function(t){this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y;this.postRedraw();if(this.onPointerDownCreating(t)){return true}return this.onPointerDownNormal(t)};RShape.prototype.onPointerMove=function(t){if(this.isLocked()){return false}if(this.onPointerMoveCreating(t)){return true}return this.onPointerMoveNormal(t)};RShape.prototype.onPointerUp=function(t){var e=false;if(this.onPointerUpCreating(t)){e=true}else{e=this.onPointerUpNormal(t)}this.pointerDown=false;this.postRedraw();return e};RShape.prototype.onPointerDownCreating=function(t){if(this.state===Shape.STAT_CREATING_0){this.state=Shape.STAT_CREATING_1;this.move(t.x,t.y);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.postRedraw();this.pointerDown=true;return true}return false};RShape.prototype.onPointerUpCreating=function(t){if(this.state!==Shape.STAT_NORMAL){var e=t.x-this.lastPosition.x;var i=t.y-this.lastPosition.y;if(this.isClicked()||!this.pointerDown){this.resize(this.defWidth,this.defHeight)}else{this.resizeDelta(e,i)}this.state=Shape.STAT_NORMAL;this.setSelected(true);this.postRedraw()}return false};RShape.prototype.onPointerMoveCreating=function(t){if(this.state===Shape.STAT_CREATING_0){this.move(t.x,t.y);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.postRedraw();return true}else if(this.state===Shape.STAT_CREATING_1){var e=t.x-this.view.pointerDownPosition.x;var i=t.y-this.view.pointerDownPosition.y;this.resize(e,i);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.postRedraw();return true}return false};RShape.prototype.onPointerDownNormal=function(t){this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.pointerDown=true;this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.handlePointerEvent(t,1);return true};RShape.prototype.onPointerMoveNormal=function(t){if(this.hitTestResult){this.handlePointerEvent(t,0);return true}return false};RShape.prototype.onPointerUpNormal=function(t){if(this.hitTestResult){this.handlePointerEvent(t,-1);this.hitTestResult=Shape.HIT_TEST_NONE;return true}return false};RShape.prototype.fixSize=function(){if(this.w<this.MIN_SIZE){
this.w=this.MIN_SIZE}if(this.h<this.MIN_SIZE){this.h=this.MIN_SIZE}if(this.wMin&&this.w<this.wMin){this.w=this.wMin}if(this.wMax&&this.w>this.wMax){this.w=this.wMax}if(this.hMax&&this.h>this.hMax){this.h=this.hMax}if(this.hMin&&this.h<this.hMin){this.h=this.hMin}if(this.whRadio){if(this.whRadio>1){this.h=Math.floor(this.w/this.whRadio)}else{this.w=Math.floor(this.h*this.whRadio)}}if(this.parentShape){this.parentShape.fixChildSize(this)}return};RShape.prototype.fixChildSize=function(t){var e=this.w;var i=this.h;if(t.x+t.w>e){t.w=e-t.x}if(t.y+t.h>i){t.h=i-t.y}return};RShape.prototype.setDefSize=function(t,e){this.defWidth=t;this.defHeight=e;this.w=t;this.h=e;return this};RShape.prototype.setSizeLimit=function(t,e,i,n,r){this.wMin=t;this.wMax=i;this.hMin=e;this.hMax=n;this.whRadio=r;return this};RShape.prototype.resizeDelta=function(t,e){this.resize(this.w+t,this.h+e);return};RShape.prototype.setPosition=function(t,e){this.x=Math.round(t);this.y=Math.round(e);return this};RShape.prototype.setSize=function(t,e){this.w=Math.max(Math.floor(t),2);this.h=Math.max(Math.floor(e),2);return this};RShape.prototype.resize=function(t,e){if(this.w!==t||this.h!==e){this.realResize(t,e)}return};RShape.prototype.realResize=function(t,e){t=Math.max(Math.floor(t),2);e=Math.max(Math.floor(e),2);if(this.w!=t||this.h!=e){this.w=t;this.h=e;this.textNeedRelayout=true;if(!this.isIcon){this.onSized();this.fixSize()}}return};RShape.prototype.translate=function(t){t.translate(this.x,this.y);return};RShape.prototype.setPivot=function(t,e){this.pivotX=t;this.pivotY=e;return this};RShape.prototype.applyTransform=function(t){if(!t.animating&&t.globalAlpha!==this.opacity){t.globalAlpha=this.opacity}else{t.globalAlpha*=this.opacity}if(this.offsetX){t.translate(this.offsetX,0)}if(this.offsetY){t.translate(0,this.offsetY)}var e=this.getScaleX();var i=this.getScaleY();var n=e!==1||i!==1;if(this.rotation||n){var r=Math.round(this.w*this.pivotX);var a=Math.round(this.h*this.pivotY);t.translate(r,a);if(n){t.scale(e,i)}if(this.rotation){t.rotate(this.rotation)}t.translate(-r,-a)}return};RShape.prototype.isPointIn=function(t,e){return isPointInRect(e,this)};RShape.prototype.getMoreSelectMark=function(t,e){return false};RShape.prototype.getRotateSelectMark=function(t,e){if(t===Shape.HIT_TEST_ROTATION){e.x=this.w>>1;e.y=-50;return true}return false};RShape.prototype.drawRotateSelectMark=function(t,e,i){var n=i?15:10;t.arc(e.x,e.y,n,0,Math.PI*2);t.moveTo(e.x,e.y+n);t.lineTo(e.x,0);return};RShape.prototype.getNearPoint=function(t){var e=this.getX();var i=this.getY();var n=this.getWidth();var r=this.getHeight();var a={x:0,y:0};switch(t){case 0:{a.x=e;a.y=i;break}case 1:{a.x=e+n/2;a.y=i;break}case 2:{a.x=e+n;a.y=i;break}case 3:{a.x=e+n;a.y=i+r/2;break}case 4:{a.x=e+n;a.y=i+r;break}case 5:{a.x=e+n/2;a.y=i+r;break}case 6:{a.x=e;a.y=i+r;break}case 7:{a.x=e;a.y=i+r/2;break}case 8:{a.x=e+n/2;a.y=i+r/2;break}default:{if(n>r){switch(t){case 9:{a.x=e+n/4;a.y=i;break}case 10:{a.x=e+3*n/4;a.y=i;break}case 11:{a.x=e+n/4;a.y=i+r;break}case 12:{a.x=e+3*n/4;a.y=i+r;break}default:{return null}}}else{return null}}}return a};RShape.prototype.getSelectMarkMobile=function(t,e){var i=true;switch(t){case Shape.HIT_TEST_TL:{e.x=0;e.y=0;break}case Shape.HIT_TEST_TR:{e.x=this.w;e.y=0;break}case Shape.HIT_TEST_BL:{e.x=0;e.y=this.h;break}case Shape.HIT_TEST_BR:{e.x=this.w;e.y=this.h;break}default:{i=this.getMoreSelectMark(t,e)}}return i};RShape.prototype.getSelectMarkPC=function(t,e){var i=true;switch(t){case Shape.HIT_TEST_TL:{e.x=0;e.y=0;break}case Shape.HIT_TEST_TM:{e.x=this.w>>1;e.y=0;break}case Shape.HIT_TEST_TR:{e.x=this.w;e.y=0;break}case Shape.HIT_TEST_ML:{e.x=0;e.y=this.h>>1;break}case Shape.HIT_TEST_MR:{e.x=this.w;e.y=this.h>>1;break}case Shape.HIT_TEST_BL:{e.x=0;e.y=this.h;break}case Shape.HIT_TEST_BM:{e.x=this.w>>1;e.y=this.h;break}case Shape.HIT_TEST_BR:{e.x=this.w;e.y=this.h;break}case Shape.HIT_TEST_ROTATION:{e.x=this.w>>1;e.y=this.h-100;break}default:{i=this.getMoreSelectMark(t,e)}}return i};RShape.prototype.getSelectMark=function(t,e){if(isMobile()){return this.getSelectMarkMobile(t,e)}else{return this.getSelectMarkPC(t,e)}};RShape.prototype.drawImage=function(t){return};RShape.prototype.paintShape=function(t){t.rect(0,0,this.w,this.h);return};RShape.prototype.setTextNeedRelayout=function(t){this.textNeedRelayout=t;return this};RShape.prototype.layoutText=function(t){if(!this.textNeedRelayout||this.textType===Shape.TEXT_NONE){return}t.font=this.style.getFont();var e=this.vMargin?this.vMargin:10;var i=this.w-2*e;if(i>0){this.lines=layoutText(t,this.style.fontSize,this.getLocaleText(this.text),i)}else{this.lines=[]}this.textNeedRelayout=false;return};RShape.prototype.drawTextUnderLine=function(t,e,i,n){var r=0;var a=0;var o=0;var s=0;if(!this.style.textU){return}s=t.measureText(n).width;if(this.textBaseline==="middle"){o=this.style.fontSize/2;if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}else if(this.textBaseline==="top"){o=this.style.fontSize;if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}else{if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}a=i+o;t.moveTo(r,a);t.lineTo(r+s,a);t.lineWidth=1;t.stroke();return};RShape.prototype.needDrawTextTips=function(){return true};RShape.prototype.setInputTips=function(t){this.inputTips=t;return this};RShape.prototype.getTextTipsPosition=function(){var t={};t.x=this.getWidth()>>1;t.y=this.getHeight()>>1;t.textAlign="center";t.textBaseline="middle";return t};RShape.prototype.drawTextTips=function(t){if(this.text||this.isIcon||this.w<120||this.h<20||this.editing){return}var e=this.getTextTipsPosition();var i=e.x;var n=e.y;t.textAlign=e.textAlign;t.textBaseline=e.textBaseline;t.font=this.style.getFont();t.fillStyle="#E0E0E0";if(this.inputTips){t.fillText(this.getLocaleInputTips(this.inputTips),i,n,this.getWidth())}else{if(this.needDrawTextTips()&&this.selected&&!isMobile()){t.fillText(dappGetText("double click to edit text."),i,n,this.getWidth())}}return};RShape.prototype.getOneLineText=function(t,e){var i="";var n=this.getWidth(true);if(t.measureText(e).width<=n){return e}for(var r=0;r<e.length;r++){var a=e[r];n=n-t.measureText(a).width;if(n<0){break}i=i+a}return i};RShape.prototype.setMargin=function(t,e){this.vMargin=Math.floor(Math.min(t,.5*this.w));this.hMargin=Math.floor(Math.min(e,.5*this.h));return this};RShape.prototype.getVMargin=function(){return this.vMargin?this.vMargin:0};RShape.prototype.getHMargin=function(){return this.hMargin?this.hMargin:0};RShape.prototype.getWidth=function(t){if(t){return this.w-2*this.getHMargin()}else{return this.w}};RShape.prototype.getHeight=function(t){if(t){return this.h-2*this.getVMargin()}else{return this.h}};RShape.prototype.drawText=function(t){this.defaultDrawText(t);return};RShape.prototype.prepareStyle=function(t){var e=this.style;t.lineWidth=e.lineWidth;t.strokeStyle=e.lineColor;t.fillStyle=e.fillColor;return};RShape.prototype.resetStyle=function(t){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=0;t.fillStyle="White";t.beginPath();return};RShape.prototype.strokeFill=function(t){if(this.style.enableShadow||isOldIE()){if(t.lineWidth>=1){if(!this.isStrokeColorTransparent()){t.stroke()}}if(!this.isFillColorTransparent()){t.fill()}}else{if(!this.isFillColorTransparent()){t.fill()}if(t.lineWidth>=1){if(!this.isStrokeColorTransparent()){t.stroke()}}}return};RShape.prototype.drawSizeTips=function(t){var e=Math.abs(this.w)+" x "+Math.abs(this.h);t.font="14px serif";t.textAlign="center";t.textBaseline="bottom";t.fillStyle=this.style.textColor;if(this.rotation){e+=" x r"+Math.round(this.rotation*180/Math.PI)}t.beginPath();t.fillText(e,this.w/2,0,this.w);t.fill();return};RShape.prototype.drawSelectMark=function(t,e,i,n){t.beginPath();if(e===Shape.HIT_TEST_ROTATION){this.drawRotateSelectMark(t,i,n)}else{this.createSelectedMark(t,i.x,i.y,n)}t.stroke();return};RShape.prototype.drawSelectMarks=function(t){t.save();t.beginPath();if(this.selected&&!this.hideSelectMark){var e=Math.floor(2/this.getRealScale());t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();t.lineWidth=e;t.fillStyle=this.style.fillColor;t.strokeStyle=RShape.selectMarkColor;t.stroke();for(var i=Shape.HIT_TEST_NONE+1;i<Shape.HIT_TEST_MAX;i++){if(this.getSelectMark(i,this.selectMarkPoint)){this.drawSelectMark(t,i,this.selectMarkPoint,i===this.hitTestResult)}}t.beginPath()}t.restore();return};RShape.prototype.paintSelf=function(t){t.save();this.translate(t);t.save();t.beginPath();this.prepareStyle(t);this.applyTransform(t);this.paintShape(t);t.closePath();this.strokeFill(t);t.restore();this.resetStyle(t);this.drawImage(t);if(this.drawText&&this.textType!==Shape.TEXT_NONE){this.drawText(t);this.drawTextTips(t)}if(this.hitTestResult!==Shape.HIT_TEST_NONE||this.state!==Shape.STAT_NORMAL){this.drawSizeTips(t)}this.drawSelectMarks(t);t.restore();return};RShape.prototype.hitTest=function(t){var e=Shape.HIT_TEST_NONE;var i=this.view.getCanvas2D();i.save();this.translate(i);this.applyTransform(i);if(this.selected){for(var n=Shape.HIT_TEST_NONE+1;n<Shape.HIT_TEST_MAX;n++){var r=this.selectMarkPoint;if(this.getSelectMark(n,r)){if(this.isInSelectedMark(i,r.x,r.y,t)){i.restore();return n}}}if(this.isPointIn(i,t)){e=Shape.HIT_TEST_MM}}else if(this.isPointIn(i,t)){e=Shape.HIT_TEST_MM}i.restore();return e};RShape.prototype.isLocked=function(){return this.locked};RShape.prototype.lock=function(){this.locked=true;return this};RShape.prototype.unlock=function(){this.locked=false;return this};RShape.prototype.execMoveResize=function(t,e,i,n){if(window.MoveResizeCommand){this.exec(new MoveResizeCommand(this,t,e,i,n))}else{if(t||t===0){this.x=t}if(e||e===0){this.y=e}if(i||i===0){this.w=i}if(n||n===0){this.h=n}}return};RShape.prototype.handlePointerEvent=function(t,e){if(e===C_EVT_POINTER_DOWN){this.saveX=this.x;this.saveY=this.y;this.saveW=this.w;this.saveH=this.h;this.saveRotation=this.rotation;return}var i=this.saveW;var n=this.saveH;var r=t.x-this.pointerDownPosition.x;var a=t.y-this.pointerDownPosition.y;var o=0;var s=0;var h=i;var l=n;switch(this.hitTestResult){case Shape.HIT_TEST_TL:{o=r;s=a;h=i-r;l=n-a;break}case Shape.HIT_TEST_TM:{s=a;l=n-a;break}case Shape.HIT_TEST_TR:{o=0;s=a;h=i+r;l=n-a;break}case Shape.HIT_TEST_ML:{o=r;h=i-r;break}case Shape.HIT_TEST_MR:{h=i+r;break}case Shape.HIT_TEST_BL:{o=r;h=i-r;l=n+a;break}case Shape.HIT_TEST_BM:{l=n+a;break}case Shape.HIT_TEST_BR:{h=i+r;l=n+a;break}case Shape.HIT_TEST_MOVE:case Shape.HIT_TEST_MM:{o=r;s=a;break}case Shape.HIT_TEST_ROTATION:{var u=(this.w>>1)+this.x;var c=(this.h>>1)+this.y;var p=Math.lineAngle({x:u,y:c},t)+Math.PI*.5;if(p>Math.PI*2){p=p-Math.PI*2}this.setRotation(p);if(e===C_EVT_POINTER_UP){var f=this.rotation;this.rotation=this.saveRotation;this.exec(AttributeCommand.create(this,"rotation",null,f))}break}default:break}if(e===C_EVT_POINTER_UP){if(this.x!==this.saveX||this.y!==this.saveY){var m=this.x;var d=this.y;this.x=this.saveX;this.y=this.saveY;if(this.isUserMovable()){this.execMoveResize(m,d);this.onUserMoved()}}if(this.w!==i||this.h!==n){var g=this.w;var y=this.h;this.w=i;this.h=n;if(this.isUserResizable()){this.execMoveResize(null,null,g,y);this.onUserResized()}}}else{if(o||s){if(this.isUserMovable()){this.setPosition(this.saveX+o,this.saveY+s)}this.onMoving()}if(i!==h||n!==l){if(this.isUserResizable()){this.setSize(h,l)}}}if(this.hitTestResult===Shape.HIT_TEST_HANDLE){r=t.x-this.lastPosition.x;a=t.y-this.lastPosition.y;this.moveHandle(r,a)}this.postRedraw();this.lastPosition.x=t.x;this.lastPosition.y=t.y;return true};RShape.prototype.onKeyDown=function(t){return};RShape.prototype.onKeyUp=function(t){return};RShape.prototype.toJsonMore=function(t){return};RShape.prototype.toJson=function(){var t={};t.type="";t.name="";for(var e in this){var i=this[e];var n=typeof i;if(e==="isRect"||e==="isContainer"){continue}if(n==="function"||n==="object"||n==="undefined"){continue}if(n==="number"||n==="string"||n==="boolean"){t[e]=i}}delete t.mode;delete t.state;delete t.MIN_SIZE;delete t.selected;delete t.animating;delete t.pointerDown;delete t.saveX;delete t.saveY;delete t.saveW;delete t.saveH;delete t.saveRotation;delete t.hignlighted;delete t.textNeedRelayout;delete t.openPending;delete t.pointerDownTime;delete t.hitTestResult;delete t.pointerDownPosition;delete t.defWidth;delete t.defHeight;delete t.userMovable;delete t.userResizable;delete t.textX;delete t.textY;delete t.textAlign;delete t.textTitle;delete t.vAlign;delete t.hAlign;delete t.editing;delete t.textBaseline;delete t.selectedTime;delete t.animating;delete t.clipW;delete t.clipH;delete t.fixResolution;delete t.forcePortrait;delete t.forceLandscape;delete t.resLoadDone;delete t.saveDx;delete t.saveDy;delete t.initWindowIndex;delete t.timerID;if(!t.textType){delete t.vTextAlign;delete t.hTextAlign}delete t.textType;if(!t.vMargin){delete t.vMargin}if(!t.hMargin){delete t.hMargin}if(!t.rotation){delete t.rotation}if(t.opacity===1){delete t.opacity}delete t.scale;delete t.scaleX;delete t.scaleY;delete t.needRelayout;delete t.rectSelectable;if(t.rotate==0){delete t.rotate}if(!t.imageUrl){delete t.imageUrl}if(t.offset){t.offset=0}t.x=Math.floor(this.x);t.y=Math.floor(this.y);t.w=Math.floor(this.w);t.h=Math.floor(this.h);t.style=this.style.toJson();delete t.style.arrowSize;delete t.style.lineStyle;delete t.style.firstArrowType;delete t.style.secondArrowType;if(this.handle){t.handle=this.handle}if(this.settings){t.settings=this.settings}if(this.propertySheetDesc){t.propertySheetDesc=this.propertySheetDesc}this.toJsonMore(t);return t};RShape.prototype.fromJsonMore=function(t){return};RShape.prototype.onFromJsonDone=function(){};RShape.prototype.fromJson=function(t){this.isUnpacking=true;for(var e in t){var i=t[e];var n=typeof i;if(n==="function"||n==="object"||n==="undefined"){continue}if(n==="number"||n==="string"||n==="boolean"){this[e]=i}}if(this.vAlign){this.vTextAlign=this.vAlign;delete this.vAlign}if(this.hAlign){this.hTextAlign=this.hAlign;delete this.hAlign}if(t.vMargin===undefined){this.vMargin=0}if(t.hMargin===undefined){this.hMargin=0}if(t.rotation===undefined){this.rotation=0}if(t.opacity===undefined){this.opacity=1}if(t.scaleX===undefined){this.scaleX=1}if(t.scaleX===undefined){this.scaleX=1}this.fromJsonMore(t);if(t.style){this.style.fromJson(t.style)}if(t.propertySheetDesc){this.propertySheetDesc=t.propertySheetDesc}if(t.handle){this.handle=t.handle}if(t.settings){this.settings=t.settings}if(t.dx!=undefined){this.x=t.dx}if(t.dy!=undefined){this.y=t.dy}this.setText(this.text);this.textNeedRelayout=true;this.state=Shape.STAT_NORMAL;delete this.isUnpacking;this.onFromJsonDone(t);return};RShape.prototype.setImage=function(t){if(t===this.imageUrl){return}this.imageUrl=t;this.image=new WImage(t);return this};RShape.prototype.asIcon=function(){this.resize(36,36);if(!this.isIcon){this.setStyle(Shape.getIconShapeStyle())}this.isIcon=true;return};RShape.prototype.showProperty=function(){var t=this.getApp();if(t){t.showRShapePropertyDialog(this)}return};RShape.prototype.getMoveDeltaX=function(){return this.view?this.view.getMoveDeltaX():0};RShape.prototype.getMoveDeltaY=function(){return this.view?this.view.getMoveDeltaY():0};RShape.prototype.getMoveAbsDeltaX=function(){return this.view?this.view.getMoveAbsDeltaX():0};RShape.prototype.getMoveAbsDeltaY=function(){return this.view?this.view.getMoveAbsDeltaY():0};RShape.prototype.setRoundRadius=function(t){this.roundRadius=t;return this};RShape.prototype.setFillColor=function(t){this.style.setFillColor(t);return this};RShape.prototype.setLineColor=function(t){this.style.setLineColor(t);return this};RShape.prototype.setTextColor=function(t){this.style.setTextColor(t);return this};RShape.prototype.getFillColor=function(){return this.style.fillColor};RShape.prototype.getLineColor=function(){return this.style.lineColor};RShape.prototype.getTextColor=function(){return this.style.textColor};function RShapeInit(t,e){var i=0;var n=0;var r=0;var a=0;t.initRShape(i,n,r,a,e);t.setSize(40,40);t.setText("");return t}function LShape(){return}LShape.prototype=new Shape;LShape.prototype.initDefault=function(){return};LShape.prototype.isLine=true;LShape.prototype.resizeDelta=function(t,e){return};LShape.prototype.setOptions=function(t,e,i,n){this.firstArrowUnchangable=t;this.secondArrowUnchangable=e;this.lineStyleUnchangable=i;this.arrowSizeUnchangable=n;return};LShape.prototype.setStyle=function(t){var e=this.style.firstArrowType;var i=this.style.secondArrowType;var n=this.style.lineStyle;var r=this.style.arrowSize;this.style.copy(t);this.needRelayout=true;if(this.firstArrowUnchangable){this.style.setFirstArrowType(e)}if(this.secondArrowUnchangable){this.style.setSecondArrowType(i)}if(this.lineStyleUnchangable){this.style.setLineStyle(n)}if(this.arrowSizeUnchangable){this.style.setArrowSize(r)}return};LShape.prototype.getWidth=function(){var t=this.points[0].x;var e=this.points[0].x;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(t>n.x){t=n.x}if(e<n.x){e=n.x}}return e-t};LShape.prototype.getHeight=function(){var t=this.points[0].y;var e=this.points[0].y;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(t>n.y){t=n.y}if(e<n.y){e=n.y}}return e-t};LShape.prototype.getX=function(){var t=this.points[0].x;for(var e=0;e<this.points.length;e++){var i=this.points[e];if(t>i.x){t=i.x}}return t};LShape.prototype.getY=function(){var t=this.points[0].y;for(var e=0;e<this.points.length;e++){var i=this.points[e];if(t>i.y){t=i.y}}return t};LShape.prototype.updatePoint=function(t,e){return false};LShape.prototype.isPointIn=function(t,e){return false};LShape.prototype.getPoint=function(t){return t<this.points.length?this.points[t]:null};LShape.prototype.saveState=function(){if(!this.savePoints){this.savePoints=new Array}this.savePoints.copy(this.points);return};LShape.prototype.findNear=function(t){this.near=null;if(this.view){var e=this.getNearRange();var i=e+e;var n={x:t.x-e,y:t.y-e,w:i,h:i};this.near=this.view.findNear(this,n)}return this.near};LShape.prototype.getNearPoint=function(t){if(t<this.points.length){return this.points[t]}return null};LShape.prototype.initLShape=function(t,e){this.points=new Array;this.savePoints=new Array;this.initDefault();var i=this.getX();var n=this.getY();var r=this.getWidth();var a=this.getHeight();this.initShape(i,n,r,a,e);if(t){this.points.copy(t);this.state=Shape.STAT_NORMAL}else{this.state=Shape.STAT_CREATING_0}this.style.setLineWidth(2);return};LShape.prototype.onPointerDown=function(t){this.pointerDown=true;this.lastPosition.copy(t);if(this.state===Shape.STAT_NORMAL){this.hitTestResult=this.hitTest(t)}this.setSelected(this.hitTestResult);this.handlePointerEvent(t,C_EVT_POINTER_DOWN);this.postRedraw();this.saveState();return this.hitTestResult};LShape.prototype.move=function(t,e){var i=t-this.getX();var n=e-this.getY();this.moveDelta(i,n);return};LShape.prototype.moveDelta=function(t,e){for(var i in this.points){this.points[i].x+=t;this.points[i].y+=e}return};LShape.prototype.isPointInSegment=function(t,e,i,n){if(!e||!i){return}var r=false;var a=10;var o=i.x-e.x;var s=i.y-e.y;var h=Math.sqrt(o*o+s*s);var l=Math.atan(s/o);t.save();t.translate((e.x+i.x)/2,(e.y+i.y)/2);t.rotate(l);t.beginPath();t.rect(-h/2,-a,h,2*a);t.restore();r=t.isPointInPath(n.x,n.y);t.beginPath();return r};LShape.prototype.onPointerMove=function(t){var e=true;if(this.state===Shape.STAT_NORMAL){if(this.hitTestResult){if(this.hitTestResult===Shape.HIT_TEST_MM){var i=t.x-this.lastPosition.x;var n=t.y-this.lastPosition.y;this.moveDelta(i,n)}else{this.findNear(t);this.updatePoint(this.hitTestResult-1,t)}this.postRedraw()}}else{this.findNear(t)}this.handlePointerEvent(t,C_EVT_POINTER_MOVE);this.lastPosition.copy(t);this.onMoved();return this.hitTestResult};LShape.prototype.clearAttachedNearPoints=function(){this.observers=[];return};LShape.prototype.updateNearPoints=function(){for(var t=0;t<this.points.length;t++){var e=this.findNear(this.points[t]);this.attachToNearPoint(e,t);this.near=null}return};LShape.prototype.attachToNearPoint=function(t,e){if(!this.observers){this.observers=[]}for(var i=this.observers.length;i<e+1;i++){this.observers.push(null)}if(!t){this.observers[e]=null;return}var n=this;var r={};var a=t.shape;r.line=this;r.object=t.shape;r.pointIndex=e;r.observerPointIndex=t.nearPointIndex;this.points[e].copy(t.point);r.update=function(t){if(this.object!=t){return false}if(!this.line.view){return false}if(this.line.selected&&this.line.view.isPointerDown()){return true}var e=this.line.observers;for(var i=0;i<e.length;i++){var n=e[i];if(!n){continue}if(n.object===t){var r=t.getNearPoint(this.observerPointIndex);this.line.updatePoint(this.pointIndex,r);return true}}return false};this.observers[e]=null;this.observers[e]=r;a.registerChangedListener(r);return};LShape.prototype.onPointerUp=function(t){var e=this.state;this.handlePointerEvent(t,C_EVT_POINTER_UP);this.lastPosition.copy(t);this.postRedraw();this.pointerDown=false;if(this.hitTestResult>0){var i=this.hitTestResult-1;this.attachToNearPoint(this.near,i);if(this.near){this.updatePoint(i,this.near.point)}}else if(!this.isClicked()&&e===Shape.STAT_NORMAL){this.clearAttachedNearPoints()}this.hitTestResult=Shape.HIT_TEST_NONE;this.exec(new LineMoveCommand(this,this.savePoints,!this.near));this.near=null;if(!this.isClicked()){this.onMoved()}return this.hitTestResult};LShape.prototype.resize=function(t,e){return};LShape.prototype.translate=function(t){t.translate(this.x,this.y);return};LShape.prototype.drawSelectMarks=function(t){if(this.selected){t.beginPath();t.lineWidth=1;t.shadowBlur=0;t.strokeStyle=this.style.lineColor;for(var e=0;e<this.points.length;e++){var i=this.points[e];var n=e===this.hitTestResult-1;this.createSelectedMark(t,i.x,i.y,n)}t.stroke();t.beginPath()}return};LShape.prototype.drawTips=function(t){if(this.selected&&this.pointerDown){t.fillStyle=this.style.lineColor;for(var e=0;e<this.points.length;e++){var i=this.points[e];var n=Math.floor(i.x)+"x"+Math.floor(i.y);t.font="14px serif";t.textAlign="center";t.textBaseline="bottom";t.fillText(n,i.x,i.y,100)}}return};LShape.prototype.hitTest=function(t){var e=Shape.HIT_TEST_NONE;var i=this.view.getCanvas2D();i.save();this.translate(i);for(var n=0;n<this.points.length;n++){var r=this.points[n];if(this.isInSelectedMark(i,r.x,r.y,t)){i.restore();return this.selected?n+1:Shape.HIT_TEST_MM}}if(this.isPointIn(i,t)){e=Shape.HIT_TEST_MM}i.restore();return e};LShape.prototype.onKeyDown=function(t){return};LShape.prototype.onKeyUp=function(t){return};LShape.prototype.pointsToJson=function(){var t="";for(var e=0;e<this.points.length;e++){var i=this.points[e];if(e>0){t+=","}t+="{x:"+i.x+",y:"+i.y+"}"}return t};LShape.prototype.toJson=function(){var t=new Object;t.type=this.type;t.points=this.points;t.text=this.text;t.style=this.style.toJson();return t};LShape.prototype.pointsFromJson=function(t){for(var e=0;e<t.points.length;e++){var i=t.points[e];this.points.push(new Point(i.x,i.y))}return};LShape.prototype.fromJson=function(t){this.points.clear();this.text=t.text;this.style.fromJson(t.style);this.pointsFromJson(t);this.state=Shape.STAT_NORMAL;return};LShape.prototype.drawText=function(t){var e=this.getLocaleText(this.text);if(e){var i=(this.points[0].x+this.points[1].x)/2;var n=(this.points[0].y+this.points[1].y)/2;t.beginPath();t.textAlign="center";t.textBaseline="bottom";var r=this.style.getFont();t.font=r;t.fillStyle=this.style.textColor;t.fillText(e,i,n);t.fill()}return};LShape.prototype.prepareStyle=function(t){var e=this.style;t.lineWidth=e.lineWidth;t.strokeStyle=e.lineColor;t.fillStyle=e.fillColor;if(e.enableGradient){t.strokeStyle=e.getStrokeStyle(t)}else{t.strokeStyle=e.lineColor}if(e.enableShadow){t.shadowColor=e.shadow.color;t.shadowOffsetX=e.shadow.x;t.shadowOffsetY=e.shadow.y;t.shadowBlur=e.shadow.blur}return};LShape.prototype.resetStyle=function(t){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=0;t.strokeStyle=this.style.lineColor;t.beginPath();return};LShape.prototype.showProperty=function(){var t=this.getApp();if(t){t.showLShapePropertyDialog(this)}return};LShape.prototype.asIcon=function(){this.isIcon=true;this.setStyle(Shape.getIconShapeStyle());return};var C_CREATE_FOR_USER=0;var C_CREATE_FOR_ICON=1;var C_CREATE_FOR_PROGRAM=2;function ShapeCreator(t,e,i,n){this.type=t;this.icon=i;this.name=e;this.visible=n;this.isVisibleToUser=function(){return this.visible};this.getID=function(){return this.type};this.getIcon=function(){return this.icon};this.getName=function(){return this.name};this.createIconShape=function(){if(!this.iconShape){this.iconShape=this.createShape(C_CREATE_FOR_ICON)}return this.iconShape};this.createShape=function(t){return null};return}function ShapeFactory(){this.defaultCategory=null;this.recentUsed=[];this.creators=[];this.categories={};this.categoryNames=[];this.diagramTypes=[];this.listeners=[];ShapeFactory.CATEGORY_RECENT_USED="Recent Used";ShapeFactory.CATEGORY_USER_COMPONENTS="User Component";this.setDefaultCategory=function(t){this.defaultCategory=t;return};this.getDiagramTypes=function(){return this.diagramTypes};this.addDiagramType=function(t,e){var i={name:t,defaultCategory:e};this.diagramTypes.push(i);return};this.removeCategoryName=function(t){this.categoryNames.remove(t);return};this.removeShapeCreator=function(t,e){var i=this.find(t);var n=this.categories[e];if(i){this.creators.remove(i);if(n){n.remove(i);this.notifyChanged("remove",e,i)}}return};this.isPlacehodler=function(t){return t==="---"};this.isUserComponents=function(t){return t===ShapeFactory.CATEGORY_USER_COMPONENTS};this.addPlaceholder=function(){this.categoryNames.push("---");return};this.loadRecentUsedShapeCreators=function(){var t=WebStorage.get("recentUsed");var e=t?JSON.parse(t):[];for(var i=0;i<e.length;i++){var n=e[i];var r=this.find(n);if(r){this.addShapeCreator(r,ShapeFactory.CATEGORY_RECENT_USED);this.recentUsed.push(n)}}return};this.addRecentUsedShapeCreator=function(t){var e=this.find(t);if(e){this.recentUsed.remove(t);this.recentUsed.push(t);if(this.recentUsed.length>10){this.recentUsed.shift()}WebStorage.set("recentUsed",JSON.stringify(this.recentUsed));this.addShapeCreator(e,ShapeFactory.CATEGORY_RECENT_USED)}};this.addShapeCreator=function(t,e){this.notifyChanged("add",e,t);if(e!=ShapeFactory.CATEGORY_RECENT_USED){this.creators.push(t)}if(e){if(!this.defaultCategory){this.setDefaultCategory(e)}if(!this.categories[e]){this.categories[e]=[];if(e==ShapeFactory.CATEGORY_RECENT_USED){this.categoryNames.unshift(e)}else{this.categoryNames.push(e)}}this.categories[e].remove(t);if(e==ShapeFactory.CATEGORY_RECENT_USED){this.categories[e].unshift(t)}else{this.categories[e].push(t)}}return};this.getCategoryNames=function(){return this.categoryNames};this.getDefaultCategory=function(){return this.categories[this.defaultCategory]};this.getByCategory=function(t){return this.categories[t]};this.find=function(t){for(var e=0;e<this.creators.length;e++){var i=this.creators[e];if(i.getID()===t){return i}}return null};this.createShape=function(t,e,i){if(!t){return null}var n=this.find(t);if(n){return n.createShape(e)}console.log("not found type "+t+", create ui-unkown instead.");if(!i){n=this.find("ui-unkown");if(n){return n.createShape(e)}return null}};this.addListener=function(t){this.listeners.push(t);return this};this.removeListener=function(t){this.listeners.remove(t);return this};this.notifyChanged=function(t,e,i){var n=this.listeners;for(var r=0;r<n.length;r++){var a=n[r];if(a){a(t,e,i)}}return};return}ShapeFactory.instance=null;ShapeFactory.getInstance=function(){if(!ShapeFactory.instance){ShapeFactory.instance=new ShapeFactory;setTimeout(function(){ShapeFactory.instance.loadRecentUsedShapeCreators()},2e3)}return ShapeFactory.instance};function ShapeFactoryGet(){return ShapeFactory.getInstance()}function dappSetDefaultCategory(t){return ShapeFactory.getInstance().setDefaultCategory(t)}function cantkRegShapeCreator(t,e){return ShapeFactory.getInstance().addShapeCreator(t,e)}function dupDeviceConfig(t){var e={};e.name=t.name;e.bg=t.bg;e.platform=t.platform;e.version=t.version;e.lcdDensity=t.lcdDensity;e.width=t.width;e.height=t.height;e.screenX=t.screenX;e.screenY=t.screenY;e.screenW=t.screenW;e.screenH=t.screenH;e.hasMenuBar=t.hasMenuBar;return e}function cantkDetectDeviceConfig(){var t={version:4};if(isAndroid()){t.platform="android"}else if(isIPhone()||isIPad()){t.platform="iphone"}else if(isFirefoxOS()){t.platform="firefox"}else if(isWinPhone()){t.platform="winphone"}else if(isTizen()){t.platform="tizen"}else{t.platform="android"}if(window.devicePixelRatio>2.2){t.lcdDensity="xxhdpi"}else if(window.devicePixelRatio>1.5){t.lcdDensity="xhdpi"}else if(window.devicePixelRatio>1.1){t.lcdDensity="hdpi"}else if(window.devicePixelRatio>.8){t.lcdDensity="mdpi"}else if(!window.devicePixelRatio){var e=Math.min(window.orgViewPort.width,window.orgViewPort.height);if(e>600){t.lcdDensity="xhdpi"}else{t.lcdDensity="hdpi"}}else{t.lcdDensity="ldpi"}if(isFirefoxOS()){t.lcdDensity="mdpi"}if(!isMobile()){t.lcdDensity="hdpi"}console.log("deviceConfig.lcdDensity:"+t.lcdDensity);console.log("deviceConfig.platform:"+t.platform);return t}function isDeviceConfigEqual(t,e){var i=JSON.stringify(t);var n=JSON.stringify(e);return i===n}function cantkPreloadImage(t){var e=new WImage(t);return e}var gTempCanvas=null;function cantkGetTempCanvas(t,e){if(!gTempCanvas){gTempCanvas=document.createElement("canvas");gTempCanvas.type="backend_canvas";gTempCanvas.width=t;gTempCanvas.height=e}if(gTempCanvas){if(gTempCanvas.width!=t){gTempCanvas.width=t}if(gTempCanvas.height!=e){gTempCanvas.height=e}}return gTempCanvas}var gApp8LocaleStrings={"Loading...":"正在努力加载..."};function webappGetText(t){var e=null;if(!t){return""}if(gApp8LocaleStrings){e=gApp8LocaleStrings[t]}if(!e){e=t}return e}function webappSetLocaleStrings(t){gApp8LocaleStrings=t;return}var gDeviceConfigs=[];function cantkRegisterDevice(t){gDeviceConfigs.push(dupDeviceConfig(t));return}function cantkGetDeviceConfig(t){for(var e=0;e<gDeviceConfigs.length;e++){var i=gDeviceConfigs[e];if(i.name===t){return dupDeviceConfig(i)}}return null}function cantkGetAllDeviceConfig(){return gDeviceConfigs}function cantkLoadDefaultDeviceConfigs(){var t={name:"android-WVGA800",bg:"/drawapp8/images/devices/device_800x480.png",platform:"android",version:"4",lcdDensity:"hdpi",width:600,height:1126,screenX:60,screenY:198,screenW:480,screenH:800,hasMenuBar:true};var e={name:"tizen-WVGA800",bg:"/drawapp8/images/devices/device_800x480.png",platform:"tizen",version:"4",lcdDensity:"hdpi",width:600,height:1126,screenX:60,screenY:198,screenW:480,screenH:800};var i={name:"tizen-WXGA720",bg:"/drawapp8/images/devices/device_1280x720.png",platform:"tizen",version:"4",lcdDensity:"xhdpi",width:860,height:1802,screenX:74,screenY:268,screenW:720,screenH:1280};var n={name:"android-WXGA720",bg:"/drawapp8/images/devices/device_1280x720.png",platform:"android",version:"4",lcdDensity:"xhdpi",width:860,height:1802,screenX:74,screenY:268,screenW:720,screenH:1280,hasMenuBar:true};var r={name:"android-WXGA800",bg:"/drawapp8/images/devices/device.png",platform:"android",version:"4",lcdDensity:"mdpi",width:1400,height:964,screenX:60,screenY:82,screenW:1280,screenH:800,hasMenuBar:true};var a={name:"android-WSVGA",bg:"/drawapp8/images/devices/device.png",platform:"android",version:"4",lcdDensity:"mdpi",width:1130,height:764,screenX:60,screenY:82,screenW:1024,screenH:600,hasMenuBar:true};var o={name:"iphone4s",bg:"/drawapp8/images/devices/device_iphone4s.png",platform:"iphone",version:"4s",lcdDensity:"xhdpi",width:760,height:1487,screenX:65,screenY:265,screenW:640,screenH:960,hasMenuBar:false};var s={name:"iphone5",bg:"/drawapp8/images/devices/device_iphone5.png",platform:"iphone",version:"5",lcdDensity:"xhdpi",width:765,height:1600,screenX:65,screenY:238,screenW:640,screenH:1136,hasMenuBar:false};var h={name:"BlackBerry Q10",bg:"/drawapp8/images/devices/device_bb_q10.jpg",platform:"blackberry",version:"10",lcdDensity:"xhdpi",width:860,height:1520,
screenX:66,screenY:246,screenW:720,screenH:720,hasMenuBar:false};var l={name:"BlackBerry Z10",bg:"/drawapp8/images/devices/device_bb_z10.jpg",platform:"blackberry",version:"10",lcdDensity:"xhdpi",width:920,height:1820,screenX:72,screenY:258,screenW:768,screenH:1280,hasMenuBar:false};var u={name:"Nokia Lumia 800",bg:"/drawapp8/images/devices/device_nokia_lumia_800.jpg",platform:"winphone",version:"8",lcdDensity:"hdpi",width:620,height:1170,screenX:86,screenY:146,screenW:480,screenH:800,hasMenuBar:false};var c={name:"Nokia Lumia 920",bg:"/drawapp8/images/devices/device_nokia_lumia_920.jpg",platform:"winphone",version:"8",lcdDensity:"xhdpi",width:1050,height:1780,screenX:136,screenY:192,screenW:768,screenH:1280,hasMenuBar:false};var p={name:"iPad Mini",bg:"/drawapp8/images/devices/device_ipad_mini.jpg",platform:"iphone",version:"5",lcdDensity:"mdpi",width:876,height:1290,screenX:52,screenY:132,screenW:768,screenH:1024,hasMenuBar:false};var f={name:"iPad 4",bg:"/drawapp8/images/devices/device_ipad_4.jpg",platform:"iphone",version:"5",lcdDensity:"hdpi",width:1942,height:2542,screenX:198,screenY:238,screenW:1536,screenH:2048,hasMenuBar:false};var m={name:"PC-General",bg:"/drawapp8/images/pc-general.png",platform:"android",version:"4",lcdDensity:"hdpi",width:856,height:668,screenX:30,screenY:32,screenW:800,screenH:600};var d={name:"PC-Portrait",bg:"/drawapp8/images/pc-480x720.png",platform:"android",version:"4",lcdDensity:"hdpi",width:600,height:840,screenX:60,screenY:70,screenW:480,screenH:720,hasMenuBar:false};var g={name:"480x720",bg:"/drawapp8/images/device.png",platform:"android",lcdDensity:"hdpi",width:552,height:878,screenX:36,screenY:80,screenW:480,screenH:720};var y={name:"480x800",bg:"/drawapp8/images/device.png",platform:"android",lcdDensity:"hdpi",width:552,height:974,screenX:36,screenY:88,screenW:480,screenH:800};var v={name:"720x1280",bg:"/drawapp8/images/device.png",platform:"android",lcdDensity:"hdpi",width:832,height:1500,screenX:56,screenY:112,screenW:720,screenH:1280};var _={name:"320x480",bg:"/drawapp8/images/device.png",platform:"android",lcdDensity:"mdpi",width:370,height:590,screenX:25,screenY:55,screenW:320,screenH:480};cantkRegisterDevice(g);cantkRegisterDevice(v);cantkRegisterDevice(y);cantkRegisterDevice(_);cantkRegisterDevice(m);return}cantkLoadDefaultDeviceConfigs();VelocityTracker.prototype.HISTORY_SIZE=20;VelocityTracker.prototype.HORIZON=200*1e6;VelocityTracker.prototype.MIN_DURATION=10*1e6;function Movement(){this.eventTime=0;this.point=new Point(0,0);this.getPoint=function(){return this.point};return this}function VelocityTracker(){this.clear();return this}VelocityTracker.prototype.clear=function(){this.index=0;var t=this.HISTORY_SIZE;if(!this.movements){this.movements=new Array;for(var e=0;e<t;e++){this.movements.push(new Movement)}}for(var e=0;e<t;e++){var i=this.movements[e];i.eventTime=0;i.point={x:0,y:0}}return};VelocityTracker.prototype.addMovement=function(t,e){if(++this.index==this.HISTORY_SIZE){this.index=0}this.movements[this.index].eventTime=t;this.movements[this.index].point=e;return};VelocityTracker.prototype.getVelocity=function(){var t={x:0,y:0};this.estimate();t.x=this.xVelocity;t.y=this.yVelocity;return t};VelocityTracker.prototype.estimate=function(){var t=this.HORIZON;var e=this.MIN_DURATION;var i=this.HISTORY_SIZE;var n=this.movements[this.index];var r=n.eventTime-t;var a=this.index;var o=1;do{var s=(a==0?i:a)-1;var h=this.movements[s];if(h.eventTime<r){break}a=s}while(++o<i);var l=0;var u=0;var c=a;var p=0;var f=this.movements[a];var m=f.getPoint();var d=0;while(o-->1){if(++c==i){c=0}var g=this.movements[c];var y=g.eventTime-f.eventTime;if(y>=e){var v=g.getPoint();var _=1e9/y;var I=(v.x-m.x)*_;var w=(v.y-m.y)*_;l=(l*d+I*y)/(y+d);u=(u*d+w*y)/(y+d);d=y;p+=1}}if(p){this.xVelocity=l;this.yVelocity=u}else{this.xVelocity=0;this.yVelocity=0}return true};function testVelocityTracker(){var t=null;var e=new VelocityTracker;function i(t){return t*1e6}for(var n=0;n<20;n++){e.addMovement(i(10*n),{x:10*n,y:10*n*n/2})}t=e.getVelocity();console.log("xv: "+t.x+" yv: "+t.y);return}function Interpolator(){this.get=function(t){return 0};return this}function LinearInterpolator(){this.get=function(t){return t};return this}function BounceInterpolator(){function t(t){return 8*t*t}this.get=function(e){e*=1.1226;if(e<.3535)return t(e);else if(e<.7408)return t(e-.54719)+.7;else if(e<.9644)return t(e-.8526)+.9;else return t(e-1.0435)+.95};return this}function AccelerateInterpolator(){this.get=function(t){return t*t};return this}function AccDecelerateInterpolator(){this.get=function(t){return Math.cos((t+1)*Math.PI)/2+.5};return this}function DecelerateInterpolator(t){this.factor=t?t:2;this.get=function(t){if(this.factor===1){return 1-(1-t)*(1-t)}else{return 1-Math.pow(1-t,2*this.factor)}};return this}function SineAccelerateInterpolator(){this.get=function(t){return-Math.cos(t*(Math.PI/2))+1};return this}function SineAccDecelerateInterpolator(){this.get=function(t){return-.5*(Math.cos(Math.PI*t)-1)};return this}function SineDecelerateInterpolator(){this.get=function(t){return Math.sin(t*(Math.PI/2))};return this}function AnimationFactory(){this.createAnimation=function(t,e){UIElement.getMainCanvasScale(true);var i=isIPhone()?400:600;e=e?e:i;switch(t){case"anim-forward":{var n=new DecelerateInterpolator;animation=isAndroid()?new AnimationHTranslate(true):new AnimationHTranslate(true);animation.toLeft();animation.init(e,n);break}case"anim-backward":{var n=new DecelerateInterpolator;animation=isAndroid()?new AnimationHTranslate(false):new AnimationHTranslate(false);animation.toRight();animation.init(e,n);break}case"anim-upward":{var n=new DecelerateInterpolator;animation=new AnimationVTranslate(true);animation.init(e,n);break}case"anim-downward":{var n=new DecelerateInterpolator;animation=new AnimationVTranslate(false);animation.init(e,n);break}case"anim-scale-show-win":{var n=new DecelerateInterpolator(1);if(isMobile()){animation=new AnimationBrowserScaleWin(true);animation.setRange(1.2,1)}else{animation=new AnimationScale(true);animation.setRange(.9,1)}animation.init(e,n);break}case"anim-scale-hide-win":{var n=new AccelerateInterpolator;if(isMobile()){animation=new AnimationBrowserScaleWin(false);animation.setRange(.9,1)}else{animation=new AnimationScale(false);animation.setRange(1,.9)}animation.init(e,n);break}case"anim-scale-show-dialog":{e=e?e:300;var n=new DecelerateInterpolator;animation=isAndroid()?new AnimationBrowserScaleDialog(true):new AnimationScale(true);animation.setRange(.9,1);animation.init(e,n);break}case"anim-scale-hide-dialog":{e=e?e:300;var n=new AccelerateInterpolator;animation=isAndroid()?new AnimationBrowserScaleDialog(false):new AnimationScale(false);animation.setRange(1,.9);animation.init(e,n);break}case"anim-fade-in":{var n=new AccelerateInterpolator;animation=isAndroid()?new AnimationBrowserAlpha(true):new AnimationAlpha(true);animation.setRange(.6,1);animation.init(500,n);break}case"anim-fade-out":{var n=new AccelerateInterpolator;animation=isAndroid()?new AnimationBrowserAlpha(false):new AnimationAlpha(false);animation.setRange(1,.8);animation.init(300,n);break}case"anim-move-up":{var n=new DecelerateInterpolator;animation=isMobile()?new AnimationBrowserMove(true):new AnimationMove(true);animation.init(e,n);break}case"anim-move-down":{var n=new AccelerateInterpolator;animation=isMobile()?new AnimationBrowserMove(false):new AnimationMove(false);animation.init(e,n);break}case"anim-expand-up":case"anim-expand-left":case"anim-expand-right":case"anim-expand-down":{var n=new DecelerateInterpolator;animation=new Animation1Expand(true);animation.init(400,n);break}case"anim-collapse-up":case"anim-collapse-left":case"anim-collapse-right":case"anim-collapse-down":{var n=new AccelerateInterpolator;animation=new Animation1Expand(true);animation.init(400,n);break}case"anim-scale1-show-origin-topleft":case"anim-scale1-show-origin-center":case"anim-scale1-show-origin-bottomleft":case"anim-scale1-show-origin-topright":case"anim-scale1-show-origin-bottomright":case"anim-scale1-show":{var n=new DecelerateInterpolator;animation=new Animation1Scale(true);animation.init(400,n);break}case"anim-scale1-hide-origin-topleft":case"anim-scale1-hide-origin-center":case"anim-scale1-hide-origin-bottomleft":case"anim-scale1-hide-origin-topright":case"anim-scale1-hide-origin-bottomright":case"anim-scale1-hide":{var n=new AccelerateInterpolator;animation=new Animation1Scale(false);animation.init(400,n);break}case"anim-alpha1-show":{var n=new DecelerateInterpolator;animation=new Animation1Alpha(true);animation.init(400,n);break}case"anim-alpha1-hide":{var n=new AccelerateInterpolator;animation=new Animation1Alpha(false);animation.init(400,n);break}}return animation};return this}AnimationFactory.createInterpolator=function(t,e){switch(t){case"l":case"linear":{return new LinearInterpolator}case"b":case"bounce":{return new BounceInterpolator}case"a":case"accelerate":{return new AccelerateInterpolator}case"ad":case"accelerate-decelerate":{return new AccDecelerateInterpolator}case"sa":case"sine-accelerate":{return new SineAccelerateInterpolator}case"sd":case"sine-decelerate":{return new SineDecelerateInterpolator}case"sad":case"sine-accelerate-decelerate":{return new SineAccDecelerateInterpolator}default:{return new DecelerateInterpolator}}};AnimationFactory.create=function(t,e){if(!AnimationFactory.instance){AnimationFactory.instance=new AnimationFactory}return AnimationFactory.instance.createAnimation(t,e)};Animation.getCanvas=function(){if(!Animation.canvas){Animation.canvas=document.createElement("canvas");Animation.canvas.type="animation_canvas"}Animation.canvas.style.zIndex=9;Animation.canvas.style["opacity"]=1;scaleElement(Animation.canvas,1,1);return Animation.canvas};Animation.getOldWinCanvas=function(){if(!Animation.oldWnCanvas){Animation.oldWnCanvas=document.createElement("canvas");Animation.oldWnCanvas.type="animation_canvas"}Animation.oldWnCanvas.style.zIndex=9;Animation.oldWnCanvas.style["opacity"]=1;scaleElement(Animation.oldWnCanvas,1,1);return Animation.oldWnCanvas};Animation.getNewWinCanvas=function(){if(!Animation.newWinCanvas){Animation.newWinCanvas=document.createElement("canvas");Animation.newWinCanvas.type="animation_canvas"}Animation.newWinCanvas.style.zIndex=9;Animation.newWinCanvas.style["opacity"]=1;scaleElement(Animation.newWinCanvas,1,1);return Animation.newWinCanvas};Animation.getBackendCanvas=function(t,e){if(!Animation.backendCanvas){Animation.backendCanvas=document.createElement("canvas");Animation.backendCanvas.type="backend_canvas";Animation.backendCanvas.width=t;Animation.backendCanvas.height=e}if(Animation.backendCanvas){if(Animation.backendCanvas.width!=t){Animation.backendCanvas.width=t}if(Animation.backendCanvas.height!=e){Animation.backendCanvas.height=e}Animation.scaleCanvas(Animation.backendCanvas,t,e)}scaleElement(Animation.backendCanvas,1,1);return Animation.backendCanvas};function Animation(t){this.scale=1;this.visible=false;this.showWin=t;this.init=function(t,e){this.duration=t?t:500;this.interpolator=e;return};this.setRectOfFront=function(t,e,i,n){this.frontX=t;this.frontY=e;this.frontW=i;this.frontH=n;return};this.setScale=function(t){this.scale=t;return};this.prepare=function(t,e,i,n,r,a){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.onFinish=a;this.canvasImage=CantkRT.createImageFromCanvas(r);this.setRectOfFront(0,0,i,n);if(r){this.sw=r.width;this.sh=r.height}this.show();return true};this.moveResizeCanvas=function(t,e,i,n,r){t.style.position="absolute";t.width=n;t.height=r;setElementPosition(t,e,i);t.style.visibility="visible";Animation.scaleCanvas(t,n,r);return};this.show=function(){var t=this.w*this.scale;var e=this.h*this.scale;this.visible=true;this.canvasElement=Animation.getCanvas();this.moveResizeCanvas(this.canvasElement,this.x,this.y,t,e);document.body.appendChild(this.canvasElement);return true};this.hide=function(){this.visible=false;if(this.canvasElement&&this.canvasElement.parentNode){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.getTimePercent=function(){var t=new Date;var e=t.getTime()-this.startTime;return e/this.duration};this.getPercent=function(t){return this.interpolator.get(t)};this.step=function(t){return true};this.beforeRun=function(){return true};this.afterRun=function(){return true};this.drawBackground=function(t){if(this.isFirstStep){this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h)}else{var e=this.frontX;var i=this.frontY;var n=this.frontW;var r=this.frontH;this.canvas.drawImage(this.canvasImage,e,i,n,r,e,i,n,r)}return};this.doStep=function(t){this.canvas.save();this.canvas.scale(this.scale,this.scale);this.step(t);this.canvas.restore();return};this.run=function(){var t=new Date;var e=this;this.startTime=t.getTime();e.isFirstStep=true;this.beforeRun();WWindowManager.getInstance().setPaintEnable(false);function i(){var t=0;var n=e.getTimePercent();if(n<1){t=e.getPercent(n);e.doStep(t);requestAnimFrame(i)}else{e.cleanup();e.afterRun();WWindowManager.getInstance().setPaintEnable(true);console.log("Animation done.")}e.isFirstStep=false}i();return};this.cleanup=function(){var t=this;var e=this.onFinish;setTimeout(function(){t.hide()},100);if(e){e()}if(this.canvasImage&&this.canvasImage.unload){this.canvasImage.unload()}};this.hide();return this}function setElementPosition(t,e,i){var n=UIElement.getMainCanvasScale();e=e/n.x;i=i/n.y;t.style.position="absolute";t.style.left=Math.round(e)+"px";t.style.top=Math.round(i)+"px";t.style["opacity"]=1;return}Animation.scaleCanvas=function(t,e,i){var n=UIElement.getMainCanvasScale();t.style.width=Math.round(e/n.x)+"px";t.style.height=Math.round(i/n.y)+"px";return};function moveElement(t,e,i){setElementPosition(t,e,i);return}function alphaElement(t,e){t.style["opacity"]=e;return}function showElement(t){t.style["opacity"]=1}function hideElement(t){t.style["opacity"]=0}function scaleElement(t,e,i,n,r){var a=n&&r?n+" "+r:"50% 50%";var o=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var s=0;s<o.length;s++){var h=o[s];t.style[h+"-origin"]=a;t.style[h]="scale("+e+")"}t.style["opacity"]=i;return}function rotateElement(t,e){var i="50% 50%";var n=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var r=0;r<n.length;r++){var a=n[r];t.style[a+"-origin"]=i;t.style[a]="rotate("+e+"deg)"}return}function AnimationHTranslateAndroid(){Animation.apply(this,arguments);this.leftToRight=true;this.show=function(){document.body.appendChild(Animation.backendCanvas);Animation.backendCanvas.style.zIndex=9;this.canvasElement=Animation.backendCanvas;setElementPosition(Animation.backendCanvas,this.x,this.y);return true};this.hide=function(){if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.doStep=function(t){this.step(t);return};this.beforeRun=function(){var t=this.sw-this.w;this.range=t*.7;this.start=t-this.range;return};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(t){var e=0;if(this.leftToRight){e=this.start+this.range*t}else{e=this.w-this.range*t-this.start}moveElement(Animation.backendCanvas,-e+this.x,this.y);return true}}function AnimationVTranslate(t){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(t){var e=this.frontX;var i=this.frontY;var n=this.frontW;var r=this.range*t;var a=this.showWin?r:this.range-r;var o=this.showWin?this.frontY+this.range-r:this.frontY+r;if(o>0){this.canvas.drawImage(this.canvasImage,0,this.h-o,n,o,0,0,n,o)}if(a>0){this.canvas.drawImage(this.canvasImage,e+this.w,i,n,a,e,o,n,a)}return true}}function AnimationHTranslate(){Animation.apply(this,arguments);this.leftToRight=true;this.beforeRun=function(){var t=this.sw-this.w;if(isMobile()){this.range=t*.8}else{this.range=t}this.start=t-this.range;this.canvas=this.canvasElement.getContext("2d")};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(t){var e=0;if(this.leftToRight){e=this.start+this.range*t}else{e=this.w-this.range*t-this.start}if(this.lastOffset===e){return true}this.canvas.drawImage(this.canvasImage,e,0,this.w,this.h,0,0,this.w,this.h);this.lastOffset=e;return true}}function AnimationScale(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(t,e){this.to=e;this.from=t;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=this.to>this.from?t:1-t;if(this.canvasImage){var n=this.canvas;var r=this.frontX+.5*this.frontW;var a=this.frontY+.5*this.frontH;this.drawBackground(n);n.save();n.translate(r,a);n.globalAlpha=i;n.scale(e,e);n.translate(-.5*this.frontW,-.5*this.frontH);n.drawImage(this.canvasImage,this.frontX+this.w,this.frontY,this.frontW,this.frontH,0,0,this.frontW,this.frontH);n.restore()}return true}}function AnimationAlpha(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(t,e){this.to=e;this.from=t;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(t){var e=this.from+t*(this.to-this.from);if(this.canvasImage){var i=this.canvas;i.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);i.save();i.globalAlpha=e;i.drawImage(this.canvasImage,this.frontX+this.w,this.frontY,this.frontW,this.frontH,this.frontX,this.frontY,this.frontW,this.frontH);i.restore()}return true}}function AnimationMove(t){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(t){this.drawBackground(this.canvas);var e=this.frontX;var i=this.frontY;var n=this.frontW;var r=this.range*t;var a=this.showWin?r:this.range-r;var o=this.showWin?this.frontY+this.range-r:this.frontY+r;if(a>0){this.canvas.drawImage(this.canvasImage,e+this.w,i,n,a,e,o,n,a)}return true}}function AnimationBrowser(t){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;function e(t){try{document.body.removeChild(t)}catch(e){console.log(e.toString())}return}this.setRange=function(t,e){this.to=e;this.from=t;return};this.onShowCanvas=function(){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y);showElement(this.oldWinCanvas);showElement(this.newWinCanvas);return};this.showCanvas=function(t,e){var i=this.w;var n=this.h;var r=Animation.getOldWinCanvas();var a=Animation.getNewWinCanvas();this.moveResizeCanvas(r,this.x,this.y,i,n);this.moveResizeCanvas(a,this.x,this.y,i,n);r.style.zIndex=t;a.style.zIndex=e;var o=r.getContext("2d");var s=a.getContext("2d");if(this.showWin){o.drawImage(Animation.backendCanvas,0,0,i,n,0,0,i,n);s.drawImage(Animation.backendCanvas,this.w,0,i,n,0,0,i,n)}else{s.drawImage(Animation.backendCanvas,0,0,i,n,0,0,i,n);o.drawImage(Animation.backendCanvas,this.w,0,i,n,0,0,i,n)}this.oldWinCanvas=r;this.newWinCanvas=a;this.onShowCanvas();if(t>e){document.body.appendChild(a);document.body.appendChild(r)}else{document.body.appendChild(a);document.body.appendChild(r)}return true};this.show=function(){this.showCanvas(8,9);return true};this.hide=function(){if(this.oldWinCanvas&&this.newWinCanvas){if(this.showWin){e(this.oldWinCanvas);e(this.newWinCanvas)}else{e(this.oldWinCanvas);e(this.newWinCanvas)}this.newWinCanvas=null;this.oldWinCanvas=null}return true};this.afterRun=function(){};this.doStep=function(t){this.step(t);return};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=t;scaleElement(this.newWinCanvas,e,i);return true}}function AnimationBrowserScaleWin(t){AnimationBrowser.apply(this,arguments);this.onShowCanvas=function(){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y);showElement(this.oldWinCanvas);hideElement(this.newWinCanvas);return};this.step=function(t){var e=t;var i=this.from+t*(this.to-this.from);scaleElement(this.newWinCanvas,i,e);return true}}function AnimationBrowserScaleDialog(t){AnimationBrowser.apply(this,arguments);this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}return true};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=this.showWin?t:1-t;if(this.showWin){scaleElement(this.newWinCanvas,e,i)}else{scaleElement(this.oldWinCanvas,e,i)}return true}}function AnimationBrowserAlpha(t){AnimationBrowser.apply(this,arguments);this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}};this.step=function(t){var e=this.from+t*(this.to-this.from);if(this.showWin){alphaElement(this.newWinCanvas,e)}else{alphaElement(this.oldWinCanvas,e)}return true}}function AnimationBrowserMove(t){AnimationBrowser.apply(this,arguments);this.onShowCanvas=function(){if(this.showWin){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.frontH)}else{setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y)}showElement(this.oldWinCanvas);showElement(this.newWinCanvas);return};this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}return};this.step=function(t){var e=0;this.range=this.frontH;var i=this.range*t;if(this.showWin){e=this.range-i;moveElement(this.newWinCanvas,0,e)}else{e=i;moveElement(this.oldWinCanvas,0,e)}return true}}var C_DIR_UP=1;var C_DIR_DOWN=2;var C_DIR_LEFT=3;var C_DIR_RIGHT=4;var C_ACTION_EXPAND=1;var C_ACTION_COLLAPSE=2;function Animation1Expand(){Animation.apply(this,arguments);this.prepare=function(t,e,i,n,r,a){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.onFinish=a;this.canvasImage=r;this.xto=this.xfrom=0;this.yto=this.yfrom=0;this.wto=this.wfrom=i;this.hto=this.hfrom=n;this.show();return};this.expandV=function(t){this.direction=t?C_DIR_UP:C_DIR_DOWN;this.action=C_ACTION_EXPAND;this.yfrom=this.h;this.yto=0;this.hfrom=0;this.hto=this.h;return};this.expandH=function(t){this.direction=t?C_DIR_LEFT:C_DIR_RIGHT;this.action=C_ACTION_EXPAND;this.xfrom=this.w;this.xto=0;this.wfrom=0;this.wto=this.w;return};this.collapseV=function(t){this.direction=t?C_DIR_UP:C_DIR_DOWN;this.action=C_ACTION_COLLAPSE;this.yfrom=0;this.yto=this.h;this.hfrom=this.h;this.hto=0;return};this.collapseH=function(t){this.direction=t?C_DIR_LEFT:C_DIR_RIGHT;this.action=C_ACTION_COLLAPSE;this.xfrom=0;this.xto=this.w;this.wfrom=this.w;this.wto=0;return};this.expandUp=function(){return this.expandV(true)};this.expandDown=function(){return this.expandV(false)};this.expandLeft=function(){return this.expandH(true)};this.expandRight=function(){return this.expandH(false)};this.collapseUp=function(){return this.collapseV(true)};this.collapseDown=function(){return this.collapseV(false)};this.collapseLeft=function(){return this.collapseH(true)};this.collapseRight=function(){return this.collapseH(false)};this.show=function(){this.canvasElement=Animation.getCanvas();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(t){var e=this.canvas;var i=this.xfrom+(this.xto-this.xfrom)*t;var n=this.yfrom+(this.yto-this.yfrom)*t;var r=this.wfrom+(this.wto-this.wfrom)*t;var a=this.hfrom+(this.hto-this.hfrom)*t;if(!r||!a){return}e.clearRect(0,0,this.w,this.h);var o=i;var s=n;var h=i;var l=n;if(this.action===C_ACTION_EXPAND){switch(this.direction){case C_DIR_UP:{l=0;break}case C_DIR_DOWN:{s=0;break}case C_DIR_LEFT:{h=0;break}case C_DIR_RIGHT:{o=0;break}}}else{switch(this.direction){case C_DIR_UP:{s=0;break}case C_DIR_DOWN:{l=0;break}case C_DIR_LEFT:{o=0;break}case C_DIR_RIGHT:{h=0;break}}}e.drawImage(this.canvasImage,h,l,r,a,o,s,r,a);return true}}function Animation1Alpha(){Animation.apply(this,arguments);this.prepare=function(t,e,i,n,r,a){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.onFinish=a;this.canvasImage=r;this.show();return};this.setRange=function(t,e){this.from=t;this.to=e;return};this.show=function(){this.canvasElement=Animation.getCanvas();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);return true};this.hide=function(){this.visible=false;if(this.canvasElement){try{document.body.removeChild(this.canvasElement)}catch(t){console.log("document.body.removeChild: not found.")}this.canvasElement=null}return true};this.step=function(t){var e=this.canvas;var i=this.from+(this.to-this.from)*t;alphaElement(this.canvasElement,i);console.log("opacity:"+i);return true}}function Animation1Scale(){Animation.apply(this,arguments);this.prepare=function(t,e,i,n,r,a){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.xOrigin="50%";this.yOrigin="50%";this.onFinish=a;this.canvasImage=r;this.show();return};this.setOrigin=function(t,e){this.xOrigin=t;this.yOrigin=e;return};this.setRange=function(t,e){this.from=t;this.to=e;return};this.show=function(){this.canvasElement=Animation.getCanvas();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(t){var e=this.canvas;var i=this.from+(this.to-this.from)*t;var n=this.showWin?t:1-t;scaleElement(this.canvasElement,i,n,this.xOrigin,this.yOrigin);return true}}function animateUIElement(t,e,i){var n=false;var r=t.getRealScale();var a=t.getPositionInView();var o=t.view.getAbsPosition();var s=Math.round(a.x*r)+o.x;var h=Math.round(a.y*r)+o.y;var l=Math.round(t.w*r);var u=Math.round(t.h*r);var c=Animation.getBackendCanvas(l,u);var p=c.getContext("2d");p.save();n=t.visible;t.visible=true;p.scale(r,r);p.translate(-t.x,-t.y);t.paint(p);t.visible=n;p.restore();var f=AnimationFactory.create(e);f.prepare(s,h,l,u,c,function(){if(i){i()}t.setVisible(!n);t.postRedraw()});if(n){t.setVisible(!n);t.postRedraw()}switch(e){case"anim-expand-up":{f.expandUp();break}case"anim-expand-left":{f.expandLeft();break}case"anim-expand-right":{f.expandRight();break}case"anim-expand-down":{f.expandDown();break}case"anim-collapse-up":{f.collapseUp();break}case"anim-collapse-left":{f.collapseLeft();break}case"anim-collapse-right":{f.collapseRight();break}case"anim-collapse-down":{f.collapseDown();break}case"anim-scale1-show-origin-topleft":{f.setOrigin("0%","0%");f.setRange(.5,1);break}case"anim-scale1-show-origin-center":{f.setOrigin("50%","50%");f.setRange(.5,1);break}case"anim-scale1-show-origin-bottomleft":{f.setOrigin("0%","100%");f.setRange(.5,1);break}case"anim-scale1-show-origin-topright":{f.setOrigin("100%","0%");f.setRange(.5,1);break}case"anim-scale1-show-origin-bottomright":{f.setOrigin("100%","100%");f.setRange(.5,1);break}case"anim-scale1-show":{f.setRange(.5,1);break}case"anim-scale1-hide-origin-topleft":{f.setOrigin("0%","0%");f.setRange(1,.5);break}case"anim-scale1-hide-origin-center":{f.setOrigin("50%","50%");f.setRange(1,.5);break}case"anim-scale1-hide-origin-bottomleft":{f.setOrigin("0%","100%");f.setRange(1,.5);break}case"anim-scale1-hide-origin-topright":{f.setOrigin("100%","0%");f.setRange(1,.5);break}case"anim-scale1-hide-origin-bottomright":{f.setOrigin("100%","100%");f.setRange(1,.5);break}case"anim-scale1-hide":{f.setRange(1,.5);break}case"anim-alpha1-show":{f.setRange(.2,1);break}case"anim-alpha1-hide":{f.setRange(1,.2);break}}f.run();return}function testAnimation1Expand(t){var e=t.getWindow().findChildByName("ui-button-test",true);e.setVisible(false);e.postRedraw();setTimeout(function(){animateUIElement(e,"anim-alpha1-show")},100);setTimeout(function(){animateUIElement(e,"anim-alpha1-hide")},3e3);return}function UIElement(){return}UIElement.IMAGE_DISPLAY_CENTER=WImage.DISPLAY_CENTER;UIElement.IMAGE_DISPLAY_TILE=WImage.DISPLAY_TILE;UIElement.IMAGE_DISPLAY_9PATCH=WImage.DISPLAY_9PATCH;UIElement.IMAGE_DISPLAY_SCALE=WImage.DISPLAY_SCALE;UIElement.IMAGE_DISPLAY_AUTO=WImage.DISPLAY_AUTO;UIElement.IMAGE_DISPLAY_DEFAULT=WImage.DISPLAY_DEFAULT;UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO=WImage.DISPLAY_SCALE_KEEP_RATIO;UIElement.IMAGE_DISPLAY_TILE_V=WImage.DISPLAY_TILE_V;UIElement.IMAGE_DISPLAY_TILE_H=WImage.DISPLAY_TILE_H;UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN=WImage.DISPLAY_AUTO_SIZE_DOWN;UIElement.IMAGE_DISPLAY_FIT_WIDTH=WImage.DISPLAY_FIT_WIDTH;UIElement.IMAGE_DISPLAY_FIT_HEIGHT=WImage.DISPLAY_FIT_HEIGHT;UIElement.IMAGE_DISPLAY_NAMES=["incenter","tile","9patch","scale","auto","default","scale(keep ratio)","vtile","htile","auto-size-down","fit-width","fit-height"];UIElement.X_FIX_LEFT=0;UIElement.X_FIX_RIGHT=1;UIElement.X_SCALE=2;UIElement.X_CENTER_IN_PARENT=3;UIElement.X_LEFT_IN_PARENT=4;UIElement.X_RIGHT_IN_PARENT=5;UIElement.X_AFTER_PREV=6;UIElement.X_LAYOUT_NAMES=["fix_left","fix_right","scale","center_in_parent","left_in_parent","right_in_parent","after_prev"];UIElement.Y_FIX_TOP=0;UIElement.Y_FIX_BOTTOM=1;UIElement.Y_SCALE=2;UIElement.Y_MIDDLE_IN_PARENT=3;UIElement.Y_TOP_IN_PARENT=4;UIElement.Y_BOTTOM_IN_PARENT=5;UIElement.Y_AFTER_PREV=6;UIElement.Y_LAYOUT_NAMES=["fix_top","fix_bottom","scale","middle_in_parent","top_in_parent","bottom_in_parent","after_prev"];UIElement.WIDTH_FIX=0;UIElement.WIDTH_SCALE=1;UIElement.WIDTH_FILL_PARENT=2;UIElement.WIDTH_FILL_AVAILABLE=3;UIElement.WIDTH_FILL_TO_PARENT_RIGHT=4;UIElement.HEIGHT_FIX=0;UIElement.HEIGHT_SCALE=1;UIElement.HEIGHT_FILL_PARENT=2;UIElement.HEIGHT_FILL_AVAILABLE=3;UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH=4;UIElement.HEIGHT_FILL_TO_PARENT_BOTTOM=5;UIElement.WIDTH_LAYOUT_NAMES=["fix","scale","fill_parent","fill_avaible","fill_to_parent_right"];UIElement.HEIGHT_LAYOUT_NAMES=["fix","scale","fill_parent","fill_avaible","keep_ratio_with_width","fill_to_parent_bottom"];UIElement.IMAGE_DEFAULT="default_bg";UIElement.IMAGE_MASK="mask_fg";UIElement.IMAGE_NORMAL="normal_bg";UIElement.IMAGE_FOCUSED="focused_bg";UIElement.IMAGE_ACTIVE="active_bg";UIElement.IMAGE_POINTER_OVER="pointer_over_bg";UIElement.IMAGE_DISABLE="disable_bg";UIElement.IMAGE_DISABLE_FG="disable_fg";UIElement.IMAGE_NORMAL_FG="normal_fg";UIElement.IMAGE_ACTIVE_FG="active_fg";UIElement.IMAGE_ON_FG="on_fg";UIElement.IMAGE_OFF_FG="off_fg";UIElement.IMAGE_ON_BG="on_bg";UIElement.IMAGE_OFF_BG="off_bg";UIElement.IMAGE_CHECKED_FG="checked_fg";UIElement.IMAGE_UNCHECK_FG="unchecked_fg";UIElement.IMAGE_ON_FOCUSED="focused_on_bg";UIElement.IMAGE_ON_ACTIVE="active_on_bg";UIElement.IMAGE_OFF_FOCUSED="focused_off_bg";UIElement.IMAGE_OFF_ACTIVE="active_off_bg";UIElement.IMAGE_NORMAL_DRAG="normal_drag";UIElement.IMAGE_DELETE_ITEM="delete_item_icon";UIElement.IMAGE_CHECKED_ITEM="checked_item_icon";UIElement.IMAGE_POINT="point_img";
UIElement.IMAGE_POINT1="point1_img";UIElement.IMAGE_POINT2="point2_img";UIElement.IMAGE_POINT3="point3_img";UIElement.IMAGE_POINT4="point4_img";UIElement.IMAGE_TIPS1="tips_img_1";UIElement.IMAGE_TIPS2="tips_img_2";UIElement.IMAGE_TIPS3="tips_img_3";UIElement.IMAGE_TIPS4="tips_img_4";UIElement.IMAGE_TIPS5="tips_img_5";UIElement.ITEM_BG_NORMAL="item_bg_normal";UIElement.ITEM_BG_ACTIVE="item_bg_active";UIElement.ITEM_BG_CURRENT_NORMAL="item_bg_current_normal";UIElement.ITEM_BG_CURRENT_ACTIVE="item_bg_current_active";UIElement.TEXT_ALIGN_CENTER=0;UIElement.TEXT_ALIGN_LEFT=0;UIElement.TEXT_ALIGN_RIGHT=0;UIElement.TEXT_ALIGN_NAMES=["center","left","right"];UIElement.ORIGIN_UP=1;UIElement.ORIGIN_DOWN=2;UIElement.ORIGIN_LEFT=3;UIElement.ORIGIN_RIGHT=4;UIElement.ORIGIN_UP_LEFT=5;UIElement.ORIGIN_UP_RIGHT=6;UIElement.ORIGIN_DOWN_LEFT=7;UIElement.ORIGIN_DOWN_RIGHT=8;UIElement.ORIGIN_MIDDLE_CENTER=9;UIElement.STATE_STOP=1;UIElement.STATE_RUNNING=2;UIElement.STATE_PAUSED=3;UIElement.prototype=new RShape;UIElement.Style=function(){this.lineWidth=2;this.lineColor="Orange";this.fillColor="White";this.textColor="Blue";this.fontSize=24;return};UIElement.Style.prototype=new ShapeStyle;UIElement.prototype.isUIElement=true;UIElement.prototype.hasChildren=true;UIElement.prototype.isContainer=true;UIElement.disableGetRelativePathOfURL=false;UIElement.prototype.addResource=function(t){if(!this.resources){this.resources=[]}if(this.resources.indexOf(t)<0){this.resources.push(t)}return};UIElement.prototype.setDefaultStyle=function(){this.style=new UIElement.Style;return};UIElement.prototype.clone=function(){var t=null;UIElement.disableGetRelativePathOfURL=true;t=this.dup();t.uid=UIElement.uidStart++;UIElement.disableGetRelativePathOfURL=false;return t};UIElement.prototype.getRelativePathOfURL=function(t){if(UIElement.disableGetRelativePathOfURL||!t){return t}var e="";if(window.location.protocol==="file:"){e=dirname(window.location.href)+"/"}else{e=window.location.protocol+"//"+window.location.host+"/"}if(t.indexOf("/web/backend/")>=0&&t.indexOf(e)>=0){return t}t=t.replace(e,"");return t};UIElement.prototype.setFreePosition=function(t){this.freePosition=t;return};UIElement.prototype.fixChildPosition=function(t){var e=t.x;var i=t.y;var n=t.h;var r=this.getHMargin();var a=this.getVMargin();if(t.freePosition){return}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT||e<r){e=r}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT||i<a){i=a}t.x=e;t.y=i;return};UIElement.prototype.setFreeSize=function(t){this.freeSize=t;return};UIElement.prototype.fixChildSize=function(t){if(t.freeSize){return}if(this.autoAdjustHeight){if(t.y+t.h>this.h){this.h=t.y+t.h+this.vMargin}}var e=t.x;var i=t.w;var n=t.y;var r=t.h;var a=this.getWidth(true);var o=this.getHeight(true);var s=a+this.hMargin;var h=o+this.vMargin;if(e+i>s&&t.widthAttr!=UIElement.WIDTH_FILL_PARENT&&t.xAttr!=UIElement.X_AFTER_PREV&&t.widthAttr!=UIElement.WIDTH_FILL_AVAILABLE&&this.mode===Shape.MODE_EDITING){e=s-i;if(e<0){e=0}i=s-e}if(n+r>h&&t.heightAttr!=UIElement.HEIGHT_FILL_PARENT&&t.yAttr!=UIElement.Y_AFTER_PREV&&t.heightAttr!=UIElement.HEIGHT_FILL_AVAILABLE&&this.mode===Shape.MODE_EDITING){n=h-r;if(n<0){n=0}r=h-n}if(e<0){e=0}if(n<0){n=0}t.x=e;t.y=n;t.w=i<=a?i:a;t.h=r<=o?r:o;return};UIElement.prototype.onInit=function(){this.callOnInitHandler();if(this.dataSourceUrl&&this.dataSourceUrl.length>5){this.bindDataUrl(this.dataSourceUrl)}return};UIElement.prototype.onDeinit=function(){if(this.animatingInfo){this.stopAnimation(true)}return};UIElement.prototype.onWindowOpen=function(){if(this.animations&&this.defaultAnimationName){var t=this.animations[this.defaultAnimationName];if(t){this.animate(t)}}return};UIElement.prototype.initChildren=function(){var t=this.children;var e=this.children.length;for(var i=0;i<e;i++){var n=t[i];n.init()}return};UIElement.prototype.init=function(){try{this.onInit()}catch(t){console.log("onInit Failed:"+t.message+"\n"+t.stack)}this.initChildren();return};UIElement.prototype.deinit=function(){var t=0;var e=null;var i=this.children;var n=this.children.length;for(t=0;t<n;t++){e=i[t];e.deinit()}this.onDeinit();return};UIElement.prototype.onModeChanged=function(){return};UIElement.prototype.userRemovable=function(){return this.mode===Shape.MODE_EDITING};UIElement.prototype.postRedraw=function(){if(this.view){this.view.postRedrawAll()}return this};UIElement.prototype.requestRedraw=UIElement.prototype.postRedraw;UIElement.prototype.setMode=function(t,e){this.mode=t;if(this.type!=="ui-menu-bar"){if(t===Shape.MODE_EDITING){this.setVisible(true)}}if(e){for(var i=0;i<this.children.length;i++){var n=this.children[i];if(n.isContainer){n.setMode(t,true)}}}this.onModeChanged();return this};UIElement.prototype.calcChildrenRange=function(){return this.calcShapesRange(this.children)};UIElement.prototype.calcShapesRange=function(t){var e=0;var i=0;var n=0;var r=0;var a=0;var o=0;var s=1e4;var h=1e4;var l={};if(t.length>0){for(var u=0;u<t.length;u++){var c=t[u];e=c.getX();i=c.getY();n=c.getWidth();r=c.getHeight();if(e<h)h=e;if(i<s)s=i;if(e+n>a)a=e+n;if(i+r>o)o=i+r}l.l=h;l.r=a;l.t=s;l.b=o}else{l.l=0;l.r=0;l.t=0;l.b=0}return l};UIElement.prototype.relayoutChildren=function(){};UIElement.prototype.onSized=function(){this.updateLayoutParams();return};UIElement.prototype.findSelectedShapes=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.selected){t.push(i);continue}if(i.isContainer){i.findSelectedShapes(t)}}return};UIElement.onSelected=function(t){};UIElement.prototype.onSelectChanged=function(){if(this.selected){UIElement.onSelected(this)}return};UIElement.prototype.setSelected=function(t){if(!t){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setSelected(false)}}if(t){this.selectedTime=Date.now()}if(this.selected===t){return}this.targetShape=null;this.selected=t;this.onSelectChanged();return};UIElement.prototype.setPointerEventTarget=function(t){this.pointerEventTarget=t;return};UIElement.prototype.getPointerEventTarget=function(){return this.pointerEventTarget?this.pointerEventTarget:this.targetShape};UIElement.prototype.foreachImage=function(t){for(var e in this.images){if(e!=="display"){var i=this.getImageSrcByType(e);t(e,i)}}return};UIElement.prototype.forEach=function(t){if(t(this)){return true}for(var e=0;e<this.children.length;e++){var i=this.children[e];i.forEach(t)}return false};UIElement.prototype.getAllTabStopElements=function(){var t=[];var e=this.getWindow();if(e){e.forEach(function(e){if(e.isUIButton||e.isUIEdit){t.push(e)}})}return t};UIElement.prototype.findNextTabStop=function(){var t=this.getAllTabStopElements();if(!t.length){return}var e=t.indexOf(this);if(e>=0&&e+1<t.length){return t[e+1]}else{return t[0]}};UIElement.prototype.moveToNextStop=function(){var t=this.findNextTabStop();return};UIElement.prototype.isPointerOverShape=function(){return this.parentShape&&this.parentShape.pointerOverShape===this};UIElement.prototype.setPointerOverShape=function(t){if(this.pointerOverShape!==t){if(this.pointerOverShape){this.pointerOverShape.setPointerOverShape(null)}this.pointerOverShape=t;this.postRedraw()}return};UIElement.prototype.setTarget=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i!==t){i.setSelected(false)}}this.targetShape=t;this.selected=!t;this.onSelectChanged();return this};UIElement.prototype.getTarget=function(){return this.targetShape};UIElement.prototype.initContainerShape=function(t){this.children=new Array;this.toJsoners=new Array;this.fromJsoners=new Array;RShapeInit(this,t);this.mode=Shape.MODE_EDITING;this.rectSelectable=true;return this};UIElement.prototype.defaultDispatchPointerDownToChildren=function(t){var e=this.targetShape;if(e&&e.mode===Shape.MODE_EDITING){var i=this.hitTest(t);if(i!=Shape.HIT_TEST_MM&&i!=Shape.HIT_TEST_NONE){if(this.selected){this.setTarget(null);return true}if(this.targetShape.onPointerDown(t)){return true}}}for(var n=this.children.length;n>0;n--){var r=this.children[n-1];if(r.visible&&r.onPointerDown(t)){this.setTarget(r);return true}}return false};UIElement.prototype.dispatchPointerDownToChildren=function(t){return this.defaultDispatchPointerDownToChildren(t)};UIElement.prototype.onPointerDownEditing=function(t,e){return};UIElement.prototype.onPointerDownRunning=function(t,e){if(this.popupWindow||!this.pointerDown){return}return this.callOnPointerDownHandler(t,e)};UIElement.prototype.onPointerMoveEditing=function(t,e){return};UIElement.prototype.onPointerMoveRunning=function(t,e){if(this.popupWindow){return}return this.callOnPointerMoveHandler(t,e)};UIElement.prototype.onPointerUpEditing=function(t,e){return};UIElement.prototype.onPointerUpRunning=function(t,e){if(this.popupWindow||!this.pointerDown){return}return this.callOnPointerUpHandler(t,e)};UIElement.prototype.onDoubleClick=function(t){if(this.popupWindow||!this.pointerDown){return}if(this.targetShape){var e=this.translatePoint(t);return this.targetShape.onDoubleClick(e)}else{return this.callOnDoubleClickHandler(t)}};UIElement.prototype.onGesture=function(t){if(this.popupWindow){return}if(this.targetShape){return this.targetShape.onGesture(t)}return};UIElement.prototype.onLongPress=function(t){if(this.popupWindow||!this.pointerDown){return}this.longPressed=true;this.callOnLongPressHandler(t);if(this.targetShape){var e=this.translatePoint(t);return this.targetShape.onLongPress(e)}return};UIElement.prototype.onClick=function(t,e){if(e||this.popupWindow||!this.pointerDown){return}return this.callOnClickHandler(t)};UIElement.prototype.translatePoint=function(t){var e={x:t.x-this.x,y:t.y-this.y};return e};UIElement.prototype.setCanRectSelectable=function(t,e){this.rectSelectable=t;for(var i=0;i<this.children.length;i++){var n=this.children[i];n.setCanRectSelectable(t,e)}return};UIElement.prototype.canRectSelectable=function(){return this.rectSelectable&&this.parentShape};UIElement.prototype.setDraggable=function(t){if(this.draggable===t){return}this.draggable=t;if(t){this.addEventNames(["onDragStart","onDragging","onDragEnd"])}else{this.removeEventNames(["onDragStart","onDragging","onDragEnd"])}return};UIElement.prototype.callOnDragStartHandler=function(){if(!this.enable){return false}if(this.mode===Shape.MODE_EDITING){return false}if(!this.handleDragStart||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onDragStart"];if(sourceCode){sourceCode="this.handleDragStart = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDragStart){try{this.handleDragStart()}catch(e){console.log("this.handleDragStart:"+e.message)}}return};UIElement.prototype.callOnDragEndHandler=function(){if(!this.enable){return false}if(this.mode===Shape.MODE_EDITING){return false}if(!this.handleDragEnd||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onDragEnd"];if(sourceCode){sourceCode="this.handleDragEnd = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDragEnd){try{this.handleDragEnd()}catch(e){console.log("this.handleDragEnd:"+e.message)}}return};UIElement.prototype.callOnDragingHandler=function(){if(!this.enable){return false}if(this.mode===Shape.MODE_EDITING){return false}if(!this.handleDraging||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onDragging"];if(sourceCode){sourceCode="this.handleDraging = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDraging){try{this.handleDraging()}catch(e){console.log("this.handleDraging:"+e.message)}}return};UIElement.prototype.onDragStart=function(){console.log("Drag Start");this.callOnDragStartHandler();return};UIElement.prototype.onDragging=function(){console.log("Dragging");this.callOnDragingHandler();return};UIElement.prototype.onDragEnd=function(){console.log("Drag End");this.callOnDragEndHandler();return};UIElement.prototype.dragMove=function(t,e,i){this.x=this.x+t;this.y=this.y+e;this.onDragging(i);return};UIElement.prototype.handleDragMove=function(t){var e=this.getMoveDeltaX();var i=this.getMoveDeltaY();if(!this.dragging){var n=this.getMoveAbsDeltaX();var r=this.getMoveAbsDeltaY();if(Math.abs(n)>5||Math.abs(r)>5){this.dragging=true;this.onDragStart();e=n;i=r}}if(this.dragging){this.dragMove(e,i,t);if(this.parentShape){this.parentShape.onChildDragging(this,t)}}return};UIElement.prototype.onChildDragging=function(t,e){return};UIElement.prototype.onChildDragged=function(t,e){this.sortChildren();this.relayoutChildren("default");return};UIElement.prototype.handleDragUp=function(t){this.onDragEnd();delete this.dragging;if(this.parentShape){this.parentShape.onChildDragged(this,t)}return};UIElement.prototype.animMove=function(t,e,i){if(this.x===t&&this.y===e||this.dragging){return}var n=this;var r=1e3;var a=this.x;var o=this.y;var s=t-this.x;var h=e-this.y;var l=Date.now();var u=new DecelerateInterpolator;function c(){var i=(Date.now()-l)/r;var c=u.get(i);if(n.dragging||!n.parentShape){return false}n.postRedraw();if(i<1){n.x=Math.floor(a+c*s);n.y=Math.floor(o+c*h);return true}else{n.move(t,e);u=null;return false}}UIElement.setAnimTimer(c);return};UIElement.getIntFromConfig=function(t,e,i){var n=t[e];if(!n&&n!==0){return i}if(typeof n==="string"){if(n[1]==="+"||n[1]==="-"){n=i+parseInt(n.substr(1))}else{n=parseInt(n)}}return n};UIElement.prototype.stopAnimation=function(t){if(!this.animatingInfo){return this}if(t){this.stepAnimation({needRedraw:0},Date.now()+1e8)}this.animatingInfo=null;return this};UIElement.prototype.animate=function(t,e,i,n){if(typeof t==="string"){t=this.animations[t]}if(!this.parentShape){console.log("%cWarning: animate error - parentShape is null.","color: red; font-weight: bold");return false}if(this.dragging){console.log("%cWarning: animate error - busy.","color: red; font-weight: bold");return false}var r=this.animatingInfo;if(r){var a=n||t.actionWhenBusy;if(a==="replace"){this.callOnAnimateDone(r);console.log("%cNotice: busy action - replace current animation.","color: green; font-weight: bold")}else if(a==="append"){var o=0;for(var s=r;s;s=s.next){if(s===t){console.log("%cWarning: animate error - already appended.","color: red; font-weight: bold");return false}if(!s.next||o>30){s.next=t;break}o++}console.log("%cNotice: busy action - append animation.","color: green; font-weight: bold");return true}else{console.log("%cWarning: animate error - busy.","color: red; font-weight: bold");return false}}if(!t){console.log("%cWarning: animate error - config is null.","color: red; font-weight: bold");return false}var h=this.x;var l=this.y;var u=this.w;var c=this.h;var p=t.duration||800;var f=UIElement.getIntFromConfig(t,"xStart",h);var m=UIElement.getIntFromConfig(t,"xEnd",h);var d=UIElement.getIntFromConfig(t,"yStart",l);var g=UIElement.getIntFromConfig(t,"yEnd",l);var y=UIElement.getIntFromConfig(t,"wStart",u);var v=UIElement.getIntFromConfig(t,"wEnd",u);var _=UIElement.getIntFromConfig(t,"hStart",c);var I=UIElement.getIntFromConfig(t,"hEnd",c);var w=t.valueStart||0;var x=t.valueEnd||0;var S=t.opacityStart||t.opacityStart===0?t.opacityStart:this.opacity;var C=t.opacityEnd||t.opacityEnd===0?t.opacityEnd:this.opacity;var T=t.rotationStart||t.rotationStart===0?t.rotationStart:this.rotation;var b=t.rotationEnd||t.rotationEnd===0?t.rotationEnd:this.rotation;var D=t.scaleXStart||t.scaleXStart===0?t.scaleXStart:this.scaleX;var A=t.scaleXEnd||t.scaleXEnd===0?t.scaleXEnd:this.scaleX;var E=t.scaleYStart||t.scaleYStart===0?t.scaleYStart:this.scaleY;var U=t.scaleYEnd||t.scaleYEnd===0?t.scaleYEnd:this.scaleY;var M=e||t.onDone;var P=i||t.onStep;var B=m-f;var L=g-d;var R=v-y;var O=I-_;var V=A-D;var W=U-E;var F=C-S;var N=b-T;var k=x-w;var G=null;if(typeof t.interpolator==="string"){G=AnimationFactory.createInterpolator(t.interpolator)}else{G=t.interpolator?t.interpolator:new DecelerateInterpolator}if(!B){this.x=f;m=f}if(!L){this.y=d;g=d}if(!R){v=y=this.w}if(!O){I=_=this.h}var o={};o.wRange=R;o.hRange=O;o.xRange=B;o.yRange=L;o.scaleXRange=V;o.scaleYRange=W;o.opacityRange=F;o.rotationRange=N;o.valueRange=k;o.wStart=y;o.hStart=_;o.xStart=f;o.yStart=d;o.scaleXStart=D;o.scaleYStart=E;o.opacityStart=S;o.rotationStart=T;o.valueStart=w;o.startTime=Date.now();o.duration=p;o.onDone=M;o.onStep=P;o.interpolator=G;o.next=t.next;o.name=t.name;o.now=o.startTime;if(t.delay){o.startTime+=t.delay}this.animatingInfo=o;this.postRedraw();return true};UIElement.prototype.callOnAnimateDone=function(t){this.animating=false;this.animatingInfo=null;var e=t.onDone;if(e){e.call(this,t.name)}if(!this.parentShape)return false;this.callOnAnimateDoneHandler(t.name);if(!this.parentShape)return false;var i=t.next;if(i){if(typeof i==="string"){if(!this.animations[i]){return false}}this.animate(i);return true}return false};UIElement.prototype.isAnimating=function(){return this.animatingInfo&&this.parentShape};UIElement.prototype.stepAnimation=function(t,e){var i=this.animatingInfo;if(!i||!this.parentShape)return;i.now+=t.timeStep*UIElement.timeScale;if(!e){e=i.now}t.needRedraw++;if(i.startTime>e){return}if(!this.visible){this.visible=true}var n=i.wRange;var r=i.hRange;var a=i.xRange;var o=i.yRange;var s=i.valueRange;var h=i.scaleXRange;var l=i.scaleYRange;var u=i.opacityRange;var c=i.rotationRange;var p=i.wStart;var f=i.hStart;var m=i.xStart;var d=i.yStart;var g=i.scaleXStart;var y=i.scaleYStart;var v=i.opacityStart;var _=i.rotationStart;var I=i.valueStart;var w=i.onStep;var x=i.duration;var S=i.startTime;var C=i.interpolator;var T=(e-S)/x;var b=C.get(T);if(s){i.value=I+b*s}if(T>=1){b=1}if(a){this.x=Math.floor(m+b*a)}if(o){this.y=Math.floor(d+b*o)}if(a||o){this.setPosition(this.x,this.y)}if(n){this.clipW=Math.floor(p+b*n)}if(r){this.clipH=Math.floor(f+b*r)}if(n||r){if(!this.clipW&&this.clipW!==0){this.clipW=this.w}if(!this.clipH&&this.clipH!==0){this.clipH=this.h}}if(u){this.opacity=v+b*u}if(c){this.rotation=_+b*c}if(h){this.setScaleX(g+b*h)}if(l){this.setScaleY(y+b*l)}if(w&&!w(this,T,i)){this.callOnAnimateDone(i);return}if(b<1){this.animating=true}else{this.callOnAnimateDone(i)}return};UIElement.prototype.onPointerDownNormal=function(t){if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}var e=this.translatePoint(t);this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.pointerDown=true;this.pointerDownTime=Date.now();this.childrenRange=this.calcChildrenRange();if(this.mode===Shape.MODE_EDITING){this.onPointerDownEditing(t,true)}else if(this.enable){this.onPointerDownRunning(e,true)}this.setPointerEventTarget(null);if(this.hitTestResult===Shape.HIT_TEST_MM||!this.selected){if(this.dispatchPointerDownToChildren(e)){if(this.mode===Shape.MODE_EDITING){this.onPointerDownEditing(t,false)}else if(this.enable){this.onPointerDownRunning(e,false)}this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.setPointerEventTarget(this.targetShape);return true}}if(this.hitTestResult===Shape.HIT_TEST_MM&&this.children.length>1&&this.canRectSelectable()){this.hitTestResult=Shape.HIT_TEST_WORKAREA}this.setTarget(null);this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;if(this.mode===Shape.MODE_EDITING){this.handlePointerEvent(t,1)}if(this.mode===Shape.MODE_EDITING){this.onPointerDownEditing(t,false)}else if(this.enable){this.onPointerDownRunning(e,false)}this.postRedraw();return true};UIElement.prototype.onPointerMoveNormal=function(t){var e=this.translatePoint(t);if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}if(this.draggable&&this.pointerDown){if(this.mode!==Shape.MODE_EDITING){this.handleDragMove(t);return}else{delete this.dragging}}if(this.hitTestResult){if(this.mode===Shape.MODE_EDITING){this.onPointerMoveEditing(t,true)}else if(this.enable){this.onPointerMoveRunning(e,true)}var i=this.getPointerEventTarget();if(i){i.onPointerMove(e);if(this.mode===Shape.MODE_EDITING){this.onPointerMoveEditing(t,false)}else if(this.enable){this.onPointerMoveRunning(e,false)}}else{if(this.mode===Shape.MODE_EDITING){this.onPointerMoveEditing(t,false);if(this.hitTestResult===Shape.HIT_TEST_WORKAREA){var e={x:0,y:0};var n=this.childrenRange;var r=t.x-this.pointerDownPosition.x;var a=t.y-this.pointerDownPosition.y;var o=this.pointerDownPosition.x-this.x;var s=this.pointerDownPosition.y-this.y;var h={x:o,y:s,w:r,h:a};if(o>n.r&&r>0||s>n.b&&a>0||o<n.l&&r<0||s<n.t&&a<0||o>this.w-30&&r>0||s>this.h-30&&a>0||o<30&&r<0||s<30&&a<0){this.hitTestResult=Shape.HIT_TEST_MM;this.handlePointerEvent(t,0)}else if(Math.abs(r)>5&&Math.abs(a)>5){h=fixRect(h);this.setSelected(false);for(var l=this.children.length-1;l>=0;l--){var u=this.children[l];e.x=u.x+u.w/2;e.y=u.y+u.h/2;u.setSelected(isPointInRect(e,h))}}}else{this.handlePointerEvent(t,0)}}else if(this.enable){this.onPointerMoveRunning(e,false)}}this.lastPosition.x=t.x;this.lastPosition.y=t.y;return true}else{var c=null;if(this.isPointIn(null,t)){if(this.isUIFrames&&this.children.length){var u=this.getCurrentFrame();if(u.isPointIn(null,e)){c=u;u.onPointerMoveNormal(e)}}else{for(var l=this.children.length;l>0;l--){var u=this.children[l-1];if(u.isPointIn(null,e)){c=u;u.onPointerMoveNormal(e);break}}}}this.setPointerOverShape(c)}this.lastPosition.x=t.x;this.lastPosition.y=t.y;return false};UIElement.prototype.needDrawTextTips=function(t){return this.mode===Shape.MODE_EDITING&&!this.children.length};UIElement.prototype.textEditable=function(t){return this.mode===Shape.MODE_EDITING};UIElement.prototype.isClicked=function(){if(!this.view){return false}if(this.longPressed&&this.events["onLongPress"]){console.log("Long Pressed, Ignore Click Event.");return false}return this.view.isClicked()};UIElement.prototype.onPointerUpNormal=function(t){if(!this.getParent()){this.setLastEventStatus(UIElement.EVENT_STATUS_NONE)}if(this.hitTestResult){var e=this.translatePoint(t);var i=this.isClicked();if(this.mode===Shape.MODE_EDITING){this.onPointerUpEditing(t,true)}else if(this.enable){this.onPointerUpRunning(e,true)}if(i&&this.enable){this.onClick(e,true)}var n=this.getPointerEventTarget();if(n){n.onPointerUp(e)}else{if(this.mode===Shape.MODE_EDITING){this.handlePointerEvent(t,-1)}}if(this.mode===Shape.MODE_EDITING){this.onPointerUpEditing(t,false)}else{if(this.dragging){this.handleDragUp(t)}else if(this.enable){this.onPointerUpRunning(e,false)}}if(i&&this.enable){this.onClick(e,false)}this.hitTestResult=Shape.HIT_TEST_NONE;if(this.longPressed){this.longPressed=false}return true}else{this.targetShape=null;if(this.mode!==Shape.MODE_EDITING&&this.enable){this.onPointerUpRunning(e,false);if(i){this.onClick(e,false)}}if(this.longPressed){this.longPressed=false}}return false};UIElement.prototype.onKeyDownRunning=function(code){if(!this.handleKeyDown||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onKeyDown"];if(sourceCode){sourceCode="this.handleKeyDown = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyDown){try{this.handleKeyDown(code)}catch(e){console.log("this.handleKeyDown:"+e.message)}}return true};UIElement.prototype.onKeyDownEditing=function(t){};UIElement.prototype.onKeyDown=function(t){if(this.targetShape){this.targetShape.onKeyDown(t)}if(this.mode===Shape.MODE_EDITING){this.onKeyDownEditing(t)}else{this.onKeyDownRunning(t)}return};UIElement.prototype.onKeyUpRunning=function(code){if(!this.handleKeyUp||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onKeyUp"];if(sourceCode){sourceCode="this.handleKeyUp = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyUp){try{this.handleKeyUp(code)}catch(e){console.log("this.handleKeyUp:"+e.message)}}else if(this.isUIWindow&&code==KeyEvent.DOM_VK_BACK_BUTTON&&!cantkIsEditorActive()){console.log("Back Key Pressed On: "+this.name);if(this.isMainWindow()){var app=this.getApp();var wm=this.getWindowManager();if(this.mode===Shape.MODE_RUNNING){wm.systemExit();app.exitApp();console.log("Back Key Pressed, Exit App.")}}else{this.closeWindow(0);console.log("Back Key Pressed, Close Current Window.")}}return true};UIElement.prototype.onKeyUpEditing=function(t){};UIElement.prototype.onKeyUp=function(t){if(t===KeyEvent.DOM_VK_BACK&&this.isUIWindow){this.closeWindow(0);return}if(this.targetShape){this.targetShape.onKeyUp(t)}if(this.mode===Shape.MODE_EDITING){this.onKeyUpEditing(t)}else{this.onKeyUpRunning(t)}return};UIElement.prototype.afterSetView=function(){return true};UIElement.prototype.setView=function(t){this.view=t;for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setView(t)}this.afterSetView(t);return};UIElement.prototype.setApp=function(t){this.app=t;for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setApp(t)}return};UIElement.prototype.shapeCanBeChild=function(t){return true};UIElement.prototype.onAppendedInParent=function(){};UIElement.prototype.afterChildAppended=function(t){return true};UIElement.prototype.beforeAddShapeIntoChildren=function(t){return true};UIElement.prototype.addShapeIntoChildren=function(t,e){var i={x:0,y:0,w:0,h:0};for(var n=this.children.length-1;n>=0;n--){var r=this.children[n];if(r===t)continue;if(r.isContainer&&r.visible){i.x=r.getX();i.y=r.getY();i.w=r.w;i.h=r.h;if(isPointInRect(e,i)){return r.addShape(t,true,e)}}}return false};UIElement.prototype.addChildWithJson=function(t,e){var i=t.type?t.type:t.id;var n=ShapeFactoryGet().createShape(i,C_CREATE_FOR_USER);if(n){n.fromJson(t);this.addShape(n,false,null,e);n.setVisible(true)}return n};UIElement.prototype.setAlwaysOnTop=function(t){this.alwaysOnTop=t;return};UIElement.onAddShape=function(t,e){};UIElement.prototype.fixShapeName=function(t){};UIElement.prototype.addShape=function(t,e,i,n){if(!t.isUIElement){return false}if(e){t.moveDelta(-this.x,-this.y)}if(this.beforeAddShapeIntoChildren(t)&&i){var r=this.translatePoint(i);if(this.addShapeIntoChildren(t,r)){return true}t.move(r.x,r.y)}if(!this.shapeCanBeChild(t)){return false}if(e){var a={};if(t.deviceConfig){a=JSON.parse(t.deviceConfig);t.deviceConfig=null}else{a.version="5";a.platform="iphone";a.lcdDensity="xhdpi"}var o=1;var s=this.getWindow();var h=dupDeviceConfig(this.getDeviceConfig());var l=s&&s.lcddensity?s.lcddensity:h.lcdDensity;if(l!==a.lcdDensity||a.platform!==h.platform){if(l!="all"){h.lcdDensity=l}o=this.getSizeScale(a.lcdDensity,h.lcdDensity);t.notifyDeviceConfigChanged(a,h);if(l!==a.lcdDensity){var u=t.x;var c=t.y;t.scaleForDensity(o,h.lcdDensity,true);t.x=u;t.y=c}}}t.setParent(this);t.setView(this.view);t.setApp(this.app);this.fixShapeName(t);if(isNaN(n)||n<0){this.children.push(t)}else{this.children.insert(n,t)}if(t.isUIElement){t.setMode(this.mode,true);if(this.mode!==Shape.MODE_EDITING){t.init()}}for(var p=0;p<this.children.length;p++){var f=this.children[p];if(f.alwaysOnTop){this.children.remove(f);this.children.push(f);break}}this.afterChildAppended(t);t.onAppendedInParent();if(t.isCreatingElement()){this.relayout();t.callOnBirthedHandler(true)}UIElement.onAddShape(t,e);return true};UIElement.prototype.addShapeDirectly=function(t){if(!this.shapeCanBeChild(t)){return false}this.disableRelayout=true;t.disableRelayout=true;t.setParent(this);t.setView(this.view);t.setApp(this.app);this.children.push(t);if(t.isUIElement){t.mode=this.mode}this.afterChildAppended(t);delete t.disableRelayout;delete this.disableRelayout;return true};UIElement.prototype.addChild=function(t,e){return this.addShape(t,false,null,e)};UIElement.prototype.shapeCanBeRemove=function(t){return true};UIElement.prototype.afterChildRemoved=function(t){return true};UIElement.prototype.remove=function(t,e){var i=this.getParent();if(i){i.removeChild(this,t,e)}return this};UIElement.prototype.removeAll=function(){var t=this.children.length;for(var e=0;e<t;e++){var i=this.children[0];this.removeShape(i)}return};UIElement.prototype.removeChild=function(t,e,i){var n=this;if(t.animatingInfo){console.log("%cWarning: removing animating element.","color: red; font-weight: bold")}if(i){this.removeShape(t,e)}else{t.removed=true;setTimeout(function(){n.removeShape(t,e);t=null;n=null},0)}return this};UIElement.onRemoveShape=function(t,e){};UIElement.prototype.removeShape=function(t,e){if(!this.shapeCanBeRemove(t)||!t.parentShape){return false}if(t.animatingInfo){console.log("%cWarning: removing animating element.","color: red; font-weight: bold")}if(this.targetShape===t){this.targetShape=null}if(this.pointerEventTarget===t){this.pointerEventTarget=null}this.children.remove(t);t.callOnRemovedHandler();this.afterChildRemoved(t);if(t.getParent()===this){t.setParent(null);t.setView(null);t.setApp(null)}if(this.mode===Shape.MODE_EDITING){this.relayout()}UIElement.onRemoveShape(this,t);t.onRemoved(this);if(e){t.destroy()}return};UIElement.prototype.reparent=function(t,e){var i=this.getParent();if(t===i){return}if(!t||!i){return}if(e){var n=i.getPositionInWindow();var r=t.getPositionInWindow();var a=n.x-r.x;var o=n.y-r.y;this.x+=a;this.y+=o}i.children.remove(this);t.addShapeDirectly(this);return};UIElement.prototype.afterPropertyChanged=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.getIndexOfChild=function(t){return this.children.indexOf(t)};UIElement.prototype.getZIndex=function(){if(this.parentShape){return this.parentShape.getIndexOfChild(this)}return 0};UIElement.prototype.setZIndex=function(t){var e=this.parentShape;if(e){e.children.remove(this);e.children.insert(t,this)}return this};UIElement.prototype.findChildByType=function(t,e){var i=0;var n=null;var r=null;var a=this.children.length;for(i=0;i<a;i++){r=this.children[i];if(r.type===t){return r}}if(e){for(i=0;i<a;i++){r=this.children[i];n=r.findChildByType(t,e);if(n){return n}}}return null};UIElement.prototype.findChildByPath=function(t){var e=t.shift();var i=this.findChildByName(e);if(t.length){return i.findChildByPath(t)}return i};UIElement.prototype.findChildByName=function(t,e){var i=0;var n=null;var r=null;var a=this.children.length;for(i=0;i<a;i++){r=this.children[i];if(r.name===t){return r}}if(e){for(i=0;i<a;i++){r=this.children[i];n=r.findChildByName(t,e);if(n){return n}}}return null};UIElement.prototype.find=function(t,e){if(!t){return this}if(t.indexOf("/")>=0){var i=t.split("/");i.remove("");return this.findChildByPath(i)}else{return this.findChildByName(t,e)}};UIElement.prototype.setValueOf=function(t,e){var i=this.findChildByName(t,true);return i?i.setValue(e):null};UIElement.prototype.getValueOf=function(t){var e=this.findChildByName(t,true);return e?e.getValue():null};UIElement.prototype.getSelectMark=function(t,e){if(this.mode!=Shape.MODE_EDITING||this.isLocked()){return false}var i=true;var n=4;switch(t){case Shape.HIT_TEST_TL:{e.x=n;e.y=n;break}case Shape.HIT_TEST_TR:{e.x=this.w-n;e.y=n;break}case Shape.HIT_TEST_BL:{e.x=n;e.y=this.h-n;break}case Shape.HIT_TEST_BR:{e.x=this.w-n;e.y=this.h-n;break}case Shape.HIT_TEST_MOVE:{var r=this.getWindow();if(this.children.length&&r!==this){e.x=this.w>>1;e.y=this.h+20;break}}default:{i=this.getMoreSelectMark(t,e)}}return i};UIElement.prototype.paintSelectingBox=function(t){if(this.hitTestResult===Shape.HIT_TEST_WORKAREA){var e=this.lastPosition.x-this.pointerDownPosition.x;var i=this.lastPosition.y-this.pointerDownPosition.y;if(Math.abs(e)>10&&Math.abs(i)>10){var n=this.pointerDownPosition.x-this.x;var r=this.pointerDownPosition.y-this.y;t.rect(n,r,e,i);t.strokeStyle="Gray";t.stroke()}}return true};UIElement.prototype.beforePaintChild=function(t,e){return};UIElement.prototype.afterPaintChild=function(t,e){return};UIElement.prototype.paintTargetShape=function(t){var e=this.targetShape;if(e&&(this.isUIList&&this.mode===Shape.MODE_EDITING||this.isUIGrid)){shape=e;this.beforePaintChild(shape,t);shape.paintSelf(t);this.afterPaintChild(shape,t)}return};UIElement.prototype.defaultPaintChildren=function(t){t.save();t.beginPath();var e=null;var i=this.children.length;
for(var n=0;n<i;n++){e=this.children[n];if(!e){continue}if(e.visible){this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}else if(e.isAnimating()){e.stepAnimation(t)}}this.paintTargetShape(t);t.restore();return};UIElement.prototype.beforePaintChildren=function(t){if(!this.rotateChildren&&this.rotation){var e=this.w>>1;var i=this.h>>1;t.translate(e,i);t.rotate(-this.rotation);t.translate(-e,-i)}return};UIElement.prototype.afterPaintChildren=function(t){return};UIElement.prototype.paintChildren=function(t){this.defaultPaintChildren(t);return};UIElement.prototype.paintSelfOnly=function(t){return};UIElement.prototype.drawImageAtCenter=function(t,e,i,n,r,a,o){if(e&&e.width>0){var s=e.width;var h=e.height;if(o){var l=Math.min(1,Math.min(a/h,r/s));var u=s*l;var c=h*l;var p=(r-u>>1)+i;var f=(a-c>>1)+n;p=Math.max(p,i);f=Math.max(f,n)}else{p=i;f=n;u=r;c=a}t.drawImage(e,0,0,s,h,p,f,u,c)}return};UIElement.prototype.drawImage=function(t){this.drawFgImage(t);return};UIElement.prototype.drawFgImage=function(t){return};UIElement.prototype.getBgHtmlImage=function(){var t=this.getBgImage();return t?t.getImage():null};UIElement.prototype.getBgImage=function(){var t=null;if(this.enable){if(this.pointerDown&&!this.isClicked()){t=this.images.normal_bg}else{if(this.pointerDown){t=this.images.active_bg}else{if(this.isPointerOverShape()&&this.getHtmlImageByType(UIElement.IMAGE_POINTER_OVER)){t=this.images.pointer_over_bg}else if(this.isFocused()){t=this.images.focused_bg}else{t=this.images.normal_bg}}}}else{t=this.images.disable_bg}if(!t||!t.getImage()){t=this.images.default_bg}if(!t||!t.getImage()){t=this.images.normal_bg}if(!t||!t.getImage()){return}return t};UIElement.prototype.drawImageAt=function(t,e,i,n,r,a,o,s){UIElement.drawImageAt(t,e,i,n,r,a,o,s)};UIElement.drawImageAt=function(t,e,i,n,r,a,o,s){return WImage.draw(t,e,i,n,r,a,o,s)};UIElement.drawImageLine=function(t,e,i,n,r,a){var o=Math.lineAngle(n,r);var s=Math.round(Math.distanceBetween(n,r));t.save();t.translate(n.x,n.y);t.rotate(o);t.translate(0,-e.height>>1);UIElement.drawImageAt(t,e,i,0,0,s,e.height,a);t.restore();return};UIElement.prototype.drawBgImage=function(t){var e=this.getBgImage();if(e){var i=e.getImageRect();e=e.getImage();this.drawImageAt(t,e,this.images.display,0,0,this.w,this.h,i)}return};UIElement.prototype.beforeDrawIcon=function(t){return false};UIElement.prototype.afterDrawIcon=function(t){return false};UIElement.prototype.getLockImage=function(){if(!this.aLockImage){this.aLockImage=new WImage;this.aLockImage.setImageSrc("/drawapp8/images/lock.png")}if(this.aLockImage){return this.aLockImage.getImage()}return null};UIElement.prototype.prepareStyle=function(t){var e=this.style;t.beginPath();if(t.lineWidth!==e.lineWidth){t.lineWidth=e.lineWidth}if(t.strokeStyle!=e.lineColor){t.strokeStyle=e.lineColor}if(t.fillStyle!=e.fillColor){t.fillStyle=e.fillColor}return};UIElement.prototype.updateTransform=function(t){this.callOnUpdateTransformHandler(t);return};UIElement.prototype.saveTransform=function(){this.savedTransform={};this.savedTransform.opacity=this.opacity;this.savedTransform.scale=this.scale;this.savedTransform.scaleX=this.scaleX;this.savedTransform.scaleY=this.scaleY;this.savedTransform.rotation=this.rotation;this.savedTransform.offsetX=this.offsetX;this.savedTransform.offsetY=this.offsetY;return};UIElement.prototype.restoreTransform=function(){if(this.savedTransform){this.opacity=this.savedTransform.opacity;this.scale=this.savedTransform.scale;this.scaleX=this.savedTransform.scaleX;this.scaleY=this.savedTransform.scaleY;this.rotation=this.savedTransform.rotation;this.offsetX=this.savedTransform.offsetX;this.offsetY=this.savedTransform.offsetY}return};UIElement.prototype.setHighlightConfig=function(t){if(t){var e=JSON.parse(JSON.stringify(t));e.startTime=0;this.saveTransform();this.removeHighlightConfig=false;this.highlightConfig=e;if(e.rotationFrom!==undefined&&e.rotationTo!==undefined){e.rotationRange=e.rotationTo-e.rotationFrom;e.rotationMiddle=(e.rotationTo+e.rotationFrom)/2}else{e.rotationRange=0}if(e.opacityFrom!==undefined&&e.opacityTo!==undefined){e.opacityRange=e.opacityTo-e.opacityFrom;e.opacityMiddle=(e.opacityTo+e.opacityFrom)/2}else{e.opacityRange=0}if(e.scaleFrom!==undefined&&e.scaleTo!==undefined){e.scaleRange=e.scaleTo-e.scaleFrom;e.scaleMiddle=(e.scaleTo+e.scaleFrom)/2}else{e.scaleRange=0}if(e.scaleXFrom!==undefined&&e.scaleXTo!==undefined){e.scaleXRange=e.scaleXTo-e.scaleXFrom;e.scaleXMiddle=(e.scaleXTo+e.scaleXFrom)/2}else{e.scaleXRange=0}if(e.scaleYFrom!==undefined&&e.scaleYTo!==undefined){e.scaleYRange=e.scaleYTo-e.scaleYFrom;e.scaleYMiddle=(e.scaleYTo+e.scaleYFrom)/2}else{e.scaleYRange=0}if(e.offsetXFrom!==undefined&&e.offsetXTo!==undefined){e.offsetXRange=e.offsetXTo-e.offsetXFrom;e.offsetXMiddle=(e.offsetXTo+e.offsetXFrom)/2}else{e.offsetXRange=0}if(e.offsetYFrom!==undefined&&e.offsetYTo!==undefined){e.offsetYRange=e.offsetYTo-e.offsetYFrom;e.offsetYMiddle=(e.offsetYTo+e.offsetYFrom)/2}else{e.offsetYRange=0}}else{this.removeHighlightConfig=true}return};UIElement.prototype.updateHighlightTransform=function(t){if(this.highlightConfig){var e=this.highlightConfig;if(e.paused)return;var i=this;var n=0;var r=e.random?e.random/1e3:0;var a=e.frequency?e.frequency:4;if(e.startTime){n=(t.now-e.startTime)/1e3}else{e.startTime=Date.now()}n+=1/(a*4)+r;var o=a*Math.PI*2;var s=UIElement.timeScale*Math.cos(o*n)*.5;if(this.removeHighlightConfig&&Math.abs(s)<.1){this.removeHighlightConfig=false;this.highlightConfig=null;this.restoreTransform();return}if(e.rotationRange){this.rotation=e.rotationMiddle+e.rotationRange*s}if(e.opacityRange){this.opacity=e.opacityMiddle+e.opacityRange*s}if(e.scaleRange){var h=e.scaleMiddle+e.scaleRange*s;this.scaleX=h;this.scaleY=h}if(e.scaleXRange){this.scaleX=e.scaleXMiddle+e.scaleXRange*s}if(e.scaleYRange){this.scaleY=e.scaleYMiddle+e.scaleYRange*s}if(e.offsetXRange){this.offsetX=e.offsetXMiddle+e.offsetXRange*s}if(e.offsetYRange){this.offsetY=e.offsetYMiddle+e.offsetYRange*s}t.needRedraw++}return};UIElement.prototype.paintSelf=function(t){this.stepAnimation(t);if(!this.visible)return;var e=this.animating;t.save();this.translate(t);if(e){var i=Math.min(this.w,this.clipW);var n=Math.min(this.h,this.clipH);if(i&&n){t.beginPath();t.rect(0,0,i,n);t.clip()}}if(this.events["onUpdateTransform"]&&!e){this.updateTransform(t)}if(this.highlightConfig){this.updateHighlightTransform(t)}this.applyTransform(t);t.save();var r=this.flipX?-1:1;var a=this.flipY?-1:1;if(r<0||a<0){t.save();var o=this.w>>1;var s=this.h>>1;t.translate(o,s);t.scale(r,a);t.translate(-o,-s)}this.drawBgImage(t);this.paintSelfOnly(t);this.drawImage(t);if(r<0||a<0){t.restore()}t.restore();if(this.children.length||this.mode===Shape.MODE_EDITING){t.save();if(e){t.animating++}this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);if(e){t.animating--}t.restore()}if(this.drawText&&this.textType!==Shape.TEXT_NONE){this.drawText(t);this.drawTextTips(t)}t.restore();return};UIElement.prototype.regSerializer=function(t,e){this.toJsoners.push(t);this.fromJsoners.push(e);return};UIElement.prototype.toJsonMore=function(t){if(this.isUIDevice){this.exitPreview()}for(var e=0;e<this.toJsoners.length;e++){var i=this.toJsoners[e];if(i){i.call(this,t)}}var n=this.children.length;var r=this.children;if(n){t.children=[];for(var e=0;e<n;e++){var a=r[e];t.children.push(a.toJson())}}return t};UIElement.prototype.childrenFromJson=function(t){if(t.children){var e=t.children.length;this.children.clear(true);for(var i=0;i<e;i++){var n=t.children[i];var r=n.type?n.type:n.id;var a=ShapeFactoryGet().createShape(r,C_CREATE_FOR_USER);if(a){if(this.addShapeDirectly(a)){a.fromJson(n)}}}}this.targetShape=null;this.pointerEventTarget=null;return};UIElement.prototype.fromJsonMore=function(t){for(var e=0;e<this.fromJsoners.length;e++){var i=this.fromJsoners[e];if(i){i.call(this,t)}}this.childrenFromJson(t);this.targetShape=null;this.selected=false;return this};UIElement.prototype.afterApplyFormat=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.findChildByPoint=function(t,e,i){var n=this.children.length;var r=this.translatePoint(t);for(var a=n;a>0;a--){var o=this.children[a-1];if(o.visible&&o.hitTest(r)){if(i&&!i(o)){continue}if(e){return o.findChildByPoint(r,e,i)}else{return o}}}return this};UIElement.prototype.findShapeByPoint=UIElement.prototype.findChildByPoint;UIElement.prototype.getChildren=function(){return this.children};UIElement.prototype.getChild=function(t){return t<this.children.length&&t>=0?this.children[t]:null};UIElement.prototype.canBindingData=function(){return!this.isUIDevice&&!this.isUIScreen&&!this.isUIWindowManager&&this.children.length>0};UIElement.prototype.onDataBindingTemplate=function(t){if(this.isUIImage){var e=this.getImageByType(UIElement.IMAGE_DEFAULT);var i=e?e.getImageSrc():"";i=this.getRelativePathOfURL(i);t.image=i}else{if(this.value!==undefined){t.value=this.value}}if(this.text||this.isUILabel){t.text=this.text}return t};UIElement.prototype.getDataBindingTemplate=function(){var t=0;var e=null;var i={};var n=this.children;var r=this.children.length;this.onDataBindingTemplate(i);if(r>0){i.children=[];for(t=0;t<r;t++){e=n[t];if(!this.childIsBuiltin(e)){i.children.push(e.getDataBindingTemplate())}}}return i};UIElement.prototype.setUserData=function(t){this.userData=t;return};UIElement.prototype.getUserData=function(){return this.userData};UIElement.prototype.onBindData=function(t){var e=t.text;var i=t.image;var n=t.value;if(e!==undefined){this.setText(e)}if(i!==undefined){this.setImage(UIElement.IMAGE_DEFAULT,i)}if(n!==undefined){this.setValue(n)}if(t.enable!==undefined){this.setEnable(t.enable)}if(t.visible!==undefined){this.setVisible(t.visible)}if(t.textColor){this.style.setTextColor(t.textColor)}if(t.fillColor){this.style.setFillColor(t.fillColor)}if(t.lineColor){this.style.setLineColor(t.lineColor)}if(t.fontSize){this.style.setFontSize(t.fontSize)}this.setUserData(t.userData);if(t.height){this.h=t.height}if(t.width){this.w=t.width}if(this.offset){this.offset=0}var r=["children","text","value","image","visible","enable","textColor","fillColor","lineColor","fontSize","userData"];for(var a in t){if(r.indexOf(a)>=0)continue;var n=t[a];var o=this.find(a,true);if(!o)continue;if(typeof n==="object"){o.doBindData(n)}else{o.setValue(n)}}return};UIElement.prototype.moveMustBeLastItemToLast=function(){var t=null;var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=e[n];if(r.name==="ui-last"){t=r;e[n]=e[i-1];e[i-1]=t;break}}return};UIElement.prototype.childIsBuiltin=function(t){return false};UIElement.makeImageURLToAbsOfJson=function(t){if(!t){return}var e=t.images;var i=window.location.protocol+"//"+window.location.host+"/";for(var n in e){var r=e[n];if(n!=="display"){if(r.indexOf("http://")<0&&r.indexOf("https://")<0){r=i+r;e[n]=r}}}if(!t.children){return}for(var a=0;a<t.children.length;a++){var o=t.children[a];UIElement.makeImageURLToAbsOfJson(o)}return};UIElement.prototype.getTemplateChildJson=function(){if(!this.templateChildJson){var t=this.getTemplateChild();this.templateChildJson=t?t.toJson():null;UIElement.makeImageURLToAbsOfJson(this.templateChildJson);if(this.templateChildJson){delete this.templateChildJson.isTemplate}else{console.log("No Template Child.")}}return this.templateChildJson};UIElement.prototype.getTemplateChild=function(){if(!this.templateChild){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isTemplate){this.children.remove(e);this.templateChild=e;break}}if(!this.templateChild){this.templateChild=this.getLastUserChild()}}return this.templateChild};UIElement.prototype.dupTemplateChild=function(){var t=this.getTemplateChild().clone();delete t.isTemplate;return t};UIElement.prototype.dupChild=function(t,e){var i=this.findChildByName(t);if(i){var n=i.clone();n.xAttr=0;n.yAttr=0;this.addShape(n,false,null,e);n.setVisible(true);return n}else{return null}};UIElement.prototype.getLastUserChild=function(){var t=this.children;var e=this.children.length;if(e>0){for(var i=e-1;i>=0;i--){var n=t[i];if(!this.childIsBuiltin(n)){return n}}}return null};UIElement.prototype.countUserChildren=function(){var t=0;var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(!this.childIsBuiltin(r)){t=t+1}}return t};UIElement.prototype.bindData=function(t,e,i){var n=this;n.disableRelayout=true;n.doBindData(t,i);delete n.disableRelayout;n.relayoutChildren(e);console.log("bindData: done");n.postRedraw();return};UIElement.prototype.doBindData=function(t,e){var i=0;var n=0;var r=null;var a=this.isUIList||this.isUIGrid?this.getTemplateChildJson():null;this.onBindData(t);var o=this.children;var s=this.countUserChildren();if(s<1&&!a||!t.children){return}var h=t.children.length;if(this.isUIList||this.isUIGrid){if(h>s){a.y=0;a.visible=true;for(i=s;i<h;i++){this.addChildWithJson(a)}}else if(h<s&&e){var l=[];n=s-h;for(i=this.children.length-1;i>=0;i--){var r=this.children[i];if(!this.childIsBuiltin(r)&&!r.isTemplate){l.push(r)}}for(var i=0;i<l.length;i++){var r=l[i];if(i===n){break}this.children.remove(r);r.setParent(null);r.setApp(null);r.setView(null)}}s=this.children.length}else{s=this.children.length}for(i=0,n=0;n<s&i<h;n++){r=o[n];if(!this.childIsBuiltin(r)){r.doBindData(t.children[i]);i=i+1}}return};UIElement.prototype.bindDataUrl=function(t,e,i){var n={};var r=this;httpGetJSON(t,function(t){if(e){t=e(t)}if(t){r.bindData(t,"default",true)}if(i){i(t)}});return};function UIElementCreator(t){t=t?t:"ui-element";var e=[t,"UI-Element",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIElement;return e.initUIElement(this.type)};return}UIElement.prototype.sortChildren=function(){return};UIElement.prototype.shouldShowContextMenu=function(){return this.mode===Shape.MODE_EDITING};UIElement.prototype.setText=function(t,e){if(this.text!=t){this.text=this.toText(t);if(e){this.callOnChangedHandler(t)}this.textNeedRelayout=true}return this};UIElement.prototype.getValue=function(){return this.getText()};UIElement.prototype.setValue=function(t,e,i){var n=this;var r=this.getText()||0;t=String(t);if(t==String(r))return this;if(!!i&&!isNaN(+t)&&!isNaN(+r)){var a=t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0;this.animate({duration:300,valueEnd:+t,valueStart:+r,onStep:function(t,e,i){n.setText(i.value.toFixed(a));return true},onDone:function(e,i){n.setText(t);console.debug("element setValue onDone")}})}else{this.setText(t)}return this};UIElement.prototype.addValue=function(t,e,i){var n=this.getValue();var r=String(n).indexOf(":");if(r==-1){n=+n;var a=(isNaN(n)?0:n)+(isNaN(+t)?0:+t);var o=u(String(n));var s=u(String(t));var h=u(String(a));var l=o>s?o:s;l=l>h?h:l;function u(t){return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}return this.setValue(a.toFixed(l),e,i)}else{var c=+n.substr(0,r);var p=+n.substr(r+1,2);var f=(isNaN(c)?0:c*60)+(isNaN(p)?0:p);var m=f+t>>0;if(isNaN(+t)||m<0){return this}else{var c=Math.floor(m/60);var p=m%60;c=c<10?"0"+c:c;p=p<10?"0"+p:p;return this.setValue(c+":"+p)}}};UIElement.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.parentShape;while(n!=null){t+=n.getX();e+=n.getY();if(n.isUIVScrollView){e=e-n.offset}else if(n.isUIHScrollView){t=t-n.offset}else if(n.isUIScene){t=t-n.xOffset;e=e-n.yOffset}n=n.parentShape}i.x=t;i.y=e;return i};UIElement.prototype.getLocaleText=function(t){var e=webappGetText(t);if(!e){return t}if(!this.locale){this.locale={text:e};this.needRelayout=true}return e};UIElement.prototype.getLocaleInputTips=function(t){var e=webappGetText(t);return e?e:t};UIElement.prototype.setBgImage=function(t){return this.setImage(UIElement.IMAGE_DEFAULT,t)};UIElement.prototype.setImage=function(t,e){var i=this;t=t?t:UIElement.IMAGE_DEFAULT;var n=null;function r(t){if(!i.parentShape){return}i.postRedraw();if(i.images.display===UIElement.IMAGE_DISPLAY_DEFAULT&&t&&t.width){var e=n?n.getImageRect():null;i.w=e?e.w:t.width;i.h=e?e.h:t.height}return}if(typeof e==="string"){n=WImage.create(e,r)}else if(typeof e==="object"){n=WImage.createWithImage(e)}else if(typeof e==="number"){n=this.images["option_image_"+e]}else{n=WImage.create(e,r)}this.images[t]=n;if(!n){console.log("image is null:"+t+":"+e)}return this};UIElement.prototype.getHtmlImageByType=function(t){var e=this.images[t];return e?e.getImage():null};UIElement.prototype.getImageByType=function(t){return this.images[t]};UIElement.prototype.getImageSrcByType=function(t){var e=this.images[t];return e?e.getImageSrc():""};UIElement.prototype.getImageTypes=function(){var t=[];for(var e in this.images){var i=this.images[e];if(e!="display"){t.push(e)}}return t};UIElement.prototype.addEventNames=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];if(!this.events[i]){this.events[i]=null}}}return this};UIElement.prototype.removeEventNames=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];delete this.events[i]}}return this};UIElement.prototype.getEventNames=function(){var t=[];for(var e in this.events){t.push(e)}return t};UIElement.uidStart=1e4+Math.floor(Math.random()*1e4);UIElement.prototype.initUIElement=function(t){this.initContainerShape(t);this.enable=true;this.visible=true;this.opacity=1;this.vMargin=0;this.hMargin=0;this.xAttr=UIElement.X_FIX_LEFT;this.yAttr=UIElement.Y_FIX_TOP;this.widthAttr=UIElement.WIDTH_FIX;this.heightAttr=UIElement.HEIGHT_FIX;this.name=t;this.events={};this.uid=UIElement.uidStart++;this.runtimeVisible=true;this.images={};this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.addEventNames(["onClick"]);this.regSerializer(this.elementToJson,this.elementFromJson);return this};UIElement.prototype.updateLayoutParams=function(){var t=this.parentShape;if(!t){return}this.xParam=1;this.yParam=1;this.widthParam=1;this.heightParam=1;var e=t.getRelayoutWidth();var i=t.getRelayoutHeight();if(this.xAttr===UIElement.X_SCALE){this.xParam=this.x/e}else if(this.xAttr===UIElement.X_FIX_RIGHT){this.xParam=e-(this.x+this.w)}if(this.yAttr===UIElement.Y_SCALE){this.yParam=this.y/i}else if(this.yAttr===UIElement.Y_FIX_BOTTOM){this.yParam=i-(this.y+this.h)}if(this.widthAttr===UIElement.WIDTH_SCALE){this.widthParam=this.w/e}if(this.heightAttr===UIElement.HEIGHT_SCALE){this.heightParam=this.h/i}if(this.heightAttr===UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH){this.heightParam=this.h/this.w}return this};UIElement.prototype.imagesToJson=function(t){for(var e in this.images){var i=this.images[e];if(e==="display"){t.images[e]=i}else{var n=i.getImageSrc();n=this.getRelativePathOfURL(n);if(n){t.images[e]=n;var r=n.indexOf("#");if(r>0){var a=i.getRealImageSrc();a=this.getRelativePathOfURL(a);var o=n.substr(0,r);if(a&&a.indexOf(n)<0){t.images["real-image-"+o]=decodeURI(a)}}}}}return t};UIElement.prototype.elementToJson=function(t){this.updateLayoutParams();t.events=this.events;t.images={};this.imagesToJson(t);if(this.value!=undefined){t.value=this.value}if(this.animations){t.animations=JSON.parse(JSON.stringify(this.animations))}return t};UIElement.prototype.imagesFromJson=function(t){if(t.images){for(var e in t.images){var i=t.images[e];if(e==="display"){this.images[e]=i}else if(e.indexOf("real-image")!==0){this.setImage(e,i)}}}return};UIElement.prototype.elementFromJson=function(t){if(t.events){delete t.events.onOnUpdateTransform;for(var e in t.events){var i=t.events[e];this.events[e]=i}}for(var e in this.images){var i=this.images[e];if(e!=="display"&&e.indexOf("real-image")!==0){this.setImage(e,null)}}this.imagesFromJson(t);if(t.animations){this.animations=t.animations}if(t.enable!=undefined){this.setEnable(t.enable)}if(t.opacity!=undefined){this.setOpacity(t.opacity)}return this};UIElement.prototype.getEnable=function(){return this.enable};UIElement.prototype.setEnable=function(t){this.enable=t;return this};UIElement.prototype.setVisible=function(t){this.visible=t;if(!t){if(this.animatingInfo){console.log("%cWarning: hide animating element invisble.","color: red; font-weight: bold")}}return this};UIElement.prototype.isFocused=function(){return this.parentShape&&this.parentShape.targetShape==this};UIElement.prototype.isVisible=function(){var t=this;if(!this.isValid()){return false}while(t!=null){if(!t.visible){return false}t=t.parentShape}return true};UIElement.prototype.onShowHTML=function(){return};UIElement.prototype.onHideHTML=function(){return};UIElement.prototype.showHTML=function(){var t=0;var e=this.children.length;for(t=0;t<e;t++){var i=this.children[t];i.showHTML()}this.onShowHTML();return};UIElement.prototype.hideHTML=function(){var t=0;var e=this.children.length;for(t=0;t<e;t++){var i=this.children[t];i.hideHTML()}this.onHideHTML();return};UIElement.prototype.show=function(){return this.setVisible(true)};UIElement.prototype.hide=function(){return this.setVisible(false)};UIElement.prototype.beforeRelayout=function(){};UIElement.prototype.afterRelayout=function(){};UIElement.prototype.getPrevSibling=function(){if(!this.parentShape||this.parentShape.children.length<2){return null}var t=0;for(t=0;t<this.parentShape.children.length;t++){if(this.parentShape.children[t]===this){break}}return t>0?this.parentShape.children[t-1]:null};UIElement.prototype.setAutoScaleFontSize=function(t){this.enableAutoScaleFontSize=t;return this};UIElement.prototype.autoScaleFontSize=function(t){if(this.enableAutoScaleFontSize){var e=Math.round(this.style.fontSize*t);e=Math.min(e,36);e=Math.max(e,12);this.style.setFontSize(e)}return};UIElement.prototype.getRelayoutWidth=function(){return this.getWidth()};UIElement.prototype.getRelayoutHeight=function(){return this.getHeight()};UIElement.prototype.relayout=function(){if(this.disableRelayout){return}var t=getParentShapeOfShape(this);if(!t||!t.isUIElement){if(this.mode===Shape.MODE_EDITING){this.setUserMovable(true);this.setUserResizable(true)}}if(this.isUIDevice){this.setUserResizable(false)}if(!t){this.relayoutChildren();return}var e=0;var i=0;var n=0;var r=0;var a=t.getRelayoutWidth();var o=t.getRelayoutHeight();var s=t.getHMargin();var h=t.getVMargin();var l=a-s-s;var u=o-h-h;var c=this.y+this.h;var p=this.x+this.w;this.beforeRelayout();switch(this.widthAttr){case UIElement.WIDTH_SCALE:{e=a*this.widthParam;if(this.widthScaleMin&&e<this.widthScaleMin){if(this.pointerDown){this.widthScaleMin=e}else{e=this.widthScaleMin}}if(this.widthScaleMax&&e>this.widthScaleMax){if(this.pointerDown){this.widthScaleMax=e}else{e=this.widthScaleMax}}break}case UIElement.WIDTH_FILL_PARENT:{e=l;break}case UIElement.WIDTH_FILL_AVAILABLE:{break}default:{e=this.w;break}}switch(this.heightAttr){case UIElement.HEIGHT_SCALE:{i=o*this.heightParam;if(this.heightScaleMin&&i<this.heightScaleMin){if(this.pointerDown){this.heightScaleMin=i}else{i=this.heightScaleMin}}if(this.heightScaleMax&&i>this.heightScaleMax){if(this.pointerDown){this.heightScaleMax=i}else{i=this.heightScaleMax}}break}case UIElement.HEIGHT_FILL_PARENT:{i=u;break}case UIElement.HEIGHT_FILL_AVAILABLE:{break}default:{i=this.h;break}}switch(this.xAttr){case UIElement.X_SCALE:{n=a*this.xParam;break}case UIElement.X_FIX_RIGHT:{n=a-this.xParam-this.w;break}case UIElement.X_CENTER_IN_PARENT:{n=a-e>>1;break}case UIElement.X_LEFT_IN_PARENT:{n=s;break}case UIElement.X_RIGHT_IN_PARENT:{n=a-e-s;break}case UIElement.X_AFTER_PREV:{var f=this.getPrevSibling();n=f?f.x+f.w:0;break}default:{n=this.x;break}}switch(this.yAttr){case UIElement.Y_SCALE:{r=o*this.yParam;break}case UIElement.Y_FIX_BOTTOM:{r=o-this.yParam-this.h;break}case UIElement.Y_MIDDLE_IN_PARENT:{r=o-i>>1;break}case UIElement.Y_TOP_IN_PARENT:{r=h;break}case UIElement.Y_BOTTOM_IN_PARENT:{r=o-i-h;break}case UIElement.Y_AFTER_PREV:{var f=this.getPrevSibling();r=f?f.y+f.h:0;break}default:{r=this.y;break}}if(this.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||this.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){var m=null;var d=null;this.x=n;this.y=r;for(var g=0;g<t.children.length;g++){var y=t.children[g];if(y.isUIMenu){continue}if(y.y>this.y+30&&this.x<y.x+y.w&&y.x<p){if(!m||y.y<m.y){m=y}}if(y.x>this.x+30&&this.y<y.y+y.h&&y.y<c){if(!d||y.x<d.x){d=y}}}if(this.widthAttr===UIElement.WIDTH_FILL_AVAILABLE){if(d){e=d.x-n}else{e=a-n-s}if(e<=0){e=this.w}}if(this.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){if(m){i=m.y-r}else{i=o-r-h}if(i<=0){i=this.h}}}if(this.widthAttr===UIElement.WIDTH_FILL_TO_PARENT_RIGHT){e=a-n-s}if(this.heightAttr===UIElement.HEIGHT_FILL_TO_PARENT_BOTTOM){i=o-r-h}if(this.heightAttr===UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH){i=e*this.heightParam}var v=this.w;this.x=Math.round(n);this.y=Math.round(r);this.w=Math.round(e);this.h=Math.round(i);if(t.isUIElement){t.fixChildSize(this);t.fixChildPosition(this)}this.setPosition(this.x,this.y);this.setSize(this.w,this.h);this.autoScaleFontSize(e/v);this.relayoutChildren();this.afterRelayout();this.setTextNeedRelayout(true);return};UIElement.prototype.getCustomProp=function(){return""};UIElement.prototype.loadCustomProp=function(t){return};UIElement.prototype.onMoved=function(){if(!this.parentShape||this.mode!=Shape.MODE_EDITING){return}if(this.fixedX!=null&&!isNaN(this.fixedX)){this.x=this.fixedX}if(this.fixedY!=null&&!isNaN(this.fixedY)){this.y=this.fixedY}this.updateLayoutParams();return};UIElement.prototype.setFixPosition=function(t,e){this.fixedX=t;this.fixedY=e;return};UIElement.prototype.beforeRelayoutChild=function(t){return true};UIElement.prototype.afterRelayoutChild=function(t){return true};UIElement.prototype.relayoutChildren=function(){if(this.disableRelayout||!this.children){return}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||e.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){continue}if(this.beforeRelayoutChild(e)){e.relayout()}this.afterRelayoutChild(e)}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(!(e.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||e.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE)){continue}if(this.beforeRelayoutChild(e)){e.relayout()}this.afterRelayoutChild(e)}return};UIElement.prototype.getWindowManager=function(){var t=this;while(t!=null&&!t.isUIWindowManager){t=t.parentShape}return t};UIElement.EVENT_STATUS_NONE=0;UIElement.EVENT_VSCROLL_HANDLED=1;UIElement.EVENT_HSCROLL_HANDLED=2;UIElement.lastEvent={};UIElement.lastEvent.element=null;UIElement.lastEvent.status=UIElement.EVENT_STATUS_NONE;UIElement.prototype.setLastEventStatus=function(t){if(t){UIElement.lastEvent.status|=t;UIElement.lastEvent.element=this}else{UIElement.lastEvent.status=0;UIElement.lastEvent.element=null}return};UIElement.prototype.getLastEventStatus=function(){return UIElement.lastEvent.status};UIElement.prototype.getDevice=function(){var t=this;while(t!=null&&!t.isUIDevice){t=t.parentShape}return t};UIElement.prototype.getDeviceConfig=function(){var t=this.getWindowManager();if(t){return t.getDeviceConfig()}return null};UIElement.prototype.isTopWindow=function(){var t=this.getWindow();var e=this.getWindowManager();var i=e.getCurrentFrame();if(t===i||t===i.popupWindow){return true}return false};UIElement.prototype.getWindow=function(){var t=this;while(t!=null&&!t.isUIWindow){t=t.parentShape}return t};UIElement.prototype.getPositionInWindow=function(){var t=this;var e=t.x;var i=t.y;while(t!=null&&!t.isUIWindow){t=t.parentShape;if(t.isUIWindow){break}e=e+t.x;i=i+t.y}return{x:e,y:i}};UIElement.prototype.getWindowNames=function(){var t=this.getWindowManager();if(t){return t.getWindowNames()}return[]};UIElement.prototype.openWindow=function(t,e,i,n,r){var a=this.getWindowManager();if(a){return a.openWindow(t,e,i,n,r)}return false};UIElement.prototype.backToHomeWin=function(){var t=this.getWindowManager();if(t){t.backToHomeWin()}return};UIElement.prototype.closeWindow=function(t){var e=this.getWindow();var i=this.getWindowManager();if(i&&e){if(i.isWindowOpen(e)){return i.closeCurrentWindow(t)}else{console.log("Current Window Is Not Open.")}}return false};UIElement.prototype.canBeComponent=function(){return true};UIElement.prototype.isCreatingElement=function(){if(this.view&&this.view.creatingShape===this){return true}return false};UIElement.prototype.onScaleForDensityDone=function(t,e){};UIElement.prototype.setNotScaleForDensity=function(t){this.notScaleForDensity=t;return};UIElement.prototype.scaleForDensity=function(t,e,i){if(!t||t===1||this.notScaleForDensity){return}if(this.widthAttr===UIElement.WIDTH_FIX){this.w=Math.floor(this.w*t)}if(this.heightAttr===UIElement.HEIGHT_FIX){this.h=this.h*t;if(this.h<36&&(this.isUIButton||this.isUIProgressBar||this.isUIColorTile||this.isUIColorButton||this.isUIEdit||this.isUIRadioBox||this.isUICheckBox||this.isUIWaitBar||this.isUISwitch)){this.h=40}if(this.h<50&&(this.isUIToolBar||this.isUIButtonGroup)){this.h=50}if(this.hMin>this.h){this.hMin=this.h}}var n=this.isCreatingElement();if(!n&&this.yAttr===UIElement.Y_FIX_TOP){this.y=Math.floor(this.y*t)}if(!n&&this.xAttr===UIElement.X_FIX_LEFT){this.x=Math.floor(this.x*t)}this.style.setFontSize(Math.floor(this.style.fontSize*t));if(this.itemHeight>20){this.itemHeight=Math.floor(this.itemHeight*t)}if(this.roundRadius){this.roundRadius=Math.floor(this.roundRadius*t)}this.vMargin=Math.floor(this.vMargin*t);this.hMargin=Math.floor(this.hMargin*t);if(this.buttonHeight>40){this.buttonHeight=Math.floor(this.buttonHeight*t)}this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.w=Math.floor(this.w);this.h=Math.floor(this.h);if(i){for(var r=0;r<this.children.length;r++){var a=this.children[r];a.scaleForDensity(t,e,true)}}if(this.isUIProgressBar){var o=this.getValue();this.setValue(0);this.setValue(o)}this.onScaleForDensityDone(t,e);return};UIElement.prototype.onDeviceConfigChanged=function(t,e){return};UIElement.prototype.fixImagePath=function(t,e){var i=t.version;var n=t.platform;var r=t.lcdDensity;var a=e.version;var o=e.platform;var s=e.lcdDensity;for(var h in this.images){var l=this.images[h];if(h==="display"){continue}var u=l.getImageSrc();if(u){u=u.replaceAll("/"+r+"/","/"+s+"/");l.setImageSrc(u)}}return};UIElement.prototype.scaleForCurrentDensity=function(t){var e=this.getDeviceConfig();var i=this.getDensitySizeByName(e?e.lcdDensity:"hdpi");return t*(i/160)};UIElement.prototype.getDensitySizeByName=function(t){switch(t){case"ldpi":{return 80}case"mdpi":{return 160}case"hdpi":{return 240}case"xhdpi":{return 350}case"xxhdpi":{return 450}default:{console.log("not supported density: "+t)}}return 160};UIElement.prototype.getSizeScale=function(t,e){var i=this.getDensitySizeByName(t);var n=this.getDensitySizeByName(e);var r=n/i;return r};UIElement.prototype.notifyDeviceConfigChanged=function(t,e){for(var i=0;i<this.children.length;i++){var n=this.children[i];n.notifyDeviceConfigChanged(t,e)}this.fixImagePath(t,e);this.onDeviceConfigChanged(t,e);return};UIElement.prototype.addMovementForVelocityTracker=function(){if(this.velocityTracker){var t={};t.x=this.getMoveAbsDeltaX();t.y=this.getMoveAbsDeltaY();var e=Date.now()*1e6;this.velocityTracker.addMovement(e,t);delete date}return};UIElement.prototype.getSavedState=function(){return this.savedState?this.savedState.json:null};UIElement.prototype.saveState=function(t){this.savedState={};UIElement.disableGetRelativePathOfURL=true;this.savedState.json=t?t:this.toJson();UIElement.disableGetRelativePathOfURL=false;return this};UIElement.prototype.restoreState=function(){if(this.savedState&&this.savedState.json){this.fromJson(this.savedState.json)}return this};UIElement.prototype.clearState=function(t){if(this.savedState){this.savedState.json=null}return this};UIElement.prototype.isUserMovable=function(){if(this.widthAttr==UIElement.WIDTH_FILL_PARENT&&(this.yAttr===UIElement.Y_TOP_IN_PARENT||this.yAttr===UIElement.Y_MIDDLE_IN_PARENT||this.yAttr===UIElement.Y_BOTTOM_IN_PARENT)){return false}if(this.heightAttr===UIElement.HEIGHT_FILL_PARENT&&(this.xAttr===UIElement.X_LEFT_IN_PARENT||this.x===UIElement.X_CENTER_IN_PARENT||this.xAttr===UIElement.X_RIGHT_IN_PARENT)){return false}if(this.widthAttr===UIElement.WIDTH_FILL_PARENT&&this.heightAttr===UIElement.HEIGHT_FILL_PARENT){return false;
}return this.userMovable&&!this.isLocked()};UIElement.prototype.isUserResizable=function(){if(this.widthAttr===UIElement.WIDTH_FILL_PARENT&&this.heightAttr===UIElement.HEIGHT_FILL_PARENT){return false}return this.userResizable};UIElement.prototype.getEditorRect=function(){var t={};t.x=this.x;t.y=this.y;t.w=this.w;t.h=this.h;return t};UIElement.funcs=[];UIElement.setAnimTimer=function(t,e){return UIElement.setTimeout(t,e)};UIElement.setTimeout=function(t,e){e=e?Math.max(e,16):16;t.deltaTime=e;t.time=Date.now()+e;UIElement.funcs.push(t);function i(){var t=UIElement.funcs;var e=Date.now();var n=t.length;UIElement.funcs=[];for(var r=0;r<n;r++){var a=t[r];if(a.time<=e){if(a()){a.time=e+a.deltaTime;UIElement.funcs.push(a)}}else{UIElement.funcs.push(a)}}t=null;if(UIElement.funcs.length){UIElement.animTimerID=requestAnimFrame(i)}else{UIElement.animTimerID=0}}if(!UIElement.animTimerID){UIElement.animTimerID=requestAnimFrame(i,16)}return};UIElement.getMainCanvas=function(){return CantkRT.getMainCanvas()};UIElement.getMainCanvasScale=function(t){if(!UIElement.canvasScale||t){var e=1;var i=1;UIElement.canvasScale={};var n=UIElement.getMainCanvas();if(n.style.width&&n.style.height){e=n.width/parseFloat(n.style.width);i=n.height/parseFloat(n.style.height)}UIElement.canvasScale.x=e;UIElement.canvasScale.y=i}return UIElement.canvasScale};UIElement.prototype.isFullscreenMode=function(){return cantkIsFullscreen()};UIElement.prototype.setFlipX=function(t){this.flipX=t;return this};UIElement.prototype.setFlipY=function(t){this.flipY=t;return this};UIElement.prototype.getFlipX=function(){return this.flipX};UIElement.prototype.getFlipY=function(){return this.flipY};UIElement.prototype.requestFullscreen=function(t){if(!isMobile()){if(t){t(false)}console.log("UIElement.requestFullScreen Rejected(not mobile)")}else{if(!cantkRequestFullscreen(t)){t(false)}console.log("UIElement.requestFullScreen")}return};UIElement.prototype.pickFiles=function(t,e){return showFileDialog(t,true,false,e)};UIElement.prototype.pickFile=function(t,e){if(!window.FileReader){return false}showFileDialog(t,false,true,function(t){var i=t[0];if(i){var n=new FileReader;n.readAsDataURL(i);n.onloadend=function(){if(e){e(i,n.result)}n=null}}});return true};UIElement.prototype.pickAudio=function(t){return this.pickFile("audio/*",t)};UIElement.prototype.pickImage=function(t){return this.pickFile("image/*",t)};UIElement.fixArtTextStyle=function(t){t.fontSize=t.fontSize?t.fontSize:16;t.imageBorder=t.imageBorder?t.imageBorder:10;t.textAlignH=t.textAlignH?t.textAlignH:"left";t.startColor=t.startColor?t.startColor:"Green";t.endColor=t.endColor?t.endColor:"Green";t.lineWidth=t.lineWidth?t.lineWidth:0;t.lineColor=t.lineColor?t.lineColor:"Black";t.shadowColor=t.shadowColor?t.shadowColor:"Black";t.shadowBlur=t.shadowBlur?t.shadowBlur:0;t.shadowOffsetX=t.shadowOffsetX?t.shadowOffsetX:0;t.shadowOffsetY=t.shadowOffsetY?t.shadowOffsetY:0;return t};UIElement.createArtTextImage=function(t,e,i){UIElement.fixArtTextStyle(e);if(!t){return null}var n=300;var r=80;var a=e.imageBorder;var o=e.fontSize;var s=e.fontFamily;var h=e.textAlignH;var l=e.monospace;var u=cantkGetTempCanvas(n,r);var c=u.getContext("2d");c.clearRect(0,0,n,r);var p=n>>1;var f=r>>1;var m="";var d=t.length;if(e.textB){m+="Bold "}if(e.textI){m+="Italic "}m+=o+"pt '"+s+"'";c.font=m;c.textBaseline="middle";c.textAlign="center";switch(h){case"left":{p=a;c.textAlign="left";break}case"right":{p=n-a;c.textAlign="right";break}default:break}if(l){var g=0;for(var y=0;y<d;y++){var v=t[y];var _=c.measureText(v).width;if(_>g){g=_}}g=g+4;n=d*g}else{var I=c.measureText(t).width;n=I+a*2}r=e.fontSize+2*(Math.abs(e.shadowOffsetY)+e.shadowOffsetY+a);u.width=n;u.height=r;if(i){c.fillStyle=i;c.fillRect(0,0,n,r)}c.font=m;c.textBaseline="middle";c.textAlign="center";if(e.useTexture&&e.texture){var w=WImage.create(e.texture);var x=w.getImage();if(x){var S=c.createPattern(x,"repeat");c.fillStyle=S}}else{if(e.startColor!=e.endColor){var C=c.createLinearGradient(0,0,0,r);if(e.horizonalGradient){C=c.createLinearGradient(0,0,n,0)}C.addColorStop(0,e.startColor);C.addColorStop(1,e.endColor);c.fillStyle=C}else{c.fillStyle=e.startColor}}if(e.shadowBlur){c.shadowOffsetX=e.shadowOffsetX;c.shadowOffsetY=e.shadowOffsetY;c.shadowBlur=e.shadowBlur;c.shadowColor=e.shadowColor}p=n>>1;f=r>>1;c.lineWidth=e.lineWidth;c.strokeStyle=e.lineColor;if(l){p=0;var T=g>>1;var d=t.length;c.textAlign="center";for(var y=0;y<d;y++){p=y*g+T;var v=t[y];c.fillText(v,p,f);c.strokeText(v,p,f)}}else{c.fillText(t,p,f);if(c.lineWidth){c.strokeText(t,p,f)}}var b=u.toDataURL();return b};ShapeFactoryGet().addShapeCreator(new UIGroupCreator(200,200,null));UIElement.timeScale=1;UIElement.prototype.getTimeScale=function(){return UIElement.timeScale};UIElement.prototype.setTimeScale=function(t,e){UIElement.timeScaleAnimating=false;if(e&&e>100){var i=this;var n=UIElement.timeScale;var r=t-n;var a=Date.now();UIElement.timeScaleAnimating=true;function o(){if(!UIElement.timeScaleAnimating)return;var i=Date.now()-a;if(i<e){setTimeout(o,100);UIElement.timeScale=n+r*(i/e)}else{UIElement.timeScale=t;UIElement.timeScaleAnimating=false}}o()}else{UIElement.timeScale=t}return this};UIElement.prototype.getAppInfo=function(){var t=this.view.getMetaInfo();return t.general};function UIGroup(){return}UIGroup.prototype=new UIElement;UIGroup.prototype.isUIGroup=true;UIGroup.prototype.initUIGroup=function(t,e,i,n){this.initUIElement(t);this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);this.style.lineColor="rgba(0,0,0,0)";this.style.fillColor="rgba(0,0,0,0)";this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UIGroup.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIListItem){return false}return true};UIGroup.prototype.onPointerUpEditing=function(t,e){if(!e){this.relayoutChildren()}return};UIGroup.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();drawRoundRect(t,this.w,this.h,this.roundRadius);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke()}}return};function UIGroupCreator(t,e,i){var n=["ui-group","ui-group",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIGroup;return r.initUIGroup(this.type,t,e,i)};return}function createUIGroupShape(){var t=new UIGroup;t.initUIGroup("ui-group",200,200,null);t.state=Shape.STAT_NORMAL;return t}function UIWindow(){return}UIWindow.serialNo=0;UIWindow.prototype=new UIElement;UIWindow.prototype.isUIWindow=true;UIWindow.prototype.onGesture=function(t){if(this.mode!=Shape.MODE_EDITING){this.callOnGestureHandler(t)}return};UIWindow.prototype.isMainWindow=function(){var t=this.getWindowManager();var e=t.history[0];var i=t.children[e];return i===this};UIWindow.prototype.resize=function(t,e){if(this.state===Shape.STAT_NORMAL){this.realResize(t,e)}return};UIWindow.prototype.initUIWindow=function(t,e,i,n,r,a){this.initUIElement(t);this.move(e,i);this.settings={};this.setDefSize(n,r);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,a);this.setName("window-"+UIWindow.serialNo++);if(!a){this.style.setFillColor("White")}this.addEventNames(["onSystemInit","onLoad","onUnload","onOpen","onBeforeOpen","onClose","onSwitchToBack","onSwitchToFront","onGesture","onKeyDown","onKeyUp"]);this.setAnimHint("htranslate");this.oldHitTest=this.hitTest;this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UIWindow.prototype.setAnimHint=function(t){this.animHint=t;return true};UIWindow.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow){return false}return true};UIWindow.prototype.onModeChanged=function(){if(this.mode===Shape.MODE_EDITING){this.popupWindow=null}return};UIWindow.prototype.removePopupWindow=function(t){if(this.popupWindow){if(this.popupWindow===t){this.popupWindow=null;this.targetShape=null;return true}return this.popupWindow.removePopupWindow(t)}return false};UIWindow.prototype.setPopupWindow=function(t){if(this.popupWindow){return this.popupWindow.setPopupWindow(t)}else{this.popupWindow=t}return true};UIWindow.prototype.getPopupWindow=function(){if(this.popupWindow){return this.popupWindow.getPopupWindow()}return this.isUIPopupWindow?this:null};UIWindow.prototype.isGrabElement=function(t){return this.grabElement===t};UIWindow.prototype.grab=function(t){this.grabElement=t;return};UIWindow.prototype.ungrab=function(t){this.grabElement=null;return};UIWindow.prototype.dispatchPointerDownToChildren=function(t){if(this.grabElement){this.grabElement.onPointerDown(t);this.setTarget(this.grabElement);return true}return this.defaultDispatchPointerDownToChildren(t)};UIWindow.prototype.onPointerDownNormal=function(t){if(this.popupWindow){this.popupWindow.onPointerDownNormal(t);this.setTarget(this.popupWindow);this.pointerDown=false;return true}return UIElement.prototype.onPointerDownNormal.call(this,t)};UIWindow.prototype.onPointerMoveNormal=function(t){if(this.popupWindow){return this.popupWindow.onPointerMoveNormal(t)}return UIElement.prototype.onPointerMoveNormal.call(this,t)};UIWindow.prototype.onPointerUpNormal=function(t){if(this.popupWindow){return this.popupWindow.onPointerUpNormal(t)}else{var e=this.lastPosition.x-this.pointerDownPosition.x;var i=this.lastPosition.y-this.pointerDownPosition.y;var n=Math.abs(e);var r=Math.abs(i);if(n>20||r>20){if(n>>1>r){if(e<0){this.callOnSwipeLeftHandler()}else{this.callOnSwipeRightHandler()}}if(r>>1>n){if(i<0){this.callOnSwipeUpHandler()}else{this.callOnSwipeDownHandler()}}}}return UIElement.prototype.onPointerUpNormal.call(this,t)};UIWindow.prototype.paintSelfOnly=function(t){this.clearBackground(t);this.drawBgImage(t);return};UIWindow.prototype.paintSelf=function(t){if(this.mode===Shape.MODE_EDITING){UIElement.prototype.paintSelf.call(this,t)}else{t.save();this.translate(t);this.paintSelfOnly(t);this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);t.restore()}if(this.popupWindow){this.popupWindow.paintSelf(t)}return};UIWindow.prototype.paintChildren=function(t){t.save();t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();this.defaultPaintChildren(t);t.restore();return};UIWindow.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIWindow.prototype.hide=function(){this.setVisible(false);this.hideHTML();cantkHideAllInput();return};UIWindow.prototype.setCloseWhenPointerUpOutside=function(t){if(t){this.hitTest=function(t){var e=this.oldHitTest(t);if(!e){if(this.mode!=Shape.MODE_EDITING){e=Shape.HIT_TEST_MM}}return e}}else{this.hitTest=this.oldHitTest}this.closeWhenPointerUpOutside=t;return};UIWindow.prototype.isAnimationEnabled=function(){if(CantkRT.isNative())return false;return this.animHint!=="none"};UIWindow.prototype.getAnimationDuration=function(t){return t?this.openAnimationDuration:this.closeAnimationDuration};UIWindow.prototype.getAnimationName=function(t){var e="";switch(this.animHint){case"fade":{e=t?"anim-fade-in":"anim-fade-out";break}case"scale":{if(this.isUIDialog){e=t?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{e=t?"anim-scale-show-win":"anim-scale-hide-win"}break}case"popup":{e=t?"anim-move-up":"anim-move-down";break}case"htranslate":{e=t?"anim-forward":"anim-backward";break}case"vtranslate":{e=t?"anim-upward":"anim-downward";break}default:{if(this.isUIDialog){e=t?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{if(isAndroid()||isFirefoxMobile()){e=t?"anim-scale-show-win":"anim-scale-hide-win"}else{e=t?"anim-forward":"anim-backward"}}break}}return e};UIWindow.prototype.isSplashWindow=function(){return this.isUINormalWindow&&this.windowType==="splash"};UIWindow.prototype.getSupportedAnimations=function(){var t=["none","default","scale","fade","popup","htranslate","vtranslate"];return t};UIWindow.prototype.clearBackground=function(t){var e=this.images.display;var i=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(i){switch(e){case UIElement.IMAGE_DISPLAY_TILE:case UIElement.IMAGE_DISPLAY_TILE_V:case UIElement.IMAGE_DISPLAY_TILE_H:case UIElement.IMAGE_DISPLAY_SCALE:case UIElement.IMAGE_DISPLAY_9PATCH:case UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO:return;default:break}if(i.width>=this.w&&i.height>=this.h){return}}if(!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};UIWindow.prototype.defaultChildrenFromJson=UIElement.prototype.childrenFromJson;UIWindow.prototype.loadChildren=function(){if(this.childrenJson){this.defaultChildrenFromJson(this.childrenJson);delete this.childrenJson;delete this.pendingLoadChildren;console.log("Now To Load Children Of "+this.name);if(this.scaleInfo){this.scaleForDensity(this.scaleInfo.sizeScale,this.scaleInfo.lcdDensity,true)}var t=this.getWindowManager();var e=t.oldConfig;var i=t.deviceConfig;if(e&&i){this.notifyDeviceConfigChanged(e,i)}}return};UIWindow.prototype.childrenFromJson=function(t){if(t.lazyLoad&&!dappIsEditorApp()){this.childrenJson=t;this.pendingLoadChildren=true;console.log("Delay To Load Children Of "+this.name)}else{delete this.pendingLoadChildren;this.defaultChildrenFromJson(t)}return};function UINormalWindow(){return}UINormalWindow.prototype=new UIWindow;UINormalWindow.prototype.isUINormalWindow=true;function UINormalWindowCreator(t){var e=["ui-window","ui-window",null,1];ShapeCreator.apply(this,e);this.createShape=function(e){var i=new UINormalWindow;i.initUIWindow(this.type,0,0,100,100,t);i.widthAttr=UIElement.WIDTH_FILL_PARENT;i.heightAttr=UIElement.HEIGHT_FILL_PARENT;i.addEventNames(["onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown"]);return i};return}UIWindow.prototype.initStageOne=function(){this.forEach(function(t){if(t.offset){t.offset=0}t.visible=t.runtimeVisible;if(t.animatingInfo){t.animatingInfo=null;t.animating=false}if(t.animations&&t.animations[t.defaultAnimationName]){console.log(t.name+" has default animation, set it invisible initially.");t.visible=false}});return};UIWindow.prototype.onInit=function(){this.initStageOne();return};UIWindow.prototype.prepareForOpen=function(){if(!this.getSavedState()){this.relayout();this.saveState()}else{this.restoreState()}this.relayout();return this};UIWindow.prototype.callOnBeforeOpen=function(t){this.show();this.init();return this.callOnBeforeOpenHandler(t)};UIWindow.prototype.callOnOpen=function(t){delete this.openPending;if(this.onOpen){try{this.onOpen(t)}catch(e){console.log("onOpen"+e.message)}}this.callOnOpenHandler(t);if(this.isSplashWindow()){var i=this;var n=i.duration?i.duration:3e3;if(window.splashWinTimeID){clearTimeout(window.splashWinTimeID);delete window.splashWinTimeID}window.splashWinTimeID=setTimeout(function(){if(i.visible){i.openWindow(null,null,true)}},n)}this.forEach(function(t){t.onWindowOpen()});return true};UIWindow.prototype.callOnClose=function(t){if(this.onClose){try{this.onClose(t)}catch(e){console.log("onClose: "+e.message)}}this.callOnCloseHandler(t);this.deinit();this.hide();if(this.destroyWhenClose){this.getWindowManager().removeChild(this,true)}return true};UIWindow.prototype.callOnSwitchToBack=function(t){this.callOnSwitchToBackHandler();if(!t){this.hide()}return true};UIWindow.prototype.callOnSwitchToFront=function(t){if(this.isUINormalWindow&&(this.w!=this.parentShape.w||this.h!=this.parentShape.h)){this.relayout();console.log("WindowManager Size Changed, Relayout Current Window.")}this.show();this.callOnSwitchToFrontHandler();return true};UIWindow.prototype.relayout=function(){if(!this.getWindowManager().isDeviceDirectionOK()){console.log("UIWindow.prototype.relayout Reject Relayout");return}return UIElement.prototype.relayout.call(this)};ShapeFactoryGet().addShapeCreator(new UINormalWindowCreator(null));function UIDialog(){return}UIDialog.prototype=new UIWindow;UIDialog.prototype.isUIDialog=true;UIDialog.prototype.isUIPopupWindow=true;function UIDialogCreator(t,e,i){var n=["ui-dialog","ui-dialog",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIDialog;r.initUIWindow(this.type,0,0,t,e,i);r.setMargin(8,8);r.xAttr=UIElement.X_CENTER_IN_PARENT;r.yAttr=UIElement.Y_MIDDLE_IN_PARENT;r.images.display=UIElement.IMAGE_DISPLAY_SCALE;r.setAnimHint("scale");return r};return}ShapeFactoryGet().addShapeCreator(new UIDialogCreator(600,400,null));function UIEdit(){return}UIEdit.prototype=new UIElement;UIEdit.prototype.isUIEdit=true;UIEdit.prototype.initUIEdit=function(t,e,i,n,r,a,o,s){this.initUIElement(t);this.setDefSize(e,i);this.setText(a);this.leftMargin=n;this.rightMargin=r;this.setSizeLimit(60,30,1e3,80);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,o);this.setImage(UIElement.IMAGE_FOCUSED,s);this.setMargin(5,5);this.setInputType("text");this.addEventNames(["onChanged","onChanging","onFocusIn","onFocusOut"]);this.setTextAlignV("middle");this.setTextAlignH("left");return this};UIEdit.prototype.shapeCanBeChild=function(t){if(t.isUIButton){return true}return false};UIEdit.prototype.textEditable=function(t){return true};UIEdit.prototype.getLocaleText=function(t){if(t===" "){return t}if(this.inputType==="password"&&t&&t===this.text){var e="";var i=t.length;for(var n=0;n<i;n++){e=e+"*"}return e}else{return t}};UIEdit.prototype.drawText=function(t){var e=this.h>>1;var i=this.leftMargin;var n=this.getLocaleText(this.text);var r=this.w-i-this.rightMargin;var a=this.inputTips;if(!n&&!a||this.editing){return}t.save();t.font=this.style.getFont();if(n){t.fillStyle=this.style.textColor}else{n=a;t.fillStyle="#E0E0E0"}t.beginPath();t.rect(0,0,this.w-this.rightMargin,this.h);t.clip();t.textAlign="left";t.textBaseline="middle";t.fillText(n,i,e);t.restore();return};UIEdit.prototype.paintSelfOnly=function(t){var e=this.getBgImage();if(e){return}t.beginPath();drawRoundRect(t,this.w,this.h,8);t.fillStyle=this.style.fillColor;t.fill();t.strokeStyle=this.style.lineColor;t.lineWidth=this.isFocused()?4:2;t.stroke();return};UIEdit.prototype.onClick=function(t,e){if(e){return}if(this.mode!==Shape.MODE_EDITING){this.editText()}return};UIEdit.prototype.getWidth=function(t){var e=this.w;if(t){e=e-this.leftMargin-this.rightMargin}return e};UIEdit.prototype.getEditorRect=function(){var t=this.getPositionInView();var e=this.view.getAbsPosition();var i=this.view.getViewScale();var n=e.x;var r=e.y;var a=t.y*i+r;if(isMobile()){var o=t.x*i+n;var s=this.getWidth()*i}else{var o=(t.x+this.leftMargin)*i+n;var s=this.getWidth(true)*i}var h=this.getHeight()*i;var l={};i=UIElement.getMainCanvasScale();l.x=o/i.x;l.y=a/i.y;l.w=Math.max(60,s)/i.x;l.h=h/i.y;return l};UIEdit.prototype.editText=function(t){var e=this;if(this.textType&&this.textEditable(t)){var i=this;var n=this.getText();var r=this.getEditorRect();var a=this.getRealScale()/UIElement.getMainCanvasScale().y;var o=this.inputType?this.inputType:"text";var s=this.style.fontSize*a;var h=cantkShowInput(o,s,n,r.x,r.y,r.w,r.h);i.editing=true;function l(t){if(t!==i.text){i.setText(t,true);i.postRedraw()}else{i.text=t}h.setOnChangedHandler(null);h.setOnChangeHandler(null);h.hide();delete i.editing;i.callOnFocusOutHandler();return}function u(t){i.callOnChangingHandler(t)}h.setOnChangedHandler(l);h.setOnChangeHandler(u);this.callOnFocusInHandler()}return};UIEdit.prototype.drawTextTips=function(t){};function UIEditCreator(t,e,i,n,r,a){var o=["ui-edit","ui-edit",null,1];ShapeCreator.apply(this,o);this.createShape=function(o){var s=new UIEdit;return s.initUIEdit(this.type,t,e,i,n,dappGetText("Edit"),r,a)};return}ShapeFactoryGet().addShapeCreator(new UIEditCreator(120,50,12,12,null,null));function UIGauge(){return}UIGauge.prototype=new UIElement;UIGauge.prototype.isUIGauge=true;UIGauge.IMAGE_POINTER="pointer-image";UIGauge.prototype.initUIGauge=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onInit"]);return this};UIGauge.prototype.shapeCanBeChild=function(t){return t.isUILedDigits||t.isUILabel||t.isUIGaugePointer};UIGauge.prototype.afterChildAppended=function(t){var e=20;var i=0;if(t.isUIGaugePointer){t.xAttr=UIElement.X_CENTER_IN_PARENT;t.yAttr=UIElement.Y_MIDDLE_IN_PARENT}for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.isUIGaugePointer){continue}switch(i){case 0:{e=100;break}case 1:{e=70;break}case 2:{e=40;break}}i=i+1;r.setSizeLimit(e,e,e,e,1);r.setSize(e,e)}this.setSizeLimit(100,100,1e3,1e3,1);return};UIGauge.prototype.paintSelfOnly=function(t){return};function UIGaugeCreator(){var t=["ui-gauge","ui-gauge",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGauge;return e.initUIGauge(this.type,200,200)};return}function UIGaugePointer(){return}UIGaugePointer.prototype=new UIElement;UIGaugePointer.prototype.isUIGaugePointer=true;UIGaugePointer.prototype.initUIGaugePointer=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIGauge.IMAGE_POINTER,null);this.value=0;this.minAngle=0;this.maxAngle=360;this.minValue=0;this.maxValue=60;return this};UIGaugePointer.prototype.shapeCanBeChild=function(t){return false};UIGaugePointer.prototype.setText=function(t){t=this.toText(t?t:0);try{this.setValue(parseInt(t))}catch(e){console.log("UIGaugePointer.prototype.setText:"+e.message)}return this};UIGaugePointer.prototype.getText=function(){return this.getValue()+""};UIGaugePointer.prototype.setValue=function(t){if(t>=this.minValue&&t<=this.maxValue){this.value=t}else{console.log("UIGaugePointer.prototype.setValue: Out Of Range.")}return this};UIGaugePointer.prototype.getValue=function(){return this.value};UIGaugePointer.prototype.animSetValue=function(t,e){return this.animSetValue(t,e)};UIGaugePointer.prototype.animateSetValue=function(t,e){if(t<this.minValue){t=this.minValue}if(t>this.maxValue){t=this.maxValue}var i=this;var n=t;var r=this.getValue();var a=t-r;var o=Math.abs(a*(this.maxAngle-this.minAngle)/(this.maxValue-this.minValue));if(o<5){this.setValue(t);return}var s=(new Date).getTime();var h=e&&e=="slow"?1e3:500;function l(){var t=new Date;var e=(t.getTime()-s)/h;if(e<1){var o=r+a*e;i.setValue(o);setTimeout(l,10)}else{delete s;i.setValue(n)}delete t;i.postRedraw()}l();return};UIGaugePointer.prototype.getAngle=function(t){var e=this.maxAngle-this.minAngle;var i=this.maxValue-this.minValue;var n=this.value/i*e+this.minAngle;n=Math.PI*(n/180);return n};UIGaugePointer.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=this.w;var r=this.h;var a=this.getAngle();var o=this.getHtmlImageByType(UIGauge.IMAGE_POINTER);if(o&&o.width){var s=o.width;var h=o.height;t.translate(n/2,r/2);t.rotate(a);t.translate(-n/2,-r/2);e=(n-s)/2;i=(r-h)/2;t.drawImage(o,e,i)}else{t.fillRect(0,0,this.w,this.h)}return};function UIGaugePointerCreator(){var t=["ui-gauge-pointer","ui-gauge-pointer",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGaugePointer;return e.initUIGaugePointer(this.type,20,200)};return}ShapeFactoryGet().addShapeCreator(new UIGaugePointerCreator);ShapeFactoryGet().addShapeCreator(new UIGaugeCreator);function UIHtml(){return}UIHtml.prototype=new UIElement;UIHtml.prototype.isUIHtml=true;UIHtml.prototype.initUIHtml=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);return this};UIHtml.prototype.shapeCanBeChild=function(t){return false};UIHtml.prototype.drawBgImage=function(t){if(this.mode===Shape.MODE_EDITING||this.isIcon){var e=this.getBgImage();if(e){var i=e.getImage();var n=e.getImageRect();this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,n)}else{t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}}return};UIHtml.prototype.setVisible=function(t){if(this.visible!=t){if(t){this.onShowHTML()}else{this.onHideHTML()}this.visible=t}return this};UIHtml.prototype.showHTMLElement=function(){var t=this.element;if(t){var e=this.getRealScale();var i=this.getPositionInView();var n=i.x*e+this.view.getX();var r=i.y*e+this.view.getY();var a=this.w*e;var o=this.h*e;t.style.position="absolute";t.style.left=n+"px";t.style.top=r+"px";t.style.width=a+"px";t.style.height=o+"px";t.style.visibility="visible";this.htmlVisible=true}return};UIHtml.prototype.createHTMLElement=function(t){var e=null;if(!this.element){e=document.createElement(t);e.id=this.type+this.name;document.body.appendChild(e);this.element=e}return this.element};UIHtml.prototype.beforeShowHTML=function(){};UIHtml.prototype.setScrollable=function(t){this.scrollable=t;return};UIHtml.prototype.onSetElementStyle=function(){var t=Math.floor(this.scaleForCurrentDensity(14));this.element.style.fontSize=t+"px";this.element.style.marginLeft="0px";this.element.style.marginTop="0px";this.element.style.marginBottom="0px";this.element.style.marginRight="0px";return};UIHtml.prototype.onShowHTML=function(){this.createHTMLElement("div");this.element.innerHTML=this.getHtmlContent();this.element.style.overflow=this.scrollable?"scroll":"hidden";this.element.style.zIndex=5;this.element.style["-ms-touch-action"]="auto";this.onSetElementStyle();if(this.mode!=Shape.MODE_EDITING){this.beforeShowHTML();this.showHTMLElement()}return};UIHtml.prototype.beforeHideHTML=function(){};UIHtml.prototype.onHideHTML=function(){this.htmlVisible=false;if(this.element){this.beforeHideHTML();this.element.style.visibility="hidden"}return};UIHtml.prototype.getValue=function(){return this.value};UIHtml.prototype.setValue=function(t){this.value=t;return};UIHtml.prototype.setHtmlContent=function(t){this.htmlContent=t;if(this.element){this.element.innerHTML=t}return this};UIHtml.prototype.getHtmlContent=function(){return this.htmlContent};function UIHtmlCreator(t,e){var i=["ui-html","ui-html",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIHtml;return n.initUIHtml(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlCreator);function UIVideo(){return}UIVideo.prototype=new UIHtml;UIVideo.prototype.isUIVideo=true;UIVideo.prototype.getHtmlContent=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.value?this.value:"";var n=this.loop?'loop="loop" ':"";var r=this.autoPlay?'autoplay="true" ':"";var a=this.showControls?'controls="controls" ':"";var o='<video width="'+t+'" height="'+e+'" preload="true" '+a+n+r+'src="'+i+'"></video>';return o};UIVideo.prototype.beforeHideHTML=function(){video=this.getVideoElement();if(video.src&&!video.puased){video.pause()}return};UIVideo.prototype.getVideoElement=function(){if(this.element){var t=this.element.getElementsByTagName("video");return t.length?t[0]:null}return null};UIVideo.prototype.setShowControls=function(t){this.showControls=t;return};UIVideo.prototype.isShowControls=function(){return this.showControls};UIVideo.prototype.setLoop=function(t){this.loop=t;return};UIVideo.prototype.isLoop=function(){return this.loop};UIVideo.prototype.setAutoPlay=function(t){this.autoPlay=t;return};UIVideo.prototype.isAutoPlay=function(){return this.autoPlay};UIVideo.prototype.initUIVideo=function(t){this.initUIHtml(t,400,300);this.setValue("http://www.w3school.com.cn/i/movie.ogg");this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIVideoCreator(){var t=["ui-video","ui-video",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVideo;return e.initUIVideo(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIVideoCreator);function UIFlash(){return}UIFlash.prototype=new UIHtml;UIFlash.prototype.isUIFlash=true;UIFlash.prototype.getHtmlContent=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.value?this.value:"";var n='<object type="application/x-shockwave-flash" width="'+t+'" height="'+e+'"> <param name="movie" value="'+i+'" /> <param name="quality" value="high" /></object>';return n};UIFlash.prototype.initUIFlash=function(t){this.initUIHtml(t,400,300);this.setValue("test/5.swf");this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIFlashCreator(){var t=["ui-flash","ui-flash",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFlash;return e.initUIFlash(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIFlashCreator);function UIHtmlImage(){return}UIHtmlImage.prototype=new UIHtml;UIHtmlImage.prototype.isUIHtmlImage=true;UIHtmlImage.prototype.getHtmlContent=function(){var t=this.getRealScale();var e=Math.round(t*this.w);var i=Math.round(t*this.h);var n=this.getImageSrcByType(UIElement.IMAGE_DEFAULT);var r='<img src="'+n+'" width='+e+" height="+i+">";return r};UIHtmlImage.prototype.initUIHtmlImage=function(t){this.initUIHtml(t,400,300);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIHtmlImageCreator(){var t=["ui-html-image","ui-html-image",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIHtmlImage;return e.initUIHtmlImage(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlImageCreator);function UITips(){return}UITips.prototype=new UIElement;UITips.prototype.isUITips=true;UITips.prototype.initUITips=function(t,e){this.initUIElement(t);this.roundRadius=8;this.setDefSize(200,200);this.setClickable(true);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,e);this.pointerDirection=UITips.BOTTOM;this.pointerOffset=1;this.pointer={x:0,y:0};this.setMargin(20,20);this.setSizeLimit(80,80);this.autoAdjustHeight=true;return this};UITips.TOP=0;UITips.LEFT=1;UITips.RIGHT=2;UITips.BOTTOM=3;UITips.prototype.getPointer=function(){var t=0;var e=0;var i=this.roundRadius+this.hMargin*2;var n=this.roundRadius+this.vMargin*2;switch(this.pointerDirection){case UITips.TOP:case UITips.BOTTOM:{t=this.pointerOffset*this.w;t=Math.max(t,i);t=Math.min(t,this.w-i);e=this.pointerDirection===UITips.TOP?0:this.h;break}case UITips.LEFT:case UITips.RIGHT:{e=this.pointerOffset*this.h;e=Math.max(e,n);e=Math.min(e,this.h-n);t=this.pointerDirection===UITips.LEFT?0:this.w;break}}return{x:t,y:e}};UITips.prototype.getMoreSelectMark=function(t,e){if(t===Shape.HIT_TEST_HANDLE){e.x=this.pointer.x;e.y=this.pointer.y;return true}return false};UITips.prototype.moveHandle=function(t,e){var i=.5*this.w;var n=.5*this.h;var r=this.roundRadius+this.hMargin;var a=this.pointer;a.x+=t;a.y+=e;var o=a.x>=0?a.x:0;o=o<this.w?o:this.w;var s=a.y>=0?a.y:0;s=s<this.h?s:this.h;if(a.y<r){this.pointerOffset=o/this.w;this.pointerDirection=UITips.TOP}else if(a.y<this.h-r){this.pointerOffset=s/this.h;this.pointerDirection=a.x<i?UITips.LEFT:UITips.RIGHT}else{this.pointerOffset=o/this.w;this.pointerDirection=UITips.BOTTOM}this.pointer=a;return};UITips.prototype.setAutoAdjustHeight=function(t){this.autoAdjustHeight=t;return true};UITips.prototype.setClickable=function(t){this.clickable=t;return};UITips.prototype.drawPath=function(t){var e=this.hMargin/2;var i=this.vMargin/2;var n=this.getWidth(true)+this.hMargin;var r=this.getHeight(true)+this.vMargin;var a=this.getPointer();var o=a.x;var s=a.y;var h=this.hMargin*.75;var l=this.roundRadius;var u=e+n-l;var c=i+r-l;var p=e+n;var f=i+r;if(s<=i&&(o>e&&o<p)){s=0;if(o<e+l+h){o=e+l+h}t.moveTo(o-h,i);t.lineTo(o,s);t.lineTo(o+h,i);t.lineTo(u,i);t.arc(u,i+l,l,1.5*Math.PI,2*Math.PI,false);t.lineTo(p,c);t.arc(u,c,l,0,.5*Math.PI,false);t.lineTo(e+l,f);t.arc(e+l,c,l,.5*Math.PI,Math.PI,false);t.lineTo(e,l+i);t.arc(e+l,i+l,l,Math.PI,1.5*Math.PI,false);t.lineTo(o-h,i)}else if(s>i&&(o>e&&o<p)){
s=this.h;if(o<e+l+h){o=e+l+h}t.moveTo(e+l,i);t.arc(u,i+l,l,1.5*Math.PI,2*Math.PI,false);t.lineTo(p,c);t.arc(u,c,l,0,.5*Math.PI,false);t.lineTo(o+h,f);t.lineTo(o,s);t.lineTo(o-h,f);t.arc(e+l,c,l,.5*Math.PI,Math.PI,false);t.lineTo(e,l+i);t.arc(e+l,i+l,l,Math.PI,1.5*Math.PI,false)}else if(o<=e&&(s>i&&s<f)){o=0;if(s<i+l+h){s=i+l+h}t.moveTo(e+l,i);t.arc(u,i+l,l,1.5*Math.PI,2*Math.PI,false);t.lineTo(p,c);t.arc(u,c,l,0,.5*Math.PI,false);t.lineTo(e+l,f);t.arc(e+l,c,l,.5*Math.PI,Math.PI,false);t.lineTo(e,s+h);t.lineTo(o,s);t.lineTo(e,s-h);t.lineTo(e,l+i);t.arc(e+l,i+l,l,Math.PI,1.5*Math.PI,false)}else if(o>e&&(s>i&&s<f)){o=this.w;if(s<i+l+h){s=i+l+h}t.moveTo(e+l,i);t.arc(u,i+l,l,1.5*Math.PI,2*Math.PI,false);t.lineTo(p,s-h);t.lineTo(o,s);t.lineTo(p,s+h);t.lineTo(p,c);t.arc(u,c,l,0,.5*Math.PI,false);t.lineTo(e+l,f);t.arc(e+l,c,l,.5*Math.PI,Math.PI,false);t.lineTo(e,l+i);t.arc(e+l,i+l,l,Math.PI,1.5*Math.PI,false)}return};UITips.prototype.paintSelfOnlyByColor=function(t){t.beginPath();this.drawPath(t);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){t.strokeStyle=this.style.lineColor;t.lineWidth=this.pointerDown&&this.clickable?4:2;t.stroke()}return};UITips.prototype.paintSelfOnly=function(t){if(this.autoAdjustHeight&&(!this.children||!this.children.length)){var e=this.getTextHeight();this.h=e+this.vMargin*2+this.style.fontSize}var i=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!i){this.paintSelfOnlyByColor(t)}return};UITips.prototype.shapeCanBeChild=function(t){return t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage};function UITipsCreator(){var t=["ui-tips","ui-tips",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITips;return e.initUITips(this.type,null)};return}ShapeFactoryGet().addShapeCreator(new UITipsCreator);function UIImageView(){return}UIImageView.prototype=new UIElement;UIImageView.prototype.isUIImageView=true;UIImageView.cachedImages={};UIImageView.IMAGE_STATE_PENDING=0;UIImageView.IMAGE_STATE_ERROR=1;UIImageView.IMAGE_STATE_DONE=2;imageViewInitCustomProp=function(t){};imageThumbViewInitCustomProp=function(t){};imageAnimationInitCustomProp=function(t){};imageSlideViewInitCustomProp=function(t){};UIImageView.prototype.imageViewToJson=function(t){t.userImages=this.getImages();return t};UIImageView.prototype.imageViewFromJson=function(t){this.cacheInvalid=true;if(t.userImages){this.userImages=[];var e=t.userImages.split("\n");var i=e.length;for(var n=0;n<i;n++){var r="image_"+(n+1);var a=this.getImageSrcByType(r);if(a&&a.length>4){this.userImages.push(a)}}}return};UIImageView.prototype.initUIImageView=function(t,e){this.setDefSize(t,e);this.userImages=[];this.onSized=UIImageView.prototype.onSized;this.afterRelayout=UIImageView.prototype.afterRelayout;this.setImages=UIImageView.prototype.setImages;this.getImages=UIImageView.prototype.getImages;this.setValue=UIImageView.prototype.setValue;this.getValue=UIImageView.prototype.getValue;this.ensureImages=UIImageView.prototype.ensureImages;this.addUserImage=UIImageView.prototype.addUserImage;this.imageViewToJson=UIImageView.prototype.imageViewToJson;this.imageViewFromJson=UIImageView.prototype.imageViewFromJson;this.onScaleForDensityDone=UIImageView.prototype.onScaleForDensityDone;imageViewInitCustomProp(this);this.regSerializer(this.imageViewToJson,this.imageViewFromJson);return this};UIImageView.createImage=function(t,e){var i=UIImageView.cachedImages[t];if(!i){i=new Image;i.src=t;i.onLoadDoneListeners=[];function n(t,e){if(!t||!t.onLoadDoneListeners){return}for(var i=0;i<t.onLoadDoneListeners.length;i++){var n=t.onLoadDoneListeners[i];n(t,e)}t.onLoadDoneListeners.clear();return}i.onload=function(t){n(this,true);this.loaded=true};i.onabort=function(t){n(this,false);this.failed=true;console.log("load "+this.src+" failed.")};i.onerror=function(t){n(this,false);this.failed=true;console.log("load "+this.src+" failed.")}}else{console.log("Create Image From Cache: "+t)}if(e){if(i.loaded){e(i,true)}else if(i.failed){e(i,false)}else{i.onLoadDoneListeners.push(e)}}return i};UIImageView.drawImageAtCenter=function(t,e,i,n,r,a,o,s){if(s){t.fillStyle=s;t.fillRect(i,n,r,a)}else{t.clearRect(i,n,r,a)}if(e&&e.width>0){var h=r;var l=a;var u=e.width;var c=e.height;var p=e.width;var f=e.height;if(o){var m=h/p;var d=l/f;if(m<d){u=Math.min(p,h/d)}else{c=Math.min(f,l/m)}}t.drawImage(e,0,0,u,c,i,n,h,l)}return};UIImageView.prototype.ensureImages=function(){if(!this.cacheInvalid){return}var t=this;function e(e,i){t.postRedraw();return}this.cachedImages=[];for(var i=0;i<this.userImages.length;i++){var n=this.userImages[i];var r=UIImageView.createImage(n,e);this.cachedImages.push(r)}delete this.cacheInvalid;return};UIImageView.prototype.afterRelayout=function(){this.cacheInvalid=true;return};UIImageView.prototype.onSized=function(){this.cacheInvalid=true;return};UIImageView.prototype.onScaleForDensityDone=function(){this.cacheInvalid=true;return};UIImageView.prototype.addUserImage=function(t){this.cacheInvalid=true;this.userImages.push(t);var e="image_"+this.userImages.length;this.setImage(e,t);return};UIImageView.prototype.getCurrentImage=function(){return this.curentImage};UIImageView.prototype.getValue=function(){var t=this.getCurrentImage();return t?t.src:null};UIImageView.prototype.setValue=function(t){return this};UIImageView.prototype.setImages=function(t){var e=this.images.display;var i=t.split("\n");this.userImages=[];this.images={};this.images.display=e;for(var n=0;n<i.length;n++){var r=i[n];if(r){this.addUserImage(r)}}return};UIImageView.prototype.getImages=function(){var t="";var e=location.protocol+"//"+location.host+"/";for(var i=0;i<this.userImages.length;i++){var n=this.userImages[i];n=n.replace(e,"");t=t+n+"\n"}return t};function UIScrollView(){return this}UIScrollView.prototype=new UIElement;UIScrollView.prototype.isUIScrollView=true;UIScrollView.prototype.afterChildAppended=function(t){t.setCanRectSelectable(false,true);return true};UIScrollView.prototype.initUIScrollView=function(t,e,i){this.initUIElement(t);this.offset=0;this.scrollBarOpacity=0;this.setMargin(e,e);this.setSizeLimit(100,100,2e3,2e3);this.setDefSize(300+2*e,300+2*e);this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator(2);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,i);this.setScrollable("always");if(!i){this.style.setFillColor("#f0f0f0")}this.setCanRectSelectable(false,true);return this};UIScrollView.prototype.setScrollable=function(t){this.scrollable=t;return};UIScrollView.prototype.fixChildSize=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.w=this.getWidth(true)}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.h=this.getHeight(true)}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false);t.setUserResizable(false)}return};UIScrollView.prototype.shapeCanBeChild=function(t){if(t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage||t.isUIList||t.isUIGrid||t.isUIProgressBar||t.isUICheckBox||t.isUIRadioBox||t.isUIWaitBar||t.isUIButtonGroup||t.isUITips||t.isUIGroup){return true}return false};UIScrollView.prototype.onModeChanged=function(){this.offset=0;return};UIScrollView.prototype.scrollTo=function(t){this.offset=Math.round(t);return};UIScrollView.prototype.scrollDelta=function(t){var e=this.offset+t;this.scrollTo(e);return};UIScrollView.prototype.scrollToPageDelta=function(t){var e=Math.floor(this.offset/this.w)+t;this.scrollToPage(e);return};UIScrollView.prototype.scrollToPage=function(t){if(t<0){t=0}var e=this.w*t;var i=this.offset-e;this.animScrollTo(i,300);return};UIScrollView.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;if(this.isUIVScrollView){return t&UIElement.EVENT_VSCROLL_HANDLED}else{return t&UIElement.EVENT_HSCROLL_HANDLED}};UIScrollView.prototype.setEventHandled=function(){var t=this.isUIVScrollView?UIElement.EVENT_VSCROLL_HANDLED:UIElement.EVENT_HSCROLL_HANDLED;this.setLastEventStatus(t);return this};UIScrollView.prototype.onPointerDownRunning=function(t,e){if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.velocityTracker.clear();return};UIScrollView.prototype.onDrag=function(t){return};UIScrollView.prototype.isScrollable=function(){if(this.scrollable==="always"){return true}else if(this.scrollable==="never"){return false}else{var t=this.getScrollRange();var e=this.getPageSize();return t>e}};UIScrollView.prototype.onPointerMoveRunning=function(t,e){if(e||!this.isScrollable()){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.scrollBarOpacity=0;var i=this.getScrollDelta(t);if(this.pointerDown&&this.needScroll(t)){this.scrollBarOpacity=1;this.scrollDelta(-i)}this.addMovementForVelocityTracker();this.onDrag(this.offset);return};UIScrollView.prototype.animScrollTo=function(t,e){var i=this;var n=new Date;var r=n.getTime();var a=this.offset;var o=a-t;var s=this.getScrollRange();var h=this.getPageSize();e=e<400?400:e;if(o<0){e=600;t=a}if(this.mode!=Shape.MODE_EDITING){if(o>s-h){t=a-(s-h)}}if(s<=h){o=0;t=a}function l(){var n=new Date;var o=n.getTime();var s=(o-r)/e;var h=i.interpolator.get(s);var u=a-t*Math.min(h,1);if(s<1&&!i.pointerDown){setTimeout(l,5);i.scrollTo(u);i.scrollBarOpacity=1-h}else{var u=a-t;i.scrollBarOpacity=0;i.scrollTo(u)}i.postRedraw();return}setTimeout(l,5);return};UIScrollView.prototype.whenScrollOutOfRange=function(t){return};UIScrollView.prototype.onPointerUpRunning=function(t,e){if(e||!this.isScrollable()){return}if(this.isEventHandledByChild()){return}this.setEventHandled();var i=this.getScrolledSize();if(!this.needScroll(t)){this.scrollBarOpacity=0;return}var n=0;var r=0;var a=this.getVelocity();var o=this.getPageSize();var s=a/o;var h=.5*o*s*s;r=Math.abs(h);n=2*r/a;r=i<0?-r:r;n=Math.abs(n);if(n>3){n=3}var l=this.offset;var u=l-r;var c=this.offset;var p=c+this.h;var f=this.getScrollRange();if(c<0){this.whenScrollOutOfRange(c)}else if(p>f){this.whenScrollOutOfRange(p-f)}this.animScrollTo(r,n*1e3);return true};UIScrollView.prototype.paintSelfOnly=function(t){return};function UIHScrollView(){return}UIHScrollView.prototype=new UIScrollView;UIHScrollView.prototype.isUIHScrollView=true;UIHScrollView.prototype.initUIHScrollView=function(t,e,i){this.initUIScrollView(t,e,i);this.setSizeLimit(100,40,2e3,2e3);return this};UIHScrollView.prototype.needScroll=function(t){var e=Math.abs(this.getMoveAbsDeltaX());var i=Math.abs(this.getMoveAbsDeltaY());return e>20&&e>i||e>20&&this.mode!=Shape.MODE_EDITING};UIHScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaX())};UIHScrollView.prototype.getScrollDelta=function(t){return Math.floor(this.getMoveDeltaX())};UIHScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIHScrollView.prototype.getPageSize=function(){return this.w};UIHScrollView.prototype.onPointerUpRunning=function(t,e){if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();var i=0;var n=this.getVelocity();var r=this.getScrolledSize();var a=Math.abs(r);if(a>this.w/4||n>this.w){if(r<0){i=1}else{i=-1}}this.scrollToPageDelta(i);return true};UIHScrollView.prototype.translatePoint=function(t){var e={x:t.x-this.x+this.offset,y:t.y-this.y};return e};UIHScrollView.prototype.getScrollRange=function(){var t=0;var e=this.calcChildrenRange();t=e.r-e.l;if(t<this.w){t=this.w}t=Math.ceil(t/this.w)*this.w;return t};UIHScrollView.prototype.fixChildPosition=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.x=this.offset+this.hMargin;t.widthAttr=UIElement.WIDTH_SCALE}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.y=this.vMargin}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false)}return};UIHScrollView.prototype.paintChildren=function(t){var e=null;var i=this.offset;var n=this.offset+this.w;t.save();t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();t.clip();t.beginPath();t.translate(-this.offset,0);for(var r=0;r<this.children.length;r++){e=this.children[r];if(!e.visible){continue}if(e.x+e.w<i||e.y>n){continue}this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}this.paintTargetShape(t);t.restore();return};function UIHScrollViewCreator(t,e){var i=["ui-h-scroll-view","ui-h-scroll-view",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIHScrollView;return n.initUIHScrollView(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIHScrollViewCreator(0,null));function UIVScrollView(){return}UIVScrollView.prototype=new UIScrollView;UIVScrollView.prototype.isUIVScrollView=true;UIVScrollView.prototype.initUIVScrollView=function(t,e,i,n){this.initUIScrollView(t,e,i);this.setSizeLimit(40,100,2e3,2e3);this.setImage("scrollBarImg",n);this.rectSelectable=false;return this};UIVScrollView.prototype.needScroll=function(t){var e=Math.abs(this.getMoveAbsDeltaX());var i=Math.abs(this.getMoveAbsDeltaY());return i>50&&i>e||i>50&&this.mode!=Shape.MODE_EDITING};UIVScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaY())};UIVScrollView.prototype.getScrollDelta=function(t){return Math.floor(this.getMoveDeltaY())};UIVScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().y};UIVScrollView.prototype.getPageSize=function(){return this.h};UIVScrollView.prototype.translatePoint=function(t){var e={x:t.x-this.x,y:t.y-this.y+this.offset};return e};UIVScrollView.prototype.getScrollRange=function(){var t=0;var e=this.calcChildrenRange();t=e.b;if(t<this.h){t=this.h}var i=this.mode===Shape.MODE_EDITING?this.h:10;t=Math.ceil(t/i)*i;return t};UIVScrollView.prototype.fixChildPosition=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.x=this.hMargin}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.y=this.offset+this.vMargin;t.heightAttr=UIElement.HEIGHT_SCALE}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false)}return};UIVScrollView.prototype.paintChildren=function(t){var e=null;var i=this.offset;var n=this.offset+this.h;t.save();t.beginPath();t.rect(this.getHMargin(),this.getVMargin(),this.getWidth(true),this.getHeight(true));t.closePath();t.clip();t.beginPath();t.translate(0,-this.offset);for(var r=0;r<this.children.length;r++){e=this.children[r];if(!e.visible){continue}if(e.y+e.h<i||e.y>n){continue}this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}this.paintTargetShape(t);t.restore();return};UIVScrollView.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);return};UIVScrollView.prototype.drawScrollBar=function(t){var e=this.getHtmlImageByType("scrollBarImg");if(!this.scrollBarOpacity||!e){return}var i=this.getScrollRange();var n=this.w-e.width-2;var r=e.width;var a=this.h*this.h/i;var o=this.offset/i*this.h;if(o+a>this.h){a=this.h-o;o=this.h-a}if(o<0){a=a+o;o=0}t.save();t.globalAlpha=this.scrollBarOpacity;drawNinePatchEx(t,e,0,0,e.width,e.height,n,o,r,a);t.restore();return};function UIVScrollViewCreator(t,e,i){var n=["ui-v-scroll-view","ui-v-scroll-view",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIVScrollView;return r.initUIVScrollView(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIVScrollViewCreator(0,null,null));function UIVScrollViewGeneral(){return}UIVScrollViewGeneral.prototype=new UIVScrollView;UIVScrollViewGeneral.prototype.isUIList=true;UIVScrollViewGeneral.prototype.isUILayout=true;UIVScrollViewGeneral.prototype.isUIVScrollViewGeneral=true;UIVScrollViewGeneral.prototype.sortChildren=UIList.prototype.sortChildren;UIVScrollViewGeneral.prototype.initUIVScrollViewGeneral=function(t){this.initUIVScrollView(t,0,null,null);this.setTextType(Shape.TEXT_NONE);return this};UIVScrollViewGeneral.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getVMargin();var i=this.children.length;var n=e;for(var r=0;r<i;r++){var a=this.children[r];if(!a.visible){continue}a.yAttr=UIElement.Y_FIX_TOP;a.heightAttr=UIElement.HEIGHT_FIX;a.relayout();a.y=n;n+=a.h}return};UIVScrollViewGeneral.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.mode===Shape.MODE_EDITING){this.drawPageDownUp(t)}return};function UIVScrollViewGeneralCreator(){var t=["ui-g-scroll-view","ui-g-scroll-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVScrollViewGeneral;return e.initUIVScrollViewGeneral(this.type)};return}function UIShortcut(){return}UIShortcut.prototype=new UIElement;UIShortcut.prototype.isUIShortcut=true;UIShortcut.prototype.initUIShortcut=function(t){this.initUIElement(t);this.setText("#ABCDEFGHIJKLMNOPQRSTUVYWXYZ");this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onChanged"]);return this};UIShortcut.prototype.shapeCanBeChild=function(t){return false};UIShortcut.prototype.drawText=function(t){var e=this.text;var i=e.length;if(!i){return}t.textBaseline="middle";t.textAlign="center";t.font=this.style.getFont();var n=this.w>>1;var r=this.vMargin;var a=this.getWidth(true);var o=this.getHeight(true)/i;var s=o>>1;t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;for(var h=0;h<e.length;h++){var l=e[h];if(this.currentItem===h){t.rect(0,r,this.w,o);if(this.pointerDown){t.fillStyle=this.style.fillColor;t.fill()}t.stroke()}t.fillStyle=this.style.textColor;t.fillText(l,n,r+s);r+=o}return};UIShortcut.prototype.findItemByPoint=function(t){var e=this.text;var i=this.vMargin;var n=this.getHeight(true);var r=Math.floor(e.length*(t.y-i)/n);return r};UIShortcut.prototype.changeItemByPoint=function(t){var e=this.text;var i=this.findItemByPoint(t);if(i>=0&&i<e.length){var n=e[i];if(this.currentItem!=i){this.callOnChangedHandler(n);this.currentItem=i}}return};UIShortcut.prototype.setValue=function(t){var e=this.text.indexOf(t);if(e>=0){if(this.currentItem!=e){this.currentItem=e;this.callOnChangedHandler(t)}}return};UIShortcut.prototype.getValue=function(){if(this.text&&this.currentItem>=0&&this.currentItem<this.text.length){return this.text[this.currentItem]}else{return""}};UIShortcut.prototype.onPointerDownRunning=function(t,e){if(e||!this.text){return}this.changeItemByPoint(t);return};UIShortcut.prototype.onPointerMoveRunning=function(t,e){if(e||!this.text){return}if(this.pointerDown){this.changeItemByPoint(t)}return};function UIShortcutCreator(){var t=["ui-shortcut","ui-shortcut",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIShortcut;return e.initUIShortcut(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIShortcutCreator);function UIScrollText(){return}UIScrollText.prototype=new UIElement;UIScrollText.prototype.isUIScrollText=true;UIScrollText.prototype.initUIScrollText=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onScrollDone"]);return this};UIScrollText.prototype.onModeChanged=function(){this.offsetX=0;this.offsetY=0;return};UIScrollText.prototype.shapeCanBeChild=function(t){return false};UIScrollText.prototype.getAnimationDuration=function(){return this.animationDuration?this.animationDuration:1e3};UIScrollText.prototype.setAnimationDuration=function(t){this.animationDuration=t;return};UIScrollText.prototype.getPauseDuration=function(){return this.pauseDuration?this.pauseDuration:0};UIScrollText.prototype.setPauseDuration=function(t){this.pauseDuration=t;return};UIScrollText.prototype.startVScroll=function(){var t=this;var e=this.getTextHeight();var i=this.getLineHeight(true);if(e<=this.h){return}this.offsetX=0;this.offsetY=0;var n=0;var r=0;var a=this.getAnimationDuration();var o=this.getPauseDuration();this.h=Math.floor(this.h/i)*i;var s=-this.h;var h=true;var l=new DecelerateInterpolator;function u(){if(h){h=false;n=(new Date).getTime()}if(!t.isVisible()){return}var i=new Date;var c=(i.getTime()-n)/a;var p=o>0?l.get(c):c;delete i;if(c<1){t.offsetY=r+s*p;setTimeout(u,10)}else{t.offsetY=r+s;if(Math.abs(t.offsetY)<e-t.h){h=true;r=t.offsetY;setTimeout(u,o)}else{delete l;t.callOnScrollDoneHandler()}delete n}delete i;t.postRedraw()}setTimeout(u,o);return};UIScrollText.prototype.startHScroll=function(){var t=this;var e=this.textWidth;if(e<=this.w){return}this.offsetX=0;this.offsetY=0;var i=0;var n=0;var r=this.getAnimationDuration();var a=this.getPauseDuration();var o=-this.w;var s=true;var h=new DecelerateInterpolator;function l(){if(s){s=false;i=(new Date).getTime()}if(!t.isVisible()){return}var u=new Date;var c=(u.getTime()-i)/r;var p=a>0?h.get(c):c;if(c<1){t.offsetX=n+o*p;setTimeout(l,10)}else{t.offsetX=n+o;if(Math.abs(t.offsetX)<e-t.w){s=true;n=t.offsetX;setTimeout(l,a)}else{delete i;t.callOnScrollDoneHandler()}}delete u;t.postRedraw()}setTimeout(l,a);return};UIScrollText.prototype.startScroll=function(){if(!this.isVisible()){return}if(this.type==="ui-vscroll-text"){this.startVScroll()}else{this.startHScroll()}return};UIScrollText.prototype.onInit=function(){this.offsetX=0;this.offsetY=0;var t=this;setTimeout(function(){t.startScroll()},1e3);return};UIScrollText.prototype.drawText=function(t){var e=this.offsetX?this.offsetX:0;var i=this.offsetY?this.offsetY:0;t.save();t.rect(0,0,this.w,this.h);t.clip();t.translate(e,i);t.beginPath();t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.strokeStyle=this.style.lineColor;t.lineWidth=1;if(this.type==="ui-vscroll-text"){this.drawMLText(t,false,true)}else{this.textWidth=this.draw1LText(t,true)}t.restore();return};function UIScrollTextCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIScrollText;return n.initUIScrollText(this.type,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIScrollTextCreator("ui-vscroll-text",200,200));ShapeFactoryGet().addShapeCreator(new UIScrollTextCreator("ui-hscroll-text",200,50));function UIList(){return}UIList.prototype=new UIElement;UIList.prototype.isUIList=true;UIList.prototype.isUILayout=true;UIList.prototype.initUIList=function(t,e,i,n){this.initUIElement(t);this.setMargin(e,e);this.setSizeLimit(100,100,1e3,1e3);this.setDefSize(400,i*3+2*e);this.itemHeight=i;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,n);this.rectSelectable=false;this.itemHeightVariable=false;this.addEventNames(["onInit"]);if(!n){this.style.setFillColor("White")}return this};UIList.prototype.getItemHeight=function(){return this.itemHeight};UIList.prototype.setItemHeight=function(t){this.itemHeight=t;return};UIList.prototype.shapeCanBeChild=function(t){if(!t.isUIListItem){return false}return true};UIList.prototype.childIsBuiltin=function(t){return t.name==="ui-list-item-update-status"||t.name==="ui-list-item-update-tips"||t.name==="ui-last"||t.name.indexOf("prebuild")>=0||t.name.indexOf("builtin")>=0};UIList.FIRST_ITEM=-1;UIList.LAST_ITEM=1;UIList.MIDDLE_ITEM=0;UIList.SINGLE_ITEM=2;UIList.prototype.fixListItemImage=function(t,e){var i=t.images;for(var n in i){var r=i[n];if(n!="display"){var a=r.getImageSrc();if(!a){continue}switch(e){case UIList.FIRST_ITEM:{a=a.replace(/\.single\./,".first.");a=a.replace(/\.middle\./,".first.");a=a.replace(/\.last\./,".first.");break}case UIList.MIDDLE_ITEM:{a=a.replace(/\.single\./,".middle.");a=a.replace(/\.first\./,".middle.");a=a.replace(/\.last\./,".middle.");break}case UIList.LAST_ITEM:{a=a.replace(/\.single\./,".last.");a=a.replace(/\.first\./,".last.");a=a.replace(/\.middle\./,".last.");break}case UIList.SINGLE_ITEM:{a=a.replace(/\.first\./,".single.");a=a.replace(/\.middle\./,".single.");a=a.replace(/\.last\./,".single.");break}}r.setImageSrc(a)}}return};UIList.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var a=this.getWidth(true);var o=this.getItemHeight();var s=o;var h=this.itemHeightVariable;var l=0;var u=this.children.length;var c=this.children;for(var p=0;p<u;p++){var f=c[p];var m={};var d=false;if(f.removed||!f.visible)continue;if(h||f.isHeightVariable()){s=f.measureHeight(o)}else{s=o}if(u===1){this.fixListItemImage(f,UIList.SINGLE_ITEM)}else if(l===0){this.fixListItemImage(f,UIList.FIRST_ITEM)}else if(l===u-1){this.fixListItemImage(f,UIList.LAST_ITEM)}else{this.fixListItemImage(f,UIList.MIDDLE_ITEM)}if(this.h<=r+i+s){this.h=r+i+s}d=r<this.h&&(t||this.mode===Shape.MODE_EDITING);if(d){f.setSize(a,s);m.xStart=f.x;m.yStart=f.y;m.wStart=f.w;m.hStart=f.h;m.xEnd=n;m.yEnd=r;m.wEnd=a;m.hEnd=s;m.delay=10;m.duration=500;m.element=f;m.onDone=function(t){this.relayoutChildren()};f.animate(m)}else{f.move(n,r);f.setSize(a,s);f.relayoutChildren()}f.setUserMovable(true);f.widthAttr=UIElement.WIDTH_FILL_PARENT;if(f.heightAttr===UIElement.HEIGHT_FILL_PARENT){f.heightAttr=UIElement.HEIGHT_FIX}f.setUserResizable(h||f.isHeightVariable());if(!this.isUIScrollView){f.setDraggable(this.itemDraggable)}r+=s;l++}return};UIList.prototype.beforePaintChildren=function(t){t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();return};UIList.prototype.afterPaintChildren=function(t){return};UIList.prototype.afterChildAppended=function(t){if(t.view&&this.mode===Shape.MODE_EDITING&&t.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();t.setUserMovable(true);t.setUserResizable(false);t.setCanRectSelectable(false,true);t.autoAdjustHeight=this.itemHeightVariable;t.setDraggable(this.itemDraggable);return true};UIList.prototype.sortChildren=function(){this.children.sort(function(t,e){var i=e.y;var n=e.pointerDown&&e.hitTestResult===Shape.HIT_TEST_MM?t.y+t.h*.8:t.y;return n-i});return};UIList.prototype.onKeyUpRunning=function(t){var e=0;if(!this.children.length){return}switch(t){case KeyEvent.DOM_VK_UP:{e=this.children.indexOf(this.targetShape)-1;break}case KeyEvent.DOM_VK_DOWN:{e=this.children.indexOf(this.targetShape)+1;break}default:{return}}var i=this.children.length;e=(e+this.children.length)%i;var n=this.children[e];this.setTarget(n);this.postRedraw();if(this.isUIListView){if(this.offset>n.y){this.offset=n.y}if(this.offset+this.h<n.y+n.h){this.offset=n.y-(this.h-n.h)}}return};UIList.prototype.onKeyDownRunning=function(t){};UIList.prototype.getValue=function(){var t=null;var e=this.children.length;if(e<1)return t;for(var i=0;i<e;i++){var n=this.children[i];if(!n.isUIListCheckableItem||!n.value)continue;if(n.isRadio){return i}else{if(!t)t=[];t.push(i)}}return t};UIList.prototype.setValue=function(t){var e=null;if(typeof t==="array"){e=t}else if(typeof t==="number"){e=[t]}else{e=[]}var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(r.isUIListCheckableItem){r.setValue(false)}}for(var n=0;n<e.length;n++){var a=e[n];if(a>=0&&a<i){var r=this.children[a];if(r.isUIListCheckableItem){r.setChecked(true)}}}return this};function UIListCreator(t,e,i){var n=["ui-list","ui-list",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIList;return r.initUIList(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIListCreator(5,114,null));function UIListView(){return}UIListView.prototype=new UIVScrollView;UIListView.prototype.isUIList=true;UIListView.prototype.isUILayout=true;UIListView.prototype.isUIListView=true;UIListView.prototype.setItemHeight=UIList.prototype.setItemHeight;UIListView.prototype.sortChildren=UIList.prototype.sortChildren;UIListView.prototype.initUIList=UIList.prototype.initUIList;UIListView.prototype.shapeCanBeChild=UIList.prototype.shapeCanBeChild;UIListView.prototype.paintSelfOnly=UIList.prototype.paintSelfOnly;UIListView.prototype.fixListItemImage=function(t,e){};UIListView.prototype.afterChildAppended=UIList.prototype.afterChildAppended;UIListView.prototype.childIsBuiltin=UIList.prototype.childIsBuiltin;UIListView.prototype.onKeyUpRunning=UIList.prototype.onKeyUpRunning;UIListView.prototype.onKeyDownRunning=UIList.prototype.onKeyDownRunning;UIListView.prototype.getValue=UIList.prototype.getValue;UIListView.prototype.setValue=UIList.prototype.setValue;UIListView.UPDATE_STATUS_NONE=0;UIListView.UPDATE_STATUS_TIPS=1;UIListView.UPDATE_STATUS_SYNC=2;UIListView.prototype.beginUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_SYNC;var t=this.findChildByName("ui-list-item-update-status");if(t){var e=t.findChildByName("ui-wait-box");if(e){e.show()}var i=t.findChildByName("ui-label-loading");if(i){i.setText(dappGetText("Loading..."))}}return};UIListView.prototype.endUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_NONE;var t=this.findChildByName("ui-list-item-update-status");if(t){this.setLastUpdateTime(new Date)}this.relayoutChildren(true);return};UIListView.prototype.initUIListView=function(t,e,i,n){this.initUIList(t,e,i,n);this.initUIVScrollView(t,0,n,null);this.updateStatus=UIListView.UPDATE_STATUS_NONE;this.addEventNames(["onUpdateData","onScrollOutOfRange"]);this.setTextType(Shape.TEXT_INPUT);return this};UIListView.prototype.onModeChanged=function(){this.offset=0;this.updateStatus=UIListView.UPDATE_STATUS_NONE;return};UIListView.prototype.updateDone=function(){var t=this;t.endUpdate();setTimeout(function(){if(t.parentShape){t.relayoutChildren();t.postRedraw()}},1e3);return};UIListView.prototype.callOnUpdateData=function(){this.callOnUpdateDataHandler();this.beginUpdate();var t=this;setTimeout(function(){if(t.parentShape){t.updateDone()}},1e4);return true};UIListView.prototype.setLastUpdateTime=function(t){var e=this.findChildByName("ui-list-item-update-tips");if(e&&t){var i="";var n=new Date;if(n.getFullYear()===t.getFullYear()&&n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()){i=dappGetText("Today")}else{i=t.getMonth()+"-"+t.getDate()}i=i+" "+t.getHours()+":"+t.getMinutes();var r=e.findChildByName("ui-label-update-time");if(r){r.setText(i)}var r=e.findChildByName("ui-label-update-time");if(r){r.setText(i)}var a=e.findChildByName("ui-label-update-time-tips");if(a){a.setText(dappGetText("Last Update:"))}}return};UIListView.prototype.onDrag=function(t){var e=this.findChildByName("ui-list-item-update-tips");if(e){var i=e.findChildByName("ui-image");var n=e.findChildByName("ui-label-tips");if(i){if(t<-115){if(i.rotation===0){function r(){var t=i.rotation+.2*Math.PI;if(t>Math.PI){t=Math.PI}i.setRotation(t);if(t<Math.PI){setTimeout(r,50)}i.postRedraw();return}r();if(n){n.setText(dappGetText("Release To Update."))}}}else{i.setRotation(0);if(n){n.setText(dappGetText("Pull To Update."))}}}}return};UIListView.prototype.whenScrollOutOfRange=function(t){if(t<-115){this.callOnUpdateData();this.relayoutChildren()}this.callOnScrollOutOfRangeHandler(t);return};UIListView.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var a=this.getWidth(true);var o=this.itemHeight;var s=this.itemHeightVariable;var h=this.getScrollRange();var l=this.getPageSize();var u=true;var c=0;var p=this.children.length;var f=this.children;for(var m=0;m<p;m++){var d=f[m];var g={};var y=false;if(d.removed||!d.visible)continue;if(s||d.isHeightVariable()){o=d.measureHeight(this.itemHeight)}else{o=this.itemHeight}if(d.name==="ui-list-item-update-tips"){if(this.mode!==Shape.MODE_EDITING){d.move(n,-o);d.x=n;d.y=-o;d.w=a;d.h=o;d.setUserMovable(false);d.setUserResizable(false);d.setVisible(this.updateStatus!==UIListView.UPDATE_STATUS_TIPS);continue}else{d.setVisible(true)}y=true}else if(d.name==="ui-list-item-update-status"){if(this.mode!==Shape.MODE_EDITING){if(this.updateStatus!==UIListView.UPDATE_STATUS_SYNC){d.setVisible(false)}else{d.setVisible(true)}}else{d.setVisible(true)}y=true}if(!d.visible){continue}animatable=d.isVisible()&&!y&&r<this.h&&(t||this.mode===Shape.MODE_EDITING);if(animatable&&(n!=d.x||r!=d.y||a!=d.w||o!=d.h)){d.setSize(a,o);g.xStart=d.x;g.yStart=d.y;g.wStart=d.w;g.hStart=d.h;g.xEnd=n;g.yEnd=r;g.wEnd=a;g.hEnd=o;g.delay=10;g.duration=1e3;g.element=d;
g.onDone=function(t){this.relayoutChildren()};d.animate(g)}else{d.move(n,r);d.setSize(a,o);d.relayoutChildren()}d.widthAttr=UIElement.WIDTH_FILL_PARENT;if(d.heightAttr===UIElement.HEIGHT_FILL_PARENT){d.heightAttr=UIElement.HEIGHT_FIX}d.setUserMovable(u);d.setUserResizable(s||d.isHeightVariable());r+=o;c++}return};UIListView.prototype.drawText=UIList.prototype.drawText;UIListView.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.mode===Shape.MODE_EDITING){this.drawPageDownUp(t)}return};function UIListViewCreator(t,e,i){var n=["ui-list-view","ui-list-view",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIListView;return r.initUIListView(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIListViewCreator(5,114,null));function UIListItem(){return}UIListItem.prototype=new UIElement;UIListItem.prototype.isUIListItem=true;UIListItem.prototype.initUIListItem=function(t){this.initUIElement(t);this.roundRadius=5;this.setDefSize(200,120);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setImage(UIElement.IMAGE_FOCUSED,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.setImage(UIElement.IMAGE_POINTER_OVER,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.addEventNames(["onLongPress","onRemoved"]);return this};UIListItem.prototype.dragMove=function(t,e){this.y=this.y+e;this.onDragging();return};UIListItem.prototype.getDeleteItemIcon=function(){var t=this.getHtmlImageByType(UIElement.IMAGE_DELETE_ITEM);return t};UIListItem.prototype.shapeCanBeChild=function(t){if(t.isUIMenu||t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPageManager||t.isUIPage||t.isUIListItem){return false}return true};UIListItem.prototype.onUserResized=function(){var t=this.parentShape;if(t){t.relayoutChildren()}return};UIListItem.prototype.setSlideToRemove=function(t){this.slideToRemove=t;return this};UIListItem.prototype.setHeightVariable=function(t){this.heightVariable=t;return this};UIListItem.prototype.isHeightVariable=function(){return this.heightVariable};UIListItem.prototype.measureHeight=function(t){return this.h};UIListItem.prototype.ANIM_DRAW_LINE=1;UIListItem.prototype.onPointerUpRunning=function(t,e){if(e||!this.slideToRemove){return}var i=this.getMoveAbsDeltaX();var n=this.getMoveAbsDeltaY();if(Math.abs(i)<this.w/2||Math.abs(n)>this.h){return}var r=this;var a=300;var o=(new Date).getTime();r.animateState=this.ANIM_DRAW_LINE;for(var s=0;s<this.children.length;s++){var h=this.children[s];h.style.setTextColor("#C0C0C0")}function l(){var t=new Date;var e=(t.getTime()-o)/a;if(e<1){r.animatePercent=e;setTimeout(l,10)}else{r.animatePercent=1;setTimeout(function(){delete o;delete r.animatePercent;delete r.animateState;var t=r.parentShape;t.removeChild(r);t.relayoutChildren("default");t.postRedraw()},300)}delete t;r.postRedraw()}l();return};UIListItem.prototype.getFillColor=function(t){var e;if(this.pointerDown){var i=Math.abs(this.getMoveAbsDeltaY());if(i<5){var n=Date.now()-this.pointerDownTime;if(n<50&&this.getParent().isUIListView){e=this.style.fillColor;this.postRedraw()}else{e=this.style.textColor}}else{e=this.style.fillColor}}else if(this.isPointerOverShape()){e=this.style.overFillColor?this.style.overFillColor:this.style.fillColor}else if(this.isFocused()){e=this.style.focusedFillColor?this.style.focusedFillColor:this.style.fillColor}else{e=this.style.fillColor}return e};UIListItem.prototype.paintSelfOnly=function(t){if(this.getBgHtmlImage()){return}var e=this.parentShape;var i=this.getFillColor();var n=this.style.lineColor;var r=this.style.lineWidth;t.beginPath();if(!e||e.isUIListView||e.isUIMenu){if(!Shape.isTransparentColor(i)){t.fillStyle=i;t.fillRect(0,0,this.w,this.h)}if(!Shape.isTransparentColor(n)){t.moveTo(0,this.h);t.lineTo(this.w,this.h);t.lineWidth=r;t.strokeStyle=n;t.stroke()}return}var a=this.roundRadius;var o=this===e.children[0];var s=this===e.children[e.children.length-1];if(o&&s){drawRoundRect(t,this.w,this.h,a)}else if(o){drawRoundRect(t,this.w,this.h,a,RoundRect.TL|RoundRect.TR)}else if(s){drawRoundRect(t,this.w,this.h,a,RoundRect.BL|RoundRect.BR)}else{t.rect(0,0,this.w,this.h)}if(!Shape.isTransparentColor(i)){t.fillStyle=i;t.fill()}if(!Shape.isTransparentColor(n)){t.lineWidth=r;t.strokeStyle=n;t.stroke()}return};UIListItem.prototype.afterPaintChildren=function(t){if(!this.animateState){return}var e=this.getDeleteItemIcon();if(this.animateState===this.ANIM_DRAW_LINE&&e&&e.width>0){var i=20;var n=this.animatePercent;var r=(this.w-i)*n-e.width;if(r>i){t.lineWidth=1;t.strokeStyle="#D0D0D0";t.moveTo(i,this.h/2);t.lineTo(r,this.h/2);t.stroke();if(n>.9){var a=(this.h-e.height)/2;var o=this.w-e.width-i;t.drawImage(e,o,a)}}}return};UIListItem.prototype.afterChildAppended=function(t){if(t.isUIButton||t.isUICheckBox){this.setImage(UIElement.IMAGE_ACTIVE,this.getImageByType(UIElement.IMAGE_NORMAL).getImageSrc());this.setImage(UIElement.IMAGE_FOCUSED,this.getImageByType(UIElement.IMAGE_NORMAL).getImageSrc())}return true};function UIListItemCreator(){var t=["ui-list-item","ui-list-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListItem;e.initUIListItem(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIListItemCreator(null,null,null,null));function UIListCheckableItem(){return}UIListCheckableItem.prototype=new UIListItem;UIListCheckableItem.prototype.isUIListCheckableItem=true;UIListCheckableItem.prototype.initUIListCheckableItem=function(t){this.initUIListItem(t);this.isUIListRadioBoxItem=t==="ui-list-radiobox-item";this.isUIListCheckBoxItem=t==="ui-list-checkbox-item";this.setImage(UIElement.IMAGE_CHECKED_FG,null);this.setImage(UIElement.IMAGE_UNCHECK_FG,null);this.addEventNames(["onChanged"]);return this};UIListCheckableItem.prototype.getValue=function(){return this.value};UIListCheckableItem.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value)}return};UIListCheckableItem.prototype.setChecked=function(){var t=this.parentShape;if(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIListCheckableItem){i.setValue(false)}}}this.setValue(true);return};UIListCheckableItem.prototype.setParent=function(t){this.parentShape=t;if(this.value){this.setChecked()}return};UIListCheckableItem.prototype.onClick=function(t,e){if(e){return}if(this.isUIListRadioBoxItem){this.setChecked()}else{this.setValue(!this.value)}return};UIListCheckableItem.prototype.drawFgImage=function(t){var e=this.getHtmlImageByType(this.value?UIElement.IMAGE_CHECKED_FG:UIElement.IMAGE_UNCHECK_FG);if(e){var i=this.w-e.width-20;var n=(this.h-e.height)/2;t.drawImage(e,0,0,e.width,e.height,i,n,e.width,e.height)}return};function UIListCheckBoxItemCreator(){var t=["ui-list-checkbox-item","ui-list-checkbox-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListCheckableItem;e.initUIListCheckableItem(this.type);return e};return}function UIListRadioBoxItemCreator(){var t=["ui-list-radiobox-item","ui-list-radiobox-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListCheckableItem;e.initUIListCheckableItem(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIListCheckBoxItemCreator);ShapeFactoryGet().addShapeCreator(new UIListRadioBoxItemCreator);function UISelect(){return}UISelect.prototype=new UIElement;UISelect.prototype.isUISelect=true;UISelect.prototype.initUISelect=function(t,e,i){this.initUIElement(t);this.offset=0;this.options=[];this.visibleItems=5;this.setDefSize(e,i);this.addEventNames(["onInit","onChanged"]);this.setTextType(Shape.TEXT_TEXTAREA);this.setCanRectSelectable(false,true);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UISelect.prototype.getItemHeight=function(){return Math.round(this.h/this.visibleItems)};UISelect.prototype.getVisibleItems=function(){return this.visibleItems};UISelect.prototype.setVisibleItems=function(t){if(t<=3){this.visibleItems=3}else{this.visibleItems=5}};UISelect.prototype.scrollTo=function(t){var e=this.getItemHeight();t=Math.round(t/e)*e;var i=this;var n=500;var r=this.offset;var a=t-r;var o=(new Date).getTime();var s=new DecelerateInterpolator;this.animating=true;function h(){var t=new Date;var e=(t.getTime()-o)/n;var l=s.get(e);if(e<1){i.setOffset(Math.floor(r+l*a));setTimeout(h,10)}else{i.setOffset(r+a,true);delete o;delete s;delete i.animating}delete t}setTimeout(function(){h()},10);return};UISelect.prototype.setOffset=function(t,e){this.offset=t;this.postRedraw();if(e){var i=this.getValue();this.callOnChangedHandler(i)}return};UISelect.prototype.onPointerDownRunning=function(t,e){if(e||this.animating){return}if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();this.saveOffset=this.offset;return true};UISelect.prototype.onPointerMoveRunning=function(t,e){if(e||this.animating){return}this.addMovementForVelocityTracker();var i=this.getMoveAbsDeltaY();this.setOffset(this.saveOffset+i);return};UISelect.prototype.getMaxOffset=function(){var t=Math.floor(.5*this.visibleItems);return t*this.getItemHeight()};UISelect.prototype.getMinOffset=function(){var t=this.getItemHeight();var e=Math.round(.5*this.visibleItems);if(this.options.length<=e){return 0}else{return-(this.options.length-e)*t}};UISelect.prototype.handleClicked=function(t){var e=this.getItemHeight();var i=Math.floor((this.h/2-this.offset)/e);var n=Math.floor((t.y-this.offset)/e);var r=(n-i)*e;var a=this.offset-r;var o=this.getMinOffset();var s=this.getMaxOffset();if(a<o){a=o}if(a>s){a=s}this.scrollTo(a);return};UISelect.prototype.onPointerUpRunning=function(t,e){if(e||this.animating){return}var i=this.getMoveAbsDeltaY();var n=this.velocityTracker.getVelocity().y;var r=i+n/2;if(Math.abs(r)<10){this.setOffset(this.saveOffset);this.handleClicked(t);return}var a=this.getMinOffset();var o=this.getMaxOffset();var s=this.saveOffset+i+n;if(s<a){s=a}if(s>o){s=o}this.scrollTo(s);return};UISelect.prototype.shapeCanBeChild=function(t){return false};UISelect.prototype.setText=function(t){t=this.toText(t);if(t){this.options=t.split("\n");this.options.remove("")}else{this.options=[]}this.text=t;return this};UISelect.prototype.drawText=function(t){return};UISelect.prototype.drawImage=function(t){var e=0;var i=0;var n=this.w;var r=this.h;var a=n>>1;var o=0;var s=this.offset;var h=this.getItemHeight();t.beginPath();t.rect(0,0,n,r);t.clip();var l=this.options.length;var u=this.getBgImage()!=null;this.drawBgImage(t);if(!u){t.lineWidth=3;t.strokeStyle=this.style.lineColor;t.beginPath();e=(this.visibleItems>>1)*h;t.moveTo(5,e);t.lineTo(n-10,e);t.moveTo(5,e+h);t.lineTo(n-10,e+h);t.stroke()}this.style.setTextB(false);this.style.setFontSize(Math.floor(h*.5));var c=this.style.getFont();var p=this.style.textColor;this.style.setTextB(true);this.style.setFontSize(Math.floor(h*.6));var f=this.style.getFont();var m=this.style.textColorHighlight;t.textAlign="center";t.textBaseline="middle";t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.translate(0,s);var d=Math.floor((.5*r-s)/h);for(var g=0;g<l;g++){var y=this.options[g];e=g*h;i=e+h;o=-s;if(i<o&&e<o){continue}o=-(s-r);if(i>o&&e>o){continue}if(d==g){t.font=f;t.fillStyle=m}else{t.font=c;t.fillStyle=p}e=e+(h>>1);t.fillText(y,a,e,n)}return};UISelect.prototype.getValue=function(){var t=this.h;var e=this.offset;var i=this.getItemHeight();var n=Math.floor((.5*t-e)/i);var r=n<this.options.length?this.options[n]:"";return r};UISelect.prototype.setValueByIndex=function(t,e){var i=t;var n=this.getItemHeight();if(i>=0){var r=-(i-(this.getVisibleItems()>>1))*n;if(e){this.scrollTo(r)}else{this.setOffset(r,true)}}return this};UISelect.prototype.setValue=function(t,e){var i=this.options.indexOf(t.toString());this.setValueByIndex(i,e);return this};function UISelectCreator(t,e){var i=["ui-select","ui-select",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UISelect;return n.initUISelect(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UISelectCreator("ui-select",300,50));function UIMenu(){return}UIMenu.FREE_LAYOUT=0;UIMenu.ARC_LAYOUT=1;UIMenu.VLINEAR_LAYOUT=2;UIMenu.HLINEAR_LAYOUT=3;UIMenu.prototype=new UITips;UIMenu.prototype.isUIMenu=true;UIMenu.prototype.initUIMenu=function(t){this.initUITips(t,null);this.spacer=2;this.menuItemNr=2;this.roundRadius=5;this.animDuration=600;this.setTextType(Shape.TEXT_NONE);this.layoutType=UIMenu.FREE_LAYOUT;this.originPoint=UIElement.ORIGIN_RIGHT;this.setCanRectSelectable(false,false);this.enableHideAnimation=true;this.enableShowAnimation=true;return this};UIMenu.prototype.relayoutChildrenHLL=function(){var t=this.children.length;var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var a=this.spacer;var o=this.getWidth(true);var s=this.getHeight(true);var h=this.originPoint;var l=Math.max(t,this.menuItemNr);var u=Math.round((o-a*(l-1))/l);for(var c=0;c<t;c++){var p=this.children[c];p.h=s;p.w=u;p.x=n;p.y=r;n+=u+a;p.relayoutChildren()}return this};UIMenu.prototype.relayoutChildrenVLL=function(){var t=this.children.length;var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var a=this.spacer;var o=this.getWidth(true);var s=this.getHeight(true);var h=this.originPoint;var l=Math.max(t,this.menuItemNr);var u=Math.round((s-a*(l-1))/l);for(var c=0;c<t;c++){var p=this.children[c];p.w=o;p.h=u;p.x=n;p.y=r;r+=u+a;p.relayoutChildren()}return this};UIMenu.prototype.getChildPositionOfArc=function(t,e,i,n){var r={};var a=t.angleRange>Math.PI*1.9?n:n-1;var o=t.angleStart+t.angleRange*i/a;r.x=t.x+e*Math.cos(o);r.y=t.y+e*Math.sin(o);return r};UIMenu.prototype.relayoutChildrenARC=function(){var t=this.children.length;var e=this.getOrigin();var i=e.r;var n=this.w;var r=this.h;for(var a=0;a<t;a++){var o=this.children[a];var s=this.getChildPositionOfArc(e,i,a,t);o.x=s.x-(o.w>>1);o.y=s.y-(o.h>>1);o.relayoutChildren()}return};UIMenu.prototype.relayoutChildren=function(){var t=this.children.length;if(this.disableRelayout||!t){return}switch(this.layoutType){case UIMenu.HLINEAR_LAYOUT:{this.relayoutChildrenHLL();break}case UIMenu.VLINEAR_LAYOUT:{this.relayoutChildrenVLL();break}case UIMenu.ARC_LAYOUT:{this.relayoutChildrenARC();break}default:{for(var e=0;e<t;e++){this.children[e].relayout()}break}}return};UIMenu.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){this.paintSelfOnlyByColor(t)}return};UIMenu.prototype.prepareShowChildAnimation=function(t,e){var i={};i.duration=this.animDuration;i.interpolator="d";i.xStart=e.x-(t.w>>1);i.xEnd=t.x;i.yStart=e.y-(t.h>>1);i.yEnd=t.y;i.scaleXStart=0;i.scaleXEnd=1;i.scaleYStart=0;i.scaleYEnd=1;i.opacityStart=0;i.opacityEnd=1;i.rotationStart=0;i.rotationEnd=2*Math.PI;return i};UIMenu.prototype.prepareHideChildAnimation=function(t,e){var i={};i.duration=this.animDuration;i.interpolator="d";i.xStart=t.x;i.xEnd=e.x-(t.w>>1);i.yStart=t.y;i.yEnd=e.y-(t.h>>1);i.opacityStart=1;i.opacityEnd=0;i.scaleXStart=1;i.scaleXEnd=0;i.scaleYStart=1;i.scaleYEnd=0;i.rotationStart=Math.PI*2;i.rotationEnd=0;return i};UIMenu.prototype.animateShowChildren=function(){var t=this;var e=this.children.length;var i=this.getOrigin();this.busy=0;this.visible=true;for(var n=0;n<e;n++){var r=null;var a=this.children[n];if(a.animations){r=a.animations["show"]}if(!r){r=this.prepareShowChildAnimation(a,i)}else{console.log("Use child show animation.")}this.busy++;a.animate(r,function(){t.busy--})}return this};UIMenu.prototype.animateHideChild=function(t,e){var i=this;var n=t.x;var r=t.y;var a=t.w;var o=t.h;this.busy++;t.animate(e,function(){t.x=n;t.y=r;t.w=a;t.h=o;t.opacity=1;t.visible=false;i.busy--;if(!i.busy){i.visible=false}});return};UIMenu.prototype.animateHideChildren=function(){var t=this;var e=this.children.length;var i=this.getOrigin();this.busy=0;this.visible=true;for(var n=0;n<e;n++){var r=null;var a=this.children[n];if(a.animations){r=a.animations["hide"]}if(!r){r=this.prepareHideChildAnimation(a,i)}else{console.log("Use child hide animation.")}this.animateHideChild(a,r)}return this};UIMenu.prototype.prepareShowAnimation=function(){var t={};t.duration=this.animDuration;t.interpolator="d";t.scaleXStart=.5;t.scaleXEnd=1;t.scaleYStart=.5;t.scaleYEnd=1;t.opacityStart=0;t.opacityEnd=1;return t};UIMenu.prototype.prepareHideAnimation=function(){var t={};t.duration=this.animDuration;t.interpolator="a";t.scaleXStart=1;t.scaleXEnd=.5;t.scaleYStart=1;t.scaleYEnd=.5;t.opacityStart=1;t.opacityEnd=0;return t};UIMenu.prototype.animateShowSelf=function(){var t=this;t.busy=true;var e=null;if(this.animations){e=this.animations["show"]}if(!e){e=this.prepareShowAnimation()}this.animate(e,function(){t.visible=true;t.busy=false})};UIMenu.prototype.animateHideSelf=function(){var t=this;t.busy=true;this.visible=true;var e=null;if(this.animations){e=this.animations["hide"]}if(!e){e=this.prepareHideAnimation()}this.animate(e,function(){t.visible=false;t.busy=false});return this};UIMenu.prototype.show=function(){if(this.autoHideWhenClicked){this.getWindow().grab(this)}if(!this.enableShowAnimation){this.visible=true;return}if(this.childrenAnimation){this.animateShowChildren()}else{this.animateShowSelf()}};UIMenu.prototype.hide=function(){if(this.autoHideWhenClicked){this.getWindow().ungrab(this)}if(!this.enableHideAnimation){this.visible=false;return}if(this.childrenAnimation){return this.animateHideChildren()}else{return this.animateHideSelf()}};UIMenu.prototype.onPointerUpRunning=function(t,e){if(e){return}if(this.autoHideWhenClicked){this.hide()}return};UIMenu.prototype.setVisible=function(t){if(this.visible===t||this.busy){return this}return t?this.show():this.hide()};UIMenu.prototype.getOrigin=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.hMargin;var n=this.vMargin;var r={x:i,y:n};switch(this.originPoint){case UIElement.ORIGIN_UP:{r.x=this.w>>1;r.angleRange=Math.PI;r.angleStart=0;r.r=t>>1;break}case UIElement.ORIGIN_DOWN:{r.x=this.w>>1;r.y=this.h-n;r.angleRange=Math.PI;r.angleStart=Math.PI;r.r=t>>1;break}case UIElement.ORIGIN_LEFT:{r.x=i;r.y=this.h>>1;r.angleRange=Math.PI;r.angleStart=-Math.PI*.5;r.r=e>>1;break}case UIElement.ORIGIN_RIGHT:{r.x=this.w-i;r.y=this.h>>1;r.angleRange=Math.PI;r.angleStart=Math.PI*.5;r.r=e>>1;break}case UIElement.ORIGIN_UP_LEFT:{r.angleRange=Math.PI*.5;r.angleStart=0;r.r=Math.min(t,e);break}case UIElement.ORIGIN_UP_RIGHT:{r.x=this.w-i;r.angleStart=.5*Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_DOWN_LEFT:{r.x=i;r.y=this.h-n;r.angleStart=-.5*Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_DOWN_RIGHT:{r.x=this.w-i;r.y=this.h-n;r.angleStart=Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_MIDDLE_CENTER:{r.x=this.w>>1;r.y=this.h>>1;r.angleStart=-.5*Math.PI;r.angleRange=Math.PI*2;r.r=Math.min(t,e)>>1;break}default:break}return r};UIMenu.prototype.applyTransform=function(t){if(this.mode===Shape.MODE_EDITING)return;var e=this.getOrigin();if(t.globalAlpha!=this.opacity){t.globalAlpha=this.opacity}if(this.offsetX){t.translate(this.offsetX,0)}if(this.offsetY){t.translate(0,this.offsetY)}var i=this.getScaleX();var n=this.getScaleY();if(this.rotation||i&&i!==1||n&&n!==1){var r=e.x;var a=e.y;t.translate(r,a);if(i&&n){t.scale(i,n)}if(this.rotation){t.rotate(this.rotation)}t.translate(-r,-a)}return};UIMenu.prototype.shapeCanBeChild=function(t){return t.isUIListItem||t.isUIButton||t.isUIImage};function UIMenuCreator(){var t=["ui-menu","ui-menu",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMenu;return e.initUIMenu(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIMenuCreator);function UIImage(){return}UIImage.prototype=new UIElement;UIImage.prototype.isUIImage=true;UIImage.prototype.initUIImage=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.setCanRectSelectable(false,true);this.addEventNames(["onDoubleClick","onUpdateTransform"]);return this};UIImage.prototype.setValue=function(t){return this.setImageSrc(t)};UIImage.prototype.getValue=function(){return this.getImageSrc()};UIImage.prototype.setImageSrc=function(t){this.setImage(UIElement.IMAGE_DEFAULT,t);return this};UIImage.prototype.getImageSrc=function(t){return this.getImageSrcByType(t?t:UIElement.IMAGE_DEFAULT)};UIImage.prototype.getHtmlImage=function(t){return this.getHtmlImageByType(t?t:UIElement.IMAGE_DEFAULT)};UIImage.prototype.getImageSrcRect=function(){var t=this.getImageByType(UIElement.IMAGE_DEFAULT);if(this.srcRect){return this.srcRect}else if(t){return t.getImageRect()}else{return null}};UIImage.prototype.setImageSrcRect=function(t,e,i,n){this.srcRect={};this.srcRect.x=t;this.srcRect.y=e;this.srcRect.w=i;this.srcRect.h=n;return};UIImage.prototype.drawBgImage=function(t){var e=this.getBgHtmlImage();if(e){var i=this.getImageSrcRect();this.drawImageAt(t,e,this.images.display,0,0,this.w,this.h,i)}return};UIImage.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;function UIImageCreator(t){var e=[t,"ui-image",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIImage;return e.initUIImage(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIImageCreator("ui-image"));ShapeFactoryGet().addShapeCreator(new UIImageCreator("ui-icon"));UIImage.prototype.setBorderStyle=function(t,e){return};UIImage.prototype.setClickedStyle=function(t,e){return};function UILabel(){return}UILabel.prototype=new UIElement;UILabel.prototype.isUILabel=true;UILabel.prototype.initUILabel=function(t,e,i){this.initUIElement(t);this.setText(e);this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,i);this.addEventNames(["onChanged","onUpdateTransform"]);return this};UILabel.prototype.shapeCanBeChild=function(t){return t.isUILabel||t.isUIImage};UILabel.prototype.setText=function(t){this.text=this.toText(t);this.textNeedRelayout=true;this.callOnChangedHandler(t);return this};UILabel.prototype.drawText=function(t){this.layoutText(t);this.defaultDrawText(t);return};function UILabelCreator(){var t=["ui-label","ui-label",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UILabel;return e.initUILabel(this.type,dappGetText("Text"),null)};return}ShapeFactoryGet().addShapeCreator(new UILabelCreator);function UIScreen(){return}UIScreen.prototype=new UIElement;UIScreen.prototype.isUIScreen=true;UIScreen.prototype.initUIScreen=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);return this};UIScreen.prototype.getWindowManager=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUIWindowManager){return e}}return};UIScreen.prototype.shapeCanBeChild=function(t){if(!t.isUIStatusBar&&!t.isUIWindowManager){return false}for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.type===t.type){return false}}return true};UIScreen.prototype.beforeRelayoutChild=function(t){this.relayoutChildren();return false};UIScreen.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=0;var e=0;var i=0;var n=this.w;var r=null;var a=null;var o=null;for(var s=0;s<this.children.length;s++){var h=this.children[s];h.x=0;h.w=n;h.setUserMovable(false);h.setUserResizable(false);h.widthAttr=UIElement.WIDTH_FILL_PARENT;if(h.type==="ui-status-bar"){a=h;if(h.h>this.h/4){h.h=this.h/4}h.move(0,0);h.relayout();continue}if(h.type==="ui-menu-bar"){var l=this.getDeviceConfig();var u=l&&l.hasMenuBar&&this.h>this.w;if(u){r=h;if(h.h>this.h/4){h.h=this.h/4}h.move(0,this.h-h.h);h.relayout()}else{h.y=0;h.x=0}h.setVisible(u);h.setEnable(u);continue}if(h.isUIWindowManager){o=h;continue}}i=this.h;if(o){if(a){e=a.h;i=i-a.h}if(r){i=i-r.h}o.h=i;o.relayout()}return};UIScreen.prototype.paintSelf=function(t){t.save();t.beginPath();t.rect(this.x,this.y,this.w,this.h);t.clip();UIElement.prototype.paintSelf.call(this,t);t.restore()};function UIScreenCreator(t,e){var i=["ui-screen","ui-screen",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIScreen;return n.initUIScreen(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIScreenCreator(640,960));function UIPage(){return}UIPage.prototype=new UIElement;UIPage.prototype.isUIPage=true;UIPage.prototype.initUIPage=function(t,e){this.initUIElement(t);this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,e);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;if(!e){this.style.setFillColor("Gold")}return this};UIPage.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIPage.prototype.hide=function(){this.setVisible(false);this.hideHTML();cantkHideAllInput();return};UIPage.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPage){return false}if(t.isUIPageIndicator&&!this.isUIPageExt){return false}return true};UIPage.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};function UIPageCreator(t){var e=["ui-page","ui-page",null,1];ShapeCreator.apply(this,e);this.createShape=function(e){var i=new UIPage;return i.initUIPage(this.type,t)};return}ShapeFactoryGet().addShapeCreator(new UIPageCreator(null));function UICircleLayout(){return}UICircleLayout.prototype=new UIElement;UICircleLayout.prototype.isUILayout=true;UICircleLayout.prototype.isUICircleLayout=true;UICircleLayout.O_CENTER="c";UICircleLayout.O_TOP_LEFT="tl";UICircleLayout.O_TOP_MIDDLE="tm";UICircleLayout.O_TOP_RIGHT="tr";UICircleLayout.O_LEFT_MIDDLE="lm";UICircleLayout.O_RIGHT_MIDDLE="rm";UICircleLayout.O_BOTTOM_LEFT="bl";UICircleLayout.O_BOTTOM_MIDDLE="bm";UICircleLayout.O_BOTTOM_RIGHT="br";UICircleLayout.prototype.initUICircleLayout=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);this.origin=UICircleLayout.O_CENTER;this.setSizeLimit(120,120,1e3,1e3,1);return this};UICircleLayout.prototype.shapeCanBeChild=function(t){if(t.isUIImage||t.isUIButton){return true}return false};UICircleLayout.prototype.paintSelfOnly=function(t){if(this.mode===Shape.MODE_EDITING){t.lineWidth=this.style.lineWidth;switch(this.origin){case UICircleLayout.O_CENTER:{var e=this.w>>1;var i=this.h>>1;var n=(this.w>>1)-30;var r=this.children.length?this.children.length:6;var a=r>1?2*Math.PI/(r-1):0;t.beginPath();t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;t.arc(e,i,n,0,Math.PI*2);t.stroke();var o=-.5*Math.PI;for(var s=0;s<r;s++){t.beginPath();if(s==0){t.arc(e,i,10,0,Math.PI*2);t.stroke()}else{var h=a*(s-1)+o;var l=e+n*Math.cos(h);var u=i+n*Math.sin(h);t.arc(l,u,10,0,Math.PI*2);t.stroke()}}t.stroke();break}default:break}}return};UICircleLayout.prototype.moveShapeToCenter=function(t,e,i){e=e-(t.w>>1);i=i-(t.h>>1);t.move(e,i);return};UICircleLayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}switch(this.origin){case UICircleLayout.O_CENTER:{var t=this.w>>1;var e=this.h>>1;var i=(this.w>>1)-30;var n=this.children.length-1;var r=n>0?2*Math.PI/n:0;var a=-.5*Math.PI;for(var o=0;o<this.children.length;o++){var s=this.children[o];if(o==0){this.moveShapeToCenter(s,t,e)}else{var h=r*(o-1)+a;var l=t+i*Math.cos(h);var u=e+i*Math.sin(h);this.moveShapeToCenter(s,l,u)}}break}default:break}return};UICircleLayout.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_FIX_TOP;t.xAttr=UIElement.X_FIX_LEFT;t.widthAttr=UIElement.WIDTH_SCALE;t.heightAttr=UIElement.HEIGHT_SCALE;t.setUserMovable(true);t.setUserResizable(true);t.setCanRectSelectable(false,true);return true};function UICircleLayoutCreator(t,e,i){var n=["ui-circle-layout","ui-circle-layout",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UICircleLayout;return r.initUICircleLayout(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UICircleLayoutCreator(400,400));function UIGrid(){return}UIGrid.prototype=new UIElement;UIGrid.prototype.isUIGrid=true;UIGrid.prototype.isUILayout=true;UIGrid.prototype.gridToJson=function(t){t.spacer=this.spacer;t.itemWidth=this.itemWidth;t.itemHeight=this.itemHeight;t.scrollDirection=this.scrollDirection;return};UIGrid.prototype.gridFromJson=function(t){if(t.itemWidth){this.itemWidth=t.itemWidth}if(t.itemHeight){this.itemHeight=t.itemHeight}if(t.spacer){this.spacer=t.spacer}if(t.scrollDirection){this.scrollDirection=t.scrollDirection}return};UIGrid.prototype.initUIGrid=function(t){this.initUIElement(t);this.spacer=0;this.offset=0;this.setMargin(5,5);this.setDefSize(200,200);this.checkable=false;this.itemSize=150;this.itemWidth=150;this.itemHeight=150;this.rectSelectable=false;this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.setImage(UIElement.IMAGE_CHECKED_ITEM,null);this.regSerializer(this.gridToJson,this.gridFromJson);this.addEventNames(["onChildDragged","onChildDragging","onInit"]);return this};UIGrid.prototype.setCheckable=function(t){this.checkable=t;return this};UIGrid.prototype.setChildChecked=function(t,e){if(t<this.children.length){this.children[t].checked=e}return this};UIGrid.prototype.isChildChecked=function(t){if(t<this.children.length){return this.children[t].checked}return false};UIGrid.prototype.setRows=function(t){this.itemHeight=t;this.calcItemSize();return};UIGrid.prototype.getRows=function(){return this.calcItemSize().rows};UIGrid.prototype.setCols=function(t){this.itemWidth=t;this.calcItemSize();return};UIGrid.prototype.getCols=function(){return this.calcItemSize().cols};UIGrid.prototype.getChildByRowCol=function(t,e){var i=this.getCols();var n=t*i+e;if(n<this.children.length){return this.children[n]}else{return null}};UIGrid.prototype.getChildRow=function(t){var e=this.getCols();var i=this.children.indexOf(t);if(i<0)return;return Math.floor(i/e)};UIGrid.prototype.getChildCol=function(t){var e=this.getCols();var i=this.children.indexOf(t);if(i<0)return;return i%e};UIGrid.prototype.exchangeTwoChildren=function(t,e,i){var n=this.children.length;if(t<0||t>=n||e<0||e>=n){return}var r=this.children[t];this.children[t]=this.children[e];this.children[e]=r;this.relayoutChildren(i);return this};UIGrid.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIGrid.prototype.childIsBuiltin=function(t){return t.name==="ui-last"};UIGrid.prototype.calcItemSize=function(){var t=0;var e=0;var i=0;var n=0;var r=this.getWidth(true);var a=this.getHeight(true);if(this.itemWidth<20){t=r/this.itemWidth-this.spacer;i=Math.floor(r/t)}else{i=Math.floor(r/this.itemWidth);t=Math.floor(r/i)}if(this.itemHeight<1){e=t*this.itemHeight}else if(this.itemHeight<20){e=Math.floor(a/this.itemHeight-this.spacer)}else{n=Math.floor(a/this.itemHeight);e=Math.floor(a/n)}n=Math.floor(a/e);return{w:Math.floor(t),h:Math.floor(e),cols:i,rows:n}};UIGrid.prototype.sortChildren=function(){
var t=this.calcItemSize();var e=t.h;var i=t.w;this.children.sort(function(t,i){var n=0;var r=0;var a=Math.floor((t.y+5)/e);var o=Math.floor((i.y+5)/e);if(a===o){r=i.x;n=i.pointerDown&&i.hitTestResult===Shape.HIT_TEST_MM?t.x+t.w:t.x}else{n=a;r=o}return n-r});return};UIGrid.prototype.getChildIndexByPoint=function(t){var e=this.getHMargin();var i=this.calcItemSize();var n=this.spacer;var r=this.getWidth(true);var a=this.getHeight(true);var o=i.w+n;var s=i.h+n;var h=Math.floor(r/o);var l=Math.floor(a/s);var u=Math.floor((t.y-e)/i.h);var c=Math.floor((t.x-e)/i.w);var p=u*h+c;return p};UIGrid.prototype.onChildDragging=function(t,e){var i=this.getChildIndexByPoint(e);var n=this.getIndexOfChild(t);this.callOnChildDraggingHandler(n,i);return};UIGrid.prototype.onChildDragged=function(t,e){var i=this.getChildIndexByPoint(e);var n=this.getIndexOfChild(t);this.callOnChildDraggedHandler(n,i);this.relayoutChildren("default");return};UIGrid.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=0;var i=0;var n=0;var r=0;var a=this.getWidth(true);var o=this.getHeight(true);var s=this.spacer;var h=this.calcItemSize();var l=h.w+s;var u=h.h+s;var c=Math.floor(a/l);var p=Math.floor(o/u);var f=this.h-p*u>>1;var m=this.w-c*l>>1;this.cols=c;this.rows=p;var d=0;var g=this.children.length;var y=this.children;for(var v=0;v<g;v++){var _=y[v];if(_.removed||!_.visible)continue;e=Math.floor(d/c);i=Math.floor(d%c);n=m+i*l;r=f+e*u;if(t||this.mode===Shape.MODE_EDITING){_.animMove(n,r,t)}else{_.move(n,r)}_.xAttr=UIElement.X_FIX_LEFT;_.yAttr=UIElement.Y_FIX_TOP;_.widthAttr=UIElement.WIDTH_FIX;_.heightAttr=UIElement.HEIGHT_FIX;_.setSize(h.w,h.h);_.setUserMovable(true);_.setUserResizable(false);_.relayoutChildren();if(!this.isUIScrollView){_.setDraggable(this.itemDraggable)}d++}return};UIGrid.prototype.afterChildAppended=function(t){if(t.view&&this.mode===Shape.MODE_EDITING&&t.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();t.setUserMovable(true);t.setUserResizable(false);t.setCanRectSelectable(false,true);t.setDraggable(this.itemDraggable);t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FIX;return true};UIGrid.prototype.triggerDeleteMode=function(){if(this.mode===Shape.MODE_EDITING){return}this.deleteMode=!this.deleteMode;var t=this;function e(){t.postRedraw();if(t.deleteMode){setTimeout(e,20)}}e();return};UIGrid.prototype.isInDeleteMode=function(){return this.deleteMode&&this.mode!=Shape.MODE_EDITING};UIGrid.prototype.beforePaintChild=function(t,e){if(this.isInDeleteMode()){e.save();var i=t.x+t.w/2;var n=t.y+t.h/2;var r=(new Date).getTime()/1e3;var a=.03*Math.cos(20*r);e.translate(i,n);e.rotate(a);e.translate(-i,-n)}return};UIGrid.prototype.afterPaintChild=function(t,e){if(this.isInDeleteMode()){var i=this.getImageByType(UIElement.IMAGE_DELETE_ITEM);if(WImage.isValid(i)){var n=i.getImage();var r=i.getImageRect();var a=t.y+t.vMargin;var o=t.x+t.w-r.w-t.hMargin;e.drawImage(n,o,a);WImage.draw(e,n,WImage.DISPLAY_CENTER,o,a,r.w,r.h,r)}e.restore();return}if(this.checkable){if(t.checked){var i=this.getImageByType(UIElement.IMAGE_CHECKED_ITEM);if(WImage.isValid(i)){var n=i.getImage();var r=i.getImageRect();WImage.draw(e,n,WImage.DISPLAY_AUTO,t.x,t.y,t.w,t.h,r)}}}return};function UIGridCreator(t){var e=["ui-grid","ui-grid",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIGrid;return e.initUIGrid(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridCreator);function UIGridView(){return}UIGridView.prototype=new UIVScrollView;UIGridView.prototype.isUIGrid=true;UIGridView.prototype.isUILayout=true;UIGridView.prototype.isUIGridView=true;UIGridView.prototype.gridToJson=UIGrid.prototype.gridToJson;UIGridView.prototype.gridFromJson=UIGrid.prototype.gridFromJson;UIGridView.prototype.sortChildren=UIGrid.prototype.sortChildren;UIGridView.prototype.initUIGrid=UIGrid.prototype.initUIGrid;UIGridView.prototype.shapeCanBeChild=UIGrid.prototype.shapeCanBeChild;UIGridView.prototype.childIsBuiltin=UIGrid.prototype.childIsBuiltin;UIGridView.prototype.paintSelfOnly=UIGrid.prototype.paintSelfOnly;UIGridView.prototype.calcItemSize=UIGrid.prototype.calcItemSize;UIGridView.prototype.relayoutChildren=UIGrid.prototype.relayoutChildren;UIGridView.prototype.afterChildAppended=UIGrid.prototype.afterChildAppended;UIGridView.prototype.isInDeleteMode=UIGrid.prototype.isInDeleteMode;UIGridView.prototype.beforePaintChild=UIGrid.prototype.beforePaintChild;UIGridView.prototype.afterPaintChild=UIGrid.prototype.afterPaintChild;UIGridView.prototype.triggerDeleteMode=UIGrid.prototype.triggerDeleteMode;UIGridView.prototype.setCheckable=UIGrid.prototype.setCheckable;UIGridView.prototype.setChildChecked=UIGrid.prototype.setChildChecked;UIGridView.prototype.isChildChecked=UIGrid.prototype.isChildChecked;UIGridView.prototype.initUIGridView=function(t){this.initUIGrid(t);this.initUIVScrollView(t,0,null,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.setImage(UIElement.IMAGE_CHECKED_ITEM,null);return this};UIGridView.prototype.onModeChanged=function(){this.offset=0;return};function UIGridViewCreator(){var t=["ui-grid-view","ui-grid-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGridView;return e.initUIGridView(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridViewCreator);function UIImageValue(){return}UIImageValue.prototype=new UIImage;UIImageValue.prototype.isUIImageValue=true;UIImageValue.prototype.initUIImageValue=function(t,e,i){this.initUIImage(t,e,i,null);this.value=0;return this};UIImageValue.prototype.getImageSrcByValue=function(t){var e="option_image_"+t;return this.getImageSrcByType(e)};UIImageValue.prototype.getValue=function(){return this.value};UIImageValue.prototype.setValue=function(t){var e=this.getImageSrcByValue(t);if(e){this.value=t;this.setImage(UIElement.IMAGE_DEFAULT,e)}return this.value};UIImageValue.prototype.inc=function(){var t=this.value+1;return this.setValue(t)};UIImageValue.prototype.dec=function(){var t=this.value-1;return this.setValue(t)};UIImageValue.prototype.getImages=function(){var t="";for(var e in this.images){var i=this.images[e];if(e.indexOf("option_image_")>=0&&i&&i.src){t+=i.src+"\n"}}return t};UIImageValue.prototype.setImages=function(t){var e=this.images.display;this.images={};this.images.display=e;if(t){var i=0;var n=0;var r=t.split("\n");for(var i=0;i<r.length;i++){var a=r[i];if(!a)continue;if(a.indexOf("/")===0){a=a.substr(1)}var o="option_image_"+n++;this.setImage(o,a)}this.setValue(this.value)}return this};UIImageValue.prototype.shapeCanBeChild=function(t){return false};function UIImageValueCreator(t,e,i){var n=["ui-image-value","ui-image-value",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIImageValue;return r.initUIImageValue(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIImageValueCreator(200,200,null));function UIImageThumbView(){return}UIImageThumbView.prototype=new UIImageView;UIImageThumbView.prototype.isUIImageThumbView=true;UIImageThumbView.prototype.initUIImageThumbView=function(t,e){this.userImages=[];this.imageProxies=[];this.itemSize=0;this.setDefSize(t,e);this.initUIImageView(t,e);this.setItemSize=UIImageThumbView.prototype.setItemSize;this.getCacheCanvas=UIImageThumbView.prototype.getCacheCanvas;this.getCacheCanvasContext=UIImageThumbView.prototype.getCacheCanvasContext;this.setValue=UIImageThumbView.prototype.setValue;this.getCurrentImage=UIImageThumbView.prototype.getCurrentImage;this.getCurrentImageSrc=UIImageThumbView.prototype.getCurrentImageSrc;imageThumbViewInitCustomProp(this);this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);this.addEventNames(["onChanged"]);return this};UIImageThumbView.prototype.setItemSize=function(t){this.itemSize=t?t:100;if(t){this.setSizeLimit(100,t+10,2e3,2e3)}return};UIImageThumbView.prototype.setKeepRatio=function(t){if(this.keepRatio!=t){this.cacheInvalid=true}this.keepRatio=t;return};UIImageThumbView.prototype.getCacheCanvasContext=function(t,e){if(!this.cacheImagesCanvas){canvas=document.createElement("canvas");canvas.width=t;canvas.height=e;this.cacheImagesCanvas=canvas}if(canvas.width!=t){canvas.width=t}if(canvas.height!=e){canvas.height=e}var i=canvas.getContext("2d");i.clearRect(0,0,t,e);return i};UIImageThumbView.prototype.getCurrentImageSrc=function(){return this.currentImageProxy?this.currentImageProxy.src:null};UIImageThumbView.prototype.getCurrentImage=function(){return this.currentImageProxy?this.currentImageProxy.image:null};UIImageThumbView.prototype.setValue=function(t){for(var e=0;e<this.imageProxies.length;e++){var i=this.imageProxies[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){this.currentImageProxy=i;return this}}return this};UIImageThumbView.createImageProxy=function(t,e,i,n,r,a,o,s,h){var l={};l.x=a;l.y=o;l.w=s;l.h=h;l.src=e;l.imageState=UIImageView.IMAGE_STATE_PENDING;function u(e,i){var a=t.keepRatio;if(i){l.imageState=UIImageView.IMAGE_STATE_DONE;UIImageView.drawImageAtCenter(r,e,l.x,l.y,l.w,l.h,a)}else{l.imageState=UIImageView.IMAGE_STATE_ERROR;UIImageView.drawImageAtCenter(r,n,l.x,l.y,l.w,l.h,a)}console.log("onLoadDone: "+e.src);t.postRedraw()}l.image=UIImageView.createImage(e,u);if(l.imageState===UIImageView.IMAGE_STATE_PENDING){var c=t.keepRatio;UIImageView.drawImageAtCenter(r,i,l.x,l.y,l.w,l.h,c)}return l};UIImageThumbView.prototype.createCacheCanvas=function(){};UIImageThumbView.prototype.getCacheCanvas=function(){if(this.cacheInvalid||!this.cacheImagesCanvas){this.createCacheCanvas()}return this.cacheImagesCanvas};function UIImageThumbViewTape(){return}UIImageThumbViewTape.prototype=new UIHScrollView;UIImageThumbViewTape.prototype.isUIImageView=true;UIImageThumbViewTape.prototype.isUIImageThumbView=true;UIImageThumbViewTape.prototype.isUIImageThumbViewTape=true;UIImageThumbViewTape.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewTape.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewTape.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewTape.prototype.initUIImageThumbViewTape=function(t,e,i){this.initUIHScrollView(t,10,null);this.initUIImageThumbView(e,i);this.heightAttr=UIElement.HEIGHT_FIX;return this};UIImageThumbViewTape.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewTape.prototype.createCacheCanvas=function(){var t=this.getSpaceBetweenImages();var e=this.w;var i=this.h;var n=this.itemSize>0&&this.itemSize<i?this.itemSize:i;var r=this.cacheImagesCanvas;var a=this.userImages.length;delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;if(!a){return}e=a*(n+t);var o=0;var s=Math.floor((i-n)/2);var h=this.errorImage;var l=this.loadingImage;var u=this.getCacheCanvasContext(e,i);for(var c=0;c<this.userImages.length;c++){var p=this.userImages[c];var f=UIImageThumbView.createImageProxy(this,p,l,h,u,o,s,n,n);this.imageProxies.push(f);o=o+n+t}return};UIImageThumbViewTape.prototype.getScrollRange=function(){var t=this.h;var e=this.getSpaceBetweenImages();var i=this.userImages.length*(t+e)+e;return i};UIImageThumbViewTape.prototype.paintChildren=function(t){return};UIImageThumbViewTape.prototype.getCacheCanvasOffset=function(){var t=Math.max(0,(this.w-this.cacheImagesCanvas.width)/2);return t};UIImageThumbViewTape.prototype.onClick=function(t,e){if(!this.imageProxies||!this.imageProxies.length||e){return}this.currentImageProxy=null;var i=t.x-this.getCacheCanvasOffset();for(var n=0;n<this.imageProxies.length;n++){var r=this.imageProxies[n];if(i>=r.x&&i<r.x+r.w){this.currentImageProxy=r}}this.callOnClickHandler(t);this.callOnChangedHandler(this.getCurrentImageSrc());return};UIImageThumbViewTape.prototype.paintSelfOnly=function(t){if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){t.rect(0,0,this.w,this.h);t.stroke();return}var e=0;var i=0;var n=this.h;var r=this.w;var a=this.getCacheCanvas();var o=this.getCacheCanvasOffset();var s=o;t.rect(0,0,this.w,this.h);t.clip();t.beginPath();if(this.offset>=0){if(s>this.offset){s=s-this.offset;var e=a.width;t.drawImage(this.cacheImagesCanvas,0,0,e,n,s,i,e,n);o=s}else{var h=this.offset-s;var e=Math.min(r,a.width-h);t.drawImage(this.cacheImagesCanvas,h,0,e,n,0,i,e,n);o=-h}}else{s=s-this.offset;var e=Math.min(r+this.offset,a.width);t.drawImage(this.cacheImagesCanvas,0,0,e,n,s,i,e,n);o=s}if(this.currentImageProxy){s=o+this.currentImageProxy.x;i=this.currentImageProxy.y;t.lineWidth=3;t.rect(s,i,this.currentImageProxy.w,this.currentImageProxy.h);t.stroke()}return};function UIUIImageThumbViewTapeCreator(){var t=["ui-image-thumb-view-tape","ui-image-thumb-view-tape",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageThumbViewTape;return e.initUIImageThumbViewTape(this.type,300,100)};return}function UIImageThumbViewGrid(){return}UIImageThumbViewGrid.prototype=new UIHScrollView;UIImageThumbViewGrid.prototype.isUIImageView=true;UIImageThumbViewGrid.prototype.isUIImageThumbView=true;UIImageThumbViewGrid.prototype.isUIImageThumbViewGrid=true;UIImageThumbViewGrid.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewGrid.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewGrid.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewGrid.prototype.initUIImageThumbViewGrid=function(t,e,i){this.initUIHScrollView(t,10,null);this.initUIImageThumbView(e,i);this.setSizeLimit(100,40,2e3,2e3);this.rows=4;this.cols=3;this.pageNr=1;this.itemSize=100;return this};UIImageThumbViewGrid.prototype.calcSize=function(){if(!this.userImages){return}if(this.isIcon){this.cols=3;this.rows=4;this.pageNr=1;return}var t=this.userImages.length;var e=this.getDeviceConfig();var i=e?e.lcdDensity:"hdpi";var n=this.getDensitySizeByName(i)/160;var r=this.w/n;var a=this.h/n;var o=Math.round(r/this.itemSize);var s=Math.round(a/this.itemSize);this.cols=o;this.rows=s;this.pageNr=Math.ceil(t/(s*o));return};UIImageThumbViewGrid.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewGrid.prototype.createCacheCanvas=function(){var t=this.userImages.length;var e=this.getSpaceBetweenImages();delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;this.calcSize();if(!t){return}var i=0;var n=0;var r=0;var a=this.h;var o=this.pageNr*this.w;var s=this.getCacheCanvasContext(o,a);var h=Math.floor((this.w-e)/this.cols)-e;var l=Math.floor((this.h-e)/this.rows)-e;var u=this.errorImage;var c=this.loadingImage;for(var p=0;p<this.pageNr;p++){n=e;for(var f=0;f<this.rows;f++){i=p*this.w+e;for(var m=0;m<this.cols;m++,r++){if(r>=t){break}var d=this.userImages[r];var g=UIImageThumbView.createImageProxy(this,d,c,u,s,i,n,h,l);this.imageProxies.push(g);i=i+h+e}n=n+l+e}}return};UIImageThumbViewGrid.prototype.getScrollRange=function(){var t=this.pageNr*this.w;return t};UIImageThumbViewGrid.prototype.paintChildren=function(t){return};UIImageThumbViewGrid.prototype.getCacheCanvasOffset=function(){return this.getSpaceBetweenImages()};UIImageThumbViewGrid.prototype.onClick=function(t,e){if(!this.imageProxies||!this.imageProxies.length||e){return}var i=t.x;var n=t.y;var r=this.imageProxies.length;var a=Math.floor(i/this.w);var o=Math.floor(n*this.rows/this.h);var s=Math.floor(i%this.w*this.cols/this.w);var h=a*this.rows*this.cols+o*this.cols+s;if(h<r){this.currentImageProxy=this.imageProxies[h]}this.callOnClickHandler(t);this.callOnChangedHandler(this.getCurrentImageSrc());return this.callOnClickHandler(t)};UIImageThumbViewGrid.prototype.paintSelfOnly=function(t){var e=this.getSpaceBetweenImages();if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){t.rect(0,0,this.w,this.h);t.stroke();return}var i=0;var n=this.w;var r=this.offset;var a=this.getCacheCanvas();var o=a.height;var s=a.width;if(r>=0){var i=Math.min(n,s-r);t.drawImage(this.cacheImagesCanvas,r,0,i,o,0,0,i,o)}else{var i=Math.min(s+r,n);t.drawImage(this.cacheImagesCanvas,0,0,i,o,-r,0,i,o)}if(this.currentImageProxy){y=this.currentImageProxy.y;x=this.currentImageProxy.x-r;t.rect(x,y,this.currentImageProxy.w,this.currentImageProxy.h);t.lineWidth=3;t.strokeStyle=this.style.lineColor;t.stroke()}return};function UIUIImageThumbViewGridCreator(){var t=["ui-image-thumb-view-grid","ui-image-thumb-view-grid",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageThumbViewGrid;return e.initUIImageThumbViewGrid(this.type,300,100)};return}ShapeFactoryGet().addShapeCreator(new UIUIImageThumbViewTapeCreator);ShapeFactoryGet().addShapeCreator(new UIUIImageThumbViewGridCreator);function UILayout(){return}UILayout.prototype=new UIElement;UILayout.prototype.isUILayout=true;UILayout.prototype.initUILayout=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setCanRectSelectable(false,false);this.vLayout=this.type==="ui-v-layout";this.addEventNames(["onInit"]);return this};UILayout.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UILayout.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&this.mode===Shape.MODE_EDITING){var i=this.hMargin;var n=this.vMargin;var r=this.getWidth(true);var a=this.getHeight(true);var o=this.vLayout;t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;drawDashedRect(t,i,n,r,a);if(this.children.length===0){if(o){drawDashedLine(t,{x:i,y:.2*a+n},{x:r+i,y:.2*a+n},8,4);drawDashedLine(t,{x:i,y:.5*a+n},{x:r+i,y:.5*a+n},8,4)}else{drawDashedLine(t,{x:.2*r+i,y:n},{x:.2*r+i,y:a+n},8,4);drawDashedLine(t,{x:.5*r+i,y:n},{x:.5*r+i,y:a+n},8,4)}}else{for(var s=0;s<this.children.length;s++){var h=this.children[s];if(o){var n=h.y+h.h;drawDashedLine(t,{x:i,y:n},{x:r+i,y:n},8,4)}else{var i=h.x+h.w;drawDashedLine(t,{x:i,y:n},{x:i,y:a+n},8,4)}}}t.stroke()}return};UILayout.prototype.sortChildren=function(){var t=this.vLayout;if(t){this.children.sort(function(t,e){var i=t.y;var n=e.y;return i-n})}else{this.children.sort(function(t,e){var i=t.x;var n=e.x;return i-n})}return};UILayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=this.hMargin;var e=this.vMargin;var i=this.spacer?this.spacer:0;var n=this.vLayout;for(var r=0;r<this.children.length;r++){var a=this.children[r];if(!a.isVisible()){continue}if(n){if(a.heightAttr!==UIElement.HEIGHT_FIX&&a.heightAttr!==UIElement.HEIGHT_SCALE){a.heightAttr=UIElement.HEIGHT_SCALE;a.updateLayoutParams()}a.y=e;a.relayout();a.y=e;e=e+a.h+i}else{if(a.widthAttr!==UIElement.WIDTH_FIX&&a.widthAttr!==UIElement.WIDTH_SCALE){a.widthAttr=UIElement.WIDTH_SCALE;a.updateLayoutParams()}a.x=t;a.relayout();a.x=t;t=t+a.w+i}}return};UILayout.prototype.afterChildAppended=function(t){var e=this.vLayout;if(e){t.yAttr=UIElement.Y_FIX_TOP;if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.heightAttr=UIElement.HEIGHT_SCALE}}else{t.xAttr=UIElement.X_FIX_LEFT;if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.widthAttr=UIElement.WIDTH_SCALE}}if(this.mode===Shape.MODE_EDITING&&t.isCreatingElement()){this.sortChildren()}t.setUserMovable(true);t.setUserResizable(true);t.setCanRectSelectable(false,true);return true};function UIVLayoutCreator(t,e,i){var n=["ui-v-layout","ui-layout",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UILayout;return r.initUILayout(this.type,t,e,i)};return}function UIHLayoutCreator(t,e,i){var n=["ui-h-layout","ui-layout",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UILayout;return r.initUILayout(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIVLayoutCreator(100,100,null));ShapeFactoryGet().addShapeCreator(new UIHLayoutCreator(100,100,null));function UIFrames(){return}UIFrames.prototype=new UIElement;UIFrames.prototype.isUIFrames=true;UIFrames.prototype.initUIFrames=function(t){this.initUIElement(t);this.current=0;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.addEventNames(["onChanged"]);return this};UIFrames.preparseBackendCanvas=function(t,e){var i=t.w;var n=t.h;var r=Animation.getBackendCanvas(2*i,n);var a=r.getContext("2d");a.clearRect(0,0,2*i,n);a.save();t.paint(a);a.translate(i,0);e.paint(a);a.restore();return r};UIFrames.prototype.getStatusString=function(){var t="";var e=this.current+1;var i=this.children.length;var n=this.getCurrentFrame();e=e<=i?e:i;if(n&&n.name){t=n.name+"("+e+"/"+i+")"}else{t=e+"/"+i}return t};UIFrames.prototype.getCurrent=function(){return this.current};UIFrames.prototype.setCurrent=function(t){if(this.current!==t){this.current=t;if(this.mode!=Shape.MODE_EDITING){this.callOnChangedHandler(t)}}return this};UIFrames.prototype.getCurrentFrame=function(){if(this.children.length<1){return null}if(this.current<0||!this.current){this.current=0}if(this.current>=this.children.length){this.current=this.children.length-1}return this.children[this.current]};UIFrames.prototype.fixChildSize=function(t){return};UIFrames.prototype.fixChildPosition=function(t){var e=t.x;var i=t.y;var n=t.h;var r=t.w;if(t.freePosition){return}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){e=this.getHMargin();r=this.getWidth(true)}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){i=this.getVMargin();n=this.getHeight(true)}t.x=e;t.y=i;t.h=n;t.w=r;return};UIFrames.prototype.setTarget=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(!t){i.setSelected(false);continue}if(i!=t&&i!=t.popupWindow){i.setSelected(false)}}this.targetShape=t;this.selected=!t;return};UIFrames.prototype.dispatchPointerDownToChildren=function(t){var e=null;if(this.children.length<1){return false}e=this.getCurrentFrame();if(e.onPointerDown(t)){this.setTarget(e);return true}return false};UIFrames.prototype.addShapeIntoChildren=function(t,e){var i=null;if(this.children.length<1){return false}i=this.getCurrentFrame();return i.addShape(t,true,e)};UIFrames.prototype.paintChildren=function(t){var e=this.getCurrentFrame();if(e){t.save();t.beginPath();e.paintSelf(t);t.restore()}return};UIFrames.prototype.showNextFrame=function(){this.showFrame(this.current+1);this.relayoutChildren();return};UIFrames.prototype.getFrame=function(t){if(t<0||t>=this.children.length){return null}return this.children[t]};UIFrames.prototype.getFrameIndex=function(t){for(var e=0;e<this.children.length;e++){if(t===this.children[e]){return e}}return-1};UIFrames.prototype.getFrames=function(){return this.children.length};UIFrames.prototype.showPrevFrame=function(){this.showFrame(this.current-1);this.relayoutChildren();return};UIFrames.prototype.showFrame=function(t){this.current=(t+this.children.length)%this.children.length;var e=this.children[this.current];if(e){e.show(true)}return};UIFrames.prototype.shapeCanBeChild=function(t){return true};UIFrames.prototype.initDefaultNameForChild=function(t){};UIFrames.prototype.relayoutChildren=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.x=0;e.y=0;e.w=this.w;e.h=this.h;e.widthAttr=UIElement.WIDTH_FILL_PARENT;e.heightAttr=UIElement.HEIGHT_FILL_PARENT;e.relayoutChildren()}return};UIFrames.prototype.afterChildAppended=function(t){this.current=this.children.length-1;if(!t.name){this.initDefaultNameForChild(t)}return};UIFrames.prototype.onChildRemoved=function(t){return};UIFrames.prototype.afterChildRemoved=function(t){if(this.children.length===0){this.current=0}else if(this.current>=this.children.length){this.current--}this.onChildRemoved(t);return};UIFrames.prototype.findChildByPoint=function(t,e){var i=this.translatePoint(t);var n=this.getCurrentFrame();if(n){return n.findChildByPoint(i,e)}return this};function UIFramesCreator(){var t=["ui-frames","ui-frames",null,0];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFrames;return e.initUIFrames(this.type)};return}function UICheckBox(){return}UICheckBox.prototype=new UIElement;UICheckBox.prototype.isUICheckBox=true;UICheckBox.prototype.initUICheckBox=function(t){this.initUIElement(t);this.setDefSize(100,100);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.setImage(UIElement.IMAGE_ON_BG,null);this.setImage(UIElement.IMAGE_ON_ACTIVE,null);this.setImage(UIElement.IMAGE_OFF_BG,null);this.setImage(UIElement.IMAGE_OFF_ACTIVE,null);this.setImage(UIElement.IMAGE_CHECKED_FG,null);this.setImage(UIElement.IMAGE_UNCHECK_FG,null);this.addEventNames(["onChanged","onUpdateTransform"]);this.setRoundRadius(5);this.value=false;this.style.textColor="Black";this.style.textColorOn="Black";this.style.fillColor="White";this.style.fillColorOn="White";return this};UICheckBox.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUILabel};UICheckBox.prototype.getValue=function(){return this.value};UICheckBox.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value)}return this};UICheckBox.prototype.getBgImage=function(){var t=null;if(this.getValue()){if(this.pointerDown){t=this.getImageByType(UIElement.IMAGE_ON_ACTIVE)}if(!t||!t.src){t=this.getImageByType(UIElement.IMAGE_ON_BG)}}else{if(this.pointerDown){t=this.getImageByType(UIElement.IMAGE_OFF_ACTIVE)}if(!t||!t.src){t=this.getImageByType(UIElement.IMAGE_OFF_BG)}}return t};UICheckBox.prototype.getFgImage=function(){return this.getImageByType(this.getValue()?UIElement.IMAGE_CHECKED_FG:UIElement.IMAGE_UNCHECK_FG)};UICheckBox.prototype.getTextColor=function(t){return this.getValue()?this.style.textColorOn:this.style.textColor};UICheckBox.prototype.drawText=function(t){return};UICheckBox.prototype.getBgColor=function(t){return this.getValue()?this.style.fillColorOn:this.style.fillColor};UICheckBox.prototype.paintSelfOnly=function(t){var e=this.getText();var i=this.getFgImage();var n=this.getBgImage();var r=this.getBgColor();var a=i?i.getImage():null;var o=i?i.getImageRect():null;if(!n&&r){t.fillStyle=r;drawRoundRect(t,this.w,this.h,this.roundRadius);t.fill()}var s=this.getHMargin();t.textBaseline="middle";t.font=this.style.getFont();t.fillStyle=this.getTextColor();if(a&&e){switch(this.iconLocation){case"left":{var h=s;var l=Math.min(this.h,o.h);var u=this.h-l>>1;var c=l;this.drawImageAt(t,a,UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN,h,u,c,l,o);u=this.h>>1;h=this.w-s;this.hTextAlign="right";t.textAlign="right";t.fillText(e,h,u);break}default:{var l=Math.min(this.h,o.h);var c=l;var h=this.w-s-c;var u=this.h-l>>1;this.drawImageAt(t,a,UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN,h,u,c,l,o);u=this.h>>1;h=s;this.hTextAlign="left";t.textAlign="left";t.fillText(e,h,u)}}}else if(a){this.drawImageAt(t,a,UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN,0,0,this.w,this.h,o)}else if(e){var u=this.h>>1;if(this.hTextAlign==="center"){var h=this.w>>1;t.textAlign="center"}else if(this.hTextAlign==="right"){var h=this.w-s;t.textAlign="right"}else{var h=s;t.textAlign="left"}t.fillText(e,h,u)}return};UICheckBox.prototype.onClick=function(t,e){if(e){return}this.setValue(!this.getValue());this.callOnClickHandler(t);return};function UICheckBoxCreator(){var t=["ui-checkbox","ui-checkbox",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UICheckBox;return e.initUICheckBox(this.type)};return}ShapeFactoryGet().addShapeCreator(new UICheckBoxCreator);function UISwitch(){return}UISwitch.prototype=new UICheckBox;UISwitch.prototype.isUISwitch=true;UISwitch.prototype.initUISwitch=function(t,e,i,n,r){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,r);this.value=true;this.imageWidth=412;this.maskWidth=n;this.offsetImage=n;this.addEventNames(["onChanged"]);this.interpolator=new DecelerateInterpolator(2);return this};UISwitch.prototype.updateImageSize=function(t){this.imageWidth=t;this.maskWidth=Math.floor(t*.373786);if(!this.animating){this.offsetImage=this.value?this.maskWidth:this.imageWidth-this.maskWidth}return};UISwitch.prototype.animateChange=function(){var t=this;var e=new Date;var i=e.getTime();var n=this.offsetImage;var r=this.value?this.maskWidth:this.imageWidth-this.maskWidth;var a=r-n;this.animating=true;var o=500;function s(){var e=new Date;var h=e.getTime();var l=(h-i)/o;var u=t.interpolator.get(l);var c=n+a*u;if(l<1){t.offsetImage=c;setTimeout(s,10)}else{t.offsetImage=r;delete this.animating}t.postRedraw();delete e;return}setTimeout(s,30);return};UISwitch.prototype.onClick=function(t,e){if(e||this.mode!==Shape.MODE_EDITING){return}this.setValue(!this.value);return};UISwitch.prototype.onPointerDownRunning=function(t,e){if(e){return}this.pointerDownPosition=t;return};UISwitch.prototype.onPointerUpRunning=function(t,e){if(e){return}var i=t.x-this.pointerDownPosition.x;if(Math.abs(i)<5){this.setValue(!this.value)}else{this.setValue(i>0)}return};UISwitch.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value);this.animateChange()}return this};UISwitch.prototype.drawBgImage=function(t){return};UISwitch.prototype.drawFgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(e){this.updateImageSize(e.width);var i=e.height;var n=this.maskWidth;var r=(this.w-n)/2;var a=(this.h-i)/2;this.imageWidth=e.width;t.drawImage(e,this.offsetImage,0,n,i,r,a,n,i);t.drawImage(e,0,0,n,i,r,a,n,i)}return};function UISwitchCreator(t,e,i,n){var r=["ui-switch","ui-switch",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var a=new UISwitch;return a.initUISwitch(this.type,t,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UISwitchCreator(154,54,154,null));function UISimpleHTML(){return}UISimpleHTML.prototype=new UIVScrollView;UISimpleHTML.prototype.isUISimpleHTML=true;UISimpleHTML.prototype.initUISimpleHTML=function(t,e,i){this.initUIVScrollView(t,10,i,null);this.setText(e);this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,i);return this};UISimpleHTML.prototype.extractHtmlElements=function(t,e){var i=0;var n=null;var r=this;var a=t.localName;var o=t.childNodes.length;var s=t.childNodes;function h(t){var e={x:0,y:0};e.type=t;return e}if(a==="b"){this.bold=this.bold+1}else if(a==="i"){this.italic=this.italic+1}else if(a==="u"){this.underline=this.underline+1}else if(a==="a"){this.anchor=this.anchor+1}else if(a==="ol"||a==="ul"){if(e>0){n=h("newline")}}else if(a==="li"){n=h("text");if(t.parentNode.localName==="ol"){n.value="    "+(e+1)+". "}else{n.value="    o. "}n.bold=true;n.color="gray";n.fontStyle="bold "}var l=null;if(t.style&&t.style.color){l=t.style.color}if(!l&&t.getAttribute){l=t.getAttribute("color")}if(l){this.colors.push(l)}if(n){n.tag=a;this.elements.push(n);n=null}for(var i=0;i<o;i++){var u=s[i];this.extractHtmlElements(u,i)}if(a==="img"&&t.src){var c=t.src;var p=new Image;p.onload=function(t){n.imageLoaded=true;r.textNeedRelayout=true;return};p.onerror=function(t){n.imageLoaded=false;if(c){console.log("load "+c+" failed.")}};p.onabort=function(t){n.imageLoaded=false;if(c){console.log("load "+c+" failed(abort).")}};p.src=c;n=h("img");n.value=p;n.displayWidth=t.width;n.displayHeight=t.height}else if(!o&&t.textContent){var f=t.textContent.replace(/(\t|\n|\r)+/g,"");var m=f.replace(/ +/g," ");if(m){n=h("text");n.value=m;n.bold=this.bold;n.italic=this.italic;n.underline=this.underline;n.anchor=this.anchor;n.fontStyle="";if(this.colors.length){n.color=this.colors[this.colors.length-1]}if(n.bold){n.fontStyle=n.fontStyle+"bold "}if(n.italic){n.fontStyle=n.fontStyle+"italic "}}}if(a==="b"){this.bold=this.bold-1}if(a==="i"){this.italic=this.italic-1}if(a==="u"){this.underline=this.underline-1}if(a==="a"){n=h("a");n.href=t.href;this.anchor=this.anchor-1}if(a==="p"||t.style!=null&&t.style.display==="block"){n=h("newblock");
}else if(a==="li"||a==="br"||a==="hr"||a==="dd"){n=h("newline")}if(t.style&&t.style.color){this.colors.pop()}if(n){n.tag=a;this.elements.push(n)}return};UISimpleHTML.prototype.getNodeByPoint=function(t){var e=0;var i=t.x;var n=t.y;var r=null;var a=null;var o={};var s=this.elements.length;var h=this.elements;for(e=0;e<s;e++){r=h[e];a=e+1<s?h[e+1]:null;if(n<r.y){continue}if(a&&(n>a.y&&r.y<a.y)){continue}if(r.type==="text"){var l=0;var u=r.lines.length;o.h=r.lineHeight;for(l=0;l<u;l++){o.x=0;o.y=r.y+l*r.lineHeight;if(l===0){o.x=r.x;o.w=r.firstLineWidth}else if(l+1===u){o.w=r.lastLineWidth}else{o.w=this.w}if(isPointInRect(t,o)){return r}}}else if(r.type==="img"){o.x=r.x;o.y=r.y;o.w=r.w;o.h=r.h;if(isPointInRect(t,o)){return r}}}return r};UISimpleHTML.prototype.layoutHtmlElements=function(t){var e=0;var i=0;var n=0;var r=null;var a=0;var o=null;var s=this.elements.length;var h=this.elements;var l=this.getWidth(true);var u=this.style.fontSize;var c=new TextLayout(t);var p=u+"pt "+this.style.fontFamily;var f=u*2;t.font=p;for(e=0;e<s;e++){r=h[e];if(r.type==="text"){r.lines=[];r.x=i;r.y=n;r.firstLineWidth=0;t.font=r.fontStyle+p;r.lineHeight=f;c.setText(r.value);while(true){a=l-i;if(c.hasNext()){o=c.nextLine(a,u);r.lines.push(o.text);if(r.lines.length===1){r.firstLineWidth=o.width}if(c.hasNext()){i=0;n=n+f}else{i=i+o.width;r.lastLineWidth=o.width;break}}else{break}}}else if(r.type==="newline"){r.x=i;r.y=n;i=0;n=n+f}else if(r.type==="newblock"){r.x=i;r.y=n;i=0;n=n+f*1.5}else if(r.type==="img"){if(r.imageLoaded){var m=r.value;var d=m.height/m.width;var g=r.displayWidth?r.displayWidth:m.width;var y=r.displayHeight?r.displayHeight:m.height;r.y=n+f*.5;if(g<l){r.w=g;r.x=Math.floor((l-g)/2);r.h=Math.floor(r.w*d)}else{r.x=0;r.w=l;r.h=Math.floor(r.w*d)}n=r.y+r.h;n=n+.5*f}else{n=n+f}i=0}this.scrollRange=n}return};UISimpleHTML.prototype.getScrollRange=function(){return this.scrollRange?this.scrollRange:this.h};UISimpleHTML.prototype.loadUrl=function(t,e){var i={};var n=this;i.method="GET";i.url=t;i.headers={"Cache-Control":"no-cache",Pragma:"no-cache"};i.onDone=function(t,i,r){var a=i.status===200;if(i.status===200){var o=r;try{n.setText(o);console.log("loadUrl: done")}catch(s){a=false;console.log("loadUrl: failed"+s.message)}}if(e){e(a)}return};httpDoRequest(i);return};UISimpleHTML.prototype.setText=function(t){this.text=this.toText(t);this.elements=[];var e=document.createElement("div");e.innerHTML=this.text;this.bold=0;this.anchor=0;this.italic=0;this.underline=0;this.strong=0;this.colors=[];this.extractHtmlElements(e,0);delete this.colors;delete this.anchor;delete this.bold;delete this.italic;delete this.underline;delete this.strong;this.textNeedRelayout=true;return};UISimpleHTML.prototype.layoutHtml=function(t){if(!this.textNeedRelayout){return}if(!this.text){return}this.layoutHtmlElements(t);this.textNeedRelayout=false;return};UISimpleHTML.prototype.shapeCanBeChild=function(t){return false};UISimpleHTML.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=0;var r=0;var a=this.h;var o=this.w;var s=null;var h=this.hMargin;var l=this.getWidth(true);var u=this.style.fontSize;var c=2*u;var p=this.hMargin;var f=-this.offset+this.vMargin;var m=u+"pt "+this.style.fontFamily;this.layoutHtml(t);t.save();t.rect(0,0,o,a);t.clip();if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}t.beginPath();t.font=m;t.textAlign="left";t.textBaseline="top";t.fillStyle=this.style.textColor;var d=this.elements.length;var g=this.elements;for(e=0;e<d;e++){s=g[e];if(s.type==="text"&&s.lines&&s.lines.length){var y=s.lines.length;t.font=s.fontStyle+m;if(s.color){t.fillStyle=s.color}else if(s.anchor){t.fillStyle="Blue"}else{t.fillStyle=this.style.textColor}for(k=0;k<y;k++){if(k===0){i=s.x;n=s.y}else{i=0;n=s.y+k*c}i=i+p;n=n+f;r=n+u;if(n<a&&r>=0){l=o-i-h;t.fillText(s.lines[k],i,n,l)}}}else if(s.type==="img"&&s.imageLoaded){var v=s.value;var _=v.width;var I=v.height;i=s.x+p;n=s.y+f;r=n+s.h;if(n<a&&r>=0){t.drawImage(v,0,0,_,I,i,n,s.w,s.h)}}}t.restore();return};function UISimpleHTMLCreator(){var t=["ui-simple-html","ui-simple-html",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISimpleHTML;var i="Simpe HTML";return e.initUISimpleHTML(this.type,i,null)};return}ShapeFactoryGet().addShapeCreator(new UISimpleHTMLCreator);function UIHtmlView(){return}UIHtmlView.prototype=new UIHtml;UIHtmlView.prototype.isUIHtmlView=true;UIHtmlView.prototype.getHtmlContent=function(){var t="<p>hello html view";var e=this.getWidth(true);var i=this.getHeight(true);var n=this.getUrl();var r=this.getValue();if(n){t='<iframe seamless="seamless" scrolling="yes" width="'+e+'" height="'+i+'" src="'+n+'"></iframe>'}else if(r){t=r}return t};UIHtmlView.prototype.setText=function(t){this.text=t;return};UIHtmlView.prototype.getValue=function(){return this.text?this.text:""};UIHtmlView.prototype.setValue=function(t){this.text=t;return};UIHtmlView.prototype.getUrl=function(){return this.url?this.url:""};UIHtmlView.prototype.setUrl=function(t){this.url=t;return};UIHtmlView.prototype.paintSelfOnly=function(t){if(!this.htmlVisible){var e=this.w>>1;var i=this.h>>1;var n=dappGetText("HtmlView");t.textBaseline="middle";t.textAlign="center";t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.fillText(n,e,i)}return};UIHtmlView.prototype.initUIHtmlView=function(t){this.initUIHtml(t,400,300);this.setValue("<p>hello html view");this.setImage(UIElement.IMAGE_DEFAULT,null);this.setScrollable(true);return this};function UIHtmlViewCreator(){var t=["ui-html-view","ui-html-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIHtmlView;return e.initUIHtmlView(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlViewCreator);function UIButtonGroup(){return}UIButtonGroup.prototype=new UIElement;UIButtonGroup.prototype.isUIButtonGroup=true;UIButtonGroup.prototype.initUIButtonGroup=function(t,e,i,n){this.initUIElement(t);this.setMargin(e,e);this.setDefSize(300,60);this.setSizeLimit(100,40,1e3,120);this.buttonMaxWidth=i;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.rectSelectable=false;this.addEventNames(["onInit"]);if(!n){this.style.setFillColor("White")}return this};UIButtonGroup.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton||t.isUIGroup||t.isUIRadioBox||t.isUICheckBox){return true}return false};UIButtonGroup.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};UIButtonGroup.prototype.relayoutChildren=function(){var t=this.getHMargin();var e=this.getVMargin();var i=this.children.length;if(i===0||this.disableRelayout){return}var n=t;var r=e;var a=this.h-2*e;var o=this.buttonMaxWidth;var s=Math.floor((this.w-2*t)/i);var h=Math.min(s,o);for(var l=0;l<i;l++){var u=this.children[l];n=l*s+(s-h)/2+t;u.setPosition(n,r);u.setSize(h,a);u.setUserMovable(false);u.setUserResizable(false);u.relayoutChildren()}this.w=s*i+2*t;return};UIButtonGroup.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return true};function UIButtonGroupCreator(t,e,i){var n=["ui-button-group","ui-button-group",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIButtonGroup;return r.initUIButtonGroup(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIButtonGroupCreator(5,200,null));function UIPageIndicator(){return}UIPageIndicator.prototype=new UIHScrollView;UIPageIndicator.prototype.isUIPageIndicator=true;UIPageIndicator.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIPageIndicator.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicator.prototype.setVisibleTabs=function(t){this.visibleTabs=t;return};UIPageIndicator.prototype.getVisibleTabs=function(){return this.visibleTabs?this.visibleTabs:6};UIPageIndicator.prototype.getTabWidth=function(){var t=this.getPages();var e=this.getVisibleTabs();if(t<e){return this.w/t}else{return this.w/e}};UIPageIndicator.prototype.getScrollRange=function(){var t=this.getVisibleTabs();if(t<6){return this.w}else{var e=this.getPages();return this.getTabWidth()*e}};UIPageIndicator.prototype.initUIPageIndicator=function(t,e,i){this.initUIHScrollView(t,10,null);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setCanRectSelectable(false,false);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UIPageIndicator.prototype.getViewPager=function(){if(!this.getParent()){return}if(this.viewPager&&!this.viewPager.parentShape){this.viewPager=null}if(!this.viewPager){this.viewPager=this.getParent().findChildByType("ui-view-pager",true);if(!this.viewPager&&this.isUIPageIndicatorSimple){this.viewPager=this.getWindow().findChildByType("ui-view-pager",true)}}if(this.viewPager){this.viewPager.setShowIndicator(false)}return this.viewPager};UIPageIndicator.prototype.getViewPagerOffset=function(){var t=this.getViewPager();return t?t.offset/t.w:0};UIPageIndicator.prototype.getPages=function(){var t=this.getViewPager();if(t){t.pageIndicator=this}return t?t.getFrames():3};UIPageIndicator.prototype.getCurrent=function(){var t=this.getViewPager();return t?t.getCurrent():0};UIPageIndicator.prototype.paintOneIndicator=function(t,e,i,n,r,a,o){t.beginPath();t.arc(n+a/2,r+o/2,10,0,2*Math.PI);t.fill();if(e){t.stroke()}return};UIPageIndicator.prototype.shapeCanBeChild=function(t){return false};UIPageIndicator.prototype.paintOneIndicatorCircle=function(t,e,i,n,r,a,o){var s=Math.floor(Math.max(5,o/4));t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.lineColorOfCurrent:this.style.lineColor;t.beginPath();t.arc(n+a/2,r+o/2,s,0,2*Math.PI);t.fill();t.stroke();return};UIPageIndicator.prototype.paintOneIndicatorNumber=function(t,e,i,n,r,a,o){var s=Math.floor(Math.max(5,o/4));var h=Math.floor(n+a/2);var l=Math.floor(r+o/2);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.lineColorOfCurrent:this.style.lineColor;t.beginPath();t.arc(h,l,s,0,2*Math.PI);t.fill();t.stroke();t.font=s<20?"16px sans":"22px sans";t.textAlign="center";t.textBaseline="middle";t.fillStyle=this.style.textColor;t.fillText(i+1,h,l);return};UIPageIndicator.prototype.paintOneIndicatorRect=function(t,e,i,n,r,a,o){var s=10;if(a>o){s=Math.max(20,o/4)}else{s=Math.max(20,a/4)}s=Math.floor(s);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.lineColorOfCurrent:this.style.lineColor;var h=(a-s)/2;var l=(o-s)/2;t.beginPath();t.rect(n+h,r+l,s,s);t.fill();t.stroke();return};UIPageIndicator.prototype.paintOneIndicatorLine=function(t,e,i,n,r,a,o){var s=4;if(a>o){s=Math.max(4,o/4)}else{s=Math.max(4,a/4)}s=Math.floor(s);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.lineColorOfCurrent:this.style.lineColor;var h=(a-s)/2;var l=(o-s)/2;t.beginPath();if(a>o){t.rect(n,r+l,a,s)}else{t.rect(n+h,r,s,o)}t.fill();t.stroke();return};UIPageIndicator.prototype.onClickItem=function(t){var e=this.getViewPager();if(e){e.setCurrent(t)}return};UIPageIndicator.prototype.findItemByPoint=function(t){var e=this.getPages();if(this.w>this.h){var i=this.getTabWidth();for(var n=0;n<e;n++){if(t.x>n*i&&t.x<(n+1)*i){return n}}}else{var r=this.h/e;for(var n=0;n<e;n++){if(t.y>n*r&&t.y<(n+1)*r){return n}}}return-1};UIPageIndicator.prototype.onClick=function(t,e){if(e){return}var i=this.findItemByPoint(t);if(i>=0){this.onClickItem(i)}this.callOnClickHandler(t);return};UIPageIndicator.prototype.paintBackground=function(t){var e=this.getPages();if(!e){t.lineWidth=1;t.strokeStyle="Red";t.rect(0,0,this.w,this.h);t.stroke()}};UIPageIndicator.prototype.paintSelfOnly=function(t){var e=this.getPages();var i=this.getCurrent();var n={};n.x=this.lastPosition.x-this.x;n.y=this.lastPosition.y-this.y;this.pointerOnItem=this.findItemByPoint(n);this.paintBackground(t);t.translate(-this.offset,0);if(this.w>this.h){var r=this.h;var a=this.getTabWidth();var o=Math.floor(this.getViewPagerOffset()*a);for(var s=0;s<e;s++){var h=s*a;this.paintOneIndicator(t,s===i,s,h,0,a,r)}}else{var a=this.w;var r=this.h/e;for(var s=0;s<e;s++){var l=s*r;this.paintOneIndicator(t,s===i,s,0,l,a,r)}}t.translate(this.offset,0);delete this.pointerOnItem;return};function UIPageIndicatorCreator(){var t=["ui-page-indicator","ui-page-indicator",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicator;return e.initUIPageIndicator(this.type,200,60)};return}function UIPageIndicatorSimple(){return}UIPageIndicatorSimple.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicatorSimple.prototype=new UIPageIndicator;UIPageIndicatorSimple.prototype.isUIPageIndicatorSimple=true;UIPageIndicatorSimple.prototype.initUIPageIndicatorSimple=function(t,e,i){this.initUIPageIndicator(t,e,i);this.fillColorOfCurrent="Gray";this.lineColorOfCurrent="Black";this.setAlwaysOnTop(true);this.setVisibleTabs(12);return this};UIPageIndicatorSimple.prototype.setLineColorOfCurrent=function(t){this.lineColorOfCurrent=t;return};UIPageIndicatorSimple.prototype.setFillStyleOfCurrent=function(t){this.fillColorOfCurrent=t;return};function UIPageIndicatorCircleCreator(){var t=["ui-page-indicator-circle","ui-page-indicator-circle",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;e.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorCircle;return e.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorNumberCreator(){var t=["ui-page-indicator-number","ui-page-indicator-number",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;e.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorNumber;return e.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorRectCreator(){var t=["ui-page-indicator-rect","ui-page-indicator-rect",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;e.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorRect;return e.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorLineCreator(){var t=["ui-page-indicator-line","ui-page-indicator-line",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;e.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorLine;return e.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorNormal(){return}UIPageIndicatorNormal.prototype=new UIPageIndicator;UIPageIndicatorNormal.prototype.isUIPageIndicatorNormal=true;UIPageIndicatorNormal.prototype.initUIPageIndicatorNormal=function(t,e,i){this.initUIPageIndicator(t,e,i);this.itemTexts=[];this.itemImages=[];this.imagePosition="left";this.itemImagesOfCurrent=[];this.setMargin(5,5);this.setAlwaysOnTop(false);this.setImage(UIElement.ITEM_BG_NORMAL,null);this.setImage(UIElement.ITEM_BG_ACTIVE,null);this.setImage(UIElement.ITEM_BG_CURRENT_NORMAL,null);this.setImage(UIElement.ITEM_BG_CURRENT_ACTIVE,null);return this};UIPageIndicatorNormal.prototype.onInit=function(){this.syncImages()};UIPageIndicatorNormal.prototype.syncImages=function(){this.itemImages=[];this.itemImagesOfCurrent=[];for(var t in this.images){if(t==="display")continue;var e=this.images[t];if(t.indexOf("current-item-images-")===0){this.itemImagesOfCurrent.push(e)}else if(t.indexOf("item-images-")===0){this.itemImages.push(e)}}return};UIPageIndicatorNormal.prototype.setEnableAnimatePage=function(t){this.enableAnimatePage=t;return};UIPageIndicatorNormal.prototype.setItemImagesByStr=function(t){var e=t.split("\n");var i="item-images-";var n=this.itemImages.length;for(var r=0;r<n;r++){this.setImage(i+r,null)}for(var r=0;r<e.length;r++){var a=e[r];if(a){this.setImage(i+r,a)}}this.syncImages();this.strItemImages=t;return};UIPageIndicatorNormal.prototype.setItemImagesOfCurrentByStr=function(t){var e=t.split("\n");var i="current-item-images-";var n=this.itemImagesOfCurrent.length;for(var r=0;r<n;r++){this.setImage(i+r,null)}for(var r=0;r<e.length;r++){var a=e[r];if(a){this.setImage(i+r,a)}}this.syncImages();this.strItemImagesOfCurrent=t;return};UIPageIndicatorNormal.prototype.setItemTextsByStr=function(t){this.strItemTexts=t;this.itemTexts=t.split("\n");return};UIPageIndicatorNormal.prototype.setImagePosition=function(t){this.imagePosition=t;return};UIPageIndicatorNormal.prototype.getItemImagesStr=function(){return this.strItemImages?this.strItemImages:""};UIPageIndicatorNormal.prototype.getItemImagesStrOfCurrent=function(){return this.strItemImagesOfCurrent?this.strItemImagesOfCurrent:""};UIPageIndicatorNormal.prototype.getItemImages=function(){if(!this.itemImages.length){this.syncImages()}return this.itemImages};UIPageIndicatorNormal.prototype.getItemImagesOfCurrent=function(){if(!this.itemImagesOfCurrent.length){this.syncImages()}return this.itemImagesOfCurrent};UIPageIndicatorNormal.prototype.getItemTextsStr=function(){return this.strItemTexts?this.strItemTexts:""};UIPageIndicatorNormal.prototype.getItemTexts=function(){if(!this.itemTexts.length&&this.strItemTexts){this.setItemTextsByStr(this.strItemTexts)}return this.itemTexts};UIPageIndicatorNormal.prototype.getItemImage=function(t,e){var i=e?this.getItemImagesOfCurrent():this.getItemImages();if(i&&t<i.length){return i[t]}return null};UIPageIndicatorNormal.prototype.getBackgroundImage=function(t,e){var i="";var n=this.pointerDown&&this.pointerOnItem===t;if(e){i=n?UIElement.ITEM_BG_CURRENT_ACTIVE:UIElement.ITEM_BG_CURRENT_NORMAL}else{i=n?UIElement.ITEM_BG_ACTIVE:UIElement.ITEM_BG_NORMAL}return this.getImageByType(i)};UIPageIndicatorNormal.prototype.paintOneIndicatorBackground=function(t,e,i,n,r,a,o){var s=this.getBackgroundImage(i,e);if(!s||!s.getImage()){return}var h=s.getImage();var l=s.getImageRect();this.drawImageAt(t,h,this.images.display,n,r,a,o,l);return};UIPageIndicatorNormal.prototype.setItemTextColorOfCurrent=function(t){this.itemTextColorOfCurrent=t;return};UIPageIndicatorNormal.prototype.getItemTextColorOfCurrent=function(){return this.itemTextColorOfCurrent?this.itemTextColorOfCurrent:"green"};UIPageIndicatorNormal.prototype.paintBackground=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_NORMAL);if(!e){t.fillStyle=this.style.fillColor;t.rect(0,0,this.w,this.h);t.fill()}return};UIPageIndicatorNormal.prototype.getItemLocaleText=function(t){var e=null;var i=this.getItemTexts();if(i&&t<i.length){e=webappGetText(i[t]);if(!e){e=i[t]}}return e};UIPageIndicatorNormal.prototype.paintOneIndicator=function(t,e,i,n,r,a,o){var s=this.getItemImage(i,e);this.paintOneIndicatorBackground(t,e,i,n,r,a,o);var h=8;var l=this.style.fontSize;var u=this.getItemLocaleText(i);t.font=this.style.getFont();t.fillStyle=e?this.getItemTextColorOfCurrent():this.style.textColor;if(s&&s.getImage()){var c=s.getImage();var p=s.getImageRect();var f=this.hMargin;var m=this.vMargin;if(u){var l=this.style.fontSize;var d=n+f;var g=r+m;var y=a-2*f;var v=o-l-2*m-h;this.drawImageAt(t,c,UIElement.IMAGE_DISPLAY_AUTO,d,g,y,v,p);d=n+(a>>1);g=r+o-m;t.textAlign="center";t.textBaseline="bottom";t.fillText(u,d,g)}else{var d=n+f;var g=r+m;var y=a-2*f;var v=o-2*m;this.drawImageAt(t,c,UIElement.IMAGE_DISPLAY_AUTO,d,g,y,v,p)}}else{if(u){t.textAlign="center";t.textBaseline="middle";t.fillText(u,Math.floor(n+a/2),Math.floor(r+o/2))}}return};UIPageIndicator.prototype.onClickItem=function(t){var e=this.getViewPager();if(e){if(this.enableAnimatePage){e.switchTo(t)}else{e.setCurrent(t)}}return};function UIPageIndicatorNormalCreator(){var t=["ui-page-indicator-normal","ui-page-indicator-normal",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorNormal;return e.initUIPageIndicatorNormal(this.type,200,60)};return}ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNormalCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorCircleCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNumberCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorRectCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorLineCreator);function UICollapsable(){return}UICollapsable.prototype=new UILayout;UICollapsable.prototype.isUICollapsable=true;UICollapsable.prototype.initUICollapsable=function(t,e,i,n){this.initUILayout(t,e,i,n);this.vLayout=this.type==="ui-v-collapsable";return this};UICollapsable.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPageManager||t.isUIPage){return false}if(this.children.length>=2){return false}return true};UICollapsable.prototype.paintSelfOnly=function(t){t.fillRect(0,0,this.w,this.h);return};UICollapsable.prototype.expandChild=function(t){var e="";if(this.children.length!=2||!t||t.visible){return}var i=null;if(t===this.children[0]){if(this.vLayout){this.y=this.y-t.h;this.h=this.h+t.h;e="anim-expand-up"}else{this.x=this.x-t.w;this.w=this.w+t.w;e="anim-expand-left"}}else if(t===this.children[1]){if(this.vLayout){this.h=this.h+t.h;e="anim-expand-down"}else{this.w=this.w+t.w;e="anim-expand-right"}}else{return}t.setVisible(true);this.relayoutChildren();this.parentShape.relayoutChildren("default");t.setVisible(false);animateUIElement(t,e);return};UICollapsable.prototype.collapseChild=function(t){t.setVisible(true);if(this.children.length!=2||!t||!t.visible){return}var e=null;if(t===this.children[0]){if(this.vLayout){animhint="anim-collapse-down";animateUIElement(t,animhint);this.y=this.y+t.h;this.h=this.h-t.h}else{animhint="anim-collapse-right";animateUIElement(t,animhint);this.x=this.x+t.w;this.w=this.w-t.w}}else if(t===this.children[1]){if(this.vLayout){animhint="anim-collapse-up";animateUIElement(t,animhint);this.h=this.h-t.h}else{animhint="anim-collapse-left";animateUIElement(t,animhint);this.w=this.w-t.w}}else{return}t.setVisible(false);this.relayoutChildren();this.parentShape.relayoutChildren("default");return};UICollapsable.prototype.getChild=function(t){var e=this.findChildByName(t);if(!e){if(t==="first"||t===0){e=this.children[0]}if(t==="second"||t===1){e=this.children[1]}}return e};UICollapsable.prototype.collapse=function(t){this.collapseChild(this.getChild(t));return};UICollapsable.prototype.expand=function(t){this.collapseChild(this.getChild(t));return};UICollapsable.prototype.collapseOrExpand=function(t){var e=this.getChild(t);if(!e){return}if(e.visible){this.collapseChild(e)}else{this.expandChild(e)}return};UICollapsable.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=this.hMargin;var e=this.vMargin;var i=this.vLayout;for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.visible){continue}if(i){r.heightAttr=UIElement.HEIGHT_FIX;r.widthAttr=UIElement.WIDTH_FILL_PARENT;r.relayout();r.y=e;e=e+r.h;if(e>this.h){this.h=e+this.vMargin}}else{r.widthAttr=UIElement.WIDTH_FIX;r.heightAttr=UIElement.HEIGHT_FILL_PARENT;r.relayout();r.x=t;t=t+r.w;if(t>this.w){this.w=t+this.hMargin}}}return};function UIVCollapsableCreator(t,e,i){var n=["ui-v-collapsable","ui-collapsable",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UICollapsable;r.isUIVCollapsable=true;return r.initUICollapsable(this.type,t,e,i)};return}function UIHCollapsableCreator(t,e,i){var n=["ui-h-collapsable","ui-collapsable",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UICollapsable;r.isUIHCollapsable=true;return r.initUICollapsable(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIVCollapsableCreator(100,100,null));ShapeFactoryGet().addShapeCreator(new UIHCollapsableCreator(100,100,null));function UIColorBar(){return}UIColorBar.prototype=new UIElement;UIColorBar.prototype.isUIButton=false;UIColorBar.prototype.isUIColorBar=true;UIColorBar.prototype.initUIColorBar=function(t,e,i){this.initUIElement(t);this.setBarPosition(0);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);this.barDierction=0;return this};UIColorBar.prototype.setBarDirection=function(t){this.barDirection=t;return this};UIColorBar.prototype.getBarDirection=function(){return this.barDirection};UIColorBar.prototype.setBarPosition=function(t){this.barPosition=t;return this};UIColorBar.prototype.getBarPosition=function(){return this.barPosition};UIColorBar.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUIColorTile||t.isUILabel};UIColorBar.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=this.barDirection;var r=this.style.lineWidth;switch(this.barPosition){case-1:{break}case 1:{if(n){e=this.w-r}else{i=this.h-r}break}default:{if(n){e=Math.floor(this.w-r>>1)}else{i=Math.floor(this.h-r>>1)}}}if(n){t.moveTo(e,0);t.lineTo(e,this.h)}else{t.moveTo(0,i);t.lineTo(this.w,i)}t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke();return};function UIColorBarCreator(t,e){var i=["ui-color-bar","ui-color-bar",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorBar;return n.initUIColorBar(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIColorBarCreator(100,10));function UIImageAnimation(){return}UIImageAnimation.prototype=new UIImageView;UIImageAnimation.prototype.isUIImageAnimation=true;UIImageAnimation.prototype.initUIImageAnimation=function(t,e,i){this.initUIElement(t);this.initUIImageView(e,i);this.addEventNames(["onChanged"]);this.setTextType(Shape.TEXT_NONE);imageAnimationInitCustomProp(this);return this};UIImageAnimation.prototype.setCurrent=function(t){if(this.userImages.length){t=t%this.userImages.length}if(this.currFrame!=t){this.callOnChangedHandler(t)}this.currFrame=t;return this};UIImageAnimation.prototype.setValue=function(t){for(var e=0;e<this.cachedImages.length;e++){var i=this.cachedImages[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){return this.setCurrent(e)}}return this};UIImageAnimation.prototype.getCurrentImage=function(){var t=this.cachedImages[this.currFrame];return t};UIImageAnimation.prototype.onInit=function(){var t=this;this.currFrame=0;function e(){if(t.isVisible()){var i=1e3/t.getFrameRate();t.postRedraw();setTimeout(e,i);t.setCurrent(t.currFrame+1)}}var i=1e3/this.getFrameRate();setTimeout(e,i);return};UIImageAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIImageAnimation.prototype.setFrameRate=function(t){this.frameRate=Math.max(1,Math.min(t,30));return};UIImageAnimation.prototype.drawImage=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=(this.currFrame?this.currFrame:0)%this.userImages.length;var i=this.cachedImages[e];if(i&&i.width>0){this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h)}return};UIImageAnimation.prototype.shapeCanBeChild=function(t){return false};function UIImageAnimationCreator(){var t=["ui-image-animation","ui-image-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageAnimation;return e.initUIImageAnimation(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageAnimationCreator);UIElement.prototype.callOnUpdateTransformHandler=function(canvas){if(this.mode===Shape.MODE_EDITING)return true;if(!this.handleOnUpdateTransform){var sourceCode=this.events["onUpdateTransform"];if(sourceCode){sourceCode="this.handleOnUpdateTransform = function(canvas) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnUpdateTransform){try{this.handleOnUpdateTransform(canvas)}catch(e){console.log("this.handleOnUpdateTransform:"+e.message)}}return};UIElement.prototype.callOnPointerDownHandler=function(point,beforeChild){if(!this.enable){return false}if(!this.handlePointerDown){var sourceCode=this.events["onPointerDown"];if(sourceCode){sourceCode="this.handlePointerDown = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerDown){try{this.handlePointerDown(point,beforeChild)}catch(e){console.log("this.handlePointerDown:"+e.message)}}return true};UIElement.prototype.callOnPointerMoveHandler=function(point,beforeChild){if(!this.enable){return false}if(!this.handlePointerMove){var sourceCode=this.events["onPointerMove"];if(sourceCode){sourceCode="this.handlePointerMove = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerMove){try{this.handlePointerMove(point,beforeChild)}catch(e){console.log("this.handlePointerMove:"+e.message)}}return true};UIElement.prototype.callOnPointerUpHandler=function(point,beforeChild){if(!this.enable){return false}if(!this.handlePointerUp){var sourceCode=this.events["onPointerUp"];if(sourceCode){sourceCode="this.handlePointerUp = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerUp){try{this.handlePointerUp(point,beforeChild)}catch(e){console.log("this.handlePointerUp:"+e.message)}}return true};UIElement.prototype.callOnLongPressHandler=function(point){if(!this.enable){return false}if(!this.handleLongPress){var sourceCode=this.events["onLongPress"];if(sourceCode){sourceCode="this.handleLongPress = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleLongPress){try{this.handleLongPress(point)}catch(e){console.log("this.handleLongPress:"+e.message)}}return true};UIElement.prototype.callOnDoubleClickHandler=function(point){if(this.mode===Shape.MODE_EDITING){if(this.textType!=Shape.TEXT_NONE){this.editText(point)}else{this.showProperty()}return true}if(!this.enable){return false}if(!this.handleDoubleClick){var sourceCode=this.events["onDoubleClick"];if(sourceCode){sourceCode="this.handleDoubleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDoubleClick){try{this.handleDoubleClick(point)}catch(e){console.log("this.handleDoubleClick:"+e.message)}}this.hitTestResult=0;return true};UIElement.prototype.callOnPaintHandler=function(canvas2dCtx){if(this.mode===Shape.MODE_EDITING){return true}if(!this.enable){return false}if(!this.handlePaint){var sourceCode=this.events["onPaint"];if(sourceCode){sourceCode="this.handlePaint = function(canvas2dCtx) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePaint){try{this.handlePaint(canvas2dCtx)}catch(e){console.log("this.handlePaint:"+e.message)}}return true};UIElement.prototype.callOnClickHandler=function(point){if(!this.enable){return false}if(this.mode===Shape.MODE_EDITING){return false}if(this.onClicked){this.onClicked(point)}if(!this.handleClick){var sourceCode=this.events["onClick"];if(sourceCode){sourceCode="this.handleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(!this.children.length){console.log("clicked: "+this.type+"("+this.name+")")}if(this.handleClick){try{this.handleClick(point)}catch(e){console.log("this.handleClick:"+e.message+"\n"+e.stack)}}return};UIElement.prototype.callOnScrollDoneHandler=function(){if(!this.enable){return false}if(!this.handleOnScrollDone){var sourceCode=this.events["onScrollDone"];if(sourceCode){sourceCode="this.handleOnScrollDone = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnScrollDone){try{this.handleOnScrollDone();
}catch(e){console.log("this.handleOnScrollDone:"+e.message)}}return true};UIElement.prototype.callOnRemovedHandler=function(){if(!this.enable){return false}if(!this.handleOnRemoved){var sourceCode=this.events["onRemoved"];if(sourceCode){sourceCode="this.handleOnRemoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnRemoved){try{this.handleOnRemoved()}catch(e){console.log("this.handleOnRemoved:"+e.message)}}return true};UIElement.prototype.callOnChildDraggingHandler=function(sourceChildIndex,targetChildIndex){if(!this.enable){return false}if(!this.handleOnChildDragging){var sourceCode=this.events["onChildDragging"];if(sourceCode){sourceCode="this.handleOnChildDragging = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChildDragging){try{this.handleOnChildDragging(sourceChildIndex,targetChildIndex)}catch(e){console.log("this.handleOnChildDragging:"+e.message)}}return true};UIElement.prototype.callOnChildDraggedHandler=function(sourceChildIndex,targetChildIndex){if(!this.enable){return false}if(!this.handleOnChildDragged){var sourceCode=this.events["onChildDragged"];if(sourceCode){sourceCode="this.handleOnChildDragged = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChildDragged){try{this.handleOnChildDragged(sourceChildIndex,targetChildIndex)}catch(e){console.log("this.handleOnChildDragged:"+e.message)}}return true};UIElement.prototype.callOnChangingHandler=function(value){if(!this.enable||this.mode===Shape.MODE_EDITING){return false}if(!this.handleOnChanging){var sourceCode=this.events["onChanging"];if(sourceCode){sourceCode="this.handleOnChanging = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChanging){try{this.handleOnChanging(value)}catch(e){console.log("this.handleOnChanging:"+e.message)}}return true};UIElement.prototype.callOnChangedHandler=function(value){if(!this.enable||this.mode===Shape.MODE_EDITING){return false}if(this.onChanged){this.onChanged(value);return}if(!this.handleOnChanged){var sourceCode=this.events["onChanged"];if(sourceCode){sourceCode="this.handleOnChanged = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChanged){try{this.handleOnChanged(value)}catch(e){console.log("this.handleOnChanged:"+e.message)}}return true};UIElement.prototype.callOnInitHandler=function(){if(!this.handleOnInit){var sourceCode=this.events["onInit"];if(sourceCode){sourceCode="this.handleOnInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnInit){try{this.handleOnInit()}catch(e){console.log("this.handleOnInit:"+e.message+"\n"+e.stack)}}return true};UIElement.prototype.callOnFocusInHandler=function(){if(this.onFocusIn){try{this.onFocusIn()}catch(e){console.log("onFocusIn:"+e.message)}}if(!this.handleOnFocusIn){var sourceCode=this.events["onFocusIn"];if(sourceCode){sourceCode="this.handleOnFocusIn = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnFocusIn){try{this.handleOnFocusIn()}catch(e){console.log("this.handleOnFocusIn:"+e.message)}}return true};UIElement.prototype.callOnFocusOutHandler=function(){if(this.onFocusOut){try{this.onFocusOut()}catch(e){console.log("onFocusOut: "+e.message)}}if(!this.handleOnFocusOut){var sourceCode=this.events["onFocusOut"];if(sourceCode){sourceCode="this.handleOnFocusOut = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnFocusOut){try{this.handleOnFocusOut()}catch(e){console.log("this.handleOnFocusOut:"+e.message)}}return true};UIElement.prototype.callOnUpdateDataHandler=function(){if(!this.handleOnUpdateData){var sourceCode=this.events["onUpdateData"];if(sourceCode){sourceCode="this.handleOnUpdateData = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnUpdateData){try{this.handleOnUpdateData()}catch(e){console.log("this..handleOnUpdateData:"+e.message)}}return true};UIElement.prototype.callOnGestureHandler=function(gesture){if(!this.enable){return false}if(!this.handleOnGesture){var sourceCode=this.events["onGesture"];if(sourceCode){sourceCode="this.handleOnGesture = function(gesture) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnGesture){try{this.handleOnGesture(gesture)}catch(e){console.log("this.callOnGestureHandler:"+e.message)}}console.log("callOnGestureHandler: scale="+gesture.scale+" rotation="+gesture.rotation);return true};UIElement.prototype.callOnBeforeOpenHandler=function(initData){if(!this.handleOnBeforeOpen){var sourceCode=this.events["onBeforeOpen"];if(sourceCode){sourceCode="this.handleOnBeforeOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnBeforeOpen){try{this.handleOnBeforeOpen(initData)}catch(e){console.log("onBeforeOpen"+e.message)}}return true};UIElement.prototype.callOnOpenHandler=function(initData){if(!this.handleOnOpen){var sourceCode=this.events["onOpen"];if(sourceCode){sourceCode="this.handleOnOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnOpen){try{this.handleOnOpen(initData)}catch(e){console.log("onOpen"+e.message)}}return true};UIElement.prototype.callOnCloseHandler=function(retInfo){if(!this.handleOnClose){var sourceCode=this.events["onClose"];if(sourceCode){sourceCode="this.handleOnClose = function(retInfo) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnClose){try{this.handleOnClose(retInfo)}catch(e){console.log("onClose: "+e.message)}}return true};UIElement.prototype.callOnSwitchToBackHandler=function(){if(!this.handleOnSwitchToBack){var sourceCode=this.events["onSwitchToBack"];if(sourceCode){sourceCode="this.handleOnSwitchToBack = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwitchToBack){try{this.handleOnSwitchToBack()}catch(e){console.log("OnSwitchToBack: "+e.message)}}return true};UIElement.prototype.callOnSwitchToFrontHandler=function(){if(!this.handleOnSwitchToFront){var sourceCode=this.events["onSwitchToFront"];if(sourceCode){sourceCode="this.handleOnSwitchToFront = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwitchToFront){try{this.handleOnSwitchToFront()}catch(e){console.log("OnSwitchToFront: "+e.message)}}return true};UIElement.prototype.callOnLoadHandler=function(){if(!this.handleOnLoad){var sourceCode=this.events["onLoad"];if(sourceCode){sourceCode="this.handleOnLoad = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnLoad){try{this.handleOnLoad()}catch(e){console.log("OnLoad: "+e.message)}}return true};UIElement.prototype.callOnUnloadHandler=function(){if(!this.handleOnUnload){var sourceCode=this.events["onUnload"];if(sourceCode){sourceCode="this.handleOnUnload = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnUnload){try{this.handleOnUnload()}catch(e){console.log("OnUnload: "+e.message)}}return true};UIElement.prototype.callOnMovedHandler=function(){if(!this.handleOnMoved){var sourceCode=this.events["onMoved"];if(sourceCode){sourceCode="this.handleOnMoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnMoved){try{this.handleOnMoved()}catch(e){console.log("this.handleOnMoved:"+e.message)}}if(this.cameraFollowMe){this.getWindow().cameraFollow(this)}return true};UIElement.prototype.callOnBeginContactHandler=function(body,contact){if(this.onBeginContact){this.onBeginContact(body,contact);return}if(!this.handleOnBeginContact){var sourceCode=this.events["onBeginContact"];if(sourceCode){sourceCode="this.handleOnBeginContact = function(body, contact) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnBeginContact){try{this.handleOnBeginContact(body,contact)}catch(e){console.log("this.handleOnBeginContact:"+e.message)}}return true};UIElement.prototype.callOnEndContactHandler=function(body,contact){if(this.onEndContact){this.onEndContact(body,contact);return}if(!this.handleOnEndContact){var sourceCode=this.events["onEndContact"];if(sourceCode){sourceCode="this.handleOnEndContact = function(body, contact) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnEndContact){try{this.handleOnEndContact(body,contact)}catch(e){console.log("this.handleOnEndContact:"+e.message)}}return true};UIElement.prototype.callOnAnimateDoneHandler=function(name){if(!this.handleOnAnimateDone){var sourceCode=this.events["onAnimateDone"];if(sourceCode){sourceCode="this.handleOnAnimateDone = function(name) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnAnimateDone){try{this.handleOnAnimateDone(name)}catch(e){console.log("onAnimateDone: "+e.message)}}return true};UIElement.prototype.callOnSwipeLeftHandler=function(){if(!this.handleOnSwipeLeft){var sourceCode=this.events["onSwipeLeft"];if(sourceCode){sourceCode="this.handleOnSwipeLeft = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwipeLeft){try{this.handleOnSwipeLeft()}catch(e){console.log("this.handleOnSwipeLeft:"+e.message)}}return true};UIElement.prototype.callOnSwipeRightHandler=function(){if(!this.handleOnSwipeRight){var sourceCode=this.events["onSwipeRight"];if(sourceCode){sourceCode="this.handleOnSwipeRight = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwipeRight){try{this.handleOnSwipeRight()}catch(e){console.log("this.handleOnSwipeRight:"+e.message)}}return true};UIElement.prototype.callOnSwipeUpHandler=function(){if(!this.handleOnSwipeUp){var sourceCode=this.events["onSwipeUp"];if(sourceCode){sourceCode="this.handleOnSwipeUp = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwipeUp){try{this.handleOnSwipeUp()}catch(e){console.log("this.handleOnSwipeUp:"+e.message)}}return true};UIElement.prototype.callOnSwipeDownHandler=function(){if(!this.handleOnSwipeDown){var sourceCode=this.events["onSwipeDown"];if(sourceCode){sourceCode="this.handleOnSwipeDown = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwipeDown){try{this.handleOnSwipeDown()}catch(e){console.log("this.handleOnSwipeDown:"+e.message)}}return true};UIElement.prototype.callOnBecomeZeroHandler=function(){if(!this.handleOnBecomeZero){var sourceCode=this.events["onBecomeZero"];if(sourceCode){sourceCode="this.handleOnBecomeZero = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnBecomeZero){try{this.handleOnBecomeZero()}catch(e){console.log("this.handleOnBecomeZero:"+e.message)}}return true};UIElement.prototype.callOnBecomeFullHandler=function(){if(!this.handleOnBecomeFull){var sourceCode=this.events["onBecomeFull"];if(sourceCode){sourceCode="this.handleOnBecomeFull = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnBecomeFull){try{this.handleOnBecomeFull()}catch(e){console.log("this.handleOnBecomeFull:"+e.message)}}return true};UIElement.prototype.callOnTimeoutHandler=function(){if(!this.handleOnTimeout){var sourceCode=this.events["onTimeout"];if(sourceCode){sourceCode="this.handleOnTimeout = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnTimeout){try{this.handleOnTimeout()}catch(e){console.log("this.handleOnTimeout:"+e.message)}}return true};UIElement.prototype.callOnSystemInitHandler=function(){if(!this.handleOnSystemInit){var sourceCode=this.events["onSystemInit"];if(sourceCode){sourceCode="this.handleOnSystemInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSystemInit){try{this.handleOnSystemInit()}catch(e){console.log("this.handleOnSystemInit:"+e.message)}}return true};UIElement.prototype.callOnScrollOutOfRangeHandler=function(offset){if(!this.enable){return false}if(this.onScrollOutOfRange){this.onScrollOutOfRange(offset);return}if(!this.handleOnScrollOutOfRange){var sourceCode=this.events["onScrollOutOfRange"];if(sourceCode){sourceCode="this.handleOnScrollOutOfRange = function(offset) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnScrollOutOfRange){try{this.handleOnScrollOutOfRange(offset)}catch(e){console.log("this.handleOnScrollOutOfRange:"+e.message)}}return true};UIElement.prototype.callOnBirthedHandler=function(){if(!this.handleOnBirthed){var sourceCode=this.events["onBirthed"];if(sourceCode){sourceCode="this.handleOnBirthed = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnBirthed){try{this.handleOnBirthed()}catch(e){console.log("this.handleOnBirthed:"+e.message)}}return true};UIElement.prototype.dispatchCustomEvent=function(eventName,args){if(!this.customEventHandler){this.customEventHandler={}}var handleCustomEvent=this.customEventHandler[eventName];if(!handleCustomEvent){var sourceCode=this.events[eventName];if(sourceCode){sourceCode="this.handleCustomEvent = function(args) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}if(this.handleCustomEvent){handleCustomEvent=this.handleCustomEvent;this.customEventHandler[eventName]=handleCustomEvent;this.handleCustomEvent=null}}if(handleCustomEvent){try{handleCustomEvent.call(this,args)}catch(e){console.log("handleCustomEvent "+eventName+":"+e.message)}}return true};function UIVScrollImage(){return}UIVScrollImage.prototype=new UIVScrollView;UIVScrollImage.prototype.initUIVScrollImage=function(t){this.initUIVScrollView(t,0,null,null);this.setImage(UIElement.IMAGE_DEFAULT,null);this.widthAttr=UIElement.WIDTH_SCALE;this.heightAttr=UIElement.HEIGHT_SCALE;this.setSize(200,200);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UIVScrollImage.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e||!e.height){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);return}var i=this.w/e.width;var n=e.height*i;var r=0;var a=this.offset/i;var o=e.width;var s=Math.min(this.h/i,e.height-a);var h=0;var l=0;var u=this.w;var c=s*i;t.drawImage(e,r,a,o,s,h,l,u,c);return};UIVScrollImage.prototype.getScrollRange=function(){var t=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(t&&t.height&&t.width){var e=this.w/t.width;return e*t.height+60}else{return this.h}};UIVScrollImage.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.mode===Shape.MODE_EDITING){this.drawPageDownUp(t)}return};function UIVScrollImageCreator(){var t=["ui-v-scroll-image","ui-v-scroll-image",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVScrollImage;return e.initUIVScrollImage(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIVScrollImageCreator);function UIPageManager(){}UIPageManager.prototype=new UIFrames;UIPageManager.prototype.isUIPageManager=true;UIPageManager.prototype.initUIPageManager=function(t){return this.initUIFrames(t)};UIPageManager.prototype.beforeAddShapeIntoChildren=function(t){return!t.isUIPage};UIPageManager.prototype.shapeCanBeChild=function(t){return t.isUIPage};UIPageManager.prototype.relayoutChildren=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.x=0;e.y=0;e.w=this.w;e.h=this.h;e.relayoutChildren();e.setUserMovable(false);e.setUserResizable(false)}return};UIPageManager.prototype.showHTML=function(){var t=this.getCurrentFrame();if(t){t.showHTML()}return};UIPageManager.prototype.hideHTML=function(){var t=this.getCurrentFrame();if(t){t.hideHTML()}return};UIPageManager.prototype.switchTo=function(t){var e=this;var i=this.getCurrentFrame();var n=this.getFrame(t);var r=this.current;if(i){i.hideHTML()}if(r<0||r===t||!i||!n){this.showFrame(t);if(n){n.showHTML()}return}function a(){e.showFrame(t);e.postRedraw();return}if(!this.isTopWindow()){a();return}var o=null;var s=null;var h=this.getPositionInScreen();if(t<r){o=AnimationFactory.create("anim-backward");s=UIFrames.preparseBackendCanvas(n,i)}else{o=AnimationFactory.create("anim-forward");s=UIFrames.preparseBackendCanvas(i,n)}o.setScale(this.getRealScale());o.prepare(h.x,h.y,this.w,this.h,s,a);o.run();return};function UIPageManagerCreator(){var t=["ui-page-manager","ui-page-manager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageManager;e.initUIPageManager(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIPageManagerCreator);function UIWaitBar(){return}UIWaitBar.TILES=8;UIWaitBar.prototype=new UIElement;UIWaitBar.prototype.initUIWaitBar=function(t,e,i){this.initUIElement(t);this.offset=0;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};UIWaitBar.prototype.shapeCanBeChild=function(t){return false};UIWaitBar.prototype.step=function(){if(this.isVisible()&&this.getParent()){this.offset++;if(this.isUIWaitBar){this.offset=this.offset%UIWaitBar.TILES}this.postRedraw()}return this};UIWaitBar.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){return}if(this.isUIWaitBar){this.drawBgImageBar(t,e)}else{this.drawBgImageBox(t,e)}return};UIWaitBar.prototype.drawBgImageBox=function(t,e){var i=.05*Math.PI*this.offset;this.setRotation(i);UIElement.prototype.drawBgImage.call(this,t);return};UIWaitBar.prototype.onInit=function(){UIElement.prototype.onInit.call(this);var t=this;function e(){t.step();if(t.getParent()){setTimeout(e,50)}}e();return};UIWaitBar.prototype.drawBgImageBar=function(t,e){var i=e.width;var n=e.height;var r=Math.round(n/UIWaitBar.TILES);var a=this.offset*r;var o={x:0,y:a,w:i,h:r};UIElement.drawImageAt(t,e,this.images.display,0,0,this.w,this.h,o);return};function UIWaitBarCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIWaitBar;n.isUIWaitBar=true;return n.initUIWaitBar(this.type,e,i)};return}function UIWaitBoxCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIWaitBar;n.isUIWaitBox=true;return n.initUIWaitBar(this.type,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIWaitBarCreator("ui-wait-bar",200,24));ShapeFactoryGet().addShapeCreator(new UIWaitBoxCreator("ui-wait-box",60,60));function UIStaticMap(){return}UIStaticMap.prototype=new UIImage;UIStaticMap.prototype.isUIStaticMap=true;UIStaticMap.prototype.initUIStaticMap=function(t){this.initUIImage(t,200,200,null);return this};UIStaticMap.prototype.setMapProvider=function(t){this.mapProvider=t;return};UIStaticMap.prototype.setMapType=function(t){this.mapType=t;return};UIStaticMap.prototype.setMapZoom=function(t){this.mapZoom=t;return};UIStaticMap.prototype.setMapCenter=function(t){this.mapCenter=t;return};UIStaticMap.prototype.setMapWidth=function(t){this.mapWidth=t;return};UIStaticMap.prototype.setMapHeight=function(t){this.mapHeight=t;return};UIStaticMap.prototype.setMapExtraParams=function(t){this.mapEtraParams=t;return};UIStaticMap.prototype.getMapType=function(){return this.mapType?this.mapType:""};UIStaticMap.prototype.getMapProvider=function(){return this.mapProvider?this.mapProvider:"google"};UIStaticMap.prototype.getMapZoom=function(){return this.mapZoom?this.mapZoom:10};UIStaticMap.prototype.getMapWidth=function(){return this.mapWidth?this.mapWidth:600};UIStaticMap.prototype.getMapHeight=function(){return this.mapHeight?this.mapHeight:600};UIStaticMap.prototype.getMapCenter=function(){if(!this.mapCenter&&this.currentLocation){return this.currentLocation}else{return this.mapCenter?this.mapCenter:"China"}};UIStaticMap.prototype.getMapExtraParams=function(){return this.mapEtraParams?this.mapEtraParams:""};UIStaticMap.prototype.getMapURL=function(){var t="";if(this.mapProvider==="baidu"){t="http://api.map.baidu.com/staticimage?center="+this.getMapCenter()+"&width="+this.getMapWidth()+"&height="+this.getMapHeight()+"&zoom="+this.getMapZoom()+this.getMapExtraParams()}else if(this.mapProvider==="google"){t="http://maps.googleapis.com/maps/api/staticmap?center="+this.getMapCenter()+"&size="+this.getMapWidth()+"x"+this.getMapHeight()+"&zoom="+this.getMapZoom()+"&maptype="+this.getMapType()+"&sensor=true"+this.getMapExtraParams()}console.log("Map URL:"+t);return t};UIStaticMap.prototype.updateMap=function(){var t=this.getMapURL();this.setImageSrc(t);return};UIStaticMap.prototype.onInit=function(){var t=this;function e(e){t.currentLocation=e.coords.latitude+","+e.coords.longitude;t.updateMap();return}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e)}this.updateMap();return};UIStaticMap.prototype.drawImage=function(t){this.drawBgImage(t);return};function UIStaticMapCreator(){var t=["ui-static-map","ui-static-map",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIStaticMap;return e.initUIStaticMap(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIStaticMapCreator);function UIStatusBar(){return}UIStatusBar.prototype=new UIElement;UIStatusBar.prototype.isUIStatusBar=true;UIStatusBar.prototype.initUIStatusBar=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.widthAttr=UIElement.WIDTH_FILL_PARENT;return this};UIStatusBar.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton){return true}return false};UIStatusBar.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;if(this.type==="ui-menu-bar"){t.hideSelectMark=true;t.textType=Shape.TEXT_NONE;this.hideSelectMark=true}return true};UIStatusBar.prototype.beforeRelayoutChild=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return true};function UIStatusBarCreator(t,e,i,n){var r=[t,"ui-status-bar",null,true];ShapeCreator.apply(this,r);this.createShape=function(t){var r=new UIStatusBar;return r.initUIStatusBar(this.type,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UIStatusBarCreator("ui-status-bar",640,40,null));ShapeFactoryGet().addShapeCreator(new UIStatusBarCreator("ui-menu-bar",640,96,null));function UIUnkown(){return}UIUnkown.prototype=new UIElement;UIUnkown.prototype.isUIUnkown=true;UIUnkown.prototype.initUIUnkown=function(t){this.initUIElement(t);this.setDefSize(100,100);this.maxTryTimes=10;return this};UIUnkown.prototype.shapeCanBeChild=function(t){return true};UIUnkown.prototype.tryCreateRealElement=function(){if(this.maxTryTimes<1)return;var t=this.realObjJs;var e=this.parentShape;var i=ShapeFactoryGet().createShape(t.type,C_CREATE_FOR_PROGRAM,true);if(i){this.realObjJs=null;var n=e.getIndexOfChild(this);i.fromJson(t);e.addChild(i,n);e.removeChild(this);console.log("Create real obj done:"+t.type)}else{this.maxTryTimes--;if(this.maxTryTimes<1){this.realObjJs=null;console.log("Create real obj failed:"+t.type)}}};UIUnkown.prototype.paintSelfOnly=function(t){this.tryCreateRealElement();return};UIUnkown.prototype.toJson=function(){return this.realObjJs};UIUnkown.prototype.fromJson=function(t){this.realObjJs=t;this.setDefSize(t.w,t.h);return this};function UIUnkownCreator(){var t=["ui-unkown","ui-unkown",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIUnkown;return e.initUIUnkown(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIUnkownCreator);function SuggestionProvider(){this.query=function(t,e){};this.init=function(t){};return}function StaticSuggestionProvider(){this.init=function(t){if(typeof t=="string"){t=t.split("\n")}this.options=t;if(this.options){this.options.sort()}return};this.query=function(t,e){if(!t||!this.options){e([]);return}function i(t,e){if(t.indexOf(e)==0){return 0}if(t<e){return-1}else{return 1}}var n=[];var r=this.options.binarySearch(t,i);if(r>=0){var a=this.options.length;for(;r>=0;r--){var o=this.options[r];if(o.indexOf(t)!==0){r=r+1;break}}for(var s=r;s<a;s++){var o=this.options[s];if(o.indexOf(t)===0){n.push(o)}else{break}}}e(n);return};return}function createSuggestionProvider(t,e){var i=null;if(t==="static"){i=new StaticSuggestionProvider}if(i){i.init(e)}return i}function UISuggestion(){return}UISuggestion.prototype=new UIListView;UISuggestion.prototype.isUISuggestion=true;UISuggestion.prototype.initUISuggestion=function(t){this.initUIListView(t,5,100,null);this.maxSuggestionItems=10;this.suggestionProviderParams="";this.suggestionProviderName="static";return this};UISuggestion.prototype.onInit=function(){this.suggestionProvider=createSuggestionProvider(this.suggestionProviderName,this.suggestionProviderParams);return};UISuggestion.prototype.setSuggestionProvider=function(t){this.suggestionProvider=t;return};UISuggestion.prototype.getSuggestionProvider=function(){return this.suggestionProvider};UISuggestion.prototype.onSuggestionSelected=function(t){};UISuggestion.prototype.showSuggestion=function(t){var e={children:[]};if(t.length>this.maxSuggestionItems){t.length=this.maxSuggestionItems}for(var i=0;i<t.length;i++){var n={children:[]};var r=t[i];n.children.push({text:r});e.children.push(n)}this.bindData(e,null,true);return};UISuggestion.prototype.onSuggestionShow=function(){};UISuggestion.prototype.query=function(t){var e=this;this.suggestionProvider.query(t,function(t){e.showSuggestion(t);e.onSuggestionShow()})};function UISuggestionCreator(){var t=["ui-suggestion","ui-suggestion",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISuggestion;return e.initUISuggestion(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISuggestionCreator);function UIButton(){return}UIButton.prototype=new UIElement;UIButton.prototype.isUIButton=true;UIButton.prototype.initUIButton=function(t,e,i){this.initUIElement(t);this.setMargin(5,5);this.setDefSize(e,i);this.setSizeLimit(50,50);this.setAutoScaleFontSize(true);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setImage(UIElement.IMAGE_FOCUSED,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.setImage(UIElement.IMAGE_POINTER_OVER,null);this.addEventNames(["onUpdateTransform"]);return this};UIButton.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage){return true}return false};UIButton.prototype.paintSelfOnly=function(t){if(this.pointerDown){var e=this.getHtmlImageByType(UIElement.IMAGE_ACTIVE);if(!e){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}}return};function UIButtonCreator(t,e){var i=["ui-button","ui-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIButton;return n.initUIButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIButtonCreator(120,60));function UIMLEdit(){return}UIMLEdit.prototype=new UIElement;UIMLEdit.prototype.isUIMLEdit=true;UIMLEdit.prototype.initUIMLEdit=function(t,e,i,n,r,a,o){this.initUIElement(t);this.setDefSize(e,i);this.setText(r);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,a);this.setImage(UIElement.IMAGE_FOCUSED,o);this.setMargin(n,n);this.addEventNames(["onChanged","onFocusIn","onFocusOut"]);this.setTextAlignV("top");this.setTextAlignH("left");return this};UIMLEdit.prototype.drawText=function(t){if(!this.text||this.editing){return}return this.defaultDrawText(t)};UIMLEdit.prototype.shapeCanBeChild=function(t){return false};UIMLEdit.prototype.textEditable=function(t){return true};UIMLEdit.prototype.onClick=function(t,e){if(e){return}if(this.mode!==Shape.MODE_EDITING){this.editText()}return};UIMLEdit.prototype.getEditorRect=function(){var t=this.getPositionInView();var e=this.view.getAbsPosition();var i=this.view.getViewScale();var n=e.x;var r=e.y;var a=t.x*i+n;var o=t.y*i+r;var s=this.getWidth()*i;var h=this.getHeight()*i;var l={};i=UIElement.getMainCanvasScale();l.x=Math.round(a/i.x);l.y=Math.round(o/i.y);l.w=Math.round(s/i.x);l.h=Math.round(h/i.y);return l};UIMLEdit.prototype.editText=function(t){if(this.textType&&this.textEditable(t)){var e=this;var i=this.getEditorRect();var n=this.getRealScale()/UIElement.getMainCanvasScale().y;var r=this.inputType?this.inputType:"text";var a=this.style.fontSize*n;var o=cantkShowTextArea(this.getText(),a,i.x,i.y,i.w,i.h);e.editing=true;function s(t){if(t!==e.text){e.setText(t,true);e.postRedraw()}else{e.text=t}o.setOnChangedHandler(null);o.setOnChangeHandler(null);o.hide();delete e.editing;e.callOnFocusOutHandler();return}function h(t){e.callOnChangingHandler(t)}o.setOnChangedHandler(s);o.setOnChangeHandler(h);this.callOnFocusInHandler()}return};UIMLEdit.prototype.getTextTipsPosition=function(){var t={};t.x=this.hMargin;t.y=this.vMargin;t.textAlign="left";t.textBaseline="top";return t};function UIMLEditCreator(t,e,i,n,r){var a=["ui-mledit","ui-mledit",null,1];ShapeCreator.apply(this,a);this.createShape=function(a){var o=new UIMLEdit;return o.initUIMLEdit(this.type,t,e,i,dappGetText("Edit"),n,r)};return}ShapeFactoryGet().addShapeCreator(new UIMLEditCreator(300,300,12,null,null));function UIToolBar(){return}UIToolBar.prototype=new UIElement;UIToolBar.prototype.isUIToolBar=true;UIToolBar.prototype.initUIToolBar=function(t,e,i,n){this.initUIElement(t);this.xAttr=UIElement.X_LEFT_IN_PARENT;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.yAttr=e?UIElement.Y_TOP_IN_PARENT:UIElement.Y_BOTTOM_IN_PARENT;this.setDefSize(200,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.setSizeLimit(100,50,2e3,200);return this};UIToolBar.prototype.shapeCanBeChild=function(t){
if(t.isUILabel||t.isUIImage||t.isUIButton||t.isUIGroup||t.isUIButtonGroup||t.isUIEdit||t.isUIImageButton||t.isUICheckBox||t.isUIRadioBox||t.isUIProgressBar||t.isUISwitch||t.isUILedDigits||t.isUIGroup||t.isUILayout||t.isUIWaitBar||t.isUIColorBar){return true}return false};UIToolBar.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};function UIToolBarCreator(t,e,i,n){var r=[t,"ui-toolbar",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var a=new UIToolBar;return a.initUIToolBar(t,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UIToolBarCreator("ui-toolbar",true,85,null));function UIPlaceholder(){return}UIPlaceholder.prototype=new UIElement;UIPlaceholder.prototype.isUIPlaceholder=true;UIPlaceholder.prototype.initUIPlaceholder=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);return this};UIPlaceholder.prototype.shapeCanBeChild=function(t){return false};UIPlaceholder.prototype.paintSelfOnly=function(t){if(this.mode===Shape.MODE_EDITING){var e=this.vMargin;var i=this.hMargin;var n=this.getWidth(true);var r=this.getHeight(true);t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;drawDashedRect(t,e,i,n,r);t.stroke()}return};function UIVPlaceholderCreator(t,e){var i=["ui-v-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIPlaceholder;n.initUIPlaceholder(this.type,t,e);n.widthAttr=UIElement.WIDTH_FILL_PARENT;n.MIN_SIZE=4;n.setSizeLimit(20,4);return n};return}function UIHPlaceholderCreator(t,e){var i=["ui-h-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIPlaceholder;n.initUIPlaceholder(this.type,t,e);n.heightAttr=UIElement.HEIGHT_FILL_PARENT;n.MIN_SIZE=4;n.setSizeLimit(4,20);return n};return}ShapeFactoryGet().addShapeCreator(new UIVPlaceholderCreator(100,20));ShapeFactoryGet().addShapeCreator(new UIHPlaceholderCreator(20,100));function UIRadioBox(){return}UIRadioBox.prototype=new UICheckBox;UIRadioBox.prototype.isUIRadioBox=true;UIRadioBox.prototype.initUIRadioBox=function(t){return this.initUICheckBox(t)};UIRadioBox.prototype.setParent=function(t){this.parentShape=t;if(this.value){this.setChecked()}return this};UIRadioBox.prototype.onFromJsonDone=function(){if(this.value){this.setChecked()}return this};UIRadioBox.prototype.setChecked=function(){var t=this.getParent();if(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIRadioBox){i.setValue(false)}}}this.setValue(true);return this};UIRadioBox.prototype.onClick=function(t,e){if(e){return}this.setChecked();return this.callOnClickHandler(t)};function UIRadioBoxCreator(t,e){var i=["ui-radiobox","ui-radiobox",null,1];ShapeCreator.apply(this,i);this.createShape=function(t){var e=new UIRadioBox;e.initUIRadioBox(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIRadioBoxCreator(50,50,null,null,null,null,null,null));function UILedDigits(){return}UILedDigits.prototype=new UIElement;UILedDigits.prototype.isUILedDigits=true;UILedDigits.prototype.initUILedDigits=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);return this};UILedDigits.prototype.shapeCanBeChild=function(t){return false};UILedDigits.prototype.setText=function(t){this.text="";t=this.toText(t);for(var e=0;e<t.length;e++){var i=t[e];switch(i){case".":case":":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"F":case"F":{this.text=this.text+i}default:break}}return};UILedDigits.prototype.drawBarVL=function(t,e,i){t.beginPath();t.moveTo(0,0);t.lineTo(0,i);t.lineTo(e,i-e);t.lineTo(e,e);t.lineTo(0,0);return};UILedDigits.prototype.drawBarVR=function(t,e,i){t.beginPath();t.moveTo(e,0);t.lineTo(e,i);t.lineTo(0,i-e);t.lineTo(0,e);t.lineTo(e,0);return};UILedDigits.prototype.drawBarHT=function(t,e,i){t.beginPath();t.moveTo(0,0);t.lineTo(e,0);t.lineTo(e-i,i);t.lineTo(i,i);t.lineTo(0,0);return};UILedDigits.prototype.drawBarHM=function(t,e,i){t.beginPath();var n=Math.round(i/3);e=e-2*n;t.translate(n,0);t.moveTo(0,i/2);t.lineTo(i/2,0);t.lineTo(e-i/2,0);t.lineTo(e,i/2);t.lineTo(e-i/2,i);t.lineTo(i/2,i);t.lineTo(0,i/2);t.translate(-n,0);return};UILedDigits.prototype.drawBarHB=function(t,e,i){t.beginPath();t.moveTo(0,i);t.lineTo(e,i);t.lineTo(e-i,0);t.lineTo(i,0);t.lineTo(0,i);return};UILedDigits.prototype.drawBar=function(t,e,i){if(e<i){this.drawBarV(t,e,i)}else{this.drawBarH(t,e,i)}return};UILedDigits.prototype.drawDot=function(t,e,i,n){var r=(e/4+i/8)/2;if(n==="."){t.fillRect((e-r)/2,.75*i-r/2,r,r)}else if(n=":"){t.fillRect((e-r)/2,.25*i-r/2,r,r);t.fillRect((e-r)/2,.75*i-r/2,r,r)}return};UILedDigits.prototype.map={0:125,1:96,2:55,3:103,4:106,5:79,6:95,7:97,8:127,9:111,E:31,F:27,H:122};UILedDigits.prototype.fillBar=function(t,e){if(e){t.fillStyle=this.style.textColor;t.fill()}else{t.lineWidth=1;t.strokeStyle=this.style.lineColor;t.stroke()}return};UILedDigits.prototype.drawDigit=function(t,e,i,n){var r=Math.max(3,Math.round(i/10));var a=Math.max(3,Math.round(e/10));var o=Math.round((a+r)/2);var s=1;var h=e-2*s;var l=Math.floor(i/2-2*s);var u=this.map[n];t.translate(s,0);this.drawBarHT(t,h,o);t.translate(-s,0);this.fillBar(t,u&1);var c=Math.floor((i-r)/2);t.translate(s,c);this.drawBarHM(t,h,o);t.translate(-s,-c);this.fillBar(t,u>>1&1);var c=i-r;t.translate(s,c);this.drawBarHB(t,h,o);t.translate(-s,-c);this.fillBar(t,u>>2&1);t.translate(0,s);this.drawBarVL(t,o,l);t.translate(0,-s);this.fillBar(t,u>>3&1);var c=Math.round(2*s+(i-r)/2)+s;t.translate(0,c);this.drawBarVL(t,o,l);t.translate(0,-c);this.fillBar(t,u>>4&1);t.translate(e-o,s);this.drawBarVR(t,o,l);t.translate(-(e-o),-s);this.fillBar(t,u>>5&1);t.translate(e-o,c);this.drawBarVR(t,o,l);t.translate(-(e-o),-c);this.fillBar(t,u>>6&1);return};UILedDigits.prototype.drawDigits=function(t){var e=0;var i=this.text;var n=i.length;if(!n){return}for(var r=0;r<n;r++){var a=i[r];if(a==="."||a===":"){e=e+1}}var o=this.w/n*.2;var s=this.w/n-o;var h=this.h;t.save();t.translate(s/4*e,0);for(var r=0;r<n;r++){var a=i[r];if(a==="."||a===":"){this.drawDot(t,s/2,h,i[r]);t.translate(s/2+o,0)}else{this.drawDigit(t,s,h,i[r]);t.translate(s+o,0)}}t.restore();return};UILedDigits.prototype.paintSelfOnly=function(t){if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}t.fillStyle=this.style.lineColor;this.drawDigits(t);return};function UILedDigitsCreator(t,e){var i=["ui-led-digits","ui-led-digits",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UILedDigits;return n.initUILedDigits(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UILedDigitsCreator(100,100));function UIDevice(){return}UIDevice.PORTRAIT=0;UIDevice.LANDSCAPE=1;UIDevice.prototype=new UIElement;UIDevice.prototype.isUIDevice=true;UIDevice.prototype.deviceToJson=function(t){t.config=this.config;return};UIDevice.prototype.deviceFromJson=function(t){if(t.config){this.config=dupDeviceConfig(t.config)}return};UIDevice.prototype.resize=function(t,e){if(this.state===Shape.STAT_NORMAL){this.realResize(t,e)}return};UIDevice.prototype.getDirection=function(){return this.h>this.w?UIDevice.PORTRAIT:UIDevice.LANDSCAPE};UIDevice.prototype.setDirection=function(t){var e=this.getDirection();if(t===e){return}var i=JSON.stringify(this.toJson());var n=this.w;var r=this.h;var a=(r-n)/2;this.x=this.x-a;this.y=this.y+a;var o=0;var s=0;var h=this.config.screenW;var l=this.config.screenH;if(e===UIDevice.PORTRAIT){this.y=100;o=this.config.screenY;s=n-(this.config.screenX+this.config.screenW)}else{this.y=0;s=this.config.screenX;o=r-(this.config.screenY+this.config.screenH)}this.w=r;this.h=n;this.config.screenX=o;this.config.screenY=s;this.config.screenW=l;this.config.screenH=h;var u=JSON.stringify(this.toJson());this.exec(new PropertyCommand(this,i,u));return};UIDevice.prototype.setName=function(t){this.name=t;this.loadConfig();return};UIDevice.prototype.beforePropertyChanged=function(){this.oldConfig=dupDeviceConfig(this.config);return};UIDevice.prototype.afterPropertyChanged=function(){if(!isDeviceConfigEqual(this.oldConfig,this.config)){this.notifyDeviceConfigChanged(this.oldConfig,this.config)}this.relayout();return};UIDevice.prototype.onDeviceConfigChanged=function(t,e){this.relayoutChildren();return};UIDevice.prototype.loadConfig=function(){var t=cantkGetDeviceConfig(this.name);if(!t){t=cantkGetDeviceConfig("iphone5")}if(t){this.config=t}return};UIDevice.prototype.initUIDevice=function(t,e,i,n,r){this.initUIElement(t);this.setDefSize(e,i);this.setName(n);this.loadConfig();this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,r);this.setUserResizable(false);this.rectSelectable=false;this.regSerializer(this.deviceToJson,this.deviceFromJson);this.events={};return this};UIDevice.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(e){var i=this.h/this.w;var n=e.height/e.width;if(i<=1&&n<=1||i>=1&&n>=1){this.drawImageAt(t,e,this.images.display,0,0,this.w,this.h)}else{t.save();t.translate(this.h/2,this.h/2);t.rotate(-Math.PI/2);t.translate(-this.h/2,-this.h/2);this.drawImageAt(t,e,this.images.display,0,0,this.h,this.w);t.restore()}}return};UIDevice.prototype.getScreen=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUIScreen){return e}}return null};UIDevice.prototype.enterPreview=function(t){var e=this.getApp();var i=this.getScreen();var n=this.getWindowManager();if(!n||!i||!e){return}if(n.mode!=Shape.MODE_EDITING){return}var r=n.getCurrent();e.saveTemp();e.clearCommandHistory();var a=this.findChildByName("button-preview",false);if(a){a.setText(dappGetText("Edit"))}n.saveState();this.setMode(Shape.MODE_PREVIEW);i.setMode(Shape.MODE_PREVIEW,true);ResLoader.reset();e.loadUserScripts();n.systemInit();n.setInitWindow(null);if(t){n.setInitWindow(r)}return};UIDevice.prototype.exitPreview=function(){var t=this.getScreen();var e=this.getWindowManager();if(!e||!t||!this.app){return}if(e.mode!=Shape.MODE_PREVIEW){return}var i=this.findChildByName("button-preview",false);if(i){i.setText(dappGetText("Preview"))}if(this.app){this.app.clearCommandHistory()}e.systemExit();this.setMode(Shape.MODE_EDITING);t.setMode(Shape.MODE_EDITING,true);e.restoreState();e.clearState();this.setSelected(true);UIElement.timeScale=1;return};UIDevice.prototype.shapeCanBeChild=function(t){if(t.isUIDevice){var e=t.toJson();e.x=this.x;e.y=this.y;this.fromJson(e);this.relayoutChildren();if(this.app){this.app.clearCommandHistory()}return false}return t.isUIScreen&&this.getScreen()===null};UIDevice.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=0;var e=0;var i=0;var n=0;var r=this;for(var a=0;a<this.children.length;a++){var o=this.children[a];if(o.isUIScreen){t=this.config.screenX;e=this.config.screenY;i=this.config.screenW;n=this.config.screenH;o.widthAttr=UIElement.WIDTH_FIX;o.heightAttr=UIElement.HEIGHT_FIX;o.setPosition(t,e);o.setSize(i,n);o.relayout()}if(o.isUIButton){o.setMode(Shape.MODE_RUNNING);if(this.config.screenW>400){o.x=this.config.screenX;o.w=this.config.screenW/4}else{o.x=20;o.w=(this.w-40)/4}o.style.setFontSize(o.w<100?10:16);e=this.config.screenY-o.h-5;if(e<0){e+=10}if(o.name==="button-prev"){t=o.x;o.setText(dappGetText("Prev Window"));o.onClick=function(t,e){if(e){return}var i=r.getWindowManager();if(i.mode===Shape.MODE_PREVIEW){r.exitPreview()}if(i){i.showPrevFrame()}return}}if(o.name==="button-next"){t=o.x+o.w;o.setText(dappGetText("Next Window"));o.onClick=function(t,e){if(e){return}var i=r.getWindowManager();if(i.mode===Shape.MODE_PREVIEW){r.exitPreview()}if(i){i.showNextFrame()}return}}if(o.name==="button-direction"){var s=r.getDirection();var h=s===UIDevice.PORTRAIT?"Landscape":"Portrait";t=o.x+o.w*2;o.setText(dappGetText(h));o.onClick=function(t,e){if(e){return}var i=r.getWindowManager();if(i.mode===Shape.MODE_PREVIEW){r.exitPreview()}var n=r.getDirection();if(n===UIDevice.PORTRAIT){h="Portrait";r.setDirection(UIDevice.LANDSCAPE)}else{h="Landscape";r.setDirection(UIDevice.PORTRAIT)}this.setText(dappGetText(h));return}}if(o.name==="button-preview"){o.isInPreviewMode=false;t=o.x+o.w*3;o.setText(dappGetText("Preview"));o.onClick=function(t,e){if(e){return}this.isInPreviewMode=!this.isInPreviewMode;this.getApp().setPreviewMode(this.isInPreviewMode);if(this.isInPreviewMode){r.enterPreview()}else{r.exitPreview()}return}}if(o.name==="button-status"){o.h=40;o.w=this.config.screenW/2;o.style.setFontSize(o.w<100?12:18);e=this.config.screenY-2*o.h-10;t=this.config.screenX+(this.config.screenW-o.w)/2;this.statusButton=o;this.statusButton.getLocaleText=function(){var t=r.getWindowManager();return t?t.getStatusString():""}}o.setMode=function(t,e){this.mode=Shape.MODE_RUNNING}}o.setPosition(t,e);o.setUserMovable(false);o.setUserResizable(false)}return true};UIDevice.prototype.afterSetView=function(){this.relayoutChildren();return};UIDevice.prototype.getWindowManager=function(){var t=this.getScreen();return t?t.getWindowManager():null};UIDevice.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();drawRoundRect(t,this.w,this.h,40);t.fill();t.stroke()}return};UIDevice.prototype.onKeyDownRunning=function(t){var e=this.getWindowManager();return e.onKeyDownRunning(t)};UIDevice.prototype.onKeyUpRunning=function(t){var e=this.getWindowManager();if(t==KeyEvent.DOM_VK_P){this.snapIt()}return e.onKeyUpRunning(t)};UIDevice.prototype.snapIt=function(){var t=null;var e=cantkGetQueryParam("snap-device");var i=cantkGetQueryParam("snap-screen");if(e){t=this}if(i){t=this.getWindowManager()}if(!t){return}var n=null;n=cantkGetQueryParam("width");var r=n?parseInt(n):t.w;n=cantkGetQueryParam("height");var a=n?parseInt(n):t.h;var o=cantkGetTempCanvas(r,a);var s=o.getContext("2d");var h=r/t.w;var l=a/t.h;s.save();s.scale(h,l);s.translate(-t.x,-t.y);t.paint(s);s.restore();window.open(o.toDataURL(),"_blank");return};function UIDeviceCreator(t,e,i,n){var r=["ui-device","ui-device",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var a=new UIDevice;a.initUIDevice(this.type,i,n,t+e,null);return a};return}ShapeFactoryGet().addShapeCreator(new UIDeviceCreator("android","",420,700));function UICanvas(){return}UICanvas.prototype=new UIElement;UICanvas.prototype.isUICanvas=true;UICanvas.prototype.initUICanvas=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.addEventNames(["onPaint","onPointerDown","onPointerMove","onPointerUp","onKeyDown","onKeyUp","onLongPress","onDoubleClick"]);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UICanvas.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUIButton||t.isUIGroup||t.isUILabel};UICanvas.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}t.beginPath();this.callOnPaintHandler(t);return};function UICanvasCreator(t,e){var i=["ui-canvas","ui-canvas",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UICanvas;return n.initUICanvas(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UICanvasCreator(200,200));function UIColorButton(){return}UIColorButton.prototype=new UIElement;UIColorButton.prototype.isUIButton=true;UIColorButton.prototype.isUIColorButton=true;UIColorButton.prototype.initUIColorTile=function(t,e,i){this.initUIColorButton(t,e,i);this.isUIButton=false;this.isUIColorButton=false;this.isUIColorTile=true;this.setAutoScaleFontSize(true);this.addEventNames(["onUpdateTransform"]);this.roundStyle="a";return this};UIColorButton.prototype.initUIColorButton=function(t,e,i){this.initUIElement(t);this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_INPUT);this.setCanRectSelectable(false,false);this.setMargin(8,8);this.addEventNames(["onUpdateTransform"]);return this};UIColorButton.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIColorButton.prototype.getRoundStyle=function(){var t=this.roundStyle;if(t==="t"){return RoundRect.TL|RoundRect.TR}else if(t==="l"){return RoundRect.TL|RoundRect.BL}else if(t==="r"){return RoundRect.TR|RoundRect.BR}else if(t==="b"){return RoundRect.BL|RoundRect.BR}else{return RoundRect.TL|RoundRect.TR|RoundRect.BL|RoundRect.BR}};UIColorButton.prototype.paintSelfOnly=function(t){var e=this.getRoundStyle();var i=this.style.fillColor;var n=this.style.lineColor;if(this.pointerDown&&this.style.activeFillColor){i=this.style.activeFillColor}var r=!Shape.isTransparentColor(i);var a=!Shape.isTransparentColor(n);if(!r&&!a){return}t.save();t.beginPath();t.translate(this.hMargin,this.vMargin);drawRoundRect(t,this.w-2*this.hMargin,this.h-2*this.vMargin,this.roundRadius,e);if(r){t.fillStyle=i;t.fill()}if(a){if(this.isUIColorButton&&this.pointerDown){t.lineWidth=this.style.lineWidth+1}else{t.lineWidth=this.style.lineWidth}t.strokeStyle=n;t.stroke()}t.restore();return};function UIColorTileCreator(t,e){var i=["ui-color-tile","ui-color-tile",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorButton;return n.initUIColorTile(this.type,t,e)};return}function UIColorButtonCreator(t,e){var i=["ui-color-button","ui-color-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorButton;return n.initUIColorButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIColorTileCreator(80,80));ShapeFactoryGet().addShapeCreator(new UIColorButtonCreator(80,80));function UIViewPager(){return}UIViewPager.prototype=new UIPageManager;UIViewPager.prototype.isUIViewPager=true;UIViewPager.prototype.initUIViewPager=function(t){this.initUIPageManager(t);this.current=0;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.velocityTracker=new VelocityTracker;return this};UIViewPager.prototype.getFrameIndicatorParams=function(){var t=this.children.length;var e=Math.min(.5*this.w/t,40);var i=e*t;var n=(this.w-i)/2;var r=.8*this.h;return{offsetX:n,offsetY:r,itemSize:e,n:t}};UIViewPager.prototype.onClick=function(t,e){if(e||this.animating){return}if(!this.needShowIndicator()){return}var i=this.getFrameIndicatorParams();var n=t.x;var r=t.y;var a=i.n;var o=i.offsetX;var s=i.offsetY;var h=i.itemSize;if(r<s||r>s+h||n<o||n>o+a*h){return}for(var l=0;l<a;l++){if(n>o&&n<o+h){this.setCurrent(l);break}o+=h}return};UIViewPager.prototype.drawFrameIndicator=function(t,e){var i=this.getFrameIndicatorParams();var n=i.n;var r=i.offsetX;var a=i.offsetY;var o=i.itemSize;r+=o/2;a+=o/2;var s=15;t.fillStyle=this.style.fillColor;for(var h=0;h<n;h++){t.beginPath();t.arc(r,a,s,0,Math.PI*2);r+=o;if(h===e){t.save();t.shadowColor=this.style.lineColor;t.shadowBlur=5;t.shadowOffsetX=0;t.shadowOffsetY=0;t.fill();t.stroke();t.restore()}else{t.fill()}}return};UIViewPager.prototype.needShowIndicator=function(){if(this.pageIndicator){return false}if(this.mode===Shape.MODE_EDITING||this.showIndicator){return true}return false};UIViewPager.prototype.afterPaintChildren=function(t){if(this.needShowIndicator()){this.drawFrameIndicator(t,this.current)}return};UIViewPager.prototype.getPrevFrame=function(){var t=this.children.length;var e=(this.current-1+t)%t;return this.children[e]};UIViewPager.prototype.getNextFrame=function(){var t=this.children.length;var e=(this.current+1)%t;return this.children[e]};UIViewPager.prototype.animScrollTo=function(t,e){var i=1e3;var n=this;var r=this.offset;var a=(new Date).getTime();var o=new DecelerateInterpolator(2);if(n.animating){return}n.animating=true;function s(){var h=new Date;var l=(h.getTime()-a)/i;var u=o.get(l);if(l<1){n.offset=r+t*u;setTimeout(s,10)}else{n.offset=0;n.setCurrent(e);delete a;delete o;delete n.animating}delete h;n.postRedraw()}s();return};UIViewPager.prototype.onPointerDownRunning=function(t,e){if(e||this.animating||!this.slideToChange){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.velocityTracker.clear();return true};UIViewPager.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;return t&UIElement.EVENT_HSCROLL_HANDLED};UIViewPager.prototype.setEventHandled=function(){this.setLastEventStatus(UIElement.EVENT_HSCROLL_HANDLED);return this};UIViewPager.prototype.onPointerMoveRunning=function(t,e){if(!this.slideToChange||e||!this.pointerDown){return}if(this.animating){this.setEventHandled();return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.current;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var r=Math.abs(this.getMoveAbsDeltaX());var a=Math.abs(this.getMoveAbsDeltaY());if(r>a&&r>10){this.offset=this.getMoveAbsDeltaX()}else{this.offset=0}this.addMovementForVelocityTracker();return};UIViewPager.prototype.onPointerUpRunning=function(t,e){if(!this.slideToChange||e||!this.pointerDown){return}if(this.animating){this.setEventHandled();return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.current;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var a=0;var o=this.offset;var s=this.current;var h=Math.abs(this.getMoveAbsDeltaY());var l=this.velocityTracker.getVelocity().x;if(Math.abs(o)<5||h>60){this.offset=0;return}var u=this.children.length;var c=o+l;if(Math.abs(c)>this.w/3){if(o>0){a=this.w-o;s=(this.current-1+u)%u}else{a=-this.w-o;s=(this.current+1)%u}}else{a=-o}this.animScrollTo(a,s);return};UIViewPager.prototype.paintChildrenAnimating=function(t){var e=this.getCurrentFrame();var i=this.getPrevFrame();var n=this.getNextFrame();t.save();t.rect(0,0,this.w,this.h);t.clip();if(this.offset>0){var r=this.w-this.offset;i.x=-r;i.paintSelf(t);r=this.offset;e.x=r;e.paintSelf(t)}else{e.x=this.offset;e.paintSelf(t);n.x=this.w+this.offset;n.paintSelf(t)}e.x=0;n.x=0;i.x=0;t.restore();return};UIViewPager.prototype.paintChildrenNormal=function(t){var e=this.getCurrentFrame();if(e){t.save();t.beginPath();e.paintSelf(t);t.restore()}return};UIViewPager.prototype.paintChildren=function(t){if(this.offset&&this.children.length>1){this.paintChildrenAnimating(t)}else{this.paintChildrenNormal(t)}return};UIViewPager.prototype.setSlideToChange=function(t){this.slideToChange=t;return};UIViewPager.prototype.setShowIndicator=function(t){this.showIndicator=t;return};UIViewPager.prototype.onModeChanged=function(){this.setCurrent(0);return};function UIViewPagerCreator(){var t=["ui-view-pager","ui-view-pager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIViewPager;return e.initUIViewPager(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIViewPagerCreator);function UISlidingMenu(){return}UISlidingMenu.prototype=new UIElement;UISlidingMenu.prototype.isUISlidingMenu=true;UISlidingMenu.prototype.initUISlidingMenu=function(t,e,i){this.initUIElement(t);this.offset=0;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setCanRectSelectable(false,false);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UISlidingMenu.prototype.onAppendedInParent=function(){var t=this.getMenu();if(!t){return}if(this.offset){this.setOffset(t.w)}else{this.setOffset(0)}return};UISlidingMenu.prototype.shapeCanBeChild=function(t){return t.isUIPage&&this.children.length<2};UISlidingMenu.prototype.afterChildAppended=function(t){t.setUserMovable(false);if(this.children.length>1&&this.mode==Shape.MODE_EDITING){var e=this.getMenu();this.setOffset(e.w)}return};UISlidingMenu.prototype.onDoubleClick=function(t,e){if(e||this.mode!=Shape.MODE_EDITING){return}if(this.offset){this.hideMenu()}else{this.showMenu()}return};UISlidingMenu.prototype.getMenu=function(){if(this.children.length>0){return this.children[0]}return null};UISlidingMenu.prototype.getContent=function(){if(this.children.length>1){return this.children[1]}return null};UISlidingMenu.prototype.showMenu=function(){var t=this.getMenu();if(t){this.scrollTo(t.w)}return};UISlidingMenu.prototype.hideMenu=function(){var t=this.getMenu();if(t){this.scrollTo(0)}return};UISlidingMenu.prototype.relayoutChildren=function(){var t=null;var e=null;var i=this.children.length;if(!i){return}if(i===1){t=this.children[0];t.y=0;t.x=0;t.h=this.h;t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_SCALE;t.heightAttr=UIElement.HEIGHT_FILL_PARENT;t.relayout();return}else{t=this.children[0];e=this.children[1];var n=t.w;t.y=0;t.h=this.h;t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_SCALE;t.heightAttr=UIElement.HEIGHT_FILL_PARENT;t.relayout();if(n===this.offset){this.offset=t.w}var r=this.offset/t.w;t.x=-Math.round(.5*((1-r)*t.w));e.y=0;e.x=this.offset;e.h=this.h;e.w=this.w;e.xAttr=UIElement.X_FIX_LEFT;e.widthAttr=UIElement.WIDTH_FIX;e.heightAttr=UIElement.HEIGHT_FILL_PARENT;t.relayoutChildren();e.relayoutChildren()}return};UISlidingMenu.prototype.getMinOffset=function(){return 0};UISlidingMenu.prototype.getMaxOffset=function(){var t=this.getMenu();return t?t.w:0};UISlidingMenu.prototype.scrollTo=function(t){var e=this;var i=500;var n=this.offset;var r=t-n;var a=(new Date).getTime();var o=new DecelerateInterpolator;this.animating=true;function s(){var t=new Date;var h=(t.getTime()-a)/i;var l=o.get(h);if(h<1){e.setOffset(Math.floor(n+l*r));setTimeout(s,10)}else{e.setOffset(n+r);delete a;delete o;delete e.animating}delete t}setTimeout(function(){s()},10);return};UISlidingMenu.prototype.setOffset=function(t){var e=this.getMenu();this.offset=t;if(e){if(this.offset<0){this.offset=0}if(this.offset>e.w){this.offset=e.w}}this.relayoutChildren();this.postRedraw();return};UISlidingMenu.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;return t&UIElement.EVENT_HSCROLL_HANDLED};UISlidingMenu.prototype.setEventHandled=function(){this.setLastEventStatus(UIElement.EVENT_HSCROLL_HANDLED);return this};UISlidingMenu.prototype.onPointerDownRunning=function(t,e){if(e||this.animating){return}if(this.isEventHandledByChild()){return}this.setEventHandled();if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();this.saveOffset=this.offset;return true};UISlidingMenu.prototype.onPointerMoveRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.addMovementForVelocityTracker();var i=this.getMoveAbsDeltaX();var n=this.getMoveAbsDeltaY();if(Math.abs(i)>Math.abs(n)){this.setOffset(this.saveOffset+i)}return};UISlidingMenu.prototype.onPointerUpRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();var i=this.getMoveAbsDeltaX();var n=this.getMoveAbsDeltaY();if(Math.abs(i)<Math.abs(n)){return}var r=this.velocityTracker.getVelocity().x;var a=i+r/2;if(Math.abs(a)<10){var o=this.getMenu();if(this.offset>10&&o&&t.x>o.x+o.w){this.hideMenu()}else{this.setOffset(this.saveOffset)}return}var s=this.getMinOffset();var h=this.getMaxOffset();var l=this.saveOffset+i+r;if(l<s){l=s}if(l>h){l=h}if(this.saveOffset>(s+h)/2){if(l<=s){l=s}else{l=h}}else{if(l>=h){l=h}else{l=s}}this.scrollTo(l);return};UISlidingMenu.prototype.onInit=function(){if(this.offset){var t=this.getMenu();if(t){this.setOffset(t.w)}}else{this.setOffset(0)}return};UISlidingMenu.prototype.dispatchPointerDownToChildren=function(t){var e=this.getMenu();var i=this.getContent();var n=this.offset?e:i;if(e&&i&&e.x==i.x&&e.x==0){this.setOffset(0)}if(n&&n.visible&&n.onPointerDown(t)){this.setTarget(n);return true}return false};UISlidingMenu.prototype.paintChildren=function(t){t.save();t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();this.defaultPaintChildren(t);t.restore();return};function UISlidingMenuCreator(){var t=["ui-sliding-menu","ui-sliding-menu",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISlidingMenu;return e.initUISlidingMenu(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISlidingMenuCreator);function UIProgressBar(){return}UIProgressBar.prototype=new UIElement;UIProgressBar.prototype.isUIProgressBar=true;UIProgressBar.prototype.initUIProgressBar=function(t,e,i,n){this.initUIElement(t);this.setPercent(50);this.setDefSize(e,i);this.roundRadius=0;this.setInteractive(n);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_NORMAL_FG,null);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;if(n){this.addEventNames(["onChanged"]);this.addEventNames(["onChanging"])}return this};UIProgressBar.prototype.shapeCanBeChild=function(t){if(this.dragger){return false}return t.isUIImage||t.isUILabel||t.isUIColorTile};UIProgressBar.prototype.updateDraggerParams=function(){var t=this.dragger;if(!t)return;if(this.w<this.h){t.yAttr=UIElement.Y_FIX_TOP;t.xAttr=UIElement.X_CENTER_IN_PARENT;t.widthAttr=UIElement.WIDTH_FILL_PARENT;t.heightAttr=UIElement.HEIGHT_FIX}else{t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;t.xAttr=UIElement.X_FIX_LEFT;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FILL_PARENT}};UIProgressBar.prototype.relayoutChildren=function(){if(!this.dragger){return}if(this.w>this.h){var t=this.value*this.w;this.dragger.x=Math.min(t,this.w-this.dragger.w)}else{var e=(1-this.value)*this.h;this.dragger.y=Math.min(e,this.h-this.dragger.h)}UIElement.prototype.relayoutChildren.call(this);return};UIProgressBar.prototype.resizeDragger=function(){if(this.dragger){var t=this.dragger.w;var e=this.dragger.h;if(this.w>this.h){e=this.h;t=Math.min(this.h,t)}else{t=this.w;e=Math.min(this.w,e)}this.dragger.setSize(t,e)}return this};UIProgressBar.prototype.afterChildAppended=function(t){var e=this;this.dragger=t;this.updateDraggerParams();this.setTextType(Shape.TEXT_NONE);t.setTextType(Shape.TEXT_NONE);e.onPointerMoveRunning=function(t,e){if(e){return}if(this.pointerDown&&this.dragger){var i=Math.min(Math.max(0,t.x),this.w-this.dragger.w);var n=Math.min(Math.max(0,t.y),this.h-this.dragger.h);this.dragger.move(i,n)}return};e.onPointerUpRunning=function(t,e){if(e){return}if(this.changed){this.changed=false;this.callOnChangedHandler(this.getValue())}return};e.onSized=function(){var t=Math.min(this.w,this.h);this.updateLayoutParams();this.setPercent(this.getPercent());this.resizeDragger();this.updateDraggerParams();return};t.onSized=function(){e.resizeDragger()};t.onMoved=function(){var t=0;if(e.w>e.h){var i=(this.x+(this.w>>1))/e.w;t=i*100;if(this.x<=0){t=0}if(this.x+this.w>=e.w){t=100}}else{var i=(e.h-(this.y+(this.h>>1)))/e.h;t=i*100;if(this.y<=0){t=100}if(this.y+this.h>=e.h){t=0}}e.changed=true;e.setPercentOnly(t);e.callOnChangingHandler(e.getValue());return};return};UIProgressBar.prototype.setInteractive=function(t){this.interactive=t;return this};UIProgressBar.prototype.setPercentOnly=function(t,e,i){var n=t%101/100;if(!i){this.value=n;this.relayoutChildren()}if(this.mode===Shape.MODE_EDITING||!this.isVisible()){return this}if(!i){if(e){this.callOnChangedHandler(this.getValue())}}else{if(this.value==n)return this;this.setupAnimation({notify:e,valueStart:this.value,valueEnd:n})}return this};UIProgressBar.prototype.setupAnimation=function(t){var e=this;var i={duration:300,actionWhenBusy:"replace",
onStep:function(t,i,n){e.value=n.value;e.relayoutChildren();return true},onDone:function(i,n){e.value=t.valueEnd;if(t.notify){e.callOnChangedHandler(e.getValue())}}};if(!t){t=i}else{var n=Object.keys(i);for(var r=0,a=n.length;r<a;r++){var o=n[r];if(!t[o]){t[o]=i[o]}}}this.animate(t);return this};UIProgressBar.prototype.setPercent=function(t,e,i){t=Math.max(0,Math.min(t,100));this.setPercentOnly(t,e,i);this.relayoutChildren();return this};UIProgressBar.prototype.getPercent=function(){return this.value*100};UIProgressBar.prototype.getValue=function(){return this.getPercent()};UIProgressBar.prototype.setValue=function(t,e,i){this.setPercent(t,e,i);return this};UIProgressBar.prototype.drawText=function(t){var e=Math.round(this.getPercent())+"%";if(!this.isTextColorTransparent()){t.font=this.style.getFont();t.fillStyle=this.getTextColor();t.textBaseline="middle";t.textAlign="center";t.fillText(e,this.w>>1,this.h>>1)}return};UIProgressBar.prototype.paintSelfOnly=function(t){};UIProgressBar.prototype.drawBgImageV=function(t){var e=null;var i=this.w>>1;var n=this.w-i>>1;var r=this.roundRadius?this.roundRadius:0;var a=this.getImageByType(UIElement.IMAGE_DEFAULT);if(a&&a.getImage()){var o=a.getImageRect();e=a.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,o)}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,n,0,i,this.h,o)}}else{t.beginPath();t.translate(n,0);drawRoundRect(t,i,this.h,r);t.translate(-n,0);t.fillStyle=this.style.fillColor;t.fill()}a=this.getImageByType(UIElement.IMAGE_NORMAL_FG);var s=Math.round(this.h*this.value);var h=this.h-s;if(a&&a.getImage()){var o=a.getImageRect();e=a.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){var l=o.h;var u=o.y;var c=o.rh;var p=Math.round(l*this.value);o.h=p;o.y=o.y+l-p;o.h=p;o.rh=Math.round(c*this.value);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,h,this.w,s,o);o.y=u;o.h=l;o.rh=c}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,n,h,i,s,o)}}else{if(s>2*r){t.beginPath();t.translate(n,h);drawRoundRect(t,i,s,r);t.fillStyle=this.style.lineColor;t.fill()}}return};UIProgressBar.prototype.drawBgImageH=function(t){var e=null;var i=this.h>>1;var n=this.h-i>>1;var r=this.roundRadius?this.roundRadius:0;var a=this.getImageByType(UIElement.IMAGE_DEFAULT);if(a&&a.getImage()){var o=a.getImageRect();e=a.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,o)}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,0,n,this.w,i,o)}}else{t.beginPath();t.translate(0,n);drawRoundRect(t,this.w,i,r);t.translate(0,-n);t.fillStyle=this.style.fillColor;t.fill()}var s=Math.round(this.w*this.value);var a=this.getImageByType(UIElement.IMAGE_NORMAL_FG);if(a&&a.getImage()){var o=a.getImageRect();e=a.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){var h=o.w;var l=o.rw;o.w=Math.round(o.w*this.value);o.rw=Math.round(o.rw*this.value);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,s,this.h,o);o.w=h;o.rw=l}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,0,n,s,i,o)}}else{if(s>2*r){t.beginPath();t.translate(0,n);drawRoundRect(t,s,i,r);t.fillStyle=this.style.lineColor;t.fill()}}return};UIProgressBar.prototype.drawCircle=function(t){var e=this.w>>1;var i=this.h>>1;var n=Math.min(e,i);var r=Math.PI*2*this.value-.5*Math.PI;var a=Math.min(n,Math.max(this.style.lineWidth,5));if(!this.isFillColorTransparent()){t.beginPath();t.arc(e,i,n,0,Math.PI*2);t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){n=n-(a>>1);t.beginPath();t.lineCap="round";t.lineWidth=a;t.arc(e,i,n,-Math.PI*.5,r);t.strokeStyle=this.style.lineColor;t.stroke()}return};UIProgressBar.prototype.drawBgImage=function(t){t.save();if(Math.abs(this.w-this.h)<10){this.drawCircle(t)}else if(this.w>this.h){this.drawBgImageH(t)}else{this.drawBgImageV(t)}t.restore()};UIProgressBar.prototype.onFromJsonDone=function(){this.setPercent(this.getPercent());return};function UIProgressBarCreator(t,e,i){var n=i?"ui-slider":"ui-progressbar";var r=[n,"ui-progressbar",null,1];ShapeCreator.apply(this,r);this.createShape=function(n){var r=new UIProgressBar;return r.initUIProgressBar(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIProgressBarCreator(200,45,false));ShapeFactoryGet().addShapeCreator(new UIProgressBarCreator(200,45,true));function UIWindowManager(){}UIWindowManager.prototype=new UIFrames;UIWindowManager.prototype.isUIWindowManager=true;UIWindowManager.prototype.initUIWindowManager=function(t){this.settings={};this.initUIFrames(t);this.history=new Array;this.showLoadingProgress=true;this.setImage("force-landscape-tips",null);this.setImage("force-portrait-tips",null);this.soundMusicAutoPlay=true;this.setSoundEffectsEnable(true);this.setImage("loading-ui-logo",null);this.setImage("loading-ui-progress-bg",null);this.setImage("loading-ui-progress-fg",null);this.logoImage=ResLoader.loadImage(CanTK.config.logoImageSrc);this.progressBarBgImage=ResLoader.loadImage(CanTK.config.progressBarBgSrc);this.progressBarFgImage=ResLoader.loadImage(CanTK.config.progressBarFgSrc);return this};UIWindowManager.prototype.getEventNames=function(){return["onSystemInit"]};UIWindowManager.prototype.onFromJsonDone=function(){this.designWidth=this.w;this.designHeight=this.h;this.forcePortrait=false;this.forceLandscape=false;return};UIWindowManager.prototype.beforeAddShapeIntoChildren=function(t){return!t.isUIWindow};UIWindowManager.prototype.initDefaultNameForChild=function(t){t.name="newwin";return};UIWindowManager.prototype.getSplashWindow=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUILoadingWindow)continue;if(e.isUINormalWindow&&e.windowType==="splash"){return e}}return null};UIWindowManager.prototype.getMainWindow=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUILoadingWindow)continue;if(e.isUINormalWindow&&e.windowType==="main"){return e}}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUILoadingWindow)continue;if(e.isUINormalWindow){return e}}return null};UIWindowManager.prototype.getWindowNames=function(){var t=[];for(var e=0;e<this.children.length;e++){var i=this.children[e];t.push(i.name)}return t};UIWindowManager.prototype.setInitWindow=function(t){if(t===null||t===undefined){this.initWindowIndex=null}else{this.initWindowIndex=Math.max(0,Math.min(t,this.children.length-1))}return this};UIWindowManager.prototype.showInitWindow=function(){var t=null;if(this.children.length===0){return false}this.history.clear();if(this.initWindowIndex||this.initWindowIndex===0){t=this.children[this.initWindowIndex]}var e=cantkGetQueryParam("initwin");if(e){t=this.findBestFitWindowByName(e)}if(!t){t=this.getSplashWindow();if(!t){t=this.getMainWindow()}}if(t){this.targetShape=t;console.log("showInitWindow: set targetShape:"+this.targetShape.name);t.prepareForOpen();index=this.getFrameIndex(t);this.showFrame(index);t.callOnBeforeOpen();t.callOnOpen();this.history.push(index);this.postRedraw()}return true};UIWindowManager.prototype.callOnLoad=function(){this.resLoadDone=true;for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnLoadHandler()}return true};UIWindowManager.prototype.callOnUnload=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnUnloadHandler()}return true};UIWindowManager.prototype.onResLoadDone=function(){this.callOnLoad();this.showInitWindow();return};UIWindowManager.prototype.showResLoadingWindow=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isUINormalWindow&&(e.isUILoadingWindow||e.name==="win-loading")){e.isUILoadingWindow=true;this.openWindow(e.name);console.log("found resource loading window.");return}}this.showInitWindow();return};UIWindowManager.prototype.systemInit=function(){this.loadSoundEffects();this.loadSoundMusic();this.resLoadDone=false;UIElement.animTimerID=null;this.callOnSystemInitHandler();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnSystemInitHandler()}if(this.showLoadingProgress){var i=this.getHtmlImageByType("loading-ui-logo");if(i&&i.src){this.logoImage=i}i=this.getHtmlImageByType("loading-ui-progress-bg");if(i&&i.src){this.progressBarBgImage=i}i=this.getHtmlImageByType("loading-ui-progress-fg");if(i&&i.src){this.progressBarFgImage=i}}else{var n=this;var r=cantkGetQueryParam("show-loading-win");if(r==="false"){ResLoader.setOnLoadFinishListener(function(){n.onResLoadDone()});console.log("show-loading-win=false")}else{this.showResLoadingWindow();ResLoader.setOnLoadFinishListener(function(){n.callOnLoad()})}}return};UIWindowManager.prototype.systemExit=function(){console.log("systemExit: ");var t=this.history.length;for(var e=0;e<t;e++){this.closeCurrentWindow(0,true)}this.history.length=0;this.stopSoundMusic();this.callOnUnload();return};UIWindowManager.prototype.findBestFitWindowByName=function(t){var e=null;var i=null;var n=null;var r=null;var a=null;var o=this.getDeviceConfig();var s=t;var h=t+"-"+o.platform;var l=h+"-"+o.lcdDensity;var u=l+"-"+o.screenW+"x"+o.screenH;for(var c=0;c<this.children.length;c++){e=this.children[c];switch(e.name){case s:{if(o.lcdDensity===e.lcddensity){r=e}else if(!e.lcddensity||e.lcddensity==="all"){i=e}else{if(!i){i=e}}break}case h:{n=e;break}case l:{r=e;break}case u:{a=e;break}default:break}}if(a){console.log("Find "+a.name);return a}if(r){console.log("Find "+r.name);return r}if(n){console.log("Find "+n.name);return n}if(i){console.log("Find "+i.name);return i}return null};UIWindowManager.prototype.openWindow=function(t,e,i,n,r){var a=null;r=r?r:{};if(t){a=this.findBestFitWindowByName(t)}else{a=this.getMainWindow()}if(!a||!a.isUIWindow){alert("Can not find window: "+t);return}if(a.pendingLoadChildren){a.loadChildren()}if(this.isWindowOpen(a)){if(r.closeOldIfOpened){a.callOnClose({});this.history.remove(a.getZIndex())}else if(r.openNewIfOpened){var a=this.dupChild(a.name);a.destroyWhenClose=true}else{console.log(a.name+" is open already.");return false}}if(a.openPending){a.openPending=false;console.log("This window is already open:"+t);return false}a.prepareForOpen();a.openPending=true;a.initData=n;a.onClose=e;a.callOnBeforeOpen(n);this.targetShape=a;console.log("openWindow: set targetShape:"+this.targetShape.name);if(a.isUINormalWindow){return this.openNormalWindow(a,i)}else{return this.openPopupWindow(a,i)}};UIWindowManager.prototype.openPopupWindow=function(t,e){if(e){this.closeCurrentWindow(0,true)}var i=this;var n=this.getCurrentFrame();t.relayout();function r(){if(!t.app){console.log("may be exited preview mode");return}t.show();n.setPopupWindow(t);i.postRedraw();t.callOnOpen(t.initData)}if(n){n.callOnSwitchToBack(true);if(t.isAnimationEnabled()){var a=this.getPositionInScreen();var o=AnimationFactory.create(t.getAnimationName(true),t.getAnimationDuration(true));var s=UIFrames.preparseBackendCanvas(n,t);o.setScale(this.getRealScale());o.prepare(a.x,a.y,this.w,this.h,s,r);o.setRectOfFront(t.x,t.y,t.w,t.h);o.run()}else{r()}}return true};UIWindowManager.prototype.openNormalWindow=function(t,e){if(e){this.closeCurrentWindow(0,true)}var i=this;var n=0;t.relayout();var r=this.getCurrentFrame();function a(){if(!t.app){console.log("may be exited preview mode");return}n=i.getFrameIndex(t);i.showFrame(n);i.history.push(n);r=i.getCurrentFrame();i.postRedraw();t.callOnOpen(t.initData);return}if(r){r.callOnSwitchToBack();if(t.isAnimationEnabled()){var o=this.getPositionInScreen();var s=AnimationFactory.create(t.getAnimationName(true),t.getAnimationDuration(true));var h=UIFrames.preparseBackendCanvas(r,t);s.setScale(this.getRealScale());s.prepare(o.x,o.y,this.w,this.h,h,a);s.run()}else{a()}}else{a()}return true};UIWindowManager.prototype.getCurrentWindow=function(){var t=this.getCurrentFrame();if(!t){return null}var e=t.getPopupWindow();return e?e:t};UIWindowManager.prototype.backToHomeWin=function(){var t=this.history;var e=t.length-1;var i=this.getCurrentWindow();if(!e){if(i.isUIPopupWindow){this.closeCurrentWindow(0)}return}if(e===1){if(i.isUIPopupWindow){this.closeCurrentWindow(0,true);this.closeCurrentWindow(0)}else{this.closeCurrentWindow(0)}return}var n=t[0];var r=this.getFrame(n);if(i.isAnimationEnabled()){var a=this.getPositionInScreen();var o=AnimationFactory.create(i.getAnimationName(false),i.getAnimationDuration(false));var s=UIFrames.preparseBackendCanvas(r,i);o.setScale(this.getRealScale());o.prepare(a.x,a.y,this.w,this.h,s,function(){});o.run()}for(var h=0;h<e;h++){this.closeCurrentWindow(0,true)}return};UIWindowManager.prototype.closeCurrentWindow=function(t,e){var i=this.getCurrentWindow();if(!i||i.mode===Shape.MODE_EDITING){return false}if(i.isUINormalWindow){return this.closeCurrentNormalWindow(i,t,e)}else{return this.closeCurrentPopupWindow(i,t,e)}};UIWindowManager.prototype.closeCurrentPopupWindow=function(t,e,i){var n=this;var r=this.getCurrentFrame();if(r){function a(){if(!t.app){console.log("may be exited preview mode");return}r.removePopupWindow(t);r.callOnSwitchToFront(true);n.postRedraw();t.callOnClose(e)}if(t.isAnimationEnabled()&&!i){var o=this.getPositionInScreen();var s=AnimationFactory.create(t.getAnimationName(false),t.getAnimationDuration(false));r.removePopupWindow(t);var h=UIFrames.preparseBackendCanvas(r,t);r.setPopupWindow(t);s.setScale(this.getRealScale());s.prepare(o.x,o.y,this.w,this.h,h,a);s.setRectOfFront(t.x,t.y,t.w,t.h);s.run()}else{a()}}return true};UIWindowManager.prototype.closeCurrentNormalWindow=function(t,e,i){var n=this;var r=null;if(this.history.length<2){if(i&&this.history.length){n.history.remove(n.current);t.callOnClose(e)}return false}lastWinIndex=this.history[this.history.length-2];r=this.getFrame(lastWinIndex);function a(){if(!r.app){console.log("may be exited preview mode");return}n.showFrame(lastWinIndex);r.callOnSwitchToFront();n.postRedraw();t.callOnClose(e);return}n.history.remove(n.current);if(i){a()}else if(t.isAnimationEnabled()){var o=this.getPositionInScreen();var s=AnimationFactory.create(t.getAnimationName(false),t.getAnimationDuration(false));var h=UIFrames.preparseBackendCanvas(r,t);s.setScale(this.getRealScale());s.prepare(o.x,o.y,this.w,this.h,h,a);s.run()}else{setTimeout(a,10)}return};UIWindowManager.prototype.isWindowOpen=function(t){for(var e=0;e<this.history.length;e++){var i=this.history[e];var n=this.children[i];for(var r=n;r!=null;r=r.popupWindow){if(r===t)return true}}return false};UIWindowManager.prototype.shapeCanBeChild=function(t){if(t.isUIWindow){if(this.mode==Shape.MODE_EDITING){var e=this.findChildByName(t.name);if(e){t.name=t.name+this.children.length}}return true}return false};UIWindowManager.prototype.onChildrenChanged=function(){};UIWindowManager.prototype.afterChildAppended=function(t){if(this.mode!==Shape.MODE_RUNNING&&!this.isUnpacking){var e=this.getFrameIndex(t);this.showFrame(e)}this.onChildrenChanged();return};UIWindowManager.prototype.onChildRemoved=function(t){this.onChildrenChanged();return};UIWindowManager.prototype.scaleForDensity=function(t,e,i){if(!t||t===1){return}for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.lcddensity||r.lcddensity==="all"){if(r.pendingLoadChildren){r.scaleInfo={};r.scaleInfo.sizeScale=t;r.scaleInfo.lcdDensity=e}else{r.scaleForDensity(t,e,i)}}}return};UIWindowManager.prototype.resize=function(t,e){var i=0;var n=0;var r=this.screenScaleMode==="fix-width";var a=this.screenScaleMode==="fix-height";var o=this.screenScaleMode==="fix-resolution";var s=this.parentShape!=null;if(this.mode===Shape.MODE_RUNNING&&(r||a||o)&&!s){var h=this.view.getCanvas();var l=h.width;var u=h.height;var c=this.designWidth;var p=this.designHeight;var f=true;var m=l>u&&c>p||l<u&&c<p;h.style.width=l+"px";h.style.height=u+"px";if(f&&m){if(r){var d=c/l;h.width=c;h.height=u*d;t=h.width;e=h.height}else if(a){var d=p/u;h.height=p;h.width=l*d;t=h.width;e=h.height}else{var g=c/l;var y=p/u;var d=Math.max(g,y);if(Math.abs(g-y)<.1){h.width=c;h.height=p;i=0;n=0;t=h.width;e=h.height}else{h.width=l*d;h.height=u*d;i=h.width-c>>1;n=h.height-p>>1;t=c;e=p}}var v=h.width/l;var _=h.height/u;WWindowManager.setInputScale(v,_)}else{h.width=l;h.height=u;WWindowManager.setInputScale(1,1);t=h.width;e=h.height}var I=cantkGetViewPort();this.app.onCanvasSized(h.width,h.height);console.log("Canvas Size: w ="+h.width+" h="+h.height);console.log("ViewPort Size: w ="+I.width+" h="+I.height);console.log("Canvas Style Size: w ="+h.style.width+" h="+h.style.height)}this.lastWin=null;this.setPosition(i,n);this.setSizeLimit(t,e,t,e);UIElement.prototype.resize.call(this,t,e);return};UIWindowManager.prototype.setDeviceConfig=function(t){var e=this.screenScaleMode;if(e==="fix-resolution"||e==="fix-width"||e==="fix-height"){this.oldConfig=this.deviceConfig;return}var i=this.deviceConfig;this.oldConfig=this.deviceConfig;this.deviceConfig=t;if(i&&t){if(i.lcdDensity!=t.lcdDensity){var n=this.getSizeScale(i.lcdDensity,t.lcdDensity);this.scaleForDensity(n,t.lcdDensity,true)}this.notifyDeviceConfigChanged(i,t);console.log("call this.notifyDeviceConfigChanged: "+this.type)}console.log("setDeviceConfig platform:"+t.platform);return};UIWindowManager.prototype.getDeviceConfig=function(){if(this.deviceConfig){return this.deviceConfig}else{var t=this.getDevice();if(t){return t.config}}return null};UIWindowManager.prototype.paintLoadingStatus=function(t,e){var i=t;var n=0;var r=0;var a=0;var o=0;var s=0;var h=this.w;var l=this.h;var u=Math.round(this.w*.8);i.fillStyle="White";i.fillRect(0,0,h,l);var c=this.logoImage;if(c&&c.width){o=c.width;s=c.height;n=h-o>>1;r=Math.round(l*.6-s);i.drawImage(c,n,r)}a=u;c=this.progressBarBgImage;if(c&&c.width){o=c.width;s=c.height;n=h-u>>1;r=l*.6;i.drawImage(c,0,0,o,s,n,r,a,s)}c=this.progressBarFgImage;if(c&&c.width){a=Math.round(u*e/100);o=c.width;s=c.height;n=h-u>>1;i.drawImage(c,0,0,o,s,n,r,a,s)}return};UIWindowManager.prototype.paintChildren=function(t){if(this.mode!=Shape.MODE_EDITING){if(this.forcePortrait&&this.w>this.h){var e=this.getHtmlImageByType("force-portrait-tips");t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,this.w,this.h);return}else if(this.forceLandscape&&this.w<this.h){var e=this.getHtmlImageByType("force-landscape-tips");t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,this.w,this.h);return}if(this.showLoadingProgress){if(!this.resLoadDone){var i=this;var n=ResLoader.getPercent();if(n<100){this.paintLoadingStatus(t,n);console.log("resloading percent:"+n);setTimeout(function(){i.postRedraw()},100)}else{this.onResLoadDone()}return}}}var r=this.getCurrentFrame();if(r){if(r.isUIDialog){t.fillStyle="white";t.fillRect(0,0,this.w,this.h)}t.save();t.beginPath();r.paintSelf(t);t.restore()}return};UIWindowManager.prototype.afterPaintChildren=function(t){var e=this.getCreatingShape();if(e&&e.isUIElement&&this.showHignlight){if(!e.isUIDevice){t.beginPath();t.rect(0,0,this.w,this.h);t.lineWidth=5;t.strokeStyle="Orange";t.stroke()}if(e.isUIWindow){t.textBaseline="middle";t.textAlign="center";t.fillStyle="Gray";t.font="24pt Sans";t.fillText(dappGetText("Please Drag Window To Here."),this.w/2,this.h*.2)}}this.showHignlight=!this.showHignlight;return};UIWindowManager.prototype.paintSelf=function(t){t.save();this.translate(t);this.paintSelfOnly(t);this.paintChildren(t);t.restore();return};UIWindowManager.prototype.paintSelfOnly=function(t){if(this.mode===Shape.MODE_EDITING){this.setThisAsCurrentWindowManager();t.fillStyle="white";t.fillRect(0,0,this.w,this.h);UIWindowManager.updateWindowThumbView(this.current)}return};UIWindowManager.prototype.isDeviceDirectionOK=function(){if(this.mode===Shape.MODE_EDITING){return true}if(this.forcePortrait&&this.w>this.h||this.forceLandscape&&this.w<this.h){console.log("Device Direction Incorrect.");return false}return true};UIWindowManager.prototype.relayout=function(){if(this.isDeviceDirectionOK()){UIElement.prototype.relayout.call(this)}else{console.log("isDeviceDirectionNotOK ignore relayout")}return this};UIWindowManager.prototype.relayoutChildren=function(){if(!this.isDeviceDirectionOK()){console.log("isDeviceDirectionNotOK ignore relayout");return}var t=this.getCurrentFrame();if(this.mode===Shape.MODE_EDITING){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.relayout()}}else{if(t){t.relayout();var n=t.getPopupWindow();if(n){n.relayout()}}}return};UIWindowManager.prototype.onKeyDown=function(t){var e=this.getCurrentWindow();return e&&e.onKeyDown(t)};UIWindowManager.prototype.onKeyUp=function(t){var e=this.getCurrentWindow();return e&&e.onKeyUp(t)};UIWindowManager.prototype.setSoundEffectURLs=function(t){this.soundEffectURLs=t;return this};UIWindowManager.prototype.getSoundEffectURLs=function(){return this.soundEffectURLs};UIWindowManager.prototype.getSoundEffectNames=function(){if(!this.soundEffectURLs){return[]}var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){t[e]=decodeURI(basename(t[e]))}return t};UIWindowManager.prototype.setSoundEffectsEnable=function(t){this.soundEffectsEnalbe=t;return this};UIWindowManager.prototype.setSoundMusicsEnable=function(t){this.soundMusicsEnalbe=t;return this};UIWindowManager.prototype.loadSoundEffects=function(){if(!this.soundEffectURLs){return}UIWindowManager.soundEffects={};if(CantkRT.isNative()){console.log("Native Audio supported: load native Audio");this.loadSoundEffectsNative()}else if(isWebAudioSupported()){console.log("WebAudio supported: load Web Audio");this.loadSoundEffectsWebAudio()}else{console.log("WebAudio not supported: load HTML5 Audio");this.loadSoundEffectsHtml5Audio()}return this};UIWindowManager.prototype.loadSoundEffectsHtml5Audio=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];ResLoader.loadAudio(i,function(t){var e={audio:t};var i=decodeURI(basename(t.src));UIWindowManager.soundEffects[i]=e})}return this};UIWindowManager.prototype.loadSoundEffectsNative=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];CantkRT.createSoundEffect(i,function(t){var e={audio:t};var i=decodeURI(basename(t.src));UIWindowManager.soundEffects[i]=e;console.log("loadSoundEffectsNative success.")},function(){console.log("loadSoundEffectsNative fail.")})}return this};UIWindowManager.prototype.loadSoundEffectsWebAudio=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];var n={src:[i],autoplay:false,loop:false,volume:.8};var r=decodeURI(basename(i));var a={audio:new Howl(n),playing:false};UIWindowManager.soundEffects[r]=a}return this};UIWindowManager.prototype.stopSoundEffect=function(t){for(var e in UIWindowManager.soundEffects){if(t===e||!t){var i=UIWindowManager.soundEffects[e];if(i&&i.audio){if(i.audio.stop){i.audio.stop()}else{i.audio.pause()}i.playing=false}}}return this};UIWindowManager.prototype.stopAllSound=function(){try{this.stopSoundMusic().stopSoundEffect()}catch(t){console.log(t.message)}return this};UIWindowManager.soundMusicVolume=.8;UIWindowManager.soundEffectVolume=.8;UIWindowManager.prototype.setSoundEffectVolume=function(t){UIWindowManager.soundEffectVolume=t;return this};UIWindowManager.prototype.setSoundMusicVolume=function(t){UIWindowManager.soundMusicVolume=t;var e=this.lastAudioInfo;if(e&&e.audio){UIWindowManager.setVolumeOfAudio(e.audio,UIWindowManager.soundMusicVolume)}return this};UIWindowManager.setVolumeOfAudio=function(t,e){if(typeof t.volume==="function"){t.volume(e)}else{t.volume=e}};UIWindowManager.prototype.playSoundEffect=function(t,e){if(!this.soundEffectsEnalbe){console.log("this.soundEffectsEnalbe is disable ");return this}var i=UIWindowManager.soundEffects[t];if(!i||!i.audio){console.log("not found: "+t);return this}if(e){if(i.audio.once){i.audio.once("end",e)}else{i.audio.addEventListener("ended",function(t){e()})}}UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundEffectVolume);i.audio.play();console.log("playSoundEffect:"+t);return this};UIWindowManager.prototype.onPointerDownRunning=function(t,e){if(this.autoPlayPending){this.playSoundMusic();this.autoPlayPending=false}if(!e||this.popupWindow||!this.pointerDown){return}return this.callOnPointerDownHandler(t)};UIWindowManager.prototype.setSoundMusicURLs=function(t){this.soundMusicURLs=t;return this};UIWindowManager.prototype.getSoundMusicURLs=function(){return this.soundMusicURLs};UIWindowManager.prototype.loadSoundMusicHTML5=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var a=n[r];ResLoader.loadAudio(a,function(n){var r={audio:n};var a=decodeURI(basename(n.src));if(e){n.loop="loop"}if(i){n.play();i=false}t.autoPlayPending=true;UIWindowManager.soundMusic[a]=r})}return};UIWindowManager.prototype.loadSoundMusicWebAudio=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var a=n[r];var o={src:[a],autoplay:i,loop:e,volume:.8};var s=decodeURI(basename(a));var h={audio:new Howl(o),playing:i};if(i){this.lastAudioInfo=h}i=false;UIWindowManager.soundMusic[s]=h}return};UIWindowManager.prototype.loadSoundMusicNative=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var a=n[r];CantkRT.createSoundMusic(a,function(t){var n={audio:t};var r=decodeURI(basename(t.src));if(e){t.loop="loop"}if(i){t.play();this.lastAudioInfo=n;i=false}UIWindowManager.soundMusic[r]=n})}return};UIWindowManager.prototype.loadSoundMusic=function(){if(!this.soundMusicURLs){return}UIWindowManager.soundMusic={};if(CantkRT.isNative()){console.log("Native Audio supported: load native Audio");this.loadSoundMusicNative()}else if(isWebAudioSupported()){console.log("WebAudio supported: load Web Audio");this.loadSoundMusicWebAudio()}else{this.loadSoundMusicHTML5()}this.soundMusicsPlaying=this.soundMusicAutoPlay;return this};UIWindowManager.prototype.isSoundMusicPlaying=function(t){var e=false;for(var i in UIWindowManager.soundMusic){if(t===i||!t){var n=UIWindowManager.soundMusic[i];if(n&&n.audio){if(n.playing){e=true;break}}}}return e};UIWindowManager.prototype.stopSoundMusic=function(t){for(var e in UIWindowManager.soundMusic){if(t===e||!t){var i=UIWindowManager.soundMusic[e];if(i&&i.audio){i.audio.pause();i.playing=false;this.soundMusicsPlaying=false}}}return this};UIWindowManager.prototype.playSoundMusic=function(t,e){this.stopSoundMusic();if(!this.soundMusicsEnalbe){console.log("this.soundMusicsEnalbe is disable ");return this}if(!t&&this.lastAudioInfo&&this.lastAudioInfo.audio){var i=this.lastAudioInfo;UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundMusicVolume);i.audio.play();i.playing=true;this.soundMusicsPlaying=true;return this}for(var n in UIWindowManager.soundMusic){if(t===n||!t){var i=UIWindowManager.soundMusic[n];if(i&&i.audio){if(e){i.audio.once("end",e)}UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundMusicVolume);i.audio.play();i.playing=true;this.lastAudioInfo=i;this.soundMusicsPlaying=true;console.log("UIWindowManager.prototype.playSoundMusic");break}}}console.log("playSoundMusic:"+t);return this};UIWindowManager.prototype.getSoundMusicNames=function(){if(!this.soundMusicURLs){return[]}var t=this.soundMusicURLs.split("\n");for(var e=0;e<t.length;e++){t[e]=basename(t[e])}return t};function UIWindowManagerCreator(){var t=["ui-window-manager","ui-window-manager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWindowManager;return e.initUIWindowManager(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIWindowManagerCreator);function UIImageButton(){return}UIImageButton.prototype=new UIElement;UIImageButton.prototype.isUIImageButton=true;UIImageButton.prototype.initUIImageButton=function(t,e,i){this.initUIElement(t,e,i);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.addEventNames(["onUpdateTransform"]);return this};UIImageButton.prototype.shapeCanBeChild=function(t){return false};function UIImageButtonCreator(t,e){var i=["ui-image-button","ui-image-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIImageButton;return n.initUIImageButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIImageButtonCreator(120,90));function UIImageNormalView(){return}UIImageNormalView.prototype=new UIImageView;UIImageNormalView.prototype.isUIImageNormalView=true;UIImageNormalView.prototype.initUIImageNormalView=function(t,e,i){this.userImages=[];this.cachedImages=[];this.initUIElement(t);this.initUIImageView(e,i);this.setTextType(Shape.TEXT_NONE);this.current=0;this.offsetX=0;this.offsetY=0;this.imageScale=1;this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator;this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);return this};UIImageNormalView.prototype.onPointerDownRunning=function(t,e){if(e){return}this.velocityTracker.clear();return};UIImageNormalView.prototype.onPointerMoveRunning=function(t,e){if(e){return}this.offsetX=this.offsetX+this.getMoveDeltaX();this.offsetY=this.offsetY+this.getMoveDeltaY();this.addMovementForVelocityTracker();return};UIImageNormalView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIImageNormalView.prototype.onPointerUpRunning=function(t,e){if(e){return}var i=this.velocityTracker.getVelocity();var n=this.w;var r=this.h;var a=i.x/n;var o=i.y/r;var s=Math.max(a,o);var h=.5*n*a*a;var l=.5*r*o*o;h=i.x>0?h:-h;l=i.y>0?l:-l;this.scrollTo(h,l,s*1e3);return true};UIImageNormalView.prototype.scrollTo=function(t,e,i){var n=this;var r=Math.max(500,Math.min(i,1e3));var a=(new Date).getTime();var o=this.offsetX;var s=this.offsetY;var h=this.cachedImages[this.current];var l=Math.min(h.width/2,t);var u=Math.min(h.height/2,e);function c(){var t=new Date;var e=(t.getTime()-a)/r;if(e<1){n.offsetX=o+e*l;n.offsetY=s+e*u;setTimeout(c,10)}else{delete a;n.offsetX=o+l;n.offsetY=s+u}delete t;n.postRedraw()}c();return};UIImageNormalView.prototype.switchTo=function(t){var e=this.current;var i=this.userImages.length;if(t>0){if(this.current+t<i){e=this.current+t}}else{if(this.current+t>0){e=this.current+t}}};UIImageNormalView.prototype.calcImageDefaultOffset=function(){var t=this.current;if(t<0||t>=this.cachedImages.length){return}var e=this.cachedImages[t];if(!e||!e.width){return}this.imageScale=Math.min(this.w/e.width,this.h/e.height);var i=this.imageScale*e.width;var n=this.imageScale*e.height;this.offsetX=(this.w-i)/2;this.offsetY=(this.h-n)/2;return};UIImageNormalView.prototype.setCurrentImage=function(t){if(t<0||t>=this.userImages.length){return}this.current=t;this.calcImageDefaultOffset();return};UIImageNormalView.prototype.onDoubleClick=function(t,e){this.calcImageDefaultOffset();return this.callOnDoubleClickHandler(t)};UIImageNormalView.prototype.paintSelfOnly=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=this.cachedImages[this.current];if(!e||!e.width){return}this.imageScale=1;t.save();t.rect(0,0,this.w,this.h);t.clip();t.translate(this.offsetX,this.offsetY);t.scale(this.imageScale,this.imageScale);t.drawImage(e,0,0);t.restore();return};function UIUIImageNormalViewCreator(){var t=["ui-image-normal-view","ui-image-normal-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageNormalView;return e.initUIImageNormalView(this.type,300,300)};return}ShapeFactoryGet().addShapeCreator(new UIUIImageNormalViewCreator);function UIImageSlideView(){return}UIImageSlideView.prototype=new UIImageView;UIImageSlideView.prototype.isUIImageSlideView=true;UIImageSlideView.prototype.initUIImageSlideView=function(t,e,i){this.initUIElement(t);this.initUIImageView(e,i);
this.offset=0;this.addEventNames(["onChanged"]);this.setTextType(Shape.TEXT_NONE);imageSlideViewInitCustomProp(this);return this};UIImageSlideView.prototype.onInit=function(){var t=this;this.currFrame=0;function e(){if(t.mode!=Shape.MODE_EDITING&&t.isVisible()){var i=t.getFrameDuration();t.postRedraw();setTimeout(e,i);var n=t.currFrame+1;t.animScrollTo(-t.w,n)}}var i=this.getFrameDuration();setTimeout(e,i);return};UIImageSlideView.prototype.getFrameDuration=function(){return this.frameDuration?this.frameDuration:5e3};UIImageSlideView.prototype.setFrameDuration=function(t){this.frameDuration=Math.max(1e3,Math.min(t,3e5));return};UIImageSlideView.prototype.setShowIndicator=function(t){this.showIndicator=t;return};UIImageSlideView.prototype.getFrameIndicatorParams=function(){var t=this.userImages.length;var e=Math.min(.5*this.w/t,40);var i=e*t;var n=(this.w-i)/2;var r=.8*this.h;return{offsetX:n,offsetY:r,itemSize:e,n:t}};UIImageSlideView.prototype.getCurrent=function(){return this.currFrame};UIImageSlideView.prototype.getCurrentImage=function(){var t=this.cachedImages[this.currFrame];return t};UIImageSlideView.prototype.setValue=function(t){for(var e=0;e<this.cachedImages.length;e++){var i=this.cachedImages[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){return this.setCurrent(e)}}return this};UIImageSlideView.prototype.setCurrent=function(t){this.setCurrentFrame(t);return this};UIImageSlideView.prototype.setCurrentFrame=function(t){this.offset=0;this.currFrame=(t+this.userImages.length)%this.userImages.length;this.postRedraw();this.callOnChangedHandler(this.currFrame);return this};UIImageSlideView.prototype.animScrollTo=function(t,e){var i=1e3;var n=this;var r=this.offset;var a=(new Date).getTime();var o=new DecelerateInterpolator(2);if(n.animating){return}n.animating=true;function s(){var h=new Date;var l=(h.getTime()-a)/i;var u=o.get(l);if(l<1){n.offset=r+t*u;setTimeout(s,10)}else{n.offset=0;n.setCurrentFrame(e);delete a;delete o;delete n.animating}delete h;n.postRedraw()}s();return};UIImageSlideView.prototype.onPointerDownRunning=function(t,e){if(this.isEventHandledByChild()){return}this.setEventHandled();if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();return true};UIImageSlideView.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;return t&UIElement.EVENT_HSCROLL_HANDLED};UIImageSlideView.prototype.setEventHandled=function(){this.setLastEventStatus(UIElement.EVENT_HSCROLL_HANDLED);return this};UIImageSlideView.prototype.onPointerMoveRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.currFrame;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}this.offset=r;this.addMovementForVelocityTracker();return};UIImageSlideView.prototype.onPointerUpRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.currFrame;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var a=0;var o=this.offset;var s=this.currFrame;var h=this.velocityTracker.getVelocity().x;var l=o+h;if(Math.abs(o)<10){this.offset=0;return}if(Math.abs(l)>this.w/3){if(o>0){a=this.w-o;s=this.currFrame-1}else{a=-this.w-o;s=this.currFrame+1}}else{a=-o}this.animScrollTo(a,s);return};UIImageSlideView.prototype.onClick=function(t,e){if(e||this.animating){return}var i=this.getFrameIndicatorParams();var n=i.offsetX;var r=i.offsetY;var a=i.itemSize;var o=i.n;var s=t.x;var h=t.y;if(h<r||h>r+a||s<n||s>n+o*a){return}for(var l=0;l<o;l++){if(s>n&&s<n+a){this.setCurrentFrame(l);break}n+=a}return};UIImageSlideView.prototype.drawFrameIndicator=function(t,e){var i=this.getFrameIndicatorParams();var n=i.offsetX;var r=i.offsetY;var a=i.itemSize;var o=i.n;n+=a/2;r+=a/2;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;for(var s=0;s<o;s++){t.beginPath();t.arc(n,r,10,0,Math.PI*2);n+=a;if(s===e){t.save();t.shadowColor=this.style.lineColor;t.shadowBlur=5;t.shadowOffsetX=0;t.shadowOffsetY=0;t.fill();t.stroke();t.restore()}else{t.fill()}}return};UIImageSlideView.prototype.getPrevFrame=function(){var t=(this.currFrame-1+this.userImages.length)%this.userImages.length;return this.cachedImages[t]};UIImageSlideView.prototype.getFrames=function(){return this.userImages.length};UIImageSlideView.prototype.getNextFrame=function(){var t=(this.currFrame+1)%this.userImages.length;return this.cachedImages[t]};UIImageSlideView.prototype.drawOneImage=function(t,e){var i=this.style.fillColor;if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){t.drawImage(e,0,0,e.width,e.height,0,0,this.w,this.h)}else if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO){var n={x:0,y:0};n.w=e.width;n.h=e.height;this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO,0,0,this.w,this.h,n)}else{UIImageView.drawImageAtCenter(t,e,0,0,this.w,this.h,true,i)}return};UIImageSlideView.prototype.drawImage=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=(this.currFrame?this.currFrame:0)%this.userImages.length;var i=this.cachedImages[e];if(i&&i.width>0){t.save();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();t.translate(this.offset,0);this.drawOneImage(t,i);var n=Math.abs(this.offset);if(this.offset<0){i=this.getNextFrame();if(i&&i.width>0){t.translate(this.w,0);this.drawOneImage(t,i)}}else if(n>0){i=this.getPrevFrame();if(i&&i.width>0){t.translate(-this.w,0);this.drawOneImage(t,i)}}t.restore();if(this.showIndicator){this.drawFrameIndicator(t,e)}}return};UIImageSlideView.prototype.shapeCanBeChild=function(t){return t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage};function UIImageSlideViewCreator(){var t=["ui-image-slide-view","ui-image-slide-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageSlideView;return e.initUIImageSlideView(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageSlideViewCreator);function cantkRegisterUIElements(){return}UIWindowManager.prototype.setThisAsCurrentWindowManager=function(){};UIWindowManager.updateWindowThumbView=function(t){};UIWindowManager.drawWindowThumbView=function(t,e){};UIElement.prototype.setsd=function(t){return this};UIElement.prototype.sendsd=function(t){return this};function UIBody(){return}UIBody.prototype=new UIElement;UIBody.prototype.isUIBody=true;UIBody.prototype.isUIPhysicsShape=true;UIBody.prototype.initUIBody=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setCanRectSelectable(false,false);this.density=0;this.friction=0;this.restitution=0;this.addEventNames(["onBeginContact","onEndContact","onMoved"]);return this};UIBody.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UIBody.prototype.setDensity=function(t){if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.SetDensity(t)}if(t>0){this.body.SetType(b2Body.b2_dynamicBody)}else if(t===0){this.body.SetType(b2Body.b2_staticBody)}else{this.body.SetType(b2Body.b2_kinematicBody)}}return this};UIBody.prototype.setSensor=function(t){this.isSensor=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.SetSensor(t)}}return this};UIBody.prototype.getDensity=function(){if(this.body){return this.body.GetFixtureList().GetDensity()}return 0};UIBody.prototype.setV=function(t,e){var i=this.body;if(i){this.setVisible(true);if(!i.IsActive()){i.SetActive(true)}if(!i.IsAwake()){i.SetAwake(true)}var n=i.GetLinearVelocity();if(t!==null&&t!==undefined){n.x=t}if(e!==null&&e!==undefined){n.y=e}i.SetLinearVelocity(n)}return this};UIBody.prototype.getV=function(){return this.body?this.body.GetLinearVelocity():{x:0,y:0}};UIBody.prototype.addV=function(t,e){var i=this.getV();if(t!==null&&t!==undefined){i.x+=t}if(e!==null&&e!==undefined){i.y+=e}return this.setV(i.x,i.y)};UIBody.prototype.getMass=function(){return this.body?this.body.GetMass():0};UIBody.prototype.applyTorque=function(t){if(this.body){this.body.ApplyTorque(t)}return this};UIBody.prototype.applyForce=function(t,e,i,n){if(this.body){var r={};var a={};i=i===undefined||i===null?this.x+(this.w>>1):i;n=n===undefined||n===null?this.y+(this.h>>1):n;r.x=t;r.y=e;a.x=Physics.toMeter(i);a.y=Physics.toMeter(n);this.body.ApplyForce(r,a)}return this};UIBody.prototype.setEnable=function(t){this.enable=t;if(this.body){this.body.SetActive(t)}return this};UIBody.prototype.setGroupIndex=function(t){this.groupIndex=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.m_filter.groupIndex=t}}return this};UIBody.prototype.getGroupIndex=function(){return this.groupIndex};UIBody.prototype.setRotation=function(t){this.rotation=t;if(this.body){this.body.SetAngle(t)}return this};UIBody.prototype.needStroke=function(){return!this.noStroke&&!this.isStrokeColorTransparent()};UIBody.prototype.paintSelfOnly=function(t){var e=this.needStroke();var i=!this.isFillColorTransparent();if(!i&&!e){return}t.beginPath();this.drawShape(t);if(i){t.fillStyle=this.style.fillColor;t.fill()}if(e){t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke()}return};function UIPath(){return}UIPath.prototype=new UIElement;UIPath.prototype.isUIPath=true;UIPath.prototype.initUIPath=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onInit"]);return this};UIPath.prototype.shapeCanBeChild=function(t){return false};UIPath.prototype.onInit=function(){this.shapesInfo=[];this.elapsedTime=0;this.pathAnimation=new PathAnimation;this.animationState=UIElement.STATE_RUNNING;this.callOnInitHandler();return};UIPath.prototype.restart=function(){this.elapsedTime=0;this.animationState=UIElement.STATE_RUNNING;return this};UIPath.prototype.pause=function(){this.animationState=UIElement.STATE_PAUSED;return this};UIPath.prototype.resume=function(){this.animationState=UIElement.STATE_RUNNING;return this};UIPath.prototype.addObj=function(t,e,i,n,r){var a={shape:t,onStep:e,onDone:i,noRotation:r,delayTime:n?n:0};a.delayTime+=this.elapsedTime;this.shapesInfo.push(a);return this};UIPath.prototype.removeObj=function(t){var e=this.shapesInfo;var i=this.shapesInfo.length;for(var n=0;n<i;n++){var r=e[n];if(r.shape===t){e.splice(n,1);break}}return this};UIPath.prototype.resetObjs=function(){this.shapesInfo=[];return this};UIPath.prototype.resetPath=function(){this.shapesInfo=[];return this};UIPath.prototype.getStartPoint=function(){return this.pathAnimation.startPoint};UIPath.prototype.getEndPoint=function(){return this.endPoint};UIPath.prototype.addPath=function(t){this.pathAnimation.addPath(t);return this};UIPath.prototype.addLine=function(t,e,i,n){return this.addPath(LinePath.create(t,e,i.x,i.y,n.x,n.y))};UIPath.prototype.addArc=function(t,e,i,n,r,a){return this.addPath(ArcPath.create(t,e,i.x,i.y,n,r,a))};UIPath.prototype.addPara=function(t,e,i,n,r){return this.addPath(ParaPath.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};UIPath.prototype.addSin=function(t,e,i,n,r,a,o){return this.addPath(SinPath.create(t,e,i.x,i.y,n,r,a,o))};UIPath.prototype.addBezier=function(t,e,i,n,r,a){return this.addPath(Bezier3Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y,a.x,a.y))};UIPath.prototype.addQuad=function(t,e,i,n,r){return this.addPath(Bezier2Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};UIPath.prototype.getDuration=function(){return this.pathAnimation.duration};UIPath.prototype.getPosition=function(t){return this.pathAnimation.getPosition(t)};UIPath.prototype.getDirection=function(t){return this.pathAnimation.getDirection(t)};UIPath.prototype.paintSelf=function(t){if(this.isIcon||this.mode===Shape.MODE_EDITING){UIElement.prototype.paintSelf.call(this,t);return}if(this.showPath&&!this.isStrokeColorTransparent()){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;this.pathAnimation.draw(t)}if(this.animationState===UIElement.STATE_RUNNING){this.elapsedTime+=t.timeStep*UIElement.timeScale;var e=this.elapsedTime;var i=this.shapesInfo.slice();var n=this.shapesInfo.length;var r=this.pathAnimation;var a=r.getDuration();for(var o=0;o<n;o++){var s=i[o];var h=e-s.delayTime;var l=s.shape;if(!l||!l.parentShape)continue;if(h>0){var u=r.getDirection(h);var c=r.getPosition(h);if(!l.visible){l.setVisible(true)}if(s.onStep){onStep.call(l,h,c,u)}else{l.setPosition(c.x-(l.w>>1),c.y-(l.h>>1));if(!s.noRotation){l.setRotation(u)}}if(h>a&&s.onDone){onDone.call(l)}}}}return};function UIPathCreator(){var t=["ui-path","ui-path",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPath;return e.initUIPath(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIPathCreator);function UISprite(){return}UISprite.prototype=new UIImage;UISprite.prototype.isUISprite=true;UISprite.prototype.initUISprite=function(t,e,i,n){this.initUIImage(t,e,i,n);return this};function UISpriteCreator(){var t=["ui-sprite","ui-sprite",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISprite;return e.initUISprite(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UISpriteCreator);function UIPoint(){return}UIPoint.prototype=new UIElement;UIPoint.prototype.isUIPoint=true;UIPoint.prototype.initUIPoint=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);return this};UIPoint.prototype.paintSelfOnly=function(t){var e=!this.isFillColorTransparent();var i=!this.isStrokeColorTransparent();if(e||i){var n=this.w>>1;var r=this.h>>1;t.beginPath();t.arc(n,r,10,0,2*Math.PI);if(e){t.fillStyle=this.style.fillColor;t.fill()}if(i){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;t.stroke()}}return};UIPoint.prototype.shapeCanBeChild=function(t){return false};function UIPointCreator(){var t=["ui-point","ui-point",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPoint;return e.initUIPoint(this.type,20,20,null)};return}ShapeFactoryGet().addShapeCreator(new UIPointCreator);function UITwoPoints(){return}UITwoPoints.prototype=new UIElement;UITwoPoints.prototype.initUITwoPoints=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_POINT1,null);this.setImage(UIElement.IMAGE_POINT2,null);this.points=[{x:0,y:0},{x:80,y:80}];this.regSerializer(this.twoPointsToJson,this.twoPointsFromJson);return this};UITwoPoints.prototype.twoPointsToJson=function(t){t.points=[{x:0,y:0},{x:80,y:80}];t.points[0].x=this.points[0].x;t.points[0].y=this.points[0].y;t.points[1].x=this.points[1].x;t.points[1].y=this.points[1].y;return};UITwoPoints.prototype.twoPointsFromJson=function(t){if(t.points){this.points[0].x=t.points[0].x;this.points[0].y=t.points[0].y;this.points[1].x=t.points[1].x;this.points[1].y=t.points[1].y}return};UITwoPoints.prototype.asIcon=function(){if(!this.isIcon){this.isIcon=true;this.points=[{x:0,y:0},{x:80,y:80}]}return};UITwoPoints.prototype.relayout=function(){if(this.disableRelayout||this.mode===Shape.MODE_EDITING){return}var t=getParentShapeOfShape(this);var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.points[0].x=e*this.x0Param;this.points[1].x=e*this.x1Param}if(this.yAttr===UIElement.Y_SCALE){this.points[0].y=i*this.y0Param;this.points[1].y=i*this.y1Param}return};UITwoPoints.prototype.updateLayoutParams=function(){this.xParam=1;this.yParam=1;var t=this.parentShape;if(!t){return}var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.x0Param=this.points[0].x/e;this.x1Param=this.points[1].x/e}if(this.yAttr===UIElement.Y_SCALE){this.y0Param=this.points[0].y/i;this.y1Param=this.points[1].y/i}return};UITwoPoints.prototype.hitTest=function(t){if(Math.distanceBetween(t,this.points[0])<20){return 1}if(Math.distanceBetween(t,this.points[1])<20){return 2}var e={};e.x=this.points[0].x+this.points[1].x>>1;e.y=this.points[0].y+this.points[1].y>>1;if(Math.distanceBetween(t,e)<30){return Shape.HIT_TEST_MM}return Shape.HIT_TEST_NONE};UITwoPoints.prototype.getSelectMark=function(t,e){var i=this.points.length;if(t<=i){e.x=this.points[t-1].x;e.y=this.points[t-1].y;return true}return false};UITwoPoints.prototype.onAppendedInParent=function(){if(this.isCreatingElement()){var t=this.getParent();var e=t.getPositionInView();this.points[0].x-=e.x;this.points[0].y-=e.y;this.points[1].x-=e.x;this.points[1].y-=e.y}return};UITwoPoints.prototype.drawSelectMarks=function(t){if(this.mode!==Shape.MODE_EDITING){return}t.save();t.beginPath();if(this.selected&&!this.hideSelectMark){var e=Math.floor(2/this.getRealScale());t.lineWidth=e;t.fillStyle=this.style.fillColor;t.strokeStyle=RShape.selectMarkColor;t.stroke();t.beginPath();t.lineWidth=e;for(var i=Shape.HIT_TEST_NONE+1;i<Shape.HIT_TEST_MAX;i++){if(this.getSelectMark(i,this.selectMarkPoint)){this.createSelectedMark(t,this.selectMarkPoint.x,this.selectMarkPoint.y,i==this.hitTestResult)}}t.closePath();t.stroke()}t.restore();return};UITwoPoints.prototype.getX=function(){return Math.min(this.points[0].x,this.points[1].x)};UITwoPoints.prototype.getY=function(){return Math.min(this.points[0].y,this.points[1].y)};UITwoPoints.prototype.getWidth=function(){return Math.abs(this.points[0].x-this.points[1].x)};UITwoPoints.prototype.getHeight=function(){return Math.abs(this.points[0].y-this.points[1].y)};UITwoPoints.prototype.paintSelf=function(t){t.save();if(this.isIcon){this.translate(t)}var e=null;var i=null;var n=this.points[0];var r=this.points[1];var a=this.getImageByType(UIElement.IMAGE_DEFAULT);var o=this.getImageByType(UIElement.IMAGE_POINT1);var s=this.getImageByType(UIElement.IMAGE_POINT2);var h=this.anchorSize?this.anchorSize:5;t.lineWidth=this.style.lineWidth;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;if(a&&a.getImage()){e=a.getImage();i=a.getImageRect();UIElement.drawImageLine(t,e,this.images.display,n,r,i)}else{t.beginPath();t.moveTo(n.x,n.y);t.lineTo(r.x,r.y);t.stroke()}if(o&&o.getImage()){e=o.getImage();i=o.getImageRect();this.drawImageAt(t,e,WImage.DISPLAY_CENTER,n.x-h,n.y-h,h+h,h+h,i)}else{t.beginPath();t.arc(n.x,n.y,h,0,Math.PI*2);t.fill()}if(s&&s.getImage()){e=s.getImage();i=s.getImageRect();this.drawImageAt(t,e,WImage.DISPLAY_CENTER,r.x-h,r.y-h,h+h,h+h,i)}else{t.beginPath();t.arc(r.x,r.y,h,0,Math.PI*2);t.fill()}t.restore();this.drawSelectMarks(t);return};UITwoPoints.prototype.shapeCanBeChild=function(t){return false};UITwoPoints.prototype.getPoint=function(t){return this.points[t?1:0]};UITwoPoints.prototype.setPoint=function(t,e,i){var n=this.points[t?1:0];n.x=e;n.y=i;return};UITwoPoints.prototype.getDistance=function(){return Math.round(Math.distanceBetween(this.points[0],this.points[1]))};UITwoPoints.prototype.getAngle=function(){return Math.lineAngle(this.points[0],this.points[1])};UITwoPoints.prototype.onPointerDownCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.points[0].x=t.x;this.points[0].y=t.y;this.state=Shape.STAT_CREATING_1;return true}case Shape.STAT_CREATING_1:{return true}default:{return false}}};UITwoPoints.prototype.onPointerMoveCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.points[0].x=t.x;this.points[0].y=t.y;this.points[1].x=t.x+50;this.points[1].y=t.y+50;return true}case Shape.STAT_CREATING_1:{this.points[1].x=t.x;this.points[1].y=t.y;return true}default:{return false}}};UITwoPoints.prototype.onPointerUpCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{return true}case Shape.STAT_CREATING_1:{this.state=Shape.STAT_NORMAL;return true}default:{return false}}};UITwoPoints.prototype.onPointerDownEditing=function(t){this.hitTestResult=this.hitTest(t);this.selected=this.hitTestResult!=Shape.HIT_TEST_NONE;return this.hitTestResult};UITwoPoints.prototype.onPointerMoveEditing=function(t){if(this.hitTestResult>0){var e=this.hitTestResult-1;this.points[e].x=t.x;this.points[e].y=t.y}};UITwoPoints.prototype.onPointerUpEditing=function(t){this.hitTestResult=Shape.HIT_TEST_NONE;return};UITwoPoints.prototype.getSupportedImageDisplay=function(){return["incenter","scale","tile"]};function UIImageLine(){return}UIImageLine.prototype=new UITwoPoints;UIImageLine.prototype.isUIImageLine=true;UIImageLine.prototype.initUIImageLine=function(t,e,i){this.initUITwoPoints(t);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};UIImageLine.prototype.paintSelf=function(t){var e=this.getBgImage();if(e&&e.getImage()){t.save();if(this.isIcon){this.translate(t)}var i=this.points[0];var n=this.points[1];var r=e.getImageRect();UIElement.drawImageLine(t,e.getImage(),this.images.display,i,n,r);this.drawSelectMarks(t);t.restore()}else{UITwoPoints.prototype.paintSelf.call(this,t)}return};function UIImageLineCreator(){var t=["ui-image-line","ui-image-line",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageLine;return e.initUIImageLine(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageLineCreator);function UIPolygon(){return}UIPolygon.prototype=new UIBody;UIPolygon.prototype.isUIPolygon=true;UIPolygon.prototype.initUIPolygon=function(t,e,i){this.initUIBody(t,e,i);return this};UIPolygon.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}if(t.isUIPoint){return true}return!t.isUIPhysicsShape};UIPolygon.prototype.drawShape=function(t){var e=0;var i=0;for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.isUIPoint){continue}var a=r.x+(r.w>>1);var o=r.y+(r.h>>1);if(n%5===0){e=a;i=o;if(n>0){t.closePath()}t.moveTo(a,o)}else{t.lineTo(a,o)}}t.lineTo(e,i)};function UIPolygonCreator(){var t=["ui-polygon","ui-polygon",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPolygon;return e.initUIPolygon(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIPolygonCreator);function UIBox(){return}UIBox.prototype=new UIBody;UIBox.prototype.isUIBox=true;UIBox.prototype.initUIBox=function(t,e,i){this.initUIBody(t,e,i);return this};UIBox.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UIBox.prototype.setSize=function(t,e){this.w=Math.max(Math.floor(t),2);this.h=Math.max(Math.floor(e),2);this.onSized();return this};UIBox.prototype.onSized=function(){var t=this.getWindow();this.updateLayoutParams();if(this.body&&t&&t.isUIScene){var e=this.x;var i=this.y;var n=this.body.GetFixtureList().GetShape();var r=this.getWidth(true)>>1;var a=this.getHeight(true)>>1;n.SetAsBox(Physics.toMeter(r),Physics.toMeter(a));this.body.SynchronizeFixtures();this.setPosition(e,i)}};UIBox.prototype.drawShape=function(t){var e=this.getHMargin();var i=this.getVMargin();var n=this.getWidth(true);var r=this.getHeight(true);t.rect(e,i,n,r);return};function UIBoxCreator(){var t=["ui-box","ui-box",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBox;return e.initUIBox(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIBoxCreator);function UIOneJoint(){return}UIOneJoint.prototype=new UIElement;UIOneJoint.prototype.isUIJoint=true;UIOneJoint.prototype.isUIOneJoint=true;UIOneJoint.prototype.initUIOneJoint=function(t){this.initUIElement(t);this.setDefSize(20,20);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_POINT,null);return this};UIOneJoint.prototype.paintSelfOnly=function(t){var e=this.getImageByType(UIElement.IMAGE_POINT);if(e&&e.getImage()){var i=e.getImage();var n=e.getImageRect();this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,n)}else{var r=!this.isFillColorTransparent();var a=!this.isStrokeColorTransparent();if(r||a){var o=this.w>>1;var s=this.h>>1;t.beginPath();t.arc(o,s,10,0,2*Math.PI);if(r){t.fillStyle=this.style.fillColor;t.fill()}if(a){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;t.stroke()}}}return};UIOneJoint.prototype.shapeCanBeChild=function(t){return false};function UIOneJointCreator(){var t=["ui-one-joint","ui-one-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIOneJoint;return e.initUIOneJoint(this.type)};return}(function(t,e){i.POOL_MAX=1e3;i.TIME_STEP=60;i.MEASURE=100;i.EULER="euler";i.RK2="runge-kutta2";i.RK4="runge-kutta4";i.VERLET="verlet";i.PARTICLE_CREATED="partilcleCreated";i.PARTICLE_UPDATE="partilcleUpdate";i.PARTICLE_SLEEP="particleSleep";i.PARTICLE_DEAD="partilcleDead";i.PROTON_UPDATE="protonUpdate";i.PROTON_UPDATE_AFTER="protonUpdateAfter";i.EMITTER_ADDED="emitterAdded";i.EMITTER_REMOVED="emitterRemoved";i.amendChangeTabsBug=true;i.TextureBuffer={};i.TextureCanvasBuffer={};function i(t,e){this.proParticleCount=i.Util.initValue(t,i.POOL_MAX);this.integrationType=i.Util.initValue(e,i.EULER);this.emitters=[];this.renderers=[];this.time=0;this.oldTime=0;i.pool=new i.ParticlePool(this.proParticleCount);i.integrator=new i.NumericalIntegration(this.integrationType)}i.prototype={addRender:function(t){t.proton=this;this.renderers.push(t.proton)},addEmitter:function(t){this.emitters.push(t);t.parent=this;this.dispatchEvent(new i.Event({type:i.EMITTER_ADDED,emitter:t}))},removeEmitter:function(t){var e=this.emitters.indexOf(t);this.emitters.splice(e,1);t.parent=null;this.dispatchEvent(new i.Event({type:i.EMITTER_REMOVED,emitter:t}))},update:function(){this.dispatchEvent(new i.Event({type:i.PROTON_UPDATE}));if(!this.oldTime)this.oldTime=(new Date).getTime();var t=(new Date).getTime();this.elapsed=(t-this.oldTime)/1e3;if(i.amendChangeTabsBug)this.amendChangeTabsBug();this.oldTime=t;if(this.elapsed>0){for(var e=0;e<this.emitters.length;e++){this.emitters[e].update(this.elapsed)}}this.dispatchEvent(new i.Event({type:i.PROTON_UPDATE_AFTER}))},amendChangeTabsBug:function(){if(this.elapsed>.5){this.oldTime=(new Date).getTime();this.elapsed=0}},getCount:function(){var t=0;var e=this.emitters.length;for(var i=0;i<e;i++){t+=this.emitters[i].particles.length}return t},destory:function(){var t=this.emitters.length;for(var e=0;e<t;e++){this.emitters[e].destory();delete this.emitters[e]}this.emitters=[];this.time=0;this.oldTime=0;i.pool.release()}};t.Proton=i;function n(){this.initialize()}var r=n.prototype;n.initialize=function(t){t.addEventListener=r.addEventListener;t.removeEventListener=r.removeEventListener;t.removeAllEventListeners=r.removeAllEventListeners;t.hasEventListener=r.hasEventListener;t.dispatchEvent=r.dispatchEvent};r._listeners=null;r.initialize=function(){};r.addEventListener=function(t,e){var i=this._listeners;if(!i){i=this._listeners={}}else{this.removeEventListener(t,e)}var n=i[t];if(!n){n=i[t]=[]}n.push(e);return e};r.removeEventListener=function(t,e){var i=this._listeners;if(!i){return}var n=i[t];if(!n){return}for(var r=0,a=n.length;r<a;r++){if(n[r]==e){if(a==1){delete i[t]}else{n.splice(r,1)}break}}};r.removeAllEventListeners=function(t){if(!t){this._listeners=null}else if(this._listeners){delete this._listeners[t]}};r.dispatchEvent=function(t){var e=false,i=this._listeners;if(t&&i){var n=i[t.type];if(!n)return e;n=n.slice();for(var r=0,a=n.length;r<a;r++){var o=n[r];e=e||o(t)}}return!!e};r.hasEventListener=function(t){var e=this._listeners;return!!(e&&e[t])};i.EventDispatcher=n;i.EventDispatcher.initialize(i.prototype);function a(t){this.type=t["type"];this.particle=t["particle"];this.emitter=t["emitter"]}a.PARTICLE_CREATED=i.PARTICLE_CREATED;a.PARTICLE_UPDATA=i.PARTICLE_UPDATA;a.PARTICLE_SLEEP=i.PARTICLE_SLEEP;a.PARTICLE_DEAD=i.PARTICLE_DEAD;i.Event=a;var o=o||{initValue:function(t,i){var t=t!=null&&t!=e?t:i;return t},isArray:function(t){return typeof t==="object"&&t.hasOwnProperty("length")},destroyArray:function(t){t.length=0},destroyObject:function(t){for(var e in t)delete t[e]},getVector2D:function(t,e){if(typeof t=="object"){return t}else{var n=new i.Vector2D(t,e);return n}},judgeVector2D:function(t){var e="";if(t.hasOwnProperty("x")||t.hasOwnProperty("y")||t.hasOwnProperty("p")||t.hasOwnProperty("position"))e+="p";if(t.hasOwnProperty("vx")||t.hasOwnProperty("vx")||t.hasOwnProperty("v")||t.hasOwnProperty("velocity"))e+="v";if(t.hasOwnProperty("ax")||t.hasOwnProperty("ax")||t.hasOwnProperty("a")||t.hasOwnProperty("accelerate"))e+="a";return e},setVector2DByObject:function(t,e){if(e.hasOwnProperty("x"))t.p.x=e["x"];if(e.hasOwnProperty("y"))t.p.y=e["y"];if(e.hasOwnProperty("vx"))t.v.x=e["vx"];if(e.hasOwnProperty("vy"))t.v.y=e["vy"];if(e.hasOwnProperty("ax"))t.a.x=e["ax"];if(e.hasOwnProperty("ay"))t.a.y=e["ay"];if(e.hasOwnProperty("p"))particle.p.copy(e["p"]);if(e.hasOwnProperty("v"))particle.v.copy(e["v"]);if(e.hasOwnProperty("a"))particle.a.copy(e["a"]);if(e.hasOwnProperty("position"))particle.p.copy(e["position"]);if(e.hasOwnProperty("velocity"))particle.v.copy(e["velocity"]);if(e.hasOwnProperty("accelerate"))particle.a.copy(e["accelerate"])},addPrototypeByObject:function(t,e,n){for(var r in e){if(n){if(n.indexOf(r)<0)t[r]=i.Util.getSpanValue(e[r])}else{t[r]=i.Util.getSpanValue(e[r])}}return t},setPrototypeByObject:function(t,e,n){for(var r in e){if(t.hasOwnProperty(r)){if(n){if(n.indexOf(r)<0)t[r]=i.Util.getSpanValue(e[r])}else{t[r]=i.Util.getSpanValue(e[r])}}}return t},setSpanValue:function(t,e,n){if(t instanceof i.Span){return t}else{if(!e){return new i.Span(t)}else{if(!n)return new i.Span(t,e);else return new i.Span(t,e,n)}}},getSpanValue:function(t){if(t instanceof i.Span)return t.getValue();else return t},inherits:function(t,e){t._super_=e;if(Object["create"]){t.prototype=Object.create(e.prototype,{constructor:{value:t}})}else{var i=function(){};i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=t}},getImageData:function(t,e,i){t.drawImage(e,i.x,i.y);var n=t.getImageData(i.x,i.y,i.width,i.height);t.clearRect(i.x,i.y,i.width,i.height);return n},getImage:function(t,e,i,n){if(typeof t=="string"){this.loadAndSetImage(t,e,i,n)}else if(typeof t=="object"){this.loadAndSetImage(t.src,e,i,n)}else if(t instanceof Image){this.loadedImage(t.src,e,i,n,t)}},loadedImage:function(t,e,n,r,a){e.target=a;e.transform.src=t;if(!i.TextureBuffer[t])i.TextureBuffer[t]=e.target;if(n){if(i.TextureCanvasBuffer[t]){e.transform.canvas=i.TextureCanvasBuffer[t]}else{var o=i.WebGLUtil.nhpot(e.target.width);var s=i.WebGLUtil.nhpot(e.target.height);e.transform.canvas=i.DomUtil.createCanvas("canvas"+t,o,s);var h=e.transform.canvas.getContext("2d");h.drawImage(e.target,0,0,e.target.width,e.target.height);i.TextureCanvasBuffer[t]=e.transform.canvas}}if(r)r(e)},loadAndSetImage:function(t,e,n,r){if(i.TextureBuffer[t]){this.loadedImage(t,e,n,r,i.TextureBuffer[t])}else{var a=this;var o=new Image;o.onload=function(i){a.loadedImage(t,e,n,r,i.target)};o.src=t}},hexToRGB:function(t){var e=t.charAt(0)=="#"?t.substring(1,7):t;var i=parseInt(e.substring(0,2),16);var n=parseInt(e.substring(2,4),16);var r=parseInt(e.substring(4,6),16);return{r:i,g:n,b:r}},rgbToHex:function(t){return"rgb("+t.r+", "+t.g+", "+t.b+")"}};i.Util=o;var s=s||{ipot:function(t){return(t&t-1)==0},nhpot:function(t){--t;for(var e=1;e<32;e<<=1){t=t|t>>e}return t+1},makeTranslation:function(t,e){return[1,0,0,0,1,0,t,e,1]},makeRotation:function(t){var e=Math.cos(t);var i=Math.sin(t);return[e,-i,0,i,e,0,0,0,1]},makeScale:function(t,e){return[t,0,0,0,e,0,0,0,1]},matrixMultiply:function(t,e){var i=t[0*3+0];var n=t[0*3+1];var r=t[0*3+2];var a=t[1*3+0];var o=t[1*3+1];var s=t[1*3+2];var h=t[2*3+0];var l=t[2*3+1];var u=t[2*3+2];var c=e[0*3+0];var p=e[0*3+1];var f=e[0*3+2];var m=e[1*3+0];var d=e[1*3+1];var g=e[1*3+2];var y=e[2*3+0];var v=e[2*3+1];
var _=e[2*3+2];return[i*c+n*m+r*y,i*p+n*d+r*v,i*f+n*g+r*_,a*c+o*m+s*y,a*p+o*d+s*v,a*f+o*g+s*_,h*c+l*m+u*y,h*p+l*d+u*v,h*f+l*g+u*_]}};i.WebGLUtil=s;var h=h||{createCanvas:function(t,e,i,n){var r=document.createElement("canvas");var a=n?n:"absolute";r.id=t;r.width=e;r.height=i;r.style.position=a;r.style.opacity=0;this.transformDom(r,-500,-500,0,0);return r},transformDom:function(t,e,i,n,r){t.style.WebkitTransform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)";t.style.MozTransform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)";t.style.OTransform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)";t.style.msTransform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)";t.style.transform="translate("+e+"px, "+i+"px) "+"scale("+n+") "+"rotate("+r+"deg)"}};i.DomUtil=h;function l(){this.mats=[];this.size=0;for(var t=0;t<20;t++)this.mats.push(i.Mat3.create([0,0,0,0,0,0,0,0,0]))}l.prototype.set=function(t,e){if(e==0)i.Mat3.set(t,this.mats[0]);else i.Mat3.multiply(this.mats[e-1],t,this.mats[e]);this.size=Math.max(this.size,e+1)};l.prototype.push=function(t){if(this.size==0)i.Mat3.set(t,this.mats[0]);else i.Mat3.multiply(this.mats[this.size-1],t,this.mats[this.size]);this.size++};l.prototype.pop=function(){if(this.size>0)this.size--};l.prototype.top=function(){return this.mats[this.size-1]};i.MStack=l;u.ID=0;function u(t){this.id="particle_"+u.ID++;this.reset(true);i.Util.setPrototypeByObject(this,t)}u.prototype={getDirection:function(){return Math.atan2(this.v.x,-this.v.y)*(180/Math.PI)},reset:function(t){this.life=Infinity;this.age=0;this.energy=1;this.dead=false;this.sleep=false;this.target=null;this.sprite=null;this.parent=null;this.mass=1;this.radius=10;this.alpha=1;this.scale=1;this.rotation=0;this.color=null;this.easing=i.ease.setEasingByName(i.easeLinear);if(t){this.transform={};this.p=new i.Vector2D;this.v=new i.Vector2D;this.a=new i.Vector2D;this.old={p:new i.Vector2D,v:new i.Vector2D,a:new i.Vector2D};this.behaviours=[]}else{i.Util.destroyObject(this.transform);this.p.set(0,0);this.v.set(0,0);this.a.set(0,0);this.old.p.set(0,0);this.old.v.set(0,0);this.old.a.set(0,0);this.removeAllBehaviours()}this.transform.rgb={r:255,g:255,b:255};return this},update:function(t,e){if(!this.sleep){this.age+=t;var i=this.behaviours.length,n;for(n=0;n<i;n++){if(this.behaviours[n])this.behaviours[n].applyBehaviour(this,t,e)}}else{}if(this.age>=this.life){this.destory()}else{var r=this.easing(this.age/this.life);this.energy=Math.max(1-r,0)}},addBehaviour:function(t){this.behaviours.push(t);if(t.hasOwnProperty("parents"))t.parents.push(this);t.initialize(this)},addBehaviours:function(t){var e=t.length,i;for(i=0;i<e;i++){this.addBehaviour(t[i])}},removeBehaviour:function(t){var e=this.behaviours.indexOf(t);if(e>-1){var t=this.behaviours.splice(e,1);t.parents=null}},removeAllBehaviours:function(){i.Util.destroyArray(this.behaviours)},destory:function(){this.removeAllBehaviours();this.energy=0;this.dead=true;this.parent=null}};i.Particle=u;function c(t,e){this.proParticleCount=i.Util.initValue(t,0);this.releaseTime=i.Util.initValue(e,-1);this.poolList=[];this.timeoutID=0;for(var n=0;n<this.proParticleCount;n++){this.add()}if(this.releaseTime>0)this.timeoutID=setTimeout(this.release,this.releaseTime/1e3)}c.prototype={create:function(t){if(t)return new newTypeParticle;else return new i.Particle},getCount:function(){return this.poolList.length},add:function(){return this.poolList.push(this.create())},get:function(){if(this.poolList.length===0){return this.create()}else{return this.poolList.pop().reset()}},set:function(t){if(this.poolList.length<i.POOL_MAX)return this.poolList.push(t)},release:function(){for(var t=0;t<this.poolList.length;t++){if(this.poolList[t]["destory"])this.poolList[t].destory();delete this.poolList[t]}this.poolList=[]}};i.ParticlePool=c;var p={randomAToB:function(t,e,i){if(!i)return t+Math.random()*(e-t);else return Math.floor(Math.random()*(e-t))+t},randomFloating:function(t,e,i){return p.randomAToB(t-e,t+e,i)},randomZone:function(t){},degreeTransform:function(t){return t*Math.PI/180},toColor16:function st(t){return"#"+t.toString(16)},randomColor:function(){return"#"+("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6)}};i.MathUtils=p;var f=function(t){this.type=i.Util.initValue(t,i.EULER)};f.prototype={integrate:function(t,e,i){this.eulerIntegrate(t,e,i)},eulerIntegrate:function(t,e,i){if(!t.sleep){t.old.p.copy(t.p);t.old.v.copy(t.v);t.a.multiplyScalar(1/t.mass);t.v.add(t.a.multiplyScalar(e));t.p.add(t.old.v.multiplyScalar(e));if(i)t.v.multiplyScalar(i);t.a.clear()}}};i.NumericalIntegration=f;var m=function(t,e){this.x=t||0;this.y=e||0};m.prototype={set:function(t,e){this.x=t;this.y=e;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getGradient:function(){if(this.x!=0)return Math.atan2(this.y,this.x);else if(this.y>0)return Math.PI/2;else if(this.y<0)return-Math.PI/2},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){this.x=t.x;this.y=t.y;return this},add:function(t,i){if(i!==e){return this.addVectors(t,i)}this.x+=t.x;this.y+=t.y;return this},addXY:function(t,e){this.x+=t;this.y+=e;return this},addVectors:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;return this},addScalar:function(t){this.x+=t;this.y+=t;return this},sub:function(t,i){if(i!==e){return this.subVectors(t,i)}this.x-=t.x;this.y-=t.y;return this},subVectors:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;return this},divideScalar:function(t){if(t!==0){this.x/=t;this.y/=t}else{this.set(0,0)}return this},min:function(t){if(this.x>t.x){this.x=t.x}if(this.y>t.y){this.y=t.y}return this},max:function(t){if(this.x<t.x){this.x=t.x}if(this.y<t.y){this.y=t.y}return this},clamp:function(t,e){if(this.x<t.x){this.x=t.x}else if(this.x>e.x){this.x=e.x}if(this.y<t.y){this.y=t.y}else if(this.y>e.y){this.y=e.y}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},rotate:function(t){var e=this.x;var i=this.y;this.x=e*Math.cos(t)+i*Math.sin(t);this.y=-e*Math.sin(t)+i*Math.cos(t);return this},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){var e=this.length();if(e!==0&&t!==e){this.multiplyScalar(t/e)}return this},lerp:function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;return this},equals:function(t){return t.x===this.x&&t.y===this.y},toArray:function(){return[this.x,this.y]},clear:function(){this.x=0;this.y=0;return this},clone:function(){return new i.Vector2D(this.x,this.y)}};i.Vector2D=m;var d=function(t,e){this.r=Math.abs(t)||0;this.tha=e||0};d.prototype={set:function(t,e){this.r=t;this.tha=e;return this},setR:function(t){this.r=t;return this},setTha:function(t){this.tha=t;return this},copy:function(t){this.r=t.r;this.tha=t.tha;return this},toVector:function(){return new i.Vector2D(this.getX(),this.getY())},getX:function(){return this.r*Math.sin(this.tha)},getY:function(){return-this.r*Math.cos(this.tha)},normalize:function(){this.r=1;return this},equals:function(t){return t.r===this.r&&t.tha===this.tha},toArray:function(){return[this.r,this.tha]},clear:function(){this.r=0;this.tha=0;return this},clone:function(){return new i.Polar2D(this.r,this.tha)}};i.Polar2D=d;function g(t,e,n){this.isArray=false;if(i.Util.isArray(t)){this.isArray=true;this.a=t}else{this.a=i.Util.initValue(t,1);this.b=i.Util.initValue(e,this.a);this.center=i.Util.initValue(n,false)}}g.prototype={getValue:function(t){if(this.isArray){return this.a[Math.floor(this.a.length*Math.random())]}else{if(!this.center)return i.MathUtils.randomAToB(this.a,this.b,t);else return i.MathUtils.randomFloating(this.a,this.b,t)}}};i.Span=g;i.getSpan=function(t,e,n){return new i.Span(t,e,n)};function y(t){if(i.Util.isArray(t)){this.colorArr=t}else{this.colorArr=[t]}}i.Util.inherits(y,i.Span);y.prototype.getValue=function(){var t=this.colorArr[Math.floor(this.colorArr.length*Math.random())];if(t=="random"||t=="Random")return i.MathUtils.randomColor();else return t};i.ColorSpan=y;function v(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n;this.bottom=this.y+this.height;this.right=this.x+this.width}v.prototype={contains:function(t,e){if(t<=this.right&&t>=this.x&&e<=this.bottom&&e>=this.y)return true;else return false}};i.Rectangle=v;var _=_||{create:function(t){var e=new Float32Array(9);if(t)this.set(t,e);return e},set:function(t,e){for(var i=0;i<9;i++)e[i]=t[i];return e},multiply:function(t,e,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],h=t[6],l=t[7],u=e[0],c=e[1],p=e[2],f=e[3],m=e[4],d=e[6],g=e[7];i[0]=u*n+c*o;i[1]=u*r+c*s;i[2]=a*p;i[3]=f*n+m*o;i[4]=f*r+m*s;i[6]=d*n+g*o+h;i[7]=d*r+g*s+l;return i},inverse:function(t,e){var i=t[0],n=t[1],r=t[3],a=t[4],o=t[6],s=t[7],h=a,l=-r,u=s*r-a*o,c=i*h+n*l,p;p=1/c;e[0]=h*p;e[1]=-n*p;e[3]=l*p;e[4]=i*p;e[6]=u*p;e[7]=(-s*i+n*o)*p;return e},multiplyVec2:function(t,e,i){var n=e[0],r=e[1];i[0]=n*t[0]+r*t[3]+t[6];i[1]=n*t[1]+r*t[4]+t[7];return i}};i.Mat3=_;I.id=0;function I(t,e){this.id="Behaviour_"+I.id++;this.life=i.Util.initValue(t,Infinity);this.easing=i.ease.setEasingByName(e);this.age=0;this.energy=1;this.dead=false;this.parents=[];this.name="Behaviour"}I.prototype={reset:function(t,e){this.life=i.Util.initValue(t,Infinity);this.easing=i.Util.initValue(e,i.ease.setEasingByName(i.easeLinear))},normalizeForce:function(t){return t.multiplyScalar(i.MEASURE)},normalizeValue:function(t){return t*i.MEASURE},initialize:function(t){},applyBehaviour:function(t,e,i){this.age+=e;if(this.age>=this.life||this.dead){this.energy=0;this.dead=true;this.destory()}else{var n=this.easing(t.age/t.life);this.energy=Math.max(1-n,0)}},destory:function(){var t;var e=this.parents.length,i;for(i=0;i<e;i++){this.parents[i].removeBehaviour(this)}this.parents=[]}};i.Behaviour=I;function w(t,e){this.numPan=i.Util.initValue(t,1);this.timePan=i.Util.initValue(e,1);this.numPan=i.Util.setSpanValue(this.numPan);this.timePan=i.Util.setSpanValue(this.timePan);this.startTime=0;this.nextTime=0;this.init()}w.prototype={init:function(){this.startTime=0;this.nextTime=this.timePan.getValue()},getValue:function(t){this.startTime+=t;if(this.startTime>=this.nextTime){this.startTime=0;this.nextTime=this.timePan.getValue();if(this.numPan.b==1){if(this.numPan.getValue(false)>.5)return 1;else return 0}else{return this.numPan.getValue(true)}}return 0}};i.Rate=w;function x(){}x.prototype.reset=function(){};x.prototype.init=function(t,e){if(e){this.initialize(e)}else{this.initialize(t)}};x.prototype.initialize=function(t){};i.Initialize=x;var S={initialize:function(t,e,n){var r=n.length,a;for(a=0;a<r;a++){if(n[a]instanceof i.Initialize)n[a].init(t,e);else i.InitializeUtil.init(t,e,n[a])}i.InitializeUtil.bindEmitter(t,e)},init:function(t,e,n){i.Util.setPrototypeByObject(e,n);i.Util.setVector2DByObject(e,n)},bindEmitter:function(t,e){if(t.bindEmitter){e.p.add(t.p);e.v.add(t.v);e.a.add(t.a);e.v.rotate(i.MathUtils.degreeTransform(t.rotation))}}};i.InitializeUtil=S;function C(t,e,n){C._super_.call(this);this.lifePan=i.Util.setSpanValue(t,e,n)}i.Util.inherits(C,i.Initialize);C.prototype.initialize=function(t){if(this.lifePan.a==Infinity)t.life=Infinity;else t.life=this.lifePan.getValue()};i.Life=C;function T(t){T._super_.call(this);this.zone=i.Util.initValue(t,new i.PointZone)}i.Util.inherits(T,i.Initialize);T.prototype.reset=function(t){this.zone=i.Util.initValue(t,new i.PointZone)};T.prototype.initialize=function(t){this.zone.getPosition();t.p.x=this.zone.vector.x;t.p.y=this.zone.vector.y};i.Position=T;i.P=T;function b(t,e,n){b._super_.call(this);this.rPan=i.Util.setSpanValue(t);this.thaPan=i.Util.setSpanValue(e);this.type=i.Util.initValue(n,"vector")}i.Util.inherits(b,i.Initialize);b.prototype.reset=function(t,e,n){this.rPan=i.Util.setSpanValue(t);this.thaPan=i.Util.setSpanValue(e);this.type=i.Util.initValue(n,"vector")};b.prototype.normalizeVelocity=function(t){return t*i.MEASURE};b.prototype.initialize=function(t){if(this.type=="p"||this.type=="P"||this.type=="polar"){var e=new i.Polar2D(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*Math.PI/180);t.v.x=e.getX();t.v.y=e.getY()}else{t.v.x=this.normalizeVelocity(this.rPan.getValue());t.v.y=this.normalizeVelocity(this.thaPan.getValue())}};i.Velocity=b;i.V=b;function D(t,e,n){D._super_.call(this);this.massPan=i.Util.setSpanValue(t,e,n)}i.Util.inherits(D,i.Initialize);D.prototype.initialize=function(t){t.mass=this.massPan.getValue()};i.Mass=D;function A(t,e,n){A._super_.call(this);this.radius=i.Util.setSpanValue(t,e,n)}i.Util.inherits(A,i.Initialize);A.prototype.reset=function(t,e,n){this.radius=i.Util.setSpanValue(t,e,n)};A.prototype.initialize=function(t){t.radius=this.radius.getValue();t.transform.oldRadius=t.radius};i.Radius=A;function E(t,e,n){E._super_.call(this);this.image=this.setSpanValue(t);this.w=i.Util.initValue(e,20);this.h=i.Util.initValue(n,this.w)}i.Util.inherits(E,i.Initialize);E.prototype.initialize=function(t){var e=this.image.getValue();if(typeof e=="string"){t.target={width:this.w,height:this.h,src:e}}else{t.target=e}};E.prototype.setSpanValue=function(t){if(t instanceof i.ColorSpan){return t}else{return new i.ColorSpan(t)}};i.ImageTarget=E;function U(t,e,n,r){U._super_.call(this,n,r);this.force=this.normalizeForce(new i.Vector2D(t,e));this.name="Force"}i.Util.inherits(U,i.Behaviour);U.prototype.reset=function(t,e,n,r){this.force=this.normalizeForce(new i.Vector2D(t,e));if(n)U._super_.prototype.reset.call(this,n,r)};U.prototype.applyBehaviour=function(t,e,i){U._super_.prototype.applyBehaviour.call(this,t,e,i);t.a.add(this.force)};i.Force=U;i.F=U;function M(t,e,n,r,a){M._super_.call(this,r,a);this.targetPosition=i.Util.initValue(t,new i.Vector2D);this.radius=i.Util.initValue(n,1e3);this.force=i.Util.initValue(this.normalizeValue(e),100);this.radiusSq=this.radius*this.radius;this.attractionForce=new i.Vector2D;this.lengthSq=0;this.name="Attraction"}i.Util.inherits(M,i.Behaviour);M.prototype.reset=function(t,e,n,r,a){this.targetPosition=i.Util.initValue(t,new i.Vector2D);this.radius=i.Util.initValue(n,1e3);this.force=i.Util.initValue(this.normalizeValue(e),100);this.radiusSq=this.radius*this.radius;this.attractionForce=new i.Vector2D;this.lengthSq=0;if(r)M._super_.prototype.reset.call(this,r,a)};M.prototype.applyBehaviour=function(t,e,i){M._super_.prototype.applyBehaviour.call(this,t,e,i);this.attractionForce.copy(this.targetPosition);this.attractionForce.sub(t.p);this.lengthSq=this.attractionForce.lengthSq();if(this.lengthSq>4e-6&&this.lengthSq<this.radiusSq){this.attractionForce.normalize();this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq);this.attractionForce.multiplyScalar(this.force);t.a.add(this.attractionForce)}};i.Attraction=M;function P(t,e,i,n,r){P._super_.call(this,n,r);this.reset(t,e,i);this.time=0;this.name="RandomDrift"}i.Util.inherits(P,i.Behaviour);P.prototype.reset=function(t,e,n,r,a){this.panFoce=new i.Vector2D(t,e);this.panFoce=this.normalizeForce(this.panFoce);this.delay=n;if(r)P._super_.prototype.reset.call(this,r,a)};P.prototype.applyBehaviour=function(t,e,n){P._super_.prototype.applyBehaviour.call(this,t,e,n);this.time+=e;if(this.time>=this.delay){t.a.addXY(i.MathUtils.randomAToB(-this.panFoce.x,this.panFoce.x),i.MathUtils.randomAToB(-this.panFoce.y,this.panFoce.y));this.time=0}};i.RandomDrift=P;function B(t,e,i,n,r){B._super_.call(this,t,e,i,n,r);this.force*=-1;this.name="Repulsion"}i.Util.inherits(B,i.Attraction);B.prototype.reset=function(t,e,i,n,r){B._super_.prototype.reset.call(this,t,e,i,n,r);this.force*=-1};i.Repulsion=B;function L(t,e,i){L._super_.call(this,0,t,e,i);this.name="Gravity"}i.Util.inherits(L,i.Force);L.prototype.reset=function(t,e,i){L._super_.prototype.reset.call(this,0,t,e,i)};i.Gravity=L;i.G=L;function R(t,e,i,n,r){R._super_.call(this,n,r);this.reset(t,e,i);this.name="Collision"}i.Util.inherits(R,i.Behaviour);R.prototype.reset=function(t,e,n,r,a){this.emitter=i.Util.initValue(t,null);this.mass=i.Util.initValue(e,true);this.callback=i.Util.initValue(n,null);this.collisionPool=[];this.delta=new i.Vector2D;if(r)R._super_.prototype.reset.call(this,r,a)};R.prototype.applyBehaviour=function(t,e,i){var n=this.emitter?this.emitter.particles.slice(i):this.pool.slice(i);var r;var a;var o;var s,h;var l=n.length;for(var u=0;u<l;u++){r=n[u];if(r!==t){this.delta.copy(r.p);this.delta.sub(t.p);a=this.delta.lengthSq();distance=t.radius+r.radius;if(a<=distance*distance){o=distance-Math.sqrt(a);o+=.5;totalMass=t.mass+r.mass;s=this.mass?r.mass/totalMass:.5;h=this.mass?t.mass/totalMass:.5;t.p.add(this.delta.clone().normalize().multiplyScalar(o*-s));r.p.add(this.delta.normalize().multiplyScalar(o*h));if(this.callback)this.callback(t,r)}}}};i.Collision=R;function O(t,e,i,n){O._super_.call(this,i,n);this.reset(t,e);this.name="CrossZone"}i.Util.inherits(O,i.Behaviour);O.prototype.reset=function(t,e,n,r){this.zone=t;this.zone.crossType=i.Util.initValue(e,"dead");if(n)O._super_.prototype.reset.call(this,n,r)};O.prototype.applyBehaviour=function(t,e,i){O._super_.prototype.applyBehaviour.call(this,t,e,i);this.zone.crossing(t)};i.CrossZone=O;function V(t,e,i,n){V._super_.call(this,i,n);this.reset(t,e);this.name="Alpha"}i.Util.inherits(V,i.Behaviour);V.prototype.reset=function(t,n,r,a){if(n==null||n==e)this.same=true;else this.same=false;this.a=i.Util.setSpanValue(i.Util.initValue(t,1));this.b=i.Util.setSpanValue(n);if(r)V._super_.prototype.reset.call(this,r,a)};V.prototype.initialize=function(t){t.transform.alphaA=this.a.getValue();if(this.same)t.transform.alphaB=t.transform.alphaA;else t.transform.alphaB=this.b.getValue()};V.prototype.applyBehaviour=function(t,e,i){V._super_.prototype.applyBehaviour.call(this,t,e,i);t.alpha=t.transform.alphaB+(t.transform.alphaA-t.transform.alphaB)*this.energy;if(t.alpha<.001)t.alpha=0};i.Alpha=V;function W(t,e,i,n){W._super_.call(this,i,n);this.reset(t,e);this.name="Scale"}i.Util.inherits(W,i.Behaviour);W.prototype.reset=function(t,n,r,a){if(n==null||n==e)this.same=true;else this.same=false;this.a=i.Util.setSpanValue(i.Util.initValue(t,1));this.b=i.Util.setSpanValue(n);if(r)W._super_.prototype.reset.call(this,r,a)};W.prototype.initialize=function(t){t.transform.scaleA=this.a.getValue();t.transform.oldRadius=t.radius;if(this.same)t.transform.scaleB=t.transform.scaleA;else t.transform.scaleB=this.b.getValue()};W.prototype.applyBehaviour=function(t,e,i){W._super_.prototype.applyBehaviour.call(this,t,e,i);t.scale=t.transform.scaleB+(t.transform.scaleA-t.transform.scaleB)*this.energy;if(t.scale<1e-4)t.scale=0;t.radius=t.transform.oldRadius*t.scale};i.Scale=W;function F(t,e,i,n,r){F._super_.call(this,n,r);this.reset(t,e,i);this.name="Rotate"}i.Util.inherits(F,i.Behaviour);F.prototype.reset=function(t,n,r,a,o){if(n==null||n==e)this.same=true;else this.same=false;this.a=i.Util.setSpanValue(i.Util.initValue(t,"Velocity"));this.b=i.Util.setSpanValue(i.Util.initValue(n,0));this.style=i.Util.initValue(r,"to");if(a)F._super_.prototype.reset.call(this,a,o)};F.prototype.initialize=function(t){t.rotation=this.a.getValue();t.transform.rotationA=this.a.getValue();if(!this.same)t.transform.rotationB=this.b.getValue()};F.prototype.applyBehaviour=function(t,e,i){F._super_.prototype.applyBehaviour.call(this,t,e,i);if(!this.same){if(this.style=="to"||this.style=="TO"||this.style=="_"){t.rotation+=t.transform.rotationB+(t.transform.rotationA-t.transform.rotationB)*this.energy}else{t.rotation+=t.transform.rotationB}}else if(this.a.a=="V"||this.a.a=="Velocity"||this.a.a=="v"){t.rotation=t.getDirection()}};i.Rotate=F;function N(t,e,i,n){N._super_.call(this,i,n);this.reset(t,e);this.name="Color"}i.Util.inherits(N,i.Behaviour);N.prototype.reset=function(t,e,i,n){this.color1=this.setSpanValue(t);this.color2=this.setSpanValue(e);if(i)N._super_.prototype.reset.call(this,i,n)};N.prototype.initialize=function(t){t.color=this.color1.getValue();t.transform.beginRGB=i.Util.hexToRGB(t.color);if(this.color2)t.transform.endRGB=i.Util.hexToRGB(this.color2.getValue())};N.prototype.applyBehaviour=function(t,e,i){if(this.color2){N._super_.prototype.applyBehaviour.call(this,t,e,i);t.transform.rgb.r=t.transform.endRGB.r+(t.transform.beginRGB.r-t.transform.endRGB.r)*this.energy;t.transform.rgb.g=t.transform.endRGB.g+(t.transform.beginRGB.g-t.transform.endRGB.g)*this.energy;t.transform.rgb.b=t.transform.endRGB.b+(t.transform.beginRGB.b-t.transform.endRGB.b)*this.energy;t.transform.rgb.r=parseInt(t.transform.rgb.r,10);t.transform.rgb.g=parseInt(t.transform.rgb.g,10);t.transform.rgb.b=parseInt(t.transform.rgb.b,10)}else{t.transform.rgb.r=t.transform.beginRGB.r;t.transform.rgb.g=t.transform.beginRGB.g;t.transform.rgb.b=t.transform.beginRGB.b}};N.prototype.setSpanValue=function(t){if(t){if(t instanceof i.ColorSpan){return t}else{return new i.ColorSpan(t)}}else{return null}};i.Color=N;function k(t,e,n,r){k._super_.call(this,n,r);this.distanceVec=new i.Vector2D;this.centerPoint=i.Util.initValue(t,new i.Vector2D);this.force=i.Util.initValue(this.normalizeValue(e),100);this.name="GravityWell"}i.Util.inherits(k,i.Behaviour);k.prototype.reset=function(t,e,n,r){this.distanceVec=new i.Vector2D;this.centerPoint=i.Util.initValue(t,new i.Vector2D);this.force=i.Util.initValue(this.normalizeValue(e),100);if(n)k._super_.prototype.reset.call(this,n,r)};k.prototype.initialize=function(t){};k.prototype.applyBehaviour=function(t,e,i){this.distanceVec.set(this.centerPoint.x-t.p.x,this.centerPoint.y-t.p.y);var n=this.distanceVec.lengthSq();if(n!=0){var r=this.distanceVec.length();var a=this.force*e/(n*r);t.v.x+=a*this.distanceVec.x;t.v.y+=a*this.distanceVec.y}};i.GravityWell=k;G.ID=0;function G(t){this.initializes=[];this.particles=[];this.behaviours=[];this.emitTime=0;this.emitTotalTimes=-1;this.damping=.006;this.bindEmitter=true;this.rate=new i.Rate(1,.1);G._super_.call(this,t);this.id="emitter_"+G.ID++}i.Util.inherits(G,i.Particle);i.EventDispatcher.initialize(G.prototype);G.prototype.emit=function(t,e){this.emitTime=0;this.emitTotalTimes=i.Util.initValue(t,Infinity);if(e==true||e=="life"||e=="destroy"){if(t=="once")this.life=1;else this.life=this.emitTotalTimes}if(e&&!isNaN(e)){this.life=e}this.rate.init()};G.prototype.stopEmit=function(){this.emitTotalTimes=-1;this.emitTime=0};G.prototype.removeAllParticles=function(){for(var t=0;t<this.particles.length;t++)this.particles[t].dead=true};G.prototype.createParticle=function(t,e){var n=i.pool.get();this.setupParticle(n,t,e);this.dispatchEvent(new i.Event({type:i.PARTICLE_CREATED,particle:n}));return n};G.prototype.addSelfInitialize=function(t){if(t["init"]){t.init(this)}else{this.initAll()}};G.prototype.addInitialize=function(){var t=arguments.length,e;for(e=0;e<t;e++){this.initializes.push(arguments[e])}};G.prototype.removeInitialize=function(t){var e=this.initializes.indexOf(t);if(e>-1){this.initializes.splice(e,1)}};G.prototype.removeInitializers=function(){i.Util.destroyArray(this.initializes)};G.prototype.addBehaviour=function(){var t=arguments.length,e;for(e=0;e<t;e++){this.behaviours.push(arguments[e]);if(arguments[e].hasOwnProperty("parents"))arguments[e].parents.push(this)}};G.prototype.removeBehaviour=function(t){var e=this.behaviours.indexOf(t);if(e>-1)this.behaviours.splice(e,1)};G.prototype.removeAllBehaviours=function(){i.Util.destroyArray(this.behaviours)};G.prototype.integrate=function(t){var e=1-this.damping;i.integrator.integrate(this,t,e);var n=this.particles.length,r;for(r=0;r<n;r++){var a=this.particles[r];a.update(t,r);i.integrator.integrate(a,t,e);this.dispatchEvent(new i.Event({type:i.PARTICLE_UPDATE,particle:a}))}};G.prototype.emitting=function(t){if(this.emitTotalTimes=="once"){var e=this.rate.getValue(99999),i;for(i=0;i<e;i++){this.createParticle()}this.emitTotalTimes="none"}else if(!isNaN(this.emitTotalTimes)){this.emitTime+=t;if(this.emitTime<this.emitTotalTimes){var e=this.rate.getValue(t),i;for(i=0;i<e;i++){this.createParticle()}}}};G.prototype.update=function(t){this.age+=t;if(this.age>=this.life||this.dead){this.destroy()}this.emitting(t);this.integrate(t);var e;var n=this.particles.length,r;for(r=n-1;r>=0;r--){e=this.particles[r];if(e.dead){i.pool.set(e);this.particles.splice(r,1);this.dispatchEvent(new i.Event({type:i.PARTICLE_DEAD,particle:e}))}}};G.prototype.setupParticle=function(t,e,n){var r=this.initializes;var a=this.behaviours;if(e){if(e instanceof Array)r=e;else r=[e]}if(n){if(n instanceof Array)a=n;else a=[n]}i.InitializeUtil.initialize(this,t,r);t.addBehaviours(a);t.parent=this;this.particles.push(t)};G.prototype.destroy=function(){this.dead=true;this.emitTotalTimes=-1;if(this.particles.length==0){this.removeInitializers();this.removeAllBehaviours();if(this.parent)this.parent.removeEmitter(this)}};i.Emitter=G;function H(t){this.selfBehaviours=[];H._super_.call(this,t)}i.Util.inherits(H,i.Emitter);H.prototype.addSelfBehaviour=function(){var t=arguments.length,e;for(e=0;e<t;e++){this.selfBehaviours.push(arguments[e])}};H.prototype.removeSelfBehaviour=function(t){var e=this.selfBehaviours.indexOf(t);if(e>-1)this.selfBehaviours.splice(e,1)};H.prototype.update=function(t){H._super_.prototype.update.call(this,t);if(!this.sleep){var e=this.selfBehaviours.length,i;for(i=0;i<e;i++){this.selfBehaviours[i].applyBehaviour(this,t,i)}}};i.BehaviourEmitter=H;function Y(e,n,r){this.mouseTarget=i.Util.initValue(e,t);this.ease=i.Util.initValue(n,.7);this._allowEmitting=false;this.initEventHandler();Y._super_.call(this,r)}i.Util.inherits(Y,i.Emitter);Y.prototype.initEventHandler=function(){var t=this;this.mousemoveHandler=function(e){t.mousemove.call(t,e)};this.mousedownHandler=function(e){t.mousedown.call(t,e)};this.mouseupHandler=function(e){t.mouseup.call(t,e)};this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,false)};Y.prototype.emit=function(){this._allowEmitting=true};Y.prototype.stopEmit=function(){this._allowEmitting=false};Y.prototype.mousemove=function(t){if(t.layerX||t.layerX==0){this.p.x+=(t.layerX-this.p.x)*this.ease;this.p.y+=(t.layerY-this.p.y)*this.ease}else if(t.offsetX||t.offsetX==0){this.p.x+=(t.offsetX-this.p.x)*this.ease;this.p.y+=(t.offsetY-this.p.y)*this.ease}if(this._allowEmitting)Y._super_.prototype.emit.call(this,"once")};Y.prototype.destroy=function(){Y._super_.prototype.destroy.call(this);this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,false)};i.FollowEmitter=Y;var J=J||{easeLinear:function(t){return t},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)},easeInOutQuad:function(t){if((t/=.5)<1)return.5*Math.pow(t,2);return-.5*((t-=2)*t-2)},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutCubic:function(t){if((t/=.5)<1)return.5*Math.pow(t,3);return.5*(Math.pow(t-2,3)+2)},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return-(Math.pow(t-1,4)-1)},easeInOutQuart:function(t){if((t/=.5)<1)return.5*Math.pow(t,4);return-.5*((t-=2)*Math.pow(t,3)-2)},easeInSine:function(t){return-Math.cos(t*(Math.PI/2))+1},easeOutSine:function(t){return Math.sin(t*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInExpo:function(t){return t===0?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return t===1?1:-Math.pow(2,-10*t)+1},easeInOutExpo:function(t){if(t===0)return 0;if(t===1)return 1;if((t/=.5)<1)return.5*Math.pow(2,10*(t-1));return.5*(-Math.pow(2,-10*--t)+2)},easeInCirc:function(t){return-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeInOutCirc:function(t){if((t/=.5)<1)return-.5*(Math.sqrt(1-t*t)-1);return.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t=t-1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;if((t/=.5)<1)return.5*(t*t*(((e*=1.525)+1)*t-e));return.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},setEasingByName:function(t){switch(t){case"easeLinear":return i.ease.easeLinear;break;case"easeInQuad":return i.ease.easeInQuad;break;case"easeOutQuad":return i.ease.easeOutQuad;break;case"easeInOutQuad":return i.ease.easeInOutQuad;break;case"easeInCubic":return i.ease.easeInCubic;break;case"easeOutCubic":return i.ease.easeOutCubic;break;case"easeInOutCubic":return i.ease.easeInOutCubic;break;case"easeInQuart":return i.ease.easeInQuart;break;case"easeOutQuart":return i.ease.easeOutQuart;break;case"easeInOutQuart":return i.ease.easeInOutQuart;break;case"easeInSine":return i.ease.easeInSine;break;case"easeOutSine":return i.ease.easeOutSine;break;case"easeInOutSine":return i.ease.easeInOutSine;break;case"easeInExpo":return i.ease.easeInExpo;break;case"easeOutExpo":return i.ease.easeOutExpo;break;case"easeInOutExpo":return i.ease.easeInOutExpo;break;case"easeInCirc":return i.ease.easeInCirc;break;case"easeOutCirc":return i.ease.easeOutCirc;break;case"easeInOutCirc":return i.ease.easeInOutCirc;break;case"easeInBack":return i.ease.easeInBack;break;case"easeOutBack":return i.ease.easeOutBack;break;case"easeInOutBack":return i.ease.easeInOutBack;break;default:return i.ease.easeLinear;break}}};i.ease=J;i.easeLinear="easeLinear";i.easeInQuad="easeInQuad";i.easeOutQuad="easeOutQuad";i.easeInOutQuad="easeInOutQuad";i.easeInCubic="easeInCubic";i.easeOutCubic="easeOutCubic";i.easeInOutCubic="easeInOutCubic";i.easeInQuart="easeInQuart";i.easeOutQuart="easeOutQuart";i.easeInOutQuart="easeInOutQuart";i.easeInSine="easeInSine";i.easeOutSine="easeOutSine";i.easeInOutSine="easeInOutSine";i.easeInExpo="easeInExpo";i.easeOutExpo="easeOutExpo";i.easeInOutExpo="easeInOutExpo";i.easeInCirc="easeInCirc";i.easeOutCirc="easeOutCirc";i.easeInOutCirc="easeInOutCirc";i.easeInBack="easeInBack";i.easeOutBack="easeOutBack";i.easeInOutBack="easeInOutBack";function X(t,e,n){this.element=n;this.type=i.Util.initValue(t,"canvas");this.proton=e;this.renderer=this.getRenderer()}X.prototype={start:function(){this.addEventHandler();this.renderer.start()},stop:function(){this.renderer.stop()},resize:function(t,e){this.renderer.resize(t,e)},setStroke:function(t,e){if(this.renderer.hasOwnProperty("stroke"))this.renderer.setStroke(t,e);else alert("Sorry this renderer do not suppest stroke method!")},createImageData:function(t){if(this.renderer instanceof i.PixelRender)this.renderer.createImageData(t)},setMaxRadius:function(t){if(this.renderer instanceof i.WebGLRender)this.renderer.setMaxRadius(t)},blendEquation:function(t){if(this.renderer instanceof i.WebGLRender)this.renderer.blendEquation(t)},blendFunc:function(t,e){if(this.renderer instanceof i.WebGLRender)this.renderer.blendFunc(t,e)},setType:function(t){this.type=t;this.renderer=this.getRenderer()},getRenderer:function(){switch(this.type){case"dom":return new i.DomRender(this.proton,this.element);break;case"canvas":return new i.CanvasRender(this.proton,this.element);break;case"webgl":return new i.WebGLRender(this.proton,this.element);break;case"easel":return new i.EaselRender(this.proton,this.element);break;case"easeljs":return new i.EaselRender(this.proton,this.element);break;case"pixel":return new i.PixelRender(this.proton,this.element);break;default:return new i.BaseRender(this.proton,this.element)}},render:function(t){this.renderer.render(t)},addEventHandler:function(){if(this.onProtonUpdate)this.renderer.onProtonUpdate=this.onProtonUpdate;if(this.onParticleCreated)this.renderer.onParticleCreated=this.onParticleCreated;if(this.onParticleUpdate)this.renderer.onParticleUpdate=this.onParticleUpdate;if(this.onParticleDead)this.renderer.onParticleDead=this.onParticleDead;
}};i.Renderer=X;function z(t,e,i){this.proton=t;this.element=e;this.stroke=i}z.prototype={start:function(){var t=this;this.proton.addEventListener(i.PROTON_UPDATE,function(e){t.onProtonUpdate.call(t)});this.proton.addEventListener(i.PROTON_UPDATE_AFTER,function(e){t.onProtonUpdateAfter.call(t)});this.proton.addEventListener(i.EMITTER_ADDED,function(e){t.onEmitterAdded.call(t,e.emitter)});this.proton.addEventListener(i.EMITTER_REMOVED,function(e){t.onEmitterRemoved.call(t,e.emitter)});var e=this.proton.emitters.length,n;for(n=0;n<e;n++){var r=this.proton.emitters[n];this.addEmitterListener(r)}},resize:function(t,e){},addEmitterListener:function(t){var e=this;t.addEventListener(i.PARTICLE_CREATED,function(t){e.onParticleCreated.call(e,t.particle)});t.addEventListener(i.PARTICLE_UPDATE,function(t){e.onParticleUpdate.call(e,t.particle)});t.addEventListener(i.PARTICLE_DEAD,function(t){e.onParticleDead.call(e,t.particle)})},stop:function(){var t=this.proton.emitters.length,e;this.proton.removeAllEventListeners();for(e=0;e<t;e++){var i=this.proton.emitters[e];i.removeAllEventListeners()}},onEmitterAdded:function(t){this.addEmitterListener(t)},onEmitterRemoved:function(t){t.removeAllEventListeners()},onProtonUpdate:function(){},onProtonUpdateAfter:function(){},onParticleCreated:function(t){},onParticleUpdate:function(t){},onParticleDead:function(t){}};i.BaseRender=z;function K(t,e){K._super_.call(this,t,e);this.stroke=null}i.Util.inherits(K,i.BaseRender);K.prototype.start=function(){K._super_.prototype.start.call(this)};K.prototype.setStroke=function(t,e){t=i.Util.initValue(t,"#000000");e=i.Util.initValue(e,1);this.stroke={color:t,thinkness:e}};K.prototype.onProtonUpdate=function(){};K.prototype.onParticleCreated=function(t){if(t.target){var e=this;i.Util.getImage(t.target,t,false,function(t){e.setImgInDIV.call(e,t)})}else{t.transform.canvas=i.DomUtil.createCanvas(t.id+"_canvas",t.radius+1,t.radius+1,"absolute");t.transform.bakOldRadius=t.radius;if(this.stroke){t.transform.canvas.width=2*t.radius+this.stroke.thinkness*2;t.transform.canvas.height=2*t.radius+this.stroke.thinkness*2}else{t.transform.canvas.width=2*t.radius+1;t.transform.canvas.height=2*t.radius+1}t.transform.context=t.transform.canvas.getContext("2d");t.transform.context.fillStyle=t.color;t.transform.context.beginPath();t.transform.context.arc(t.radius,t.radius,t.radius,0,Math.PI*2,true);if(this.stroke){t.transform.context.strokeStyle=this.stroke.color;t.transform.context.lineWidth=this.stroke.thinkness;t.transform.context.stroke()}t.transform.context.closePath();t.transform.context.fill();this.element.appendChild(t.transform.canvas)}};K.prototype.onParticleUpdate=function(t){if(t.target){if(t.target instanceof Image){t.transform.canvas.style.opacity=t.alpha;i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.target.width/2,t.p.y-t.target.height/2,t.scale,t.rotation)}}else{t.transform.canvas.style.opacity=t.alpha;if(t.transform["oldRadius"])i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.transform.oldRadius,t.p.y-t.transform.oldRadius,t.scale,t.rotation);else i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.transform.bakOldRadius,t.p.y-t.transform.bakOldRadius,t.scale,t.rotation)}};K.prototype.onParticleDead=function(t){if(t.transform.canvas)this.element.removeChild(t.transform.canvas)};K.prototype.setImgInDIV=function(t){t.transform.canvas=i.DomUtil.createCanvas(t.id+"_canvas",t.target.width+1,t.target.height+1,"absolute",t.p.x-t.radius,t.p.y-t.radius);t.transform.context=t.transform.canvas.getContext("2d");t.transform.context.drawImage(t.target,0,0,t.target.width,t.target.height);this.element.appendChild(t.transform.canvas)};i.DomRender=K;function j(t,e,i){j._super_.call(this,t,e);this.stroke=i}i.Util.inherits(j,i.BaseRender);j.prototype.resize=function(t,e){};j.prototype.start=function(){j._super_.prototype.start.call(this)};j.prototype.onProtonUpdate=function(){};j.prototype.onParticleCreated=function(t){if(t.target){t.target=t.target.clone();if(!t.target.parent){if(!!t.target["image"]){t.target.regX=t.target.image.width/2;t.target.regY=t.target.image.height/2}this.element.addChild(t.target)}}else{var e=new createjs.Graphics;if(this.stroke){if(this.stroke==true){e.beginStroke("#000000")}else if(this.stroke instanceof String){e.beginStroke(this.stroke)}}e.beginFill(t.color).drawCircle(0,0,t.radius);var i=new createjs.Shape(e);t.target=i;this.element.addChild(t.target)}};j.prototype.onParticleUpdate=function(t){if(t.target){t.target.x=t.p.x;t.target.y=t.p.y;t.target.alpha=t.alpha;t.target.scaleX=t.target.scaleY=t.scale;t.target.rotation=t.rotation}};j.prototype.onParticleDead=function(t){if(t.target){if(t.target.parent)t.target.parent.removeChild(t.target)}};i.EaselRender=j;function q(t,e){q._super_.call(this,t,e);this.stroke=null;this.context=this.element.getContext("2d");this.bufferCache={}}i.Util.inherits(q,i.BaseRender);q.prototype.resize=function(t,e){this.element.width=t;this.element.height=e};q.prototype.start=function(){q._super_.prototype.start.call(this)};q.prototype.setStroke=function(t,e){t=i.Util.initValue(t,"#000000");e=i.Util.initValue(e,1);this.stroke={color:t,thinkness:e}};q.prototype.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)};q.prototype.onParticleCreated=function(t){if(t.target)i.Util.getImage(t.target,t,false);else t.color=t.color?t.color:"#ff0000"};q.prototype.onParticleUpdate=function(t){if(t.target){if(t.target instanceof Image){var e=t.target.width*t.scale|0;var n=t.target.height*t.scale|0;var r=t.p.x-e/2;var a=t.p.y-n/2;if(!!t.color){if(!t.transform["buffer"])t.transform.buffer=this.getBuffer(t.target);var o=t.transform.buffer.getContext("2d");o.clearRect(0,0,t.transform.buffer.width,t.transform.buffer.height);o.globalAlpha=t.alpha;o.drawImage(t.target,0,0);o.globalCompositeOperation="source-atop";o.fillStyle=i.Util.rgbToHex(t.transform.rgb);o.fillRect(0,0,t.transform.buffer.width,t.transform.buffer.height);o.globalCompositeOperation="source-over";o.globalAlpha=1;this.context.drawImage(t.transform.buffer,0,0,t.transform.buffer.width,t.transform.buffer.height,r,a,e,n)}else{this.context.save();this.context.globalAlpha=t.alpha;this.context.translate(t.p.x,t.p.y);this.context.rotate(i.MathUtils.degreeTransform(t.rotation));this.context.translate(-t.p.x,-t.p.y);this.context.drawImage(t.target,0,0,t.target.width,t.target.height,r,a,e,n);this.context.globalAlpha=1;this.context.restore()}}}else{if(t.transform["rgb"])this.context.fillStyle="rgba("+t.transform.rgb.r+","+t.transform.rgb.g+","+t.transform.rgb.b+","+t.alpha+")";else this.context.fillStyle=t.color;this.context.beginPath();this.context.arc(t.p.x,t.p.y,t.radius,0,Math.PI*2,true);if(this.stroke){this.context.strokeStyle=this.stroke.color;this.context.lineWidth=this.stroke.thinkness;this.context.stroke()}this.context.closePath();this.context.fill()}};q.prototype.onParticleDead=function(t){};q.prototype.getBuffer=function(t){if(t instanceof Image){var e=t.width+"_"+t.height;var i=this.bufferCache[e];if(!i){i=document.createElement("canvas");i.width=t.width;i.height=t.height;this.bufferCache[e]=i}return i}};i.CanvasRender=q;function Z(t,e,i){Z._super_.call(this,t,e);this.context=this.element.getContext("2d");this.imageData=null;this.rectangle=null;this.rectangle=i;this.createImageData(i)}i.Util.inherits(Z,i.BaseRender);Z.prototype.resize=function(t,e){this.element.width=t;this.element.height=e};Z.prototype.createImageData=function(t){if(!t)this.rectangle=new i.Rectangle(0,0,this.element.width,this.element.height);else this.rectangle=t;this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height);this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)};Z.prototype.start=function(){Z._super_.prototype.start.call(this)};Z.prototype.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height);this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)};Z.prototype.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)};Z.prototype.onParticleCreated=function(t){};Z.prototype.onParticleUpdate=function(t){if(this.imageData){this.setPixel(this.imageData,Math.floor(t.p.x-this.rectangle.x),Math.floor(t.p.y-this.rectangle.y),t)}};Z.prototype.setPixel=function(t,e,i,n){var r=n.transform.rgb;if(e<0||e>this.element.width||i<0||i>this.elementwidth)return;var a=((i>>0)*t.width+(e>>0))*4;t.data[a]=r.r;t.data[a+1]=r.g;t.data[a+2]=r.b;t.data[a+3]=n.alpha*255};Z.prototype.onParticleDead=function(t){};i.PixelRender=Z;function Q(t,e){Q._super_.call(this,t,e);this.gl=this.element.getContext("experimental-webgl",{antialias:true,stencil:false,depth:false});if(!this.gl)alert("Sorry your browser do not suppest WebGL!");this.initVar();this.setMaxRadius();this.initShaders();this.initBuffers();this.gl.blendEquation(this.gl.FUNC_ADD);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.enable(this.gl.BLEND)}i.Util.inherits(Q,i.BaseRender);Q.prototype.resize=function(t,e){this.umat[4]=-2;this.umat[7]=1;this.smat[0]=1/t;this.smat[4]=1/e;this.mstack.set(this.umat,0);this.mstack.set(this.smat,1);this.gl.viewport(0,0,t,e);this.element.width=t;this.element.height=e};Q.prototype.setMaxRadius=function(t){this.circleCanvasURL=this.createCircle(t)};Q.prototype.getVertexShader=function(){var t=["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join("\n");return t};Q.prototype.getFragmentShader=function(){var t=["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join("\n");return t};Q.prototype.initVar=function(){this.mstack=new i.MStack;this.umat=i.Mat3.create([2,0,1,0,-2,0,-1,1,1]);this.smat=i.Mat3.create([1/100,0,1,0,1/100,0,0,0,1]);this.texturebuffers={}};Q.prototype.start=function(){Q._super_.prototype.start.call(this);this.resize(this.element.width,this.element.height)};Q.prototype.blendEquation=function(t){this.gl.blendEquation(this.gl[t])};Q.prototype.blendFunc=function(t,e){this.gl.blendFunc(this.gl[t],this.gl[e])};Q.prototype.getShader=function(t,e,i){var n;if(i)n=t.createShader(t.FRAGMENT_SHADER);else n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e);t.compileShader(n);if(!t.getShaderParameter(n,t.COMPILE_STATUS)){alert(t.getShaderInfoLog(n));return null}return n};Q.prototype.initShaders=function(){var t=this.getShader(this.gl,this.getFragmentShader(),true);var e=this.getShader(this.gl,this.getVertexShader(),false);this.sprogram=this.gl.createProgram();this.gl.attachShader(this.sprogram,e);this.gl.attachShader(this.sprogram,t);this.gl.linkProgram(this.sprogram);if(!this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS))alert("Could not initialise shaders");this.gl.useProgram(this.sprogram);this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition");this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord");this.gl.enableVertexAttribArray(this.sprogram.tca);this.gl.enableVertexAttribArray(this.sprogram.vpa);this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat");this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler");this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture");this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor");this.gl.uniform1i(this.sprogram.useTex,1)};Q.prototype.initBuffers=function(){this.unitIBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);var t=[0,3,1,0,2,3];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this.gl.STATIC_DRAW);var e=[];for(var i=0;i<100;i++)e.push(i);idx=new Uint16Array(e);this.unitI33=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW);e=[];for(i=0;i<100;i++)e.push(i,i+1,i+2);idx=new Uint16Array(e);this.stripBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW)};Q.prototype.createCircle=function(t){this.circleCanvasRadius=i.WebGLUtil.nhpot(i.Util.initValue(t,32));var e=i.DomUtil.createCanvas("circle_canvas",this.circleCanvasRadius*2,this.circleCanvasRadius*2);var n=e.getContext("2d");n.beginPath();n.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,Math.PI*2,true);n.closePath();n.fillStyle="#FFF";n.fill();return e.toDataURL()};Q.prototype.setImgInCanvas=function(t){var e=t.target.width;var n=t.target.height;var r=i.WebGLUtil.nhpot(t.target.width);var a=i.WebGLUtil.nhpot(t.target.height);var o=t.target.width/r;var s=t.target.height/a;if(!this.texturebuffers[t.transform.src])this.texturebuffers[t.transform.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()];t.transform.texture=this.texturebuffers[t.transform.src][0];t.transform.vcBuffer=this.texturebuffers[t.transform.src][1];t.transform.tcBuffer=this.texturebuffers[t.transform.src][2];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.tcBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,o,0,0,s,s,s]),this.gl.STATIC_DRAW);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.vcBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,e,0,0,n,e,n]),this.gl.STATIC_DRAW);var h=t.transform.canvas.getContext("2d");var l=h.getImageData(0,0,r,a);this.gl.bindTexture(this.gl.TEXTURE_2D,t.transform.texture);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,l);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST);this.gl.generateMipmap(this.gl.TEXTURE_2D);t.transform.textureLoaded=true;t.transform.textureWidth=e;t.transform.textureHeight=n};Q.prototype.setStroke=function(t,e){};Q.prototype.onProtonUpdate=function(){};Q.prototype.onParticleCreated=function(t){var e=this;t.transform.textureLoaded=false;t.transform.tmat=i.Mat3.create();t.transform.tmat[8]=1;t.transform.imat=i.Mat3.create();t.transform.imat[8]=1;if(t.target){i.Util.getImage(t.target,t,true,function(t){e.setImgInCanvas.call(e,t);t.transform.oldScale=1})}else{i.Util.getImage(this.circleCanvasURL,t,true,function(t){e.setImgInCanvas.call(e,t);t.transform.oldScale=t.radius/e.circleCanvasRadius})}};Q.prototype.onParticleUpdate=function(t){if(t.transform.textureLoaded){this.updateMatrix(t);this.gl.uniform3f(this.sprogram.color,t.transform.rgb.r/255,t.transform.rgb.g/255,t.transform.rgb.b/255);this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,false,this.mstack.top());this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.vcBuffer);this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,false,0,0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.tcBuffer);this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,false,0,0);this.gl.bindTexture(this.gl.TEXTURE_2D,t.transform.texture);this.gl.uniform1i(this.sprogram.samplerUniform,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.mstack.pop()}};Q.prototype.onParticleDead=function(t){};Q.prototype.updateMatrix=function(t){var e=i.WebGLUtil.makeTranslation(-t.transform.textureWidth/2,-t.transform.textureHeight/2);var n=i.WebGLUtil.makeTranslation(t.p.x,t.p.y);var r=t.rotation*(Math.PI/180);var a=i.WebGLUtil.makeRotation(r);var o=t.scale*t.transform.oldScale;var s=i.WebGLUtil.makeScale(o,o);var h=i.WebGLUtil.matrixMultiply(e,s);h=i.WebGLUtil.matrixMultiply(h,a);h=i.WebGLUtil.matrixMultiply(h,n);i.Mat3.inverse(h,t.transform.imat);h[2]=t.alpha;this.mstack.push(h)};i.WebGLRender=Q;function $(){this.vector=new i.Vector2D(0,0);this.random=0;this.crossType="dead";this.alert=true}$.prototype={getPosition:function(){},crossing:function(t){}};i.Zone=$;function tt(t,e,n,r,a){tt._super_.call(this);if(n-t>=0){this.x1=t;this.y1=e;this.x2=n;this.y2=r}else{this.x1=n;this.y1=r;this.x2=t;this.y2=e}this.dx=this.x2-this.x1;this.dy=this.y2-this.y1;this.minx=Math.min(this.x1,this.x2);this.miny=Math.min(this.y1,this.y2);this.maxx=Math.max(this.x1,this.x2);this.maxy=Math.max(this.y1,this.y2);this.dot=this.x2*this.y1-this.x1*this.y2;this.xxyy=this.dx*this.dx+this.dy*this.dy;this.gradient=this.getGradient();this.length=this.getLength();this.direction=i.Util.initValue(a,">")}i.Util.inherits(tt,i.Zone);tt.prototype.getPosition=function(){this.random=Math.random();this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient);this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient);return this.vector};tt.prototype.getDirection=function(t,e){var i=this.dy;var n=-this.dx;var r=this.dot;var a=n==0?1:n;if((i*t+n*e+r)*a>0)return true;else return false};tt.prototype.getDistance=function(t,e){var i=this.dy;var n=-this.dx;var r=this.dot;var a=i*t+n*e+r;return a/Math.sqrt(this.xxyy)};tt.prototype.getSymmetric=function(t){var e=t.getGradient();var i=this.getGradient();var n=2*(i-e);var r=t.x;var a=t.y;t.x=r*Math.cos(n)-a*Math.sin(n);t.y=r*Math.sin(n)+a*Math.cos(n);return t};tt.prototype.getGradient=function(){return Math.atan2(this.dy,this.dx)};tt.prototype.getRange=function(t,e){var i=Math.abs(this.getGradient());if(i<=Math.PI/4){if(t.p.x<this.maxx&&t.p.x>this.minx){e()}}else{if(t.p.y<this.maxy&&t.p.y>this.miny){e()}}};tt.prototype.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)};tt.prototype.crossing=function(t){var e=this;if(this.crossType=="dead"){if(this.direction==">"||this.direction=="R"||this.direction=="right"||this.direction=="down"){this.getRange(t,function(){if(e.getDirection(t.p.x,t.p.y))t.dead=true})}else{this.getRange(t,function(){if(!e.getDirection(t.p.x,t.p.y))t.dead=true})}}else if(this.crossType=="bound"){this.getRange(t,function(){if(e.getDistance(t.p.x,t.p.y)<=t.radius){if(e.dx==0){t.v.x*=-1}else if(e.dy==0){t.v.y*=-1}else{e.getSymmetric(t.v)}}})}else if(this.crossType=="cross"){if(this.alert){alert("Sorry lineZone does not support cross method");this.alert=false}}};i.LineZone=tt;function et(t,e,i){et._super_.call(this);this.x=t;this.y=e;this.radius=i;this.angle=0;this.center={x:this.x,y:this.y}}i.Util.inherits(et,i.Zone);et.prototype.getPosition=function(){this.random=Math.random();this.angle=Math.PI*2*Math.random();this.vector.x=this.x+this.random*this.radius*Math.cos(this.angle);this.vector.y=this.y+this.random*this.radius*Math.sin(this.angle);return this.vector};et.prototype.setCenter=function(t,e){this.center.x=t;this.center.y=e};et.prototype.crossing=function(t){var e=t.p.distanceTo(this.center);if(this.crossType=="dead"){if(e-t.radius>this.radius)t.dead=true}else if(this.crossType=="bound"){if(e+t.radius>=this.radius)this.getSymmetric(t)}else if(this.crossType=="cross"){if(this.alert){alert("Sorry CircleZone does not support cross method");this.alert=false}}};et.prototype.getSymmetric=function(t){var e=t.v.getGradient();var i=this.getGradient(t);var n=2*(i-e);var r=t.v.x;var a=t.v.y;t.v.x=r*Math.cos(n)-a*Math.sin(n);t.v.y=r*Math.sin(n)+a*Math.cos(n)};et.prototype.getGradient=function(t){return-Math.PI/2+Math.atan2(t.p.y-this.center.y,t.p.x-this.center.x)};i.CircleZone=et;function it(t,e){it._super_.call(this);this.x=t;this.y=e}i.Util.inherits(it,i.Zone);it.prototype.getPosition=function(){this.vector.x=this.x;this.vector.y=this.y;return this.vector};it.prototype.crossing=function(t){if(this.alert){alert("Sorry PointZone does not support crossing method");this.alert=false}};i.PointZone=it;function nt(t,e,i,n){nt._super_.call(this);this.x=t;this.y=e;this.width=i;this.height=n}i.Util.inherits(nt,i.Zone);nt.prototype.getPosition=function(){this.vector.x=this.x+Math.random()*this.width;this.vector.y=this.y+Math.random()*this.height;return this.vector};nt.prototype.crossing=function(t){if(this.crossType=="dead"){if(t.p.x+t.radius<this.x)t.dead=true;else if(t.p.x-t.radius>this.x+this.width)t.dead=true;if(t.p.y+t.radius<this.y)t.dead=true;else if(t.p.y-t.radius>this.y+this.height)t.dead=true}else if(this.crossType=="bound"){if(t.p.x-t.radius<this.x){t.p.x=this.x+t.radius;t.v.x*=-1}else if(t.p.x+t.radius>this.x+this.width){t.p.x=this.x+this.width-t.radius;t.v.x*=-1}if(t.p.y-t.radius<this.y){t.p.y=this.y+t.radius;t.v.y*=-1}else if(t.p.y+t.radius>this.y+this.height){t.p.y=this.y+this.height-t.radius;t.v.y*=-1}}else if(this.crossType=="cross"){if(t.p.x+t.radius<this.x&&t.v.x<=0)t.p.x=this.x+this.width+t.radius;else if(t.p.x-t.radius>this.x+this.width&&t.v.x>=0)t.p.x=this.x-t.radius;if(t.p.y+t.radius<this.y&&t.v.y<=0)t.p.y=this.y+this.height+t.radius;else if(t.p.y-t.radius>this.y+this.height&&t.v.y>=0)t.p.y=this.y-t.radius}};i.RectZone=nt;function rt(t,e,i,n){rt._super_.call(this);this.reset(t,e,i,n)}i.Util.inherits(rt,i.Zone);rt.prototype.reset=function(t,e,n,r){this.imageData=t;this.x=i.Util.initValue(e,0);this.y=i.Util.initValue(n,0);this.d=i.Util.initValue(r,2);this.vectors=[];this.setVectors()};rt.prototype.setVectors=function(){var t,e;var i=this.imageData.width;var n=this.imageData.height;for(t=0;t<i;t+=this.d){for(e=0;e<n;e+=this.d){var r=((e>>0)*i+(t>>0))*4;if(this.imageData.data[r+3]>0){this.vectors.push({x:t+this.x,y:e+this.y})}}}return this.vector};rt.prototype.getBound=function(t,e){var i=((e>>0)*this.imageData.width+(t>>0))*4;if(this.imageData.data[i+3]>0)return true;else return false};rt.prototype.getPosition=function(){return this.vector.copy(this.vectors[Math.floor(Math.random()*this.vectors.length)])};rt.prototype.getColor=function(t,e){t-=this.x;e-=this.y;var i=((e>>0)*this.imageData.width+(t>>0))*4;return{r:this.imageData.data[i],g:this.imageData.data[i+1],b:this.imageData.data[i+2],a:this.imageData.data[i+3]}};rt.prototype.crossing=function(t){if(this.crossType=="dead"){if(this.getBound(t.p.x-this.x,t.p.y-this.y))t.dead=true;else t.dead=false}else if(this.crossType=="bound"){if(!this.getBound(t.p.x-this.x,t.p.y-this.y))t.v.negate()}};i.ImageZone=rt;var at=function(){if(t.console&&t.console.log){var e=arguments;if(typeof arguments[0]=="string"){if(arguments[0].indexOf("+")==0){var i=parseInt(arguments[0]);if(at.once<i){delete e[0];console.log(e);at.once++}}else{console.log(e)}}else{console.log(e)}}};at.once=0;i.log=at;var ot=ot||{addEventListener:function(t,e){t.addEventListener(i.PROTON_UPDATE,function(t){e()})},setStyle:function(t){var e=t||"#ff0000";var n=i.Util.hexToRGB(e);var r="rgba("+n.r+","+n.g+","+n.b+","+.5+")";return r},drawZone:function(t,e,n,r){var a=e.getContext("2d");var o=this.setStyle();this.addEventListener(t,function(){if(r)a.clearRect(0,0,e.width,e.height);if(n instanceof i.PointZone){a.beginPath();a.fillStyle=o;a.arc(n.x,n.y,10,0,Math.PI*2,true);a.fill();a.closePath()}else if(n instanceof i.LineZone){a.beginPath();a.strokeStyle=o;a.moveTo(n.x1,n.y1);a.lineTo(n.x2,n.y2);a.stroke();a.closePath()}else if(n instanceof i.RectZone){a.beginPath();a.strokeStyle=o;a.drawRect(n.x,n.y,n.width,n.height);a.stroke();a.closePath()}else if(n instanceof i.CircleZone){a.beginPath();a.strokeStyle=o;a.arc(n.x,n.y,n.radius,0,Math.PI*2,true);a.stroke();a.closePath()}})},drawEmitter:function(t,e,i,n){var r=e.getContext("2d");var a=this.setStyle();this.addEventListener(t,function(){if(n)r.clearRect(0,0,e.width,e.height);r.beginPath();r.fillStyle=a;r.arc(i.p.x,i.p.y,10,0,Math.PI*2,true);r.fill();r.closePath()})},test:{},setTest:function(t,e){this.test[t]=e},getTest:function(t){if(this.test.hasOwnProperty(t))return this.test[t];else return false}};i.Debug=ot})(window);(function(){var t=0;var e=["ms","moz","webkit","o"];for(var i=0;i<e.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(e,i){var n=(new Date).getTime();var r=Math.max(0,16-(n-t));var a=window.setTimeout(function(){e(n+r)},r);t=n+r;return a};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(t){clearTimeout(t)}})();function UIFourJoint(){return}UIFourJoint.prototype=new UIElement;UIFourJoint.prototype.isUIJoint=true;UIFourJoint.prototype.isUIFourJoint=true;UIFourJoint.prototype.initUIFourJoint=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.points=[{x:0,y:80},{x:0,y:0},{x:80,y:0},{x:80,y:80}];this.regSerializer(this.fourJointToJson,this.fourJointFromJson);return this};UIFourJoint.prototype.fourJointToJson=function(t){t.points=[{},{},{},{}];t.points[0].x=this.points[0].x;t.points[0].y=this.points[0].y;t.points[1].x=this.points[1].x;t.points[1].y=this.points[1].y;t.points[2].x=this.points[2].x;t.points[2].y=this.points[2].y;t.points[3].x=this.points[3].x;t.points[3].y=this.points[3].y;return};UIFourJoint.prototype.fourJointFromJson=function(t){if(t.points){this.points=t.points}return};UIFourJoint.prototype.asIcon=function(){if(!this.isIcon){this.isIcon=true;this.points=[{x:0,y:80},{x:20,y:0},{x:60,y:0},{x:80,y:80}]}return};UIFourJoint.prototype.relayout=function(){if(this.disableRelayout||this.mode===Shape.MODE_EDITING){return}var t=getParentShapeOfShape(this);var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.points[0].x=e*this.x0Param;this.points[1].x=e*this.x1Param;this.points[2].x=e*this.x2Param;this.points[3].x=e*this.x3Param}if(this.yAttr===UIElement.Y_SCALE){this.points[0].y=i*this.y0Param;this.points[1].y=i*this.y1Param;this.points[2].y=i*this.y2Param;this.points[3].y=i*this.y3Param}return};UIFourJoint.prototype.updateLayoutParams=function(){this.xParam=1;this.yParam=1;var t=this.parentShape;if(!t){return}var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.x0Param=this.points[0].x/e;this.x1Param=this.points[1].x/e;this.x2Param=this.points[2].x/e;this.x3Param=this.points[3].x/e}if(this.yAttr===UIElement.Y_SCALE){this.y0Param=this.points[0].y/i;this.y1Param=this.points[1].y/i;this.y2Param=this.points[2].y/i;this.y3Param=this.points[3].y/i}return};UIFourJoint.prototype.hitTest=function(t){if(Math.distanceBetween(t,this.points[0])<20){return 1}if(Math.distanceBetween(t,this.points[1])<20){return 2}if(Math.distanceBetween(t,this.points[2])<20){return 3}if(Math.distanceBetween(t,this.points[3])<20){return 4}return Shape.HIT_TEST_NONE};UIFourJoint.prototype.getSelectMark=function(t,e){var i=this.points.length;if(t<=i){e.x=this.points[t-1].x;e.y=this.points[t-1].y;return true}return false};UIFourJoint.prototype.onAppendedInParent=function(){if(this.isCreatingElement()){var t=this.getParent();var e=t.getPositionInView();this.points[0].x-=e.x;this.points[0].y-=e.y;this.points[1].x-=e.x;this.points[1].y-=e.y;this.points[2].x-=e.x;this.points[2].y-=e.y;this.points[3].x-=e.x;this.points[3].y-=e.y}return};UIFourJoint.prototype.drawSelectMarks=function(t){return UITwoJoint.prototype.drawSelectMarks.call(this,t)};UIFourJoint.prototype.getMinMaxX=function(){var t=this.points[0].x;var e=t;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(n.x>t){t=n.x}if(n.x<e){e=n.x}}return{min:e,max:t}};UIFourJoint.prototype.getMinMaxY=function(){var t=this.points[0].y;var e=t;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(n.y>t){t=n.y}if(n.y<e){e=n.y}}return{min:e,max:t}};UIFourJoint.prototype.getX=function(){return this.getMinMaxX().min};UIFourJoint.prototype.getY=function(){return this.getMinMaxY().min};UIFourJoint.prototype.getWidth=function(){var t=this.getMinMaxX();return t.max-t.min};UIFourJoint.prototype.getHeight=function(){var t=this.getMinMaxY();return t.max-t.min};UIFourJoint.prototype.paintSelf=function(t){t.save();if(this.isIcon){this.translate(t)}var e=this.anchorSize?this.anchorSize:5;t.lineWidth=this.style.lineWidth;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;t.beginPath();t.moveTo(this.points[0].x,this.points[0].y);t.lineTo(this.points[1].x,this.points[1].y);t.lineTo(this.points[2].x,this.points[2].y);t.lineTo(this.points[3].x,this.points[3].y);t.stroke();t.beginPath();t.arc(this.points[0].x,this.points[0].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[1].x,this.points[1].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[2].x,this.points[2].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[3].x,this.points[3].y,e,0,Math.PI*2);t.fill();t.beginPath();t.restore();this.drawSelectMarks(t);return};UIFourJoint.prototype.shapeCanBeChild=function(t){return false};UIFourJoint.prototype.onPointerDownNormal=function(t){this.hitTestResult=this.hitTest(t);this.selected=this.hitTestResult!=Shape.HIT_TEST_NONE;return this.hitTestResult};UIFourJoint.prototype.onPointerMoveNormal=function(t){if(this.mode===Shape.MODE_EDITING&&this.hitTestResult>0){var e=this.hitTestResult-1;this.points[e].x=t.x;this.points[e].y=t.y}};UIFourJoint.prototype.onPointerUpNormal=function(t){this.hitTestResult=Shape.HIT_TEST_NONE;return};UIFourJoint.prototype.onPointerDownCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.state=Shape.STAT_NORMAL}default:{return false}}};UIFourJoint.prototype.onPointerMoveCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.points[0].x=t.x;this.points[0].y=t.y+80;this.points[1].x=t.x+20;this.points[1].y=t.y;this.points[2].x=t.x+60;this.points[2].y=t.y;this.points[3].x=t.x+80;this.points[3].y=t.y+80;return true}default:{return false}}};function UIFourJointCreator(){var t=["ui-four-joint","ui-four-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFourJoint;return e.initUIFourJoint(this.type,200,200)};return}var __extends=this&&this.__extends||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)};var Matrix=function(){function t(t,e,i,n,r,a){if(t===void 0){t=1}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=1}if(r===void 0){r=0}if(a===void 0){a=0}this.a=t;this.b=e;this.c=i;this.d=n;this.tx=r;this.ty=a}var e=t.prototype;e.prepend=function(t,e,i,n,r,a){var o=this.tx;if(t!=1||e!=0||i!=0||n!=1){var s=this.a;var h=this.c;this.a=s*t+this.b*i;this.b=s*e+this.b*n;this.c=h*t+this.d*i;this.d=h*e+this.d*n}this.tx=o*t+this.ty*i+r;this.ty=o*e+this.ty*n+a;return this};e.append=function(t,e,i,n,r,a){var o=this.a;var s=this.b;var h=this.c;var l=this.d;if(t!=1||e!=0||i!=0||n!=1){this.a=t*o+e*h;this.b=t*s+e*l;this.c=i*o+n*h;this.d=i*s+n*l}this.tx=r*o+a*h+this.tx;this.ty=r*s+a*l+this.ty;return this};e.prependTransform=function(t,e,i,n,r,a,o,s,h){if(r%360){var l=r;var u=egret.NumberUtils.cos(l);var c=egret.NumberUtils.sin(l)}else{u=1;c=0}if(s||h){this.tx-=s;this.ty-=h}if(a||o){this.prepend(u*i,c*i,-c*n,u*n,0,0);this.prepend(egret.NumberUtils.cos(o),egret.NumberUtils.sin(o),-egret.NumberUtils.sin(a),egret.NumberUtils.cos(a),t,e)}else{this.prepend(u*i,c*i,-c*n,u*n,t,e)}return this};e.appendTransform=function(t,e,i,n,r,a,o,s,h){if(r%360){var l=r;var u=egret.NumberUtils.cos(l);var c=egret.NumberUtils.sin(l)}else{u=1;c=0}if(a||o){this.append(egret.NumberUtils.cos(o),egret.NumberUtils.sin(o),-egret.NumberUtils.sin(a),egret.NumberUtils.cos(a),t,e);this.append(u*i,c*i,-c*n,u*n,0,0)}else{this.append(u*i,c*i,-c*n,u*n,t,e)}if(s||h){this.tx-=s*this.a+h*this.c;this.ty-=s*this.b+h*this.d}return this;
};e.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;var r=this.c;var a=this.tx;this.a=n*e-this.b*i;this.b=n*i+this.b*e;this.c=r*e-this.d*i;this.d=r*i+this.d*e;this.tx=a*e-this.ty*i;this.ty=a*i+this.ty*e;return this};e.skew=function(t,e){this.append(egret.NumberUtils.cos(e),egret.NumberUtils.sin(e),-egret.NumberUtils.sin(t),egret.NumberUtils.cos(t),0,0);return this};e.scale=function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;return this};e.translate=function(t,e){this.tx+=t;this.ty+=e;return this};e.identity=function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this};e.identityMatrix=function(t){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.tx=t.tx;this.ty=t.ty;return this};e.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var a=t*n-e*i;this.a=n/a;this.b=-e/a;this.c=-i/a;this.d=t/a;this.tx=(i*this.ty-n*r)/a;this.ty=-(t*this.ty-e*r)/a;return this};t.transformCoords=function(t,e,i){var n=egret.Point.identity;n.x=t.a*e+t.c*i+t.tx;n.y=t.d*i+t.b*e+t.ty;return n};e.toArray=function(t){if(!this.array){this.array=new Float32Array(9)}if(t){this.array[0]=this.a;this.array[1]=this.b;this.array[2]=0;this.array[3]=this.c;this.array[4]=this.d;this.array[5]=0;this.array[6]=this.tx;this.array[7]=this.ty;this.array[8]=1}else{this.array[0]=this.a;this.array[1]=this.b;this.array[2]=this.tx;this.array[3]=this.c;this.array[4]=this.d;this.array[5]=this.ty;this.array[6]=0;this.array[7]=0;this.array[8]=1}return this.array};e.setTo=function(t,e,i,n,r,a){this.a=t;this.b=e;this.c=i;this.d=n;this.tx=r;this.ty=a};e.copyFrom=function(t){this.identityMatrix(t)};e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)};e.concat=function(t){var e=this.a;var i=this.b;var n=this.c;var r=this.d;var a=this.tx;var o=this.ty;var s=t.a;var h=t.b;var l=t.c;var u=t.d;var c=t.tx;var p=t.ty;var f=e*s;var m=0;var d=0;var g=r*u;var y=a*s+c;var v=o*u+p;if(i!=0||n!=0||h!=0||l!=0){f+=i*l;g+=n*h;m+=e*h+i*u;d+=n*s+r*l;y+=o*l;v+=a*h}this.a=f;this.b=m;this.c=d;this.d=g;this.tx=y;this.ty=v};e.deltaTransformPoint=function(t){var e=this;var i=e.a*t.x+e.c*t.y;var n=e.b*t.x+e.d*t.y;return new egret.Point(i,n)};e.transformPoint=function(t){var e=this;var i=e.a*t.x+e.c*t.y+e.tx;var n=e.b*t.x+e.d*t.y+e.ty;return new egret.Point(i,n)};e.toString=function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"};e.createBox=function(t,e,i,n,r){if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=0}var a=this;if(i!==0){i=i/egret.Matrix.DEG_TO_RAD;var o=egret.NumberUtils.cos(i);var s=egret.NumberUtils.sin(i);a.a=o*t;a.b=s*e;a.c=-s*t;a.d=o*e}else{a.a=t;a.b=0;a.c=0;a.d=e}a.tx=n;a.ty=r};e.createGradientBox=function(t,e,i,n,r){if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=0}this.createBox(t/1638.4,e/1638.4,i,n+t/2,r+e/2)};t.identity=new t;t.DEG_TO_RAD=Math.PI/180;return t}();var Rectangle=function(){function t(t,e,i,n){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=0}this.x=t;this.y=e;this.width=i;this.height=n}var e=t.prototype;Object.defineProperty(e,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t;this.x=t},enumerable:true,configurable:true});Object.defineProperty(e,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:true,configurable:true});Object.defineProperty(e,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t;this.y=t},enumerable:true,configurable:true});Object.defineProperty(e,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:true,configurable:true});Object.defineProperty(e,"topLeft",{get:function(){return new egret.Point(this.left,this.top)},set:function(t){this.top=t.y;this.left=t.x},enumerable:true,configurable:true});Object.defineProperty(e,"bottomRight",{get:function(){return new egret.Point(this.right,this.bottom)},set:function(t){this.bottom=t.y;this.right=t.x},enumerable:true,configurable:true});e.initialize=function(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n;return this};e.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e};e.intersects=function(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)};e.setEmpty=function(){this.x=0;this.y=0;this.width=0;this.height=0};e.clone=function(){return new t(this.x,this.y,this.width,this.height)};e.containsPoint=function(t){if(this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y){return true}return false};e.setTo=function(t,e,i,n){this.initialize(t,e,i,n)};e.copyFrom=function(t){this.x=t.x;this.y=t.y;this.width=t.width;this.height=t.height};e.inflate=function(t,e){this.x-=t;this.width+=2*t;this.y-=e;this.height+=2*e};e.isEmpty=function(){return this.width==0||this.height==0};e.containsRect=function(t){var e=t.x+t.width;var i=t.y+t.height;var n=this.x+this.width;var r=this.y+this.height;return t.x>=this.x&&t.x<n&&t.y>=this.y&&t.y<r&&e>this.x&&e<=n&&i>this.y&&i<=r};e.equals=function(t){if(this===t){return true}return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height};e.inflatePoint=function(t){this.inflate(t.x,t.y)};e.intersection=function(t){var e=this.clone();var i=e.x;var n=e.y;var r=t.x;var a=t.y;var o=Math.max(i,r);var s=Math.min(i+e.width,r+t.width);if(o<=s){var h=Math.max(n,a);var l=Math.min(n+e.height,a+t.height);if(h<=l){e.setTo(o,h,s-o,l-h);return e}}e.setEmpty();return e};e.offset=function(t,e){this.x+=t;this.y+=e};e.offsetPoint=function(t){this.offset(t.x,t.y)};e.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"};e.union=function(t){var e=this.clone();if(t.isEmpty()){return e}if(e.isEmpty()){e.copyFrom(t);return e}var i=Math.min(e.x,t.x);var n=Math.min(e.y,t.y);e.setTo(i,n,Math.max(e.right,t.right)-i,Math.max(e.bottom,t.bottom)-n);return e};t.identity=new t(0,0,0,0);return t}();var DisplayObjectProperties=function(){function t(){this._name=null;this._explicitWidth=NaN;this._explicitHeight=NaN;this._x=0;this._y=0;this._scaleX=1;this._scaleY=1;this._anchorOffsetX=0;this._anchorOffsetY=0;this._anchorX=0;this._anchorY=0;this._rotation=0;this._alpha=1;this._skewX=0;this._skewY=0;this._blendMode=null;this._touchEnabled=t.defaultTouchEnabled;this._visible=true;this._worldAlpha=1;this._scrollRect=null;this._cacheAsBitmap=false;this._parent=null;this._stage=null;this._needDraw=false;this._filters=null;this._hasWidthSet=false;this._hasHeightSet=false;this._normalDirty=true;this._sizeDirty=true;this._isContainer=false}t.defaultTouchEnabled=false;return t}();var DisplayObjectPrivateProperties=function(){function t(){this._hitTestPointTexture=null;this._rectW=0;this._rectH=0;this._cacheDirty=false}return t}();var DisplayObject=function(){function t(){this._texture_to_render=null;this._worldBounds=null;this.__hack_local_matrix=null;this._sizeChangeCallBack=null;this._sizeChangeCallTarget=null;this.mask=null;this.renderTexture=null;this._DO_Props_=new DisplayObjectProperties;this._DO_Privs_=new DisplayObjectPrivateProperties;this._worldTransform=new Matrix;this._worldBounds=new Rectangle(0,0,0,0);this._DO_Privs_._cacheBounds=new Rectangle(0,0,0,0)}t.prototype._setDirty=function(){this._DO_Props_._normalDirty=true};t.prototype.getDirty=function(){return this._DO_Props_._normalDirty||this._DO_Props_._sizeDirty};t.prototype._setParentSizeDirty=function(){var t=this._DO_Props_._parent;if(t){if(!(t._DO_Props_._hasWidthSet||t._DO_Props_._hasHeightSet)){t._setSizeDirty()}else{t._setCacheDirty()}}};t.prototype._setSizeDirty=function(){var t=this;var e=t._DO_Props_;if(e._sizeDirty){return}e._sizeDirty=true;this._setDirty();this._setCacheDirty();this._setParentSizeDirty();if(t._sizeChangeCallBack!=null){if(t._sizeChangeCallTarget==e._parent){t._sizeChangeCallBack.call(t._sizeChangeCallTarget)}else{t._sizeChangeCallBack=null;t._sizeChangeCallTarget=null}}};t.prototype._clearDirty=function(){this._DO_Props_._normalDirty=false};t.prototype._clearSizeDirty=function(){this._DO_Props_._sizeDirty=false};Object.defineProperty(t.prototype,"name",{get:function(){return this._DO_Props_._name},set:function(t){this._DO_Props_._name=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parent",{get:function(){return this._DO_Props_._parent},enumerable:true,configurable:true});t.prototype._parentChanged=function(t){this._DO_Props_._parent=t};Object.defineProperty(t.prototype,"x",{get:function(){return this._DO_Props_._x},set:function(t){this._setX(t)},enumerable:true,configurable:true});t.prototype._setX=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._x!=t){this._DO_Props_._x=t;this._setDirty();this._setParentSizeDirty()}};Object.defineProperty(t.prototype,"y",{get:function(){return this._DO_Props_._y},set:function(t){this._setY(t)},enumerable:true,configurable:true});t.prototype._setY=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._y!=t){this._DO_Props_._y=t;this._setDirty();this._setParentSizeDirty()}};Object.defineProperty(t.prototype,"scaleX",{get:function(){return this._DO_Props_._scaleX},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._scaleX!=t){this._DO_Props_._scaleX=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scaleY",{get:function(){return this._DO_Props_._scaleY},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._scaleY!=t){this._DO_Props_._scaleY=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"anchorOffsetX",{get:function(){return this._DO_Props_._anchorOffsetX},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._anchorOffsetX!=t){this._DO_Props_._anchorOffsetX=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"anchorOffsetY",{get:function(){return this._DO_Props_._anchorOffsetY},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._anchorOffsetY!=t){this._DO_Props_._anchorOffsetY=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"anchorX",{get:function(){return this._DO_Props_._anchorX},set:function(t){this._setAnchorX(t)},enumerable:true,configurable:true});t.prototype._setAnchorX=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._anchorX!=t){this._DO_Props_._anchorX=t;this._setDirty();this._setParentSizeDirty()}};Object.defineProperty(t.prototype,"anchorY",{get:function(){return this._DO_Props_._anchorY},set:function(t){this._setAnchorY(t)},enumerable:true,configurable:true});t.prototype._setAnchorY=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._anchorY!=t){this._DO_Props_._anchorY=t;this._setDirty();this._setParentSizeDirty()}};Object.defineProperty(t.prototype,"visible",{get:function(){return this._DO_Props_._visible},set:function(t){this._setVisible(t)},enumerable:true,configurable:true});t.prototype._setVisible=function(t){if(this._DO_Props_._visible!=t){this._DO_Props_._visible=t;this._setSizeDirty()}};Object.defineProperty(t.prototype,"rotation",{get:function(){return this._DO_Props_._rotation},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._rotation!=t){this._DO_Props_._rotation=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._DO_Props_._alpha},set:function(t){this._setAlpha(t)},enumerable:true,configurable:true});t.prototype._setAlpha=function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._alpha!=t){this._DO_Props_._alpha=t;this._setDirty();this._setCacheDirty()}};Object.defineProperty(t.prototype,"skewX",{get:function(){return this._DO_Props_._skewX},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._skewX!=t){this._DO_Props_._skewX=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"skewY",{get:function(){return this._DO_Props_._skewY},set:function(t){if(typeof t==="number"&&!isNaN(t)&&this._DO_Props_._skewY!=t){this._DO_Props_._skewY=t;this._setDirty();this._setParentSizeDirty()}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"touchEnabled",{get:function(){return this._DO_Props_._touchEnabled},set:function(t){this._setTouchEnabled(t)},enumerable:true,configurable:true});t.prototype._setTouchEnabled=function(t){this._DO_Props_._touchEnabled=t};Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._DO_Props_._blendMode},set:function(t){this._DO_Props_._blendMode=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scrollRect",{get:function(){return this._DO_Props_._scrollRect},set:function(t){this._setScrollRect(t)},enumerable:true,configurable:true});t.prototype._setScrollRect=function(t){this._DO_Props_._scrollRect=t;this._setSizeDirty()};Object.defineProperty(t.prototype,"measuredWidth",{get:function(){return this._measureBounds().width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"measuredHeight",{get:function(){return this._measureBounds().height},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"explicitWidth",{get:function(){return this._DO_Props_._explicitWidth},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"explicitHeight",{get:function(){return this._DO_Props_._explicitHeight},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"width",{get:function(){return this._getWidth()},set:function(t){this._setWidth(t)},enumerable:true,configurable:true});t.prototype._getWidth=function(){return this._getSize(Rectangle.identity).width};Object.defineProperty(t.prototype,"height",{get:function(){return this._getHeight()},set:function(t){this._setHeight(t)},enumerable:true,configurable:true});t.prototype._getHeight=function(){return this._getSize(Rectangle.identity).height};t.prototype._setWidth=function(t){this._setSizeDirty();this._setCacheDirty();this._DO_Props_._explicitWidth=t;this._DO_Props_._hasWidthSet=typeof t==="number"&&!isNaN(t)};t.prototype._setHeight=function(t){this._setSizeDirty();this._setCacheDirty();this._DO_Props_._explicitHeight=t;this._DO_Props_._hasHeightSet=typeof t==="number"&&!isNaN(t)};Object.defineProperty(t.prototype,"worldAlpha",{get:function(){return this._DO_Props_._worldAlpha},set:function(t){this._DO_Props_._worldAlpha=t},enumerable:true,configurable:true});t.prototype._draw=function(t){var e=this;if(!e._DO_Props_._visible){e.destroyCacheBounds();return}var i=e.drawCacheTexture(t);if(i){e.destroyCacheBounds();return}var n=MainContext.__use_new_draw&&e._DO_Props_._isContainer;if(e._hasFilters()&&!n){this._setGlobalFilters(t)}t.setAlpha(e.worldAlpha,e.blendMode);t.setTransform(e._worldTransform);var r=e.mask||e._DO_Props_._scrollRect;if(r&&!n){t.pushMask(r)}e._render(t);if(r&&!n){t.popMask()}if(e._hasFilters()&&!n){this._removeGlobalFilters(t)}e.destroyCacheBounds()};t.prototype._setGlobalFilters=function(e){var i=this;var n;if(i._DO_Props_._filters){n=i._DO_Props_._filters.concat()}else{n=[]}if(this._transform){var r=this._transform._colorTransform;var a=t.color;a[0]=r._redMultiplier;a[4]=r._redOffset;a[6]=r._greenMultiplier;a[9]=r._greenOffset;a[12]=r._blueMultiplier;a[14]=r._blueOffset;a[18]=r._alphaMultiplier;a[19]=r._alphaOffset;t.colorMatrixFilter._matrix=a;n.push(t.colorMatrixFilter)}e.setGlobalFilters(n)};t.prototype._removeGlobalFilters=function(t){t.setGlobalFilters(null)};t.prototype._hasFilters=function(){var t=this._DO_Props_._filters&&this._DO_Props_._filters.length>0;if(this._transform){var e=this._transform._colorTransform;if(e._redMultiplier!=1||e._redOffset!=0||e._greenMultiplier!=1||e._greenOffset!=0||e._blueMultiplier!=1||e._blueOffset!=0||e._alphaMultiplier!=1||e._alphaOffset!=0){t=true}}return t};t.prototype._pushMask=function(t){var e=this;t.setTransform(e._worldTransform);var i=e.mask||e._DO_Props_._scrollRect;if(i){t.pushMask(i)}};t.prototype._popMask=function(t){t.popMask()};t.prototype.drawCacheTexture=function(t){var e=this;if(e._DO_Props_._cacheAsBitmap==false){return false}var i=e.getBounds(Rectangle.identity);if(e._DO_Privs_._cacheDirty||e._texture_to_render==null||Math.round(i.width)-e._texture_to_render._textureWidth>=1||Math.round(i.height)-e._texture_to_render._textureHeight>=1){var n=e._makeBitmapCache();e._DO_Privs_._cacheDirty=!n}if(e._texture_to_render==null)return false;var r=e._texture_to_render;var a=r._offsetX;var o=r._offsetY;var s=r._textureWidth;var h=r._textureHeight;e._updateTransform();t.setAlpha(e.worldAlpha,e.blendMode);t.setTransform(e._worldTransform);var l=egret.RenderFilter.getInstance();l.drawImage(t,e,0,0,s,h,a,o,s,h);return true};Object.defineProperty(t.prototype,"needDraw",{get:function(){return this._DO_Props_._needDraw},set:function(t){this._DO_Props_._needDraw=t},enumerable:true,configurable:true});t.prototype._updateTransform=function(){var t=this;var e=t._DO_Props_;if(!e._visible){return}t._calculateWorldTransform();if(MainContext._renderLoopPhase==MainContext.PHASE_TRANSFORM){if(t.needDraw||t._texture_to_render||e._cacheAsBitmap){MainContext.instance.addDraw(t._draw,t)}}};t.prototype._calculateWorldTransform=function(){var t=this;var e=t._DO_Props_;var i=t._worldTransform;var n=e._parent;if(n){i.identityMatrix(n._worldTransform)}else{i.identityMatrix(new Matrix)}this._getMatrix(i);var r=e._scrollRect;if(r){i.append(1,0,0,1,-r.x,-r.y)}if(n){t.worldAlpha=n.worldAlpha*e._alpha}else{t.worldAlpha=e._alpha}};t.prototype._render=function(t){};t.prototype.getBounds=function(t,e){if(e===void 0){e=true}var i=this._DO_Props_;var n=this._DO_Privs_;var r=this._measureBounds();var a=i._hasWidthSet?i._explicitWidth:r.width;var o=i._hasHeightSet?i._explicitHeight:r.height;n._rectW=r.width;n._rectH=r.height;this._clearSizeDirty();var s=r.x;var h=r.y;var l=0,u=0;if(e){if(i._anchorX!=0||i._anchorY!=0){l=a*i._anchorX;u=o*i._anchorY}else{l=i._anchorOffsetX;u=i._anchorOffsetY}}n._cacheBounds.initialize(s-l,h-u,a,o);var c=n._cacheBounds;if(!t){t=new Rectangle}return t.initialize(c.x,c.y,c.width,c.height)};t.prototype.destroyCacheBounds=function(){var t=this._DO_Privs_;t._cacheBounds.x=0;t._cacheBounds.y=0;t._cacheBounds.width=0;t._cacheBounds.height=0};t.prototype._getConcatenatedMatrix=function(){var e=t.identityMatrixForGetConcatenated.identity();var i=this;while(i!=null){var n=i._DO_Props_;if(n._anchorX!=0||n._anchorY!=0){var r=i._getSize(Rectangle.identity);e.prependTransform(n._x,n._y,n._scaleX,n._scaleY,n._rotation,n._skewX,n._skewY,r.width*n._anchorX,r.height*n._anchorY)}else{e.prependTransform(n._x,n._y,n._scaleX,n._scaleY,n._rotation,n._skewX,n._skewY,n._anchorOffsetX,n._anchorOffsetY)}if(n._scrollRect){e.prepend(1,0,0,1,-n._scrollRect.x,-n._scrollRect.y)}i=n._parent}return e};t.prototype.localToGlobal=function(t,e,i){if(t===void 0){t=0}if(e===void 0){e=0}var n=this._getConcatenatedMatrix();n.append(1,0,0,1,t,e);if(!i){i=new egret.Point}i.x=n.tx;i.y=n.ty;return i};t.prototype.globalToLocal=function(t,e,i){if(t===void 0){t=0}if(e===void 0){e=0}var n=this._getConcatenatedMatrix();n.invert();n.append(1,0,0,1,t,e);if(!i){i=new egret.Point}i.x=n.tx;i.y=n.ty;return i};t.prototype._getMatrix=function(t){if(!t){t=Matrix.identity.identity()}var e=this;var i=e._DO_Props_;var n,r;var a=this._getOffsetPoint();n=a.x;r=a.y;var o=e.__hack_local_matrix;if(o){t.append(o.a,o.b,o.c,o.d,o.tx,o.ty);t.append(1,0,0,1,-n,-r)}else{t.appendTransform(i._x,i._y,i._scaleX,i._scaleY,i._rotation,i._skewX,i._skewY,n,r)}return t};t.prototype._getSize=function(t){var e=this;var i=e._DO_Props_;if(i._hasHeightSet&&i._hasWidthSet){this._clearSizeDirty();return t.initialize(0,0,i._explicitWidth,i._explicitHeight)}this._measureSize(t);if(i._hasWidthSet){t.width=i._explicitWidth}if(i._hasHeightSet){t.height=i._explicitHeight}return t};t.prototype._measureSize=function(t){var e=this;var i=e._DO_Props_;var n=e._DO_Privs_;if(i._sizeDirty){t=this._measureBounds();n._rectW=t.width;n._rectH=t.height;this._clearSizeDirty()}else{t.width=n._rectW;t.height=n._rectH}t.x=0;t.y=0;return t};t.prototype._measureBounds=function(){return Rectangle.identity.initialize(0,0,0,0)};t.prototype._getOffsetPoint=function(){var t=this;var e=t._DO_Props_;var i=e._anchorOffsetX;var n=e._anchorOffsetY;if(e._anchorX!=0||e._anchorY!=0){var r=t._getSize(Rectangle.identity);i=e._anchorX*r.width;n=e._anchorY*r.height}var a={};a.x=i;a.y=n;return a};Object.defineProperty(t.prototype,"cacheAsBitmap",{get:function(){return this._DO_Props_._cacheAsBitmap},set:function(t){this._DO_Props_._cacheAsBitmap=t;if(t){egret.callLater(this._makeBitmapCache,this)}else{this._texture_to_render=null}},enumerable:true,configurable:true});t.prototype._makeBitmapCache=function(){if(!this.renderTexture){this.renderTexture=new egret.RenderTexture}var t=this.renderTexture.drawToTexture(this);if(t){this._texture_to_render=this.renderTexture}else{this._texture_to_render=null}return t};t.prototype._setCacheDirty=function(t){if(t===void 0){t=true}this._DO_Privs_._cacheDirty=t};t.getTransformBounds=function(t,e){var i=t.x,n=t.y;var r=t.width,a=t.height;if(i||n){e.appendTransform(0,0,1,1,0,0,0,-i,-n)}var o=r*e.a,s=r*e.b;var h=a*e.c,l=a*e.d;var u=e.tx,c=e.ty;var p=u,f=u,m=c,d=c;if((i=o+u)<p){p=i}else if(i>f){f=i}if((i=o+h+u)<p){p=i}else if(i>f){f=i}if((i=h+u)<p){p=i}else if(i>f){f=i}if((n=s+c)<m){m=n}else if(n>d){d=n}if((n=s+l+c)<m){m=n}else if(n>d){d=n}if((n=l+c)<m){m=n}else if(n>d){d=n}return t.initialize(p,m,f-p,d-m)};Object.defineProperty(t.prototype,"filters",{get:function(){return this._DO_Props_._filters},set:function(t){this._DO_Props_._filters=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"transform",{get:function(){if(!this._transform){this._transform=new egret.Transform(this)}return this._transform},enumerable:true,configurable:true});t.color=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];t.identityMatrixForGetConcatenated=new Matrix;t._enterFrameCallBackList=[];t._renderCallBackList=[];return t}();var DisplayObjectContainer=function(t){__extends(e,t);function e(){t.call(this);this._touchChildren=true;this._children=[];this._DO_Props_._isContainer=true}Object.defineProperty(e.prototype,"touchChildren",{get:function(){return this._touchChildren},set:function(t){this._touchChildren=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numChildren",{get:function(){return this._children.length},enumerable:true,configurable:true});e.prototype.setChildIndex=function(t,e){this.doSetChildIndex(t,e)};e.prototype.doSetChildIndex=function(t,e){var i=this._children.indexOf(t);if(i<0){egret.$error(1006)}this._children.splice(i,1);if(e<0||this._children.length<=e){this._children.push(t)}else{this._children.splice(e,0,t)}};e.prototype.addChild=function(t){var e=this._children.length;if(t.parent==this)e--;return this._doAddChild(t,e)};e.prototype.addChildAt=function(t,e){return this._doAddChild(t,e)};e.prototype._doAddChild=function(t,i,n){if(n===void 0){n=true}if(t==this)return t;if(i<0||i>this._children.length){egret.$error(1007);return t}var r=t.parent;if(r==this){this.doSetChildIndex(t,i);return t}if(r){var a=r._children.indexOf(t);if(a>=0){r._doRemoveChild(a)}}this._children.splice(i,0,t);t._parentChanged(this);if(n)var o=0;if(this._DO_Props_._stage){t._onAddToStage();var s=e.__EVENT__ADD_TO_STAGE_LIST;while(s.length>0){var h=s.shift();if(n){var l=0}}}t._setDirty();this._setSizeDirty();return t};e.prototype.removeChild=function(t){var e=this._children.indexOf(t);if(e>=0){return this._doRemoveChild(e)}else{egret.$error(1008);return null}};e.prototype.removeChildAt=function(t){if(t>=0&&t<this._children.length){return this._doRemoveChild(t)}else{egret.$error(1007);return null}};e.prototype._doRemoveChild=function(t,i){if(i===void 0){i=true}var n=this._children;var r=n[t];if(i){var a=0}if(this._DO_Props_._stage){r._onRemoveFromStage();var o=e.__EVENT__REMOVE_FROM_STAGE_LIST;while(o.length>0){var s=o.shift();if(i){var h=0}s._DO_Props_._stage=null}}r._parentChanged(null);n.splice(t,1);this._setSizeDirty();return r};e.prototype.getChildAt=function(t){if(t>=0&&t<this._children.length){return this._children[t]}else{egret.$error(1007);return null}};e.prototype.contains=function(t){while(t){if(t==this){return true}t=t.parent}return false};e.prototype.swapChildrenAt=function(t,e){if(t>=0&&t<this._children.length&&e>=0&&e<this._children.length){this._swapChildrenAt(t,e)}else{egret.$error(1007)}};e.prototype.swapChildren=function(t,e){var i=this._children.indexOf(t);var n=this._children.indexOf(e);if(i==-1||n==-1){egret.$error(1008)}else{this._swapChildrenAt(i,n)}};e.prototype._swapChildrenAt=function(t,e){if(t==e){return}var i=this._children;var n=i[t];i[t]=i[e];i[e]=n};e.prototype.getChildIndex=function(t){return this._children.indexOf(t)};e.prototype.removeChildren=function(){var t=this._children;for(var e=t.length-1;e>=0;e--){this._doRemoveChild(e)}};e.prototype._updateTransform=function(){var e=this;if(!e._DO_Props_._visible){return}if(e._hasFilters()){egret.RenderCommand.push(e._setGlobalFilters,e)}var i=e.mask||e._DO_Props_._scrollRect;if(i){egret.RenderCommand.push(e._pushMask,e)}t.prototype._updateTransform.call(this);if(!e._DO_Props_._cacheAsBitmap||!e._texture_to_render){for(var n=0,r=e._children,a=r.length;n<a;n++){var o=r[n];o._updateTransform()}}if(i){egret.RenderCommand.push(e._popMask,e)}if(e._hasFilters()){egret.RenderCommand.push(e._removeGlobalFilters,e)}};e.prototype._render=function(t){if(!egret.MainContext.__use_new_draw){var e=this;for(var i=0,n=e._children,r=n.length;i<r;i++){var a=n[i];a._draw(t)}}};e.prototype._measureBounds=function(){var t=this;var e=0,i=0,n=0,r=0;var a=t._children;var o=a.length;for(var s=0;s<o;s++){var h=a[s];if(!h.visible){continue}var l=h.getBounds(Rectangle.identity,false);var u=l.x;var c=l.y;var p=l.width;var f=l.height;var m=h._getMatrix();var d=DisplayObject.getTransformBounds(Rectangle.identity.initialize(u,c,p,f),m);var g=d.x,y=d.y,v=d.width+d.x,_=d.height+d.y;if(g<e||s==0){e=g}if(v>i||s==0){i=v}if(y<n||s==0){n=y}if(_>r||s==0){r=_}}return Rectangle.identity.initialize(e,n,i-e,r-n)};e.prototype.hitTest=function(e,i,n){if(n===void 0){n=false}var r=this;var a;if(!r._DO_Props_._visible){return null}if(r._DO_Props_._scrollRect){if(e<r._DO_Props_._scrollRect.x||i<r._DO_Props_._scrollRect.y||e>r._DO_Props_._scrollRect.x+r._DO_Props_._scrollRect.width||i>r._DO_Props_._scrollRect.y+r._DO_Props_._scrollRect.height){return null}}else if(r.mask){if(r.mask.x>e||e>r.mask.x+r.mask.width||r.mask.y>i||i>r.mask.y+r.mask.height){return null}}var o=r._children;var s=o.length;var h=r._touchChildren;for(var l=s-1;l>=0;l--){var u=o[l];var c=u._getMatrix();var p=u.scrollRect;if(p){c.append(1,0,0,1,-p.x,-p.y)}c.invert();var f=egret.Matrix.transformCoords(c,e,i);var m=u.hitTest(f.x,f.y,true);if(m){if(!h){return r}if(m._DO_Props_._touchEnabled&&h){return m}a=r}}if(a){return a}else if(r._texture_to_render){return t.prototype.hitTest.call(this,e,i,n)}return null};e.prototype._onAddToStage=function(){var e=this;t.prototype._onAddToStage.call(this);var i=e._children;var n=i.length;for(var r=0;r<n;r++){var a=this._children[r];a._onAddToStage()}};e.prototype._onRemoveFromStage=function(){var e=this;t.prototype._onRemoveFromStage.call(this);var i=e._children;var n=i.length;for(var r=0;r<n;r++){var a=i[r];a._onRemoveFromStage()}};e.prototype.getChildByName=function(t){var e=this._children;var i=e.length;var n;for(var r=0;r<i;r++){n=e[r];if(n.name==t){return n}}return null};e.__EVENT__ADD_TO_STAGE_LIST=[];e.__EVENT__REMOVE_FROM_STAGE_LIST=[];return e}(DisplayObject);var MainContext=function(){function t(){this.timeScale=1;this.drawList=[];this.container=null;this.rendererContext=null;this.texture_scale_factor=1}t.PHASE_DRAW="draw";t.PHASE_TRANSFORM="updateTransform";t.prototype.setRenderContext=function(t){this.rendererContext=t};t.prototype.setObjectContainer=function(t){this.container=t};t.prototype.addDraw=function(t,e){this.drawList.push({callback:t,thisObject:e})};t.prototype.run=function(){var t=this;var e=Date.now();function i(){var n=Date.now();var r=n-e;t.renderLoop(r);dragonBones.WorldClock.clock.advanceTime(r/1e3);window.requestAnimationFrame(i);e=n}window.requestAnimationFrame(i)};t.prototype.setScale=function(t,e){this.container.scaleX=t;this.container.scaleY=e};t.prototype.setPosition=function(t,e){this.container.x=t;this.container.y=e};t.prototype.renderLoop=function(e){this.init(e);this.startRender();t._renderLoopPhase=t.PHASE_TRANSFORM;this.container._updateTransform();t._renderLoopPhase=t.PHASE_DRAW;t.instance.draw(this);this.endRender()};t.prototype.draw=function(t){var e=this.drawList.length;for(var i=0;i<e;i++){var n=this.drawList[i];t.canvasContext.save();n.callback.call(n.thisObject,t);t.canvasContext.restore()}this.drawList.length=0;return};return t}();MainContext.instance=new MainContext;var CanvasRenderer=function(){var t={NORMAL:"normal",ADD:"add",ERASE:"erase",ERASE_REVERSE:"eraseReverse"};function e(t){this.texture_scale_factor=1}var i="x-canvas";var n=1280;var r=800;e.prototype.setScale=function(t,e){this.container.scaleX=t;this.container.scaleY=e};e.prototype.setPosition=function(t,e){this.container.x=t;this.container.y=e};e.prototype.uninit=function(){this.container=null;this.canvasContext=null};e.prototype.init=function(t){this.canvasContext=t;var e=this.canvasContext.setTransform;this.bkTransform=e;var i=this;this.canvasContext.setTransform=function(t,e,n,r,a,o){i._matrixA=t;i._matrixB=e;i._matrixC=n;i._matrixD=r;i._matrixTx=a;i._matrixTy=o;this.transform(t,e,n,r,a,o)};this._matrixA=1;this._matrixB=0;this._matrixC=0;this._matrixD=1;this._matrixTx=0;this._matrixTy=0;this._transformTx=0;this._transformTy=0;this.initBlendMode()};e.prototype.clearScreen=function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)};e.prototype.startRender=function(){this.canvasContext.save()};e.prototype.endRender=function(){this.canvasContext.restore();this.canvasContext.setTransform(1,0,0,1,0,0);this.canvasContext.setTransform=this.bkTransform;this.bkTransform=null};e.prototype.drawImage=function(t,e,i,n,r,a,o,s,h,l){if(l===void 0){l=undefined}a+=this._transformTx;o+=this._transformTy;this.canvasContext.drawImage(t._bitmapData,e,i,n,r,a,o,s,h)};e.prototype.setTransform=function(t){if(t.a==1&&t.b==0&&t.c==0&&t.d==1&&this._matrixA==1&&this._matrixB==0&&this._matrixC==0&&this._matrixD==1){this._transformTx=t.tx-this._matrixTx;this._transformTy=t.ty-this._matrixTy;return}this._transformTx=this._transformTy=0;if(this._matrixA!=t.a||this._matrixB!=t.b||this._matrixC!=t.c||this._matrixD!=t.d||this._matrixTx!=t.tx||this._matrixTy!=t.ty){this.canvasContext.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)}};e.prototype.setAlpha=function(e,i){this.canvasContext.globalAlpha=e;if(i){this.blendValue=this.blendModes[i];this.canvasContext.globalCompositeOperation=this.blendValue}else if(this.blendValue!=t.NORMAL){this.blendValue=this.blendModes[t.NORMAL];this.canvasContext.globalCompositeOperation=this.blendValue}};e.prototype.initBlendMode=function(){this.blendModes={};this.blendModes[t.NORMAL]="source-over";this.blendModes[t.ADD]="lighter";this.blendModes[t.ERASE]="destination-out";this.blendModes[t.ERASE_REVERSE]="destination-in"};return e}();var Bitmap=function(t){__extends(e,t);function e(e){t.call(this);this._texture=null;this.fillMode="scale";if(e){this._texture=e;this._setSizeDirty()}this.needDraw=true}Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(t==this._texture){return}this._setSizeDirty();this._texture=t},enumerable:true,configurable:true});e.prototype._render=function(t){var i=this._texture;if(!i){this._texture_to_render=null;return}this._texture_to_render=i;var n=this._DO_Props_._hasWidthSet?this._DO_Props_._explicitWidth:i._textureWidth;
var r=this._DO_Props_._hasHeightSet?this._DO_Props_._explicitHeight:i._textureHeight;e._drawBitmap(t,n,r,this)};e._drawBitmap=function(t,e,i,n){var r=n._texture_to_render;if(!r){return}var a=r._textureWidth;var o=r._textureHeight;var s=r._offsetX;var h=r._offsetY;var l=r._bitmapWidth||a;var u=r._bitmapHeight||o;var c=e/a;s=Math.round(s*c);e=Math.round(l*c);var p=i/o;h=Math.round(h*p);i=Math.round(u*p);t.drawImage(r,r._bitmapX,r._bitmapY,l,u,s,h,e,i)};return e}(DisplayObject);var SpriteSheet=function(){function t(t){this._sourceWidth=0;this._sourceHeight=0;this._bitmapX=0;this._bitmapY=0;this._textureMap={};this.texture=t;this._sourceWidth=t.width;this._sourceHeight=t.height;this._bitmapX=0;this._bitmapY=0}var e=t.prototype;e.getTexture=function(t){return this._textureMap[t]};e.createTexture=function(t,e,i,n,r,a,o,s,h){if(a===void 0){a=0}if(o===void 0){o=0}if(typeof s==="undefined"){s=a+n}if(typeof h==="undefined"){h=o+r}var l=new Object;l._bitmapData=this.texture;var u=MainContext.instance.texture_scale_factor;l._bitmapX=this._bitmapX+e;l._bitmapY=this._bitmapY+i;l._bitmapWidth=n*u;l._bitmapHeight=r*u;l._offsetX=a;l._offsetY=o;l._textureWidth=s*u;l._textureHeight=h*u;l._sourceWidth=this._sourceWidth;l._sourceHeight=this._sourceHeight;this._textureMap[t]=l;return l};e.dispose=function(){if(this.texture){this.texture.dispose()}};return t}();var __define=this.__define||function(t,e,i,n){Object.defineProperty(t,e,{configurable:true,enumerable:true,get:i,set:n})};var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t;p=i.prototype;t.DATA_VERSION="4.0";t.PARENT_COORDINATE_DATA_VERSION="3.0";t.VERSION="4.1.6";return t}();t.DragonBones=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(t){this._animationStateCount=0;this._armature=t;this._animationList=[];this._animationStateList=[];this._timeScale=1;this._isPlaying=false;this.tweenEnabled=true}var i=__define,n=e;p=n.prototype;p.dispose=function(){if(!this._armature){return}this._resetAnimationStateList();this._animationList.length=0;this._armature=null;this._animationDataList=null;this._animationList=null;this._animationStateList=null};p._resetAnimationStateList=function(){var e=this._animationStateList.length;var i;while(e--){i=this._animationStateList[e];i._resetTimelineStateList();t.AnimationState._returnObject(i)}this._animationStateList.length=0};p.gotoAndPlay=function(i,n,r,a,o,s,h,l,u){if(n===void 0){n=-1}if(r===void 0){r=-1}if(a===void 0){a=NaN}if(o===void 0){o=0}if(s===void 0){s=null}if(h===void 0){h=e.SAME_LAYER_AND_GROUP}if(l===void 0){l=true}if(u===void 0){u=true}if(!this._animationDataList){return null}var c=this._animationDataList.length;var p;while(c--){if(this._animationDataList[c].name==i){p=this._animationDataList[c];break}}if(!p){return null}var f=this._isPlaying==false;this._isPlaying=true;this._isFading=true;n=n<0?p.fadeTime<0?.3:p.fadeTime:n;var m;if(r<0){m=p.scale<0?1:p.scale}else{m=r*1e3/p.duration}a=isNaN(a)?p.playTimes:a;var d;switch(h){case e.NONE:break;case e.SAME_LAYER:c=this._animationStateList.length;while(c--){d=this._animationStateList[c];if(d.layer==o){d.fadeOut(n,l)}}break;case e.SAME_GROUP:c=this._animationStateList.length;while(c--){d=this._animationStateList[c];if(d.group==s){d.fadeOut(n,l)}}break;case e.ALL:c=this._animationStateList.length;while(c--){d=this._animationStateList[c];d.fadeOut(n,l)}break;case e.SAME_LAYER_AND_GROUP:default:c=this._animationStateList.length;while(c--){d=this._animationStateList[c];if(d.layer==o&&d.group==s){d.fadeOut(n,l)}}break}this._lastAnimationState=t.AnimationState._borrowObject();this._lastAnimationState._layer=o;this._lastAnimationState._group=s;this._lastAnimationState.autoTween=this.tweenEnabled;this._lastAnimationState._fadeIn(this._armature,p,n,1/m,a,u);this.addState(this._lastAnimationState);var g=this._armature.getSlots(false);c=g.length;while(c--){var y=g[c];if(y.childArmature){y.childArmature.animation.gotoAndPlay(i,n)}}if(f){this._armature.advanceTime(0)}return this._lastAnimationState};p.gotoAndStop=function(t,i,n,r,a,o,s,h){if(n===void 0){n=-1}if(r===void 0){r=0}if(a===void 0){a=-1}if(o===void 0){o=0}if(s===void 0){s=null}if(h===void 0){h=e.ALL}var l=this.getState(t,o);if(!l){l=this.gotoAndPlay(t,r,a,NaN,o,s,h)}if(n>=0){l.setCurrentTime(l.totalTime*n)}else{l.setCurrentTime(i)}l.stop();return l};p.play=function(){if(!this._animationDataList||this._animationDataList.length==0){return}if(!this._lastAnimationState){this.gotoAndPlay(this._animationDataList[0].name)}else if(!this._isPlaying){this._isPlaying=true}else{this.gotoAndPlay(this._lastAnimationState.name)}};p.stop=function(){this._isPlaying=false};p.getState=function(t,e){if(e===void 0){e=0}var i=this._animationStateList.length;while(i--){var n=this._animationStateList[i];if(n.name==t&&n.layer==e){return n}}return null};p.hasAnimation=function(t){var e=this._animationDataList.length;while(e--){if(this._animationDataList[e].name==t){return true}}return false};p._advanceTime=function(t){if(!this._isPlaying){return}var e=false;t*=this._timeScale;var i=this._animationStateList.length;while(i--){var n=this._animationStateList[i];if(n._advanceTime(t)){this.removeState(n)}else if(n.fadeState!=1){e=true}}this._isFading=e};p._updateAnimationStates=function(){var t=this._animationStateList.length;while(t--){this._animationStateList[t]._updateTimelineStates()}};p.addState=function(t){if(this._animationStateList.indexOf(t)<0){this._animationStateList.unshift(t);this._animationStateCount=this._animationStateList.length}};p.removeState=function(e){var i=this._animationStateList.indexOf(e);if(i>=0){this._animationStateList.splice(i,1);t.AnimationState._returnObject(e);if(this._lastAnimationState==e){if(this._animationStateList.length>0){this._lastAnimationState=this._animationStateList[0]}else{this._lastAnimationState=null}}this._animationStateCount=this._animationStateList.length}};i(p,"movementList",function(){return this._animationList});i(p,"movementID",function(){return this.lastAnimationName});i(p,"lastAnimationState",function(){return this._lastAnimationState});i(p,"lastAnimationName",function(){return this._lastAnimationState?this._lastAnimationState.name:null});i(p,"animationList",function(){return this._animationList});i(p,"isPlaying",function(){return this._isPlaying&&!this.isComplete});i(p,"isComplete",function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete){return false}var t=this._animationStateList.length;while(t--){if(!this._animationStateList[t].isComplete){return false}}return true}return true});i(p,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});i(p,"animationDataList",function(){return this._animationDataList},function(t){this._animationDataList=t;this._animationList.length=0;for(var e=0,i=this._animationDataList.length;e<i;e++){var n=this._animationDataList[e];this._animationList[this._animationList.length]=n.name}});e.NONE="none";e.SAME_LAYER="sameLayer";e.SAME_GROUP="sameGroup";e.SAME_LAYER_AND_GROUP="sameLayerAndGroup";e.ALL="all";return e}();t.Animation=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._layer=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._currentPlayTimes=0;this._totalTime=0;this._currentTime=0;this._lastTime=0;this._fadeState=0;this._playTimes=0;this._timelineStateList=[];this._slotTimelineStateList=[];this._boneMasks=[]}var i=__define,n=e;p=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){t.clear();if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}};e._clear=function(){var i=e._pool.length;while(i--){e._pool[i].clear()}e._pool.length=0;t.TimelineState._clear()};p.clear=function(){this._resetTimelineStateList();this._boneMasks.length=0;this._armature=null;this._clip=null};p._resetTimelineStateList=function(){var e=this._timelineStateList.length;while(e--){t.TimelineState._returnObject(this._timelineStateList[e])}this._timelineStateList.length=0;e=this._slotTimelineStateList.length;while(e--){t.SlotTimelineState._returnObject(this._slotTimelineStateList[e])}this._slotTimelineStateList.length=0};p.containsBoneMask=function(t){return this._boneMasks.length==0||this._boneMasks.indexOf(t)>=0};p.addBoneMask=function(t,e){if(e===void 0){e=true}this.addBoneToBoneMask(t);if(e){var i=this._armature.getBone(t);if(i){var n=this._armature.getBones(false);var r=n.length;while(r--){var a=n[r];if(i.contains(a)){this.addBoneToBoneMask(a.name)}}}}this._updateTimelineStates();return this};p.removeBoneMask=function(t,e){if(e===void 0){e=true}this.removeBoneFromBoneMask(t);if(e){var i=this._armature.getBone(t);if(i){var n=this._armature.getBones(false);var r=n.length;while(r--){var a=n[r];if(i.contains(a)){this.removeBoneFromBoneMask(a.name)}}}}this._updateTimelineStates();return this};p.removeAllMixingTransform=function(){this._boneMasks.length=0;this._updateTimelineStates();return this};p.addBoneToBoneMask=function(t){if(this._clip.getTimeline(t)&&this._boneMasks.indexOf(t)<0){this._boneMasks.push(t)}};p.removeBoneFromBoneMask=function(t){var e=this._boneMasks.indexOf(t);if(e>=0){this._boneMasks.splice(e,1)}};p._updateTimelineStates=function(){var t;var e;var i=this._timelineStateList.length;var n;while(i--){t=this._timelineStateList[i];if(!this._armature.getBone(t.name)){this.removeTimelineState(t)}}i=this._slotTimelineStateList.length;while(i--){e=this._slotTimelineStateList[i];if(!this._armature.getSlot(e.name)){this.removeSlotTimelineState(e)}}if(this._boneMasks.length>0){i=this._timelineStateList.length;while(i--){t=this._timelineStateList[i];if(this._boneMasks.indexOf(t.name)<0){this.removeTimelineState(t)}}for(i=0,n=this._boneMasks.length;i<n;i++){var r=this._boneMasks[i];this.addTimelineState(r)}}else{for(i=0,n=this._clip.timelineList.length;i<n;i++){var a=this._clip.timelineList[i];this.addTimelineState(a.name)}}for(i=0,n=this._clip.slotTimelineList.length;i<n;i++){var o=this._clip.slotTimelineList[i];this.addSlotTimelineState(o.name)}};p.addTimelineState=function(e){var i=this._armature.getBone(e);if(i){for(var n=0,r=this._timelineStateList.length;n<r;n++){var a=this._timelineStateList[n];if(a.name==e){return}}var o=t.TimelineState._borrowObject();o._fadeIn(i,this,this._clip.getTimeline(e));this._timelineStateList.push(o)}};p.removeTimelineState=function(e){var i=this._timelineStateList.indexOf(e);this._timelineStateList.splice(i,1);t.TimelineState._returnObject(e)};p.addSlotTimelineState=function(e){var i=this._armature.getSlot(e);if(i){for(var n=0,r=this._slotTimelineStateList.length;n<r;n++){var a=this._slotTimelineStateList[n];if(a.name==e){return}}var o=t.SlotTimelineState._borrowObject();o._fadeIn(i,this,this._clip.getSlotTimeline(e));this._slotTimelineStateList.push(o)}};p.removeSlotTimelineState=function(e){var i=this._slotTimelineStateList.indexOf(e);this._slotTimelineStateList.splice(i,1);t.SlotTimelineState._returnObject(e)};p.play=function(){this._isPlaying=true;return this};p.stop=function(){this._isPlaying=false;return this};p._fadeIn=function(t,e,i,n,r,a){this._armature=t;this._clip=e;this._pausePlayheadInFade=a;this._name=this._clip.name;this._totalTime=this._clip.duration;this.autoTween=this._clip.autoTween;this.setTimeScale(n);this.setPlayTimes(r);this._isComplete=false;this._currentFrameIndex=-1;this._currentPlayTimes=-1;if(Math.round(this._totalTime*this._clip.frameRate*.001)<2||n==Infinity){this._currentTime=this._totalTime}else{this._currentTime=-1}this._time=0;this._boneMasks.length=0;this._isFadeOut=false;this._fadeWeight=0;this._fadeTotalWeight=1;this._fadeState=-1;this._fadeCurrentTime=0;this._fadeBeginTime=this._fadeCurrentTime;this._fadeTotalTime=i*this._timeScale;this._isPlaying=true;this.displayControl=true;this.lastFrameAutoTween=true;this.additiveBlending=false;this.weight=1;this.fadeOutTime=i;this._updateTimelineStates();return this};p.fadeOut=function(t,e){if(!this._armature){return null}if(isNaN(t)||t<0){t=0}this._pausePlayheadInFade=e;if(this._isFadeOut){if(t>this._fadeTotalTime/this._timeScale-(this._fadeCurrentTime-this._fadeBeginTime)){return this}}else{for(var i=0,n=this._timelineStateList.length;i<n;i++){var r=this._timelineStateList[i];r._fadeOut()}}this._isFadeOut=true;this._fadeTotalWeight=this._fadeWeight;this._fadeState=-1;this._fadeBeginTime=this._fadeCurrentTime;this._fadeTotalTime=this._fadeTotalWeight>=0?t*this._timeScale:0;this.displayControl=false;return this};p._advanceTime=function(t){t*=this._timeScale;this.advanceFadeTime(t);if(this._fadeWeight){this.advanceTimelinesTime(t)}return this._isFadeOut&&this._fadeState==1};p.advanceFadeTime=function(e){var i=false;var n=false;if(this._fadeBeginTime>=0){var r=this._fadeState;this._fadeCurrentTime+=e<0?-e:e;if(this._fadeCurrentTime>=this._fadeBeginTime+this._fadeTotalTime){if(this._fadeWeight==1||this._fadeWeight==0){r=1;if(this._pausePlayheadInFade){this._pausePlayheadInFade=false;this._currentTime=-1}}this._fadeWeight=this._isFadeOut?0:1}else if(this._fadeCurrentTime>=this._fadeBeginTime){r=0;this._fadeWeight=(this._fadeCurrentTime-this._fadeBeginTime)/this._fadeTotalTime*this._fadeTotalWeight;if(this._isFadeOut){this._fadeWeight=this._fadeTotalWeight-this._fadeWeight}}else{r=-1;this._fadeWeight=this._isFadeOut?1:0}if(this._fadeState!=r){if(this._fadeState==-1){i=true}if(r==1){n=true}this._fadeState=r}}var a;if(i){if(this._isFadeOut){if(this._armature.hasEventListener(t.AnimationEvent.FADE_OUT)){a=new t.AnimationEvent(t.AnimationEvent.FADE_OUT);a.animationState=this;this._armature._eventList.push(a)}}else{this.hideBones();if(this._armature.hasEventListener(t.AnimationEvent.FADE_IN)){a=new t.AnimationEvent(t.AnimationEvent.FADE_IN);a.animationState=this;this._armature._eventList.push(a)}}}if(n){if(this._isFadeOut){if(this._armature.hasEventListener(t.AnimationEvent.FADE_OUT_COMPLETE)){a=new t.AnimationEvent(t.AnimationEvent.FADE_OUT_COMPLETE);a.animationState=this;this._armature._eventList.push(a)}}else{if(this._armature.hasEventListener(t.AnimationEvent.FADE_IN_COMPLETE)){a=new t.AnimationEvent(t.AnimationEvent.FADE_IN_COMPLETE);a.animationState=this;this._armature._eventList.push(a)}}}};p.advanceTimelinesTime=function(e){if(this._isPlaying&&!this._pausePlayheadInFade){this._time+=e}var i=false;var n=false;var r=false;var a=false;var o=0;var s=this._time*1e3;if(this._playTimes==0){a=false;o=Math.ceil(Math.abs(s)/this._totalTime)||1;if(s>=0){s-=Math.floor(s/this._totalTime)*this._totalTime}else{s-=Math.ceil(s/this._totalTime)*this._totalTime}if(s<0){s+=this._totalTime}}else{var h=this._playTimes*this._totalTime;if(s>=h){s=h;a=true}else if(s<=-h){s=-h;a=true}else{a=false}if(s<0){s+=h}o=Math.ceil(s/this._totalTime)||1;if(s>=0){s-=Math.floor(s/this._totalTime)*this._totalTime}else{s-=Math.ceil(s/this._totalTime)*this._totalTime}if(a){s=this._totalTime}}this._isComplete=a;var l=this._time*1e3/this._totalTime;var u=0;var c=0;for(u=0,c=this._timelineStateList.length;u<c;u++){var p=this._timelineStateList[u];p._update(l);this._isComplete=p._isComplete&&this._isComplete}for(u=0,c=this._slotTimelineStateList.length;u<c;u++){var f=this._slotTimelineStateList[u];f._update(l);this._isComplete=p._isComplete&&this._isComplete}if(this._currentTime!=s){if(this._currentPlayTimes!=o){if(this._currentPlayTimes>0&&o>1){r=true}this._currentPlayTimes=o}if(this._currentTime<0){i=true}if(this._isComplete){n=true}this._lastTime=this._currentTime;this._currentTime=s;this.updateMainTimeline(a)}var m;if(i){if(this._armature.hasEventListener(t.AnimationEvent.START)){m=new t.AnimationEvent(t.AnimationEvent.START);m.animationState=this;this._armature._eventList.push(m)}}if(n){if(this._armature.hasEventListener(t.AnimationEvent.COMPLETE)){m=new t.AnimationEvent(t.AnimationEvent.COMPLETE);m.animationState=this;this._armature._eventList.push(m)}if(this.autoFadeOut){this.fadeOut(this.fadeOutTime,true)}}else if(r){if(this._armature.hasEventListener(t.AnimationEvent.LOOP_COMPLETE)){m=new t.AnimationEvent(t.AnimationEvent.LOOP_COMPLETE);m.animationState=this;this._armature._eventList.push(m)}}};p.updateMainTimeline=function(t){var e=this._clip.frameList;if(e.length>0){var i;var n;for(var r=0,a=this._clip.frameList.length;r<a;++r){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=e.length){if(t){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}n=e[this._currentFrameIndex];if(i){this._armature._arriveAtFrame(i,null,this,true)}this._currentFrameDuration=n.duration;this._currentFramePosition=n.position;i=n}if(n){this._armature._arriveAtFrame(n,null,this,false)}}};p.hideBones=function(){for(var t=0,e=this._clip.hideTimelineNameMap.length;t<e;t++){var i=this._clip.hideTimelineNameMap[t];var n=this._armature.getBone(i);if(n){n._hideSlots()}}var r;for(t=0,e=this._clip.hideSlotTimelineNameMap.length;t<e;t++){r=this._clip.hideSlotTimelineNameMap[t];var a=this._armature.getSlot(r);if(a){a._resetToOrigin()}}};p.setAdditiveBlending=function(t){this.additiveBlending=t;return this};p.setAutoFadeOut=function(t,e){if(e===void 0){e=-1}this.autoFadeOut=t;if(e>=0){this.fadeOutTime=e*this._timeScale}return this};p.setWeight=function(t){if(isNaN(t)||t<0){t=1}this.weight=t;return this};p.setFrameTween=function(t,e){this.autoTween=t;this.lastFrameAutoTween=e;return this};p.setCurrentTime=function(t){if(t<0||isNaN(t)){t=0}this._time=t;this._currentTime=this._time*1e3;return this};p.setTimeScale=function(t){if(isNaN(t)||t==Infinity){t=1}this._timeScale=t;return this};p.setPlayTimes=function(t){if(t===void 0){t=0}if(Math.round(this._totalTime*.001*this._clip.frameRate)<2){this._playTimes=t<0?-1:1}else{this._playTimes=t<0?-t:t}this.autoFadeOut=t<0?true:false;return this};i(p,"name",function(){return this._name});i(p,"layer",function(){return this._layer});i(p,"group",function(){return this._group});i(p,"clip",function(){return this._clip});i(p,"isComplete",function(){return this._isComplete});i(p,"isPlaying",function(){return this._isPlaying&&!this._isComplete});i(p,"currentPlayTimes",function(){return this._currentPlayTimes<0?0:this._currentPlayTimes});i(p,"totalTime",function(){return this._totalTime*.001});i(p,"currentTime",function(){return this._currentTime<0?0:this._currentTime*.001});i(p,"fadeWeight",function(){return this._fadeWeight});i(p,"fadeState",function(){return this._fadeState});i(p,"fadeTotalTime",function(){return this._fadeTotalTime});i(p,"timeScale",function(){return this._timeScale});i(p,"playTimes",function(){return this._playTimes});e._pool=[];return e}();t.AnimationState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._durationColor=new t.ColorTransform}var i=__define,n=e;p=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e._clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};p.clear=function(){if(this._slot){this._slot._removeState(this);this._slot=null}this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null};p._fadeIn=function(t,e,i){this._slot=t;this._armature=this._slot.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this.name=i.name;this._totalTime=this._timelineData.duration;this._rawAnimationScale=this._animationState.clip.scale;this._isComplete=false;this._blendEnabled=false;this._tweenColor=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}this._slot._addState(this)};p._fadeOut=function(){};p._update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};p.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}}}if(this._currentTime!=i){this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var h=0,l=this._timelineData.frameList.length;h<l;++h){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration){this._currentFrameIndex++;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];if(o){this._slot._arriveAtFrame(o,this,this._animationState,true)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this._slot._arriveAtFrame(s,this,this._animationState,false);this._blendEnabled=s.displayIndex>=0;if(this._blendEnabled){this.updateToNextFrame(e)}else{this._tweenEasing=NaN;this._tweenColor=false}}if(this._blendEnabled){this.updateTween()}}};p.updateToNextFrame=function(t){if(t===void 0){t=0}var e=this._currentFrameIndex+1;if(e>=this._timelineData.frameList.length){e=0}var i=this._timelineData.frameList[this._currentFrameIndex];var n=this._timelineData.frameList[e];var r=false;if(e==0&&(!this._animationState.lastFrameAutoTween||this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+t-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;r=false}else if(i.displayIndex<0||n.displayIndex<0){this._tweenEasing=NaN;r=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.clip.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=i.tweenEasing;this._tweenCurve=i.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){r=false}else{if(this._tweenEasing==10){this._tweenEasing=0}r=true}}else{r=true}}else{this._tweenEasing=i.tweenEasing;this._tweenCurve=i.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;r=false}else{r=true}}if(r){if(i.color&&n.color){this._durationColor.alphaOffset=n.color.alphaOffset-i.color.alphaOffset;this._durationColor.redOffset=n.color.redOffset-i.color.redOffset;this._durationColor.greenOffset=n.color.greenOffset-i.color.greenOffset;this._durationColor.blueOffset=n.color.blueOffset-i.color.blueOffset;this._durationColor.alphaMultiplier=n.color.alphaMultiplier-i.color.alphaMultiplier;this._durationColor.redMultiplier=n.color.redMultiplier-i.color.redMultiplier;this._durationColor.greenMultiplier=n.color.greenMultiplier-i.color.greenMultiplier;this._durationColor.blueMultiplier=n.color.blueMultiplier-i.color.blueMultiplier;if(this._durationColor.alphaOffset||this._durationColor.redOffset||this._durationColor.greenOffset||this._durationColor.blueOffset||this._durationColor.alphaMultiplier||this._durationColor.redMultiplier||this._durationColor.greenMultiplier||this._durationColor.blueMultiplier){this._tweenColor=true}else{this._tweenColor=false}}else if(i.color){this._tweenColor=true;this._durationColor.alphaOffset=-i.color.alphaOffset;this._durationColor.redOffset=-i.color.redOffset;this._durationColor.greenOffset=-i.color.greenOffset;this._durationColor.blueOffset=-i.color.blueOffset;this._durationColor.alphaMultiplier=1-i.color.alphaMultiplier;this._durationColor.redMultiplier=1-i.color.redMultiplier;this._durationColor.greenMultiplier=1-i.color.greenMultiplier;this._durationColor.blueMultiplier=1-i.color.blueMultiplier}else if(n.color){this._tweenColor=true;this._durationColor.alphaOffset=n.color.alphaOffset;this._durationColor.redOffset=n.color.redOffset;this._durationColor.greenOffset=n.color.greenOffset;this._durationColor.blueOffset=n.color.blueOffset;this._durationColor.alphaMultiplier=n.color.alphaMultiplier-1;this._durationColor.redMultiplier=n.color.redMultiplier-1;this._durationColor.greenMultiplier=n.color.greenMultiplier-1;this._durationColor.blueMultiplier=n.color.blueMultiplier-1}else{this._tweenColor=false}}else{this._tweenColor=false}if(!this._tweenColor&&this._animationState.displayControl){if(i.color){this._slot._updateDisplayColor(i.color.alphaOffset,i.color.redOffset,i.color.greenOffset,i.color.blueOffset,i.color.alphaMultiplier,i.color.redMultiplier,i.color.greenMultiplier,i.color.blueMultiplier,true)}else if(this._slot._isColorChanged){this._slot._updateDisplayColor(0,0,0,0,1,1,1,1,false)}}};p.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenColor&&this._animationState.displayControl){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}if(e.color){this._slot._updateDisplayColor(e.color.alphaOffset+this._durationColor.alphaOffset*i,e.color.redOffset+this._durationColor.redOffset*i,e.color.greenOffset+this._durationColor.greenOffset*i,e.color.blueOffset+this._durationColor.blueOffset*i,e.color.alphaMultiplier+this._durationColor.alphaMultiplier*i,e.color.redMultiplier+this._durationColor.redMultiplier*i,e.color.greenMultiplier+this._durationColor.greenMultiplier*i,e.color.blueMultiplier+this._durationColor.blueMultiplier*i,true)}else{this._slot._updateDisplayColor(this._durationColor.alphaOffset*i,this._durationColor.redOffset*i,this._durationColor.greenOffset*i,this._durationColor.blueOffset*i,1+this._durationColor.alphaMultiplier*i,1+this._durationColor.redMultiplier*i,1+this._durationColor.greenMultiplier*i,1+this._durationColor.blueMultiplier*i,true)}}};p.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._slot._arriveAtFrame(t,this,this._animationState,false);this._isComplete=true;this._tweenEasing=NaN;this._tweenColor=false;this._blendEnabled=t.displayIndex>=0;if(this._blendEnabled){if(this._animationState.displayControl){if(t.color){this._slot._updateDisplayColor(t.color.alphaOffset,t.color.redOffset,t.color.greenOffset,t.color.blueOffset,t.color.alphaMultiplier,t.color.redMultiplier,t.color.greenMultiplier,t.color.blueMultiplier,true)}else if(this._slot._isColorChanged){this._slot._updateDisplayColor(0,0,0,0,1,1,1,1,false)}}}};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.SlotTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._lastTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._transform=new t.DBTransform;this._pivot=new t.Point;this._durationTransform=new t.DBTransform;this._durationPivot=new t.Point;this._durationColor=new t.ColorTransform}var i=__define,n=e;p=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e._clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};p.clear=function(){if(this._bone){this._bone._removeState(this);this._bone=null}this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null;this._originTransform=null;this._originPivot=null};p._fadeIn=function(t,e,i){this._bone=t;this._armature=this._bone.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this._originTransform=this._timelineData.originTransform;this._originPivot=this._timelineData.originPivot;this.name=i.name;this._totalTime=this._timelineData.duration;this._rawAnimationScale=this._animationState.clip.scale;this._isComplete=false;this._blendEnabled=false;this._tweenTransform=false;this._tweenScale=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;this._transform.x=0;this._transform.y=0;this._transform.scaleX=1;this._transform.scaleY=1;this._transform.skewX=0;this._transform.skewY=0;this._pivot.x=0;this._pivot.y=0;this._durationTransform.x=0;this._durationTransform.y=0;this._durationTransform.scaleX=1;this._durationTransform.scaleY=1;this._durationTransform.skewX=0;this._durationTransform.skewY=0;this._durationPivot.x=0;this._durationPivot.y=0;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}this._bone._addState(this)};p._fadeOut=function(){this._transform.skewX=t.TransformUtil.formatRadian(this._transform.skewX);this._transform.skewY=t.TransformUtil.formatRadian(this._transform.skewY)};p._update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};p.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}}}if(this._currentTime!=i){this._lastTime=this._currentTime;this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var h=0,l=this._timelineData.frameList.length;h<l;++h){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];if(o){this._bone._arriveAtFrame(o,this,this._animationState,true)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this._bone._arriveAtFrame(s,this,this._animationState,false);this._blendEnabled=!isNaN(s.tweenEasing);if(this._blendEnabled){this.updateToNextFrame(e)}else{this._tweenEasing=NaN;this._tweenTransform=false;this._tweenScale=false;this._tweenColor=false}}if(this._blendEnabled){this.updateTween()}}};p.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var a=false;if(i==0&&(!this._animationState.lastFrameAutoTween||this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){
this._tweenEasing=NaN;a=false}else if(n.displayIndex<0||r.displayIndex<0){this._tweenEasing=NaN;a=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.clip.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){a=false}else{if(this._tweenEasing==10){this._tweenEasing=0}a=true}}else{a=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;a=false}else{a=true}}if(a){this._durationTransform.x=r.transform.x-n.transform.x;this._durationTransform.y=r.transform.y-n.transform.y;this._durationTransform.skewX=r.transform.skewX-n.transform.skewX;this._durationTransform.skewY=r.transform.skewY-n.transform.skewY;this._durationTransform.scaleX=r.transform.scaleX-n.transform.scaleX+r.scaleOffset.x;this._durationTransform.scaleY=r.transform.scaleY-n.transform.scaleY+r.scaleOffset.y;this._durationTransform.normalizeRotation();if(i==0){this._durationTransform.skewX=t.TransformUtil.formatRadian(this._durationTransform.skewX);this._durationTransform.skewY=t.TransformUtil.formatRadian(this._durationTransform.skewY)}this._durationPivot.x=r.pivot.x-n.pivot.x;this._durationPivot.y=r.pivot.y-n.pivot.y;if(this._durationTransform.x||this._durationTransform.y||this._durationTransform.skewX||this._durationTransform.skewY||this._durationTransform.scaleX||this._durationTransform.scaleY||this._durationPivot.x||this._durationPivot.y){this._tweenTransform=true;this._tweenScale=n.tweenScale}else{this._tweenTransform=false;this._tweenScale=false}}else{this._tweenTransform=false;this._tweenScale=false}if(!this._tweenTransform){if(this._animationState.additiveBlending){this._transform.x=n.transform.x;this._transform.y=n.transform.y;this._transform.skewX=n.transform.skewX;this._transform.skewY=n.transform.skewY;this._transform.scaleX=n.transform.scaleX;this._transform.scaleY=n.transform.scaleY;this._pivot.x=n.pivot.x;this._pivot.y=n.pivot.y}else{this._transform.x=this._originTransform.x+n.transform.x;this._transform.y=this._originTransform.y+n.transform.y;this._transform.skewX=this._originTransform.skewX+n.transform.skewX;this._transform.skewY=this._originTransform.skewY+n.transform.skewY;this._transform.scaleX=this._originTransform.scaleX*n.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*n.transform.scaleY;this._pivot.x=this._originPivot.x+n.pivot.x;this._pivot.y=this._originPivot.y+n.pivot.y}this._bone.invalidUpdate()}else if(!this._tweenScale){if(this._animationState.additiveBlending){this._transform.scaleX=n.transform.scaleX;this._transform.scaleY=n.transform.scaleY}else{this._transform.scaleX=this._originTransform.scaleX*n.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*n.transform.scaleY}}};p.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenTransform){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}var n=e.transform;var r=e.pivot;if(this._animationState.additiveBlending){this._transform.x=n.x+this._durationTransform.x*i;this._transform.y=n.y+this._durationTransform.y*i;this._transform.skewX=n.skewX+this._durationTransform.skewX*i;this._transform.skewY=n.skewY+this._durationTransform.skewY*i;if(this._tweenScale){this._transform.scaleX=n.scaleX+this._durationTransform.scaleX*i;this._transform.scaleY=n.scaleY+this._durationTransform.scaleY*i}this._pivot.x=r.x+this._durationPivot.x*i;this._pivot.y=r.y+this._durationPivot.y*i}else{this._transform.x=this._originTransform.x+n.x+this._durationTransform.x*i;this._transform.y=this._originTransform.y+n.y+this._durationTransform.y*i;this._transform.skewX=this._originTransform.skewX+n.skewX+this._durationTransform.skewX*i;this._transform.skewY=this._originTransform.skewY+n.skewY+this._durationTransform.skewY*i;if(this._tweenScale){this._transform.scaleX=this._originTransform.scaleX*n.scaleX+this._durationTransform.scaleX*i;this._transform.scaleY=this._originTransform.scaleY*n.scaleY+this._durationTransform.scaleY*i}this._pivot.x=this._originPivot.x+r.x+this._durationPivot.x*i;this._pivot.y=this._originPivot.y+r.y+this._durationPivot.y*i}this._bone.invalidUpdate()}};p.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._bone._arriveAtFrame(t,this,this._animationState,false);this._isComplete=true;this._tweenEasing=NaN;this._tweenTransform=false;this._tweenScale=false;this._tweenColor=false;this._blendEnabled=t.displayIndex>=0;if(this._blendEnabled){if(this._animationState.additiveBlending){this._transform.x=t.transform.x;this._transform.y=t.transform.y;this._transform.skewX=t.transform.skewX;this._transform.skewY=t.transform.skewY;this._transform.scaleX=t.transform.scaleX;this._transform.scaleY=t.transform.scaleY;this._pivot.x=t.pivot.x;this._pivot.y=t.pivot.y}else{this._transform.x=this._originTransform.x+t.transform.x;this._transform.y=this._originTransform.y+t.transform.y;this._transform.skewX=this._originTransform.skewX+t.transform.skewX;this._transform.skewY=this._originTransform.skewY+t.transform.skewY;this._transform.scaleX=this._originTransform.scaleX*t.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*t.transform.scaleY;this._pivot.x=this._originPivot.x+t.pivot.x;this._pivot.y=this._originPivot.y+t.pivot.y}this._bone.invalidUpdate()}};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.TimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e){if(t===void 0){t=-1}if(e===void 0){e=1}this._time=t>=0?t:(new Date).getTime()*.001;this._timeScale=isNaN(e)?1:e;this._animatableList=[]}var e=__define,i=t;p=i.prototype;e(p,"time",function(){return this._time});e(p,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});p.contains=function(t){return this._animatableList.indexOf(t)>=0};p.add=function(t){if(t&&this._animatableList.indexOf(t)==-1){this._animatableList.push(t)}};p.remove=function(t){var e=this._animatableList.indexOf(t);if(e>=0){this._animatableList[e]=null}};p.clear=function(){this._animatableList.length=0};p.advanceTime=function(t){if(t===void 0){t=-1}if(t<0){t=(new Date).getTime()*.001-this._time}t*=this._timeScale;this._time+=t;var e=this._animatableList.length;if(e==0){return}var i=0;for(var n=0;n<e;n++){var r=this._animatableList[n];if(r){if(i!=n){this._animatableList[i]=r;this._animatableList[n]=null}r.advanceTime(t);i++}}if(i!=n){e=this._animatableList.length;while(n<e){this._animatableList[i++]=this._animatableList[n++]}this._animatableList.length=i}};t.clock=new t;return t}();t.WorldClock=e})(dragonBones||(dragonBones={}));var __extends=this.__extends||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];function n(){this.constructor=t}n.prototype=e.prototype;t.prototype=new n};var dragonBones;(function(t){var e=function(){function t(){}t.prototype.hasEventListener=function(t){if(this._listenersMap&&this._listenersMap[t]){return true}return false};t.prototype.addEventListener=function(t,e){if(t&&e){if(!this._listenersMap){this._listenersMap={}}var i=this._listenersMap[t];if(i){this.removeEventListener(t,e)}if(i){i.push(e)}else{this._listenersMap[t]=[e]}}};t.prototype.removeEventListener=function(t,e){if(!this._listenersMap||!t||!e){return}var i=this._listenersMap[t];if(i){var n=i.length;for(var r=0;r<n;r++){if(i[r].toString()===e.toString()){if(n==1){i.length=0}else{i.splice(r,1)}}}}};t.prototype.removeAllEventListeners=function(t){if(t){delete this._listenersMap[t]}else{this._listenersMap=null}};t.prototype.dispatchEvent=function(t){if(t){var e=this._listenersMap[t.type];if(e){t.target=this;var i=e.concat();var n=e.length;for(var r=0;r<n;r++){i[r](t)}}}};return t}();t.EventDispatcher=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);if(e._instance){throw new Error("Singleton already constructed!")}}var i=__define,n=e;p=n.prototype;e.getInstance=function(){if(!e._instance){e._instance=new e}return e._instance};return e}(t.EventDispatcher);t.SoundEventManager=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this._display=i;this._animation=new t.Animation(this);this._slotsZOrderChanged=false;this._slotList=[];this._boneList=[];this._eventList=[];this._delayDispose=false;this._lockDispose=false;this._armatureData=null}var n=__define,r=i;p=r.prototype;n(p,"armatureData",function(){return this._armatureData});n(p,"display",function(){return this._display});p.getDisplay=function(){return this._display};n(p,"animation",function(){return this._animation});p.dispose=function(){this._delayDispose=true;if(!this._animation||this._lockDispose){return}this.userData=null;this._animation.dispose();var t=this._slotList.length;while(t--){this._slotList[t].dispose()}t=this._boneList.length;while(t--){this._boneList[t].dispose()}this._armatureData=null;this._animation=null;this._slotList=null;this._boneList=null;this._eventList=null};p.invalidUpdate=function(t){if(t===void 0){t=null}if(t){var e=this.getBone(t);if(e){e.invalidUpdate()}}else{var i=this._boneList.length;while(i--){this._boneList[i].invalidUpdate()}}};p.advanceTime=function(e){this._lockDispose=true;this._animation._advanceTime(e);e*=this._animation.timeScale;var i=this._animation._isFading;var n=this._boneList.length;while(n--){var r=this._boneList[n];r._update(i)}n=this._slotList.length;while(n--){var a=this._slotList[n];a._update();if(a._isShowDisplay){var o=a.childArmature;if(o){o.advanceTime(e)}}}if(this._slotsZOrderChanged){this.updateSlotsZOrder();if(this.hasEventListener(t.ArmatureEvent.Z_ORDER_UPDATED)){this.dispatchEvent(new t.ArmatureEvent(t.ArmatureEvent.Z_ORDER_UPDATED))}}if(this._eventList.length>0){for(var n=0,s=this._eventList.length;n<s;n++){var h=this._eventList[n];this.dispatchEvent(h)}this._eventList.length=0}this._lockDispose=false;if(this._delayDispose){this.dispose()}};p.resetAnimation=function(){this.animation.stop();this.animation._resetAnimationStateList();for(var t=0,e=this._boneList.length;t<e;t++){this._boneList[t]._removeAllStates()}};p.getSlots=function(t){if(t===void 0){t=true}return t?this._slotList.concat():this._slotList};p.getSlot=function(t){var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];if(n.name==t){return n}}return null};p.getSlotByDisplay=function(t){if(t){var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];if(n.display==t){return n}}}return null};p.addSlot=function(t,e){var i=this.getBone(e);if(i){i.addSlot(t)}else{throw new Error}};p.removeSlot=function(t){if(!t||t.armature!=this){throw new Error}t.parent.removeSlot(t)};p.removeSlotByName=function(t){var e=this.getSlot(t);if(e){this.removeSlot(e)}return e};p.getBones=function(t){if(t===void 0){t=true}return t?this._boneList.concat():this._boneList};p.getBone=function(t){var e=this._boneList.length;for(var i=0;i<e;i++){var n=this._boneList[i];if(n.name==t){return n}}return null};p.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null};p.addBone=function(t,e,i){if(e===void 0){e=null}if(i===void 0){i=false}var n;if(e){n=this.getBone(e);if(!n){throw new Error}}if(n){n.addChildBone(t,i)}else{if(t.parent){t.parent.removeChildBone(t,i)}t._setArmature(this);if(!i){this._updateAnimationAfterBoneListChanged()}}};p.removeBone=function(t,e){if(e===void 0){e=false}if(!t||t.armature!=this){throw new Error}if(t.parent){t.parent.removeChildBone(t,e)}else{t._setArmature(null);if(!e){this._updateAnimationAfterBoneListChanged(false)}}};p.removeBoneByName=function(t){var e=this.getBone(t);if(e){this.removeBone(e)}return e};p._addBoneToBoneList=function(t){if(this._boneList.indexOf(t)<0){this._boneList[this._boneList.length]=t}};p._removeBoneFromBoneList=function(t){var e=this._boneList.indexOf(t);if(e>=0){this._boneList.splice(e,1)}};p._addSlotToSlotList=function(t){if(this._slotList.indexOf(t)<0){this._slotList[this._slotList.length]=t}};p._removeSlotFromSlotList=function(t){var e=this._slotList.indexOf(t);if(e>=0){this._slotList.splice(e,1)}};p.updateSlotsZOrder=function(){this._slotList.sort(this.sortSlot);var t=this._slotList.length;while(t--){var e=this._slotList[t];if(e._isShowDisplay){e._addDisplayToContainer(this._display)}}this._slotsZOrderChanged=false};p._updateAnimationAfterBoneListChanged=function(t){if(t===void 0){t=true}if(t){this.sortBoneList()}this._animation._updateAnimationStates()};p.sortBoneList=function(){var e=this._boneList.length;if(e==0){return}var i=[];while(e--){var n=0;var r=this._boneList[e];var a=r;while(a){n++;a=a.parent}i[e]=[n,r]}i.sort(t.ArmatureData.sortBoneDataHelpArrayDescending);e=i.length;while(e--){this._boneList[e]=i[e][1]}i.length=0};p._arriveAtFrame=function(e,n,r,a){if(e.event&&this.hasEventListener(t.FrameEvent.ANIMATION_FRAME_EVENT)){var o=new t.FrameEvent(t.FrameEvent.ANIMATION_FRAME_EVENT);o.animationState=r;o.frameLabel=e.event;this._eventList.push(o)}if(e.sound&&i._soundManager.hasEventListener(t.SoundEvent.SOUND)){var s=new t.SoundEvent(t.SoundEvent.SOUND);s.armature=this;s.animationState=r;s.sound=e.sound;i._soundManager.dispatchEvent(s)}if(e.action){if(r.displayControl){this.animation.gotoAndPlay(e.action)}}};p.sortSlot=function(t,e){return t.zOrder<e.zOrder?1:-1};p.getAnimation=function(){return this._animation};i._soundManager=t.SoundEventManager.getInstance();return i}(t.EventDispatcher);t.Armature=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0}var e=__define,i=t;p=i.prototype;p.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var a=t*n-e*i;this.a=n/a;this.b=-e/a;this.c=-i/a;this.d=t/a;this.tx=(i*this.ty-n*r)/a;this.ty=-(t*this.ty-e*r)/a};p.concat=function(t){var e=t.a;var i=t.b;var n=t.c;var r=t.d;var a=this.tx;var o=this.ty;if(e!=1||i!=0||n!=0||r!=1){var s=this.a;var h=this.b;var l=this.c;var u=this.d;this.a=s*e+h*n;this.b=s*i+h*r;this.c=l*e+u*n;this.d=l*i+u*r}this.tx=a*e+o*n+t.tx;this.ty=a*i+o*r+t.ty};p.copyFrom=function(t){this.tx=t.tx;this.ty=t.ty;this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d};return t}();t.Matrix=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.x=0;this.y=0;this.skewX=0;this.skewY=0;this.scaleX=1;this.scaleY=1}var i=__define,n=e;p=n.prototype;i(p,"rotation",function(){return this.skewX},function(t){this.skewX=this.skewY=t});p.copy=function(t){this.x=t.x;this.y=t.y;this.skewX=t.skewX;this.skewY=t.skewY;this.scaleX=t.scaleX;this.scaleY=t.scaleY};p.add=function(t){this.x+=t.x;this.y+=t.y;this.skewX+=t.skewX;this.skewY+=t.skewY;this.scaleX*=t.scaleX;this.scaleY*=t.scaleY};p.minus=function(t){this.x-=t.x;this.y-=t.y;this.skewX-=t.skewX;this.skewY-=t.skewY;this.scaleX/=t.scaleX;this.scaleY/=t.scaleY};p.normalizeRotation=function(){this.skewX=t.TransformUtil.normalizeRotation(this.skewX);this.skewY=t.TransformUtil.normalizeRotation(this.skewY)};p.toString=function(){var t="x:"+this.x+" y:"+this.y+" skewX:"+this.skewX+" skewY:"+this.skewY+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY;return t};return e}();t.DBTransform=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._globalTransformMatrix=new t.Matrix;this._global=new t.DBTransform;this._origin=new t.DBTransform;this._offset=new t.DBTransform;this._offset.scaleX=this._offset.scaleY=1;this._visible=true;this._armature=null;this._parent=null;this.userData=null;this.inheritRotation=true;this.inheritScale=true;this.inheritTranslation=true}var i=__define,n=e;p=n.prototype;i(p,"global",function(){return this._global});i(p,"origin",function(){return this._origin});i(p,"offset",function(){return this._offset});i(p,"armature",function(){return this._armature});p._setArmature=function(t){this._armature=t};i(p,"parent",function(){return this._parent});p._setParent=function(t){this._parent=t};p.dispose=function(){this.userData=null;this._globalTransformMatrix=null;this._global=null;this._origin=null;this._offset=null;this._armature=null;this._parent=null};p._calculateRelativeParentTransform=function(){};p._calculateParentTransform=function(){if(this.parent&&(this.inheritTranslation||this.inheritRotation||this.inheritScale)){var i=this._parent._globalTransformForChild;var n=this._parent._globalTransformMatrixForChild;if(!this.inheritTranslation||!this.inheritRotation||!this.inheritScale){i=e._tempParentGlobalTransform;i.copy(this._parent._globalTransformForChild);if(!this.inheritTranslation){i.x=0;i.y=0}if(!this.inheritScale){i.scaleX=1;i.scaleY=1}if(!this.inheritRotation){i.skewX=0;i.skewY=0}n=e._tempParentGlobalTransformMatrix;t.TransformUtil.transformToMatrix(i,n,true)}return{parentGlobalTransform:i,parentGlobalTransformMatrix:n}}return null};p._updateGlobal=function(){this._calculateRelativeParentTransform();var e=this._calculateParentTransform();if(e!=null){var i=e.parentGlobalTransformMatrix;var n=e.parentGlobalTransform;var r=this._global.x;var a=this._global.y;this._global.x=i.a*r+i.c*a+i.tx;this._global.y=i.d*a+i.b*r+i.ty;if(this.inheritRotation){this._global.skewX+=n.skewX;this._global.skewY+=n.skewY}if(this.inheritScale){this._global.scaleX*=n.scaleX;this._global.scaleY*=n.scaleY}}t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix,true);return e};e._tempParentGlobalTransformMatrix=new t.Matrix;e._tempParentGlobalTransform=new t.DBTransform;return e}();t.DBObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.applyOffsetTranslationToChild=true;this.applyOffsetRotationToChild=true;this.applyOffsetScaleToChild=false;this._needUpdate=0;this._tween=new t.DBTransform;this._tweenPivot=new t.Point;this._tween.scaleX=this._tween.scaleY=1;this._boneList=[];this._slotList=[];this._timelineStateList=[];this._needUpdate=2;this._isColorChanged=false}var n=__define,r=i;p=r.prototype;i.initWithBoneData=function(t){var e=new i;e.name=t.name;e.inheritRotation=t.inheritRotation;e.inheritScale=t.inheritScale;e.origin.copy(t.transform);return e};p.dispose=function(){if(!this._boneList){return}e.prototype.dispose.call(this);var t=this._boneList.length;while(t--){this._boneList[t].dispose()}t=this._slotList.length;while(t--){this._slotList[t].dispose()}this._tween=null;this._tweenPivot=null;this._boneList=null;this._slotList=null;this._timelineStateList=null};p.contains=function(t){if(!t){throw new Error}if(t==this){return false}var e=t;while(!(e==this||e==null)){e=e.parent}return e==this};p.addChildBone=function(t,e){if(e===void 0){e=false}if(!t){throw new Error}if(t==this||t.contains(this)){throw new Error}if(t.parent==this){return}if(t.parent){t.parent.removeChildBone(t,e)}this._boneList[this._boneList.length]=t;t._setParent(this);t._setArmature(this._armature);if(this._armature&&!e){this._armature._updateAnimationAfterBoneListChanged()}};p.removeChildBone=function(t,e){if(e===void 0){e=false}if(!t){throw new Error}var i=this._boneList.indexOf(t);if(i<0){throw new Error}this._boneList.splice(i,1);t._setParent(null);t._setArmature(null);if(this._armature&&!e){this._armature._updateAnimationAfterBoneListChanged(false)}};p.addSlot=function(t){if(!t){throw new Error}if(t.parent){t.parent.removeSlot(t)}this._slotList[this._slotList.length]=t;t._setParent(this);t.setArmature(this._armature)};p.removeSlot=function(t){if(!t){throw new Error}var e=this._slotList.indexOf(t);if(e<0){throw new Error}this._slotList.splice(e,1);t._setParent(null);t.setArmature(null)};p._setArmature=function(t){if(this._armature==t){return}if(this._armature){this._armature._removeBoneFromBoneList(this);this._armature._updateAnimationAfterBoneListChanged(false)}this._armature=t;if(this._armature){this._armature._addBoneToBoneList(this)}var e=this._boneList.length;while(e--){this._boneList[e]._setArmature(this._armature)}e=this._slotList.length;while(e--){this._slotList[e].setArmature(this._armature)}};p.getBones=function(t){if(t===void 0){t=true}return t?this._boneList.concat():this._boneList};p.getSlots=function(t){if(t===void 0){t=true}return t?this._slotList.concat():this._slotList};p.invalidUpdate=function(){this._needUpdate=2};p._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._tween.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._tween.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._tween.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._tween.skewY+this._offset.skewY;this._global.x=this._origin.x+this._tween.x+this._offset.x;this._global.y=this._origin.y+this._tween.y+this._offset.y};p._update=function(e){if(e===void 0){e=false}this._needUpdate--;if(e||this._needUpdate>0||this._parent&&this._parent._needUpdate>0){this._needUpdate=1}else{return}this.blendingTimeline();var i=this._updateGlobal();var n=i?i.parentGlobalTransform:null;var r=i?i.parentGlobalTransformMatrix:null;var a=this._offset.x!=0||this._offset.y!=0;var o=this._offset.scaleX!=0||this._offset.scaleY!=0;var s=this._offset.skewX!=0||this._offset.skewY!=0;if((!a||this.applyOffsetTranslationToChild)&&(!o||this.applyOffsetScaleToChild)&&(!s||this.applyOffsetRotationToChild)){this._globalTransformForChild=this._global;this._globalTransformMatrixForChild=this._globalTransformMatrix}else{if(!this._tempGlobalTransformForChild){this._tempGlobalTransformForChild=new t.DBTransform}this._globalTransformForChild=this._tempGlobalTransformForChild;if(!this._tempGlobalTransformMatrixForChild){this._tempGlobalTransformMatrixForChild=new t.Matrix}this._globalTransformMatrixForChild=this._tempGlobalTransformMatrixForChild;this._globalTransformForChild.x=this._origin.x+this._tween.x;this._globalTransformForChild.y=this._origin.y+this._tween.y;this._globalTransformForChild.scaleX=this._origin.scaleX*this._tween.scaleX;this._globalTransformForChild.scaleY=this._origin.scaleY*this._tween.scaleY;this._globalTransformForChild.skewX=this._origin.skewX+this._tween.skewX;this._globalTransformForChild.skewY=this._origin.skewY+this._tween.skewY;if(this.applyOffsetTranslationToChild){this._globalTransformForChild.x+=this._offset.x;this._globalTransformForChild.y+=this._offset.y}if(this.applyOffsetScaleToChild){this._globalTransformForChild.scaleX*=this._offset.scaleX;this._globalTransformForChild.scaleY*=this._offset.scaleY}if(this.applyOffsetRotationToChild){this._globalTransformForChild.skewX+=this._offset.skewX;this._globalTransformForChild.skewY+=this._offset.skewY}t.TransformUtil.transformToMatrix(this._globalTransformForChild,this._globalTransformMatrixForChild,true);if(r){this._globalTransformMatrixForChild.concat(r);t.TransformUtil.matrixToTransform(this._globalTransformMatrixForChild,this._globalTransformForChild,this._globalTransformForChild.scaleX*n.scaleX>=0,this._globalTransformForChild.scaleY*n.scaleY>=0)}}};p._updateColor=function(t,e,i,n,r,a,o,s,h){var l=this._slotList.length;for(var u=0;u<l;u++){var c=this._slotList[u];c._updateDisplayColor(t,e,i,n,r,a,o,s)}this._isColorChanged=h};p._hideSlots=function(){var t=this._slotList.length;for(var e=0;e<t;e++){var i=this._slotList[e];i._changeDisplay(-1)}};p._arriveAtFrame=function(e,n,r,a){var o=r.displayControl&&(!this.displayController||this.displayController==r.name)&&r.containsBoneMask(this.name);if(o){var s=e;var h=s.displayIndex;var l;if(e.event&&this._armature.hasEventListener(t.FrameEvent.BONE_FRAME_EVENT)){var u=new t.FrameEvent(t.FrameEvent.BONE_FRAME_EVENT);u.bone=this;u.animationState=r;u.frameLabel=e.event;this._armature._eventList.push(u)}if(e.sound&&i._soundManager.hasEventListener(t.SoundEvent.SOUND)){var c=new t.SoundEvent(t.SoundEvent.SOUND);c.armature=this._armature;c.animationState=r;c.sound=e.sound;i._soundManager.dispatchEvent(c)}if(e.action){var p=this._slotList.length;for(var f=0;f<p;f++){l=this._slotList[f];var m=l.childArmature;if(m){m.animation.gotoAndPlay(e.action)}}}}};p._addState=function(t){if(this._timelineStateList.indexOf(t)<0){this._timelineStateList.push(t);this._timelineStateList.sort(this.sortState)}};p._removeState=function(t){var e=this._timelineStateList.indexOf(t);if(e>=0){this._timelineStateList.splice(e,1)}};p._removeAllStates=function(){this._timelineStateList.length=0};p.blendingTimeline=function(){var t;var e;var i;var n;var r=this._timelineStateList.length;if(r==1){t=this._timelineStateList[0];n=t._animationState.weight*t._animationState.fadeWeight;t._weight=n;e=t._transform;i=t._pivot;this._tween.x=e.x*n;this._tween.y=e.y*n;this._tween.skewX=e.skewX*n;this._tween.skewY=e.skewY*n;this._tween.scaleX=1+(e.scaleX-1)*n;this._tween.scaleY=1+(e.scaleY-1)*n;this._tweenPivot.x=i.x*n;this._tweenPivot.y=i.y*n}else if(r>1){var a=0;var o=0;var s=0;var h=0;var l=1;var u=1;var c=0;var p=0;var f=1;var m=0;var d=this._timelineStateList[r-1]._animationState.layer;var g=0;while(r--){t=this._timelineStateList[r];g=t._animationState.layer;if(d!=g){if(m>=f){t._weight=0;break}else{f-=m}}d=g;n=t._animationState.weight*t._animationState.fadeWeight*f;t._weight=n;if(n&&t._blendEnabled){e=t._transform;i=t._pivot;a+=e.x*n;o+=e.y*n;s+=e.skewX*n;h+=e.skewY*n;l+=(e.scaleX-1)*n;u+=(e.scaleY-1)*n;c+=i.x*n;p+=i.y*n;m+=n}}this._tween.x=a;this._tween.y=o;this._tween.skewX=s;this._tween.skewY=h;this._tween.scaleX=l;this._tween.scaleY=u;this._tweenPivot.x=c;this._tweenPivot.y=p}};p.sortState=function(t,e){return t._animationState.layer<e._animationState.layer?-1:1};n(p,"childArmature",function(){if(this.slot){return this.slot.childArmature}return null});n(p,"display",function(){if(this.slot){return this.slot.display}return null},function(t){if(this.slot){this.slot.display=t}});n(p,"node",function(){return this._offset});n(p,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];n._updateDisplayVisible(this._visible)}}});n(p,"slot",function(){return this._slotList.length>0?this._slotList[0]:null});i._soundManager=t.SoundEventManager.getInstance();return i}(t.DBObject);t.Bone=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this._currentDisplayIndex=0;if(i!=this){throw new Error(egret.getString(4001))}this._displayList=[];this._timelineStateList=[];this._currentDisplayIndex=-1;this._originZOrder=0;this._tweenZOrder=0;this._offsetZOrder=0;this._isShowDisplay=false;this._colorTransform=new t.ColorTransform;this._displayDataList=null;this._currentDisplay=null;this.inheritRotation=true;this.inheritScale=true}var n=__define,r=i;p=r.prototype;p.initWithSlotData=function(t){this.name=t.name;this.blendMode=t.blendMode;this._originZOrder=t.zOrder;this._displayDataList=t.displayDataList;this._originDisplayIndex=t.displayIndex};p.dispose=function(){if(!this._displayList){return}e.prototype.dispose.call(this);this._displayList.length=0;this._displayDataList=null;this._displayList=null;this._currentDisplay=null};p.sortState=function(t,e){return t._animationState.layer<e._animationState.layer?-1:1};p._addState=function(t){if(this._timelineStateList.indexOf(t)<0){this._timelineStateList.push(t);this._timelineStateList.sort(this.sortState)}};p._removeState=function(t){var e=this._timelineStateList.indexOf(t);if(e>=0){this._timelineStateList.splice(e,1)}};p.setArmature=function(t){if(this._armature==t){return}if(this._armature){this._armature._removeSlotFromSlotList(this)}this._armature=t;if(this._armature){this._armature._addSlotToSlotList(this);this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}else{this._removeDisplayFromContainer()}};p._update=function(){if(this._parent._needUpdate<=0&&!this._needUpdate){return}this._updateGlobal();this._updateTransform();this._needUpdate=false};p._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._offset.skewY;this._global.x=this._origin.x+this._offset.x+this._parent._tweenPivot.x;this._global.y=this._origin.y+this._offset.y+this._parent._tweenPivot.y};p.updateChildArmatureAnimation=function(){if(this.childArmature){if(this._isShowDisplay){if(this._armature&&this._armature.animation.lastAnimationState&&this.childArmature.animation.hasAnimation(this._armature.animation.lastAnimationState.name)){this.childArmature.animation.gotoAndPlay(this._armature.animation.lastAnimationState.name)}else{this.childArmature.animation.play()}}else{this.childArmature.animation.stop();this.childArmature.animation._lastAnimationState=null}}};p._changeDisplay=function(t){if(t===void 0){t=0}if(t<0){if(this._isShowDisplay){this._isShowDisplay=false;this._removeDisplayFromContainer();this.updateChildArmatureAnimation()}}else if(this._displayList.length>0){var e=this._displayList.length;if(t>=e){t=e-1}if(this._currentDisplayIndex!=t){this._isShowDisplay=true;this._currentDisplayIndex=t;this._updateSlotDisplay();this.updateChildArmatureAnimation();if(this._displayDataList&&this._displayDataList.length>0&&this._currentDisplayIndex<this._displayDataList.length){this._origin.copy(this._displayDataList[this._currentDisplayIndex].transform)}this._needUpdate=true}else if(!this._isShowDisplay){this._isShowDisplay=true;if(this._armature){this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}this.updateChildArmatureAnimation()}}};p._updateSlotDisplay=function(){var e=-1;if(this._currentDisplay){e=this._getDisplayIndex();this._removeDisplayFromContainer()}var i=this._displayList[this._currentDisplayIndex];if(i){if(i instanceof t.Armature){this._currentDisplay=i.display}else{this._currentDisplay=i}}else{this._currentDisplay=null}this._updateDisplay(this._currentDisplay);if(this._currentDisplay){if(this._armature&&this._isShowDisplay){if(e<0){this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}else{this._addDisplayToContainer(this._armature.display,e)}}this._updateDisplayBlendMode(this._blendMode);this._updateDisplayColor(this._colorTransform.alphaOffset,this._colorTransform.redOffset,this._colorTransform.greenOffset,this._colorTransform.blueOffset,this._colorTransform.alphaMultiplier,this._colorTransform.redMultiplier,this._colorTransform.greenMultiplier,this._colorTransform.blueMultiplier,true);this._updateDisplayVisible(this._visible);this._updateTransform()}};n(p,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;this._updateDisplayVisible(this._visible)}});n(p,"displayList",function(){return this._displayList},function(t){if(!t){throw new Error}if(this._currentDisplayIndex<0){this._currentDisplayIndex=0}var e=this._displayList.length=t.length;while(e--){this._displayList[e]=t[e]}var i=this._currentDisplayIndex;this._currentDisplayIndex=-1;this._changeDisplay(i)});n(p,"display",function(){return this._currentDisplay},function(t){if(this._currentDisplayIndex<0){this._currentDisplayIndex=0}if(this._displayList[this._currentDisplayIndex]==t){return}this._displayList[this._currentDisplayIndex]=t;this._updateSlotDisplay();this.updateChildArmatureAnimation();this._updateTransform()});p.getDisplay=function(){return this.display};p.setDisplay=function(t){this.display=t};n(p,"childArmature",function(){if(this._displayList[this._currentDisplayIndex]instanceof t.Armature){return this._displayList[this._currentDisplayIndex]}return null},function(t){this.display=t});n(p,"zOrder",function(){return this._originZOrder+this._tweenZOrder+this._offsetZOrder},function(t){if(this.zOrder!=t){
this._offsetZOrder=t-this._originZOrder-this._tweenZOrder;if(this._armature){this._armature._slotsZOrderChanged=true}}});n(p,"blendMode",function(){return this._blendMode},function(t){if(this._blendMode!=t){this._blendMode=t;this._updateDisplayBlendMode(this._blendMode)}});p._updateDisplay=function(t){throw new Error("")};p._getDisplayIndex=function(){throw new Error(egret.getString(4001))};p._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}throw new Error(egret.getString(4001))};p._removeDisplayFromContainer=function(){throw new Error(egret.getString(4001))};p._updateTransform=function(){throw new Error(egret.getString(4001))};p._updateDisplayVisible=function(t){throw new Error(egret.getString(4001))};p._updateDisplayColor=function(t,e,i,n,r,a,o,s,h){if(h===void 0){h=false}this._colorTransform.alphaOffset=t;this._colorTransform.redOffset=e;this._colorTransform.greenOffset=i;this._colorTransform.blueOffset=n;this._colorTransform.alphaMultiplier=r;this._colorTransform.redMultiplier=a;this._colorTransform.greenMultiplier=o;this._colorTransform.blueMultiplier=s;this._isColorChanged=h};p._updateDisplayBlendMode=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};p._arriveAtFrame=function(t,e,i,n){var r=i.displayControl&&i.containsBoneMask(this.parent.name);if(r){var a=t;var o=a.displayIndex;var s;this._changeDisplay(o);this._updateDisplayVisible(a.visible);if(o>=0){if(!isNaN(a.zOrder)&&a.zOrder!=this._tweenZOrder){this._tweenZOrder=a.zOrder;this._armature._slotsZOrderChanged=true}}if(t.action){if(this.childArmature){this.childArmature.animation.gotoAndPlay(t.action)}}}};p._updateGlobal=function(){this._calculateRelativeParentTransform();t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix,true);var e=this._calculateParentTransform();if(e){this._globalTransformMatrix.concat(e.parentGlobalTransformMatrix);t.TransformUtil.matrixToTransform(this._globalTransformMatrix,this._global,this._global.scaleX*e.parentGlobalTransform.scaleX>=0,this._global.scaleY*e.parentGlobalTransform.scaleY>=0)}return e};p._resetToOrigin=function(){this._changeDisplay(this._originDisplayIndex);this._updateDisplayColor(0,0,0,0,1,1,1,1,true)};return i}(t.DBObject);t.Slot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.slotTimelineCacheList=[];this.slotTimelineCacheDic={};this.frameNum=0}var i=__define,n=e;p=n.prototype;e.initWithAnimationData=function(i,n){var r=new e;r.name=i.name;var a=i.timelineList;var o;var s;var h;var l;var u;for(var c=0,p=a.length;c<p;c++){o=a[c].name;for(var f=0,m=n.slotDataList.length;f<m;f++){h=n.slotDataList[f];u=h.name;if(h.parent==o){if(r.slotTimelineCacheDic[u]==null){l=new t.SlotTimelineCache;l.name=u;r.slotTimelineCacheList.push(l);r.slotTimelineCacheDic[u]=l}}}}return r};p.initSlotTimelineCacheDic=function(t,e){var i;for(var n in this.slotTimelineCacheDic){var r=this.slotTimelineCacheDic[n];i=r.name;r.cacheGenerator=t[i];r.currentFrameCache=e[i]}};p.bindCacheUserSlotDic=function(t){for(var e in t){this.slotTimelineCacheDic[e].bindCacheUser(t[e])}};p.addFrame=function(){this.frameNum++;var t;for(var e=0,i=this.slotTimelineCacheList.length;e<i;e++){t=this.slotTimelineCacheList[e];t.addFrame()}};p.update=function(t){var e=Math.floor(t*(this.frameNum-1));var i;for(var n=0,r=this.slotTimelineCacheList.length;n<r;n++){i=this.slotTimelineCacheList[n];i.update(e)}};return e}();t.AnimationCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.animationCacheDic={};this.slotFrameCacheDic={}}var i=__define,n=e;p=n.prototype;e.initWithArmatureData=function(t,i){if(i===void 0){i=0}var n=new e;n.armatureData=t;if(i<=0){var r=t.animationDataList[0];if(r){n.frameRate=r.frameRate}}else{n.frameRate=i}return n};p.initAllAnimationCache=function(){var e=this.armatureData.animationDataList.length;for(var i=0;i<e;i++){var n=this.armatureData.animationDataList[i];this.animationCacheDic[n.name]=t.AnimationCache.initWithAnimationData(n,this.armatureData)}};p.initAnimationCache=function(e){this.animationCacheDic[e]=t.AnimationCache.initWithAnimationData(this.armatureData.getAnimationData(e),this.armatureData)};p.bindCacheUserArmatures=function(t){var e=t.length;for(var i=0;i<e;i++){var n=t[i];this.bindCacheUserArmature(n)}};p.bindCacheUserArmature=function(t){t.animation.animationCacheManager=this;var e;for(var i in t._slotDic){e=t._slotDic[i];e.frameCache=this.slotFrameCacheDic[e.name]}};p.setCacheGeneratorArmature=function(e){this.cacheGeneratorArmature=e;var i;for(var n in e._slotDic){i=e._slotDic[n];this.slotFrameCacheDic[i.name]=new t.SlotFrameCache}for(var r in this.animationCacheDic){var a=this.animationCacheDic[r];a.initSlotTimelineCacheDic(e._slotDic,this.slotFrameCacheDic)}};p.generateAllAnimationCache=function(t){for(var e in this.animationCacheDic){var i=this.animationCacheDic[e];this.generateAnimationCache(i.name,t)}};p.generateAnimationCache=function(t,e){var i=this.cacheGeneratorArmature.enableCache;this.cacheGeneratorArmature.enableCache=false;var n=this.animationCacheDic[t];if(!n){return}var r=this.cacheGeneratorArmature.getAnimation().animationState;var a=1/this.frameRate;if(e){this.cacheGeneratorArmature.getAnimation().gotoAndPlay(t,0,-1,0)}else{this.cacheGeneratorArmature.getAnimation().gotoAndPlay(t,0,-1,1)}var o=this.cacheGeneratorArmature.enableEventDispatch;this.cacheGeneratorArmature.enableEventDispatch=false;var s;do{s=r.progress;this.cacheGeneratorArmature.advanceTime(a);n.addFrame()}while(r.progress>=s&&r.progress<1);this.cacheGeneratorArmature.enableEventDispatch=o;this.resetCacheGeneratorArmature();this.cacheGeneratorArmature.enableCache=i};p.resetCacheGeneratorArmature=function(){this.cacheGeneratorArmature.resetAnimation()};p.getAnimationCache=function(t){return this.animationCacheDic[t]};return e}();t.AnimationCacheManager=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.globalTransform=new t.DBTransform;this.globalTransformMatrix=new t.Matrix}var i=__define,n=e;p=n.prototype;p.copy=function(t){this.globalTransform=t.globalTransform;this.globalTransformMatrix=t.globalTransformMatrix};p.clear=function(){this.globalTransform=e.ORIGIN_TRAMSFORM;this.globalTransformMatrix=e.ORIGIN_MATRIX};e.ORIGIN_TRAMSFORM=new t.DBTransform;e.ORIGIN_MATRIX=new t.Matrix;return e}();t.FrameCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.displayIndex=-1}var i=__define,n=e;p=n.prototype;p.copy=function(e){t.prototype.copy.call(this,e);this.colorTransform=e.colorTransform;this.displayIndex=e.displayIndex};p.clear=function(){t.prototype.clear.call(this);this.colorTransform=null;this.displayIndex=-1};return e}(t.FrameCache);t.SlotFrameCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.frameCacheList=new Array}var e=__define,i=t;p=i.prototype;p.addFrame=function(){};p.update=function(t){if(t===void 0){t=0}this.currentFrameCache.copy(this.frameCacheList[t])};p.bindCacheUser=function(t){t.frameCache=this.currentFrameCache};return t}();t.TimelineCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this)}var n=__define,r=i;p=r.prototype;p.addFrame=function(){var e=new t.SlotFrameCache;e.globalTransform.copy(this.cacheGenerator.global);e.globalTransformMatrix.copyFrom(this.cacheGenerator.globalTransformMatrix);if(this.cacheGenerator.colorChanged){e.colorTransform=t.ColorTransformUtil.cloneColor(this.cacheGenerator.colorTransform)}e.displayIndex=this.cacheGenerator.displayIndex;this.frameCacheList.push(e)};return i}(t.TimelineCache);t.SlotTimelineCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){function e(t,e,i){if(e===void 0){e=false}if(i===void 0){i=false}this.bubbles=e;this.cancelable=i;this.type=t}var i=__define,n=e;p=n.prototype;return e}();t.Event=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e;p=n.prototype;i(e,"MOVEMENT_CHANGE",function(){return e.FADE_IN});i(p,"movementID",function(){return this.animationName});i(p,"armature",function(){return this.target});i(p,"animationName",function(){return this.animationState.name});e.FADE_IN="fadeIn";e.FADE_OUT="fadeOut";e.START="start";e.COMPLETE="complete";e.LOOP_COMPLETE="loopComplete";e.FADE_IN_COMPLETE="fadeInComplete";e.FADE_OUT_COMPLETE="fadeOutComplete";return e}(t.Event);t.AnimationEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e){t.call(this,e)}var i=__define,n=e;p=n.prototype;e.Z_ORDER_UPDATED="zOrderUpdated";return e}(t.Event);t.ArmatureEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e;p=n.prototype;i(e,"MOVEMENT_FRAME_EVENT",function(){return e.ANIMATION_FRAME_EVENT});i(p,"armature",function(){return this.target});e.ANIMATION_FRAME_EVENT="animationFrameEvent";e.BONE_FRAME_EVENT="boneFrameEvent";return e}(t.Event);t.FrameEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e;p=n.prototype;e.SOUND="sound";return e}(t.Event);t.SoundEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(n,e);function n(t){e.call(this);this.dragonBonesDataDic={};this.textureAtlasDic={};if(t!=this){throw new Error(egret.getString(4001))}}var r=__define,a=n;p=a.prototype;p.dispose=function(t){if(t===void 0){t=true}if(t){for(var e in this.dragonBonesDataDic){this.dragonBonesDataDic[e].dispose();delete this.dragonBonesDataDic[e]}for(var i in this.textureAtlasDic){this.textureAtlasDic[i].dispose();delete this.textureAtlasDic[i]}}this.dragonBonesDataDic=null;this.textureAtlasDic=null};p.getDragonBonesData=function(t){return this.dragonBonesDataDic[t]};p.getSkeletonData=function(t){return this.getDragonBonesData(t)};p.addDragonBonesData=function(t,e){if(e===void 0){e=null}if(!t){throw new Error}e=e||t.name;if(!e){throw new Error(egret.getString(4002))}this.dragonBonesDataDic[e]=t};p.addSkeletonData=function(t,e){if(e===void 0){e=null}this.addDragonBonesData(t,e)};p.removeDragonBonesData=function(t){delete this.dragonBonesDataDic[t]};p.removeSkeletonData=function(t){delete this.dragonBonesDataDic[t]};p.getTextureAtlas=function(t){return this.textureAtlasDic[t]};p.addTextureAtlas=function(t,e){if(e===void 0){e=null}if(!t){throw new Error}if(!e&&t.hasOwnProperty("name")){e=t.name}if(!e){throw new Error(egret.getString(4002))}this.textureAtlasDic[e]=t};p.removeTextureAtlas=function(t){delete this.textureAtlasDic[t]};p.getTextureDisplay=function(t,e,i,n){if(e===void 0){e=null}if(i===void 0){i=NaN}if(n===void 0){n=NaN}var r;if(e){r=this.textureAtlasDic[e]}else{for(e in this.textureAtlasDic){r=this.textureAtlasDic[e];if(r.getRegion(t)){break}r=null}}if(!r){return null}if(isNaN(i)||isNaN(n)){var a=this.dragonBonesDataDic[e];a=a?a:this.findFirstDragonBonesData();if(a){var o=a.getDisplayDataByName(t);if(o){i=o.pivot.x;n=o.pivot.y}}}return this._generateDisplay(r,t,i,n)};p.buildArmature=function(t,e,i,n){if(e===void 0){e=null}if(i===void 0){i=null}if(n===void 0){n=null}var r={};if(this.fillBuildArmatureDataPackageArmatureInfo(t,e,r)){this.fillBuildArmatureDataPackageTextureInfo(i,r)}var a=r.dragonBonesData;var o=r.armatureData;var s=r.textureAtlas;if(!o||!s){return null}return this.buildArmatureUsingArmatureDataFromTextureAtlas(a,o,s,n)};p.buildFastArmature=function(t,e,n,r){if(e===void 0){e=null}if(n===void 0){n=null}if(r===void 0){r=null}var a=new i;if(this.fillBuildArmatureDataPackageArmatureInfo(t,e,a)){this.fillBuildArmatureDataPackageTextureInfo(n,a)}var o=a.dragonBonesData;var s=a.armatureData;var h=a.textureAtlas;if(!s||!h){return null}return this.buildFastArmatureUsingArmatureDataFromTextureAtlas(o,s,h,r)};p.buildArmatureUsingArmatureDataFromTextureAtlas=function(t,e,i,n){if(n===void 0){n=null}var r=this._generateArmature();r.name=e.name;r.__dragonBonesData=t;r._armatureData=e;r.animation.animationDataList=e.animationDataList;this._buildBones(r);this._buildSlots(r,n,i);r.advanceTime(0);return r};p.buildFastArmatureUsingArmatureDataFromTextureAtlas=function(t,e,i,n){if(n===void 0){n=null}var r=this._generateFastArmature();r.name=e.name;r.__dragonBonesData=t;r._armatureData=e;r.animation.animationDataList=e.animationDataList;this._buildFastBones(r);this._buildFastSlots(r,n,i);r.advanceTime(0);return r};p.copyAnimationsToArmature=function(e,i,n,r){if(n===void 0){n=null}if(r===void 0){r=true}var a={};if(!this.fillBuildArmatureDataPackageArmatureInfo(i,n,a)){return false}var o=a.armatureData;e.animation.animationDataList=o.animationDataList;var s=o.getSkinData("");var h;var l;var u=e.getSlots(false);var c;var p;var f=0;var m;var d;var g=u.length;for(var y=0;y<g;y++){c=u[y];p=c.displayList;f=p.length;for(var v=0;v<f;v++){m=p[v];if(m instanceof t.Armature){d=m;h=s.getSlotData(c.name);l=h.displayDataList[v];if(l.type==t.DisplayData.ARMATURE){this.copyAnimationsToArmature(d,l.name,a.dragonBonesDataName,r)}}}}return true};p.fillBuildArmatureDataPackageArmatureInfo=function(t,e,i){if(e){i.dragonBonesDataName=e;i.dragonBonesData=this.dragonBonesDataDic[e];i.armatureData=i.dragonBonesData.getArmatureDataByName(t);return true}else{for(e in this.dragonBonesDataDic){i.dragonBonesData=this.dragonBonesDataDic[e];i.armatureData=i.dragonBonesData.getArmatureDataByName(t);if(i.armatureData){i.dragonBonesDataName=e;return true}}}return false};p.fillBuildArmatureDataPackageTextureInfo=function(t,e){e.textureAtlas=this.textureAtlasDic[t?t:e.dragonBonesDataName]};p.findFirstDragonBonesData=function(){for(var t in this.dragonBonesDataDic){var e=this.dragonBonesDataDic[t];if(e){return e}}return null};p.findFirstTextureAtlas=function(){for(var t in this.textureAtlasDic){var e=this.textureAtlasDic[t];if(e){return e}}return null};p._buildBones=function(e){var i=e.armatureData.boneDataList;var n;var r;var a;for(var o=0;o<i.length;o++){n=i[o];r=t.Bone.initWithBoneData(n);a=n.parent;if(a&&e.armatureData.getBoneData(a)==null){a=null}e.addBone(r,a,true)}e._updateAnimationAfterBoneListChanged()};p._buildSlots=function(e,i,n){var r=e.armatureData.getSkinData(i);if(!r){return}e.armatureData.setSkinData(i);var a=[];var o=e.armatureData.slotDataList;var s;var h;var l;for(var u=0;u<o.length;u++){s=o[u];l=e.getBone(s.parent);if(!l){continue}h=this._generateSlot();h.initWithSlotData(s);l.addSlot(h);a.length=0;var c=s.displayDataList.length;while(c--){var p=s.displayDataList[c];switch(p.type){case t.DisplayData.ARMATURE:var f=this.buildArmatureUsingArmatureDataFromTextureAtlas(e.__dragonBonesData,e.__dragonBonesData.getArmatureDataByName(p.name),n,i);a[c]=f;break;case t.DisplayData.IMAGE:default:a[c]=this._generateDisplay(n,p.name,p.pivot.x,p.pivot.y);break}}for(var m=0,d=a.length;m<d;m++){var g=a[m];if(!g){continue}if(g instanceof t.Armature){g=g.display}if(g.hasOwnProperty("name")){try{g["name"]=h.name}catch(y){}}}h.displayList=a;h._changeDisplay(s.displayIndex)}};p._buildFastBones=function(e){var i=e.armatureData.boneDataList;var n;var r;for(var a=0;a<i.length;a++){n=i[a];r=t.FastBone.initWithBoneData(n);e.addBone(r,n.parent)}};p._buildFastSlots=function(e,i,n){var r=e.armatureData.getSkinData(i);if(!r){return}e.armatureData.setSkinData(i);var a=[];var o=e.armatureData.slotDataList;var s;var h;for(var l=0;l<o.length;l++){a.length=0;s=o[l];h=this._generateFastSlot();h.initWithSlotData(s);var u=s.displayDataList.length;while(u--){var c=s.displayDataList[u];switch(c.type){case t.DisplayData.ARMATURE:var p=this.buildFastArmatureUsingArmatureDataFromTextureAtlas(e.__dragonBonesData,e.__dragonBonesData.getArmatureDataByName(c.name),n,i);a[u]=p;h.hasChildArmature=true;break;case t.DisplayData.IMAGE:default:a[u]=this._generateDisplay(n,c.name,c.pivot.x,c.pivot.y);break}}var f=a.length;for(var m=0;m<f;m++){var d=a[m];if(!d){continue}if(d instanceof t.FastArmature){d=d.display}if(d.hasOwnProperty("name")){try{d["name"]=h.name}catch(g){}}}h.initDisplayList(a.concat());e.addSlot(h,s.parent);h._changeDisplayIndex(s.displayIndex)}};p._generateArmature=function(){return null};p._generateSlot=function(){return null};p._generateFastArmature=function(){return null};p._generateFastSlot=function(){return null};p._generateDisplay=function(t,e,i,n){return null};n._helpMatrix=new t.Matrix;return n}(t.EventDispatcher);t.BaseFactory=e;var i=function(){function t(){}var e=__define,i=t;p=i.prototype;return t}();t.BuildArmatureDataPackage=i})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this.isCacheManagerExclusive=false;this._enableEventDispatch=true;this.useCache=true;this._display=i;this._animation=new t.FastAnimation(this);this._slotsZOrderChanged=false;this._armatureData=null;this.boneList=[];this._boneDic={};this.slotList=[];this._slotDic={};this.slotHasChildArmatureList=[];this._eventList=[];this._delayDispose=false;this._lockDispose=false}var n=__define,r=i;p=r.prototype;p.dispose=function(){this._delayDispose=true;if(!this._animation||this._lockDispose){return}this.userData=null;this._animation.dispose();var t=this.slotList.length;while(t--){this.slotList[t].dispose()}t=this.boneList.length;while(t--){this.boneList[t].dispose()}this.slotList.length=0;this.boneList.length=0;this._armatureData=null;this._animation=null;this.slotList=null;this.boneList=null;this._eventList=null};p.advanceTime=function(t){this._lockDispose=true;this._animation.advanceTime(t);var e;var i;var n=0;if(this._animation.animationState.isUseCache()){if(!this.useCache){this.useCache=true}n=this.slotList.length;while(n--){i=this.slotList[n];i.updateByCache()}}else{if(this.useCache){this.useCache=false;n=this.slotList.length;while(n--){i=this.slotList[n];i.switchTransformToBackup()}}n=this.boneList.length;while(n--){e=this.boneList[n];e.update()}n=this.slotList.length;while(n--){i=this.slotList[n];i._update()}}n=this.slotHasChildArmatureList.length;while(n--){i=this.slotHasChildArmatureList[n];var r=i.childArmature;if(r){r.advanceTime(t)}}if(this._slotsZOrderChanged){this.updateSlotsZOrder()}while(this._eventList.length>0){this.dispatchEvent(this._eventList.shift())}this._lockDispose=false;if(this._delayDispose){this.dispose()}};p.enableAnimationCache=function(e,i,n){if(i===void 0){i=null}if(n===void 0){n=true}var r=t.AnimationCacheManager.initWithArmatureData(this.armatureData,e);if(i){var a=i.length;for(var o=0;o<a;o++){var s=i[o];r.initAnimationCache(s)}}else{r.initAllAnimationCache()}r.setCacheGeneratorArmature(this);r.generateAllAnimationCache(n);r.bindCacheUserArmature(this);this.enableCache=true;return r};p.getBone=function(t){return this._boneDic[t]};p.getSlot=function(t){return this._slotDic[t]};p.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null};p.getSlotByDisplay=function(t){if(t){for(var e=0,i=this.slotList.length;e<i;e++){if(this.slotList[e].display==t){return this.slotList[e]}}}return null};p.getSlots=function(t){if(t===void 0){t=true}return t?this.slotList.concat():this.slotList};p._updateBonesByCache=function(){var t=this.boneList.length;var e;while(t--){e=this.boneList[t];e.update()}};p.addBone=function(t,e){if(e===void 0){e=null}var i;if(e){i=this.getBone(e);i.boneList.push(t)}t.armature=this;t.setParent(i);this.boneList.unshift(t);this._boneDic[t.name]=t};p.addSlot=function(t,e){var i=this.getBone(e);if(i){t.armature=this;t.setParent(i);i.slotList.push(t);t._addDisplayToContainer(this.display);this.slotList.push(t);this._slotDic[t.name]=t;if(t.hasChildArmature){this.slotHasChildArmatureList.push(t)}}else{throw new Error}};p.updateSlotsZOrder=function(){this.slotList.sort(this.sortSlot);var t=this.slotList.length;while(t--){var e=this.slotList[t];if(e._frameCache&&e._frameCache.displayIndex>=0||!e._frameCache&&e.displayIndex>=0){e._addDisplayToContainer(this._display)}}this._slotsZOrderChanged=false};p.sortBoneList=function(){var e=this.boneList.length;if(e==0){return}var i=[];while(e--){var n=0;var r=this.boneList[e];var a=r;while(a){n++;a=a.parent}i[e]=[n,r]}i.sort(t.ArmatureData.sortBoneDataHelpArrayDescending);e=i.length;while(e--){this.boneList[e]=i[e][1]}i.length=0};p.arriveAtFrame=function(e,i){if(e.event&&this.hasEventListener(t.FrameEvent.ANIMATION_FRAME_EVENT)){var n=new t.FrameEvent(t.FrameEvent.ANIMATION_FRAME_EVENT);n.animationState=i;n.frameLabel=e.event;this._addEvent(n)}if(e.action){this.animation.gotoAndPlay(e.action)}};p.invalidUpdate=function(t){if(t===void 0){t=null}if(t){var e=this.getBone(t);if(e){e.invalidUpdate()}}else{var i=this.boneList.length;while(i--){this.boneList[i].invalidUpdate()}}};p.resetAnimation=function(){this.animation.animationState._resetTimelineStateList();var t=this.boneList.length;for(var e=0;e<t;e++){var i=this.boneList[e];i._timelineState=null}this.animation.stop()};p.sortSlot=function(t,e){return t.zOrder<e.zOrder?1:-1};p.getAnimation=function(){return this._animation};n(p,"armatureData",function(){return this._armatureData});n(p,"animation",function(){return this._animation});n(p,"display",function(){return this._display});n(p,"enableCache",function(){return this._enableCache},function(t){this._enableCache=t});n(p,"enableEventDispatch",function(){return this._enableEventDispatch},function(t){this._enableEventDispatch=t});p._addEvent=function(t){if(this._enableEventDispatch){this._eventList.push(t)}};return i}(t.EventDispatcher);t.FastArmature=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._globalTransformMatrix=new t.Matrix;this._global=new t.DBTransform;this._origin=new t.DBTransform;this._visible=true;this.armature=null;this._parent=null;this.userData=null;this.inheritRotation=true;this.inheritScale=true;this.inheritTranslation=true}var i=__define,n=e;p=n.prototype;p.updateByCache=function(){this._global=this._frameCache.globalTransform;this._globalTransformMatrix=this._frameCache.globalTransformMatrix};p.switchTransformToBackup=function(){if(!this._globalBackup){this._globalBackup=new t.DBTransform;this._globalTransformMatrixBackup=new t.Matrix}this._global=this._globalBackup;this._globalTransformMatrix=this._globalTransformMatrixBackup};p.setParent=function(t){this._parent=t};p.dispose=function(){this.userData=null;this._globalTransformMatrix=null;this._global=null;this._origin=null;this.armature=null;this._parent=null};p._calculateParentTransform=function(){if(this.parent&&(this.inheritTranslation||this.inheritRotation||this.inheritScale)){var i=this._parent._global;var n=this._parent._globalTransformMatrix;if(!this.inheritTranslation&&(i.x!=0||i.y!=0)||!this.inheritRotation&&(i.skewX!=0||i.skewY!=0)||!this.inheritScale&&(i.scaleX!=1||i.scaleY!=1)){i=e._tempParentGlobalTransform;i.copy(this._parent._global);if(!this.inheritTranslation){i.x=0;i.y=0}if(!this.inheritScale){i.scaleX=1;i.scaleY=1}if(!this.inheritRotation){i.skewX=0;i.skewY=0}n=t.DBObject._tempParentGlobalTransformMatrix;t.TransformUtil.transformToMatrix(i,n)}e.tempOutputObj.parentGlobalTransform=i;e.tempOutputObj.parentGlobalTransformMatrix=n;return e.tempOutputObj}return null};p._updateGlobal=function(){this._calculateRelativeParentTransform();var e=this._calculateParentTransform();if(e!=null){var i=e.parentGlobalTransformMatrix;var n=e.parentGlobalTransform;var r=this._global.x;var a=this._global.y;this._global.x=i.a*r+i.c*a+i.tx;this._global.y=i.d*a+i.b*r+i.ty;if(this.inheritRotation){this._global.skewX+=n.skewX;this._global.skewY+=n.skewY}if(this.inheritScale){this._global.scaleX*=n.scaleX;this._global.scaleY*=n.scaleY}}t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix,true);return e};p._calculateRelativeParentTransform=function(){};i(p,"name",function(){return this._name},function(t){this._name=t});i(p,"global",function(){return this._global});i(p,"globalTransformMatrix",function(){return this._globalTransformMatrix});i(p,"origin",function(){return this._origin});i(p,"parent",function(){return this._parent});i(p,"visible",function(){return this._visible},function(t){this._visible=t});i(p,"frameCache",undefined,function(t){this._frameCache=t});e._tempParentGlobalTransform=new t.DBTransform;e.tempOutputObj={};return e}();t.FastDBObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.slotList=[];this.boneList=[];this._needUpdate=0;this._needUpdate=2;this._tweenPivot=new t.Point}var n=__define,r=i;p=r.prototype;i.initWithBoneData=function(t){var e=new i;e.name=t.name;e.inheritRotation=t.inheritRotation;e.inheritScale=t.inheritScale;e.origin.copy(t.transform);return e};p.getBones=function(t){if(t===void 0){t=true}return t?this.boneList.concat():this.boneList};p.getSlots=function(t){if(t===void 0){t=true}return t?this.slotList.concat():this.slotList};p.dispose=function(){e.prototype.dispose.call(this);this._timelineState=null;this._tweenPivot=null};p.invalidUpdate=function(){this._needUpdate=2};p._calculateRelativeParentTransform=function(){this._global.copy(this._origin);if(this._timelineState){this._global.add(this._timelineState._transform)}};p.updateByCache=function(){e.prototype.updateByCache.call(this);this._global=this._frameCache.globalTransform;this._globalTransformMatrix=this._frameCache.globalTransformMatrix};p.update=function(t){if(t===void 0){t=false}this._needUpdate--;if(t||this._needUpdate>0||this._parent&&this._parent._needUpdate>0){this._needUpdate=1}else{return}this.blendingTimeline();this._updateGlobal()};p._hideSlots=function(){var t=this.slotList.length;for(var e=0;e<t;e++){var i=this.slotList[e];i.hideSlots()}};p.blendingTimeline=function(){if(this._timelineState){this._tweenPivot.x=this._timelineState._pivot.x;this._tweenPivot.y=this._timelineState._pivot.y}};p.arriveAtFrame=function(e,i){var n;if(e.event&&this.armature.hasEventListener(t.FrameEvent.BONE_FRAME_EVENT)){var r=new t.FrameEvent(t.FrameEvent.BONE_FRAME_EVENT);r.bone=this;r.animationState=i;r.frameLabel=e.event;this.armature._addEvent(r)}};n(p,"childArmature",function(){var t=this.slot;if(t){return t.childArmature}return null});n(p,"display",function(){var t=this.slot;if(t){return t.display}return null},function(t){var e=this.slot;if(e){e.display=t}});n(p,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;for(var e=0,i=this.armature.slotList.length;e<i;e++){if(this.armature.slotList[e].parent==this){this.armature.slotList[e]._updateDisplayVisible(this._visible)}}}});n(p,"slot",function(){return this.slotList.length>0?this.slotList[0]:null});return i}(t.FastDBObject);t.FastBone=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this._currentDisplayIndex=0;if(i!=this){throw new Error("Abstract class can not be instantiated!")}this.hasChildArmature=false;this._currentDisplayIndex=-1;this._originZOrder=0;this._tweenZOrder=0;this._offsetZOrder=0;this._colorTransform=new t.ColorTransform;this._isColorChanged=false;this._displayDataList=null;this._currentDisplay=null;this.inheritRotation=true;this.inheritScale=true}var n=__define,r=i;p=r.prototype;p.initWithSlotData=function(t){this.name=t.name;this.blendMode=t.blendMode;this._originZOrder=t.zOrder;this._displayDataList=t.displayDataList;this._originDisplayIndex=t.displayIndex};p.dispose=function(){if(!this._displayList){return}e.prototype.dispose.call(this);this._displayDataList=null;this._displayList=null;this._currentDisplay=null};p.updateByCache=function(){e.prototype.updateByCache.call(this);this._updateTransform();var i=this._frameCache.colorTransform;var n=i!=null;if(this.colorChanged!=n||this.colorChanged&&n&&!t.ColorTransformUtil.isEqual(this._colorTransform,i)){i=i||t.ColorTransformUtil.originalColor;this._updateDisplayColor(i.alphaOffset,i.redOffset,i.greenOffset,i.blueOffset,i.alphaMultiplier,i.redMultiplier,i.greenMultiplier,i.blueMultiplier,n)}this._changeDisplayIndex(this._frameCache.displayIndex)};p._update=function(){if(this._parent._needUpdate<=0){return}this._updateGlobal();this._updateTransform()};p._calculateRelativeParentTransform=function(){this._global.copy(this._origin);this._global.x+=this._parent._tweenPivot.x;this._global.y+=this._parent._tweenPivot.y};p.initDisplayList=function(t){this._displayList=t};p.clearCurrentDisplay=function(){if(this.hasChildArmature){var t=this.childArmature;if(t){t.resetAnimation()}}var e=this._getDisplayIndex();this._removeDisplayFromContainer();return e};p._changeDisplayIndex=function(t){if(t===void 0){t=0}if(this._currentDisplayIndex==t){return}var e=-1;if(this._currentDisplayIndex>=0){e=this.clearCurrentDisplay()}this._currentDisplayIndex=t;if(this._currentDisplayIndex>=0){this._origin.copy(this._displayDataList[this._currentDisplayIndex].transform);this.initCurrentDisplay(e)}};p.changeSlotDisplay=function(t){var e=this.clearCurrentDisplay();this._displayList[this._currentDisplayIndex]=t;this.initCurrentDisplay(e)};p.initCurrentDisplay=function(e){if(e===void 0){e=0}var i=this._displayList[this._currentDisplayIndex];if(i){if(i instanceof t.FastArmature){this._currentDisplay=i.display}else{this._currentDisplay=i}}else{this._currentDisplay=null}this._updateDisplay(this._currentDisplay);if(this._currentDisplay){if(e!=-1){this._addDisplayToContainer(this.armature.display,e)}else{this.armature._slotsZOrderChanged=true;this._addDisplayToContainer(this.armature.display)}if(this._blendMode){this._updateDisplayBlendMode(this._blendMode)}if(this._isColorChanged){this._updateDisplayColor(this._colorTransform.alphaOffset,this._colorTransform.redOffset,this._colorTransform.greenOffset,this._colorTransform.blueOffset,this._colorTransform.alphaMultiplier,this._colorTransform.redMultiplier,this._colorTransform.greenMultiplier,this._colorTransform.blueMultiplier,true)}this._updateTransform();if(i instanceof t.FastArmature){var n=i;if(this.armature&&this.armature.animation.animationState&&n.animation.hasAnimation(this.armature.animation.animationState.name)){n.animation.gotoAndPlay(this.armature.animation.animationState.name)}else{n.animation.play()}}}};n(p,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;this._updateDisplayVisible(this._visible)}});n(p,"displayList",function(){return this._displayList},function(t){if(!t){throw new Error}var e=t[this._currentDisplayIndex];var i=this._currentDisplayIndex>=0&&this._displayList[this._currentDisplayIndex]!=e;this._displayList=t;if(i){this.changeSlotDisplay(e)}});n(p,"display",function(){return this._currentDisplay},function(t){if(this._currentDisplayIndex<0){return}if(this._displayList[this._currentDisplayIndex]==t){return}this.changeSlotDisplay(t)});n(p,"childArmature",function(){return this._displayList[this._currentDisplayIndex]instanceof t.Armature||this._displayList[this._currentDisplayIndex]instanceof t.FastArmature?this._displayList[this._currentDisplayIndex]:null},function(t){this.display=t});n(p,"zOrder",function(){return this._originZOrder+this._tweenZOrder+this._offsetZOrder},function(t){if(this.zOrder!=t){this._offsetZOrder=t-this._originZOrder-this._tweenZOrder;if(this.armature){this.armature._slotsZOrderChanged=true}}});n(p,"blendMode",function(){return this._blendMode},function(t){if(this._blendMode!=t){this._blendMode=t;this._updateDisplayBlendMode(this._blendMode)}});n(p,"colorTransform",function(){return this._colorTransform});n(p,"displayIndex",function(){return this._currentDisplayIndex});n(p,"colorChanged",function(){return this._isColorChanged});p._updateDisplay=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};p._getDisplayIndex=function(){throw new Error("Abstract method needs to be implemented in subclass!");
};p._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}throw new Error("Abstract method needs to be implemented in subclass!")};p._removeDisplayFromContainer=function(){throw new Error("Abstract method needs to be implemented in subclass!")};p._updateTransform=function(){throw new Error("Abstract method needs to be implemented in subclass!")};p._updateDisplayVisible=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};p._updateDisplayColor=function(t,e,i,n,r,a,o,s,h){if(h===void 0){h=false}this._colorTransform.alphaOffset=t;this._colorTransform.redOffset=e;this._colorTransform.greenOffset=i;this._colorTransform.blueOffset=n;this._colorTransform.alphaMultiplier=r;this._colorTransform.redMultiplier=a;this._colorTransform.greenMultiplier=o;this._colorTransform.blueMultiplier=s;this._isColorChanged=h};p._updateDisplayBlendMode=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};p._arriveAtFrame=function(t,e){var i=t;var n=i.displayIndex;this._changeDisplayIndex(n);this._updateDisplayVisible(i.visible);if(n>=0){if(!isNaN(i.zOrder)&&i.zOrder!=this._tweenZOrder){this._tweenZOrder=i.zOrder;this.armature._slotsZOrderChanged=true}}if(t.action){var r=this.childArmature;if(r){r.getAnimation().gotoAndPlay(t.action)}}};p.hideSlots=function(){this._changeDisplayIndex(-1);this._removeDisplayFromContainer();if(this._frameCache){this._frameCache.clear()}};p._updateGlobal=function(){this._calculateRelativeParentTransform();t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix,true);var e=this._calculateParentTransform();if(e){this._globalTransformMatrix.concat(e.parentGlobalTransformMatrix);t.TransformUtil.matrixToTransform(this._globalTransformMatrix,this._global,this._global.scaleX*e.parentGlobalTransform.scaleX>=0,this._global.scaleY*e.parentGlobalTransform.scaleY>=0)}return e};p._resetToOrigin=function(){this._changeDisplayIndex(this._originDisplayIndex);this._updateDisplayColor(0,0,0,0,1,1,1,1,true)};return i}(t.FastDBObject);t.FastSlot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(e){this.animationState=new t.FastAnimationState;this._armature=e;this.animationState._armature=e;this.animationList=[];this._animationDataObj={};this._isPlaying=false;this._timeScale=1}var i=__define,n=e;p=n.prototype;p.dispose=function(){if(!this._armature){return}this._armature=null;this._animationDataList=null;this.animationList=null;this.animationState=null};p.gotoAndPlay=function(t,e,i,n){if(e===void 0){e=-1}if(i===void 0){i=-1}if(n===void 0){n=NaN}if(!this._animationDataList){return null}var r=this._animationDataObj[t];if(!r){return null}this._isPlaying=true;e=e<0?r.fadeTime<0?.3:r.fadeTime:e;var a;if(i<0){a=r.scale<0?1:r.scale}else{a=i*1e3/r.duration}n=isNaN(n)?r.playTimes:n;this.animationState._fadeIn(r,n,1/a,e);if(this._armature.enableCache&&this.animationCacheManager){this.animationState.animationCache=this.animationCacheManager.getAnimationCache(t)}var o=this._armature.slotHasChildArmatureList.length;while(o--){var s=this._armature.slotHasChildArmatureList[o];var h=s.childArmature;if(h){h.getAnimation().gotoAndPlay(t)}}return this.animationState};p.gotoAndStop=function(t,e,i,n,r){if(i===void 0){i=-1}if(n===void 0){n=0}if(r===void 0){r=-1}if(this.animationState.name!=t){this.gotoAndPlay(t,n,r)}if(i>=0){this.animationState.setCurrentTime(this.animationState.totalTime*i)}else{this.animationState.setCurrentTime(e)}this.animationState.stop();return this.animationState};p.play=function(){if(!this._animationDataList){return}if(!this.animationState.name){this.gotoAndPlay(this._animationDataList[0].name)}else if(!this._isPlaying){this._isPlaying=true}else{this.gotoAndPlay(this.animationState.name)}};p.stop=function(){this._isPlaying=false};p.advanceTime=function(t){if(!this._isPlaying){return}this.animationState._advanceTime(t*this._timeScale)};p.hasAnimation=function(t){return this._animationDataObj[t]!=null};i(p,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});i(p,"animationDataList",function(){return this._animationDataList},function(t){this._animationDataList=t;this.animationList.length=0;var e=this._animationDataList.length;for(var i=0;i<e;i++){var n=this._animationDataList[i];this.animationList.push(n.name);this._animationDataObj[n.name]=n}});i(p,"movementList",function(){return this.animationList});i(p,"movementID",function(){return this.lastAnimationName});p.isPlaying=function(){return this._isPlaying&&!this.isComplete};i(p,"isComplete",function(){return this.animationState.isComplete});i(p,"lastAnimationState",function(){return this.animationState});i(p,"lastAnimationName",function(){return this.animationState?this.animationState.name:null});return e}();t.FastAnimation=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._boneTimelineStateList=[];this._slotTimelineStateList=[];this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._currentPlayTimes=0;this._totalTime=0;this._currentTime=0;this._lastTime=0;this._playTimes=0;this._fading=false}var i=__define,n=e;p=n.prototype;p.dispose=function(){this._resetTimelineStateList();this._armature=null};p.play=function(){this._isPlaying=true;return this};p.stop=function(){this._isPlaying=false;return this};p.setCurrentTime=function(t){if(t<0||isNaN(t)){t=0}this._time=t;this._currentTime=this._time*1e3;return this};p._resetTimelineStateList=function(){var e=this._boneTimelineStateList.length;while(e--){t.FastBoneTimelineState.returnObject(this._boneTimelineStateList[e])}this._boneTimelineStateList.length=0;e=this._slotTimelineStateList.length;while(e--){t.FastSlotTimelineState.returnObject(this._slotTimelineStateList[e])}this._slotTimelineStateList.length=0;this.name=null};p._fadeIn=function(t,e,i,n){this.animationData=t;this.name=this.animationData.name;this._totalTime=this.animationData.duration;this.autoTween=t.autoTween;this.setTimeScale(i);this.setPlayTimes(e);this._isComplete=false;this._currentFrameIndex=-1;this._currentPlayTimes=-1;if(Math.round(this._totalTime*this.animationData.frameRate*.001)<2){this._currentTime=this._totalTime}else{this._currentTime=-1}this._fadeTotalTime=n*this._timeScale;this._fading=this._fadeTotalTime>0;this._isPlaying=true;if(this._armature.enableCache&&this.animationCache&&this._fading&&this._boneTimelineStateList){this.updateTransformTimeline(this.progress)}this._time=0;this._progress=0;this._updateTimelineStateList();this.hideBones();return};p._updateTimelineStateList=function(){this._resetTimelineStateList();var e;var i=this.animationData.timelineList.length;for(var n=0;n<i;n++){var r=this.animationData.timelineList[n];e=r.name;var a=this._armature.getBone(e);if(a){var o=t.FastBoneTimelineState.borrowObject();o.fadeIn(a,this,r);this._boneTimelineStateList.push(o)}}var s=this.animationData.slotTimelineList.length;for(var h=0;h<s;h++){var l=this.animationData.slotTimelineList[h];e=l.name;var u=this._armature.getSlot(e);if(u&&u.displayList.length>0){var c=t.FastSlotTimelineState.borrowObject();c.fadeIn(u,this,l);this._slotTimelineStateList.push(c)}}};p._advanceTime=function(t){t*=this._timeScale;if(this._fading){this._time+=t;this._progress=this._time/this._fadeTotalTime;if(this._progress>=1){this._progress=0;this._time=0;this._fading=false}}if(this._fading){var e=this._boneTimelineStateList.length;for(var i=0;i<e;i++){var n=this._boneTimelineStateList[i];n.updateFade(this.progress)}var r=this._slotTimelineStateList.length;for(var a=0;a<r;a++){var o=this._slotTimelineStateList[a];o.updateFade(this.progress)}}else{this.advanceTimelinesTime(t)}};p.advanceTimelinesTime=function(e){this._time+=e;var i=false;var n=false;var r=false;var a=false;var o=0;var s=this._time*1e3;if(this._playTimes==0||s<this._playTimes*this._totalTime){a=false;this._progress=s/this._totalTime;o=Math.ceil(this.progress)||1;this._progress-=Math.floor(this.progress);s%=this._totalTime}else{o=this._playTimes;s=this._totalTime;a=true;this._progress=1}this._isComplete=a;if(this.isUseCache()){this.animationCache.update(this.progress)}else{this.updateTransformTimeline(this.progress)}if(this._currentTime!=s){if(this._currentPlayTimes!=o){if(this._currentPlayTimes>0&&o>1){n=true}this._currentPlayTimes=o}if(this._currentTime<0){i=true}if(this._isComplete){r=true}this._lastTime=this._currentTime;this._currentTime=s;this.updateMainTimeline(a)}var h;if(i){if(this._armature.hasEventListener(t.AnimationEvent.START)){h=new t.AnimationEvent(t.AnimationEvent.START);h.animationState=this;this._armature._addEvent(h)}}if(r){if(this._armature.hasEventListener(t.AnimationEvent.COMPLETE)){h=new t.AnimationEvent(t.AnimationEvent.COMPLETE);h.animationState=this;this._armature._addEvent(h)}}else if(n){if(this._armature.hasEventListener(t.AnimationEvent.LOOP_COMPLETE)){h=new t.AnimationEvent(t.AnimationEvent.LOOP_COMPLETE);h.animationState=this;this._armature._addEvent(h)}}};p.updateTransformTimeline=function(t){var e=this._boneTimelineStateList.length;var i;var n;if(this._isComplete){while(e--){i=this._boneTimelineStateList[e];i.update(t);this._isComplete=i._isComplete&&this._isComplete}e=this._slotTimelineStateList.length;while(e--){n=this._slotTimelineStateList[e];n.update(t);this._isComplete=n._isComplete&&this._isComplete}}else{while(e--){i=this._boneTimelineStateList[e];i.update(t)}e=this._slotTimelineStateList.length;while(e--){n=this._slotTimelineStateList[e];n.update(t)}}};p.updateMainTimeline=function(t){var e=this.animationData.frameList;if(e.length>0){var i;var n;for(var r=0,a=this.animationData.frameList.length;r<a;++r){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._lastTime=this._currentTime;this._currentFrameIndex++;if(this._currentFrameIndex>=e.length){if(t){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}n=e[this._currentFrameIndex];if(i){this._armature.arriveAtFrame(i,this)}this._currentFrameDuration=n.duration;this._currentFramePosition=n.position;i=n}if(n){this._armature.arriveAtFrame(n,this)}}};p.setTimeScale=function(t){if(isNaN(t)||t==Infinity){t=1}this._timeScale=t;return this};p.setPlayTimes=function(t){if(t===void 0){t=0}if(Math.round(this._totalTime*.001*this.animationData.frameRate)<2){this._playTimes=1}else{this._playTimes=t}return this};i(p,"playTimes",function(){return this._playTimes});i(p,"currentPlayTimes",function(){return this._currentPlayTimes<0?0:this._currentPlayTimes});i(p,"isComplete",function(){return this._isComplete});i(p,"isPlaying",function(){return this._isPlaying&&!this._isComplete});i(p,"totalTime",function(){return this._totalTime*.001});i(p,"currentTime",function(){return this._currentTime<0?0:this._currentTime*.001});p.isUseCache=function(){return this._armature.enableCache&&this.animationCache&&!this._fading};p.hideBones=function(){var t=this.animationData.hideTimelineNameMap.length;for(var e=0;e<t;e++){var i=this.animationData.hideTimelineNameMap[e];var n=this._armature.getBone(i);if(n){n._hideSlots()}}var r;for(e=0,t=this.animationData.hideSlotTimelineNameMap.length;e<t;e++){r=this.animationData.hideSlotTimelineNameMap[e];var a=this._armature.getSlot(r);if(a){a._resetToOrigin()}}};i(p,"progress",function(){return this._progress});return e}();t.FastAnimationState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._lastTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._transform=new t.DBTransform;this._durationTransform=new t.DBTransform;this._transformToFadein=new t.DBTransform;this._pivot=new t.Point;this._durationPivot=new t.Point}var i=__define,n=e;p=n.prototype;e.borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e.returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e.clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};p.clear=function(){if(this._bone){this._bone._timelineState=null;this._bone=null}this._animationState=null;this._timelineData=null;this._originPivot=null};p.fadeIn=function(e,i,n){this._bone=e;this._animationState=i;this._timelineData=n;this.name=n.name;this._totalTime=this._timelineData.duration;this._isComplete=false;this._tweenTransform=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._durationPivot.x=0;this._durationPivot.y=0;this._pivot.x=0;this._pivot.y=0;this._originPivot=this._timelineData.originPivot;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}if(i._fadeTotalTime>0){var r;if(this._bone._timelineState){this._transformToFadein.copy(this._bone._timelineState._transform)}else{this._transformToFadein=new t.DBTransform}var a=this._timelineData.frameList[0];this._durationTransform.copy(a.transform);this._durationTransform.minus(this._transformToFadein)}this._bone._timelineState=this};p.updateFade=function(t){this._transform.x=this._transformToFadein.x+this._durationTransform.x*t;this._transform.y=this._transformToFadein.y+this._durationTransform.y*t;this._transform.scaleX=this._transformToFadein.scaleX*(1+(this._durationTransform.scaleX-1)*t);this._transform.scaleY=this._transformToFadein.scaleX*(1+(this._durationTransform.scaleY-1)*t);this._transform.rotation=this._transformToFadein.rotation+this._durationTransform.rotation*t;this._bone.invalidUpdate()};p.update=function(t){if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}else if(this._updateMode==-1){this.updateMultipleFrame(t)}};p.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._bone.arriveAtFrame(t,this._animationState);this._isComplete=true;this._tweenEasing=NaN;this._tweenTransform=false;this._pivot.x=this._originPivot.x+t.pivot.x;this._pivot.y=this._originPivot.y+t.pivot.y;this._transform.copy(t.transform);this._bone.invalidUpdate()};p.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;i-=Math.floor(i/this._totalTime)*this._totalTime;if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{i-=Math.floor(i/this._totalTime)*this._totalTime}}if(this._currentTime!=i){this._lastTime=this._currentTime;this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var h=0,l=this._timelineData.frameList.length;h<l;++h){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];if(o){this._bone.arriveAtFrame(o,this._animationState)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this._bone.arriveAtFrame(s,this._animationState);this.updateToNextFrame(e)}if(this._tweenTransform){this.updateTween()}}};p.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var a=false;if(i==0&&(this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;a=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.animationData.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){a=false}else{if(this._tweenEasing==10){this._tweenEasing=0}a=true}}else{a=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;a=false}else{a=true}}if(a){this._durationTransform.x=r.transform.x-n.transform.x;this._durationTransform.y=r.transform.y-n.transform.y;this._durationTransform.skewX=r.transform.skewX-n.transform.skewX;this._durationTransform.skewY=r.transform.skewY-n.transform.skewY;this._durationTransform.scaleX=r.transform.scaleX-n.transform.scaleX+r.scaleOffset.x;this._durationTransform.scaleY=r.transform.scaleY-n.transform.scaleY+r.scaleOffset.y;this._durationPivot.x=r.pivot.x-n.pivot.x;this._durationPivot.y=r.pivot.y-n.pivot.y;this._durationTransform.normalizeRotation();if(i==0){this._durationTransform.skewX=t.TransformUtil.formatRadian(this._durationTransform.skewX);this._durationTransform.skewY=t.TransformUtil.formatRadian(this._durationTransform.skewY)}if(this._durationTransform.x||this._durationTransform.y||this._durationTransform.skewX||this._durationTransform.skewY||this._durationTransform.scaleX!=1||this._durationTransform.scaleY!=1||this._durationPivot.x||this._durationPivot.y){this._tweenTransform=true}else{this._tweenTransform=false}}else{this._tweenTransform=false}if(!this._tweenTransform){this._transform.copy(n.transform);this._pivot.x=this._originPivot.x+n.pivot.x;this._pivot.y=this._originPivot.y+n.pivot.y;this._bone.invalidUpdate()}};p.updateTween=function(){var e=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve){e=this._tweenCurve.getValueByProgress(e)}else if(this._tweenEasing){e=t.MathUtil.getEaseValue(e,this._tweenEasing)}var i=this._timelineData.frameList[this._currentFrameIndex];var n=i.transform;var r=i.pivot;this._transform.x=n.x+this._durationTransform.x*e;this._transform.y=n.y+this._durationTransform.y*e;this._transform.skewX=n.skewX+this._durationTransform.skewX*e;this._transform.skewY=n.skewY+this._durationTransform.skewY*e;this._transform.scaleX=n.scaleX+this._durationTransform.scaleX*e;this._transform.scaleY=n.scaleY+this._durationTransform.scaleY*e;this._pivot.x=r.x+this._durationPivot.x*e;this._pivot.y=r.y+this._durationPivot.y*e;this._bone.invalidUpdate()};e._pool=[];return e}();t.FastBoneTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._durationColor=new t.ColorTransform}var i=__define,n=e;p=n.prototype;e.borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e.returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e.clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};p.clear=function(){this._slot=null;this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null};p.fadeIn=function(t,e,i){this._slot=t;this._armature=this._slot.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this.name=i.name;this._totalTime=this._timelineData.duration;this._isComplete=false;this._blendEnabled=false;this._tweenColor=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}};p.updateFade=function(t){};p.update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};p.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;i-=Math.floor(i/this._totalTime)*this._totalTime;if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{i-=Math.floor(i/this._totalTime)*this._totalTime}}if(this._currentTime!=i){this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var h=0,l=this._timelineData.frameList.length;h<l;++h){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration){this._currentFrameIndex++;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];if(o){this._slot._arriveAtFrame(o,this._animationState)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this._slot._arriveAtFrame(s,this._animationState);this._blendEnabled=s.displayIndex>=0;if(this._blendEnabled){this.updateToNextFrame(e)}else{this._tweenEasing=NaN;this._tweenColor=false}}if(this._blendEnabled){this.updateTween()}}};p.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var a=false;if(i==0&&(this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;a=false}else if(n.displayIndex<0||r.displayIndex<0){this._tweenEasing=NaN;a=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.animationData.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){a=false}else{if(this._tweenEasing==10){this._tweenEasing=0}a=true}}else{a=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;a=false}else{a=true}}if(a){if(n.color||r.color){t.ColorTransformUtil.minus(r.color||t.ColorTransformUtil.originalColor,n.color||t.ColorTransformUtil.originalColor,this._durationColor);this._tweenColor=this._durationColor.alphaOffset!=0||this._durationColor.redOffset!=0||this._durationColor.greenOffset!=0||this._durationColor.blueOffset!=0||this._durationColor.alphaMultiplier!=0||this._durationColor.redMultiplier!=0||this._durationColor.greenMultiplier!=0||this._durationColor.blueMultiplier!=0}else{this._tweenColor=false}}else{this._tweenColor=false}if(!this._tweenColor){var o;var s;if(n.color){o=n.color;s=true}else{o=t.ColorTransformUtil.originalColor;s=false}if(this._slot._isColorChanged||s){if(!t.ColorTransformUtil.isEqual(this._slot._colorTransform,o)){this._slot._updateDisplayColor(o.alphaOffset,o.redOffset,o.greenOffset,o.blueOffset,o.alphaMultiplier,o.redMultiplier,o.greenMultiplier,o.blueMultiplier,s)}}}};p.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenColor){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}if(e.color){this._slot._updateDisplayColor(e.color.alphaOffset+this._durationColor.alphaOffset*i,e.color.redOffset+this._durationColor.redOffset*i,e.color.greenOffset+this._durationColor.greenOffset*i,e.color.blueOffset+this._durationColor.blueOffset*i,e.color.alphaMultiplier+this._durationColor.alphaMultiplier*i,e.color.redMultiplier+this._durationColor.redMultiplier*i,e.color.greenMultiplier+this._durationColor.greenMultiplier*i,e.color.blueMultiplier+this._durationColor.blueMultiplier*i,true)}else{this._slot._updateDisplayColor(this._durationColor.alphaOffset*i,this._durationColor.redOffset*i,this._durationColor.greenOffset*i,this._durationColor.blueOffset*i,this._durationColor.alphaMultiplier*i+1,this._durationColor.redMultiplier*i+1,this._durationColor.greenMultiplier*i+1,this._durationColor.blueMultiplier*i+1,true)}}};p.updateSingleFrame=function(){var e=this._timelineData.frameList[0];this._slot._arriveAtFrame(e,this._animationState);this._isComplete=true;this._tweenEasing=NaN;this._tweenColor=false;this._blendEnabled=e.displayIndex>=0;if(this._blendEnabled){var i;var n;if(e.color){i=e.color;n=true}else{i=t.ColorTransformUtil.originalColor;n=false}if(this._slot._isColorChanged||n){if(!t.ColorTransformUtil.isEqual(this._slot._colorTransform,i)){this._slot._updateDisplayColor(i.alphaOffset,i.redOffset,i.greenOffset,i.blueOffset,i.alphaMultiplier,i.redMultiplier,i.greenMultiplier,i.blueMultiplier,n)}}}};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.FastSlotTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e){if(t===void 0){t=0}if(e===void 0){e=0}this.x=t;this.y=e}var e=__define,i=t;p=i.prototype;p.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"};return t}();t.Point=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i,n){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=0}this.x=t;this.y=e;this.width=i;this.height=n}var e=__define,i=t;p=i.prototype;return t}();t.Rectangle=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.duration=0;this._frameList=[];this.duration=0;this.scale=1}var e=__define,i=t;p=i.prototype;p.dispose=function(){var t=this._frameList.length;while(t--){this._frameList[t].dispose()}this._frameList=null};p.addFrame=function(t){if(!t){throw new Error}if(this._frameList.indexOf(t)<0){this._frameList[this._frameList.length]=t}else{throw new Error}};e(p,"frameList",function(){return this._frameList});return t}();t.Timeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.frameRate=0;this.playTimes=0;this.lastFrameDuration=0;this.fadeTime=0;this.playTimes=0;this.autoTween=true;this.tweenEasing=NaN;this.hideTimelineNameMap=[];this.hideSlotTimelineNameMap=[];this._timelineList=[];this._slotTimelineList=[]}var i=__define,n=e;p=n.prototype;i(p,"timelineList",function(){return this._timelineList});i(p,"slotTimelineList",function(){return this._slotTimelineList});p.dispose=function(){t.prototype.dispose.call(this);this.hideTimelineNameMap=null;var e=0;var i=0;for(e=0,i=this._timelineList.length;e<i;e++){var n=this._timelineList[e];n.dispose()}this._timelineList=null;for(e=0,i=this._slotTimelineList.length;e<i;e++){var r=this._slotTimelineList[e];r.dispose()}this._slotTimelineList=null};p.getTimeline=function(t){var e=this._timelineList.length;while(e--){if(this._timelineList[e].name==t){return this._timelineList[e]}}return null};p.addTimeline=function(t){if(!t){throw new Error}if(this._timelineList.indexOf(t)<0){this._timelineList[this._timelineList.length]=t}};p.getSlotTimeline=function(t){var e=this._slotTimelineList.length;while(e--){if(this._slotTimelineList[e].name==t){return this._slotTimelineList[e]}}return null};p.addSlotTimeline=function(t){if(!t){throw new Error}if(this._slotTimelineList.indexOf(t)<0){this._slotTimelineList[this._slotTimelineList.length]=t}};return e}(t.Timeline);t.AnimationData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._boneDataList=[];this._skinDataList=[];this._slotDataList=[];this._animationDataList=[]}var e=__define,i=t;p=i.prototype;t.sortBoneDataHelpArray=function(t,e){return t[0]>e[0]?1:-1};t.sortBoneDataHelpArrayDescending=function(t,e){return t[0]>e[0]?-1:1};p.setSkinData=function(t){var e=0;var i=this._slotDataList.length;for(e=0;e<i;e++){this._slotDataList[e].dispose()}var n;if(!t&&this._skinDataList.length>0){n=this._skinDataList[0]}else{e=0,i=this._skinDataList.length;for(;e<i;e++){if(this._skinDataList[e].name==t){n=this._skinDataList[e];break}}}if(n){var r;e=0,i=n.slotDataList.length;for(e=0;e<i;e++){r=this.getSlotData(n.slotDataList[e].name);if(r){var a=0;var o=n.slotDataList[e].displayDataList.length;for(a=0;a<o;a++){r.addDisplayData(n.slotDataList[e].displayDataList[a])}}}}};p.dispose=function(){var t=this._boneDataList.length;while(t--){this._boneDataList[t].dispose()}t=this._skinDataList.length;while(t--){this._skinDataList[t].dispose()}t=this._slotDataList.length;while(t--){this._slotDataList[t].dispose()}t=this._animationDataList.length;while(t--){this._animationDataList[t].dispose()}this._boneDataList=null;this._slotDataList=null;this._skinDataList=null;this._animationDataList=null};p.getBoneData=function(t){var e=this._boneDataList.length;while(e--){if(this._boneDataList[e].name==t){return this._boneDataList[e]}}return null};p.getSlotData=function(t){var e=this._slotDataList.length;while(e--){if(this._slotDataList[e].name==t){return this._slotDataList[e]}}return null};p.getSkinData=function(t){if(!t&&this._skinDataList.length>0){return this._skinDataList[0]}var e=this._skinDataList.length;while(e--){if(this._skinDataList[e].name==t){return this._skinDataList[e]}}return null};p.getAnimationData=function(t){var e=this._animationDataList.length;while(e--){if(this._animationDataList[e].name==t){return this._animationDataList[e]}}return null};p.addBoneData=function(t){if(!t){throw new Error}if(this._boneDataList.indexOf(t)<0){this._boneDataList[this._boneDataList.length]=t}else{throw new Error}};p.addSlotData=function(t){if(!t){throw new Error}if(this._slotDataList.indexOf(t)<0){this._slotDataList[this._slotDataList.length]=t}else{throw new Error}};p.addSkinData=function(t){if(!t){throw new Error}if(this._skinDataList.indexOf(t)<0){this._skinDataList[this._skinDataList.length]=t}else{throw new Error}};p.addAnimationData=function(t){if(!t){throw new Error}if(this._animationDataList.indexOf(t)<0){this._animationDataList[this._animationDataList.length]=t}};p.sortBoneDataList=function(){var e=this._boneDataList.length;if(e==0){return}var i=[];while(e--){var n=this._boneDataList[e];var r=0;var a=n;while(a){r++;a=this.getBoneData(a.parent)}i[e]=[r,n]}i.sort(t.sortBoneDataHelpArray);e=i.length;while(e--){this._boneDataList[e]=i[e][1]}};e(p,"boneDataList",function(){return this._boneDataList});e(p,"slotDataList",function(){return this._slotDataList});e(p,"skinDataList",function(){return this._skinDataList});e(p,"animationDataList",function(){return this._animationDataList});return t}();t.ArmatureData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.length=0;this.global=new t.DBTransform;this.transform=new t.DBTransform;this.inheritRotation=true;this.inheritScale=false}var i=__define,n=e;p=n.prototype;p.dispose=function(){this.global=null;this.transform=null};return e}();t.BoneData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.alphaMultiplier=1;this.alphaOffset=0;this.blueMultiplier=1;this.blueOffset=0;this.greenMultiplier=1;this.greenOffset=0;this.redMultiplier=1;this.redOffset=0}var e=__define,i=t;p=i.prototype;return t}();t.ColorTransform=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._dataChanged=false;
this._pointList=[];this.sampling=new Array(e.SamplingTimes);for(var i=0;i<e.SamplingTimes-1;i++){this.sampling[i]=new t.Point}}var i=__define,n=e;p=n.prototype;p.getValueByProgress=function(t){if(this._dataChanged){this.refreshSampling()}for(var i=0;i<e.SamplingTimes-1;i++){var n=this.sampling[i];if(n.x>=t){if(i==0){return n.y*t/n.x}else{var r=this.sampling[i-1];return r.y+(n.y-r.y)*(t-r.x)/(n.x-r.x)}}}return n.y+(1-n.y)*(t-n.x)/(1-n.x)};p.refreshSampling=function(){for(var t=0;t<e.SamplingTimes-1;t++){this.bezierCurve(e.SamplingStep*(t+1),this.sampling[t])}this._dataChanged=false};p.bezierCurve=function(t,e){var i=1-t;e.x=3*this.point1.x*t*i*i+3*this.point2.x*t*t*i+Math.pow(t,3);e.y=3*this.point1.y*t*i*i+3*this.point2.y*t*t*i+Math.pow(t,3)};i(p,"pointList",function(){return this._pointList},function(t){this._pointList=t;this._dataChanged=true});p.isCurve=function(){return this.point1.x!=0||this.point1.y!=0||this.point2.x!=1||this.point2.y!=1};i(p,"point1",function(){return this.pointList[0]});i(p,"point2",function(){return this.pointList[1]});e.SamplingTimes=20;e.SamplingStep=.05;return e}();t.CurveData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.transform=new t.DBTransform;this.pivot=new t.Point}var i=__define,n=e;p=n.prototype;p.dispose=function(){this.transform=null;this.pivot=null};e.ARMATURE="armature";e.IMAGE="image";return e}();t.DisplayData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._armatureDataList=[];this._displayDataDictionary={}}var e=__define,i=t;p=i.prototype;p.dispose=function(){for(var t=0,e=this._armatureDataList.length;t<e;t++){var i=this._armatureDataList[t];i.dispose()}this._armatureDataList=null;this.removeAllDisplayData();this._displayDataDictionary=null};e(p,"armatureDataList",function(){return this._armatureDataList});p.getArmatureDataByName=function(t){var e=this._armatureDataList.length;while(e--){if(this._armatureDataList[e].name==t){return this._armatureDataList[e]}}return null};p.addArmatureData=function(t){if(!t){throw new Error}if(this._armatureDataList.indexOf(t)<0){this._armatureDataList[this._armatureDataList.length]=t}else{throw new Error}};p.removeArmatureData=function(t){var e=this._armatureDataList.indexOf(t);if(e>=0){this._armatureDataList.splice(e,1)}};p.removeArmatureDataByName=function(t){var e=this._armatureDataList.length;while(e--){if(this._armatureDataList[e].name==t){this._armatureDataList.splice(e,1)}}};p.getDisplayDataByName=function(t){return this._displayDataDictionary[t]};p.addDisplayData=function(t){this._displayDataDictionary[t.name]=t};p.removeDisplayDataByName=function(t){delete this._displayDataDictionary[t]};p.removeAllDisplayData=function(){for(var t in this._displayDataDictionary){delete this._displayDataDictionary[t]}};return t}();t.DragonBonesData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.position=0;this.duration=0;this.position=0;this.duration=0}var e=__define,i=t;p=i.prototype;p.dispose=function(){};return t}();t.Frame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._slotDataList=[]}var e=__define,i=t;p=i.prototype;p.dispose=function(){var t=this._slotDataList.length;while(t--){this._slotDataList[t].dispose()}this._slotDataList=null};p.getSlotData=function(t){var e=this._slotDataList.length;while(e--){if(this._slotDataList[e].name==t){return this._slotDataList[e]}}return null};p.addSlotData=function(t){if(!t){throw new Error}if(this._slotDataList.indexOf(t)<0){this._slotDataList[this._slotDataList.length]=t}else{throw new Error}};e(p,"slotDataList",function(){return this._slotDataList});return t}();t.SkinData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._displayDataList=[];this.zOrder=0}var e=__define,i=t;p=i.prototype;p.dispose=function(){this._displayDataList.length=0};p.addDisplayData=function(t){if(!t){throw new Error}if(this._displayDataList.indexOf(t)<0){this._displayDataList[this._displayDataList.length]=t}else{throw new Error}};p.getDisplayData=function(t){var e=this._displayDataList.length;while(e--){if(this._displayDataList[e].name==t){return this._displayDataList[e]}}return null};e(p,"displayDataList",function(){return this._displayDataList});return t}();t.SlotData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.displayIndex=0;this.tweenEasing=10;this.displayIndex=0;this.visible=true;this.zOrder=NaN}var i=__define,n=e;p=n.prototype;p.dispose=function(){t.prototype.dispose.call(this);this.color=null};return e}(t.Frame);t.SlotFrame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.offset=0}var i=__define,n=e;p=n.prototype;p.dispose=function(){t.prototype.dispose.call(this)};return e}(t.Timeline);t.SlotTimeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.tweenRotate=0;this.displayIndex=0;this.tweenEasing=10;this.tweenRotate=0;this.tweenScale=true;this.displayIndex=0;this.visible=true;this.zOrder=NaN;this.global=new t.DBTransform;this.transform=new t.DBTransform;this.pivot=new t.Point;this.scaleOffset=new t.Point}var n=__define,r=i;p=r.prototype;p.dispose=function(){e.prototype.dispose.call(this);this.global=null;this.transform=null;this.pivot=null;this.scaleOffset=null;this.color=null};return i}(t.Frame);t.TransformFrame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.originTransform=new t.DBTransform;this.originTransform.scaleX=1;this.originTransform.scaleY=1;this.originPivot=new t.Point;this.offset=0}var n=__define,r=i;p=r.prototype;p.dispose=function(){e.prototype.dispose.call(this);this.originTransform=null;this.originPivot=null};return i}(t.Timeline);t.TransformTimeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.parseDragonBonesData=function(i){if(!i){throw new Error}var n=i[t.ConstValues.A_VERSION];n=n.toString();if(n.toString()!=t.DragonBones.DATA_VERSION&&n.toString()!=t.DragonBones.PARENT_COORDINATE_DATA_VERSION&&n.toString()!="2.3"){throw new Error("Nonsupport version!")}var r=e.getNumber(i,t.ConstValues.A_FRAME_RATE,0)||0;var a=new t.DragonBonesData;a.name=i[t.ConstValues.A_NAME];a.isGlobal=i[t.ConstValues.A_IS_GLOBAL]=="0"?false:true;e.tempDragonBonesData=a;var o=i[t.ConstValues.ARMATURE];for(var s in o){var h=i[t.ConstValues.ARMATURE][s];a.addArmatureData(e.parseArmatureData(h,r))}e.tempDragonBonesData=null;return a};e.parseArmatureData=function(i,n){var r=new t.ArmatureData;r.name=i[t.ConstValues.A_NAME];var a=i[t.ConstValues.BONE];for(var o in a){var s=a[o];r.addBoneData(e.parseBoneData(s))}var h=i[t.ConstValues.SKIN];for(var l in h){var u=h[l];var c=u[t.ConstValues.SLOT];for(var p in c){var f=c[p];r.addSlotData(e.parseSlotData(f))}}for(var o in h){var m=h[o];r.addSkinData(e.parseSkinData(m))}if(e.tempDragonBonesData.isGlobal){t.DBDataUtil.transformArmatureData(r)}r.sortBoneDataList();var d=i[t.ConstValues.ANIMATION];for(var o in d){var g=d[o];var y=e.parseAnimationData(g,n);t.DBDataUtil.addHideTimeline(y,r);t.DBDataUtil.transformAnimationData(y,r,e.tempDragonBonesData.isGlobal);r.addAnimationData(y)}return r};e.parseBoneData=function(i){var n=new t.BoneData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.length=Number(i[t.ConstValues.A_LENGTH])||0;n.inheritRotation=e.getBoolean(i,t.ConstValues.A_INHERIT_ROTATION,true);n.inheritScale=e.getBoolean(i,t.ConstValues.A_INHERIT_SCALE,true);e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform);if(e.tempDragonBonesData.isGlobal){n.global.copy(n.transform)}return n};e.parseSkinData=function(i){var n=new t.SkinData;n.name=i[t.ConstValues.A_NAME];var r=i[t.ConstValues.SLOT];for(var a in r){var o=r[a];n.addSlotData(e.parseSkinSlotData(o))}return n};e.parseSkinSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=i[t.ConstValues.A_Z_ORDER];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.blendMode=i[t.ConstValues.A_BLENDMODE];var r=i[t.ConstValues.DISPLAY];for(var a in r){var o=r[a];n.addDisplayData(e.parseDisplayData(o))}return n};e.parseSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=i[t.ConstValues.A_Z_ORDER];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.blendMode=i[t.ConstValues.A_BLENDMODE];n.displayIndex=0;return n};e.parseDisplayData=function(i){var n=new t.DisplayData;n.name=i[t.ConstValues.A_NAME];n.type=i[t.ConstValues.A_TYPE];e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform,n.pivot);if(e.tempDragonBonesData!=null){e.tempDragonBonesData.addDisplayData(n)}return n};e.parseAnimationData=function(i,n){var r=new t.AnimationData;r.name=i[t.ConstValues.A_NAME];r.frameRate=n;r.duration=Math.round((e.getNumber(i,t.ConstValues.A_DURATION,1)||1)*1e3/n);r.playTimes=e.getNumber(i,t.ConstValues.A_LOOP,1);r.playTimes=r.playTimes!=NaN?r.playTimes:1;r.fadeTime=e.getNumber(i,t.ConstValues.A_FADE_IN_TIME,0)||0;r.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,NaN);r.autoTween=e.getBoolean(i,t.ConstValues.A_AUTO_TWEEN,true);var a=i[t.ConstValues.FRAME];var o=0;var s=0;if(a){for(o=0,s=a.length;o<s;o++){var h=a[o];var l=e.parseTransformFrame(h,n);r.addFrame(l)}}e.parseTimeline(i,r);var u=r.duration;var c=[];var p=[];var f=i[t.ConstValues.TIMELINE];var m;if(f){for(o=0,s=f.length;o<s;o++){var d=f[o];var g=e.parseTransformTimeline(d,r.duration,n);g=e.parseTransformTimeline(d,r.duration,n);u=Math.min(u,g.frameList[g.frameList.length-1].duration);r.addTimeline(g);var y=e.parseSlotTimeline(d,r.duration,n);r.addSlotTimeline(y);if(r.autoTween&&!m){var v;for(var _=0,I=y.frameList.length;_<I;_++){v=y.frameList[_];if(v&&v.displayIndex<0){m=true;break}}}}var w=r.tweenEasing;if(m){s=r.slotTimelineList.length;for(o=0;o<s;o++){y=r.slotTimelineList[o];g=r.timelineList[o];var x;var S;var C;for(_=0,I=y.frameList.length;_<I;_++){S=y.frameList[_];x=g.frameList[_];C=_==I-1?y.frameList[0]:y.frameList[_+1];if(S.displayIndex<0||C.displayIndex<0){x.tweenEasing=S.tweenEasing=NaN}else if(w==10){x.tweenEasing=S.tweenEasing=0}else if(!isNaN(w)){x.tweenEasing=S.tweenEasing=w}else if(x.tweenEasing==10){x.tweenEasing=0}}}r.autoTween=false}}if(r.frameList.length>0){u=Math.min(u,r.frameList[r.frameList.length-1].duration)}r.lastFrameDuration=u;return r};e.parseSlotTimeline=function(i,n,r){var a=new t.SlotTimeline;a.name=i[t.ConstValues.A_NAME];a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.duration=n;var o=i[t.ConstValues.FRAME];for(var s in o){var h=o[s];var l=e.parseSlotFrame(h,r);a.addFrame(l)}e.parseTimeline(i,a);return a};e.parseSlotFrame=function(i,n){var r=new t.SlotFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);r.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,e.tempDragonBonesData.isGlobal?NaN:0);var a=i[t.ConstValues.COLOR_TRANSFORM];if(a){r.color=new t.ColorTransform;e.parseColorTransform(a,r.color)}return r};e.parseTransformTimeline=function(i,n,r){var a=new t.TransformTimeline;a.name=i[t.ConstValues.A_NAME];a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.originPivot.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;a.originPivot.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0;a.duration=n;var o=i[t.ConstValues.FRAME];for(var s in o){var h=o[s];var l=e.parseTransformFrame(h,r);a.addFrame(l)}e.parseTimeline(i,a);return a};e.parseTransformFrame=function(i,n){var r=new t.TransformFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.tweenRotate=Math.floor(e.getNumber(i,t.ConstValues.A_TWEEN_ROTATE,0)||0);r.tweenScale=e.getBoolean(i,t.ConstValues.A_TWEEN_SCALE,true);e.parseTransform(i[t.ConstValues.TRANSFORM],r.transform,r.pivot);if(e.tempDragonBonesData.isGlobal){r.global.copy(r.transform)}r.scaleOffset.x=e.getNumber(i,t.ConstValues.A_SCALE_X_OFFSET,0)||0;r.scaleOffset.y=e.getNumber(i,t.ConstValues.A_SCALE_Y_OFFSET,0)||0;return r};e.parseTimeline=function(t,e){var i=0;var n;var r=e.frameList;for(var a in r){n=r[a];n.position=i;i+=n.duration}if(n){n.duration=e.duration-n.position}};e.parseFrame=function(e,i,n){if(n===void 0){n=0}i.duration=Math.round((e[t.ConstValues.A_DURATION]||1)*1e3/n);i.action=e[t.ConstValues.A_ACTION];i.event=e[t.ConstValues.A_EVENT];i.sound=e[t.ConstValues.A_SOUND]};e.parseTransform=function(i,n,r){if(r===void 0){r=null}if(i){if(n){n.x=e.getNumber(i,t.ConstValues.A_X,0)||0;n.y=e.getNumber(i,t.ConstValues.A_Y,0)||0;n.skewX=e.getNumber(i,t.ConstValues.A_SKEW_X,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.skewY=e.getNumber(i,t.ConstValues.A_SKEW_Y,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.scaleX=e.getNumber(i,t.ConstValues.A_SCALE_X,1)||0;n.scaleY=e.getNumber(i,t.ConstValues.A_SCALE_Y,1)||0}if(r){r.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;r.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0}}};e.parseColorTransform=function(i,n){if(i){if(n){n.alphaOffset=e.getNumber(i,t.ConstValues.A_ALPHA_OFFSET,0);n.redOffset=e.getNumber(i,t.ConstValues.A_RED_OFFSET,0);n.greenOffset=e.getNumber(i,t.ConstValues.A_GREEN_OFFSET,0);n.blueOffset=e.getNumber(i,t.ConstValues.A_BLUE_OFFSET,0);n.alphaMultiplier=e.getNumber(i,t.ConstValues.A_ALPHA_MULTIPLIER,100)*.01;n.redMultiplier=e.getNumber(i,t.ConstValues.A_RED_MULTIPLIER,100)*.01;n.greenMultiplier=e.getNumber(i,t.ConstValues.A_GREEN_MULTIPLIER,100)*.01;n.blueMultiplier=e.getNumber(i,t.ConstValues.A_BLUE_MULTIPLIER,100)*.01}}};e.getBoolean=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"0":case"NaN":case"":case"false":case"null":case"undefined":return false;case"1":case"true":default:return true}}return i};e.getNumber=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"NaN":case"":case"false":case"null":case"undefined":return NaN;default:return Number(t[e])}}return i};return e}();t.Data3Parser=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.parseTextureAtlasData=function(i,n){if(n===void 0){n=1}var r={};var a;var o=i[t.ConstValues.SUB_TEXTURE];for(var s in o){var h=o[s];var l=h[t.ConstValues.A_NAME];var u=new t.Rectangle;u.x=e.getNumber(h,t.ConstValues.A_X,0)/n;u.y=e.getNumber(h,t.ConstValues.A_Y,0)/n;u.width=e.getNumber(h,t.ConstValues.A_WIDTH,0)/n;u.height=e.getNumber(h,t.ConstValues.A_HEIGHT,0)/n;var c=h[t.ConstValues.A_ROTATED]=="true";var p=e.getNumber(h,t.ConstValues.A_FRAME_WIDTH,0)/n;var f=e.getNumber(h,t.ConstValues.A_FRAME_HEIGHT,0)/n;if(p>0&&f>0){a=new t.Rectangle;a.x=e.getNumber(h,t.ConstValues.A_FRAME_X,0)/n;a.y=e.getNumber(h,t.ConstValues.A_FRAME_Y,0)/n;a.width=p;a.height=f}else{a=null}r[l]=new t.TextureData(u,a,c)}return r};e.parseDragonBonesData=function(i){if(!i){throw new Error}var n=i[t.ConstValues.A_VERSION];n=n.toString();if(n.toString()!=t.DragonBones.DATA_VERSION&&n.toString()!=t.DragonBones.PARENT_COORDINATE_DATA_VERSION&&n.toString()!="2.3"){throw new Error(egret.getString(4003))}else if(n.toString()==t.DragonBones.PARENT_COORDINATE_DATA_VERSION||n.toString()=="2.3"){return t.Data3Parser.parseDragonBonesData(i)}var r=e.getNumber(i,t.ConstValues.A_FRAME_RATE,0)||0;var a=new t.DragonBonesData;a.name=i[t.ConstValues.A_NAME];a.isGlobal=i[t.ConstValues.A_IS_GLOBAL]=="0"?false:true;e.tempDragonBonesData=a;var o=i[t.ConstValues.ARMATURE];for(var s in o){var h=i[t.ConstValues.ARMATURE][s];a.addArmatureData(e.parseArmatureData(h,r))}e.tempDragonBonesData=null;return a};e.parseArmatureData=function(i,n){var r=new t.ArmatureData;r.name=i[t.ConstValues.A_NAME];var a=i[t.ConstValues.BONE];for(var o in a){var s=a[o];r.addBoneData(e.parseBoneData(s))}var h=i[t.ConstValues.SLOT];for(var o in h){var l=h[o];r.addSlotData(e.parseSlotData(l))}var u=i[t.ConstValues.SKIN];for(var o in u){var c=u[o];r.addSkinData(e.parseSkinData(c))}if(e.tempDragonBonesData.isGlobal){t.DBDataUtil.transformArmatureData(r)}r.sortBoneDataList();var p=i[t.ConstValues.ANIMATION];for(var o in p){var f=p[o];var m=e.parseAnimationData(f,n);t.DBDataUtil.addHideTimeline(m,r,true);t.DBDataUtil.transformAnimationData(m,r,e.tempDragonBonesData.isGlobal);r.addAnimationData(m)}return r};e.parseBoneData=function(i){var n=new t.BoneData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.length=Number(i[t.ConstValues.A_LENGTH])||0;n.inheritRotation=e.getBoolean(i,t.ConstValues.A_INHERIT_ROTATION,true);n.inheritScale=e.getBoolean(i,t.ConstValues.A_INHERIT_SCALE,true);e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform);if(e.tempDragonBonesData.isGlobal){n.global.copy(n.transform)}return n};e.parseSkinData=function(i){var n=new t.SkinData;n.name=i[t.ConstValues.A_NAME];var r=i[t.ConstValues.SLOT];for(var a in r){var o=r[a];n.addSlotData(e.parseSlotDisplayData(o))}return n};e.parseSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.displayIndex=e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0);n.blendMode=i[t.ConstValues.A_BLENDMODE];return n};e.parseSlotDisplayData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;var r=i[t.ConstValues.DISPLAY];for(var a in r){var o=r[a];n.addDisplayData(e.parseDisplayData(o))}return n};e.parseDisplayData=function(i){var n=new t.DisplayData;n.name=i[t.ConstValues.A_NAME];n.type=i[t.ConstValues.A_TYPE];e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform,n.pivot);n.pivot.x=NaN;n.pivot.y=NaN;if(e.tempDragonBonesData!=null){e.tempDragonBonesData.addDisplayData(n)}return n};e.parseAnimationData=function(i,n){var r=new t.AnimationData;r.name=i[t.ConstValues.A_NAME];r.frameRate=n;r.duration=Math.round((e.getNumber(i,t.ConstValues.A_DURATION,1)||1)*1e3/n);r.playTimes=e.getNumber(i,t.ConstValues.A_PLAY_TIMES,1);r.playTimes=r.playTimes!=NaN?r.playTimes:1;r.fadeTime=e.getNumber(i,t.ConstValues.A_FADE_IN_TIME,0)||0;r.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,NaN);r.autoTween=e.getBoolean(i,t.ConstValues.A_AUTO_TWEEN,true);var a=i[t.ConstValues.FRAME];var o=0;var s=0;if(a){for(o=0,s=a.length;o<s;o++){var h=a[o];var l=e.parseTransformFrame(h,n);r.addFrame(l)}}e.parseTimeline(i,r);var u=r.duration;var c=i[t.ConstValues.BONE];if(c){for(o=0,s=c.length;o<s;o++){var p=c[o];if(p){var f=e.parseTransformTimeline(p,r.duration,n);if(f.frameList.length>0){u=Math.min(u,f.frameList[f.frameList.length-1].duration)}r.addTimeline(f)}}}var m=i[t.ConstValues.SLOT];if(m){for(o=0,s=m.length;o<s;o++){var d=m[o];if(d){var g=e.parseSlotTimeline(d,r.duration,n);if(g.frameList.length>0){u=Math.min(u,g.frameList[g.frameList.length-1].duration);r.addSlotTimeline(g)}}}}if(r.frameList.length>0){u=Math.min(u,r.frameList[r.frameList.length-1].duration)}r.lastFrameDuration=u;return r};e.parseTransformTimeline=function(i,n,r){var a=new t.TransformTimeline;a.name=i[t.ConstValues.A_NAME];a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.originPivot.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;a.originPivot.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0;a.duration=n;var o=i[t.ConstValues.FRAME];for(var s in o){var h=o[s];var l=e.parseTransformFrame(h,r);a.addFrame(l)}e.parseTimeline(i,a);return a};e.parseSlotTimeline=function(i,n,r){var a=new t.SlotTimeline;a.name=i[t.ConstValues.A_NAME];a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.duration=n;var o=i[t.ConstValues.FRAME];for(var s in o){var h=o[s];var l=e.parseSlotFrame(h,r);a.addFrame(l)}e.parseTimeline(i,a);return a};e.parseTransformFrame=function(i,n){var r=new t.TransformFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.tweenRotate=Math.floor(e.getNumber(i,t.ConstValues.A_TWEEN_ROTATE,0)||0);r.tweenScale=e.getBoolean(i,t.ConstValues.A_TWEEN_SCALE,true);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);e.parseTransform(i[t.ConstValues.TRANSFORM],r.transform,r.pivot);if(e.tempDragonBonesData.isGlobal){r.global.copy(r.transform)}r.scaleOffset.x=e.getNumber(i,t.ConstValues.A_SCALE_X_OFFSET,0)||0;r.scaleOffset.y=e.getNumber(i,t.ConstValues.A_SCALE_Y_OFFSET,0)||0;return r};e.parseSlotFrame=function(i,n){var r=new t.SlotFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);r.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,e.tempDragonBonesData.isGlobal?NaN:0);var a=i[t.ConstValues.COLOR];if(a){r.color=new t.ColorTransform;e.parseColorTransform(a,r.color)}return r};e.parseTimeline=function(t,e){var i=0;var n;var r=e.frameList;for(var a in r){n=r[a];n.position=i;i+=n.duration}if(n){n.duration=e.duration-n.position}};e.parseFrame=function(e,i,n){if(n===void 0){n=0}i.duration=Math.round((e[t.ConstValues.A_DURATION]||1)*1e3/n);i.action=e[t.ConstValues.A_ACTION];i.event=e[t.ConstValues.A_EVENT];i.sound=e[t.ConstValues.A_SOUND];var r=e[t.ConstValues.A_CURVE];if(r!=null&&r.length==4){i.curve=new t.CurveData;i.curve.pointList=[new t.Point(r[0],r[1]),new t.Point(r[2],r[3])]}};e.parseTransform=function(i,n,r){if(r===void 0){r=null}if(i){if(n){n.x=e.getNumber(i,t.ConstValues.A_X,0)||0;n.y=e.getNumber(i,t.ConstValues.A_Y,0)||0;n.skewX=e.getNumber(i,t.ConstValues.A_SKEW_X,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.skewY=e.getNumber(i,t.ConstValues.A_SKEW_Y,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.scaleX=e.getNumber(i,t.ConstValues.A_SCALE_X,1)||0;n.scaleY=e.getNumber(i,t.ConstValues.A_SCALE_Y,1)||0}if(r){r.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;r.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0}}};e.parseColorTransform=function(i,n){if(n){n.alphaOffset=e.getNumber(i,t.ConstValues.A_ALPHA_OFFSET,0);n.redOffset=e.getNumber(i,t.ConstValues.A_RED_OFFSET,0);n.greenOffset=e.getNumber(i,t.ConstValues.A_GREEN_OFFSET,0);n.blueOffset=e.getNumber(i,t.ConstValues.A_BLUE_OFFSET,0);n.alphaMultiplier=e.getNumber(i,t.ConstValues.A_ALPHA_MULTIPLIER,100)*.01;n.redMultiplier=e.getNumber(i,t.ConstValues.A_RED_MULTIPLIER,100)*.01;n.greenMultiplier=e.getNumber(i,t.ConstValues.A_GREEN_MULTIPLIER,100)*.01;n.blueMultiplier=e.getNumber(i,t.ConstValues.A_BLUE_MULTIPLIER,100)*.01}};e.getBoolean=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"0":case"NaN":case"":case"false":case"null":case"undefined":return false;case"1":case"true":default:return true}}return i};e.getNumber=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"NaN":case"":case"false":case"null":case"undefined":return NaN;default:return Number(t[e])}}return i};return e}();t.DataParser=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i){this.region=t;this.frame=e;this.rotated=i}var e=__define,i=t;p=i.prototype;return t}();t.TextureData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.cloneColor=function(e){var i=new t.ColorTransform;i.redMultiplier=e.redMultiplier;i.greenMultiplier=e.greenMultiplier;i.blueMultiplier=e.blueMultiplier;i.alphaMultiplier=e.alphaMultiplier;i.redOffset=e.redOffset;i.greenOffset=e.greenOffset;i.blueOffset=e.blueOffset;i.alphaOffset=e.alphaOffset;return i};e.isEqual=function(t,e){return t.alphaOffset==e.alphaOffset&&t.redOffset==e.redOffset&&t.greenOffset==e.greenOffset&&t.blueOffset==e.blueOffset&&t.alphaMultiplier==e.alphaMultiplier&&t.redMultiplier==e.redMultiplier&&t.greenMultiplier==e.greenMultiplier&&t.blueMultiplier==e.blueMultiplier};e.minus=function(t,e,i){i.alphaOffset=t.alphaOffset-e.alphaOffset;i.redOffset=t.redOffset-e.redOffset;i.greenOffset=t.greenOffset-e.greenOffset;i.blueOffset=t.blueOffset-e.blueOffset;i.alphaMultiplier=t.alphaMultiplier-e.alphaMultiplier;i.redMultiplier=t.redMultiplier-e.redMultiplier;i.greenMultiplier=t.greenMultiplier-e.greenMultiplier;i.blueMultiplier=t.blueMultiplier-e.blueMultiplier};e.originalColor=new t.ColorTransform;return e}();t.ColorTransformUtil=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t;p=i.prototype;t.ANGLE_TO_RADIAN=Math.PI/180;t.RADIAN_TO_ANGLE=180/Math.PI;t.DRAGON_BONES="dragonBones";t.ARMATURE="armature";t.SKIN="skin";t.BONE="bone";t.SLOT="slot";t.DISPLAY="display";t.ANIMATION="animation";t.TIMELINE="timeline";t.FRAME="frame";t.TRANSFORM="transform";t.COLOR_TRANSFORM="colorTransform";t.COLOR="color";t.RECTANGLE="rectangle";t.ELLIPSE="ellipse";t.TEXTURE_ATLAS="TextureAtlas";t.SUB_TEXTURE="SubTexture";t.A_ROTATED="rotated";t.A_FRAME_X="frameX";t.A_FRAME_Y="frameY";t.A_FRAME_WIDTH="frameWidth";t.A_FRAME_HEIGHT="frameHeight";t.A_VERSION="version";t.A_IMAGE_PATH="imagePath";t.A_FRAME_RATE="frameRate";t.A_NAME="name";t.A_IS_GLOBAL="isGlobal";t.A_PARENT="parent";t.A_LENGTH="length";t.A_TYPE="type";t.A_FADE_IN_TIME="fadeInTime";t.A_DURATION="duration";t.A_SCALE="scale";t.A_OFFSET="offset";t.A_LOOP="loop";t.A_PLAY_TIMES="playTimes";t.A_EVENT="event";t.A_EVENT_PARAMETERS="eventParameters";t.A_SOUND="sound";t.A_ACTION="action";t.A_HIDE="hide";t.A_AUTO_TWEEN="autoTween";t.A_TWEEN_EASING="tweenEasing";t.A_TWEEN_ROTATE="tweenRotate";t.A_TWEEN_SCALE="tweenScale";t.A_DISPLAY_INDEX="displayIndex";t.A_Z_ORDER="z";t.A_BLENDMODE="blendMode";t.A_WIDTH="width";t.A_HEIGHT="height";t.A_INHERIT_SCALE="inheritScale";t.A_INHERIT_ROTATION="inheritRotation";t.A_X="x";t.A_Y="y";t.A_SKEW_X="skX";t.A_SKEW_Y="skY";t.A_SCALE_X="scX";t.A_SCALE_Y="scY";t.A_PIVOT_X="pX";t.A_PIVOT_Y="pY";t.A_ALPHA_OFFSET="aO";t.A_RED_OFFSET="rO";t.A_GREEN_OFFSET="gO";t.A_BLUE_OFFSET="bO";t.A_ALPHA_MULTIPLIER="aM";t.A_RED_MULTIPLIER="rM";t.A_GREEN_MULTIPLIER="gM";t.A_BLUE_MULTIPLIER="bM";t.A_CURVE="curve";t.A_SCALE_X_OFFSET="scXOffset";t.A_SCALE_Y_OFFSET="scYOffset";t.A_SCALE_MODE="scaleMode";t.A_FIXED_ROTATION="fixedRotation";return t}();t.ConstValues=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.transformArmatureData=function(e){var i=e.boneDataList;var n=i.length;while(n--){var r=i[n];if(r.parent){var a=e.getBoneData(r.parent);if(a){r.transform.copy(r.global);t.TransformUtil.globalToLocal(r.transform,a.global)}}}};e.transformArmatureDataAnimations=function(t){var i=t.animationDataList;var n=i.length;while(n--){e.transformAnimationData(i[n],t,false)}};e.transformRelativeAnimationData=function(t,e){};e.transformAnimationData=function(i,n,r){if(!r){e.transformRelativeAnimationData(i,n);return}var a=n.getSkinData(null);var o=n.boneDataList;var s;if(a){s=a.slotDataList}for(var h=0;h<o.length;h++){var l=o[h];var u=i.getTimeline(l.name);var c=i.getSlotTimeline(l.name);if(!u&&!c){continue}var p=null;if(s){for(var f=0,m=s.length;f<m;f++){p=s[f];if(p.parent==l.name){break}}}var d=u.frameList;if(c){var g=c.frameList}var y=null;var v=null;var _=null;var I=d.length;for(var f=0;f<I;f++){var w=d[f];e.setFrameTransform(i,n,l,w);w.transform.x-=l.transform.x;w.transform.y-=l.transform.y;w.transform.skewX-=l.transform.skewX;w.transform.skewY-=l.transform.skewY;w.transform.scaleX/=l.transform.scaleX;w.transform.scaleY/=l.transform.scaleY;if(_){var x=w.transform.skewX-_.transform.skewX;if(_.tweenRotate){if(_.tweenRotate>0){if(x<0){w.transform.skewX+=Math.PI*2;w.transform.skewY+=Math.PI*2}if(_.tweenRotate>1){w.transform.skewX+=Math.PI*2*(_.tweenRotate-1);w.transform.skewY+=Math.PI*2*(_.tweenRotate-1)}}else{if(x>0){w.transform.skewX-=Math.PI*2;w.transform.skewY-=Math.PI*2}if(_.tweenRotate<1){w.transform.skewX+=Math.PI*2*(_.tweenRotate+1);w.transform.skewY+=Math.PI*2*(_.tweenRotate+1)}}}else{w.transform.skewX=_.transform.skewX+t.TransformUtil.formatRadian(w.transform.skewX-_.transform.skewX);w.transform.skewY=_.transform.skewY+t.TransformUtil.formatRadian(w.transform.skewY-_.transform.skewY)}}_=w}if(c&&g){I=g.length;for(var f=0;f<I;f++){var S=g[f];if(!c.transformed){if(p){S.zOrder-=p.zOrder}}}c.transformed=true}u.transformed=true}};e.setFrameTransform=function(i,n,r,a){a.transform.copy(a.global);var o=n.getBoneData(r.parent);if(o){var s=i.getTimeline(o.name);if(s){var h=[];var l=[];while(s){h.push(s);l.push(o);o=n.getBoneData(o.parent);if(o){s=i.getTimeline(o.name)}else{s=null}}var u=h.length;var c;var p=new t.Matrix;var f=new t.DBTransform;var m=new t.Matrix;while(u--){s=h[u];o=l[u];e.getTimelineTransform(s,a.position,f,!c);if(!c){c=new t.DBTransform;c.copy(f)}else{f.x+=s.originTransform.x+o.transform.x;f.y+=s.originTransform.y+o.transform.y;f.skewX+=s.originTransform.skewX+o.transform.skewX;f.skewY+=s.originTransform.skewY+o.transform.skewY;f.scaleX*=s.originTransform.scaleX*o.transform.scaleX;f.scaleY*=s.originTransform.scaleY*o.transform.scaleY;t.TransformUtil.transformToMatrix(f,m,true);m.concat(p);t.TransformUtil.matrixToTransform(m,c,f.scaleX*c.scaleX>=0,f.scaleY*c.scaleY>=0)}t.TransformUtil.transformToMatrix(c,p,true)}t.TransformUtil.globalToLocal(a.transform,c)}}};e.getTimelineTransform=function(e,i,n,r){var a=e.frameList;var o=a.length;while(o--){var s=a[o];if(s.position<=i&&s.position+s.duration>i){if(o==a.length-1||i==s.position){n.copy(r?s.global:s.transform)}else{var h=s.tweenEasing;var l=(i-s.position)/s.duration;if(h&&h!=10){l=t.MathUtil.getEaseValue(l,h)}var u=a[o+1];var c=r?s.global:s.transform;var p=r?u.global:u.transform;n.x=c.x+(p.x-c.x)*l;n.y=c.y+(p.y-c.y)*l;n.skewX=t.TransformUtil.formatRadian(c.skewX+(p.skewX-c.skewX)*l);n.skewY=t.TransformUtil.formatRadian(c.skewY+(p.skewY-c.skewY)*l);n.scaleX=c.scaleX+(p.scaleX-c.scaleX)*l;n.scaleY=c.scaleY+(p.scaleY-c.scaleY)*l}break}}};e.addHideTimeline=function(t,e,i){if(i===void 0){i=false}var n=e.boneDataList;var r=e.slotDataList;var a=n.length;while(a--){var o=n[a];var s=o.name;if(!t.getTimeline(s)){if(t.hideTimelineNameMap.indexOf(s)<0){t.hideTimelineNameMap.push(s)}}}if(i){a=r.length;var h;var l;while(a--){h=r[a];l=h.name;if(!t.getSlotTimeline(l)){if(t.hideSlotTimelineNameMap.indexOf(l)<0){t.hideSlotTimelineNameMap.push(l)}}}}};return e}();t.DBDataUtil=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t;p=i.prototype;t.getEaseValue=function(e,i){var n=1;if(i>1){n=.5*(1-t.cos(e*Math.PI));i-=1}else if(i>0){n=1-Math.pow(1-e,2)}else if(i<0){i*=-1;n=Math.pow(e,2)}return(n-e)*i+e};t.isNumber=function(t){return typeof t==="number"&&!isNaN(t)};t.sin=function(e){e*=t.RADIAN_TO_ANGLE;var i=Math.floor(e);var n=i+1;var r=t.sinInt(i);var a=t.sinInt(n);return(e-i)*a+(n-e)*r};t.sinInt=function(t){t=t%360;if(t<0){t+=360}if(t<90){return db_sin_map[t]}if(t<180){return db_sin_map[180-t]}if(t<270){return-db_sin_map[t-180]}return-db_sin_map[360-t]};t.cos=function(e){return t.sin(Math.PI/2-e)};t.ANGLE_TO_RADIAN=Math.PI/180;t.RADIAN_TO_ANGLE=180/Math.PI;return t}();t.MathUtil=e})(dragonBones||(dragonBones={}));var db_sin_map={};for(var dbMathIndex=0;dbMathIndex<=90;dbMathIndex++){db_sin_map[dbMathIndex]=Math.sin(dbMathIndex*dragonBones.MathUtil.ANGLE_TO_RADIAN)}var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e;p=n.prototype;e.globalToLocal=function(t,i){e.transformToMatrix(t,e._helpTransformMatrix,true);e.transformToMatrix(i,e._helpParentTransformMatrix,true);e._helpParentTransformMatrix.invert();
e._helpTransformMatrix.concat(e._helpParentTransformMatrix);e.matrixToTransform(e._helpTransformMatrix,t,t.scaleX*i.scaleX>=0,t.scaleY*i.scaleY>=0)};e.transformToMatrix=function(e,i,n){if(n===void 0){n=false}if(n){i.a=e.scaleX*t.MathUtil.cos(e.skewY);i.b=e.scaleX*t.MathUtil.sin(e.skewY);i.c=-e.scaleY*t.MathUtil.sin(e.skewX);i.d=e.scaleY*t.MathUtil.cos(e.skewX);i.tx=e.x;i.ty=e.y}else{i.a=t.MathUtil.cos(e.skewY);i.b=t.MathUtil.sin(e.skewY);i.c=-t.MathUtil.sin(e.skewX);i.d=t.MathUtil.cos(e.skewX);i.tx=e.x;i.ty=e.y}};e.matrixToTransform=function(t,e,i,n){e.x=t.tx;e.y=t.ty;e.scaleX=Math.sqrt(t.a*t.a+t.b*t.b)*(i?1:-1);e.scaleY=Math.sqrt(t.d*t.d+t.c*t.c)*(n?1:-1);var r=[];r[0]=Math.acos(t.d/e.scaleY);r[1]=-r[0];r[2]=Math.asin(-t.c/e.scaleY);r[3]=r[2]>=0?Math.PI-r[2]:r[2]-Math.PI;if(Number(r[0]).toFixed(4)==Number(r[2]).toFixed(4)||Number(r[0]).toFixed(4)==Number(r[3]).toFixed(4)){e.skewX=r[0]}else{e.skewX=r[1]}var a=[];a[0]=Math.acos(t.a/e.scaleX);a[1]=-a[0];a[2]=Math.asin(t.b/e.scaleX);a[3]=a[2]>=0?Math.PI-a[2]:a[2]-Math.PI;if(Number(a[0]).toFixed(4)==Number(a[2]).toFixed(4)||Number(a[0]).toFixed(4)==Number(a[3]).toFixed(4)){e.skewY=a[0]}else{e.skewY=a[1]}};e.formatRadian=function(t){if(t>Math.PI){t-=e.DOUBLE_PI}if(t<-Math.PI){t+=e.DOUBLE_PI}return t};e.normalizeRotation=function(t){t=(t+Math.PI)%(2*Math.PI);t=t>0?t:2*Math.PI+t;return t-Math.PI};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._helpTransformMatrix=new t.Matrix;e._helpParentTransformMatrix=new t.Matrix;return e}();t.TransformUtil=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this,this)}var n=__define,r=i;p=r.prototype;p._generateArmature=function(){var e=new t.Armature(new DisplayObjectContainer);return e};p._generateSlot=function(){var e=new t.EgretSlot;return e};p._generateDisplay=function(t,e,i,n){var r=new Bitmap;r.texture=t.getTexture(e);if(isNaN(i)||isNaN(n)){var a=t.getFrame(e);if(a!=null){i=a.width/2+a.x;n=a.height/2+a.y}else{i=r.width/2;n=r.height/2}}else{if(a!=null){i+=a.x;n+=a.y}}r.anchorOffsetX=i;r.anchorOffsetY=n;return r};p._generateFastArmature=function(){var e=new t.FastArmature(new DisplayObjectContainer);return e};p._generateFastSlot=function(){var e=new t.EgretFastSlot;return e};return i}(t.BaseFactory);t.EgretFactory=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this,this);this._egretDisplay=null}var n=__define,r=i;p=r.prototype;p.dispose=function(){if(this._displayList){var i=this._displayList.length;for(var n=0;n<i;n++){var r=this._displayList[n];if(r instanceof t.FastArmature){r.dispose()}}}e.prototype.dispose.call(this);this._egretDisplay=null};p._updateDisplay=function(t){this._egretDisplay=t};p._getDisplayIndex=function(){if(this._egretDisplay&&this._egretDisplay.parent){return this._egretDisplay.parent.getChildIndex(this._egretDisplay)}return-1};p._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}var i=t;if(this._egretDisplay&&i){if(e<0){i.addChild(this._egretDisplay)}else{i.addChildAt(this._egretDisplay,Math.min(e,i.numChildren))}}};p._removeDisplayFromContainer=function(){if(this._egretDisplay&&this._egretDisplay.parent){this._egretDisplay.parent.removeChild(this._egretDisplay)}};p._updateTransform=function(){if(this._egretDisplay){this._egretDisplay.$setMatrix(egret.$TempMatrix.copyFrom(this._globalTransformMatrix),false)}};p._updateDisplayVisible=function(t){};p._updateDisplayColor=function(t,i,n,r,a,o,s,h,l){if(l===void 0){l=false}e.prototype._updateDisplayColor.call(this,t,i,n,r,a,o,s,h,l);if(this._egretDisplay){this._egretDisplay.alpha=a}};p._updateDisplayBlendMode=function(t){if(this._egretDisplay&&t){this._egretDisplay.blendMode=t}};return i}(t.FastSlot);t.EgretFastSlot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this,this);this._egretDisplay=null}var n=__define,r=i;p=r.prototype;p.dispose=function(){if(this._displayList){var i=this._displayList.length;for(var n=0;n<i;n++){var r=this._displayList[n];if(r instanceof t.Armature){r.dispose()}}}e.prototype.dispose.call(this);this._egretDisplay=null};p._updateDisplay=function(t){this._egretDisplay=t};p._getDisplayIndex=function(){if(this._egretDisplay&&this._egretDisplay.parent){return this._egretDisplay.parent.getChildIndex(this._egretDisplay)}return-1};p._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}var i=t;if(this._egretDisplay&&i){if(e<0){i.addChild(this._egretDisplay)}else{i.addChildAt(this._egretDisplay,Math.min(e,i.numChildren))}}};p._removeDisplayFromContainer=function(){if(this._egretDisplay&&this._egretDisplay.parent){this._egretDisplay.parent.removeChild(this._egretDisplay)}};p._updateTransform=function(){if(this._egretDisplay){this._egretDisplay.__hack_local_matrix=this._globalTransformMatrix}};p._updateDisplayVisible=function(t){if(this._egretDisplay&&this._parent){this._egretDisplay.visible=this._parent._visible&&this._visible&&t}};p._updateDisplayColor=function(t,i,n,r,a,o,s,h,l){if(l===void 0){l=false}e.prototype._updateDisplayColor.call(this,t,i,n,r,a,o,s,h,l);if(this._egretDisplay){this._egretDisplay.alpha=a}};p._updateDisplayBlendMode=function(t){if(this._egretDisplay&&t){this._egretDisplay.blendMode=t}};p._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._offset.skewY;this._global.x=this._origin.x+this._offset.x+this._parent._tweenPivot.x;this._global.y=this._origin.y+this._offset.y+this._parent._tweenPivot.y;if(this._displayDataList&&this._currentDisplayIndex>=0&&this._displayDataList[this._currentDisplayIndex]&&t.EgretTextureAtlas.rotatedDic[this._displayDataList[this._currentDisplayIndex].name]==1){this._global.skewX-=1.57;this._global.skewY-=1.57}};return i}(t.Slot);t.EgretSlot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(e,i,n){if(n===void 0){n=1}this.texture=e;this.textureAtlasRawData=i;this._textureDatas={};this.scale=n;this.name=i[t.ConstValues.A_NAME];this.parseData(i);this.spriteSheet=new SpriteSheet(e)}var i=__define,n=e;p=n.prototype;p.getTexture=function(t){var i=this.spriteSheet.getTexture(t);if(!i){var n=this._textureDatas[t];if(n){i=this.spriteSheet.createTexture(t,n.region.x,n.region.y,n.region.width,n.region.height);if(n.rotated){e.rotatedDic[t]=1}}}return i};p.dispose=function(){this.texture=null};p.getRegion=function(e){var i=this._textureDatas[e];if(i&&i instanceof t.TextureData){return i.region}return null};p.getFrame=function(e){var i=this._textureDatas[e];if(i&&i instanceof t.TextureData){return i.frame}return null};p.parseData=function(e){this._textureDatas=t.DataParser.parseTextureAtlasData(e,this.scale)};e.rotatedDic={};return e}();t.EgretTextureAtlas=e})(dragonBones||(dragonBones={}));function UIRevoluteJoint(){return}UIRevoluteJoint.prototype=new UIOneJoint;UIRevoluteJoint.prototype.isUIJoint=true;UIRevoluteJoint.prototype.isUIRevoluteJoint=true;UIRevoluteJoint.prototype.initUIRevoluteJoint=function(t){this.initUIOneJoint(t);return this};UIRevoluteJoint.prototype.setValue=UIRevoluteJoint.prototype.setMotorSpeed=function(t){if(this.joint){this.joint.SetMotorSpeed(t)}return this};UIRevoluteJoint.prototype.getValue=UIRevoluteJoint.prototype.getMotorSpeed=function(){if(this.joint){return this.joint.GetMotorSpeed()}return 0};UIRevoluteJoint.prototype.recreateJoint=function(){var t=this.getWindow().world;if(t){Physics.destroyJointForElement(t,this);Physics.createJoint(t,this)}return};function UIRevoluteJointCreator(){var t=["ui-revolute-joint","ui-revolute-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIRevoluteJoint;return e.initUIRevoluteJoint(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIRevoluteJointCreator);function loadDragonBoneArmature(t,e,i,n){var r=new Image;r.onload=function(){httpGetJSON(t,function(i){var a=i;if(!i){console.log("Get Json Failed:"+t);return}httpGetJSON(e,function(t){if(!t){console.log("Get Json Failed:"+e);return}var i=t;var o=new dragonBones.factorys.GeneralFactory;o.addSkeletonData(dragonBones.objects.DataParser.parseSkeletonData(i));o.addTextureAtlas(new dragonBones.textures.GeneralTextureAtlas(r,a));for(var s=0;s<i.armature.length;s++){var h=i.armature[s].name;var l=o.buildArmature(h);if(s===0){n(l)}}})})};r.src=i;return}function onArmatureCreated(t){var e=document.getElementById("canvas");var i=e.getContext("2d");t.setPosition(300,300);function n(){i.clearRect(0,0,e.width,e.height);dragonBones.animation.WorldClock.clock.advanceTime(1/60);t.draw(i);setTimeout(n,16)}function r(){do{var e=Math.floor(Math.random()*t.animation.animationNameList.length);var i=t.animation.animationNameList[e]}while(i==t.animation.getLastAnimationName());t.animation.gotoAndPlay(i)}e.onclick=r;dragonBones.animation.WorldClock.clock.add(t);r();n();return}function UISoundMusic(){return}UISoundMusic.prototype=new UICheckBox;UISoundMusic.prototype.isUISoundMusic=true;UISoundMusic.prototype.initUISoundMusic=function(t){this.initUICheckBox(t);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISoundMusic.prototype.shapeCanBeChild=function(t){return false};UISoundMusic.prototype.setValue=function(t){var e=this.getWindowManager();if(!e){return this}if(this.mode===Shape.MODE_EDITING){return this}e.setSoundMusicsEnable(t);if(!t){e.stopSoundMusic()}else{e.playSoundMusic()}return this};UISoundMusic.prototype.getValue=function(t){var e=this.getWindowManager();if(!e){return true}if(this.mode===Shape.MODE_EDITING){return e.soundMusicAutoPlay}else{return e.soundMusicsPlaying}};function UISoundMusicCreator(){var t=["ui-sound-music","ui-sound-music",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISoundMusic;return e.initUISoundMusic(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISoundMusicCreator);function UIArtText(){return}UIArtText.prototype=new UIElement;UIArtText.prototype.isUIArtText=true;UIArtText.prototype.initUIArtText=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,null);this.setCanRectSelectable(false,true);this.addEventNames(["onUpdateTransform"]);return this};UIArtText.prototype.setText=function(t){var e=null;if(this.text!==t){this.text=t;this.setImage(UIElement.IMAGE_DEFAULT,null)}return this};UIArtText.prototype.getBgImage=function(){var t=this.getImageByType(UIElement.IMAGE_DEFAULT);if((!t||!t.src)&&this.text){var e=UIElement.createArtTextImage(this.text,this.style);this.setImage(UIElement.IMAGE_DEFAULT,e);t=this.getImageByType(UIElement.IMAGE_DEFAULT)}return t};UIArtText.prototype.shapeCanBeChild=function(t){return false};function UIArtTextCreator(){var t=["ui-art-text","ui-art-text",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIArtText;return e.initUIArtText(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIArtTextCreator);function UIPulleyJoint(){return}UIPulleyJoint.prototype=new UIFourJoint;UIPulleyJoint.prototype.isUIJoint=true;UIPulleyJoint.prototype.isUIPulleyJoint=true;UIPulleyJoint.prototype.initUIPulleyJoint=function(t,e,i){this.initUIFourJoint(t,e,i);this.visibleAtRunTime=true;return this};function UIPulleyJointCreator(){var t=["ui-pulley-joint","ui-pulley-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPulleyJoint;return e.initUIPulleyJoint(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIPulleyJointCreator);function UIEdge(){return}UIEdge.prototype=new UITwoPoints;UIEdge.prototype.isUIEdge=true;UIEdge.prototype.isUIPhysicsShape=true;UIEdge.prototype.initUIEdge=function(t,e,i){this.initUITwoPoints(t);return this};function UIEdgeCreator(){var t=["ui-edge","ui-edge",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIEdge;return e.initUIEdge(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIEdgeCreator);function UIStatus(){return}UIStatus.prototype=new UIElement;UIStatus.prototype.isUIStatus=true;UIStatus.prototype.initUIStatus=function(t,e,i){this.initUIElement(t);this.value=.5;this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onBecomeZero","onBecomeFull","onChanged","onUpdateTransform"]);return this};UIStatus.prototype.shapeCanBeChild=function(t){return this.children.length===0&&t.isUILabel};UIStatus.prototype.setValue=function(t){this.value=Math.max(0,Math.min(100,t))/100;if(this.value===0){this.callOnBecomeZeroHandler()}else if(this.value===1){this.callOnBecomeFullHandler()}this.callOnChangedHandler(this.value);return this.getValue()};UIStatus.prototype.getValue=function(){return Math.round(this.value*100)};UIStatus.prototype.paintSelfOnly=function(t){var e=this.value;var i=this.roundRadius;var n=Math.round(e*this.h);var r=Math.round((1-e)*this.h);var a=Math.round(e*this.w);var o=Math.round((1-e)*this.w);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.beginPath();if(this.horizonal){t.translate(a,0);drawRoundRect(t,o,this.h,i,RoundRect.TR|RoundRect.BR);t.translate(-a,0)}else{drawRoundRect(t,this.w,r,i,RoundRect.TL|RoundRect.TR)}t.fill()}if(!this.isTextColorTransparent()){t.fillStyle=this.style.textColor;t.beginPath();if(this.horizonal){drawRoundRect(t,a,this.h,i,RoundRect.TL|RoundRect.BL)}else{t.translate(0,r);drawRoundRect(t,this.w,n,i,RoundRect.BL|RoundRect.BR);t.translate(0,-r)}t.fill()}if(!this.isStrokeColorTransparent()&&this.style.lineWidth){t.beginPath();t.lineWidth=this.style.lineWidth;drawRoundRect(t,this.w,this.h,i,RoundRect.BL|RoundRect.BR|RoundRect.TL|RoundRect.TR);t.stroke()}return};function UIStatusCreator(){var t=["ui-status","ui-status",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIStatus;return e.initUIStatus(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIStatusCreator);function UITimer(){return}UITimer.prototype=new UIElement;UITimer.prototype.isUITimer=true;UITimer.prototype.initUITimer=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_AUTO;this.addEventNames(["onTimeout"]);return this};UITimer.prototype.shapeCanBeChild=function(t){return false};UITimer.prototype.onInit=function(){if(this.enable){this.start();console.log("start timer.")}else{console.log("not start disable timer.")}return};UITimer.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}this.enable=t;if(t){this.start()}else{this.stop()}return};UITimer.prototype.getDuration=function(){if(this.durationType==="random"){var t=this.durationMin+Math.random()*(this.durationMax-this.durationMin);return t}else{return this.duration}};UITimer.prototype.start=function(){if(!this.enable){console.log("can not start disabled timer, please call setEnable first.")}if(this.timerID){console.log("Timer is alread started:"+this.timerID);return}var t=this;this.paused=false;this.startTime=Date.now();function e(){if(!t.enable||!t.timerID||!t.parentShape){t.timerID=null;return}if(t.paused){t.timerID=setTimeout(e,t.getDuration());return}t.callOnTimeoutHandler();t.times--;if(t.times<=0){t.timerID=null;console.log("timer stop "+t.name)}else{t.timerID=setTimeout(e,t.getDuration())}}if(this.delayStart){this.timerID=setTimeout(function(){t.timerID=setTimeout(e,t.getDuration())},this.delayStart)}else{this.timerID=setTimeout(e,t.getDuration())}return this};UITimer.prototype.stop=function(){if(this.timerID){clearTimeout(this.timerID);this.timerID=null}return this};UITimer.prototype.pause=function(){this.paused=true;return this};UITimer.prototype.resume=function(){this.paused=false;return this};UITimer.prototype.getElapsedTime=function(){return Date.now()-this.startTime};function UITimerCreator(){var t=["ui-timer","ui-timer",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITimer;return e.initUITimer(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UITimerCreator);function UISkeletonAnimation(){return}UISkeletonAnimation.prototype=new UIElement;UISkeletonAnimation.prototype.isUISkeletonAnimation=true;UISkeletonAnimation.prototype.initUISkeletonAnimation=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setSizeLimit(50,50);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,true);this.addEventNames(["onDoubleClick","onUpdateTransform","onLoadDone"]);this.animationScale=1;this.animationNames=[];return this};UISkeletonAnimation.prototype.setSkeletonJsonURL=function(t){this.skeletonJsonURL=t;return this};UISkeletonAnimation.prototype.getSkeletonJsonURL=function(){return this.skeletonJsonURL?this.skeletonJsonURL:""};UISkeletonAnimation.prototype.setTextureJsonURL=function(t){this.textureJsonURL=t;return this};UISkeletonAnimation.prototype.getTextureJsonURL=function(){return this.textureJsonURL?this.textureJsonURL:""};UISkeletonAnimation.prototype.setTextureURL=function(t){this.textureURL=t;return this};UISkeletonAnimation.prototype.getTextureURL=function(){return this.textureURL?this.textureURL:""};UISkeletonAnimation.prototype.loadSheletonData=function(t,e,i,n){var r=this;ResLoader.loadImage(i,function(i){var r=ResLoader.loadJson;if(t.indexOf(".atlas")>0){r=ResLoader.loadData}r(t,function(r){var a=r;if(!r){console.log("Get Json Failed:"+t);return}ResLoader.loadJson(e,function(t){if(!t){console.log("Get Json Failed:"+e);return}var r=t;n(i,a,r)})})});return};UISkeletonAnimation.prototype.createSkelentonAnimation=function(t){var e=this;this.destroyArmature();function i(t,i,n){e.createArmature(t,i,n);var r=e.getAnimationName();e.play(r)}this.loadSheletonData(this.textureJsonURL,this.skeletonJsonURL,this.textureURL,i);return};UISkeletonAnimation.prototype.onFromJsonDone=function(){this.reload();return};UISkeletonAnimation.prototype.reload=function(t){if(this.textureURL&&this.textureJsonURL&&this.skeletonJsonURL){this.createSkelentonAnimation(t)}return};UISkeletonAnimation.prototype.destroy=function(){this.destroyArmature();Shape.prototype.destroy.call(this);return};UISkeletonAnimation.prototype.callOnLoadDoneHandler=function(){if(!this.handleOnLoadDone){var sourceCode=this.events["onLoadDone"];if(sourceCode){sourceCode="this.handleOnLoadDone = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnLoadDone){try{this.handleOnLoadDone()}catch(e){console.log("this.handleOnLoadDone:"+e.message)}}return true};UISkeletonAnimation.prototype.destroyArmature=function(){};UISkeletonAnimation.prototype.pause=function(){return this};UISkeletonAnimation.prototype.resume=function(){return this};UISkeletonAnimation.prototype.getAnimationNames=function(){return this.animationNames};UISkeletonAnimation.prototype.setAnimationName=function(t){this.animationName=t;return this};UISkeletonAnimation.prototype.getAnimationName=function(){if(this.animationName)return this.animationName;var t=this.getAnimationNames();return t?t[0]:""};UISkeletonAnimation.prototype.setAnimationScale=function(t){this.animationScale=t;return};UISkeletonAnimation.prototype.getAnimationScale=function(){return this.animationScale};UISkeletonAnimation.prototype.preprocessTextureAtlas=function(t){return t};UISkeletonAnimation.prototype.shapeCanBeChild=UISprite.prototype.shapeCanBeChild;function UIDragoneBones(){return}UIDragoneBones.prototype=new UISkeletonAnimation;UIDragoneBones.prototype.isUIDragoneBones=true;UIDragoneBones.prototype.initUIDragoneBones=UISkeletonAnimation.prototype.initUISkeletonAnimation;UIDragoneBones.startTimerIfNot=function(){if(UIDragoneBones.timerID){return}UIDragoneBones.lastUpdateTime=Date.now();function t(){if(WWindowManager.getInstance().getPaintEnable()){var t=Date.now();var e=(t-UIDragoneBones.lastUpdateTime)/1e3;UIDragoneBones.lastUpdateTime=t;dragonBones.WorldClock.clock.advanceTime(e*UIElement.timeScale)}}UIDragoneBones.timerID=setInterval(t,25);return};UIDragoneBones.prototype.pause=function(){if(this.armature){this.armature.animation.stop()}return this};UIDragoneBones.prototype.resume=function(){if(this.armature){this.armature.animation.play()}return this};UIDragoneBones.prototype.setupLoop=function(t,e,i,n){var r=this;function a(e){if(!e||!e.animationState||e.animationState.name!=t){return}if(r.onOneCycle){try{r.onOneCycle()}catch(e){console.debug("onOneCycle:",e)}}}function o(){r.stop();if(r.onDone){try{r.onDone()}catch(t){console.debug("onDone:",t)}}}if(!isNaN(e)){this.onDone=i;this.onOneCycle=n;this._armature.addEventListener(dragonBones.AnimationEvent.COMPLETE,o);this._armature.addEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,a)}};UIDragoneBones.prototype.play=UIDragoneBones.prototype.gotoAndPlay=function(t,e,i,n,r){this.animationName=t;if(this.armature){var a=this.armature;if(t&&a.animation.animationList.indexOf(t)>=0){if(i||n||e){e=isNaN(e)?4294967295:e;this.setupLoop.apply(a.animation,arguments)}var o=r===false?0:undefined;a.animation.gotoAndPlay(t,o,undefined,e)}else if(this.animations&&t){this.animate(t)}else{console.log("Unknow animation name: "+t)}}return this};UIDragoneBones.prototype.setAnimationScale=function(t){this.animationScale=t;if(this.armature){this.rendererContext.setScale(this.animationScale,this.animationScale)}return};UIDragoneBones.prototype.destroyArmature=function(){if(this.armature){dragonBones.WorldClock.clock.remove(this.armature);this.armature=null}return};UISkeletonAnimation.prototype.destroy=function(){this.destroyArmature();Shape.prototype.destroy.call(this);return};UISkeletonAnimation.prototype.getSlotRect=function(t){if(!this.armature){return null}var e=this.armature._slotList;for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t){var r=n.getDisplay();return r.textureAtlasRect}}return null};UISkeletonAnimation.prototype.replaceSlotImage=function(t,e,i){if(!this.armature){return this}if(i&&i.w){i.width=i.w}if(i&&i.h){i.height=i.h}var n=this.armature._slotList;for(var r=0;r<n.length;r++){var a=n[r];if(a.name===t){a.image=e;a.imageRect=i}}return};UIDragoneBones.prototype.createArmature=function(t,e,i){if(this.armature){dragonBones.WorldClock.clock.remove(this.armature);this.armature=null}if(!this.rendererContext){this.rendererContext=new CanvasRenderer;this.rendererContext.container=new DisplayObjectContainer}else{this.rendererContext.container.removeChildren()}if(this.animationScale){this.rendererContext.setScale(this.animationScale,this.animationScale)}var n=null;if(!MainContext.instance.factory){n=new dragonBones.EgretFactory;MainContext.instance.factory=n}else{n=MainContext.instance.factory}n.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(i));n.addTextureAtlas(new dragonBones.EgretTextureAtlas(t,e));var r=n.buildArmature(i.armature[0].name);var a=r.getDisplay();this.rendererContext.container.addChild(a);this.armature=r;UIDragoneBones.startTimerIfNot();dragonBones.WorldClock.clock.add(r);this.animationNames=r.animation.animationList;this.animationName=this.animationNames.indexOf(this.animationName)>-1?this.animationName:this.animationNames[0]};UIDragoneBones.prototype.paintSelfOnly=function(t){if(this.armature){var e=this.w>>1;var i=this.h>>1;t.save();this.rendererContext.setPosition(e,i);MainContext.instance.renderLoop.call(this.rendererContext,t);t.restore();t.needRedraw++}return};function UISkeletonAnimationCreator(t){var e=[t,t,null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIDragoneBones;return e.initUIDragoneBones(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISkeletonAnimationCreator("ui-dragonbones"));ShapeFactoryGet().addShapeCreator(new UISkeletonAnimationCreator("ui-skeleton-animation"));var spine={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:typeof Float32Array==="undefined"?Array:Float32Array,Uint16Array:typeof Uint16Array==="undefined"?Array:Uint16Array};spine.BoneData=function(t,e){this.name=t;this.parent=e};spine.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:true,inheritRotation:true,flipX:false,flipY:false};spine.BlendMode={normal:0,additive:1,multiply:2,screen:3};spine.SlotData=function(t,e){this.name=t;this.boneData=e};spine.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,blendMode:spine.BlendMode.normal};spine.IkConstraintData=function(t){this.name=t;this.bones=[]};spine.IkConstraintData.prototype={target:null,bendDirection:1,mix:1};spine.Bone=function(t,e,i){this.data=t;this.skeleton=e;this.parent=i;this.setToSetupPose()};spine.Bone.yDown=false;spine.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:false,flipY:false,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:false,worldFlipY:false,updateWorldTransform:function(){var t=this.parent;if(t){this.worldX=this.x*t.m00+this.y*t.m01+t.worldX;this.worldY=this.x*t.m10+this.y*t.m11+t.worldY;if(this.data.inheritScale){this.worldScaleX=t.worldScaleX*this.scaleX;this.worldScaleY=t.worldScaleY*this.scaleY}else{this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY}this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK;this.worldFlipX=t.worldFlipX!=this.flipX;this.worldFlipY=t.worldFlipY!=this.flipY}else{var e=this.skeleton.flipX,i=this.skeleton.flipY;this.worldX=e?-this.x:this.x;this.worldY=i!=spine.Bone.yDown?-this.y:this.y;this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY;this.worldRotation=this.rotationIK;this.worldFlipX=e!=this.flipX;this.worldFlipY=i!=this.flipY}var n=this.worldRotation*spine.degRad;var r=Math.cos(n);var a=Math.sin(n);if(this.worldFlipX){this.m00=-r*this.worldScaleX;this.m01=a*this.worldScaleY}else{this.m00=r*this.worldScaleX;this.m01=-a*this.worldScaleY}if(this.worldFlipY!=spine.Bone.yDown){this.m10=-a*this.worldScaleX;this.m11=-r*this.worldScaleY}else{this.m10=a*this.worldScaleX;this.m11=r*this.worldScaleY}},setToSetupPose:function(){var t=this.data;this.x=t.x;this.y=t.y;this.rotation=t.rotation;this.rotationIK=this.rotation;this.scaleX=t.scaleX;this.scaleY=t.scaleY;this.flipX=t.flipX;this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,i=t[1]-this.worldY;var n=this.m00,r=this.m10,a=this.m01,o=this.m11;if(this.worldFlipX!=(this.worldFlipY!=spine.Bone.yDown)){n=-n;o=-o}var s=1/(n*o-a*r);t[0]=e*n*s-i*a*s;t[1]=i*o*s-e*r*s},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX;t[1]=e*this.m10+i*this.m11+this.worldY}};spine.Slot=function(t,e){this.data=t;this.bone=e;this.setToSetupPose()};spine.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t;this._attachmentTime=this.bone.skeleton.time;this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r;this.g=t.g;this.b=t.b;this.a=t.a;var e=this.bone.skeleton.data.slots;for(var i=0,n=e.length;i<n;i++){if(e[i]==t){this.setAttachment(!t.attachmentName?null:this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName));break}}}};spine.IkConstraint=function(t,e){this.data=t;this.mix=t.mix;this.bendDirection=t.bendDirection;this.bones=[];for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)};spine.IkConstraint.prototype={apply:function(){var t=this.target;var e=this.bones;switch(e.length){case 1:spine.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:spine.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix);break}}};spine.IkConstraint.apply1=function(t,e,i,n){var r=!t.data.inheritRotation||!t.parent?0:t.parent.worldRotation;var a=t.rotation;var o=Math.atan2(i-t.worldY,e-t.worldX)*spine.radDeg;if(t.worldFlipX!=(t.worldFlipY!=spine.Bone.yDown))o=-o;o-=r;t.rotationIK=a+(o-a)*n};spine.IkConstraint.apply2=function(t,e,i,n,r,a){var o=e.rotation,s=t.rotation;if(!a){e.rotationIK=o;t.rotationIK=s;return}var h,l,u=spine.temp;var c=t.parent;if(c){u[0]=i;u[1]=n;c.worldToLocal(u);i=(u[0]-t.x)*c.worldScaleX;n=(u[1]-t.y)*c.worldScaleY}else{i-=t.x;n-=t.y}if(e.parent==t){h=e.x;l=e.y}else{u[0]=e.x;u[1]=e.y;e.parent.localToWorld(u);t.worldToLocal(u);h=u[0];l=u[1]}var p=h*t.worldScaleX,f=l*t.worldScaleY;var m=Math.atan2(f,p);var d=Math.sqrt(p*p+f*f),g=e.data.length*e.worldScaleX;var y=2*d*g;if(y<1e-4){e.rotationIK=o+(Math.atan2(n,i)*spine.radDeg-s-o)*a;return}var v=(i*i+n*n-d*d-g*g)/y;if(v<-1)v=-1;else if(v>1)v=1;var _=Math.acos(v)*r;var I=d+g*v,w=g*Math.sin(_);var x=Math.atan2(n*I-i*w,i*I+n*w);var S=(x-m)*spine.radDeg-s;if(S>180)S-=360;else if(S<-180)S+=360;t.rotationIK=s+S*a;S=(_+m)*spine.radDeg-o;if(S>180)S-=360;else if(S<-180)S+=360;e.rotationIK=o+(S+t.worldRotation-e.parent.worldRotation)*a};spine.Skin=function(t){this.name=t;this.attachments={}};spine.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":");var r=parseInt(i.substring(0,n));var a=i.substring(n+1);var o=t.slots[r];if(o.attachment&&o.attachment.name==a){var s=this.getAttachment(r,a);if(s)o.setAttachment(s)}}}};spine.Animation=function(t,e,i){this.name=t;this.timelines=e;this.duration=i};spine.Animation.prototype={apply:function(t,e,i,n,r){if(n&&this.duration!=0){i%=this.duration;e%=this.duration}var a=this.timelines;for(var o=0,s=a.length;o<s;o++)a[o].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,a){if(n&&this.duration!=0){i%=this.duration;e%=this.duration}var o=this.timelines;for(var s=0,h=o.length;s<h;s++)o[s].apply(t,e,i,r,a)}};spine.Animation.binarySearch=function(t,e,i){var n=0;var r=Math.floor(t.length/i)-2;if(!r)return i;var a=r>>>1;while(true){if(t[(a+1)*i]<=e)n=a+1;else r=a;if(n==r)return(n+1)*i;a=n+r>>>1}};spine.Animation.binarySearch1=function(t,e){var i=0;var n=t.length-2;if(!n)return 1;var r=n>>>1;while(true){if(t[r+1]<=e)i=r+1;else n=r;if(i==n)return i+1;r=i+n>>>1}};spine.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1};spine.Curves=function(t){this.curves=[]};spine.Curves.prototype={setLinear:function(t){this.curves[t*19]=0},setStepped:function(t){this.curves[t*19]=1},setCurve:function(t,e,i,n,r){var a=1/10,o=a*a,s=o*a;var h=3*a,l=3*o,u=6*o,c=6*s;var p=-e*2+n,f=-i*2+r,m=(e-n)*3+1,d=(i-r)*3+1;var g=e*h+p*l+m*s,y=i*h+f*l+d*s;var v=p*u+m*c,_=f*u+d*c;var I=m*c,w=d*c;var x=t*19;var S=this.curves;S[x++]=2;var C=g,T=y;for(var b=x+19-1;x<b;x+=2){S[x]=C;S[x+1]=T;g+=v;y+=_;v+=I;_+=w;C+=g;T+=y}},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var i=this.curves;var n=t*19;var r=i[n];if(r===0)return e;if(r==1)return 0;n++;var a=0;for(var o=n,s=n+19-1;n<s;n+=2){a=i[n];if(a>=e){var h,l;if(n==o){h=0;l=0}else{h=i[n-2];l=i[n-1]}return l+(i[n+1]-l)*(e-h)/(a-h)}}var u=i[n-1];return u+(1-u)*(e-a)/(1-a)}};spine.RotateTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*2};spine.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0])return;var o=t.bones[this.boneIndex];if(i>=a[a.length-2]){var s=o.data.rotation+a[a.length-1]-o.rotation;while(s>180)s-=360;while(s<-180)s+=360;o.rotation+=s*r;return}var h=spine.Animation.binarySearch(a,i,2);var l=a[h-1];var u=a[h];var c=1-(i-u)/(a[h-2]-u);c=this.curves.getCurvePercent(h/2-1,c);var s=a[h+1]-l;
while(s>180)s-=360;while(s<-180)s+=360;s=o.data.rotation+(l+s*c)-o.rotation;while(s>180)s-=360;while(s<-180)s+=360;o.rotation+=s*r}};spine.TranslateTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*3};spine.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0])return;var o=t.bones[this.boneIndex];if(i>=a[a.length-3]){o.x+=(o.data.x+a[a.length-2]-o.x)*r;o.y+=(o.data.y+a[a.length-1]-o.y)*r;return}var s=spine.Animation.binarySearch(a,i,3);var h=a[s-2];var l=a[s-1];var u=a[s];var c=1-(i-u)/(a[s+-3]-u);c=this.curves.getCurvePercent(s/3-1,c);o.x+=(o.data.x+h+(a[s+1]-h)*c-o.x)*r;o.y+=(o.data.y+l+(a[s+2]-l)*c-o.y)*r}};spine.ScaleTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*3};spine.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0])return;var o=t.bones[this.boneIndex];if(i>=a[a.length-3]){o.scaleX+=(o.data.scaleX*a[a.length-2]-o.scaleX)*r;o.scaleY+=(o.data.scaleY*a[a.length-1]-o.scaleY)*r;return}var s=spine.Animation.binarySearch(a,i,3);var h=a[s-2];var l=a[s-1];var u=a[s];var c=1-(i-u)/(a[s+-3]-u);c=this.curves.getCurvePercent(s/3-1,c);o.scaleX+=(o.data.scaleX*(h+(a[s+1]-h)*c)-o.scaleX)*r;o.scaleY+=(o.data.scaleY*(l+(a[s+2]-l)*c)-o.scaleY)*r}};spine.ColorTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*5};spine.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,a){t*=5;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n;this.frames[t+3]=r;this.frames[t+4]=a},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0])return;var o,s,h,l;if(i>=a[a.length-5]){var u=a.length-1;o=a[u-3];s=a[u-2];h=a[u-1];l=a[u]}else{var c=spine.Animation.binarySearch(a,i,5);var p=a[c-4];var f=a[c-3];var m=a[c-2];var d=a[c-1];var g=a[c];var y=1-(i-g)/(a[c-5]-g);y=this.curves.getCurvePercent(c/5-1,y);o=p+(a[c+1]-p)*y;s=f+(a[c+2]-f)*y;h=m+(a[c+3]-m)*y;l=d+(a[c+4]-d)*y}var v=t.slots[this.slotIndex];if(r<1){v.r+=(o-v.r)*r;v.g+=(s-v.g)*r;v.b+=(h-v.b)*r;v.a+=(l-v.a)*r}else{v.r=o;v.g=s;v.b=h;v.a=l}}};spine.AttachmentTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t;this.attachmentNames=[];this.attachmentNames.length=t};spine.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.attachmentNames[t]=i},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0]){if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0);return}else if(e>i)e=-1;var o=i>=a[a.length-1]?a.length-1:spine.Animation.binarySearch1(a,i)-1;if(a[o]<e)return;var s=this.attachmentNames[o];t.slots[this.slotIndex].setAttachment(!s?null:t.getAttachmentBySlotIndex(this.slotIndex,s))}};spine.EventTimeline=function(t){this.frames=[];this.frames.length=t;this.events=[];this.events.length=t};spine.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.events[t]=i},apply:function(t,e,i,n,r){if(!n)return;var a=this.frames;var o=a.length;if(e>i){this.apply(t,e,Number.MAX_VALUE,n,r);e=-1}else if(e>=a[o-1])return;if(i<a[0])return;var s;if(e<a[0])s=0;else{s=spine.Animation.binarySearch1(a,e);var h=a[s];while(s>0){if(a[s-1]!=h)break;s--}}var l=this.events;for(;s<o&&i>=a[s];s++)n.push(l[s])}};spine.DrawOrderTimeline=function(t){this.frames=[];this.frames.length=t;this.drawOrders=[];this.drawOrders.length=t};spine.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.drawOrders[t]=i},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0])return;var o;if(i>=a[a.length-1])o=a.length-1;else o=spine.Animation.binarySearch1(a,i)-1;var s=t.drawOrder;var h=t.slots;var l=this.drawOrders[o];if(!l){for(var u=0,c=h.length;u<c;u++)s[u]=h[u]}else{for(var u=0,c=l.length;u<c;u++)s[u]=t.slots[l[u]]}}};spine.FfdTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t;this.frameVertices=[];this.frameVertices.length=t};spine.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.frameVertices[t]=i},apply:function(t,e,i,n,r){var a=t.slots[this.slotIndex];if(a.attachment!=this.attachment)return;var o=this.frames;if(i<o[0])return;var s=this.frameVertices;var h=s[0].length;var l=a.attachmentVertices;if(l.length!=h)r=1;l.length=h;if(i>=o[o.length-1]){var u=s[o.length-1];if(r<1){for(var c=0;c<h;c++)l[c]+=(u[c]-l[c])*r}else{for(var c=0;c<h;c++)l[c]=u[c]}return}var p=spine.Animation.binarySearch1(o,i);var f=o[p];var m=1-(i-f)/(o[p-1]-f);m=this.curves.getCurvePercent(p-1,m<0?0:m>1?1:m);var d=s[p-1];var g=s[p];if(r<1){for(var c=0;c<h;c++){var y=d[c];l[c]+=(y+(g[c]-y)*m-l[c])*r}}else{for(var c=0;c<h;c++){var y=d[c];l[c]=y+(g[c]-y)*m}}}};spine.IkConstraintTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*3};spine.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0])return;var o=t.ikConstraints[this.ikConstraintIndex];if(i>=a[a.length-3]){o.mix+=(a[a.length-2]-o.mix)*r;o.bendDirection=a[a.length-1];return}var s=spine.Animation.binarySearch(a,i,3);var h=a[s+-2];var l=a[s];var u=1-(i-l)/(a[s+-3]-l);u=this.curves.getCurvePercent(s/3-1,u);var c=h+(a[s+1]-h)*u;o.mix+=(c-o.mix)*r;o.bendDirection=a[s+-1]}};spine.FlipXTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*2};spine.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i?1:0},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0]){if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0);return}else if(e>i)e=-1;var o=(i>=a[a.length-2]?a.length:spine.Animation.binarySearch(a,i,2))-2;if(a[o]<e)return;t.bones[this.boneIndex].flipX=a[o+1]!=0}};spine.FlipYTimeline=function(t){this.curves=new spine.Curves(t);this.frames=[];this.frames.length=t*2};spine.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i?1:0},apply:function(t,e,i,n,r){var a=this.frames;if(i<a[0]){if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0);return}else if(e>i)e=-1;var o=(i>=a[a.length-2]?a.length:spine.Animation.binarySearch(a,i,2))-2;if(a[o]<e)return;t.bones[this.boneIndex].flipY=a[o+1]!=0}};spine.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[]};spine.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++){if(e[i].name==t)return slot[i]}return null},findSlotIndex:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){var e=this.skins;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){var e=this.events;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){var e=this.animations;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){var e=this.ikConstraints;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null}};spine.Skeleton=function(t){this.data=t;this.bones=[];for(var e=0,i=t.bones.length;e<i;e++){var n=t.bones[e];var r=!n.parent?null:this.bones[t.bones.indexOf(n.parent)];this.bones.push(new spine.Bone(n,this,r))}this.slots=[];this.drawOrder=[];for(var e=0,i=t.slots.length;e<i;e++){var a=t.slots[e];var o=this.bones[t.bones.indexOf(a.boneData)];var s=new spine.Slot(a,o);this.slots.push(s);this.drawOrder.push(s)}this.ikConstraints=[];for(var e=0,i=t.ikConstraints.length;e<i;e++)this.ikConstraints.push(new spine.IkConstraint(t.ikConstraints[e],this));this.boneCache=[];this.updateCache()};spine.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:false,flipY:false,updateCache:function(){var t=this.ikConstraints;var e=t.length;var i=e+1;var n=this.boneCache;if(n.length>i)n.length=i;for(var r=0,a=n.length;r<a;r++)n[r].length=0;while(n.length<i)n[n.length]=[];var o=n[0];var s=this.bones;t:for(var r=0,a=s.length;r<a;r++){var h=s[r];var l=h;do{for(var u=0;u<e;u++){var c=t[u];var p=c.bones[0];var f=c.bones[c.bones.length-1];while(true){if(l==f){n[u].push(h);n[u+1].push(h);continue t}if(f==p)break;f=f.parent}}l=l.parent}while(l);o[o.length]=h}},updateWorldTransform:function(){var t=this.bones;for(var e=0,i=t.length;e<i;e++){var n=t[e];n.rotationIK=n.rotation}var e=0,r=this.boneCache.length-1;while(true){var a=this.boneCache[e];for(var o=0,s=a.length;o<s;o++)a[o].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply();e++}},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){var t=this.bones;for(var e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var n=this.ikConstraints;for(var e=0,i=n.length;e<i;e++){var r=n[e];r.bendDirection=r.data.bendDirection;r.mix=r.data.mix}},setSlotsToSetupPose:function(){var t=this.slots;var e=this.drawOrder;for(var i=0,n=t.length;i<n;i++){e[i]=t[i];t[i].setToSetupPose(i)}},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t){if(this.skin)t._attachAll(this,this.skin);else{var e=this.slots;for(var i=0,n=e.length;i<n;i++){var r=e[i];var a=r.data.attachmentName;if(a){var o=t.getAttachment(i,a);if(o)r.setAttachment(o)}}}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}if(this.data.defaultSkin)return this.data.defaultSkin.getAttachment(t,e);return null},setAttachment:function(t,e){var i=this.slots;for(var n=0,r=i.length;n<r;n++){var a=i[n];if(a.data.name==t){var o=null;if(e){o=this.getAttachmentBySlotIndex(n,e);if(!o)throw"Attachment not found: "+e+", for slot: "+t}a.setAttachment(o);return}}throw"Slot not found: "+t},findIkConstraint:function(t){var e=this.ikConstraints;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t}};spine.EventData=function(t){this.name=t};spine.EventData.prototype={intValue:0,floatValue:0,stringValue:null};spine.Event=function(t){this.data=t};spine.Event.prototype={intValue:0,floatValue:0,stringValue:null};spine.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3};spine.RegionAttachment=function(t){this.name=t;this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};spine.RegionAttachment.prototype={type:spine.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var a=this.uvs;if(r){a[2]=t;a[3]=n;a[4]=t;a[5]=e;a[6]=i;a[7]=e;a[0]=i;a[1]=n}else{a[0]=t;a[1]=n;a[2]=t;a[3]=e;a[4]=i;a[5]=e;a[6]=i;a[7]=n}},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX;var e=this.height/this.regionOriginalHeight*this.scaleY;var i=-this.width/2*this.scaleX+this.regionOffsetX*t;var n=-this.height/2*this.scaleY+this.regionOffsetY*e;var r=i+this.regionWidth*t;var a=n+this.regionHeight*e;var o=this.rotation*spine.degRad;var s=Math.cos(o);var h=Math.sin(o);var l=i*s+this.x;var u=i*h;var c=n*s+this.y;var p=n*h;var f=r*s+this.x;var m=r*h;var d=a*s+this.y;var g=a*h;var y=this.offset;y[0]=l-p;y[1]=c+u;y[2]=l-g;y[3]=d+u;y[4]=f-g;y[5]=d+m;y[6]=f-p;y[7]=c+m},computeVertices:function(t,e,i,n){t+=i.worldX;e+=i.worldY;var r=i.m00,a=i.m01,o=i.m10,s=i.m11;var h=this.offset;n[0]=h[0]*r+h[1]*a+t;n[1]=h[0]*o+h[1]*s+e;n[2]=h[2]*r+h[3]*a+t;n[3]=h[2]*o+h[3]*s+e;n[4]=h[4]*r+h[5]*a+t;n[5]=h[4]*o+h[5]*s+e;n[6]=h[6]*r+h[7]*a+t;n[7]=h[6]*o+h[7]*s+e}};spine.MeshAttachment=function(t){this.name=t};spine.MeshAttachment.prototype={type:spine.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:false,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV;var i=this.regionUVs.length;if(!this.uvs||this.uvs.length!=i){this.uvs=new spine.Float32Array(i)}if(this.regionRotate){for(var n=0;n<i;n+=2){this.uvs[n]=this.regionU+this.regionUVs[n+1]*t;this.uvs[n+1]=this.regionV+e-this.regionUVs[n]*e}}else{for(var n=0;n<i;n+=2){this.uvs[n]=this.regionU+this.regionUVs[n]*t;this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*e}}},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX;e+=r.worldY;var a=r.m00,o=r.m01,s=r.m10,h=r.m11;var l=this.vertices;var u=l.length;if(i.attachmentVertices.length==u)l=i.attachmentVertices;for(var c=0;c<u;c+=2){var p=l[c];var f=l[c+1];n[c]=p*a+f*o+t;n[c+1]=p*s+f*h+e}}};spine.SkinnedMeshAttachment=function(t){this.name=t};spine.SkinnedMeshAttachment.prototype={type:spine.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:false,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,e,i,n,r){var a=this.regionU2-this.regionU,o=this.regionV2-this.regionV;var s=this.regionUVs.length;if(!this.uvs||this.uvs.length!=s){this.uvs=new spine.Float32Array(s)}if(this.regionRotate){for(var h=0;h<s;h+=2){this.uvs[h]=this.regionU+this.regionUVs[h+1]*a;this.uvs[h+1]=this.regionV+o-this.regionUVs[h]*o}}else{for(var h=0;h<s;h+=2){this.uvs[h]=this.regionU+this.regionUVs[h]*a;this.uvs[h+1]=this.regionV+this.regionUVs[h+1]*o}}},computeWorldVertices:function(t,e,i,n){var r=i.bone.skeleton.bones;var a=this.weights;var o=this.bones;var s=0,h=0,l=0,u=0,c=o.length,p;var f,m,d,g,y,v;if(!i.attachmentVertices.length){for(;h<c;s+=2){f=0;m=0;p=o[h++]+h;for(;h<p;h++,l+=3){d=r[o[h]];g=a[l];y=a[l+1];v=a[l+2];f+=(g*d.m00+y*d.m01+d.worldX)*v;m+=(g*d.m10+y*d.m11+d.worldY)*v}n[s]=f+t;n[s+1]=m+e}}else{var _=i.attachmentVertices;for(;h<c;s+=2){f=0;m=0;p=o[h++]+h;for(;h<p;h++,l+=3,u+=2){d=r[o[h]];g=a[l]+_[u];y=a[l+1]+_[u+1];v=a[l+2];f+=(g*d.m00+y*d.m01+d.worldX)*v;m+=(g*d.m10+y*d.m11+d.worldY)*v}n[s]=f+t;n[s+1]=m+e}}}};spine.BoundingBoxAttachment=function(t){this.name=t;this.vertices=[]};spine.BoundingBoxAttachment.prototype={type:spine.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX;e+=i.worldY;var r=i.m00,a=i.m01,o=i.m10,s=i.m11;var h=this.vertices;for(var l=0,u=h.length;l<u;l+=2){var c=h[l];var p=h[l+1];n[l]=c*r+p*a+t;n[l+1]=c*o+p*s+e}}};spine.AnimationStateData=function(t){this.skeletonData=t;this.animationToMixTime={}};spine.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}};spine.TrackEntry=function(){};spine.TrackEntry.prototype={next:null,previous:null,animation:null,loop:false,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null};spine.AnimationState=function(t){this.data=t;this.tracks=[];this.events=[]};spine.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(!i)continue;i.time+=t*i.timeScale;if(i.previous){var n=t*i.previous.timeScale;i.previous.time+=n;i.mixTime+=n}var r=i.next;if(r){r.time=i.lastTime-r.delay;if(r.time>=0)this.setCurrent(e,r)}else{if(!i.loop&&i.lastTime>=i.endTime)this.clearTrack(e)}}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(!i)continue;this.events.length=0;var n=i.time;var r=i.lastTime;var a=i.endTime;var o=i.loop;if(!o&&n>a)n=a;var s=i.previous;if(!s){if(i.mix==1)i.animation.apply(t,i.lastTime,n,o,this.events);else i.animation.mix(t,i.lastTime,n,o,this.events,i.mix)}else{var h=s.time;if(!s.loop&&h>s.endTime)h=s.endTime;s.animation.apply(t,h,h,s.loop,null);var l=i.mixTime/i.mixDuration*i.mix;if(l>=1){l=1;i.previous=null}i.animation.mix(t,i.lastTime,n,o,this.events,l)}for(var u=0,c=this.events.length;u<c;u++){var p=this.events[u];if(i.onEvent)i.onEvent(e,p);if(this.onEvent)this.onEvent(e,p)}if(o?r%a>n%a:r<a&&n>=a){var f=Math.floor(n/a);if(i.onComplete)i.onComplete(e,f);if(this.onComplete)this.onComplete(e,f)}i.lastTime=i.time}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(t>=this.tracks.length)return;var e=this.tracks[t];if(!e)return;if(e.onEnd)e.onEnd(t);if(this.onEnd)this.onEnd(t);this.tracks[t]=null},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];while(t>=this.tracks.length)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null;if(i.onEnd)i.onEnd(t);if(this.onEnd)this.onEnd(t);e.mixDuration=this.data.getMix(i.animation,e.animation);if(e.mixDuration>0){e.mixTime=0;if(n&&i.mixTime/i.mixDuration<.5)e.previous=n;else e.previous=i}}this.tracks[t]=e;if(e.onStart)e.onStart(t);if(this.onStart)this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;return this.setAnimation(t,n,i)},setAnimation:function(t,e,i){var n=new spine.TrackEntry;n.animation=e;n.loop=i;n.endTime=e.duration;this.setCurrent(t,n);return n},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,i,n)},addAnimation:function(t,e,i,n){var r=new spine.TrackEntry;r.animation=e;r.loop=i;r.endTime=e.duration;var a=this._expandToIndex(t);if(a){while(a.next)a=a.next;a.next=r}else this.tracks[t]=r;if(n<=0){if(a)n+=a.endTime-this.data.getMix(a.animation,e);else n=0}r.delay=n;return r},getCurrent:function(t){if(t>=this.tracks.length)return null;return this.tracks[t]}};spine.SkeletonJson=function(t){this.attachmentLoader=t};spine.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var i=new spine.SkeletonData;i.name=e;var n=t["skeleton"];if(n){i.hash=n["hash"];i.version=n["spine"];i.width=n["width"]||0;i.height=n["height"]||0}var r=t["bones"];for(var a=0,o=r.length;a<o;a++){var s=r[a];var h=null;if(s["parent"]){h=i.findBone(s["parent"]);if(!h)throw"Parent bone not found: "+s["parent"]}var l=new spine.BoneData(s["name"],h);l.length=(s["length"]||0)*this.scale;l.x=(s["x"]||0)*this.scale;l.y=(s["y"]||0)*this.scale;l.rotation=s["rotation"]||0;l.scaleX=s.hasOwnProperty("scaleX")?s["scaleX"]:1;l.scaleY=s.hasOwnProperty("scaleY")?s["scaleY"]:1;l.inheritScale=s.hasOwnProperty("inheritScale")?s["inheritScale"]:true;l.inheritRotation=s.hasOwnProperty("inheritRotation")?s["inheritRotation"]:true;i.bones.push(l)}var u=t["ik"];if(u){for(var a=0,o=u.length;a<o;a++){var c=u[a];var p=new spine.IkConstraintData(c["name"]);var r=c["bones"];for(var f=0,m=r.length;f<m;f++){var d=i.findBone(r[f]);if(!d)throw"IK bone not found: "+r[f];p.bones.push(d)}p.target=i.findBone(c["target"]);if(!p.target)throw"Target bone not found: "+c["target"];p.bendDirection=!c.hasOwnProperty("bendPositive")||c["bendPositive"]?1:-1;p.mix=c.hasOwnProperty("mix")?c["mix"]:1;i.ikConstraints.push(p)}}var g=t["slots"];for(var a=0,o=g.length;a<o;a++){var y=g[a];var l=i.findBone(y["bone"]);if(!l)throw"Slot bone not found: "+y["bone"];var v=new spine.SlotData(y["name"],l);var _=y["color"];if(_){v.r=this.toColor(_,0);v.g=this.toColor(_,1);v.b=this.toColor(_,2);v.a=this.toColor(_,3)}v.attachmentName=y["attachment"];v.blendMode=spine.BlendMode[y["blend"]||"normal"];i.slots.push(v)}var I=t["skins"];for(var w in I){if(!I.hasOwnProperty(w))continue;var x=I[w];var S=new spine.Skin(w);for(var C in x){if(!x.hasOwnProperty(C))continue;var T=i.findSlotIndex(C);var b=x[C];for(var D in b){if(!b.hasOwnProperty(D))continue;var A=this.readAttachment(S,D,b[D]);if(A)S.addAttachment(T,D,A)}}i.skins.push(S);if(S.name=="default")i.defaultSkin=S}var E=t["events"];for(var U in E){if(!E.hasOwnProperty(U))continue;var M=E[U];var P=new spine.EventData(U);P.intValue=M["int"]||0;P.floatValue=M["float"]||0;P.stringValue=M["string"]||null;i.events.push(P)}var B=t["animations"];for(var L in B){if(!B.hasOwnProperty(L))continue;this.readAnimation(L,B[L],i)}return i},readAttachment:function(t,e,i){e=i["name"]||e;var n=spine.AttachmentType[i["type"]||"region"];var r=i["path"]||e;var a=this.scale;if(n==spine.AttachmentType.region){var o=this.attachmentLoader.newRegionAttachment(t,e,r);if(!o)return null;o.path=r;o.x=(i["x"]||0)*a;o.y=(i["y"]||0)*a;o.scaleX=i.hasOwnProperty("scaleX")?i["scaleX"]:1;o.scaleY=i.hasOwnProperty("scaleY")?i["scaleY"]:1;o.rotation=i["rotation"]||0;o.width=(i["width"]||0)*a;o.height=(i["height"]||0)*a;var s=i["color"];if(s){o.r=this.toColor(s,0);o.g=this.toColor(s,1);o.b=this.toColor(s,2);o.a=this.toColor(s,3)}o.updateOffset();return o}else if(n==spine.AttachmentType.mesh){var h=this.attachmentLoader.newMeshAttachment(t,e,r);if(!h)return null;h.path=r;h.vertices=this.getFloatArray(i,"vertices",a);h.triangles=this.getIntArray(i,"triangles");h.regionUVs=this.getFloatArray(i,"uvs",1);h.updateUVs();s=i["color"];if(s){h.r=this.toColor(s,0);h.g=this.toColor(s,1);h.b=this.toColor(s,2);h.a=this.toColor(s,3)}h.hullLength=(i["hull"]||0)*2;if(i["edges"])h.edges=this.getIntArray(i,"edges");h.width=(i["width"]||0)*a;h.height=(i["height"]||0)*a;return h}else if(n==spine.AttachmentType.skinnedmesh){var h=this.attachmentLoader.newSkinnedMeshAttachment(t,e,r);if(!h)return null;h.path=r;var l=this.getFloatArray(i,"uvs",1);var u=this.getFloatArray(i,"vertices",1);var c=[];var p=[];for(var f=0,m=u.length;f<m;){var d=u[f++]|0;p[p.length]=d;for(var g=f+d*4;f<g;){p[p.length]=u[f];c[c.length]=u[f+1]*a;c[c.length]=u[f+2]*a;c[c.length]=u[f+3];f+=4}}h.bones=p;h.weights=c;h.triangles=this.getIntArray(i,"triangles");h.regionUVs=l;h.updateUVs();s=i["color"];if(s){h.r=this.toColor(s,0);h.g=this.toColor(s,1);h.b=this.toColor(s,2);h.a=this.toColor(s,3)}h.hullLength=(i["hull"]||0)*2;if(i["edges"])h.edges=this.getIntArray(i,"edges");h.width=(i["width"]||0)*a;h.height=(i["height"]||0)*a;return h}else if(n==spine.AttachmentType.boundingbox){var y=this.attachmentLoader.newBoundingBoxAttachment(t,e);var u=i["vertices"];for(var f=0,m=u.length;f<m;f++)y.vertices.push(u[f]*a);return y}throw"Unknown attachment type: "+n},readAnimation:function(t,e,i){var n=[];var r=0;var a=e["slots"];for(var o in a){if(!a.hasOwnProperty(o))continue;var s=a[o];var h=i.findSlotIndex(o);for(var l in s){if(!s.hasOwnProperty(l))continue;var u=s[l];if(l=="color"){var c=new spine.ColorTimeline(u.length);c.slotIndex=h;var p=0;for(var f=0,m=u.length;f<m;f++){var d=u[f];var g=d["color"];var y=this.toColor(g,0);var v=this.toColor(g,1);var _=this.toColor(g,2);var I=this.toColor(g,3);c.setFrame(p,d["time"],y,v,_,I);this.readCurve(c,p,d);p++}n.push(c);r=Math.max(r,c.frames[c.getFrameCount()*5-5])}else if(l=="attachment"){var c=new spine.AttachmentTimeline(u.length);c.slotIndex=h;var p=0;for(var f=0,m=u.length;f<m;f++){var d=u[f];c.setFrame(p++,d["time"],d["name"])}n.push(c);r=Math.max(r,c.frames[c.getFrameCount()-1])}else throw"Invalid timeline type for a slot: "+l+" ("+o+")"}}var w=e["bones"];for(var x in w){if(!w.hasOwnProperty(x))continue;var S=i.findBoneIndex(x);if(S==-1)throw"Bone not found: "+x;var C=w[x];for(var l in C){if(!C.hasOwnProperty(l))continue;var u=C[l];if(l=="rotate"){var c=new spine.RotateTimeline(u.length);c.boneIndex=S;var p=0;for(var f=0,m=u.length;f<m;f++){var d=u[f];c.setFrame(p,d["time"],d["angle"]);this.readCurve(c,p,d);p++}n.push(c);r=Math.max(r,c.frames[c.getFrameCount()*2-2])}else if(l=="translate"||l=="scale"){var c;var T=1;if(l=="scale")c=new spine.ScaleTimeline(u.length);else{c=new spine.TranslateTimeline(u.length);T=this.scale}c.boneIndex=S;var p=0;for(var f=0,m=u.length;f<m;f++){var d=u[f];var b=(d["x"]||0)*T;var D=(d["y"]||0)*T;c.setFrame(p,d["time"],b,D);this.readCurve(c,p,d);p++}n.push(c);r=Math.max(r,c.frames[c.getFrameCount()*3-3])}else if(l=="flipX"||l=="flipY"){var b=l=="flipX";var c=b?new spine.FlipXTimeline(u.length):new spine.FlipYTimeline(u.length);c.boneIndex=S;var A=b?"x":"y";var p=0;for(var f=0,m=u.length;f<m;f++){var d=u[f];c.setFrame(p,d["time"],d[A]||false);p++}n.push(c);r=Math.max(r,c.frames[c.getFrameCount()*2-2])}else throw"Invalid timeline type for a bone: "+l+" ("+x+")"}}var E=e["ik"];for(var U in E){if(!E.hasOwnProperty(U))continue;var M=i.findIkConstraint(U);var u=E[U];var c=new spine.IkConstraintTimeline(u.length);c.ikConstraintIndex=i.ikConstraints.indexOf(M);var p=0;for(var f=0,m=u.length;f<m;f++){var d=u[f];var P=d.hasOwnProperty("mix")?d["mix"]:1;var B=!d.hasOwnProperty("bendPositive")||d["bendPositive"]?1:-1;c.setFrame(p,d["time"],P,B);this.readCurve(c,p,d);p++}n.push(c);r=Math.max(r,c.frames[c.getFrameCount()*3-3])}var L=e["ffd"];for(var R in L){var O=i.findSkin(R);var s=L[R];for(o in s){var h=i.findSlotIndex(o);var V=s[o];for(var W in V){var u=V[W];var c=new spine.FfdTimeline(u.length);var F=O.getAttachment(h,W);if(!F)throw"FFD attachment not found: "+W;c.slotIndex=h;c.attachment=F;var N=F.type==spine.AttachmentType.mesh;var k;if(N)k=F.vertices.length;else k=F.weights.length/3*2;var p=0;for(var f=0,m=u.length;f<m;f++){var d=u[f];var G;if(!d["vertices"]){if(N)G=F.vertices;else{G=[];G.length=k}}else{var H=d["vertices"];var G=[];G.length=k;var Y=d["offset"]||0;var J=H.length;if(this.scale==1){for(var X=0;X<J;X++)G[X+Y]=H[X]}else{for(var X=0;X<J;X++)G[X+Y]=H[X]*this.scale}if(N){var z=F.vertices;for(var X=0,J=G.length;X<J;X++)G[X]+=z[X]}}c.setFrame(p,d["time"],G);this.readCurve(c,p,d);p++}n[n.length]=c;r=Math.max(r,c.frames[c.getFrameCount()-1])}}}var K=e["drawOrder"];if(!K)K=e["draworder"];if(K){var c=new spine.DrawOrderTimeline(K.length);var j=i.slots.length;var p=0;for(var f=0,m=K.length;f<m;f++){var q=K[f];var Z=null;if(q["offsets"]){Z=[];Z.length=j;for(var X=j-1;X>=0;X--)Z[X]=-1;var Q=q["offsets"];var $=[];$.length=j-Q.length;var tt=0,et=0;for(var X=0,J=Q.length;X<J;X++){var it=Q[X];var h=i.findSlotIndex(it["slot"]);if(h==-1)throw"Slot not found: "+it["slot"];while(tt!=h)$[et++]=tt++;Z[tt+it["offset"]]=tt++}while(tt<j)$[et++]=tt++;for(var X=j-1;X>=0;X--)if(Z[X]==-1)Z[X]=$[--et]}c.setFrame(p++,q["time"],Z)}n.push(c);r=Math.max(r,c.frames[c.getFrameCount()-1])}var nt=e["events"];if(nt){var c=new spine.EventTimeline(nt.length);var p=0;for(var f=0,m=nt.length;f<m;f++){var rt=nt[f];var at=i.findEvent(rt["name"]);if(!at)throw"Event not found: "+rt["name"];var ot=new spine.Event(at);ot.intValue=rt.hasOwnProperty("int")?rt["int"]:at.intValue;ot.floatValue=rt.hasOwnProperty("float")?rt["float"]:at.floatValue;ot.stringValue=rt.hasOwnProperty("string")?rt["string"]:at.stringValue;c.setFrame(p++,rt["time"],ot)}n.push(c);r=Math.max(r,c.frames[c.getFrameCount()-1])}i.animations.push(new spine.Animation(t,n,r))},readCurve:function(t,e,i){var n=i["curve"];if(!n)t.curves.setLinear(e);else if(n=="stepped")t.curves.setStepped(e);else if(n instanceof Array)t.curves.setCurve(e,n[0],n[1],n[2],n[3])},toColor:function(t,e){if(t.length!=8)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(e*2,e*2+2),16)/255},getFloatArray:function(t,e,i){var n=t[e];var r=new spine.Float32Array(n.length);var a=0,o=n.length;if(i==1){for(;a<o;a++)r[a]=n[a]}else{for(;a<o;a++)r[a]=n[a]*i}return r},getIntArray:function(t,e){var i=t[e];var n=new spine.Uint16Array(i.length);for(var r=0,a=i.length;r<a;r++)n[r]=i[r]|0;return n}};spine.Atlas=function(t,e){this.textureLoader=e;this.pages=[];this.regions=[];var i=new spine.AtlasReader(t);var n=[];n.length=4;var r=null;while(true){var a=i.readLine();if(a===null)break;a=i.trim(a);if(!a.length)r=null;else if(!r){r=new spine.AtlasPage;r.name=a;if(i.readTuple(n)==2){r.width=parseInt(n[0]);r.height=parseInt(n[1]);i.readTuple(n)}r.format=spine.Atlas.Format[n[0]];i.readTuple(n);r.minFilter=spine.Atlas.TextureFilter[n[0]];r.magFilter=spine.Atlas.TextureFilter[n[1]];var o=i.readValue();r.uWrap=spine.Atlas.TextureWrap.clampToEdge;r.vWrap=spine.Atlas.TextureWrap.clampToEdge;if(o=="x")r.uWrap=spine.Atlas.TextureWrap.repeat;else if(o=="y")r.vWrap=spine.Atlas.TextureWrap.repeat;else if(o=="xy")r.uWrap=r.vWrap=spine.Atlas.TextureWrap.repeat;e.load(r,a,this);this.pages.push(r)}else{var s=new spine.AtlasRegion;s.name=a;s.page=r;s.rotate=i.readValue()=="true";i.readTuple(n);var h=parseInt(n[0]);var l=parseInt(n[1]);i.readTuple(n);var u=parseInt(n[0]);var c=parseInt(n[1]);s.u=h/r.width;s.v=l/r.height;if(s.rotate){s.u2=(h+c)/r.width;s.v2=(l+u)/r.height}else{s.u2=(h+u)/r.width;s.v2=(l+c)/r.height}s.x=h;s.y=l;s.width=Math.abs(u);s.height=Math.abs(c);if(i.readTuple(n)==4){s.splits=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];if(i.readTuple(n)==4){s.pads=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];i.readTuple(n)}}s.originalWidth=parseInt(n[0]);s.originalHeight=parseInt(n[1]);i.readTuple(n);s.offsetX=parseInt(n[0]);s.offsetY=parseInt(n[1]);s.index=parseInt(i.readValue());this.regions.push(s)}}};spine.Atlas.prototype={findRegion:function(t){var e=this.regions;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},dispose:function(){var t=this.pages;for(var e=0,i=t.length;e<i;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){var e=this.regions;for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.page!=t)continue;r.u=r.x/t.width;r.v=r.y/t.height;if(r.rotate){r.u2=(r.x+r.height)/t.width;r.v2=(r.y+r.width)/t.height}else{r.u2=(r.x+r.width)/t.width;r.v2=(r.y+r.height)/t.height}}}};spine.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};spine.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};spine.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};spine.AtlasPage=function(){};spine.AtlasPage.prototype={name:null,format:null,minFilter:null,
magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};spine.AtlasRegion=function(){};spine.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:false,splits:null,pads:null};spine.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)};spine.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){if(this.index>=this.lines.length)return null;return this.lines[this.index++]},readValue:function(){var t=this.readLine();var e=t.indexOf(":");if(e==-1)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine();var i=e.indexOf(":");if(i==-1)throw"Invalid line: "+e;var n=0,r=i+1;for(;n<3;n++){var a=e.indexOf(",",r);if(a==-1)break;t[n]=this.trim(e.substr(r,a-r));r=a+1}t[n]=this.trim(e.substring(r));return n+1}};spine.AtlasAttachmentLoader=function(t){this.atlas=t};spine.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw"Region not found in atlas: "+i+" (region attachment: "+e+")";var r=new spine.RegionAttachment(e);r.rendererObject=n;r.setUVs(n.u,n.v,n.u2,n.v2,n.rotate);r.regionOffsetX=n.offsetX;r.regionOffsetY=n.offsetY;r.regionWidth=n.width;r.regionHeight=n.height;r.regionOriginalWidth=n.originalWidth;r.regionOriginalHeight=n.originalHeight;return r},newMeshAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw"Region not found in atlas: "+i+" (mesh attachment: "+e+")";var r=new spine.MeshAttachment(e);r.rendererObject=n;r.regionU=n.u;r.regionV=n.v;r.regionU2=n.u2;r.regionV2=n.v2;r.regionRotate=n.rotate;r.regionOffsetX=n.offsetX;r.regionOffsetY=n.offsetY;r.regionWidth=n.width;r.regionHeight=n.height;r.regionOriginalWidth=n.originalWidth;r.regionOriginalHeight=n.originalHeight;return r},newSkinnedMeshAttachment:function(t,e,i){var n=this.atlas.findRegion(i);if(!n)throw"Region not found in atlas: "+i+" (skinned mesh attachment: "+e+")";var r=new spine.SkinnedMeshAttachment(e);r.rendererObject=n;r.regionU=n.u;r.regionV=n.v;r.regionU2=n.u2;r.regionV2=n.v2;r.regionRotate=n.rotate;r.regionOffsetX=n.offsetX;r.regionOffsetY=n.offsetY;r.regionWidth=n.width;r.regionHeight=n.height;r.regionOriginalWidth=n.originalWidth;r.regionOriginalHeight=n.originalHeight;return r},newBoundingBoxAttachment:function(t,e){return new spine.BoundingBoxAttachment(e)}};spine.SkeletonBounds=function(){this.polygonPool=[];this.polygons=[];this.boundingBoxes=[]};spine.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var i=t.slots;var n=i.length;var r=t.x,a=t.y;var o=this.boundingBoxes;var s=this.polygonPool;var h=this.polygons;o.length=0;for(var l=0,u=h.length;l<u;l++)s.push(h[l]);h.length=0;for(var l=0;l<n;l++){var c=i[l];var p=c.attachment;if(p.type!=spine.AttachmentType.boundingbox)continue;o.push(p);var f=s.length,m;if(f>0){m=s[f-1];s.splice(f-1,1)}else m=[];h.push(m);m.length=p.vertices.length;p.computeWorldVertices(r,a,c.bone,m)}if(e)this.aabbCompute()},aabbCompute:function(){var t=this.polygons;var e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE;for(var a=0,o=t.length;a<o;a++){var s=t[a];for(var h=0,l=s.length;h<l;h+=2){var u=s[h];var c=s[h+1];e=Math.min(e,u);i=Math.min(i,c);n=Math.max(n,u);r=Math.max(r,c)}}this.minX=e;this.minY=i;this.maxX=n;this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,a=this.minY,o=this.maxX,s=this.maxY;if(t<=r&&i<=r||e<=a&&n<=a||t>=o&&i>=o||e>=s&&n>=s)return false;var h=(n-e)/(i-t);var l=h*(r-t)+e;if(l>a&&l<s)return true;l=h*(o-t)+e;if(l>a&&l<s)return true;var u=(a-e)/h+t;if(u>r&&u<o)return true;u=(s-e)/h+t;if(u>r&&u<o)return true;return false},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){var i=this.polygons;for(var n=0,r=i.length;n<r;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){var r=this.polygons;for(var a=0,o=r.length;a<o;a++)if(r[a].intersectsSegment(t,e,i,n))return this.boundingBoxes[a];return null},polygonContainsPoint:function(t,e,i){var n=t.length;var r=n-2;var a=false;for(var o=0;o<n;o+=2){var s=t[o+1];var h=t[r+1];if(s<i&&h>=i||h<i&&s>=i){var l=t[o];if(l+(i-s)/(h-s)*(t[r]-l)<e)a=!a}r=o}return a},polygonIntersectsSegment:function(t,e,i,n,r){var a=t.length;var o=e-n,s=i-r;var h=e*r-i*n;var l=t[a-2],u=t[a-1];for(var c=0;c<a;c+=2){var p=t[c],f=t[c+1];var m=l*f-u*p;var d=l-p,g=u-f;var y=o*g-s*d;var v=(h*d-o*m)/y;if((v>=l&&v<=p||v>=p&&v<=l)&&(v>=e&&v<=n||v>=n&&v<=e)){var _=(h*g-s*m)/y;if((_>=u&&_<=f||_>=f&&_<=u)&&(_>=i&&_<=r||_>=r&&_<=i))return true}l=p;u=f}return false},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return e==-1?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};function UISpine(){}UISpine.prototype=new UISkeletonAnimation;UISpine.prototype.initUISpine=UISkeletonAnimation.prototype.initUISkeletonAnimation;UISpine.prototype.play=UISpine.prototype.gotoAndPlay=function(t,e,i,n,r){var a=this;this.animationName=t;if(this.spineState){var o=this.spineState.setAnimationByName(0,t,true,0);o.repeatTimes=e?e:4294967295;o.onComplete=function(t,e){this.repeatTimes--;if(this.repeatTimes<=0){this.loop=false;if(n){n.call(a)}if(i){i.call(a)}}else{if(n){n.call(a)}}}}return this};UISpine.prototype.pause=function(){if(this.spineState){this.spineState.timeScale=0}return this};UISpine.prototype.resume=function(){if(this.spineState){this.spineState.timeScale=1}return this};UISpine.prototype.createSkeletonJsonFronAtlas=function(t,e){var i=this.textureJsonURL+"#";var n={};n.load=function(e,i,n){e.rendererObject=t};n.unload=function(t){};var r=new spine.Atlas(e,n);var a=new spine.AtlasAttachmentLoader(r);var o=new spine.SkeletonJson(a);return o};UISpine.prototype.createSkeletonJsonFronJson=function(t,e){var i=this.textureJsonURL+"#";var n=new spine.SkeletonJson({newRegionAttachment:function(t,e,n){var r=i+n+".png";var a=new spine.RegionAttachment(e);a.rendererObject=WImage.create(r);return a},newMeshAttachment:function(t,e,n){var r=i+n+".png";var a=new spine.MeshAttachment(e);a.rendererObject=WImage.create(r);return a},newSkinnedMeshAttachment:function(t,e,n){var r=i+n+".png";var a=new spine.SkinnedMeshAttachment(e);a.rendererObject=WImage.create(r);return a},newBoundingBoxAttachment:function(t,e){return new spine.BoundingBoxAttachment(e)}});return n};UISpine.prototype.createSkeletonJson=function(t,e){if(this.textureJsonURL.indexOf(".atlas")>0){return this.createSkeletonJsonFronAtlas(t,e)}else{return this.createSkeletonJsonFronJson(t,e)}};UISpine.prototype.createArmature=function(t,e,i,n){var r=this.createSkeletonJson(t,e);r.scale=1;this.skeletonData=r.readSkeletonData(i);spine.Bone.yDown=true;this.skeleton=new spine.Skeleton(this.skeletonData);var a=new spine.AnimationStateData(this.skeletonData);var o=new spine.AnimationState(a);this.animationNames=[];var s=this.skeletonData.animations;for(var h=0;h<s.length;h++){this.animationNames.push(s[h].name)}if(!this.animationName||this.animationNames.indexOf(this.animationName)<0){this.animationName=this.animationNames[0]}o.setAnimationByName(0,this.animationName,true,0);this.spineState=o;this.callOnLoadDoneHandler();return};UISpine.prototype.update=function(t){var e=t.now?t.now:Date.now();var i=(e-this.lastTime)/1e3;this.lastTime=e;this.spineState.update(i*UIElement.timeScale);this.spineState.apply(this.skeleton);this.skeleton.updateWorldTransform()};UISpine.prototype.paintSelfOnly=function(t){if(!this.skeleton){return}var e=this.h;var i=this.w>>1;var n=this.animationScale;var r=this.skeleton,a=r.drawOrder;this.update(t);t.translate(i,e);t.scale(n,n);for(var o=0,s=a.length;o<s;o++){var h=a[o];var l=h.attachment;if(!(l instanceof spine.RegionAttachment))continue;var u=l.rendererObject;if(u.page){var c={x:u.x,y:u.y,w:u.width,h:u.height,rotate:u.rotate};var p=u.page.rendererObject}else{var f=u;if(!WImage.isValid(f)){continue}var c=f.getImageRect();var p=f.getImage()}var m=h.bone;var d=m.worldX+l.x*m.m00+l.y*m.m01;var g=m.worldY+l.x*m.m10+l.y*m.m11;var y=-(m.worldRotation+l.rotation)*Math.PI/180;var v=l.width*m.worldScaleX,_=l.height*m.worldScaleY;var I=v>>1;var w=_>>1;if(c.rotate){y+=Math.PI*.5}t.translate(d,g);t.rotate(y);if(c.rotate){t.drawImage(p,c.x,c.y,c.h,c.w,-w,-I,_,v)}else{t.drawImage(p,c.x,c.y,c.w,c.h,-I,-w,v,_)}t.rotate(-y);t.translate(-d,-g)}t.needRedraw++;return};function UISpineCreator(){var t=["ui-spine","ui-spine",null,true];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISpine;return e.initUISpine(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISpineCreator);function UILineJoint(){return}UILineJoint.prototype=new UITwoJoint;UILineJoint.prototype.isUIJoint=true;UILineJoint.prototype.isUILineJoint=true;UILineJoint.prototype.initUILineJoint=function(t,e,i){this.initUITwoJoint(t,e,i);return this};function UILineJointCreator(){var t=["ui-line-joint","ui-line-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UILineJoint;return e.initUILineJoint(this.type,200,200)};return}function UITwoJoint(){return}UITwoJoint.prototype=new UITwoPoints;UITwoJoint.prototype.isUIJoint=true;UITwoJoint.prototype.isUITwoJoint=true;UITwoJoint.prototype.initUITwoJoint=function(t,e,i){this.initUITwoPoints(t);return this};function UITwoJointCreator(){var t=["ui-two-joint","ui-two-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITwoJoint;return e.initUITwoJoint(this.type,200,200)};return}function UIDragger(){return}UIDragger.prototype=new UIElement;UIDragger.prototype.isUIDragger=true;UIDragger.prototype.initUIDragger=function(t,e,i){this.initUIElement(t,e,i);this.enableVer=true;this.enableHor=true;return this};UIDragger.prototype.onInit=function(){var t=this.getParent();var e=this.enableHor;var i=this.enableVer;if(t.physicsShape||t.isUIPhysicsShape||t.isUIImage){t.handlePointerDown=function(e){return UIDragger.handleSpritePointerDown(t,e)};t.handlePointerMove=function(n){return UIDragger.handleSpritePointerMove(t,n,i,e)};t.handlePointerUp=function(t){}}};UIDragger.handleSpritePointerDown=function(t,e){t.saveX=t.x;t.saveY=t.y;return};UIDragger.handleSpritePointerMove=function(t,e,i,n){if(t.pointerDown){var r=t.getMoveAbsDeltaX();var a=n?t.saveX+r:t.saveX;var o=t.getMoveAbsDeltaY();var s=i?t.saveY+o:t.saveY;t.setPosition(a,s)}return};function UIDraggerCreator(){var t=["ui-dragger","ui-dragger",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIDragger;return e.initUIDragger(this.type,20,20,null)};return}ShapeFactoryGet().addShapeCreator(new UIDraggerCreator);function UIFootprint(){return}UIFootprint.prototype=new UIElement;UIFootprint.prototype.isUIFootprint=true;UIFootprint.prototype.initUIFootprint=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);return this};UIFootprint.prototype.paintSelfOnly=function(t){if(this.mode===Shape.MODE_EDITING){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){var i=this.w>>1;var n=this.h>>1;t.arc(i,n,10,0,2*Math.PI);t.fill()}}return};UIFootprint.prototype.shapeCanBeChild=function(t){return false};function UIFootprintCreator(){var t=["ui-foot-print","ui-foot-print",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFootprint;return e.initUIFootprint(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIFootprintCreator);function UITransformAnimation(){return}UITransformAnimation.prototype=new UISprite;UITransformAnimation.prototype.isUITransformAnimation=true;UITransformAnimation.prototype.initUITransformAnimation=function(t,e,i,n){this.initUISprite(t,e,i,n);this.animationConfig={};this.animationConfig.opacityFrom=1;this.animationConfig.opacityTo=1;this.animationConfig.scaleXFrom=1;this.animationConfig.scaleXTo=1;this.animationConfig.scaleYFrom=1;this.animationConfig.scaleYTo=1;this.animationConfig.rotationFrom=0;this.animationConfig.rotationTo=0;this.animationConfig.offsetXFrom=0;this.animationConfig.offsetXTo=0;this.animationConfig.offsetYFrom=0;this.animationConfig.offsetYTo=0;this.animationConfig.frequency=2;this.animationConfig.random=1e3*Math.random();this.regSerializer(this.taToJson,this.taFromJson);return this};UITransformAnimation.prototype.pause=function(){if(this.highlightConfig){this.highlightConfig.paused=true}return this};UITransformAnimation.prototype.resume=function(){if(this.highlightConfig){this.highlightConfig.paused=false}return this};UITransformAnimation.prototype.play=function(){this.setHighlightConfig(this.animationConfig);return};UITransformAnimation.prototype.stop=function(){this.setHighlightConfig(null);return};UITransformAnimation.prototype.getScaleXFrom=function(){return this.animationConfig.scaleXFrom};UITransformAnimation.prototype.setScaleXFrom=function(t){this.animationConfig.scaleXFrom=t;return this};UITransformAnimation.prototype.getScaleXTo=function(){return this.animationConfig.scaleXTo};UITransformAnimation.prototype.setScaleXTo=function(t){this.animationConfig.scaleXTo=t;return this};UITransformAnimation.prototype.getScaleYFrom=function(){return this.animationConfig.scaleYFrom};UITransformAnimation.prototype.setScaleYFrom=function(t){this.animationConfig.scaleYFrom=t;return this};UITransformAnimation.prototype.getScaleYTo=function(){return this.animationConfig.scaleYTo};UITransformAnimation.prototype.setScaleYTo=function(t){this.animationConfig.scaleYTo=t;return this};UITransformAnimation.RADIAN_TO_ANGLE=180/Math.PI;UITransformAnimation.prototype.getRotationFrom=function(){return this.animationConfig.rotationFrom*UITransformAnimation.RADIAN_TO_ANGLE};UITransformAnimation.prototype.setRotationFrom=function(t){this.animationConfig.rotationFrom=t/UITransformAnimation.RADIAN_TO_ANGLE;return this};UITransformAnimation.prototype.getRotationTo=function(){return this.animationConfig.rotationTo*UITransformAnimation.RADIAN_TO_ANGLE};UITransformAnimation.prototype.setRotationTo=function(t){this.animationConfig.rotationTo=t/UITransformAnimation.RADIAN_TO_ANGLE;return this};UITransformAnimation.prototype.getOpacityFrom=function(){return this.animationConfig.opacityFrom};UITransformAnimation.prototype.setOpacityFrom=function(t){this.animationConfig.opacityFrom=t;return this};UITransformAnimation.prototype.getOpacityTo=function(){return this.animationConfig.opacityTo};UITransformAnimation.prototype.setOpacityTo=function(t){this.animationConfig.opacityTo=t;return this};UITransformAnimation.prototype.getXFrom=function(){return this.animationConfig.offsetXFrom};UITransformAnimation.prototype.setXFrom=function(t){this.animationConfig.offsetXFrom=t;return this};UITransformAnimation.prototype.getXTo=function(){return this.animationConfig.offsetXTo};UITransformAnimation.prototype.setXTo=function(t){this.animationConfig.offsetXTo=t;return this};UITransformAnimation.prototype.getYFrom=function(){return this.animationConfig.offsetYFrom};UITransformAnimation.prototype.setYFrom=function(t){this.animationConfig.offsetYFrom=t;return this};UITransformAnimation.prototype.getYTo=function(){return this.animationConfig.offsetYTo};UITransformAnimation.prototype.setYTo=function(t){this.animationConfig.offsetYTo=t;return this};UITransformAnimation.prototype.getFrequency=function(){return this.animationConfig.frequency};UITransformAnimation.prototype.setFrequency=function(t){this.animationConfig.frequency=t;return this};UITransformAnimation.prototype.getRandom=function(){return this.animationConfig.random};UITransformAnimation.prototype.setRandom=function(t){this.animationConfig.random=t%1e3;return this};UITransformAnimation.prototype.taFromJson=function(t){if(t.animationConfig){this.animationConfig=JSON.parse(JSON.stringify(t.animationConfig))}return};UITransformAnimation.prototype.taToJson=function(t){t.animationConfig=JSON.parse(JSON.stringify(this.animationConfig));return t};UITransformAnimation.prototype.beforePaintChildren=function(t){this.applyTransform(t);return this};UITransformAnimation.prototype.onInit=function(){this.play();return};function UITransformAnimationCreator(){var t=["ui-transform-animation","ui-transform-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITransformAnimation;return e.initUITransformAnimation(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UITransformAnimationCreator);function UIScene(){return}UIScene.prototype=new UINormalWindow;UIScene.prototype.isUIScene=true;UIScene.prototype.initUIScene=function(t,e,i,n){this.initUIWindow(t,0,0,e,i,n);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.xOffset=0;this.yOffset=0;this.virtualWidth=0;this.virtualHeight=0;this.autoClearForce=true;this.setAnimHint("none");this.setCanRectSelectable(false,true);this.addEventNames(["onPointerDown","onPointerMove","onPointerUp","onDoubleClick"]);this.addEventNames(["onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown"]);this.setImage(UIElement.IMAGE_TIPS1,null);this.setImage(UIElement.IMAGE_TIPS2,null);this.setImage(UIElement.IMAGE_TIPS3,null);this.setImage(UIElement.IMAGE_TIPS4,null);this.setImage(UIElement.IMAGE_TIPS5,null);this.setCameraFollowParams(.5,.5,.5,.5);return this};UIScene.prototype.resetGame=function(){if(this.world){var t=this.world;Physics.destroyWorld(t);this.world=null}this.restoreState();this.relayout();this.initStageOne();this.doInit();this.initChildren();this.updateStickyChildren();return};UIScene.prototype.addStickyChild=function(t){if(t.parentShape!==this||t.x>=this.w||t.y>=this.h){console.log("%cWarning: invalid params to addStickyChild.","color: red; font-weight: bold");return this}t.orgX=t.x;t.orgY=t.y;this.stickyChildren.push(t);return this};UIScene.prototype.removeStickyChild=function(t){this.stickyChildren.remove(t);return this};UIScene.prototype.updateStickyChildren=function(){this.stickyChildren=[];var t=this.children;for(var e=0;e<t.length;e++){var i=t[e];if(i.sticky){if(i.orgX===undefined){i.orgX=i.x}if(i.orgY===undefined){i.orgY=i.y}this.stickyChildren.push(i)}}return this};UIScene.prototype.doInit=function(){this.xOffset=0;this.yOffset=0;this.setTimeScale(1);if(this.enablePhysics){Physics.createWorld(this);if(this.world&&this.map){this.map.createBodies(this.world)}}if(this.gameName){document.title=this.gameName}return};UIScene.prototype.onOpen=function(t){this.doInit();this.play();return};UIScene.prototype.onInit=function(){var t=this;this.initStageOne();this.updateStickyChildren();setTimeout(function(){WWindowManager.getInstance().showFPS(t.showFPS);WWindowManager.getInstance().setMaxFPSMode(t.maxFPSMode)},1e3);return};UIScene.prototype.onDeinit=function(){if(this.world){var t=this.world;Physics.destroyWorld(t);this.world=null}this.stop();return};UIScene.prototype.getVirtualWidth=function(){if(this.virtualWidth<this.w){return this.w}return this.virtualWidth};UIScene.prototype.getVirtualHeight=function(){if(this.virtualHeight<this.h){return this.h}return this.virtualHeight};UIScene.prototype.onScrolled=function(){var t=this.stickyChildren;if(t&&t.length){var e=this.xOffset;var i=this.yOffset;for(var n=0;n<t.length;n++){var r=t[n];var a=r.orgX+e;var o=r.orgY+i;r.setPosition(a,o)}}return};UIScene.prototype.setOffset=function(t,e){if(t||t===0){var i=this.getVirtualWidth()-this.w;var n=Math.max(0,t);if(n>i){n=i}this.xOffset=n}if(e||e===0){var i=this.getVirtualHeight()-this.h;var r=Math.max(0,e);if(r>i){r=i}this.yOffset=r}this.onScrolled();return};UIScene.prototype.getRelayoutWidth=function(){return this.getVirtualWidth()};UIScene.prototype.getRelayoutHeight=function(){return this.getVirtualHeight()};UIScene.prototype.defaultPaintChildren=function(t){var e=this.xOffset;var i=this.yOffset;var n=this.xOffset+this.w;var r=this.yOffset+this.h;var a=0;var o=this.children;var s=this.children.length;for(var h=0;h<s;h++){var l=o[h];if(!l){continue}var u=false;if(!l.rotation){if(l.x>n||l.y>r||l.x+l.w<e||l.y+l.h<i){u=true}}else{var c=Math.max(l.w,l.h);if(l.x-c>n||l.y-c>r||l.x+c<e||l.y+c<i){u=true}}if(!l.visible||u){if(l.isAnimating()){l.stepAnimation(t)}continue}l.paintSelf(t)}this.paintTargetShape(t);return};UIScene.prototype.setMap=function(t){this.map=t;if(t){var e=t.getMapWidth();var i=t.getMapHeight();if(e>this.w){this.virtualWidth=e}if(i>this.h){this.virtualHeight=i}this.setOffset(0,0)}return this};UIScene.prototype.getMap=function(){return this.map};UIScene.prototype.drawBgImage=function(t){if(this.map){var e=this.xOffset;var i=this.yOffset;var n={x:e,y:i,w:this.w,h:this.h};t.translate(-e,-i);this.map.draw(t,n);t.translate(e,i);return}var r=this.getBgImage();if(r&&r.getImage()){var a=r.getImage();var o=r.getImageRect();var s=this.images.display;if(s===UIElement.IMAGE_DISPLAY_TILE_V){this.drawBgImageVTile(t,a,o)}else if(s===UIElement.IMAGE_DISPLAY_TILE_H){this.drawBgImageHTile(t,a,o)}else{this.drawImageAt(t,a,s,0,0,this.w,this.h,o)}return}};UIScene.prototype.drawBgImageVTile=function(t,e,i){var n=this.w;var r=this.h;var a=i.w;var o=i.h;var s=n/a;var h=0;var l=i.x;var u=i.y+this.yOffset%o;var c=Math.min(o-u,r/s);for(var h=0;h<r;){var p=c*s;t.drawImage(e,l,u,a,c,0,h,n,p);h+=p;c=Math.min(o,(r-h)/s);u=i.y}};UIScene.prototype.drawBgImageHTile=function(t,e,i){var n=this.w;var r=this.h;var a=i.w;var o=i.h;var s=r/o;var h=0;var l=i.y;var u=i.x+this.xOffset%a;var c=Math.min(a-u,n/s);for(var h=0;h<n;){var p=c*s;t.drawImage(e,u,l,c,o,h,0,p,r);h+=p;c=Math.min(a,(n-h)/s);u=i.x}return};UIScene.prototype.showTrace=function(t,e,i,n){if(!t||!e){this.traceInfo=null}if(!i){i={}}if(!n){n={};n.x=0;n.y=0}var r={};r.sx=t.x;r.sy=t.y;r.vX=this.toPixel(e.x);r.vY=this.toPixel(e.y);r.dampingX=this.toPixel(n.x);r.dampingY=this.toPixel(n.y);r.lineColor=i.lineColor?i.lineColor:"Black";r.lineWidth=i.lineWidth?i.lineWidth:2;r.deltaT=.02;r.points=[];this.traceInfo=r;this.computeTrace(r);return this};UIScene.prototype.computeTrace=function(t){var e=t.sx;var i=t.sy;var n=e;var r=i;var a=t.vX;var o=t.vY;var s=this.toPixel(this.gravityX?this.gravityX:0);var h=this.toPixel(this.gravityY?this.gravityY:0);var l=t.deltaT;var u=Math.max(Math.max(a,o),Math.max(s,h));var c=this.yOffset;var p=c+this.h;var f=this.xOffset;var m=f+this.w;t.points.push({x:e,y:i});for(var d=0;d<50;d++){var g=l*d;e=Math.round(n+a*g+.5*s*g*g);i=Math.round(r+o*g+.5*h*g*g);t.points.push({x:e,y:i});if(e<f||e>m||i<c||i>p)break}return this};UIScene.prototype.drawTrace=function(t){var e=this.traceInfo;if(!e)return;t.beginPath();t.lineWidth=e.lineWidth;t.strokeStyle=e.lineColor;var i=e.points.length;for(var n=0;n<i;n++){var r=e.points[n];if(n%2){t.moveTo(r.x,r.y)}else{t.lineTo(r.x,r.y)}}t.stroke();return this};UIScene.prototype.afterPaintChildren=function(t){if(this.mode!==Shape.MODE_EDITING){this.drawTrace(t);this.drawTipsImage(t)}if(!this.selected||this.mode!==Shape.MODE_EDITING){return}var e=10;var i=this.w;var n=this.h;var r="";var a=i>>1;var o=this.getVirtualWidth();var s=this.getVirtualHeight();if(this.xOffset){r="XOffset:"+this.xOffset}if(this.yOffset){r+=" YOffset:"+this.yOffset}if(r){t.font="16pt Sans";t.textBaseline="top";t.textAlign="center";t.fillStyle="#202020";t.fillText(r,a,e)}if(!this.pointerDown){return}if(o===i&&s===n){return}var h=20;var l=t.globalAlpha;t.fillStyle=this.style.lineColor;if(o>i){var e=n-h;var u=i*(i/o);var a=i*(this.xOffset/o);t.globalAlpha=.2;t.fillRect(0,e,i,h);t.globalAlpha=.5;t.fillRect(a,e,u,h)}if(s>n){var a=i-h;var c=n*(n/s);var e=n*(this.yOffset/s);t.globalAlpha=.2;t.fillRect(a,0,h,n);t.globalAlpha=.5;t.fillRect(a,e,h,c)}t.globalAlpha=l;return};UIScene.prototype.paintChildren=function(t){t.save();t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();t.translate(-this.xOffset,-this.yOffset);this.defaultPaintChildren(t);t.restore();if(this.popupWindow){this.popupWindow.paintSelf(t)}return};UIScene.prototype.setTipsImage=function(t,e){this.tipsImageIndex=t;this.tipsImageDisplay=e;return this};UIScene.prototype.drawTipsImage=function(t){if(!this.tipsImageIndex){return}var e="tips_img_"+this.tipsImageIndex;var i=this.images[e];if(i){var n=i.getImage();if(n){var r=i.getImageRect();var a=this.tipsImageDisplay;if(!a&&a!==0){a=this.w<this.h?UIElement.IMAGE_DISPLAY_FIT_WIDTH:UIElement.IMAGE_DISPLAY_FIT_HEIGHT}this.drawImageAt(t,n,a,0,0,this.w,this.h,r)}}return};UIScene.prototype.onPointerMoveEditing=function(t,e){if(!this.pointerDown||e||this.targetShape){return}var i=this.getVirtualWidth();var n=this.getVirtualHeight();if(i===this.w&&n===this.h){return}var r=this.getMoveDeltaX();var a=this.getMoveDeltaY();var o=this.xOffset-r;var s=this.yOffset-a;if(o<0){o=0}if(s<0){s=0}if(o+this.w>i){o=i-this.w}if(s+this.h>n){s=n-this.h}this.xOffset=o;this.yOffset=s;return};UIScene.prototype.fixChildSize=function(t){return};UIScene.prototype.fixChildPosition=function(t){return};UIScene.prototype.afterRelayoutChild=function(t){var e=this.getVirtualWidth();var i=this.getVirtualHeight();if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.x=0;t.w=e}else if(t.widthAttr===UIElement.WIDTH_FILL_AVAILABLE){t.w=e-t.x}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.y=0;t.h=i}else if(t.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){t.h=i-t.y}return};UIScene.prototype.afterChildAppended=function(t){if(this.mode===Shape.MODE_EDITING||!this.world){return}Physics.createBodyForElement(this.world,this,t)};UIScene.prototype.afterChildRemoved=function(t){if(this.map===t){this.map=null}if(this.mode===Shape.MODE_EDITING||!this.world){return}Physics.destroyBodyForElement(this.world,t);this.postRedraw();return};UIScene.prototype.translatePoint=function(t){if(this.popupWindow){return t}else{var e={x:t.x-this.x+this.xOffset,y:t.y-this.y+this.yOffset};return e}};UIScene.prototype.isPlaying=function(){return this.playing&&this.mode!=Shape.MODE_EDITING};UIScene.prototype.replay=function(){this.resetGame();this.play();return};UIScene.pauseElement=function(t){if(t.isUISkeletonAnimation||t.isUITimer||t.isUIFrameAnimation||t.isUITransformAnimation){t.pause()}for(var e=0;e<t.children.length;e++){var i=t.children[e];UIScene.pauseElement(i)}return};UIScene.prototype.pause=function(){this.playing=false;UIScene.pauseElement(this);return this};UIScene.resumeElement=function(t){if(t.isUISkeletonAnimation||t.isUITimer||t.isUIFrameAnimation||t.isUITransformAnimation){t.resume()}for(var e=0;e<t.children.length;e++){var i=t.children[e];UIScene.resumeElement(i)}return};UIScene.prototype.resume=function(){this.playing=true;UIScene.resumeElement(this);return this};UIScene.prototype.play=function(){this.playing=true;return};UIScene.prototype.stop=function(){this.playing=false;return};UIScene.prototype.toMeter=function(t){var e=this.pixelsPerMeter?this.pixelsPerMeter:10;return t/e};UIScene.prototype.toPixel=function(t){var e=this.pixelsPerMeter?this.pixelsPerMeter:10;return Math.round(t*e)};UIScene.prototype.getFPS=function(){return this.fps?this.fps:30};UIScene.prototype.setFPS=function(t){this.fps=Math.max(5,Math.min(50,t));return this};UIScene.prototype.setVelocityIterations=function(t){this.velocityIterations=t;return this};UIScene.prototype.setPositionIterations=function(t){this.positionIterations=t;return this};UIScene.prototype.setAutoClearForce=function(t){this.autoClearForce=t;return this};UIScene.prototype.setCameraFollowParams=function(t,e,i,n){this.cameraFollowParams={};this.cameraFollowParams.xMin=t;this.cameraFollowParams.xMax=e;this.cameraFollowParams.yMin=i;this.cameraFollowParams.yMax=n;return this};UIScene.prototype.cameraFollow=function(t){var e=this.w;var i=this.h;var n=t.x;var r=t.y;var a=n-this.xOffset;var o=r-this.yOffset;var s=this.cameraFollowParams;var h=this.xOffset;if(a>s.xMax*e){h=Math.round(n-s.xMax*e)+(t.w>>1)}else if(a<s.xMin*e){h=Math.round(n-s.xMin*e)+(t.w>>1)}var l=this.yOffset;if(o>s.yMax*i){l=Math.round(r-s.yMax*i)+(t.h>>1)}else if(o<s.yMin*i){l=Math.round(r-s.yMin*i)+(t.h>>1)}this.setOffset(h,l);return};function UISceneCreator(){var t=["ui-scene","ui-scene",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIScene;return e.initUIScene(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UISceneCreator);function Physics(){}Physics.pixelsPerMeter=10;Physics.toMeter=function(t){return t/Physics.pixelsPerMeter};Physics.toPixel=function(t){return Math.round(t*Physics.pixelsPerMeter)};Physics.createFixtureDef=function(t,e){var i=e.w>>1;var n=e.h>>1;var r=new b2FixtureDef;var a=e.x+i;var o=e.y+n;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;if(e.categoryBits){r.filter.categoryBits=e.categoryBits}if(e.maskBits){r.filter.maskBits=e.maskBits}if(e.groupIndex){r.filter.groupIndex=e.groupIndex}if(e.isSensor){r.isSensor=true}if(e.isUICircle||e.physicsShape==="circle"){i=e.getWidth(true)>>1;n=e.getHeight(true)>>1;var s=Physics.toMeter(Math.min(i,n));r.shape=new b2CircleShape(s)}else if(e.isUIBox||e.physicsShape==="rectangle"){i=e.getWidth(true)>>1;n=e.getHeight(true)>>1;r.shape=new b2PolygonShape;r.shape.SetAsBox(Physics.toMeter(i),Physics.toMeter(n))}else if(e.isUIPolygon){var h=i;var l=n;var u=[];var c=[];var p=e.children.length;for(var f=0;f<p;f++){var m={};var d=e.children[f];if(!d.isUIPoint){continue}m.x=Physics.toMeter(d.x+(d.w>>1)-h);m.y=Physics.toMeter(d.y+(d.h>>1)-l);if(u.length===5){r=new b2FixtureDef;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;r.shape=new b2PolygonShape;r.shape.SetAsArray(u,u.length);c.push(r);u=[]}u.push(m)}if(u.length>2){r=new b2FixtureDef;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;r.shape=new b2PolygonShape;r.shape.SetAsArray(u,u.length);c.push(r);u=[]}return c.length>1?c:c[0]}else if(e.isUIEdge){var g=e.points[0];var y=e.points[1];var v={x:g.x+y.x>>1,y:g.y+y.y>>1};var _=new b2Vec2(Physics.toMeter(g.x-v.x),Physics.toMeter(g.y-v.y));var I=new b2Vec2(Physics.toMeter(y.x-v.x),Physics.toMeter(y.y-v.y));r.density=0;r.isSensor=false;r.shape=new b2EdgeShape(_,I)}return r};Physics.createBody=function(t,e){var i=null;var n=e.getPositionInWindow();var r=e.getWidth()>>1;var a=e.getHeight()>>1;var o=n.x+r;var s=n.y+a;var h=e.density;var l=new b2BodyDef;var u=Physics.createFixtureDef(t,e);if(h<0){b2BodyDef.type=b2Body.b2_kinematicBody}else{l.type=h?b2Body.b2_dynamicBody:b2Body.b2_staticBody}l.position.Set(Physics.toMeter(o),Physics.toMeter(s));if(e.fixedRotation){l.fixedRotation=true}if(e.isBullet){l.bullet=true}if(e.allowSleep){l.awake=true;l.allowSleep=true}else{l.allowSleep=false}if(e.linearDamping!==undefined){l.linearDamping=e.linearDamping}if(e.angularDamping!==undefined){l.angularDamping=e.angularDamping}i=t.CreateBody(l);if(u.length){for(var c=0;c<u.length;c++){i.CreateFixture(u[c])}console.log("Create Composite Polygon: n="+u.length)}else{i.CreateFixture(u)}i.element=e;i.name=e.name;e.body=i;if(e.rotation){i.SetAngle(e.rotation)}if(!e.enable){i.SetActive(false)}if(e.xInitVelocity||e.yInitVelocity){e.setV(e.xInitVelocity,e.yInitVelocity)}return i};Physics.createEmbedBody=function(t,e,i){var n=null;var r=Physics.createFixtureDef(t,i);if(!n){var a=e.getPositionInWindow();var o=e.w>>1;var s=e.h>>1;var h=a.x+o;var l=a.y+s;n=new b2BodyDef;if(r.density<0){delete r.density;b2BodyDef.type=b2Body.b2_kinematicBody}else{n.type=r.density?b2Body.b2_dynamicBody:b2Body.b2_staticBody}n.position.Set(Physics.toMeter(h),Physics.toMeter(l));if(e.fixedRotation||i.fixedRotation){n.fixedRotation=true}if(e.isBullet||i.isBullet){n.bullet=true}if(e.allowSleep||i.allowSleep){n.awake=true;n.allowSleep=true}else{n.allowSleep=false}if(i.linearDamping!==undefined){n.linearDamping=i.linearDamping}if(i.angularDamping!==undefined){n.angularDamping=i.angularDamping}var u=t.CreateBody(n);u.element=e;e.body=u;if(!e.enable||!i.enable){
u.SetActive(false)}}u.CreateFixture(r);return u};Physics.createBodyForElement=function(t,e,i){if(i.physicsShape){Physics.createBody(t,i)}else if(i.isUIPhysicsShape){if(e.isUIWindow){Physics.createBody(t,i)}else if(e.isUISprite||e.isUISkeletonAnimation||e.isUITransformAnimation||e.isUIFrameAnimation){Physics.createEmbedBody(t,e,i)}else{Physics.createBody(t,i)}}else{Physics.createWorldShapes(t,i)}return};Physics.destroyBodyForElement=function(t,e){for(var i=0;i<e.children.length;i++){var n=e.children[i];Physics.destroyBodyForElement(t,n)}if(e.body){var r=e.body;r.SetActive(false);setTimeout(function(){t.DestroyBody(r)},0);r.element=null;e.body=null}return};Physics.destroyJointForElement=function(t,e){if(e.joint){setTimeout(function(){t.DestroyJoint(e.joint);joint.element=null},0)}return};Physics.createWorldShapes=function(t,e){var i=0;var n=0;var r=null;var a=null;for(var o=0;o<e.children.length;o++){var s=e.children[o];Physics.createBodyForElement(t,e,s)}return};Physics.findBodiesAtPoint=function(t,e,i){var n=[];var r=t.children.length;var a=cantkGetTempCanvas(t.w,t.h);var o=a.getContext("2d");for(var s=i;s>=0;s--){var h=t.children[s];if(!h.body){continue}var l={x:h.x,y:h.y,w:h.w,h:h.h};if(h.rotation){o.save();o.beginPath();o.translate(l.x,l.y);if(h.rotation){o.translate(l.w>>1,l.h>>1);o.rotate(h.rotation);o.translate(-(l.w>>1),-(l.h>>1))}o.rect(0,0,l.w,l.h);if(o.isPointInPath(e.x,e.y)){n.push(h.body)}o.restore()}else{if(isPointInRect(e,l)){n.push(h.body)}}}return n};Physics.createJoint=function(t,e,i){var i=e.getWindow();if(!e.isUIJoint){return}if(e.isUIOneJoint){var n={};var r=null;n.x=e.x+(e.w>>1);n.y=e.y+(e.h>>1);var a=e.getZIndex();r=Physics.findBodiesAtPoint(i,n,a);if(r.length==1){r=[t.GetGroundBody(),r[0]]}if(r.length>1){var o=null;var s=new b2Vec2(Physics.toMeter(n.x),Physics.toMeter(n.y));if(r[0].GetType()===b2Body.b2_staticBody&&r[1].GetType()===b2Body.b2_staticBody){console.log("%cWarning: it seems no meanings to pin two static body together.","color: red; font-weight: bold")}if(e.isUIRevoluteJoint){o=new b2RevoluteJointDef;o.Initialize(r[0],r[1],s);o.lowerAngle=(e.lowerAngle?e.lowerAngle:0)*Math.PI/180;o.upperAngle=(e.upperAngle?e.upperAngle:0)*Math.PI/180;o.motorSpeed=e.motorSpeed?e.motorSpeed:0;o.maxMotorTorque=e.maxMotorTorque?e.maxMotorTorque:0;o.enableLimit=e.enableLimit?e.enableLimit:false;o.enableMotor=e.enableMotor?e.enableMotor:false}else if(e.isUIWeldJoint){o=new b2WeldJointDef;o.Initialize(r[0],r[1],s)}var h=t.CreateJoint(o);h.element=e;e.joint=h}else{console.log("not found body")}}else if(e.isUITwoJoint){var o=null;var l=e.points[0];var u=e.points[1];var a=e.getZIndex();var c=Physics.findBodiesAtPoint(i,l,a);var p=Physics.findBodiesAtPoint(i,u,a);if(c.length&&p.length){var f=new b2Vec2(Physics.toMeter(l.x),Physics.toMeter(l.y));var m=new b2Vec2(Physics.toMeter(u.x),Physics.toMeter(u.y));if(e.isUIDistanceJoint){o=new b2DistanceJointDef;o.Initialize(c[0],p[0],f,m);if(e.frequencyHz){o.frequencyHz=e.frequencyHz}if(e.dampingRatio){o.dampingRatio=e.dampingRatio}}else if(e.isUILineJoint){var d=m.x-f.x;var g=m.y-f.y;var y={};y.x=d/Math.sqrt(d*d+g*g);y.y=g/Math.sqrt(d*d+g*g);o=new b2LineJointDef;o.Initialize(c[0],c[1],f,y);o.enableLimit=true;o.lowerTranslation=0;o.upperTranslation=10;o.enableMotor=false;o.maxMotorForce=3e5;o.motorSpeed=1}var h=t.CreateJoint(o);h.element=e;e.joint=h}else{console.log("not found body")}}else if(e.isUIPulleyJoint){var o=null;var l=e.points[0];var u=e.points[1];var v=e.points[2];var _=e.points[3];var a=e.getZIndex();var c=Physics.findBodiesAtPoint(i,l,a);var p=Physics.findBodiesAtPoint(i,_,a);if(c.length&&p.length){o=new b2PulleyJointDef;var I=1;var f=new b2Vec2(Physics.toMeter(l.x),Physics.toMeter(l.y));var m=new b2Vec2(Physics.toMeter(u.x),Physics.toMeter(u.y));var w=new b2Vec2(Physics.toMeter(v.x),Physics.toMeter(v.y));var x=new b2Vec2(Physics.toMeter(_.x),Physics.toMeter(_.y));o.Initialize(c[0],p[0],m,w,f,x,I);var h=t.CreateJoint(o);h.element=e;e.joint=h}else{console.log("not found body")}}return};Physics.createWorldJoints=function(t,e,i){for(var n=0;n<i.children.length;n++){var r=i.children[n];Physics.createWorldJoints(t,e,r)}Physics.createJoint(t,i,e)};Physics.updateBodyElementsPosition=function(t){for(var e=t.m_bodyList;e;e=e.m_next){var i=e.element;if(i){var n=e.GetAngle();var r=e.GetPosition();if(r.x!==undefined&&r.y!==undefined){var a=Physics.toPixel(r.x)-(i.w>>1);var o=Physics.toPixel(r.y)-(i.h>>1);var s=i.getParent();if(!s.isUIWindow){var h=s.getPositionInWindow();a=a-h.x;o=o-h.y}var l=i.x;var u=i.y;i.setRotation(n);if(l!==a||u!==o){i.setPositionByBody(a,o)}}}}for(var c=t.m_jointList;c;c=c.m_next){switch(c.m_type){case b2Joint.e_distanceJoint:{var p=c.GetAnchorA();var f=c.GetAnchorB();var i=c.element;i.points[0].x=Physics.toPixel(p.x);i.points[0].y=Physics.toPixel(p.y);i.points[1].x=Physics.toPixel(f.x);i.points[1].y=Physics.toPixel(f.y);break}case b2Joint.e_pulleyJoint:{var p=c.GetAnchorA();var f=c.GetGroundAnchorA();var m=c.GetGroundAnchorB();var d=c.GetAnchorB();var i=c.element;i.points[0].x=Physics.toPixel(p.x);i.points[0].y=Physics.toPixel(p.y);i.points[1].x=Physics.toPixel(f.x);i.points[1].y=Physics.toPixel(f.y);i.points[2].x=Physics.toPixel(m.x);i.points[2].y=Physics.toPixel(m.y);i.points[3].x=Physics.toPixel(d.x);i.points[3].y=Physics.toPixel(d.y);break}default:{var r=c.GetAnchorA();var i=c.element;var a=Physics.toPixel(r.x)-(i.w>>1);var o=Physics.toPixel(r.y)-(i.h>>1);i.setPositionByBody(a,o);break}}}return};Physics.destroyWorld=function(t){var e=t.m_bodyList;do{if(!e)break;var i=e.m_next;if(e.element){e.element.body=null;e.element=null}t.DestroyBody(e);e=i}while(true);var n=t.m_jointList;do{if(!n)break;var i=n.m_next;if(n.element){n.element=null}t.DestroyJoint(n);n=i}while(true);return};Physics.reparentPhysicsToScene=function(t){var e=[];function i(t){var i=t.getParent();if(t.isUISkeletonAnimation||t.isUISprite||t.isUIFrameAnimation||t.isUITransformAnimation){if(!i.isUIWindow){e.push(t)}}else if(t.isUIPhysicsShape){if(!i.isUISkeletonAnimation&&!i.isUISprite&&!i.isUIFrameAnimation&&!i.isUITransformAnimation&&!i.isUIWindow){e.push(t)}}}t.forEach(i);for(var n=0;n<e.length;n++){var r=e[n];r.reparent(t,true)}return};Physics.createWorld=function(t){if(t.world||!window.b2World){return}var e=null;var i=t.w>>1;var n=t.h>>1;var r=-t.w>>1;var a=-t.h>>1;var o=t.getFPS();var s=t.allowSleep?t.allowSleep:true;var h=t.gravityX?t.gravityX:0;var l=t.gravityY?t.gravityY:0;var u=t.pixelsPerMeter?t.pixelsPerMeter:10;var c=new b2Vec2(h,l);var p=new b2AABB;var f=1;Physics.pixelsPerMeter=u;p.lowerBound.Set(r,a);p.upperBound.Set(i,n);e=new b2World(c,s);Physics.createWorldShapes(e,t);Physics.createWorldJoints(e,t,t);var m=new b2ContactListener;m.BeginContact=function(t){var e=t.GetFixtureA().GetBody();var i=t.GetFixtureB().GetBody();if(e.element&&i.element){var n=e.element;if(n.handleBeginContactSync){n.handleBeginContactSync(i,t)}var r=i.element;if(r.handleBeginContactSync){r.handleBeginContactSync(e,t)}setTimeout(function(){if(e.element){e.element.callOnBeginContactHandler(i,t)}if(i.element){i.element.callOnBeginContactHandler(e,t)}},0)}};m.EndContact=function(t){var e=t.GetFixtureA().GetBody();var i=t.GetFixtureB().GetBody();if(e.element&&i.element){var n=e.element;if(n.handleEndContactSync){n.handleEndContactSync(i,t)}var r=i.element;if(r.handleEndContactSync){r.handleEndContactSync(e,t)}setTimeout(function(){if(e.element){e.element.callOnEndContactHandler(i,t)}if(i.element){i.element.callOnEndContactHandler(e,t)}},0)}};m.PreSolve=function(t,e){var i=t.GetFixtureA().GetBody();var n=t.GetFixtureB().GetBody();if(i.element&&n.element){var r=i.element;if(r.handlePreSolve){r.handlePreSolve(n,e)}var a=n.element;if(a.handlePreSolve){a.handlePreSolve(i,e)}}};m.PostSolve=function(t,e){var i=t.GetFixtureA().GetBody();var n=t.GetFixtureB().GetBody();if(i.element&&n.element){var r=i.element;if(r.handlePostSolve){r.handlePostSolve(n,e)}var a=n.element;if(a.handlePostSolve){a.handlePostSolve(i,e)}}};e.SetContactListener(m);var d=t.velocityIterations?t.velocityIterations:8;var g=t.positionIterations?t.positionIterations:5;console.log("Box2d:"+d+":"+g+":"+o);var y=1/o;var v=0;function _(){if(t.world!=e){clearInterval(v);console.log("World is recreated.");return false}var i=UIElement.timeScale*y;if(t.isVisible()&&t.isTopWindow()&&t.isPlaying()){e.Step(i,d,g);t.postRedraw();if(t.autoClearForce){e.ClearForces()}Physics.updateBodyElementsPosition(e)}return true}t.world=e;v=setInterval(_,y*1e3);return};function UICircle(){return}UICircle.prototype=new UIBody;UICircle.prototype.isUICircle=true;UICircle.prototype.initUICircle=function(t,e,i){this.initUIBody(t,e,i);return this};UICircle.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UICircle.prototype.setSize=function(t,e){this.w=Math.max(Math.floor(t),2);this.h=Math.max(Math.floor(e),2);this.onSized();return this};UICircle.prototype.onSized=function(){var t=this.getWindow();this.updateLayoutParams();if(this.body&&t&&t.isUIScene){var e=this.x;var i=this.y;var n=t.toMeter(Math.min(this.getWidth(true)>>1,this.getHeight(true)>>1));var r=this.body.GetFixtureList().GetShape();r.SetRadius(n);this.body.SynchronizeFixtures();this.setPosition(e,i)}};UICircle.prototype.drawShape=function(t){var e=this.w>>1;var i=this.h>>1;var n=Math.min(this.getWidth(true)>>1,this.getHeight(true)>>1);t.arc(e,i,n,0,Math.PI*2);return};function UICircleCreator(){var t=["ui-circle","ui-circle",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UICircle;return e.initUICircle(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UICircleCreator);function UISound(){return}UISound.prototype=new UICheckBox;UISound.prototype.isUISound=true;UISound.prototype.initUISound=function(t,e,i,n){this.initUICheckBox(t,e,i,null,null,null,null,null,null);this.soundURL="";this.loop=true;this.autoPlay=true;this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISound.prototype.setSoundURL=function(t){this.soundURL=t;return};UISound.prototype.setAutoPlay=function(t){this.value=t;this.autoPlay=t;return};UISound.prototype.setLoop=function(t){this.loop=t;return};UISound.prototype.isPlaying=function(){return this.playing};UISound.prototype.pause=function(){if(this.audio&&this.playing){this.audio.pause();this.playing=false}return};UISound.prototype.stop=function(){if(this.audio&&this.playing){this.audio.stop();this.playing=false}return};UISound.prototype.play=function(t){if(this.audio&&(!this.playing||t)){this.audio.play();this.playing=true}return};UISound.prototype.mute=function(t){this.setValue(!t);return};UISound.prototype.setValue=function(t){this.value=t;if(t){this.play()}else{this.pause()}return};UISound.prototype.onModeChanged=function(){this.stop();return};UISound.songs=[];UISound.addSong=function(t){UISound.songs.push(t);return};UISound.removeSong=function(t){for(var e=0;e<UISound.songs.length;e++){var i=UISound.songs[e];if(i.url===t){i.stop();UISound.songs.remove(i);return i}}return null};UISound.prototype.onInit=function(){var t=this;if(this.soundURL){var e={urls:[this.soundURL],autoplay:this.autoPlay,loop:this.loop,volume:.8};e.onend=function(){t.playing=false;console.log("audio end.")};UISound.removeSong(this.soundURL);var i=new Howl(e);i.url=this.soundURL;UISound.addSong(i);if(!this.getValue()){i.mute()}if(this.autoPlay){this.playing=true}this.audio=i;return}};UISound.prototype.shapeCanBeChild=function(t){return false};UISound.prototype.onClick=function(t,e){if(e||this.mode===Shape.MODE_EDITING){return}this.setValue(!this.value);this.callOnClickHandler(t);return};UISound.prototype.onFromJsonDone=function(){if(this.soundURL){ResLoader.loadAudio(this.soundURL,function(t){console.log("audio loaded: "+t.src)})}return};function UISoundCreator(){var t=["ui-sound","ui-sound",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISound;return e.initUISound(this.type,100,100,null)};return}function UIBullet(){return}UIBullet.prototype=new UISprite;UIBullet.prototype.isUIBullet=true;UIBullet.prototype.initUIBullet=function(t,e,i,n){this.initUISprite(t,e,i,n);this.leastGap=10;this.alphaFrom=.1;this.alphaTo=1;return this};UIBullet.prototype.callOnMoved=function(){var t={};t.x=this.x;t.y=this.y;t.rotation=this.rotation;UIElement.prototype.callOnMoved.call(this);if(!this.traces){this.traces=[t];return}var e=this.traces[this.traces.length-1];if(Math.distanceBetween(t,e)>Math.max(this.w,this.h)+this.leastGap){this.traces.push(t)}return};UIBullet.prototype.paintSelf=function(t){if(this.traces&&this.traces.length){var e=this.x;var i=this.y;var n=this.opacity;var r=this.rotation;var a=this.traces.length;var o=(this.alphaTo-this.alphaFrom)/a;for(var s=0;s<this.traces.length;s++){var h=this.traces[s];this.x=h.x;this.y=h.y;this.rotation=h.rotation;this.opacity=this.alphaFrom+o*s;UIElement.prototype.paintSelf.call(this,t)}this.x=e;this.y=i;this.rotation=r;this.opacity=n}UIElement.prototype.paintSelf.call(this,t);return};function UIBulletCreator(){var t=["ui-bullet","ui-bullet",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBullet;return e.initUIBullet(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIBulletCreator);function UIDistanceJoint(){return}UIDistanceJoint.prototype=new UITwoJoint;UIDistanceJoint.prototype.isUIJoint=true;UIDistanceJoint.prototype.isUIDistanceJoint=true;UIDistanceJoint.prototype.initUIDistanceJoint=function(t,e,i){this.initUITwoJoint(t,e,i);this.visibleAtRunTime=true;return this};function UIDistanceJointCreator(){var t=["ui-distance-joint","ui-distance-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIDistanceJoint;return e.initUIDistanceJoint(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIDistanceJointCreator);function UIParticles(){return}UIParticles.prototype=new UIElement;UIParticles.prototype.isUIParticles=true;UIParticles.prototype.initUIParticles=function(t){this.initUIElement(t);this.name="ui-particles";this.autoEmit=true;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UIParticles.prototype.setEmitterPosition=function(t,e){if(this.emitter){this.emitter.p.x=t;this.emitter.p.y=e}else{this.emitterX=0;this.emitterY=0}return this};UIParticles.prototype.onInit=function(){this.start();return};UIParticles.prototype.onFromJsonDone=function(){var t=this.style;if(t.texture){var e=ResLoader.loadImage(t.texture)}if(t.textures){var i=t.textures.split("\n");for(var n=0;n<i.length;n++){var r=i[n];if(!r)continue;var e=ResLoader.loadImage(r)}}return};UIParticles.prototype.initParticles=function(){var t=this.w>>1;var e=this.h>>1;var i=new Proton;var n=new Proton.Emitter;var r=this.style;if(r.rateNumMax){n.rate=new Proton.Rate(new Proton.Span(r.rateNumMin,r.rateNumMax),new Proton.Span(r.rateTimeMin,r.rateTimeMax))}if(r.texture){var a=ResLoader.loadImage(r.texture);n.addInitialize(new Proton.ImageTarget(a))}if(r.textures){var o=[];var s=r.textures.split("\n");for(var h=0;h<s.length;h++){var l=s[h];if(!l)continue;var a=ResLoader.loadImage(l);o.push(a)}n.addInitialize(new Proton.ImageTarget(o))}if(r.massMax){n.addInitialize(new Proton.Mass(r.massMin,r.massMax))}if(r.radiusMin||r.radiusMax){n.addInitialize(new Proton.Radius(r.radiusMin,r.radiusMax))}if(r.lifeMax){n.addInitialize(new Proton.Life(r.lifeMin,r.lifeMax))}if(r.velocityType){n.addInitialize(new Proton.Velocity(new Proton.Span(r.velocityXMin,r.velocityXMax),new Proton.Span(r.velocityYMin,r.velocityYMax),r.velocityType))}if(r.driftX||r.driftY){n.addBehaviour(new Proton.RandomDrift(r.driftX,r.driftY,r.driftDelay,r.driftLife))}if(r.startColor||r.endColor){n.addBehaviour(new Proton.Color(r.startColor,r.endColor,r.colorLife,r.colorEasing))}if(r.position){switch(r.position){case"left":{n.addInitialize(new Proton.Position(new Proton.LineZone(-t,-e,-t,e)));break}case"right":{n.addInitialize(new Proton.Position(new Proton.LineZone(t,-e,t,e)));break}case"top":{n.addInitialize(new Proton.Position(new Proton.LineZone(-t,-e,t,-e)));break}case"bottom":{n.addInitialize(new Proton.Position(new Proton.LineZone(-t,e,t,e)));break}default:break}}if(r.rotationMin||r.rotationMax){n.addBehaviour(new Proton.Rotate(new Proton.Span(r.rotationMin,r.rotationMax),new Proton.Span(r.rotationDeltaMin,r.rotationDeltaMax),"add"))}if(r.scaleMax||r.scaleMin){n.addBehaviour(new Proton.Scale(r.scaleMin,r.scaleMax))}if(r.alphaMax||r.alphaMin){n.addBehaviour(new Proton.Alpha(r.alphaMin,r.alphaMax))}if(r.gravity){n.addBehaviour(new Proton.Gravity(r.gravity))}var u=this.getWindow();n.addBehaviour(new Proton.CrossZone(new Proton.RectZone(0,0,u.w,u.h),"dead"));n.p.x=t;n.p.y=e;if(this.autoEmit){n.emit()}i.addEmitter(n);this.emitter=n;this.lastUpdateTime=Date.now()};UIParticles.prototype.emit=function(t){this.emitter.stopEmit();if(t){this.emitter.emit("once",1e8)}else{this.emitter.emit()}return this};UIParticles.prototype.start=function(){var t=this;if(this.timerID){return this}this.initParticles();function e(){if(!t.parentShape||!t.emitter){clearInterval(t.timerID);t.timerID=0;return}if(t.isVisible()&&!t.paused&&WWindowManager.getInstance().getPaintEnable()){var e=Date.now();var i=(e-t.lastUpdateTime)/1e3;t.emitter.update(i);t.lastUpdateTime=e}}t.timerID=setInterval(e,25);return this};UIParticles.prototype.stop=function(){clearInterval(this.timerID);this.emitter.stopEmit();this.timerID=null;this.emitter=null;return this};UIParticles.prototype.pause=function(){this.paused=true;return this};UIParticles.prototype.resume=function(){this.paused=false;return this};UIParticles.prototype.drawParticle=function(t,e){if(e.target){if(e.target instanceof Image){var i=e.target.width*e.scale|0;var n=e.target.height*e.scale|0;var r=e.p.x-i/2;var a=e.p.y-n/2;t.save();t.globalAlpha=e.alpha;t.translate(e.p.x,e.p.y);t.rotate(Proton.MathUtils.degreeTransform(e.rotation));t.translate(-e.p.x,-e.p.y);t.drawImage(e.target,0,0,e.target.width,e.target.height,r,a,i,n);t.globalAlpha=1;t.restore()}}else{if(e.transform["rgb"])t.fillStyle="rgba("+e.transform.rgb.r+","+e.transform.rgb.g+","+e.transform.rgb.b+","+e.alpha+")";else t.fillStyle=e.color;t.beginPath();t.arc(e.p.x,e.p.y,e.radius,0,Math.PI*2,true);if(this.stroke){t.strokeStyle=this.stroke.color;t.lineWidth=this.stroke.thinkness;t.stroke()}t.closePath();t.fill()}};UIParticles.prototype.paintSelfOnly=function(t){if(!this.emitter){return}var e=this.emitter.particles;var i=e.length;for(var n=0;n<i;n++){var r=e[n];this.drawParticle(t,r)}this.postRedraw();return};UIParticles.prototype.shapeCanBeChild=function(t){return false};function UIParticlesCreator(){var t=["ui-particles","ui-particles",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIParticles;return e.initUIParticles(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIParticlesCreator);function UIBitmapFontText(){return}UIBitmapFontText.prototype=new UIElement;UIBitmapFontText.prototype.isUIBitmapFontText=true;UIBitmapFontText.prototype.initUIBitmapFontText=function(t,e,i){this.initUIElement(t);this.text="";this.textAlignment="center";this.setMargin(5,5);this.setDefSize(e,i);this.setSizeLimit(30,30);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.addEventNames(["onUpdateTransform"]);return this};UIBitmapFontText.prototype.shapeCanBeChild=function(t){return false};UIBitmapFontText.prototype.setImageWithRowCols=function(t,e,i){this.imageRows=e;this.imageColumns=i;this.setImage(UIElement.IMAGE_NORMAL_FG,t);return};UIBitmapFontText.prototype.getRectOfChar=function(t,e,i){if(this.allText){var n=this.allText.length;var r=this.allText.indexOf(i);if(r>=0){var a=e.w;var o=e.h;var s=this.imageRows?this.imageRows:o>a?n:1;var h=this.imageColumns?this.imageColumns:a>o?n:1;var l=Math.round(a/h);var u=Math.round(o/s);var c=Math.floor(r/h);var i=r%h;var p={};p.w=l;p.h=u;p.x=l*i+e.x;p.y=u*c+e.y;return p}}return null};UIBitmapFontText.prototype.setAllText=function(t){this.allText=t;return this};UIBitmapFontText.prototype.getAllText=function(){return this.allText};UIBitmapFontText.prototype.getBgImage=function(){var t=null;if(this.pointerDown&&!this.isClicked()){t=this.images.active_bg}else{t=this.images.normal_bg}if(!t||!t.getImage()){t=this.images.default_bg}if(!t||!t.getImage()){return}return t};UIBitmapFontText.prototype.drawFgImage=function(t){var e=this.text;var i=this.getImageByType(UIElement.IMAGE_NORMAL_FG);if(!e||!i){return}var n=i.getImage();var r=i.getImageRect();if(!n){return}var a=0;var o=this.h;var s=15;for(var h=0;h<e.length;h++){var l=e[h];var u=this.getRectOfChar(n,r,l);if(u){a+=u.w;if(u.h>s){s=u.h}}}var c=0;var p=0;var f=0;var m=this.h>>1;var d=Math.min(1,Math.min(this.h/s,this.w/a));switch(this.textAlignment){case"right":{p=this.w-this.hMargin-a;f=p+a;break}case"center":{p=this.w-a>>1;f=this.w>>1;break}default:{p=this.hMargin;f=p;break}}if(d!=1){t.translate(f,m);t.scale(d,d);t.translate(-f,-m)}for(var h=0;h<e.length;h++){var l=e[h];var u=this.getRectOfChar(n,r,l);if(u){c=o-u.h>>1;t.drawImage(n,u.x,u.y,u.w,u.h,p,c,u.w,u.h);p+=u.w}}return};function UIBitmapFontTextCreator(){var t=["ui-bitmap-font-text","ui-bitmap-font-text",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBitmapFontText;return e.initUIBitmapFontText(this.type,400,100)};return}ShapeFactoryGet().addShapeCreator(new UIBitmapFontTextCreator);UIElement.prototype.getScence=function(){return this.getWindow()};UIElement.prototype.getFootprints=function(t){var e=0;var i=0;var n=[];var r=this.isUIWindow?this:this.getParent().children;for(var a=0;a<r.length;a++){var o=r[a];if(!o.isUIFootprint){continue}if(t&&t!=o.name){continue}e=o.x+(o.w>>1);i=o.y+(o.h>>1);n.push({x:e,y:i})}return n};UIElement.prototype.moveAlongPath=function(t,e,i,n){var r=this.getFootprints(t);return this.moveAlongPoints(r,e,i,n)};UIElement.prototype.moveAlongPoints=function(t,e,i,n){var r=0;var a=0;var o=0;var s={};var h=[];var l=0;if(!t.length){console.log("no footprint found.")}for(var u=0;u<t.length;u++){var c=t[u];if(u){a=t[u].x-t[u-1].x;o=t[u].y-t[u-1].y;r=Math.sqrt(a*a+o*o);h.push(r);l+=r}}s.onDone=n;s.duration=e;s.distances=h;s.points=t;s.totalDistance=l;s.enableRotation=i;this.startMove(s);return};UIElement.prototype.startMove=function(t){var e=0;var i=0;var n=0;var r=this;var a=this.w>>1;var o=this.h>>1;var s=t.duration;var h=t.distances;var l=t.points;var u=t.totalDistance;var c=t.enableRotation;function p(){if(n+1>=l.length){if(t.onDone){t.onDone()}return}var f=Date.now();var m=l[n+1];var d=l[n];var g=s*(h[n]/u);var y=m.x-d.x;var v=m.y-d.y;var _=Math.asin(Math.abs(v)/Math.sqrt(y*y+v*v));if(v<=0&&y<0){_=Math.PI-_}if(v>0&&y<0){_=Math.PI+_}if(v>0&&y>=0){_=2*Math.PI-_}_=-_;function I(){var t=(Date.now()-f)/g;if(t<1){e=d.x+y*t-a;i=d.y+v*t-o;r.setPosition(e,i);if(c){r.setRotation(_)}r.postRedraw();return true}else{n++;e=m.x-a;i=m.y-o;r.setPosition(e,i);r.postRedraw();p();return false}}UIElement.setAnimTimer(I)}p();return};UIElement.prototype.setPosition=function(t,e){this.x=Math.round(t);this.y=Math.round(e);if(this.body){var i={};var n=this.getParent().getPositionInWindow();t+=n.x;e+=n.y;i.x=Physics.toMeter(t+(this.w>>1));i.y=Physics.toMeter(e+(this.h>>1));this.body.SetPosition(i)}return this};UIElement.prototype.setPositionWithSticky=function(t,e){this.setPosition(t,e);if(this.sticky){this.orgX=this.x;this.orgY=this.y}return this};UIElement.prototype.setAngle=UIElement.prototype.setRotation;UIElement.prototype.setPositionByBody=function(t,e){this.x=t;this.y=e;this.callOnMovedHandler();return this};UIElement.prototype.setSoundMusicVolume=function(t){this.getWindowManager().setSoundMusicVolume(t);return this};UIElement.prototype.setSoundEffectVolume=function(t){this.getWindowManager().setSoundEffectVolume(t);return this};UIElement.prototype.playSoundEffect=function(t,e){this.getWindowManager().playSoundEffect(t,e);return this};UIElement.prototype.playSoundMusic=function(t,e){this.getWindowManager().playSoundMusic(t,e);return this};UIElement.prototype.stopSoundMusic=function(t){this.getWindowManager().stopSoundMusic(t);return this};UIElement.prototype.setVOf=function(t,e,i){var n=this.getWindow().findChildByName(t,true);if(n){n.setV(e,i)}else{console.log("not found "+t)}return this};UIElement.prototype.setV=function(t,e){var i=this.body;if(i){this.setVisible(true);if(!i.IsActive()){i.SetActive(true)}if(!i.IsAwake()){i.SetAwake(true)}var n=i.GetLinearVelocity();if(t!==null&&t!==undefined){n.x=t}if(e!==null&&e!==undefined){n.y=e}i.SetLinearVelocity(n)}return this};UIElement.prototype.onRemoved=function(t){if(!t){return}var e=t.getWindow();if(!e){return}var i=e.world;if(this.body){Physics.destroyBodyForElement(i,this);this.body=null}if(this.joint){Physics.destroyJointForElement(i,this);this.joint=null}return this};function UIFrameAnimation(){return}UIFrameAnimation.prototype=new UIElement;UIFrameAnimation.prototype.isUIFrameAnimation=true;UIFrameAnimation.prototype.initUIFrameAnimation=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.current=0;this.frameRate=10;this.playing=false;this.autoPlay=true;this.repeatTimes=4294967295;this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.addEventNames(["onDoubleClick","onUpdateTransform"]);return this};UIFrameAnimation.prototype.syncImageFrames=function(){this.frames=[];for(var t in this.images){var e=this.images[t];if(t.indexOf("option_image_")>=0&&e){this.frames.push(e)}}return};UIFrameAnimation.prototype.elementToJson=function(t){UIElement.prototype.elementToJson.call(this,t);if(this.groups){t.groups=JSON.parse(JSON.stringify(this.groups))}return t};UIFrameAnimation.prototype.elementFromJson=function(t){UIElement.prototype.elementFromJson.call(this,t);this.playing=false;this.syncImageFrames();if(t.groups){this.groups=t.groups}else if(t.groupsData){this.groups=this.parseGroupsData(t.groupsData);this.groupsData=null}return t};UIFrameAnimation.prototype.afterChildAppended=function(t){t.xAttr=UIElement.X_CENTER_IN_PARENT;t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return};UIFrameAnimation.prototype.setAutoPlay=function(t){this.autoPlay=t;return this};UIFrameAnimation.prototype.resume=function(){this.playing=true;return this};UIFrameAnimation.prototype.pause=function(){this.playing=false;return this};UIFrameAnimation.prototype.stop=function(){this.playing=false;return this};UIFrameAnimation.prototype.playSequence=function(t,e,i,n){var r=this.frames.length;if(!r||!t||!t.length){return}this.current=0;this.playing=true;this.onDone=i;this.onOneCycle=n;this.runningSequence=t;this.nextUpdateTime=Date.now();this.repeatTimes=e?e:4294967295;return};UIFrameAnimation.prototype.playRange=function(t,e,i,n,r){var a=this.frames.length;if(t>e){var o=t;t=e;e=o}var s=[];for(var h=t;h<=e;h++){s.push(h)}this.playSequence(s,i,n,r);return this};UIFrameAnimation.prototype.gotoAndPlayByName=function(t,e,i,n){var r=this.getGroupRange(t);if(r.start!==undefined&&r.end!==undefined){return this.gotoAndPlay(r.start,r.end,e,i,n)}else if(r&&r.length){return this.playSequence(r,e,i,n)}else if(this.animations&&t){this.animate(t)}};UIFrameAnimation.prototype.play=UIFrameAnimation.prototype.gotoAndPlayByName;UIFrameAnimation.prototype.gotoAndPlay=UIFrameAnimation.prototype.playRange;UIFrameAnimation.prototype.nextFrame=function(){if(!this.frames||!this.frames.length||!this.runningSequence||!this.runningSequence.length){return}var t=this.current+1;var e=this.runningSequence.length;if(t===e){if(this.onOneCycle){var i=this.onOneCycle;try{i(this)}catch(n){console.log("onOneCycle: "+n.message)}}this.repeatTimes--;if(this.repeatTimes<=0){this.playing=false;if(this.onDone){var r=this.onDone;try{r(this)}catch(n){console.log("onDone: "+n.message)}}return}}this.current=t%e;return};UIFrameAnimation.prototype.getCurrentImage=function(){if(!this.frames||!this.frames.length){return null}if(!this.runningSequence||!this.runningSequence.length){return this.frames[0]}if(this.current>=this.runningSequence.length){this.current=0}var t=this.runningSequence[this.current];return this.frames[t]};UIFrameAnimation.prototype.parseGroupsData=function(t){var e={};var i=t.split(";");for(var n=0;n<i.length;n++){var r=i[n].split(":");if(!r||r.length<2){continue}try{var a=JSON.parse(r[1])}catch(o){console.log(o.message);continue}if(!a||a.length<2){continue}var s=r[0];var h=a[0];var l=a[1];e[s]={start:h,end:l}}return e};UIFrameAnimation.prototype.stringifyGroups=function(t){if(!t){return null}var e="";for(var i in t){var n=t[i];if(e){e+=";"}e+=i+":["+n.start+","+n.end+"]"}return e};UIFrameAnimation.prototype.setGroupsData=function(t){if(t){this.groups=this.parseGroupsData(t)}else{this.groups={}}return this};UIFrameAnimation.prototype.getGroupRange=function(t){var e=null;if(this.groups&&t){e=this.groups[t]}if(!e){e={start:0,end:this.frames.length-1}}return e};UIFrameAnimation.prototype.getImages=function(){var t="";for(var e in this.images){var i=this.images[e];if(e.indexOf("option_image_")>=0&&i&&i.src){t+=i.src+"\n"}}return t};UIFrameAnimation.prototype.setImages=function(t){var e=this.images.display;this.images={};this.images.display=e;if(t){var i=0;var n=0;var r=t.split("\n");for(var i=0;i<r.length;i++){var a=r[i];if(!a)continue;if(a.indexOf("/")===0){a=a.substr(1)}var o="option_image_"+n++;this.setImage(o,a)}}this.syncImageFrames();return this};UIFrameAnimation.prototype.getValue=function(){return this.current};UIFrameAnimation.prototype.setValue=function(t){this.current=Math.min(t,this.frames.length);return};UIFrameAnimation.prototype.startAutoPlay=function(){if(this.defaultGroupName){this.play(this.defaultGroupName,268435455)}else{this.gotoAndPlay(0,this.frames.length-1,268435455)}return};UIFrameAnimation.prototype.onInit=function(){this.syncImageFrames();if(this.autoPlay&&this.frames&&this.frames.length){this.startAutoPlay();if(this.autoPlayDelay){this.nextUpdateTime+=this.autoPlayDelay}}return};UIFrameAnimation.prototype.paintSelf=function(t){if(this.playing&&this.isVisible()){var e=this.getDuration();var i=t.now+e;if(t.now>this.nextUpdateTime){this.nextFrame();this.nextUpdateTime=i}else{this.nextUpdateTime=Math.min(this.nextUpdateTime,i)}t.needRedraw++}return UIElement.prototype.paintSelf.call(this,t)};UIFrameAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIFrameAnimation.prototype.setFrameRate=function(t){this.frameRate=Math.max(1,Math.min(t,30));return this};UIFrameAnimation.prototype.getDuration=function(){if(UIElement.timeScale){return 1e3/this.frameRate/UIElement.timeScale}else{return 16777215}};UIFrameAnimation.prototype.shapeCanBeChild=UISprite.prototype.shapeCanBeChild;UIFrameAnimation.prototype.drawImage=function(t){var e=this.getCurrentImage();if(e){var i=e.getImageRect();var n=e.getImage();if(n){this.drawImageAt(t,n,this.images.display,0,0,this.w,this.h,i)}}return};function UIFrameAnimationCreator(){var t=["ui-frame-animation","ui-frame-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFrameAnimation;return e.initUIFrameAnimation(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIFrameAnimationCreator);function UIWeldJoint(){return}UIWeldJoint.prototype=new UIOneJoint;UIWeldJoint.prototype.isUIJoint=true;UIWeldJoint.prototype.isUIWeldJoint=true;UIWeldJoint.prototype.initUIWeldJoint=function(t){this.initUIOneJoint(t);return this};function UIWeldJointCreator(){var t=["ui-weld-joint","ui-weld-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWeldJoint;return e.initUIWeldJoint(this.type)};return}function UIMouseJoint(){return}UIMouseJoint.prototype=new UIOneJoint;UIMouseJoint.prototype.isUIMouseJoint=true;UIMouseJoint.prototype.initUIMouseJoint=function(t){this.initUIOneJoint(t);this.speedScale=1;this.enableTop=true;this.enableLeft=true;
this.enableRight=true;this.enableBottom=true;return this};UIMouseJoint.prototype.onInit=function(){var t=this.getParent();var e=this.speedScale;var i=this.enableLeft;var n=this.enableRight;var r=this.enableTop;var a=this.enableBottom;if(t.physicsShape||t.isUIPhysicsShape){t.handlePointerDown=function(e){return UIMouseJoint.handleSpritePointerDown(t,e)};t.handlePointerMove=function(e){return UIMouseJoint.handleSpritePointerMove(t,e)};t.handlePointerUp=function(o){return UIMouseJoint.handleSpritePointerUp(t,o,e,i,n,r,a)}}};UIMouseJoint.handleSpritePointerDown=function(t,e){t.body.SetLinearVelocity({x:0,y:0});return};UIMouseJoint.handleSpritePointerMove=function(t,e){t.body.SetLinearVelocity({x:0,y:0});return};UIMouseJoint.prototype.setSpeedLimit=function(t,e,i,n){var r=this.getParent();r.xMinV=t;r.yMinV=i;r.xMaxV=e;r.yMaxV=n;return};UIMouseJoint.handleSpritePointerUp=function(t,e,i,n,r,a,o){var s=(Date.now()-t.pointerDownTime)/1e3;var h=t.getMoveAbsDeltaX();var l=t.getMoveAbsDeltaY();var u=i*Physics.toMeter(h)/s;var c=i*Physics.toMeter(l)/s;if(!n&&u<0){u=0}if(!a&&c<0){c=0}if(!r&&u>0){u=0}if(!o&&c>0){c=0}var p=t.xMaxV;if(p&&Math.abs(u)>p){u=u>0?p:-p}var f=t.yMaxV;if(f&&Math.abs(c)>f){c=c>0?f:-f}var m=t.xMinV;if(m&&Math.abs(u)<m){u=u>0?m:-m}var d=t.yMinV;if(d&&Math.abs(c)<d){c=c>0?d:-d}t.body.SetLinearVelocity({x:u,y:c});return};function UIMouseJointCreator(){var t=["ui-mouse-joint","ui-mouse-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMouseJoint;return e.initUIMouseJoint(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIMouseJointCreator);function UISoundEffects(){return}UISoundEffects.prototype=new UICheckBox;UISoundEffects.prototype.isUISoundEffects=true;UISoundEffects.prototype.initUISoundEffects=function(t){this.initUICheckBox(t);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISoundEffects.prototype.shapeCanBeChild=function(t){return false};UISoundEffects.prototype.setValue=function(t){var e=this.getWindowManager();if(this.mode===Shape.MODE_EDITING){return this}if(e){e.setSoundEffectsEnable(t)}return this};UISoundEffects.prototype.getValue=function(t){var e=this.getWindowManager();if(e){return e.soundEffectsEnalbe}else{return true}};function UISoundEffectsCreator(){var t=["ui-sound-effects","ui-sound-effects",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISoundEffects;return e.initUISoundEffects(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISoundEffectsCreator);function UIShaker(){return}UIShaker.prototype=new UIImage;UIShaker.prototype.isUIShaker=true;UIShaker.prototype.initUIShaker=function(t,e,i){this.initUIImage(t,e,i);return this};UIShaker.prototype.setAmplitudeX=function(t){this.amplitudeX=t;return this};UIShaker.prototype.setAmplitudeY=function(t){this.amplitudeY=t;return this};UIShaker.prototype.setDuration=function(t){this.duration=t;return this};UIShaker.prototype.setTimes=function(t){this.times=t;return this};UIShaker.prototype.setAmplitudeModifier=function(t){this.amplitudeModifier=t;return this};UIShaker.prototype.getAmplitudeX=function(){return this.amplitudeX};UIShaker.prototype.getAmplitudeY=function(){return this.amplitudeY};UIShaker.prototype.getDuration=function(){return this.duration};UIShaker.prototype.getTimes=function(){return this.times};UIShaker.prototype.getAmplitudeModifier=function(){return this.amplitudeModifier};UIShaker.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}if(!t){this.enable=t;return this}var i=this;var n=this.amplitudeX?this.amplitudeX:0;var r=this.amplitudeY?this.amplitudeY:0;var a=this.times?this.times:1;var o=this.duration?this.duration:200;var s=Date.now();var h=e.paintSelf;var l=a*2*Math.PI;var u=this.amplitudeModifier;e.paintSelf=function(t){var a=Date.now()-s;if(a<o){var c=1;var p=a/o;var f=l*p;var m=n*Math.cos(f);var d=r*Math.sin(f);if(u==="i"){c=p}else if(u==="d"){c=1-p}else if(u==="i->d"){c=2*(p<.5?p:1-p)}m*=c;d*=c;t.translate(m,d)}else{e.paintSelf=h;i.enable=false}h.call(e,t)};return this};function UIShakerCreator(){var t=["ui-shaker","ui-shaker",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIShaker;return e.initUIShaker(this.type,80,80)};return}ShapeFactoryGet().addShapeCreator(new UIShakerCreator);function UISettings(){return}UISettings.prototype=new UIElement;UISettings.prototype.isUISettings=true;UISettings.prototype.initUISettings=function(t,e,i){this.initUIElement(t);this.setSize(e,i);this.settingsDef={};this.regSerializer(this.settingsToJson,this.settingsFromJson);return this};UISettings.prototype.getSettingObj=function(t){var e=this.settingsDef[t];if(e&&e.isGlobal){return this.getWindowManager()}else{return this.getWindow()}};UISettings.prototype.getSetting=function(t){var e=this.getSettingObj(t);var i=e.settings[t];if(i===undefined){var n=this.settingsDef[t];if(n){i=n.defVal}}return i};UISettings.prototype.setSetting=function(t,e){var i=this.getSettingObj(t);return i.settings[t]=e};UISettings.prototype.settingsFromJson=function(t){this.settingsDef=t.settingsDef;return this};UISettings.prototype.settingsToJson=function(t){t.settingsDef=this.settingsDef;return t};function UISettingsCreator(){var t=["ui-settings","ui-settings",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISettings;return e.initUISettings(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISettingsCreator);function UITile(){return}UITile.prototype=new UIElement;UITile.prototype.isUITile=true;UITile.prototype.initUITile=function(t,e,i){this.initUIElement(t);this.setSize(e,i);return this};UITile.Layer=function(){};UITile.Layer.prototype.init=function(t,e){this.tile=t;this.info=e;return this};UITile.Layer.prototype.drawOrthogonal=function(t,e){var i=this.info;var n=i.x||0;var r=i.y||0;var a=i.data;var o=i.height;var s=i.width;var h=this.tile;var l=h.tileWidth;var u=h.tileHeight;var c=l*s;var p=Math.max(Math.floor(e.y/u),0);var f=Math.max(Math.floor(e.x/l),0);var m=Math.min(Math.ceil((e.x+e.w)/l),s);var d=Math.min(Math.ceil((e.y+e.h)/u),o);var g=f*l+n;var y=p*u+r;var e={x:g,y:y,w:l,h:u};n=g;t.globalAlpha=i.opacity;for(var v=p;v<=d;v++){for(var _=f;_<=m;_++){var I=v*s+_;var w=a[I];if(w){e.x=g;e.y=y;h.drawTile(t,e,w)}g+=l}g=n;y+=u}return};UITile.Layer.prototype.drawIsometric=function(t,e){var i=e.y;var n=e.x;var r=n+e.w;var a=i+e.h;var o=0;var s=this.info;var h=s.x||0;var l=s.y||0;var u=s.data;var c=s.height;var p=s.width;var f=this.tile;var m=f.tileWidth;var d=f.tileHeight;t.globalAlpha=s.opacity;var g=l;var y=h+this.info.width*m/2-m/2;var e={x:h,y:l,w:m,h:d};for(var v=0;v<c;v++){for(var _=0;_<p;_++,o++){var I=u[o];h=(_-v)*d+y;l=(_+v)*m/4+g;if(!I||h>r||l>a||h+m<n||l+d<i){continue}e.x=h;e.y=l;f.drawTile(t,e,I)}}return};UITile.Layer.prototype.draw=function(t,e){var i=this.info;if(!i.visible)return;switch(this.tile.orientation){case"orthogonal":{this.drawOrthogonal(t,e);break}case"isometric":{this.drawIsometric(t,e);break}default:{throw new Error("unknow orientation: ",this.tile.orientation)}}return};UITile.Layer.prototype.getTileByPoint=function(t,e){var i=this.tile;var n=i.tileWidth;var r=i.tileHeight;var a=Math.floor(e/r);var o=Math.floor(t/n);var s=a*this.info.width+o;var h=this.info.data[s];return{row:a,col:o,index:s,imageIndex:h}};UITile.TileSet=function(){};UITile.TileSet.prototype.init=function(t,e,i){this.tile=t;this.info=i;this.imageURL=e+"/"+i.image;this.image=WImage.create(this.imageURL);this.tileWidth=i.tilewidth+i.spacing;this.tileHeight=i.tileheight+i.spacing;this.cols=Math.floor((i.imagewidth-2*i.margin)/this.tileWidth);this.rows=Math.floor((i.imageheight-2*i.margin)/this.tileHeight);this.tileNr=this.cols*this.rows;this.startIndex=i.firstgid;return this};UITile.TileSet.prototype.testImageIndex=function(t){return t>=this.startIndex&&t<this.startIndex+this.tileNr};UITile.TileSet.prototype.drawTile=function(t,e,i,n){var r=this.image.getImage();var a=n-this.startIndex;if(a<0||a>=this.tileNr||!r||!r.width){return}var o=this.info;var s=a%this.cols;var h=Math.floor(a/this.cols);var l=s*this.tileWidth+o.margin;var u=h*this.tileHeight+o.margin;var c=o.tilewidth;var p=o.tileheight;if(this.tileHeight!==this.tile.tileHeight){i=i-(this.tileHeight-this.tile.tileHeight)}t.drawImage(r,l,u,c,p,e,i,c,p);return};UITile.prototype.loadTileSets=function(t,e){this.tilesets=[];var i=e.length;var n=t.dirname();this.images={};for(var r=0;r<i;r++){var a=new UITile.TileSet;a.init(this,n,e[r]);this.setImage("option_image_"+r,a.imageURL);this.tilesets.push(a)}return this};UITile.prototype.loadLayers=function(t){this.layers=[];var e=t.length;for(var i=0;i<e;i++){this.layers.push((new UITile.Layer).init(this,t[i]))}return this};UITile.prototype.getMapWidth=function(){return this.mapWidth};UITile.prototype.getMapHeight=function(){return this.mapHeight};UITile.prototype.getLayerNr=function(){return this.layers?this.layers.length:0};UITile.prototype.getLayerByIndex=function(t){if(this.layers&&t<this.layers.length){return this.layers[t]}return null};UITile.prototype.loadJSON=function(t,e){if(this.isIcon)return;if(!e||!e.width||!e.height){console.log("invalid tiled json");return}this.tileRows=e.height;this.tileCols=e.width;this.tileWidth=e.tilewidth;this.tileHeight=e.tileheight;this.orientation=e.orientation;this.renderorder=e.renderorder;this.properties=e.properties;this.mapWidth=this.tileWidth*this.tileCols;this.mapHeight=this.tileHeight*this.tileRows;this.loadTileSets(t,e.tilesets);this.loadLayers(e.layers);if(this.enable){var i=this.getWindow();if(i&&i.isUIScene){i.setMap(this)}}return};UITile.prototype.loadURL=function(t){var e=this;httpGetJSON(t,function(i){e.loadJSON(t,i)});return};UITile.prototype.load=function(){if(this.tiledJsonURL){this.loadURL(this.tiledJsonURL)}return};UITile.prototype.setClipRegion=function(t){this.clipRegion=t;return this};UITile.prototype.isInClipRegion=function(t){if(!this.clipRegion)return true;var e=this.clipRegion;var i=e.length;for(var n=0;n<i;n++){var r=e[n];if(Rect.hasIntersection(r,t)){return true}}return false};UITile.prototype.drawTile=function(t,e,i){if(!this.isInClipRegion(e)){return}var n=this.tilesets.length;for(var r=0;r<n;r++){var a=this.tilesets[r];if(a.testImageIndex(i)){a.drawTile(t,e.x,e.y,i);break}}return};UITile.prototype.draw=function(t,e){if(!this.layers){return}var i=this.layers;var n=i.length;for(var r=0;r<n;r++){i[r].draw(t,e)}return};UITile.prototype.onAppendedInParent=function(){this.load()};UITile.prototype.createBody=function(t,e,i,n,r,a,o){var s=r>>1;var h=a>>1;var l=i+s;var u=n+h;var c=new b2FixtureDef;c.density=o.density;c.friction=o.friction;c.restitution=o.restitution;if(o.groupIndex){c.filter.groupIndex=o.groupIndex}if(o.isSensor){c.isSensor=true}c.shape=new b2PolygonShape;c.shape.SetAsBox(Physics.toMeter(s),Physics.toMeter(h));var p=new b2BodyDef;p.type=o.density?b2Body.b2_dynamicBody:b2Body.b2_staticBody;p.position.Set(Physics.toMeter(l),Physics.toMeter(u));p.allowSleep=true;body=t.CreateBody(p);body.CreateFixture(c);body.name=e;return};UITile.prototype.createLayerBodies=function(t,e,i){var n=i.data;var r=n.length;var a=i.properties||{};var o=i.height;var s=i.width;var h=this.tileWidth;var l=this.tileHeight;var u=i.x?i.x:0;var c=i.y?i.y:0;a.density=0;a.restitution=a.restitution?parseFloat(a.restitution):.5;a.friction=a.friction?parseFloat(a.friction):.5;for(var p=0;p<r;p++){var f=n[p];if(!f)continue;var m=Math.floor(p/s);var d=p%s;var g=u+d*h;var y=c+m*l;this.createBody(t,e+"-"+p,g,y,h,l,a)}return};UITile.prototype.createBodies=function(t){var e=this.layers;var i=e.length;for(var n=0;n<i;n++){var r=e[n];var a=r.info.properties;if(a&&a.physics){this.createLayerBodies(t,n,r.info)}}return};UITile.prototype.onFromJsonDone=function(t){this.load()};UITile.prototype.setTiledJsonURL=function(t){this.tiledJsonURL=t;this.load()};UITile.prototype.getTiledJsonURL=function(){return this.tiledJsonURL};UITile.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}var i=this.getWindow();if(i&&i.isUIScene){if(t){i.setMap(this)}else{if(i.getMap()===this){i.setMap(null)}}}this.enable=t;return};function UITileCreator(){var t=["ui-tile","ui-tile",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITile;return e.initUITile(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UITileCreator);var Box2D={};Box2D.MIN_VALUE=Number.MIN_VALUE;if(Box2D.MIN_VALUE===0){var d=2;while(Box2D.MIN_VALUE===0){Box2D.MIN_VALUE=1/(Number.MAX_VALUE/d);d*=2}}(function(t,e){if(!(Object.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(t,e,i){if(i.get instanceof Function)t.__defineGetter__(e,i.get);if(i.set instanceof Function)t.__defineSetter__(e,i.set)}}function i(){}t.inherit=function(t,e){var n=t;i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=n};t.generateCallback=function n(t,e){return function(){e.apply(t,arguments)}};t.NVector=function r(t){if(t===e)t=0;var i=new Array(t||0);for(var n=0;n<t;++n)i[n]=0;return i};t.is=function a(t,i){if(t===null)return false;if(i instanceof Function&&t instanceof i)return true;if(t.constructor.__implements!=e&&t.constructor.__implements[i])return true;return false};t.parseUInt=function(t){return Math.abs(parseInt(t))}})(Box2D);var Vector=Array;var Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined")Box2D={};if(typeof Box2D.Collision==="undefined")Box2D.Collision={};if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};(function(){Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";function t(){t.b2AABB.apply(this,arguments)}Box2D.Collision.b2AABB=t;function e(){e.b2Bound.apply(this,arguments)}Box2D.Collision.b2Bound=e;function i(){i.b2BoundValues.apply(this,arguments);if(this.constructor===i)this.b2BoundValues.apply(this,arguments)}Box2D.Collision.b2BoundValues=i;function n(){n.b2Collision.apply(this,arguments)}Box2D.Collision.b2Collision=n;function r(){r.b2ContactID.apply(this,arguments);if(this.constructor===r)this.b2ContactID.apply(this,arguments)}Box2D.Collision.b2ContactID=r;function a(){a.b2ContactPoint.apply(this,arguments)}Box2D.Collision.b2ContactPoint=a;function o(){o.b2Distance.apply(this,arguments)}Box2D.Collision.b2Distance=o;function s(){s.b2DistanceInput.apply(this,arguments)}Box2D.Collision.b2DistanceInput=s;function h(){h.b2DistanceOutput.apply(this,arguments)}Box2D.Collision.b2DistanceOutput=h;function l(){l.b2DistanceProxy.apply(this,arguments)}Box2D.Collision.b2DistanceProxy=l;function u(){u.b2DynamicTree.apply(this,arguments);if(this.constructor===u)this.b2DynamicTree.apply(this,arguments)}Box2D.Collision.b2DynamicTree=u;function c(){c.b2DynamicTreeBroadPhase.apply(this,arguments)}Box2D.Collision.b2DynamicTreeBroadPhase=c;function p(){p.b2DynamicTreeNode.apply(this,arguments)}Box2D.Collision.b2DynamicTreeNode=p;function f(){f.b2DynamicTreePair.apply(this,arguments)}Box2D.Collision.b2DynamicTreePair=f;function m(){m.b2Manifold.apply(this,arguments);if(this.constructor===m)this.b2Manifold.apply(this,arguments)}Box2D.Collision.b2Manifold=m;function d(){d.b2ManifoldPoint.apply(this,arguments);if(this.constructor===d)this.b2ManifoldPoint.apply(this,arguments)}Box2D.Collision.b2ManifoldPoint=d;function g(){g.b2Point.apply(this,arguments)}Box2D.Collision.b2Point=g;function y(){y.b2RayCastInput.apply(this,arguments);if(this.constructor===y)this.b2RayCastInput.apply(this,arguments)}Box2D.Collision.b2RayCastInput=y;function v(){v.b2RayCastOutput.apply(this,arguments)}Box2D.Collision.b2RayCastOutput=v;function _(){_.b2Segment.apply(this,arguments)}Box2D.Collision.b2Segment=_;function I(){I.b2SeparationFunction.apply(this,arguments)}Box2D.Collision.b2SeparationFunction=I;function w(){w.b2Simplex.apply(this,arguments);if(this.constructor===w)this.b2Simplex.apply(this,arguments)}Box2D.Collision.b2Simplex=w;function x(){x.b2SimplexCache.apply(this,arguments)}Box2D.Collision.b2SimplexCache=x;function S(){S.b2SimplexVertex.apply(this,arguments)}Box2D.Collision.b2SimplexVertex=S;function C(){C.b2TimeOfImpact.apply(this,arguments)}Box2D.Collision.b2TimeOfImpact=C;function T(){T.b2TOIInput.apply(this,arguments)}Box2D.Collision.b2TOIInput=T;function b(){b.b2WorldManifold.apply(this,arguments);if(this.constructor===b)this.b2WorldManifold.apply(this,arguments)}Box2D.Collision.b2WorldManifold=b;function D(){D.ClipVertex.apply(this,arguments)}Box2D.Collision.ClipVertex=D;function A(){A.Features.apply(this,arguments)}Box2D.Collision.Features=A;function E(){E.b2CircleShape.apply(this,arguments);if(this.constructor===E)this.b2CircleShape.apply(this,arguments)}Box2D.Collision.Shapes.b2CircleShape=E;function U(){U.b2EdgeChainDef.apply(this,arguments);if(this.constructor===U)this.b2EdgeChainDef.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeChainDef=U;function M(){M.b2EdgeShape.apply(this,arguments);if(this.constructor===M)this.b2EdgeShape.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeShape=M;function P(){P.b2MassData.apply(this,arguments)}Box2D.Collision.Shapes.b2MassData=P;function B(){B.b2PolygonShape.apply(this,arguments);if(this.constructor===B)this.b2PolygonShape.apply(this,arguments)}Box2D.Collision.Shapes.b2PolygonShape=B;function L(){L.b2Shape.apply(this,arguments);if(this.constructor===L)this.b2Shape.apply(this,arguments)}Box2D.Collision.Shapes.b2Shape=L;Box2D.Common.b2internal="Box2D.Common.b2internal";function R(){R.b2Color.apply(this,arguments);if(this.constructor===R)this.b2Color.apply(this,arguments)}Box2D.Common.b2Color=R;function O(){O.b2Settings.apply(this,arguments)}Box2D.Common.b2Settings=O;function V(){V.b2Mat22.apply(this,arguments);if(this.constructor===V)this.b2Mat22.apply(this,arguments)}Box2D.Common.Math.b2Mat22=V;function W(){W.b2Mat33.apply(this,arguments);if(this.constructor===W)this.b2Mat33.apply(this,arguments)}Box2D.Common.Math.b2Mat33=W;function F(){F.b2Math.apply(this,arguments)}Box2D.Common.Math.b2Math=F;function N(){N.b2Sweep.apply(this,arguments)}Box2D.Common.Math.b2Sweep=N;function k(){k.b2Transform.apply(this,arguments);if(this.constructor===k)this.b2Transform.apply(this,arguments)}Box2D.Common.Math.b2Transform=k;function G(){G.b2Vec2.apply(this,arguments);if(this.constructor===G)this.b2Vec2.apply(this,arguments)}Box2D.Common.Math.b2Vec2=G;function H(){H.b2Vec3.apply(this,arguments);if(this.constructor===H)this.b2Vec3.apply(this,arguments)}Box2D.Common.Math.b2Vec3=H;function Y(){Y.b2Body.apply(this,arguments);if(this.constructor===Y)this.b2Body.apply(this,arguments)}Box2D.Dynamics.b2Body=Y;function J(){J.b2BodyDef.apply(this,arguments);if(this.constructor===J)this.b2BodyDef.apply(this,arguments)}Box2D.Dynamics.b2BodyDef=J;function X(){X.b2ContactFilter.apply(this,arguments)}Box2D.Dynamics.b2ContactFilter=X;function z(){z.b2ContactImpulse.apply(this,arguments)}Box2D.Dynamics.b2ContactImpulse=z;function K(){K.b2ContactListener.apply(this,arguments)}Box2D.Dynamics.b2ContactListener=K;function j(){j.b2ContactManager.apply(this,arguments);if(this.constructor===j)this.b2ContactManager.apply(this,arguments)}Box2D.Dynamics.b2ContactManager=j;function q(){q.b2DebugDraw.apply(this,arguments);if(this.constructor===q)this.b2DebugDraw.apply(this,arguments)}Box2D.Dynamics.b2DebugDraw=q;function Z(){Z.b2DestructionListener.apply(this,arguments)}Box2D.Dynamics.b2DestructionListener=Z;function Q(){Q.b2FilterData.apply(this,arguments)}Box2D.Dynamics.b2FilterData=Q;function $(){$.b2Fixture.apply(this,arguments);if(this.constructor===$)this.b2Fixture.apply(this,arguments)}Box2D.Dynamics.b2Fixture=$;function tt(){tt.b2FixtureDef.apply(this,arguments);if(this.constructor===tt)this.b2FixtureDef.apply(this,arguments)}Box2D.Dynamics.b2FixtureDef=tt;function et(){et.b2Island.apply(this,arguments);if(this.constructor===et)this.b2Island.apply(this,arguments)}Box2D.Dynamics.b2Island=et;function it(){it.b2TimeStep.apply(this,arguments)}Box2D.Dynamics.b2TimeStep=it;function nt(){nt.b2World.apply(this,arguments);if(this.constructor===nt)this.b2World.apply(this,arguments)}Box2D.Dynamics.b2World=nt;function rt(){rt.b2CircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2CircleContact=rt;function at(){at.b2Contact.apply(this,arguments);if(this.constructor===at)this.b2Contact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2Contact=at;function ot(){ot.b2ContactConstraint.apply(this,arguments);if(this.constructor===ot)this.b2ContactConstraint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraint=ot;function st(){st.b2ContactConstraintPoint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraintPoint=st;function ht(){ht.b2ContactEdge.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactEdge=ht;function lt(){lt.b2ContactFactory.apply(this,arguments);if(this.constructor===lt)this.b2ContactFactory.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactFactory=lt;function ut(){ut.b2ContactRegister.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactRegister=ut;function ct(){ct.b2ContactResult.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactResult=ct;function pt(){pt.b2ContactSolver.apply(this,arguments);if(this.constructor===pt)this.b2ContactSolver.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactSolver=pt;function ft(){ft.b2EdgeAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=ft;function mt(){mt.b2NullContact.apply(this,arguments);if(this.constructor===mt)this.b2NullContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2NullContact=mt;function dt(){dt.b2PolyAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndCircleContact=dt;function gt(){gt.b2PolyAndEdgeContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=gt;function yt(){yt.b2PolygonContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolygonContact=yt;function vt(){vt.b2PositionSolverManifold.apply(this,arguments);if(this.constructor===vt)this.b2PositionSolverManifold.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PositionSolverManifold=vt;function _t(){_t.b2BuoyancyController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2BuoyancyController=_t;function It(){It.b2ConstantAccelController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantAccelController=It;function wt(){wt.b2ConstantForceController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantForceController=wt;function xt(){xt.b2Controller.apply(this,arguments)}Box2D.Dynamics.Controllers.b2Controller=xt;function St(){St.b2ControllerEdge.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ControllerEdge=St;function Ct(){Ct.b2GravityController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2GravityController=Ct;function Tt(){Tt.b2TensorDampingController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2TensorDampingController=Tt;function bt(){bt.b2DistanceJoint.apply(this,arguments);if(this.constructor===bt)this.b2DistanceJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJoint=bt;function Dt(){Dt.b2DistanceJointDef.apply(this,arguments);if(this.constructor===Dt)this.b2DistanceJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJointDef=Dt;function At(){At.b2FrictionJoint.apply(this,arguments);if(this.constructor===At)this.b2FrictionJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJoint=At;function Et(){Et.b2FrictionJointDef.apply(this,arguments);if(this.constructor===Et)this.b2FrictionJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJointDef=Et;function Ut(){Ut.b2GearJoint.apply(this,arguments);if(this.constructor===Ut)this.b2GearJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJoint=Ut;function Mt(){Mt.b2GearJointDef.apply(this,arguments);if(this.constructor===Mt)this.b2GearJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJointDef=Mt;function Pt(){Pt.b2Jacobian.apply(this,arguments)}Box2D.Dynamics.Joints.b2Jacobian=Pt;function Bt(){Bt.b2Joint.apply(this,arguments);if(this.constructor===Bt)this.b2Joint.apply(this,arguments)}Box2D.Dynamics.Joints.b2Joint=Bt;function Lt(){Lt.b2JointDef.apply(this,arguments);if(this.constructor===Lt)this.b2JointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointDef=Lt;function Rt(){Rt.b2JointEdge.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointEdge=Rt;function Ot(){Ot.b2LineJoint.apply(this,arguments);if(this.constructor===Ot)this.b2LineJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJoint=Ot;function Vt(){Vt.b2LineJointDef.apply(this,arguments);if(this.constructor===Vt)this.b2LineJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJointDef=Vt;function Wt(){Wt.b2MouseJoint.apply(this,arguments);if(this.constructor===Wt)this.b2MouseJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJoint=Wt;function Ft(){Ft.b2MouseJointDef.apply(this,arguments);if(this.constructor===Ft)this.b2MouseJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJointDef=Ft;function Nt(){Nt.b2PrismaticJoint.apply(this,arguments);if(this.constructor===Nt)this.b2PrismaticJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJoint=Nt;function kt(){kt.b2PrismaticJointDef.apply(this,arguments);if(this.constructor===kt)this.b2PrismaticJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJointDef=kt;function Gt(){Gt.b2PulleyJoint.apply(this,arguments);if(this.constructor===Gt)this.b2PulleyJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJoint=Gt;function Ht(){Ht.b2PulleyJointDef.apply(this,arguments);if(this.constructor===Ht)this.b2PulleyJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJointDef=Ht;function Yt(){Yt.b2RevoluteJoint.apply(this,arguments);if(this.constructor===Yt)this.b2RevoluteJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJoint=Yt;function Jt(){Jt.b2RevoluteJointDef.apply(this,arguments);if(this.constructor===Jt)this.b2RevoluteJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJointDef=Jt;function Xt(){Xt.b2WeldJoint.apply(this,arguments);if(this.constructor===Xt)this.b2WeldJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJoint=Xt;function zt(){zt.b2WeldJointDef.apply(this,arguments);if(this.constructor===zt)this.b2WeldJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJointDef=zt})();Box2D.postDefs=[];(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,a=Box2D.Collision.Shapes.b2Shape,o=Box2D.Common.b2Color,s=Box2D.Common.b2internal,h=Box2D.Common.b2Settings,l=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,p=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,m=Box2D.Common.Math.b2Vec2,d=Box2D.Common.Math.b2Vec3,g=Box2D.Collision.b2AABB,y=Box2D.Collision.b2Bound,v=Box2D.Collision.b2BoundValues,_=Box2D.Collision.b2Collision,I=Box2D.Collision.b2ContactID,w=Box2D.Collision.b2ContactPoint,x=Box2D.Collision.b2Distance,S=Box2D.Collision.b2DistanceInput,C=Box2D.Collision.b2DistanceOutput,T=Box2D.Collision.b2DistanceProxy,b=Box2D.Collision.b2DynamicTree,D=Box2D.Collision.b2DynamicTreeBroadPhase,A=Box2D.Collision.b2DynamicTreeNode,E=Box2D.Collision.b2DynamicTreePair,U=Box2D.Collision.b2Manifold,M=Box2D.Collision.b2ManifoldPoint,P=Box2D.Collision.b2Point,B=Box2D.Collision.b2RayCastInput,L=Box2D.Collision.b2RayCastOutput,R=Box2D.Collision.b2Segment,O=Box2D.Collision.b2SeparationFunction,V=Box2D.Collision.b2Simplex,W=Box2D.Collision.b2SimplexCache,F=Box2D.Collision.b2SimplexVertex,N=Box2D.Collision.b2TimeOfImpact,k=Box2D.Collision.b2TOIInput,G=Box2D.Collision.b2WorldManifold,H=Box2D.Collision.ClipVertex,Y=Box2D.Collision.Features,J=Box2D.Collision.IBroadPhase;g.b2AABB=function(){this.lowerBound=new m;this.upperBound=new m};g.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x;var e=this.upperBound.y-this.lowerBound.y;var i=t>=0&&e>=0;i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return i};g.prototype.GetCenter=function(){return new m((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};g.prototype.GetExtents=function(){return new m((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};g.prototype.Contains=function(t){var e=true;e=e&&this.lowerBound.x<=t.lowerBound.x;e=e&&this.lowerBound.y<=t.lowerBound.y;e=e&&t.upperBound.x<=this.upperBound.x;e=e&&t.upperBound.y<=this.upperBound.y;return e};g.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE;var n=Number.MAX_VALUE;var r=e.p1.x;var a=e.p1.y;var o=e.p2.x-e.p1.x;var s=e.p2.y-e.p1.y;var h=Math.abs(o);var l=Math.abs(s);var u=t.normal;var c=0;var p=0;var f=0;var m=0;var d=0;{if(h<Box2D.MIN_VALUE){if(r<this.lowerBound.x||this.upperBound.x<r)return false}else{c=1/o;p=(this.lowerBound.x-r)*c;f=(this.upperBound.x-r)*c;d=-1;if(p>f){m=p;p=f;f=m;d=1}if(p>i){u.x=d;u.y=0;i=p}n=Math.min(n,f);if(i>n)return false}}{if(l<Box2D.MIN_VALUE){if(a<this.lowerBound.y||this.upperBound.y<a)return false}else{c=1/s;p=(this.lowerBound.y-a)*c;f=(this.upperBound.y-a)*c;d=-1;if(p>f){m=p;p=f;f=m;d=1}if(p>i){u.y=d;u.x=0;i=p}n=Math.min(n,f);if(i>n)return false}}t.fraction=i;return true};g.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x;var i=t.lowerBound.y-this.upperBound.y;var n=this.lowerBound.x-t.upperBound.x;var r=this.lowerBound.y-t.upperBound.y;if(e>0||i>0)return false;if(n>0||r>0)return false;return true};g.Combine=function(t,e){var i=new g;i.Combine(t,e);return i};g.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x);this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y);this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x);this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)};y.b2Bound=function(){};y.prototype.IsLower=function(){return(this.value&1)==0};y.prototype.IsUpper=function(){return(this.value&1)==1};y.prototype.Swap=function(t){var e=this.value;var i=this.proxy;var n=this.stabbingCount;this.value=t.value;this.proxy=t.proxy;this.stabbingCount=t.stabbingCount;t.value=e;t.proxy=i;t.stabbingCount=n};v.b2BoundValues=function(){};v.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};_.b2Collision=function(){};_.ClipSegmentToLine=function(t,e,i,n){if(n===undefined)n=0;var r;var a=0;r=e[0];var o=r.v;r=e[1];var s=r.v;var h=i.x*o.x+i.y*o.y-n;var l=i.x*s.x+i.y*s.y-n;if(h<=0)t[a++].Set(e[0]);if(l<=0)t[a++].Set(e[1]);if(h*l<0){var u=h/(h-l);r=t[a];var c=r.v;c.x=o.x+u*(s.x-o.x);c.y=o.y+u*(s.y-o.y);r=t[a];var p;if(h>0){p=e[0];r.id=p.id}else{p=e[1];r.id=p.id}++a}return a};_.EdgeSeparation=function(t,e,i,n,r){if(i===undefined)i=0;var a=parseInt(t.m_vertexCount);var o=t.m_vertices;var s=t.m_normals;var h=parseInt(n.m_vertexCount);var l=n.m_vertices;var u;var c;u=e.R;c=s[i];var p=u.col1.x*c.x+u.col2.x*c.y;var f=u.col1.y*c.x+u.col2.y*c.y;u=r.R;var m=u.col1.x*p+u.col1.y*f;var d=u.col2.x*p+u.col2.y*f;var g=0;var y=Number.MAX_VALUE;for(var v=0;v<h;++v){c=l[v];var _=c.x*m+c.y*d;if(_<y){y=_;g=v}}c=o[i];u=e.R;var I=e.position.x+(u.col1.x*c.x+u.col2.x*c.y);var w=e.position.y+(u.col1.y*c.x+u.col2.y*c.y);c=l[g];u=r.R;var x=r.position.x+(u.col1.x*c.x+u.col2.x*c.y);var S=r.position.y+(u.col1.y*c.x+u.col2.y*c.y);x-=I;S-=w;var C=x*p+S*f;return C};_.FindMaxSeparation=function(t,e,i,n,r){var a=parseInt(e.m_vertexCount);var o=e.m_normals;var s;var h;h=r.R;s=n.m_centroid;var l=r.position.x+(h.col1.x*s.x+h.col2.x*s.y);
var u=r.position.y+(h.col1.y*s.x+h.col2.y*s.y);h=i.R;s=e.m_centroid;l-=i.position.x+(h.col1.x*s.x+h.col2.x*s.y);u-=i.position.y+(h.col1.y*s.x+h.col2.y*s.y);var c=l*i.R.col1.x+u*i.R.col1.y;var p=l*i.R.col2.x+u*i.R.col2.y;var f=0;var m=-Number.MAX_VALUE;for(var d=0;d<a;++d){s=o[d];var g=s.x*c+s.y*p;if(g>m){m=g;f=d}}var y=_.EdgeSeparation(e,i,f,n,r);var v=parseInt(f-1>=0?f-1:a-1);var I=_.EdgeSeparation(e,i,v,n,r);var w=parseInt(f+1<a?f+1:0);var x=_.EdgeSeparation(e,i,w,n,r);var S=0;var C=0;var T=0;if(I>y&&I>x){T=-1;S=v;C=I}else if(x>y){T=1;S=w;C=x}else{t[0]=f;return y}while(true){if(T==-1)f=S-1>=0?S-1:a-1;else f=S+1<a?S+1:0;y=_.EdgeSeparation(e,i,f,n,r);if(y>C){S=f;C=y}else{break}}t[0]=S;return C};_.FindIncidentEdge=function(t,e,i,n,r,a){if(n===undefined)n=0;var o=parseInt(e.m_vertexCount);var s=e.m_normals;var h=parseInt(r.m_vertexCount);var l=r.m_vertices;var u=r.m_normals;var c;var p;c=i.R;p=s[n];var f=c.col1.x*p.x+c.col2.x*p.y;var m=c.col1.y*p.x+c.col2.y*p.y;c=a.R;var d=c.col1.x*f+c.col1.y*m;m=c.col2.x*f+c.col2.y*m;f=d;var g=0;var y=Number.MAX_VALUE;for(var v=0;v<h;++v){p=u[v];var _=f*p.x+m*p.y;if(_<y){y=_;g=v}}var I;var w=parseInt(g);var x=parseInt(w+1<h?w+1:0);I=t[0];p=l[w];c=a.R;I.v.x=a.position.x+(c.col1.x*p.x+c.col2.x*p.y);I.v.y=a.position.y+(c.col1.y*p.x+c.col2.y*p.y);I.id.features.referenceEdge=n;I.id.features.incidentEdge=w;I.id.features.incidentVertex=0;I=t[1];p=l[x];c=a.R;I.v.x=a.position.x+(c.col1.x*p.x+c.col2.x*p.y);I.v.y=a.position.y+(c.col1.y*p.x+c.col2.y*p.y);I.id.features.referenceEdge=n;I.id.features.incidentEdge=x;I.id.features.incidentVertex=1};_.MakeClipPointVector=function(){var t=new Vector(2);t[0]=new H;t[1]=new H;return t};_.CollidePolygons=function(t,e,i,n,r){var a;t.m_pointCount=0;var o=e.m_radius+n.m_radius;var s=0;_.s_edgeAO[0]=s;var l=_.FindMaxSeparation(_.s_edgeAO,e,i,n,r);s=_.s_edgeAO[0];if(l>o)return;var u=0;_.s_edgeBO[0]=u;var c=_.FindMaxSeparation(_.s_edgeBO,n,r,e,i);u=_.s_edgeBO[0];if(c>o)return;var p;var f;var m;var d;var g=0;var y=0;var v=.98;var I=.001;var w;if(c>v*l+I){p=n;f=e;m=r;d=i;g=u;t.m_type=U.e_faceB;y=1}else{p=e;f=n;m=i;d=r;g=s;t.m_type=U.e_faceA;y=0}var x=_.s_incidentEdge;_.FindIncidentEdge(x,p,m,g,f,d);var S=parseInt(p.m_vertexCount);var C=p.m_vertices;var T=C[g];var b;if(g+1<S){b=C[parseInt(g+1)]}else{b=C[0]}var D=_.s_localTangent;D.Set(b.x-T.x,b.y-T.y);D.Normalize();var A=_.s_localNormal;A.x=D.y;A.y=-D.x;var E=_.s_planePoint;E.Set(.5*(T.x+b.x),.5*(T.y+b.y));var M=_.s_tangent;w=m.R;M.x=w.col1.x*D.x+w.col2.x*D.y;M.y=w.col1.y*D.x+w.col2.y*D.y;var P=_.s_tangent2;P.x=-M.x;P.y=-M.y;var B=_.s_normal;B.x=M.y;B.y=-M.x;var L=_.s_v11;var R=_.s_v12;L.x=m.position.x+(w.col1.x*T.x+w.col2.x*T.y);L.y=m.position.y+(w.col1.y*T.x+w.col2.y*T.y);R.x=m.position.x+(w.col1.x*b.x+w.col2.x*b.y);R.y=m.position.y+(w.col1.y*b.x+w.col2.y*b.y);var O=B.x*L.x+B.y*L.y;var V=-M.x*L.x-M.y*L.y+o;var W=M.x*R.x+M.y*R.y+o;var F=_.s_clipPoints1;var N=_.s_clipPoints2;var k=0;k=_.ClipSegmentToLine(F,x,P,V);if(k<2)return;k=_.ClipSegmentToLine(N,F,M,W);if(k<2)return;t.m_localPlaneNormal.SetV(A);t.m_localPoint.SetV(E);var G=0;for(var H=0;H<h.b2_maxManifoldPoints;++H){a=N[H];var Y=B.x*a.v.x+B.y*a.v.y-O;if(Y<=o){var J=t.m_points[G];w=d.R;var X=a.v.x-d.position.x;var z=a.v.y-d.position.y;J.m_localPoint.x=X*w.col1.x+z*w.col1.y;J.m_localPoint.y=X*w.col2.x+z*w.col2.y;J.m_id.Set(a.id);J.m_id.features.flip=y;++G}}t.m_pointCount=G};_.CollideCircles=function(t,e,i,n,r){t.m_pointCount=0;var a;var o;a=i.R;o=e.m_p;var s=i.position.x+(a.col1.x*o.x+a.col2.x*o.y);var h=i.position.y+(a.col1.y*o.x+a.col2.y*o.y);a=r.R;o=n.m_p;var l=r.position.x+(a.col1.x*o.x+a.col2.x*o.y);var u=r.position.y+(a.col1.y*o.x+a.col2.y*o.y);var c=l-s;var p=u-h;var f=c*c+p*p;var m=e.m_radius+n.m_radius;if(f>m*m){return}t.m_type=U.e_circles;t.m_localPoint.SetV(e.m_p);t.m_localPlaneNormal.SetZero();t.m_pointCount=1;t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0};_.CollidePolygonAndCircle=function(t,e,i,n,r){t.m_pointCount=0;var a;var o=0;var s=0;var h=0;var l=0;var u;var c;c=r.R;u=n.m_p;var p=r.position.x+(c.col1.x*u.x+c.col2.x*u.y);var f=r.position.y+(c.col1.y*u.x+c.col2.y*u.y);o=p-i.position.x;s=f-i.position.y;c=i.R;var m=o*c.col1.x+s*c.col1.y;var d=o*c.col2.x+s*c.col2.y;var g=0;var y=0;var v=-Number.MAX_VALUE;var _=e.m_radius+n.m_radius;var I=parseInt(e.m_vertexCount);var w=e.m_vertices;var x=e.m_normals;for(var S=0;S<I;++S){u=w[S];o=m-u.x;s=d-u.y;u=x[S];var C=u.x*o+u.y*s;if(C>_){return}if(C>v){v=C;y=S}}var T=parseInt(y);var b=parseInt(T+1<I?T+1:0);var D=w[T];var A=w[b];if(v<Box2D.MIN_VALUE){t.m_pointCount=1;t.m_type=U.e_faceA;t.m_localPlaneNormal.SetV(x[y]);t.m_localPoint.x=.5*(D.x+A.x);t.m_localPoint.y=.5*(D.y+A.y);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0;return}var E=(m-D.x)*(A.x-D.x)+(d-D.y)*(A.y-D.y);var M=(m-A.x)*(D.x-A.x)+(d-A.y)*(D.y-A.y);if(E<=0){if((m-D.x)*(m-D.x)+(d-D.y)*(d-D.y)>_*_)return;t.m_pointCount=1;t.m_type=U.e_faceA;t.m_localPlaneNormal.x=m-D.x;t.m_localPlaneNormal.y=d-D.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(D);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else if(M<=0){if((m-A.x)*(m-A.x)+(d-A.y)*(d-A.y)>_*_)return;t.m_pointCount=1;t.m_type=U.e_faceA;t.m_localPlaneNormal.x=m-A.x;t.m_localPlaneNormal.y=d-A.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(A);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else{var P=.5*(D.x+A.x);var B=.5*(D.y+A.y);v=(m-P)*x[T].x+(d-B)*x[T].y;if(v>_)return;t.m_pointCount=1;t.m_type=U.e_faceA;t.m_localPlaneNormal.x=x[T].x;t.m_localPlaneNormal.y=x[T].y;t.m_localPlaneNormal.Normalize();t.m_localPoint.Set(P,B);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}};_.TestOverlap=function(t,e){var i=e.lowerBound;var n=t.upperBound;var r=i.x-n.x;var a=i.y-n.y;i=t.lowerBound;n=e.upperBound;var o=i.x-n.x;var s=i.y-n.y;if(r>0||a>0)return false;if(o>0||s>0)return false;return true};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new m;Box2D.Collision.b2Collision.s_localNormal=new m;Box2D.Collision.b2Collision.s_planePoint=new m;Box2D.Collision.b2Collision.s_normal=new m;Box2D.Collision.b2Collision.s_tangent=new m;Box2D.Collision.b2Collision.s_tangent2=new m;Box2D.Collision.b2Collision.s_v11=new m;Box2D.Collision.b2Collision.s_v12=new m;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new m;Box2D.Collision.b2Collision.b2_nullFeature=255});I.b2ContactID=function(){this.features=new Y};I.prototype.b2ContactID=function(){this.features._m_id=this};I.prototype.Set=function(t){this.key=t._key};I.prototype.Copy=function(){var t=new I;t.key=this.key;return t};Object.defineProperty(I.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(I.prototype,"key",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._key=t;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});w.b2ContactPoint=function(){this.position=new m;this.velocity=new m;this.normal=new m;this.id=new I};x.b2Distance=function(){};x.Distance=function(t,e,i){++x.b2_gjkCalls;var n=i.proxyA;var r=i.proxyB;var a=i.transformA;var o=i.transformB;var s=x.s_simplex;s.ReadCache(e,n,a,r,o);var l=s.m_vertices;var u=20;var p=x.s_saveA;var f=x.s_saveB;var d=0;var g=s.GetClosestPoint();var y=g.LengthSquared();var v=y;var _=0;var I;var w=0;while(w<u){d=s.m_count;for(_=0;_<d;_++){p[_]=l[_].indexA;f[_]=l[_].indexB}switch(s.m_count){case 1:break;case 2:s.Solve2();break;case 3:s.Solve3();break;default:h.b2Assert(false)}if(s.m_count==3){break}I=s.GetClosestPoint();v=I.LengthSquared();if(v>y){}y=v;var S=s.GetSearchDirection();if(S.LengthSquared()<Box2D.MIN_VALUE*Box2D.MIN_VALUE){break}var C=l[s.m_count];C.indexA=n.GetSupport(c.MulTMV(a.R,S.GetNegative()));C.wA=c.MulX(a,n.GetVertex(C.indexA));C.indexB=r.GetSupport(c.MulTMV(o.R,S));C.wB=c.MulX(o,r.GetVertex(C.indexB));C.w=c.SubtractVV(C.wB,C.wA);++w;++x.b2_gjkIters;var T=false;for(_=0;_<d;_++){if(C.indexA==p[_]&&C.indexB==f[_]){T=true;break}}if(T){break}++s.m_count}x.b2_gjkMaxIters=c.Max(x.b2_gjkMaxIters,w);s.GetWitnessPoints(t.pointA,t.pointB);t.distance=c.SubtractVV(t.pointA,t.pointB).Length();t.iterations=w;s.WriteCache(e);if(i.useRadii){var b=n.m_radius;var D=r.m_radius;if(t.distance>b+D&&t.distance>Box2D.MIN_VALUE){t.distance-=b+D;var A=c.SubtractVV(t.pointB,t.pointA);A.Normalize();t.pointA.x+=b*A.x;t.pointA.y+=b*A.y;t.pointB.x-=D*A.x;t.pointB.y-=D*A.y}else{I=new m;I.x=.5*(t.pointA.x+t.pointB.x);I.y=.5*(t.pointA.y+t.pointB.y);t.pointA.x=t.pointB.x=I.x;t.pointA.y=t.pointB.y=I.y;t.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new V;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});S.b2DistanceInput=function(){};C.b2DistanceOutput=function(){this.pointA=new m;this.pointB=new m};T.b2DistanceProxy=function(){};T.prototype.Set=function(e){switch(e.GetType()){case a.e_circleShape:{var i=e instanceof t?e:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=i.m_p;this.m_count=1;this.m_radius=i.m_radius}break;case a.e_polygonShape:{var n=e instanceof r?e:null;this.m_vertices=n.m_vertices;this.m_count=n.m_vertexCount;this.m_radius=n.m_radius}break;default:h.b2Assert(false)}};T.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return e};T.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return this.m_vertices[e]};T.prototype.GetVertexCount=function(){return this.m_count};T.prototype.GetVertex=function(t){if(t===undefined)t=0;h.b2Assert(0<=t&&t<this.m_count);return this.m_vertices[t]};b.b2DynamicTree=function(){};b.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};b.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();var n=h.b2_aabbExtension;var r=h.b2_aabbExtension;i.aabb.lowerBound.x=t.lowerBound.x-n;i.aabb.lowerBound.y=t.lowerBound.y-r;i.aabb.upperBound.x=t.upperBound.x+n;i.aabb.upperBound.y=t.upperBound.y+r;i.userData=e;this.InsertLeaf(i);return i};b.prototype.DestroyProxy=function(t){this.RemoveLeaf(t);this.FreeNode(t)};b.prototype.MoveProxy=function(t,e,i){h.b2Assert(t.IsLeaf());if(t.aabb.Contains(e)){return false}this.RemoveLeaf(t);var n=h.b2_aabbExtension+h.b2_aabbMultiplier*(i.x>0?i.x:-i.x);var r=h.b2_aabbExtension+h.b2_aabbMultiplier*(i.y>0?i.y:-i.y);t.aabb.lowerBound.x=e.lowerBound.x-n;t.aabb.lowerBound.y=e.lowerBound.y-r;t.aabb.upperBound.x=e.upperBound.x+n;t.aabb.upperBound.y=e.upperBound.y+r;this.InsertLeaf(t);return true};b.prototype.Rebalance=function(t){if(t===undefined)t=0;if(this.m_root==null)return;for(var e=0;e<t;e++){var i=this.m_root;var n=0;while(i.IsLeaf()==false){i=this.m_path>>n&1?i.child2:i.child1;n=n+1&31}++this.m_path;this.RemoveLeaf(i);this.InsertLeaf(i)}};b.prototype.GetFatAABB=function(t){return t.aabb};b.prototype.GetUserData=function(t){return t.userData};b.prototype.Query=function(t,e){if(this.m_root==null)return;var i=new Vector;var n=0;i[n++]=this.m_root;while(n>0){var r=i[--n];if(r.aabb.TestOverlap(e)){if(r.IsLeaf()){var a=t(r);if(!a)return}else{i[n++]=r.child1;i[n++]=r.child2}}}};b.prototype.RayCast=function(t,e){if(this.m_root==null)return;var i=e.p1;var n=e.p2;var r=c.SubtractVV(i,n);r.Normalize();var a=c.CrossFV(1,r);var o=c.AbsV(a);var s=e.maxFraction;var h=new g;var l=0;var u=0;{l=i.x+s*(n.x-i.x);u=i.y+s*(n.y-i.y);h.lowerBound.x=Math.min(i.x,l);h.lowerBound.y=Math.min(i.y,u);h.upperBound.x=Math.max(i.x,l);h.upperBound.y=Math.max(i.y,u)}var p=new Vector;var f=0;p[f++]=this.m_root;while(f>0){var m=p[--f];if(m.aabb.TestOverlap(h)==false){continue}var d=m.aabb.GetCenter();var y=m.aabb.GetExtents();var v=Math.abs(a.x*(i.x-d.x)+a.y*(i.y-d.y))-o.x*y.x-o.y*y.y;if(v>0)continue;if(m.IsLeaf()){var _=new B;_.p1=e.p1;_.p2=e.p2;_.maxFraction=e.maxFraction;s=t(_,m);if(s==0)return;if(s>0){l=i.x+s*(n.x-i.x);u=i.y+s*(n.y-i.y);h.lowerBound.x=Math.min(i.x,l);h.lowerBound.y=Math.min(i.y,u);h.upperBound.x=Math.max(i.x,l);h.upperBound.y=Math.max(i.y,u)}}else{p[f++]=m.child1;p[f++]=m.child2}}};b.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;this.m_freeList=t.parent;t.parent=null;t.child1=null;t.child2=null;return t}return new A};b.prototype.FreeNode=function(t){t.parent=this.m_freeList;this.m_freeList=t};b.prototype.InsertLeaf=function(t){++this.m_insertionCount;if(this.m_root==null){this.m_root=t;this.m_root.parent=null;return}var e=t.aabb.GetCenter();var i=this.m_root;if(i.IsLeaf()==false){do{var n=i.child1;var r=i.child2;var a=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y);var o=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-e.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-e.y);if(a<o){i=n}else{i=r}}while(i.IsLeaf()==false)}var s=i.parent;var h=this.AllocateNode();h.parent=s;h.userData=null;h.aabb.Combine(t.aabb,i.aabb);if(s){if(i.parent.child1==i){s.child1=h}else{s.child2=h}h.child1=i;h.child2=t;i.parent=h;t.parent=h;do{if(s.aabb.Contains(h.aabb))break;s.aabb.Combine(s.child1.aabb,s.child2.aabb);h=s;s=s.parent}while(s)}else{h.child1=i;h.child2=t;i.parent=h;t.parent=h;this.m_root=h}};b.prototype.RemoveLeaf=function(t){if(t==this.m_root){this.m_root=null;return}var e=t.parent;var i=e.parent;var n;if(e.child1==t){n=e.child2}else{n=e.child1}if(i){if(i.child1==e){i.child1=n}else{i.child2=n}n.parent=i;this.FreeNode(e);while(i){var r=i.aabb;i.aabb=g.Combine(i.child1.aabb,i.child2.aabb);if(r.Contains(i.aabb))break;i=i.parent}}else{this.m_root=n;n.parent=null;this.FreeNode(e)}};D.b2DynamicTreeBroadPhase=function(){this.m_tree=new b;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};D.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);++this.m_proxyCount;this.BufferMove(i);return i};D.prototype.DestroyProxy=function(t){this.UnBufferMove(t);--this.m_proxyCount;this.m_tree.DestroyProxy(t)};D.prototype.MoveProxy=function(t,e,i){var n=this.m_tree.MoveProxy(t,e,i);if(n){this.BufferMove(t)}};D.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t);var n=this.m_tree.GetFatAABB(e);return i.TestOverlap(n)};D.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)};D.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)};D.prototype.GetProxyCount=function(){return this.m_proxyCount};D.prototype.UpdatePairs=function(t){var e=this;e.m_pairCount=0;var i=0,n;for(i=0;i<e.m_moveBuffer.length;++i){n=e.m_moveBuffer[i];function r(t){if(t==n)return true;if(e.m_pairCount==e.m_pairBuffer.length){e.m_pairBuffer[e.m_pairCount]=new E}var i=e.m_pairBuffer[e.m_pairCount];i.proxyA=t<n?t:n;i.proxyB=t>=n?t:n;++e.m_pairCount;return true}var a=e.m_tree.GetFatAABB(n);e.m_tree.Query(r,a)}e.m_moveBuffer.length=0;for(var i=0;i<e.m_pairCount;){var o=e.m_pairBuffer[i];var s=e.m_tree.GetUserData(o.proxyA);var h=e.m_tree.GetUserData(o.proxyB);t(s,h);++i;while(i<e.m_pairCount){var l=e.m_pairBuffer[i];if(l.proxyA!=o.proxyA||l.proxyB!=o.proxyB){break}++i}}};D.prototype.Query=function(t,e){this.m_tree.Query(t,e)};D.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)};D.prototype.Validate=function(){};D.prototype.Rebalance=function(t){if(t===undefined)t=0;this.m_tree.Rebalance(t)};D.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t};D.prototype.UnBufferMove=function(t){var e=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(e,1)};D.prototype.ComparePairs=function(t,e){return 0};D.__implements={};D.__implements[J]=true;A.b2DynamicTreeNode=function(){this.aabb=new g};A.prototype.IsLeaf=function(){return this.child1==null};E.b2DynamicTreePair=function(){};U.b2Manifold=function(){this.m_pointCount=0};U.prototype.b2Manifold=function(){this.m_points=new Vector(h.b2_maxManifoldPoints);for(var t=0;t<h.b2_maxManifoldPoints;t++){this.m_points[t]=new M}this.m_localPlaneNormal=new m;this.m_localPoint=new m};U.prototype.Reset=function(){for(var t=0;t<h.b2_maxManifoldPoints;t++){(this.m_points[t]instanceof M?this.m_points[t]:null).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};U.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<h.b2_maxManifoldPoints;e++){(this.m_points[e]instanceof M?this.m_points[e]:null).Set(t.m_points[e])}this.m_localPlaneNormal.SetV(t.m_localPlaneNormal);this.m_localPoint.SetV(t.m_localPoint);this.m_type=t.m_type};U.prototype.Copy=function(){var t=new U;t.Set(this);return t};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});M.b2ManifoldPoint=function(){this.m_localPoint=new m;this.m_id=new I};M.prototype.b2ManifoldPoint=function(){this.Reset()};M.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};M.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint);this.m_normalImpulse=t.m_normalImpulse;this.m_tangentImpulse=t.m_tangentImpulse;this.m_id.Set(t.m_id)};P.b2Point=function(){this.p=new m};P.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;return this.p};P.prototype.GetFirstVertex=function(t){return this.p};B.b2RayCastInput=function(){this.p1=new m;this.p2=new m};B.prototype.b2RayCastInput=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=1;if(t)this.p1.SetV(t);if(e)this.p2.SetV(e);this.maxFraction=i};L.b2RayCastOutput=function(){this.normal=new m};R.b2Segment=function(){this.p1=new m;this.p2=new m};R.prototype.TestSegment=function(t,e,i,n){if(n===undefined)n=0;var r=i.p1;var a=i.p2.x-r.x;var o=i.p2.y-r.y;var s=this.p2.x-this.p1.x;var h=this.p2.y-this.p1.y;var l=h;var u=-s;var c=100*Box2D.MIN_VALUE;var p=-(a*l+o*u);if(p>c){var f=r.x-this.p1.x;var m=r.y-this.p1.y;var d=f*l+m*u;if(0<=d&&d<=n*p){var g=-a*m+o*f;if(-c*p<=g&&g<=p*(1+c)){d/=p;var y=Math.sqrt(l*l+u*u);l/=y;u/=y;t[0]=d;e.Set(l,u);return true}}}return false};R.prototype.Extend=function(t){this.ExtendForward(t);this.ExtendBackward(t)};R.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x;var i=this.p2.y-this.p1.y;var n=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:e<0?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:i<0?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*n;this.p2.y=this.p1.y+i*n};R.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x;var i=-this.p2.y+this.p1.y;var n=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:e<0?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:i<0?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*n;this.p1.y=this.p2.y+i*n};O.b2SeparationFunction=function(){this.m_localPoint=new m;this.m_axis=new m};O.prototype.Initialize=function(t,e,i,n,r){this.m_proxyA=e;this.m_proxyB=n;var a=parseInt(t.count);h.b2Assert(0<a&&a<3);var o;var s;var l;var u;var p;var f;var d=0;var g=0;var y=0;var v=0;var _=0;var I=0;var w;var x;var S=0;var C=0;if(a==1){this.m_type=O.e_points;o=this.m_proxyA.GetVertex(t.indexA[0]);u=this.m_proxyB.GetVertex(t.indexB[0]);x=o;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);g=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=u;w=r.R;y=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);this.m_axis.x=y-d;this.m_axis.y=v-g;this.m_axis.Normalize()}else if(t.indexB[0]==t.indexB[1]){this.m_type=O.e_faceA;s=this.m_proxyA.GetVertex(t.indexA[0]);l=this.m_proxyA.GetVertex(t.indexA[1]);u=this.m_proxyB.GetVertex(t.indexB[0]);this.m_localPoint.x=.5*(s.x+l.x);this.m_localPoint.y=.5*(s.y+l.y);this.m_axis=c.CrossVF(c.SubtractVV(l,s),1);this.m_axis.Normalize();x=this.m_axis;w=i.R;_=w.col1.x*x.x+w.col2.x*x.y;I=w.col1.y*x.x+w.col2.y*x.y;x=this.m_localPoint;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);g=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=u;w=r.R;y=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);S=(y-d)*_+(v-g)*I;if(S<0){this.m_axis.NegativeSelf()}}else if(t.indexA[0]==t.indexA[0]){this.m_type=O.e_faceB;p=this.m_proxyB.GetVertex(t.indexB[0]);f=this.m_proxyB.GetVertex(t.indexB[1]);o=this.m_proxyA.GetVertex(t.indexA[0]);this.m_localPoint.x=.5*(p.x+f.x);this.m_localPoint.y=.5*(p.y+f.y);this.m_axis=c.CrossVF(c.SubtractVV(f,p),1);this.m_axis.Normalize();x=this.m_axis;w=r.R;_=w.col1.x*x.x+w.col2.x*x.y;I=w.col1.y*x.x+w.col2.y*x.y;x=this.m_localPoint;w=r.R;y=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=o;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);g=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);S=(d-y)*_+(g-v)*I;if(S<0){this.m_axis.NegativeSelf()}}else{s=this.m_proxyA.GetVertex(t.indexA[0]);l=this.m_proxyA.GetVertex(t.indexA[1]);p=this.m_proxyB.GetVertex(t.indexB[0]);f=this.m_proxyB.GetVertex(t.indexB[1]);var T=c.MulX(i,o);var b=c.MulMV(i.R,c.SubtractVV(l,s));var D=c.MulX(r,u);var A=c.MulMV(r.R,c.SubtractVV(f,p));var E=b.x*b.x+b.y*b.y;var U=A.x*A.x+A.y*A.y;var M=c.SubtractVV(A,b);var P=b.x*M.x+b.y*M.y;var B=A.x*M.x+A.y*M.y;var L=b.x*A.x+b.y*A.y;var R=E*U-L*L;S=0;if(R!=0){S=c.Clamp((L*B-P*U)/R,0,1)}var V=(L*S+B)/U;if(V<0){V=0;S=c.Clamp((L-P)/E,0,1)}o=new m;o.x=s.x+S*(l.x-s.x);o.y=s.y+S*(l.y-s.y);u=new m;u.x=p.x+S*(f.x-p.x);u.y=p.y+S*(f.y-p.y);if(S==0||S==1){this.m_type=O.e_faceB;this.m_axis=c.CrossVF(c.SubtractVV(f,p),1);this.m_axis.Normalize();this.m_localPoint=u;x=this.m_axis;w=r.R;_=w.col1.x*x.x+w.col2.x*x.y;I=w.col1.y*x.x+w.col2.y*x.y;x=this.m_localPoint;w=r.R;y=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=o;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);g=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);C=(d-y)*_+(g-v)*I;if(S<0){this.m_axis.NegativeSelf()}}else{this.m_type=O.e_faceA;this.m_axis=c.CrossVF(c.SubtractVV(l,s),1);this.m_localPoint=o;x=this.m_axis;w=i.R;_=w.col1.x*x.x+w.col2.x*x.y;I=w.col1.y*x.x+w.col2.y*x.y;x=this.m_localPoint;w=i.R;d=i.position.x+(w.col1.x*x.x+w.col2.x*x.y);g=i.position.y+(w.col1.y*x.x+w.col2.y*x.y);x=u;w=r.R;y=r.position.x+(w.col1.x*x.x+w.col2.x*x.y);v=r.position.y+(w.col1.y*x.x+w.col2.y*x.y);C=(y-d)*_+(v-g)*I;if(S<0){this.m_axis.NegativeSelf()}}}};O.prototype.Evaluate=function(t,e){var i;var n;var r;var a;var o;var s;var l=0;var u;switch(this.m_type){case O.e_points:{i=c.MulTMV(t.R,this.m_axis);n=c.MulTMV(e.R,this.m_axis.GetNegative());r=this.m_proxyA.GetSupportVertex(i);a=this.m_proxyB.GetSupportVertex(n);o=c.MulX(t,r);s=c.MulX(e,a);l=(s.x-o.x)*this.m_axis.x+(s.y-o.y)*this.m_axis.y;return l}case O.e_faceA:{u=c.MulMV(t.R,this.m_axis);o=c.MulX(t,this.m_localPoint);n=c.MulTMV(e.R,u.GetNegative());a=this.m_proxyB.GetSupportVertex(n);s=c.MulX(e,a);l=(s.x-o.x)*u.x+(s.y-o.y)*u.y;return l}case O.e_faceB:{u=c.MulMV(e.R,this.m_axis);s=c.MulX(e,this.m_localPoint);i=c.MulTMV(t.R,u.GetNegative());r=this.m_proxyA.GetSupportVertex(i);o=c.MulX(t,r);l=(o.x-s.x)*u.x+(o.y-s.y)*u.y;return l}default:h.b2Assert(false);return 0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});V.b2Simplex=function(){this.m_v1=new F;this.m_v2=new F;this.m_v3=new F;this.m_vertices=new Vector(3)};V.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};V.prototype.ReadCache=function(t,e,i,n,r){h.b2Assert(0<=t.count&&t.count<=3);var a;var o;this.m_count=t.count;var s=this.m_vertices;for(var l=0;l<this.m_count;l++){var u=s[l];u.indexA=t.indexA[l];u.indexB=t.indexB[l];a=e.GetVertex(u.indexA);o=n.GetVertex(u.indexB);u.wA=c.MulX(i,a);u.wB=c.MulX(r,o);u.w=c.SubtractVV(u.wB,u.wA);u.a=0}if(this.m_count>1){var p=t.metric;var f=this.GetMetric();if(f<.5*p||2*p<f||f<Box2D.MIN_VALUE){this.m_count=0}}if(this.m_count==0){u=s[0];u.indexA=0;u.indexB=0;a=e.GetVertex(0);o=n.GetVertex(0);u.wA=c.MulX(i,a);u.wB=c.MulX(r,o);u.w=c.SubtractVV(u.wB,u.wA);this.m_count=1}};V.prototype.WriteCache=function(t){t.metric=this.GetMetric();t.count=Box2D.parseUInt(this.m_count);var e=this.m_vertices;for(var i=0;i<this.m_count;i++){t.indexA[i]=Box2D.parseUInt(e[i].indexA);t.indexB[i]=Box2D.parseUInt(e[i].indexB)}};V.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:{var t=c.SubtractVV(this.m_v2.w,this.m_v1.w);var e=c.CrossVV(t,this.m_v1.w.GetNegative());if(e>0){return c.CrossFV(1,t)}else{return c.CrossVF(t,1)}}default:h.b2Assert(false);return new m}};V.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:h.b2Assert(false);return new m;case 1:return this.m_v1.w;case 2:return new m(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:h.b2Assert(false);return new m}};V.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:h.b2Assert(false);break;case 1:t.SetV(this.m_v1.wA);e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:h.b2Assert(false);break}};V.prototype.GetMetric=function(){switch(this.m_count){case 0:h.b2Assert(false);return 0;case 1:return 0;case 2:return c.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return c.CrossVV(c.SubtractVV(this.m_v2.w,this.m_v1.w),c.SubtractVV(this.m_v3.w,this.m_v1.w));default:h.b2Assert(false);return 0}};V.prototype.Solve2=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=c.SubtractVV(e,t);var n=-(t.x*i.x+t.y*i.y);if(n<=0){this.m_v1.a=1;this.m_count=1;return}var r=e.x*i.x+e.y*i.y;if(r<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}var a=1/(r+n);this.m_v1.a=r*a;this.m_v2.a=n*a;this.m_count=2};V.prototype.Solve3=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=this.m_v3.w;var n=c.SubtractVV(e,t);var r=c.Dot(t,n);var a=c.Dot(e,n);var o=a;var s=-r;var h=c.SubtractVV(i,t);var l=c.Dot(t,h);var u=c.Dot(i,h);var p=u;var f=-l;var m=c.SubtractVV(i,e);var d=c.Dot(e,m);var g=c.Dot(i,m);var y=g;var v=-d;var _=c.CrossVV(n,h);var I=_*c.CrossVV(e,i);var w=_*c.CrossVV(i,t);var x=_*c.CrossVV(t,e);if(s<=0&&f<=0){this.m_v1.a=1;this.m_count=1;return}if(o>0&&s>0&&x<=0){var S=1/(o+s);this.m_v1.a=o*S;this.m_v2.a=s*S;this.m_count=2;return}if(p>0&&f>0&&w<=0){var C=1/(p+f);this.m_v1.a=p*C;this.m_v3.a=f*C;this.m_count=2;this.m_v2.Set(this.m_v3);return}if(o<=0&&v<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}if(p<=0&&y<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3);return}if(y>0&&v>0&&I<=0){var T=1/(y+v);this.m_v2.a=y*T;this.m_v3.a=v*T;this.m_count=2;this.m_v1.Set(this.m_v3);return}var b=1/(I+w+x);this.m_v1.a=I*b;this.m_v2.a=w*b;this.m_v3.a=x*b;this.m_count=3};W.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};F.b2SimplexVertex=function(){};F.prototype.Set=function(t){this.wA.SetV(t.wA);this.wB.SetV(t.wB);this.w.SetV(t.w);this.a=t.a;this.indexA=t.indexA;this.indexB=t.indexB};N.b2TimeOfImpact=function(){};N.TimeOfImpact=function(t){++N.b2_toiCalls;var e=t.proxyA;var i=t.proxyB;var n=t.sweepA;var r=t.sweepB;h.b2Assert(n.t0==r.t0);h.b2Assert(1-n.t0>Box2D.MIN_VALUE);var a=e.m_radius+i.m_radius;var o=t.tolerance;var s=0;var l=1e3;var u=0;var p=0;N.s_cache.count=0;N.s_distanceInput.useRadii=false;for(;;){n.GetTransform(N.s_xfA,s);r.GetTransform(N.s_xfB,s);N.s_distanceInput.proxyA=e;N.s_distanceInput.proxyB=i;N.s_distanceInput.transformA=N.s_xfA;N.s_distanceInput.transformB=N.s_xfB;x.Distance(N.s_distanceOutput,N.s_cache,N.s_distanceInput);if(N.s_distanceOutput.distance<=0){s=1;break}N.s_fcn.Initialize(N.s_cache,e,N.s_xfA,i,N.s_xfB);var f=N.s_fcn.Evaluate(N.s_xfA,N.s_xfB);if(f<=0){s=1;break}if(u==0){if(f>a){p=c.Max(a-o,.75*a)}else{p=c.Max(f-o,.02*a)}}if(f-p<.5*o){if(u==0){s=1;break}break}var m=s;{var d=s;var g=1;var y=f;n.GetTransform(N.s_xfA,g);r.GetTransform(N.s_xfB,g);var v=N.s_fcn.Evaluate(N.s_xfA,N.s_xfB);if(v>=p){s=1;break}var _=0;for(;;){var I=0;if(_&1){I=d+(p-y)*(g-d)/(v-y)}else{I=.5*(d+g)}n.GetTransform(N.s_xfA,I);r.GetTransform(N.s_xfB,I);var w=N.s_fcn.Evaluate(N.s_xfA,N.s_xfB);if(c.Abs(w-p)<.025*o){m=I;break}if(w>p){d=I;y=w}else{g=I;v=w}++_;++N.b2_toiRootIters;if(_==50){break}}N.b2_toiMaxRootIters=c.Max(N.b2_toiMaxRootIters,_)}if(m<(1+100*Box2D.MIN_VALUE)*s){break}s=m;u++;++N.b2_toiIters;if(u==l){break}}N.b2_toiMaxIters=c.Max(N.b2_toiMaxIters,u);return s};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new W;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new S;Box2D.Collision.b2TimeOfImpact.s_xfA=new f;Box2D.Collision.b2TimeOfImpact.s_xfB=new f;Box2D.Collision.b2TimeOfImpact.s_fcn=new O;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new C});k.b2TOIInput=function(){this.proxyA=new T;this.proxyB=new T;this.sweepA=new p;this.sweepB=new p};G.b2WorldManifold=function(){this.m_normal=new m};G.prototype.b2WorldManifold=function(){this.m_points=new Vector(h.b2_maxManifoldPoints);for(var t=0;t<h.b2_maxManifoldPoints;t++){this.m_points[t]=new m}};G.prototype.Initialize=function(t,e,i,n,r){if(i===undefined)i=0;if(r===undefined)r=0;if(t.m_pointCount==0){return}var a=0;var o;var s;var h=0;var l=0;var u=0;var c=0;var p=0;var f=0;switch(t.m_type){case U.e_circles:{s=e.R;o=t.m_localPoint;var m=e.position.x+s.col1.x*o.x+s.col2.x*o.y;var d=e.position.y+s.col1.y*o.x+s.col2.y*o.y;s=n.R;o=t.m_points[0].m_localPoint;var g=n.position.x+s.col1.x*o.x+s.col2.x*o.y;var y=n.position.y+s.col1.y*o.x+s.col2.y*o.y;var v=g-m;var _=y-d;var I=v*v+_*_;if(I>Box2D.MIN_VALUE*Box2D.MIN_VALUE){var w=Math.sqrt(I);this.m_normal.x=v/w;this.m_normal.y=_/w}else{this.m_normal.x=1;this.m_normal.y=0}var x=m+i*this.m_normal.x;var S=d+i*this.m_normal.y;var C=g-r*this.m_normal.x;var T=y-r*this.m_normal.y;this.m_points[0].x=.5*(x+C);this.m_points[0].y=.5*(S+T)}break;case U.e_faceA:{s=e.R;o=t.m_localPlaneNormal;h=s.col1.x*o.x+s.col2.x*o.y;l=s.col1.y*o.x+s.col2.y*o.y;s=e.R;o=t.m_localPoint;u=e.position.x+s.col1.x*o.x+s.col2.x*o.y;c=e.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_normal.x=h;this.m_normal.y=l;for(a=0;a<t.m_pointCount;a++){s=n.R;o=t.m_points[a].m_localPoint;p=n.position.x+s.col1.x*o.x+s.col2.x*o.y;f=n.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_points[a].x=p+.5*(i-(p-u)*h-(f-c)*l-r)*h;this.m_points[a].y=f+.5*(i-(p-u)*h-(f-c)*l-r)*l}}break;case U.e_faceB:{s=n.R;o=t.m_localPlaneNormal;h=s.col1.x*o.x+s.col2.x*o.y;l=s.col1.y*o.x+s.col2.y*o.y;s=n.R;o=t.m_localPoint;u=n.position.x+s.col1.x*o.x+s.col2.x*o.y;c=n.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_normal.x=-h;this.m_normal.y=-l;for(a=0;a<t.m_pointCount;a++){s=e.R;o=t.m_points[a].m_localPoint;p=e.position.x+s.col1.x*o.x+s.col2.x*o.y;f=e.position.y+s.col1.y*o.x+s.col2.y*o.y;
this.m_points[a].x=p+.5*(r-(p-u)*h-(f-c)*l-i)*h;this.m_points[a].y=f+.5*(r-(p-u)*h-(f-c)*l-i)*l}}break}};H.ClipVertex=function(){this.v=new m;this.id=new I};H.prototype.Set=function(t){this.v.SetV(t.v);this.id.Set(t.id)};Y.Features=function(){};Object.defineProperty(Y.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(Y.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._referenceEdge=t;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(Y.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(Y.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentEdge=t;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(Y.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(Y.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentVertex=t;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(Y.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(Y.prototype,"flip",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._flip=t;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Collision.Shapes.b2CircleShape,r=Box2D.Collision.Shapes.b2EdgeChainDef,a=Box2D.Collision.Shapes.b2EdgeShape,o=Box2D.Collision.Shapes.b2MassData,s=Box2D.Collision.Shapes.b2PolygonShape,h=Box2D.Collision.Shapes.b2Shape,l=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,p=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,m=Box2D.Common.Math.b2Vec2,d=Box2D.Common.Math.b2Vec3,g=Box2D.Dynamics.b2Body,y=Box2D.Dynamics.b2BodyDef,v=Box2D.Dynamics.b2ContactFilter,_=Box2D.Dynamics.b2ContactImpulse,I=Box2D.Dynamics.b2ContactListener,w=Box2D.Dynamics.b2ContactManager,x=Box2D.Dynamics.b2DebugDraw,S=Box2D.Dynamics.b2DestructionListener,C=Box2D.Dynamics.b2FilterData,T=Box2D.Dynamics.b2Fixture,b=Box2D.Dynamics.b2FixtureDef,D=Box2D.Dynamics.b2Island,A=Box2D.Dynamics.b2TimeStep,E=Box2D.Dynamics.b2World,U=Box2D.Collision.b2AABB,M=Box2D.Collision.b2Bound,P=Box2D.Collision.b2BoundValues,B=Box2D.Collision.b2Collision,L=Box2D.Collision.b2ContactID,R=Box2D.Collision.b2ContactPoint,O=Box2D.Collision.b2Distance,V=Box2D.Collision.b2DistanceInput,W=Box2D.Collision.b2DistanceOutput,F=Box2D.Collision.b2DistanceProxy,N=Box2D.Collision.b2DynamicTree,k=Box2D.Collision.b2DynamicTreeBroadPhase,G=Box2D.Collision.b2DynamicTreeNode,H=Box2D.Collision.b2DynamicTreePair,Y=Box2D.Collision.b2Manifold,J=Box2D.Collision.b2ManifoldPoint,X=Box2D.Collision.b2Point,z=Box2D.Collision.b2RayCastInput,K=Box2D.Collision.b2RayCastOutput,j=Box2D.Collision.b2Segment,q=Box2D.Collision.b2SeparationFunction,Z=Box2D.Collision.b2Simplex,Q=Box2D.Collision.b2SimplexCache,$=Box2D.Collision.b2SimplexVertex,tt=Box2D.Collision.b2TimeOfImpact,et=Box2D.Collision.b2TOIInput,it=Box2D.Collision.b2WorldManifold,nt=Box2D.Collision.ClipVertex,rt=Box2D.Collision.Features,at=Box2D.Collision.IBroadPhase;Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape);n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;n.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new m};n.prototype.Copy=function(){var t=new n;t.Set(this);return t};n.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,n)){var e=t instanceof n?t:null;this.m_p.SetV(e.m_p)}};n.prototype.TestPoint=function(t,e){var i=t.R;var n=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);n=e.x-n;r=e.y-r;return n*n+r*r<=this.m_radius*this.m_radius};n.prototype.RayCast=function(t,e,i){var n=i.R;var r=i.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);var a=i.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);var o=e.p1.x-r;var s=e.p1.y-a;var h=o*o+s*s-this.m_radius*this.m_radius;var l=e.p2.x-e.p1.x;var u=e.p2.y-e.p1.y;var c=o*l+s*u;var p=l*l+u*u;var f=c*c-p*h;if(f<0||p<Box2D.MIN_VALUE){return false}var m=-(c+Math.sqrt(f));if(0<=m&&m<=e.maxFraction*p){m/=p;t.fraction=m;t.normal.x=o+m*l;t.normal.y=s+m*u;t.normal.Normalize();return true}return false};n.prototype.ComputeAABB=function(t,e){var i=e.R;var n=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(n-this.m_radius,r-this.m_radius);t.upperBound.Set(n+this.m_radius,r+this.m_radius)};n.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=e*i.b2_pi*this.m_radius*this.m_radius;t.center.SetV(this.m_p);t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};n.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=c.MulX(i,this.m_p);var a=-(c.Dot(t,r)-e);if(a<-this.m_radius+Box2D.MIN_VALUE){return 0}if(a>this.m_radius){n.SetV(r);return Math.PI*this.m_radius*this.m_radius}var o=this.m_radius*this.m_radius;var s=a*a;var h=o*(Math.asin(a/this.m_radius)+Math.PI/2)+a*Math.sqrt(o-s);var l=-2/3*Math.pow(o-s,1.5)/h;n.x=r.x+t.x*l;n.y=r.y+t.y*l;return h};n.prototype.GetLocalPosition=function(){return this.m_p};n.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)};n.prototype.GetRadius=function(){return this.m_radius};n.prototype.SetRadius=function(t){if(t===undefined)t=0;this.m_radius=t};n.prototype.b2CircleShape=function(t){if(t===undefined)t=0;this.__super.b2Shape.call(this);this.m_type=h.e_circleShape;this.m_radius=t};r.b2EdgeChainDef=function(){};r.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(a,Box2D.Collision.Shapes.b2Shape);a.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;a.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new m;this.m_v1=new m;this.m_v2=new m;this.m_coreV1=new m;this.m_coreV2=new m;this.m_normal=new m;this.m_direction=new m;this.m_cornerDir1=new m;this.m_cornerDir2=new m};a.prototype.TestPoint=function(t,e){return false};a.prototype.RayCast=function(t,e,i){var n;var r=e.p2.x-e.p1.x;var a=e.p2.y-e.p1.y;n=i.R;var o=i.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y);var s=i.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y);var h=i.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y)-s;var l=-(i.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y)-o);var u=100*Box2D.MIN_VALUE;var c=-(r*h+a*l);if(c>u){var p=e.p1.x-o;var f=e.p1.y-s;var m=p*h+f*l;if(0<=m&&m<=e.maxFraction*c){var d=-r*f+a*p;if(-u*c<=d&&d<=c*(1+u)){m/=c;t.fraction=m;var g=Math.sqrt(h*h+l*l);t.normal.x=h/g;t.normal.y=l/g;return true}}}return false};a.prototype.ComputeAABB=function(t,e){var i=e.R;var n=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y);var r=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y);var a=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y);var o=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);if(n<a){t.lowerBound.x=n;t.upperBound.x=a}else{t.lowerBound.x=a;t.upperBound.x=n}if(r<o){t.lowerBound.y=r;t.upperBound.y=o}else{t.lowerBound.y=o;t.upperBound.y=r}};a.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=0;t.center.SetV(this.m_v1);t.I=0};a.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=new m(t.x*e,t.y*e);var a=c.MulX(i,this.m_v1);var o=c.MulX(i,this.m_v2);var s=c.Dot(t,a)-e;var h=c.Dot(t,o)-e;if(s>0){if(h>0){return 0}else{a.x=-h/(s-h)*a.x+s/(s-h)*o.x;a.y=-h/(s-h)*a.y+s/(s-h)*o.y}}else{if(h>0){o.x=-h/(s-h)*a.x+s/(s-h)*o.x;o.y=-h/(s-h)*a.y+s/(s-h)*o.y}else{}}n.x=(r.x+a.x+o.x)/3;n.y=(r.y+a.y+o.y)/3;return.5*((a.x-r.x)*(o.y-r.y)-(a.y-r.y)*(o.x-r.x))};a.prototype.GetLength=function(){return this.m_length};a.prototype.GetVertex1=function(){return this.m_v1};a.prototype.GetVertex2=function(){return this.m_v2};a.prototype.GetCoreVertex1=function(){return this.m_coreV1};a.prototype.GetCoreVertex2=function(){return this.m_coreV2};a.prototype.GetNormalVector=function(){return this.m_normal};a.prototype.GetDirectionVector=function(){return this.m_direction};a.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};a.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};a.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};a.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};a.prototype.GetFirstVertex=function(t){var e=t.R;return new m(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))};a.prototype.GetNextEdge=function(){return this.m_nextEdge};a.prototype.GetPrevEdge=function(){return this.m_prevEdge};a.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=t.R;var r=t.position.x+(n.col1.x*this.m_coreV1.x+n.col2.x*this.m_coreV1.y);var a=t.position.y+(n.col1.y*this.m_coreV1.x+n.col2.y*this.m_coreV1.y);var o=t.position.x+(n.col1.x*this.m_coreV2.x+n.col2.x*this.m_coreV2.y);var s=t.position.y+(n.col1.y*this.m_coreV2.x+n.col2.y*this.m_coreV2.y);if(r*e+a*i>o*e+s*i){this.s_supportVec.x=r;this.s_supportVec.y=a}else{this.s_supportVec.x=o;this.s_supportVec.y=s}return this.s_supportVec};a.prototype.b2EdgeShape=function(t,e){this.__super.b2Shape.call(this);this.m_type=h.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=t;this.m_v2=e;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-i.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-i.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-i.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-i.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};a.prototype.SetPrevEdge=function(t,e,i,n){this.m_prevEdge=t;this.m_coreV1=e;this.m_cornerDir1=i;this.m_cornerConvex1=n};a.prototype.SetNextEdge=function(t,e,i,n){this.m_nextEdge=t;this.m_coreV2=e;this.m_cornerDir2=i;this.m_cornerConvex2=n};a.prototype.Copy=function(){var t=new a(this.m_v1,this.m_v2);return t};o.b2MassData=function(){this.mass=0;this.center=new m(0,0);this.I=0};Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape);s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;s.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};s.prototype.Copy=function(){var t=new s;t.Set(this);return t};s.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,s)){var e=t instanceof s?t:null;this.m_centroid.SetV(e.m_centroid);this.m_vertexCount=e.m_vertexCount;this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++){this.m_vertices[i].SetV(e.m_vertices[i]);this.m_normals[i].SetV(e.m_normals[i])}}};s.prototype.SetAsArray=function(t,e){if(e===undefined)e=0;var i=new Vector;var n=0,r;for(n=0;n<t.length;++n){r=t[n];i.push(r)}this.SetAsVector(i,e)};s.AsArray=function(t,e){if(e===undefined)e=0;var i=new s;i.SetAsArray(t,e);return i};s.prototype.SetAsVector=function(t,e){if(e===undefined)e=0;if(e==0)e=t.length;i.b2Assert(2<=e);this.m_vertexCount=e;this.Reserve(e);var n=0;for(n=0;n<this.m_vertexCount;n++){this.m_vertices[n].SetV(t[n])}for(n=0;n<this.m_vertexCount;++n){var r=parseInt(n);var a=parseInt(n+1<this.m_vertexCount?n+1:0);var o=c.SubtractVV(this.m_vertices[a],this.m_vertices[r]);i.b2Assert(o.LengthSquared()>Box2D.MIN_VALUE);this.m_normals[n].SetV(c.CrossVF(o,1));this.m_normals[n].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)};s.AsVector=function(t,e){if(e===undefined)e=0;var i=new s;i.SetAsVector(t,e);return i};s.prototype.SetAsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};s.AsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=new s;i.SetAsBox(t,e);return i};s.prototype.SetAsOrientedBox=function(t,e,i,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(n===undefined)n=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=i;var r=new f;r.position=i;r.R.Set(n);for(var a=0;a<this.m_vertexCount;++a){this.m_vertices[a]=c.MulX(r,this.m_vertices[a]);this.m_normals[a]=c.MulMV(r.R,this.m_normals[a])}};s.AsOrientedBox=function(t,e,i,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(n===undefined)n=0;var r=new s;r.SetAsOrientedBox(t,e,i,n);return r};s.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(t);this.m_vertices[1].SetV(e);this.m_centroid.x=.5*(t.x+e.x);this.m_centroid.y=.5*(t.y+e.y);this.m_normals[0]=c.CrossVF(c.SubtractVV(e,t),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};s.AsEdge=function(t,e){var i=new s;i.SetAsEdge(t,e);return i};s.prototype.TestPoint=function(t,e){var i;var n=t.R;var r=e.x-t.position.x;var a=e.y-t.position.y;var o=r*n.col1.x+a*n.col1.y;var s=r*n.col2.x+a*n.col2.y;for(var h=0;h<this.m_vertexCount;++h){i=this.m_vertices[h];r=o-i.x;a=s-i.y;i=this.m_normals[h];var l=i.x*r+i.y*a;if(l>0){return false}}return true};s.prototype.RayCast=function(t,e,i){var n=0;var r=e.maxFraction;var a=0;var o=0;var s;var h;a=e.p1.x-i.position.x;o=e.p1.y-i.position.y;s=i.R;var l=a*s.col1.x+o*s.col1.y;var u=a*s.col2.x+o*s.col2.y;a=e.p2.x-i.position.x;o=e.p2.y-i.position.y;s=i.R;var c=a*s.col1.x+o*s.col1.y;var p=a*s.col2.x+o*s.col2.y;var f=c-l;var m=p-u;var d=parseInt(-1);for(var g=0;g<this.m_vertexCount;++g){h=this.m_vertices[g];a=h.x-l;o=h.y-u;h=this.m_normals[g];var y=h.x*a+h.y*o;var v=h.x*f+h.y*m;if(v==0){if(y<0){return false}}else{if(v<0&&y<n*v){n=y/v;d=g}else if(v>0&&y<r*v){r=y/v}}if(r<n-Box2D.MIN_VALUE){return false}}if(d>=0){t.fraction=n;s=i.R;h=this.m_normals[d];t.normal.x=s.col1.x*h.x+s.col2.x*h.y;t.normal.y=s.col1.y*h.x+s.col2.y*h.y;return true}return false};s.prototype.ComputeAABB=function(t,e){var i=e.R;var n=this.m_vertices[0];var r=e.position.x+(i.col1.x*n.x+i.col2.x*n.y);var a=e.position.y+(i.col1.y*n.x+i.col2.y*n.y);var o=r;var s=a;for(var h=1;h<this.m_vertexCount;++h){n=this.m_vertices[h];var l=e.position.x+(i.col1.x*n.x+i.col2.x*n.y);var u=e.position.y+(i.col1.y*n.x+i.col2.y*n.y);r=r<l?r:l;a=a<u?a:u;o=o>l?o:l;s=s>u?s:u}t.lowerBound.x=r-this.m_radius;t.lowerBound.y=a-this.m_radius;t.upperBound.x=o+this.m_radius;t.upperBound.y=s+this.m_radius};s.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;if(this.m_vertexCount==2){t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);t.mass=0;t.I=0;return}var i=0;var n=0;var r=0;var a=0;var o=0;var s=0;var h=1/3;for(var l=0;l<this.m_vertexCount;++l){var u=this.m_vertices[l];var c=l+1<this.m_vertexCount?this.m_vertices[parseInt(l+1)]:this.m_vertices[0];var p=u.x-o;var f=u.y-s;var m=c.x-o;var d=c.y-s;var g=p*d-f*m;var y=.5*g;r+=y;i+=y*h*(o+u.x+c.x);n+=y*h*(s+u.y+c.y);var v=o;var _=s;var I=p;var w=f;var x=m;var S=d;var C=h*(.25*(I*I+x*I+x*x)+(v*I+v*x))+.5*v*v;var T=h*(.25*(w*w+S*w+S*S)+(_*w+_*S))+.5*_*_;a+=g*(C+T)}t.mass=e*r;i*=1/r;n*=1/r;t.center.Set(i,n);t.I=e*a};s.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=c.MulTMV(i.R,t);var a=e-c.Dot(t,i.position);var s=new Vector_a2j_Number;var h=0;var l=parseInt(-1);var u=parseInt(-1);var p=false;var f=0;for(f=0;f<this.m_vertexCount;++f){s[f]=c.Dot(r,this.m_vertices[f])-a;var d=s[f]<-Box2D.MIN_VALUE;if(f>0){if(d){if(!p){l=f-1;h++}}else{if(p){u=f-1;h++}}}p=d}switch(h){case 0:if(p){var g=new o;this.ComputeMass(g,1);n.SetV(c.MulX(i,g.center));return g.mass}else{return 0}break;case 1:if(l==-1){l=this.m_vertexCount-1}else{u=this.m_vertexCount-1}break}var y=parseInt((l+1)%this.m_vertexCount);var v=parseInt((u+1)%this.m_vertexCount);var _=(0-s[l])/(s[y]-s[l]);var I=(0-s[u])/(s[v]-s[u]);var w=new m(this.m_vertices[l].x*(1-_)+this.m_vertices[y].x*_,this.m_vertices[l].y*(1-_)+this.m_vertices[y].y*_);var x=new m(this.m_vertices[u].x*(1-I)+this.m_vertices[v].x*I,this.m_vertices[u].y*(1-I)+this.m_vertices[v].y*I);var S=0;var C=new m;var T=this.m_vertices[y];var b;f=y;while(f!=v){f=(f+1)%this.m_vertexCount;if(f==v)b=x;else b=this.m_vertices[f];var D=.5*((T.x-w.x)*(b.y-w.y)-(T.y-w.y)*(b.x-w.x));S+=D;C.x+=D*(w.x+T.x+b.x)/3;C.y+=D*(w.y+T.y+b.y)/3;T=b}C.Multiply(1/S);n.SetV(c.MulX(i,C));return S};s.prototype.GetVertexCount=function(){return this.m_vertexCount};s.prototype.GetVertices=function(){return this.m_vertices};s.prototype.GetNormals=function(){return this.m_normals};s.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return e};s.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return this.m_vertices[e]};s.prototype.Validate=function(){return false};s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=h.e_polygonShape;this.m_centroid=new m;this.m_vertices=new Vector;this.m_normals=new Vector};s.prototype.Reserve=function(t){if(t===undefined)t=0;for(var e=parseInt(this.m_vertices.length);e<t;e++){this.m_vertices[e]=new m;this.m_normals[e]=new m}};s.ComputeCentroid=function(t,e){if(e===undefined)e=0;var i=new m;var n=0;var r=0;var a=0;var o=1/3;for(var s=0;s<e;++s){var h=t[s];var l=s+1<e?t[parseInt(s+1)]:t[0];var u=h.x-r;var c=h.y-a;var p=l.x-r;var f=l.y-a;var d=u*f-c*p;var g=.5*d;n+=g;i.x+=g*o*(r+h.x+l.x);i.y+=g*o*(a+h.y+l.y)}i.x*=1/n;i.y*=1/n;return i};s.ComputeOBB=function(t,e,i){if(i===undefined)i=0;var n=0;var r=new Vector(i+1);for(n=0;n<i;++n){r[n]=e[n]}r[i]=r[0];var a=Number.MAX_VALUE;for(n=1;n<=i;++n){var o=r[parseInt(n-1)];var s=r[n].x-o.x;var h=r[n].y-o.y;var l=Math.sqrt(s*s+h*h);s/=l;h/=l;var u=-h;var c=s;var p=Number.MAX_VALUE;var f=Number.MAX_VALUE;var m=-Number.MAX_VALUE;var d=-Number.MAX_VALUE;for(var g=0;g<i;++g){var y=r[g].x-o.x;var v=r[g].y-o.y;var _=s*y+h*v;var I=u*y+c*v;if(_<p)p=_;if(I<f)f=I;if(_>m)m=_;if(I>d)d=I}var w=(m-p)*(d-f);if(w<.95*a){a=w;t.R.col1.x=s;t.R.col1.y=h;t.R.col2.x=u;t.R.col2.y=c;var x=.5*(p+m);var S=.5*(f+d);var C=t.R;t.center.x=o.x+(C.col1.x*x+C.col2.x*S);t.center.y=o.y+(C.col1.y*x+C.col2.y*S);t.extents.x=.5*(m-p);t.extents.y=.5*(d-f)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new l});h.b2Shape=function(){};h.prototype.Copy=function(){return null};h.prototype.Set=function(t){this.m_radius=t.m_radius};h.prototype.GetType=function(){return this.m_type};h.prototype.TestPoint=function(t,e){return false};h.prototype.RayCast=function(t,e,i){return false};h.prototype.ComputeAABB=function(t,e){};h.prototype.ComputeMass=function(t,e){if(e===undefined)e=0};h.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;return 0};h.TestOverlap=function(t,e,i,n){var r=new V;r.proxyA=new F;r.proxyA.Set(t);r.proxyB=new F;r.proxyB.Set(i);r.transformA=e;r.transformB=n;r.useRadii=true;var a=new Q;a.count=0;var o=new W;O.Distance(o,a,r);return o.distance<10*Box2D.MIN_VALUE};h.prototype.b2Shape=function(){this.m_type=h.e_unknownShape;this.m_radius=i.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,a=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,l=Box2D.Common.Math.b2Vec3;t.b2Color=function(){this._r=0;this._g=0;this._b=0};t.prototype.b2Color=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*a.Clamp(t,0,1));this._g=Box2D.parseUInt(255*a.Clamp(e,0,1));this._b=Box2D.parseUInt(255*a.Clamp(i,0,1))};t.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*a.Clamp(t,0,1));this._g=Box2D.parseUInt(255*a.Clamp(e,0,1));this._b=Box2D.parseUInt(255*a.Clamp(i,0,1))};Object.defineProperty(t.prototype,"r",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._r=Box2D.parseUInt(255*a.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"g",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._g=Box2D.parseUInt(255*a.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"b",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._b=Box2D.parseUInt(255*a.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});i.b2Settings=function(){};i.b2MixFriction=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return Math.sqrt(t*e)};i.b2MixRestitution=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};i.b2Assert=function(t){if(!t){throw"Assertion Failed"}};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*i.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi})})();(function(){var t=Box2D.Collision.b2AABB,e=Box2D.Common.b2Color,i=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,a=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,s=Box2D.Common.Math.b2Sweep,h=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,u=Box2D.Common.Math.b2Vec3;r.b2Mat22=function(){this.col1=new l;this.col2=new l};r.prototype.b2Mat22=function(){this.SetIdentity()};r.FromAngle=function(t){if(t===undefined)t=0;var e=new r;e.Set(t);return e};r.FromVV=function(t,e){var i=new r;i.SetVV(t,e);return i};r.prototype.Set=function(t){if(t===undefined)t=0;var e=Math.cos(t);var i=Math.sin(t);this.col1.x=e;this.col2.x=-i;this.col1.y=i;this.col2.y=e};r.prototype.SetVV=function(t,e){this.col1.SetV(t);this.col2.SetV(e)};r.prototype.Copy=function(){var t=new r;t.SetM(this);return t};r.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2)};r.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y};r.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};r.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};r.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};r.prototype.GetInverse=function(t){var e=this.col1.x;var i=this.col2.x;var n=this.col1.y;var r=this.col2.y;var a=e*r-i*n;if(a!=0){a=1/a}t.col1.x=a*r;t.col2.x=-a*i;t.col1.y=-a*n;t.col2.y=a*e;return t};r.prototype.Solve=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=this.col1.x;var r=this.col2.x;var a=this.col1.y;var o=this.col2.y;var s=n*o-r*a;if(s!=0){s=1/s}t.x=s*(o*e-r*i);t.y=s*(n*i-a*e);return t};r.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};a.b2Mat33=function(){this.col1=new u;this.col2=new u;this.col3=new u};a.prototype.b2Mat33=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=null;if(!t&&!e&&!i){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)}};a.prototype.SetVVV=function(t,e,i){this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)};a.prototype.Copy=function(){return new a(this.col1,this.col2,this.col3)};a.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2);this.col3.SetV(t.col3)};a.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col1.z+=t.col1.z;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y;this.col2.z+=t.col2.z;this.col3.x+=t.col3.x;this.col3.y+=t.col3.y;this.col3.z+=t.col3.z};a.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};a.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};a.prototype.Solve22=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=this.col1.x;var r=this.col2.x;var a=this.col1.y;var o=this.col2.y;var s=n*o-r*a;if(s!=0){s=1/s}t.x=s*(o*e-r*i);t.y=s*(n*i-a*e);return t};a.prototype.Solve33=function(t,e,i,n){if(e===undefined)e=0;if(i===undefined)i=0;if(n===undefined)n=0;var r=this.col1.x;var a=this.col1.y;var o=this.col1.z;var s=this.col2.x;var h=this.col2.y;var l=this.col2.z;var u=this.col3.x;var c=this.col3.y;var p=this.col3.z;var f=r*(h*p-l*c)+a*(l*u-s*p)+o*(s*c-h*u);if(f!=0){f=1/f}t.x=f*(e*(h*p-l*c)+i*(l*u-s*p)+n*(s*c-h*u));t.y=f*(r*(i*p-n*c)+a*(n*u-e*p)+o*(e*c-i*u));t.z=f*(r*(h*n-l*i)+a*(l*e-s*n)+o*(s*i-h*e));return t};o.b2Math=function(){};o.IsValid=function(t){if(t===undefined)t=0;return isFinite(t)};o.Dot=function(t,e){return t.x*e.x+t.y*e.y};o.CrossVV=function(t,e){return t.x*e.y-t.y*e.x};o.CrossVF=function(t,e){if(e===undefined)e=0;var i=new l(e*t.y,-e*t.x);return i};o.CrossFV=function(t,e){if(t===undefined)t=0;var i=new l(-t*e.y,t*e.x);return i};o.MulMV=function(t,e){var i=new l(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return i};o.MulTMV=function(t,e){var i=new l(o.Dot(e,t.col1),o.Dot(e,t.col2));return i};o.MulX=function(t,e){var i=o.MulMV(t.R,e);i.x+=t.position.x;i.y+=t.position.y;return i};o.MulXT=function(t,e){var i=o.SubtractVV(e,t.position);var n=i.x*t.R.col1.x+i.y*t.R.col1.y;i.y=i.x*t.R.col2.x+i.y*t.R.col2.y;i.x=n;return i};o.AddVV=function(t,e){var i=new l(t.x+e.x,t.y+e.y);return i};o.SubtractVV=function(t,e){var i=new l(t.x-e.x,t.y-e.y);return i};o.Distance=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return Math.sqrt(i*i+n*n)};o.DistanceSquared=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return i*i+n*n};o.MulFV=function(t,e){if(t===undefined)t=0;var i=new l(t*e.x,t*e.y);return i};o.AddMM=function(t,e){var i=r.FromVV(o.AddVV(t.col1,e.col1),o.AddVV(t.col2,e.col2));return i};o.MulMM=function(t,e){var i=r.FromVV(o.MulMV(t,e.col1),o.MulMV(t,e.col2));return i};o.MulTMM=function(t,e){var i=new l(o.Dot(t.col1,e.col1),o.Dot(t.col2,e.col1));var n=new l(o.Dot(t.col1,e.col2),o.Dot(t.col2,e.col2));var a=r.FromVV(i,n);return a};o.Abs=function(t){if(t===undefined)t=0;return t>0?t:-t};o.AbsV=function(t){var e=new l(o.Abs(t.x),o.Abs(t.y));return e};o.AbsM=function(t){var e=r.FromVV(o.AbsV(t.col1),o.AbsV(t.col2));return e};o.Min=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t<e?t:e};o.MinV=function(t,e){var i=new l(o.Min(t.x,e.x),o.Min(t.y,e.y));return i};o.Max=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};o.MaxV=function(t,e){var i=new l(o.Max(t.x,e.x),o.Max(t.y,e.y));return i};o.Clamp=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;return t<e?e:t>i?i:t};o.ClampV=function(t,e,i){return o.MaxV(e,o.MinV(t,i))};o.Swap=function(t,e){var i=t[0];t[0]=e[0];e[0]=i};o.Random=function(){return Math.random()*2-1};o.RandomRange=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=Math.random();i=(e-t)*i+t;return i};o.NextPowerOfTwo=function(t){if(t===undefined)t=0;t|=t>>1&2147483647;t|=t>>2&1073741823;t|=t>>4&268435455;t|=t>>8&16777215;t|=t>>16&65535;return t+1};o.IsPowerOfTwo=function(t){if(t===undefined)t=0;var e=t>0&&(t&t-1)==0;return e};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new l(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=r.FromVV(new l(1,0),new l(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new h(o.b2Vec2_zero,o.b2Mat22_identity)});s.b2Sweep=function(){this.localCenter=new l;this.c0=new l;this.c=new l};s.prototype.Set=function(t){this.localCenter.SetV(t.localCenter);this.c0.SetV(t.c0);this.c.SetV(t.c);this.a0=t.a0;this.a=t.a;this.t0=t.t0};s.prototype.Copy=function(){var t=new s;t.localCenter.SetV(this.localCenter);t.c0.SetV(this.c0);t.c.SetV(this.c);t.a0=this.a0;t.a=this.a;t.t0=this.t0;return t};s.prototype.GetTransform=function(t,e){if(e===undefined)e=0;t.position.x=(1-e)*this.c0.x+e*this.c.x;t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var n=t.R;t.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y;t.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y};s.prototype.Advance=function(t){if(t===undefined)t=0;if(this.t0<t&&1-this.t0>Box2D.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x;this.c0.y=(1-e)*this.c0.y+e*this.c.y;this.a0=(1-e)*this.a0+e*this.a;this.t0=t}};h.b2Transform=function(){this.position=new l;this.R=new r};h.prototype.b2Transform=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;if(t){this.position.SetV(t);this.R.SetM(e)}};h.prototype.Initialize=function(t,e){this.position.SetV(t);this.R.SetM(e)};h.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};h.prototype.Set=function(t){this.position.SetV(t.position);this.R.SetM(t.R)};h.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};l.b2Vec2=function(){};l.prototype.b2Vec2=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};l.prototype.SetZero=function(){this.x=0;this.y=0};l.prototype.Set=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};l.prototype.SetV=function(t){this.x=t.x;this.y=t.y};l.prototype.GetNegative=function(){return new l(-this.x,-this.y)};l.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};l.Make=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return new l(t,e)};l.prototype.Copy=function(){return new l(this.x,this.y)};l.prototype.Add=function(t){this.x+=t.x;
this.y+=t.y};l.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y};l.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t};l.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y;this.y=t.col1.y*e+t.col2.y*this.y};l.prototype.MulTM=function(t){var e=o.Dot(this,t.col1);this.y=o.Dot(this,t.col2);this.x=e};l.prototype.CrossVF=function(t){if(t===undefined)t=0;var e=this.x;this.x=t*this.y;this.y=-t*e};l.prototype.CrossFV=function(t){if(t===undefined)t=0;var e=this.x;this.x=-t*this.y;this.y=t*e};l.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x;this.y=this.y<t.y?this.y:t.y};l.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x;this.y=this.y>t.y?this.y:t.y};l.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};l.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};l.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};l.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Box2D.MIN_VALUE){return 0}var e=1/t;this.x*=e;this.y*=e;return t};l.prototype.IsValid=function(){return o.IsValid(this.x)&&o.IsValid(this.y)};u.b2Vec3=function(){};u.prototype.b2Vec3=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};u.prototype.SetZero=function(){this.x=this.y=this.z=0};u.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};u.prototype.SetV=function(t){this.x=t.x;this.y=t.y;this.z=t.z};u.prototype.GetNegative=function(){return new u(-this.x,-this.y,-this.z)};u.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};u.prototype.Copy=function(){return new u(this.x,this.y,this.z)};u.prototype.Add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z};u.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z};u.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t;this.z*=t}})();(function(){var t=Box2D.Dynamics.Controllers.b2ControllerEdge,e=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,a=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3,h=Box2D.Common.b2Color,l=Box2D.Common.b2internal,u=Box2D.Common.b2Settings,c=Box2D.Collision.b2AABB,p=Box2D.Collision.b2Bound,f=Box2D.Collision.b2BoundValues,m=Box2D.Collision.b2Collision,d=Box2D.Collision.b2ContactID,g=Box2D.Collision.b2ContactPoint,y=Box2D.Collision.b2Distance,v=Box2D.Collision.b2DistanceInput,_=Box2D.Collision.b2DistanceOutput,I=Box2D.Collision.b2DistanceProxy,w=Box2D.Collision.b2DynamicTree,x=Box2D.Collision.b2DynamicTreeBroadPhase,S=Box2D.Collision.b2DynamicTreeNode,C=Box2D.Collision.b2DynamicTreePair,T=Box2D.Collision.b2Manifold,b=Box2D.Collision.b2ManifoldPoint,D=Box2D.Collision.b2Point,A=Box2D.Collision.b2RayCastInput,E=Box2D.Collision.b2RayCastOutput,U=Box2D.Collision.b2Segment,M=Box2D.Collision.b2SeparationFunction,P=Box2D.Collision.b2Simplex,B=Box2D.Collision.b2SimplexCache,L=Box2D.Collision.b2SimplexVertex,R=Box2D.Collision.b2TimeOfImpact,O=Box2D.Collision.b2TOIInput,V=Box2D.Collision.b2WorldManifold,W=Box2D.Collision.ClipVertex,F=Box2D.Collision.Features,N=Box2D.Collision.IBroadPhase,k=Box2D.Collision.Shapes.b2CircleShape,G=Box2D.Collision.Shapes.b2EdgeChainDef,H=Box2D.Collision.Shapes.b2EdgeShape,Y=Box2D.Collision.Shapes.b2MassData,J=Box2D.Collision.Shapes.b2PolygonShape,X=Box2D.Collision.Shapes.b2Shape,z=Box2D.Dynamics.b2Body,K=Box2D.Dynamics.b2BodyDef,j=Box2D.Dynamics.b2ContactFilter,q=Box2D.Dynamics.b2ContactImpulse,Z=Box2D.Dynamics.b2ContactListener,Q=Box2D.Dynamics.b2ContactManager,$=Box2D.Dynamics.b2DebugDraw,tt=Box2D.Dynamics.b2DestructionListener,et=Box2D.Dynamics.b2FilterData,it=Box2D.Dynamics.b2Fixture,nt=Box2D.Dynamics.b2FixtureDef,rt=Box2D.Dynamics.b2Island,at=Box2D.Dynamics.b2TimeStep,ot=Box2D.Dynamics.b2World,st=Box2D.Dynamics.Contacts.b2CircleContact,ht=Box2D.Dynamics.Contacts.b2Contact,lt=Box2D.Dynamics.Contacts.b2ContactConstraint,ut=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,ct=Box2D.Dynamics.Contacts.b2ContactEdge,pt=Box2D.Dynamics.Contacts.b2ContactFactory,ft=Box2D.Dynamics.Contacts.b2ContactRegister,mt=Box2D.Dynamics.Contacts.b2ContactResult,dt=Box2D.Dynamics.Contacts.b2ContactSolver,gt=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,yt=Box2D.Dynamics.Contacts.b2NullContact,vt=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,_t=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,It=Box2D.Dynamics.Contacts.b2PolygonContact,wt=Box2D.Dynamics.Contacts.b2PositionSolverManifold,xt=Box2D.Dynamics.Controllers.b2Controller,St=Box2D.Dynamics.Joints.b2DistanceJoint,Ct=Box2D.Dynamics.Joints.b2DistanceJointDef,Tt=Box2D.Dynamics.Joints.b2FrictionJoint,bt=Box2D.Dynamics.Joints.b2FrictionJointDef,Dt=Box2D.Dynamics.Joints.b2GearJoint,At=Box2D.Dynamics.Joints.b2GearJointDef,Et=Box2D.Dynamics.Joints.b2Jacobian,Ut=Box2D.Dynamics.Joints.b2Joint,Mt=Box2D.Dynamics.Joints.b2JointDef,Pt=Box2D.Dynamics.Joints.b2JointEdge,Bt=Box2D.Dynamics.Joints.b2LineJoint,Lt=Box2D.Dynamics.Joints.b2LineJointDef,Rt=Box2D.Dynamics.Joints.b2MouseJoint,Ot=Box2D.Dynamics.Joints.b2MouseJointDef,Vt=Box2D.Dynamics.Joints.b2PrismaticJoint,Wt=Box2D.Dynamics.Joints.b2PrismaticJointDef,Ft=Box2D.Dynamics.Joints.b2PulleyJoint,Nt=Box2D.Dynamics.Joints.b2PulleyJointDef,kt=Box2D.Dynamics.Joints.b2RevoluteJoint,Gt=Box2D.Dynamics.Joints.b2RevoluteJointDef,Ht=Box2D.Dynamics.Joints.b2WeldJoint,Yt=Box2D.Dynamics.Joints.b2WeldJointDef;z.b2Body=function(){this.m_xf=new a;this.m_sweep=new r;this.m_linearVelocity=new o;this.m_force=new o};z.prototype.connectEdges=function(t,e,i){if(i===undefined)i=0;var r=Math.atan2(e.GetDirectionVector().y,e.GetDirectionVector().x);var a=Math.tan((r-i)*.5);var o=n.MulFV(a,e.GetDirectionVector());o=n.SubtractVV(o,e.GetNormalVector());o=n.MulFV(u.b2_toiSlop,o);o=n.AddVV(o,e.GetVertex1());var s=n.AddVV(t.GetDirectionVector(),e.GetDirectionVector());s.Normalize();var h=n.Dot(t.GetDirectionVector(),e.GetNormalVector())>0;t.SetNextEdge(e,o,s,h);e.SetPrevEdge(t,o,s,h);return r};z.prototype.CreateFixture=function(t){if(this.m_world.IsLocked()==true){return null}var e=new it;e.Create(this,this.m_xf,t);if(this.m_flags&z.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}e.m_next=this.m_fixtureList;this.m_fixtureList=e;++this.m_fixtureCount;e.m_body=this;if(e.m_density>0){this.ResetMassData()}this.m_world.m_flags|=ot.e_newFixture;return e};z.prototype.CreateFixture2=function(t,e){if(e===undefined)e=0;var i=new nt;i.shape=t;i.density=e;return this.CreateFixture(i)};z.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked()==true){return}var e=this.m_fixtureList;var i=null;var n=false;while(e!=null){if(e==t){if(i)i.m_next=t.m_next;else this.m_fixtureList=t.m_next;n=true;break}i=e;e=e.m_next}var r=this.m_contactList;while(r){var a=r.contact;r=r.next;var o=a.GetFixtureA();var s=a.GetFixtureB();if(t==o||t==s){this.m_world.m_contactManager.Destroy(a)}}if(this.m_flags&z.e_activeFlag){var h=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(h)}else{}t.Destroy();t.m_body=null;t.m_next=null;--this.m_fixtureCount;this.ResetMassData()};z.prototype.SetPositionAndAngle=function(t,e){if(e===undefined)e=0;var i;if(this.m_world.IsLocked()==true){return}this.m_xf.R.Set(e);this.m_xf.position.SetV(t);var n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y;this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=e;var a=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.Synchronize(a,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()};z.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())};z.prototype.GetTransform=function(){return this.m_xf};z.prototype.GetPosition=function(){return this.m_xf.position};z.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())};z.prototype.GetAngle=function(){return this.m_sweep.a};z.prototype.SetAngle=function(t){if(t===undefined)t=0;this.SetPositionAndAngle(this.GetPosition(),t)};z.prototype.GetWorldCenter=function(){return this.m_sweep.c};z.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};z.prototype.SetLinearVelocity=function(t){if(this.m_type==z.b2_staticBody){alert("Static body not support SetLinearVelocity");return}this.m_linearVelocity.SetV(t)};z.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};z.prototype.SetAngularVelocity=function(t){if(t===undefined)t=0;if(this.m_type==z.b2_staticBody){alert("Static body not support SetAngularVelocity");return}this.m_angularVelocity=t};z.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};z.prototype.GetDefinition=function(){var t=new K;t.type=this.GetType();t.allowSleep=(this.m_flags&z.e_allowSleepFlag)==z.e_allowSleepFlag;t.angle=this.GetAngle();t.angularDamping=this.m_angularDamping;t.angularVelocity=this.m_angularVelocity;t.fixedRotation=(this.m_flags&z.e_fixedRotationFlag)==z.e_fixedRotationFlag;t.bullet=(this.m_flags&z.e_bulletFlag)==z.e_bulletFlag;t.awake=(this.m_flags&z.e_awakeFlag)==z.e_awakeFlag;t.linearDamping=this.m_linearDamping;t.linearVelocity.SetV(this.GetLinearVelocity());t.position=this.GetPosition();t.userData=this.GetUserData();return t};z.prototype.ApplyForce=function(t,e){if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_force.x+=t.x;this.m_force.y+=t.y;this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x};z.prototype.ApplyTorque=function(t){if(t===undefined)t=0;if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_torque+=t};z.prototype.ApplyImpulse=function(t,e){if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_linearVelocity.x+=this.m_invMass*t.x;this.m_linearVelocity.y+=this.m_invMass*t.y;this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)};z.prototype.Split=function(t){var e=this.GetLinearVelocity().Copy();var i=this.GetAngularVelocity();var r=this.GetWorldCenter();var a=this;var o=this.m_world.CreateBody(this.GetDefinition());var s;for(var h=a.m_fixtureList;h;){if(t(h)){var l=h.m_next;if(s){s.m_next=l}else{a.m_fixtureList=l}a.m_fixtureCount--;h.m_next=o.m_fixtureList;o.m_fixtureList=h;o.m_fixtureCount++;h.m_body=o;h=l}else{s=h;h=h.m_next}}a.ResetMassData();o.ResetMassData();var u=a.GetWorldCenter();var c=o.GetWorldCenter();var p=n.AddVV(e,n.CrossFV(i,n.SubtractVV(u,r)));var f=n.AddVV(e,n.CrossFV(i,n.SubtractVV(c,r)));a.SetLinearVelocity(p);o.SetLinearVelocity(f);a.SetAngularVelocity(i);o.SetAngularVelocity(i);a.SynchronizeFixtures();o.SynchronizeFixtures();return o};z.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--;e.m_next=this.m_fixtureList;this.m_fixtureList=e;this.m_fixtureCount++;e.m_body=r;e=i}n.m_fixtureCount=0;var n=this;var r=t;var a=n.GetWorldCenter();var o=r.GetWorldCenter();var s=n.GetLinearVelocity().Copy();var h=r.GetLinearVelocity().Copy();var l=n.GetAngularVelocity();var u=r.GetAngularVelocity();n.ResetMassData();this.SynchronizeFixtures()};z.prototype.GetMass=function(){return this.m_mass};z.prototype.GetInertia=function(){return this.m_I};z.prototype.GetMassData=function(t){t.mass=this.m_mass;t.I=this.m_I;t.center.SetV(this.m_sweep.localCenter)};z.prototype.SetMassData=function(t){u.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()==true){return}if(this.m_type!=z.b2_dynamicBody){return}this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=t.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(t.I>0&&(this.m_flags&z.e_fixedRotationFlag)==0){this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y);this.m_invI=1/this.m_I}var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center);this.m_sweep.c0.SetV(n.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)};z.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type==z.b2_staticBody||this.m_type==z.b2_kinematicBody){return}var t=o.Make(0,0);for(var e=this.m_fixtureList;e;e=e.m_next){if(e.m_density==0){continue}var i=e.GetMassData();this.m_mass+=i.mass;t.x+=i.center.x*i.mass;t.y+=i.center.y*i.mass;this.m_I+=i.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;t.x*=this.m_invMass;t.y*=this.m_invMass}else{this.m_mass=1;this.m_invMass=1}if(this.m_I>0&&(this.m_flags&z.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y);this.m_I*=this.m_inertiaScale;u.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t);this.m_sweep.c0.SetV(n.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)};z.prototype.GetWorldPoint=function(t){var e=this.m_xf.R;var i=new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return i};z.prototype.GetWorldVector=function(t){return n.MulMV(this.m_xf.R,t)};z.prototype.GetLocalPoint=function(t){return n.MulXT(this.m_xf,t)};z.prototype.GetLocalVector=function(t){return n.MulTMV(this.m_xf.R,t)};z.prototype.GetLinearVelocityFromWorldPoint=function(t){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))};z.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R;var i=new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return new o(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))};z.prototype.GetLinearDamping=function(){return this.m_linearDamping};z.prototype.SetLinearDamping=function(t){if(t===undefined)t=0;this.m_linearDamping=t};z.prototype.GetAngularDamping=function(){return this.m_angularDamping};z.prototype.SetAngularDamping=function(t){if(t===undefined)t=0;this.m_angularDamping=t};z.prototype.SetType=function(t){if(t===undefined)t=0;if(this.m_type==t){return}this.m_type=t;this.ResetMassData();if(this.m_type==z.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(var e=this.m_contactList;e;e=e.next){e.contact.FlagForFiltering()}};z.prototype.GetType=function(){return this.m_type};z.prototype.SetBullet=function(t){if(t){this.m_flags|=z.e_bulletFlag}else{this.m_flags&=~z.e_bulletFlag}};z.prototype.IsBullet=function(){return(this.m_flags&z.e_bulletFlag)==z.e_bulletFlag};z.prototype.SetSleepingAllowed=function(t){if(t){this.m_flags|=z.e_allowSleepFlag}else{this.m_flags&=~z.e_allowSleepFlag;this.SetAwake(true)}};z.prototype.SetAwake=function(t){if(t){this.m_flags|=z.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~z.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};z.prototype.IsAwake=function(){return(this.m_flags&z.e_awakeFlag)==z.e_awakeFlag};z.prototype.SetFixedRotation=function(t){if(t){this.m_flags|=z.e_fixedRotationFlag}else{this.m_flags&=~z.e_fixedRotationFlag}this.ResetMassData()};z.prototype.IsFixedRotation=function(){return(this.m_flags&z.e_fixedRotationFlag)==z.e_fixedRotationFlag};z.prototype.SetActive=function(t){if(t==this.IsActive()){return}var e;var i;if(t){this.m_flags|=z.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.CreateProxy(e,this.m_xf)}}else{this.m_flags&=~z.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.DestroyProxy(e)}var n=this.m_contactList;while(n){var r=n;n=n.next;this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}};z.prototype.IsActive=function(){return(this.m_flags&z.e_activeFlag)==z.e_activeFlag};z.prototype.IsSleepingAllowed=function(){return(this.m_flags&z.e_allowSleepFlag)==z.e_allowSleepFlag};z.prototype.GetFixtureList=function(){return this.m_fixtureList};z.prototype.GetJointList=function(){return this.m_jointList};z.prototype.GetControllerList=function(){return this.m_controllerList};z.prototype.GetContactList=function(){return this.m_contactList};z.prototype.GetNext=function(){return this.m_next};z.prototype.GetUserData=function(){return this.m_userData};z.prototype.SetUserData=function(t){this.m_userData=t};z.prototype.GetWorld=function(){return this.m_world};z.prototype.b2Body=function(t,e){this.m_flags=0;if(t.bullet){this.m_flags|=z.e_bulletFlag}if(t.fixedRotation){this.m_flags|=z.e_fixedRotationFlag}if(t.allowSleep){this.m_flags|=z.e_allowSleepFlag}if(t.awake){this.m_flags|=z.e_awakeFlag}if(t.active){this.m_flags|=z.e_activeFlag}this.m_world=e;this.m_xf.position.SetV(t.position);this.m_xf.R.Set(t.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R;var n=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*n.x+i.col2.x*n.y;this.m_sweep.c.y=i.col1.y*n.x+i.col2.y*n.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(t.linearVelocity);this.m_angularVelocity=t.angularVelocity;this.m_linearDamping=t.linearDamping;this.m_angularDamping=t.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=t.type;if(this.m_type==z.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}else{this.m_mass=0;this.m_invMass=0}this.m_I=0;this.m_invI=0;this.m_inertiaScale=t.inertiaScale;this.m_userData=t.userData;this.m_fixtureList=null;this.m_fixtureCount=0};z.prototype.SynchronizeFixtures=function(){var t=z.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R;var i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y);t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);var n;var r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.Synchronize(r,t,this.m_xf)}};z.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R;var e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y);this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)};z.prototype.ShouldCollide=function(t){if(this.m_type!=z.b2_dynamicBody&&t.m_type!=z.b2_dynamicBody){return false}for(var e=this.m_jointList;e;e=e.next){if(e.other==t)if(e.joint.m_collideConnected==false){return false}}return true};z.prototype.Advance=function(t){if(t===undefined)t=0;this.m_sweep.Advance(t);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new a;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});K.b2BodyDef=function(){this.position=new o;this.linearVelocity=new o};K.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=true;this.awake=true;this.fixedRotation=false;this.bullet=false;this.type=z.b2_staticBody;this.active=true;this.inertiaScale=1};j.b2ContactFilter=function(){};j.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData();var n=e.GetFilterData();if(i.groupIndex==n.groupIndex&&i.groupIndex!=0){return i.groupIndex>0}var r=(i.maskBits&n.categoryBits)!=0&&(i.categoryBits&n.maskBits)!=0;return r};j.prototype.RayCollide=function(t,e){if(!t)return true;return this.ShouldCollide(t instanceof it?t:null,e)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new j});q.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(u.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(u.b2_maxManifoldPoints)};Z.b2ContactListener=function(){};Z.prototype.BeginContact=function(t){};Z.prototype.EndContact=function(t){};Z.prototype.PreSolve=function(t,e){};Z.prototype.PostSolve=function(t,e){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Z});Q.b2ContactManager=function(){};Q.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=j.b2_defaultFilter;this.m_contactListener=Z.b2_defaultListener;this.m_contactFactory=new pt(this.m_allocator);this.m_broadPhase=new x};Q.prototype.AddPair=function(t,e){var i=t instanceof it?t:null;var n=e instanceof it?e:null;var r=i.GetBody();var a=n.GetBody();if(r==a)return;var o=a.GetContactList();while(o){if(o.other==r){var s=o.contact.GetFixtureA();var h=o.contact.GetFixtureB();if(s==i&&h==n)return;if(s==n&&h==i)return}o=o.next}if(a.ShouldCollide(r)==false){return}if(this.m_contactFilter.ShouldCollide(i,n)==false){return}var l=this.m_contactFactory.Create(i,n);i=l.GetFixtureA();n=l.GetFixtureB();r=i.m_body;a=n.m_body;l.m_prev=null;l.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=l}this.m_world.m_contactList=l;l.m_nodeA.contact=l;l.m_nodeA.other=a;l.m_nodeA.prev=null;l.m_nodeA.next=r.m_contactList;if(r.m_contactList!=null){r.m_contactList.prev=l.m_nodeA}r.m_contactList=l.m_nodeA;l.m_nodeB.contact=l;l.m_nodeB.other=r;l.m_nodeB.prev=null;l.m_nodeB.next=a.m_contactList;if(a.m_contactList!=null){a.m_contactList.prev=l.m_nodeB}a.m_contactList=l.m_nodeB;++this.m_world.m_contactCount;return};Q.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};Q.prototype.Destroy=function(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var n=e.GetBody();var r=i.GetBody();if(t.IsTouching()){this.m_contactListener.EndContact(t)}if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_world.m_contactList){this.m_world.m_contactList=t.m_next}if(t.m_nodeA.prev){t.m_nodeA.prev.next=t.m_nodeA.next}if(t.m_nodeA.next){t.m_nodeA.next.prev=t.m_nodeA.prev}if(t.m_nodeA==n.m_contactList){n.m_contactList=t.m_nodeA.next}if(t.m_nodeB.prev){t.m_nodeB.prev.next=t.m_nodeB.next}if(t.m_nodeB.next){t.m_nodeB.next.prev=t.m_nodeB.prev}if(t.m_nodeB==r.m_contactList){r.m_contactList=t.m_nodeB.next}this.m_contactFactory.Destroy(t);--this.m_contactCount};Q.prototype.Collide=function(){var t=this.m_world.m_contactList;while(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var n=e.GetBody();var r=i.GetBody();if(n.IsAwake()==false&&r.IsAwake()==false){t=t.GetNext();continue}if(t.m_flags&ht.e_filterFlag){if(r.ShouldCollide(n)==false){var a=t;t=a.GetNext();this.Destroy(a);continue}if(this.m_contactFilter.ShouldCollide(e,i)==false){a=t;t=a.GetNext();this.Destroy(a);continue}t.m_flags&=~ht.e_filterFlag}var o=e.m_proxy;var s=i.m_proxy;var h=this.m_broadPhase.TestOverlap(o,s);if(h==false){a=t;t=a.GetNext();this.Destroy(a);continue}t.Update(this.m_contactListener);t=t.GetNext()}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new g});$.b2DebugDraw=function(){};$.prototype.b2DebugDraw=function(){};$.prototype.SetFlags=function(t){if(t===undefined)t=0};$.prototype.GetFlags=function(){};$.prototype.AppendFlags=function(t){if(t===undefined)t=0};$.prototype.ClearFlags=function(t){if(t===undefined)t=0};$.prototype.SetSprite=function(t){};$.prototype.GetSprite=function(){};$.prototype.SetDrawScale=function(t){if(t===undefined)t=0};$.prototype.GetDrawScale=function(){};$.prototype.SetLineThickness=function(t){if(t===undefined)t=0};$.prototype.GetLineThickness=function(){};$.prototype.SetAlpha=function(t){if(t===undefined)t=0};$.prototype.GetAlpha=function(){};$.prototype.SetFillAlpha=function(t){if(t===undefined)t=0};$.prototype.GetFillAlpha=function(){};$.prototype.SetXFormScale=function(t){if(t===undefined)t=0};$.prototype.GetXFormScale=function(){};$.prototype.DrawPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawCircle=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidCircle=function(t,e,i,n){if(e===undefined)e=0};$.prototype.DrawSegment=function(t,e,i){};$.prototype.DrawTransform=function(t){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});tt.b2DestructionListener=function(){};tt.prototype.SayGoodbyeJoint=function(t){};tt.prototype.SayGoodbyeFixture=function(t){};et.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};et.prototype.Copy=function(){var t=new et;t.categoryBits=this.categoryBits;t.maskBits=this.maskBits;t.groupIndex=this.groupIndex;return t};it.b2Fixture=function(){this.m_filter=new et};it.prototype.GetType=function(){return this.m_shape.GetType()};it.prototype.GetShape=function(){return this.m_shape};it.prototype.SetSensor=function(t){if(this.m_isSensor==t)return;this.m_isSensor=t;if(this.m_body==null)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var n=i.GetFixtureA();var r=i.GetFixtureB();if(n==this||r==this)i.SetSensor(n.IsSensor()||r.IsSensor());e=e.next}};it.prototype.IsSensor=function(){return this.m_isSensor};it.prototype.SetFilterData=function(t){this.m_filter=t.Copy();if(this.m_body)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var n=i.GetFixtureA();var r=i.GetFixtureB();if(n==this||r==this)i.FlagForFiltering();e=e.next}};it.prototype.GetFilterData=function(){return this.m_filter.Copy()};it.prototype.GetBody=function(){return this.m_body};it.prototype.GetNext=function(){return this.m_next};it.prototype.GetUserData=function(){return this.m_userData};it.prototype.SetUserData=function(t){this.m_userData=t};it.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)};it.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())};it.prototype.GetMassData=function(t){if(t===undefined)t=null;if(t==null){t=new Y}this.m_shape.ComputeMass(t,this.m_density);return t};it.prototype.SetDensity=function(t){if(t===undefined)t=0;this.m_density=t};it.prototype.GetDensity=function(){return this.m_density};it.prototype.GetFriction=function(){return this.m_friction};it.prototype.SetFriction=function(t){if(t===undefined)t=0;this.m_friction=t};it.prototype.GetRestitution=function(){return this.m_restitution};it.prototype.SetRestitution=function(t){if(t===undefined)t=0;this.m_restitution=t};it.prototype.GetAABB=function(){return this.m_aabb};it.prototype.b2Fixture=function(){this.m_aabb=new c;this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};it.prototype.Create=function(t,e,i){this.m_userData=i.userData;this.m_friction=i.friction;this.m_restitution=i.restitution;this.m_body=t;this.m_next=null;this.m_filter=i.filter.Copy();this.m_isSensor=i.isSensor;this.m_shape=i.shape.Copy();this.m_density=i.density};it.prototype.Destroy=function(){this.m_shape=null};it.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e);this.m_proxy=t.CreateProxy(this.m_aabb,this)};it.prototype.DestroyProxy=function(t){if(this.m_proxy==null){return}t.DestroyProxy(this.m_proxy);this.m_proxy=null};it.prototype.Synchronize=function(t,e,i){if(!this.m_proxy)return;var r=new c;var a=new c;this.m_shape.ComputeAABB(r,e);this.m_shape.ComputeAABB(a,i);this.m_aabb.Combine(r,a);var o=n.SubtractVV(i.position,e.position);t.MoveProxy(this.m_proxy,this.m_aabb,o)};nt.b2FixtureDef=function(){this.filter=new et};nt.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};rt.b2Island=function(){};rt.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};rt.prototype.Initialize=function(t,e,i,n,r,a){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;var o=0;this.m_bodyCapacity=t;this.m_contactCapacity=e;this.m_jointCapacity=i;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=n;this.m_listener=r;this.m_contactSolver=a;for(o=this.m_bodies.length;o<t;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<e;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<i;o++)this.m_joints[o]=null};rt.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};rt.prototype.Solve=function(t,e,i){var r=0;var a=0;var o;var s;for(r=0;r<this.m_bodyCount;++r){o=this.m_bodies[r];if(o.GetType()!=z.b2_dynamicBody)continue;o.m_linearVelocity.x+=t.dt*(e.x+o.m_invMass*o.m_force.x);o.m_linearVelocity.y+=t.dt*(e.y+o.m_invMass*o.m_force.y);o.m_angularVelocity+=t.dt*o.m_invI*o.m_torque;o.m_linearVelocity.Multiply(n.Clamp(1-t.dt*o.m_linearDamping,0,1));o.m_angularVelocity*=n.Clamp(1-t.dt*o.m_angularDamping,0,1)}this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var h=this.m_contactSolver;h.InitVelocityConstraints(t);for(r=0;r<this.m_jointCount;++r){s=this.m_joints[r];s.InitVelocityConstraints(t)}for(r=0;r<t.velocityIterations;++r){for(a=0;a<this.m_jointCount;++a){s=this.m_joints[a];s.SolveVelocityConstraints(t)}h.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r){s=this.m_joints[r];s.FinalizeVelocityConstraints()}h.FinalizeVelocityConstraints();for(r=0;r<this.m_bodyCount;++r){o=this.m_bodies[r];if(o.GetType()==z.b2_staticBody)continue;var l=t.dt*o.m_linearVelocity.x;var c=t.dt*o.m_linearVelocity.y;if(l*l+c*c>u.b2_maxTranslationSquared){o.m_linearVelocity.Normalize();o.m_linearVelocity.x*=u.b2_maxTranslation*t.inv_dt;o.m_linearVelocity.y*=u.b2_maxTranslation*t.inv_dt}var p=t.dt*o.m_angularVelocity;if(p*p>u.b2_maxRotationSquared){if(o.m_angularVelocity<0){o.m_angularVelocity=-u.b2_maxRotation*t.inv_dt}else{o.m_angularVelocity=u.b2_maxRotation*t.inv_dt}}o.m_sweep.c0.SetV(o.m_sweep.c);o.m_sweep.a0=o.m_sweep.a;o.m_sweep.c.x+=t.dt*o.m_linearVelocity.x;o.m_sweep.c.y+=t.dt*o.m_linearVelocity.y;o.m_sweep.a+=t.dt*o.m_angularVelocity;o.SynchronizeTransform()}for(r=0;r<t.positionIterations;++r){var f=h.SolvePositionConstraints(u.b2_contactBaumgarte);var m=true;for(a=0;a<this.m_jointCount;++a){s=this.m_joints[a];var d=s.SolvePositionConstraints(u.b2_contactBaumgarte);m=m&&d}if(f&&m){break}}this.Report(h.m_constraints);if(i){var g=Number.MAX_VALUE;var y=u.b2_linearSleepTolerance*u.b2_linearSleepTolerance;var v=u.b2_angularSleepTolerance*u.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r){o=this.m_bodies[r];if(o.GetType()==z.b2_staticBody){continue}if((o.m_flags&z.e_allowSleepFlag)==0){o.m_sleepTime=0;g=0}if((o.m_flags&z.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>v||n.Dot(o.m_linearVelocity,o.m_linearVelocity)>y){o.m_sleepTime=0;g=0}else{o.m_sleepTime+=t.dt;g=n.Min(g,o.m_sleepTime)}}if(g>=u.b2_timeToSleep){for(r=0;r<this.m_bodyCount;++r){
o=this.m_bodies[r];o.SetAwake(false)}}}};rt.prototype.SolveTOI=function(t){var e=0;var i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var n=this.m_contactSolver;for(e=0;e<this.m_jointCount;++e){this.m_joints[e].InitVelocityConstraints(t)}for(e=0;e<t.velocityIterations;++e){n.SolveVelocityConstraints();for(i=0;i<this.m_jointCount;++i){this.m_joints[i].SolveVelocityConstraints(t)}}for(e=0;e<this.m_bodyCount;++e){var r=this.m_bodies[e];if(r.GetType()==z.b2_staticBody)continue;var a=t.dt*r.m_linearVelocity.x;var o=t.dt*r.m_linearVelocity.y;if(a*a+o*o>u.b2_maxTranslationSquared){r.m_linearVelocity.Normalize();r.m_linearVelocity.x*=u.b2_maxTranslation*t.inv_dt;r.m_linearVelocity.y*=u.b2_maxTranslation*t.inv_dt}var s=t.dt*r.m_angularVelocity;if(s*s>u.b2_maxRotationSquared){if(r.m_angularVelocity<0){r.m_angularVelocity=-u.b2_maxRotation*t.inv_dt}else{r.m_angularVelocity=u.b2_maxRotation*t.inv_dt}}r.m_sweep.c0.SetV(r.m_sweep.c);r.m_sweep.a0=r.m_sweep.a;r.m_sweep.c.x+=t.dt*r.m_linearVelocity.x;r.m_sweep.c.y+=t.dt*r.m_linearVelocity.y;r.m_sweep.a+=t.dt*r.m_angularVelocity;r.SynchronizeTransform()}var h=.75;for(e=0;e<t.positionIterations;++e){var l=n.SolvePositionConstraints(h);var c=true;for(i=0;i<this.m_jointCount;++i){var p=this.m_joints[i].SolvePositionConstraints(u.b2_contactBaumgarte);c=c&&p}if(l&&c){break}}this.Report(n.m_constraints)};rt.prototype.Report=function(t){if(this.m_listener==null){return}for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];var n=t[e];for(var r=0;r<n.pointCount;++r){rt.s_impulse.normalImpulses[r]=n.points[r].normalImpulse;rt.s_impulse.tangentImpulses[r]=n.points[r].tangentImpulse}this.m_listener.PostSolve(i,rt.s_impulse)}};rt.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=t};rt.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t};rt.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new q});at.b2TimeStep=function(){};at.prototype.Set=function(t){this.dt=t.dt;this.inv_dt=t.inv_dt;this.positionIterations=t.positionIterations;this.velocityIterations=t.velocityIterations;this.warmStarting=t.warmStarting};ot.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new Q;this.m_contactSolver=new dt;this.m_island=new rt};ot.prototype.b2World=function(t,e){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;ot.m_warmStarting=true;ot.m_continuousPhysics=true;this.m_allowSleep=e;t.y=t.y;this.m_gravity=t;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var i=new K;this.m_groundBody=this.CreateBody(i)};ot.prototype.SetDestructionListener=function(t){this.m_destructionListener=t};ot.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t};ot.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t};ot.prototype.SetDebugDraw=function(t){this.m_debugDraw=t};ot.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next){for(var n=i.m_fixtureList;n;n=n.m_next){n.m_proxy=t.CreateProxy(e.GetFatAABB(n.m_proxy),n)}}};ot.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};ot.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};ot.prototype.CreateBody=function(t){if(this.IsLocked()==true){return null}var e=new z(t,this);e.m_prev=null;e.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=e}this.m_bodyList=e;++this.m_bodyCount;return e};ot.prototype.DestroyBody=function(t){if(this.IsLocked()==true){return}var e=t.m_jointList;while(e){var i=e;e=e.next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeJoint(i.joint)}this.DestroyJoint(i.joint)}var n=t.m_controllerList;while(n){var r=n;n=n.nextController;r.controller.RemoveBody(t)}var a=t.m_contactList;while(a){var o=a;a=a.next;this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;var s=t.m_fixtureList;while(s){var h=s;s=s.m_next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeFixture(h)}h.DestroyProxy(this.m_contactManager.m_broadPhase);h.Destroy()}t.m_fixtureList=null;t.m_fixtureCount=0;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_bodyList){this.m_bodyList=t.m_next}--this.m_bodyCount};ot.prototype.CreateJoint=function(t){var e=Ut.Create(t,null);e.m_prev=null;e.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=e}this.m_jointList=e;++this.m_jointCount;e.m_edgeA.joint=e;e.m_edgeA.other=e.m_bodyB;e.m_edgeA.prev=null;e.m_edgeA.next=e.m_bodyA.m_jointList;if(e.m_bodyA.m_jointList)e.m_bodyA.m_jointList.prev=e.m_edgeA;e.m_bodyA.m_jointList=e.m_edgeA;e.m_edgeB.joint=e;e.m_edgeB.other=e.m_bodyA;e.m_edgeB.prev=null;e.m_edgeB.next=e.m_bodyB.m_jointList;if(e.m_bodyB.m_jointList)e.m_bodyB.m_jointList.prev=e.m_edgeB;e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA;var n=t.bodyB;if(t.collideConnected==false){var r=n.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}return e};ot.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_jointList){this.m_jointList=t.m_next}var i=t.m_bodyA;var n=t.m_bodyB;i.SetAwake(true);n.SetAwake(true);if(t.m_edgeA.prev){t.m_edgeA.prev.next=t.m_edgeA.next}if(t.m_edgeA.next){t.m_edgeA.next.prev=t.m_edgeA.prev}if(t.m_edgeA==i.m_jointList){i.m_jointList=t.m_edgeA.next}t.m_edgeA.prev=null;t.m_edgeA.next=null;if(t.m_edgeB.prev){t.m_edgeB.prev.next=t.m_edgeB.next}if(t.m_edgeB.next){t.m_edgeB.next.prev=t.m_edgeB.prev}if(t.m_edgeB==n.m_jointList){n.m_jointList=t.m_edgeB.next}t.m_edgeB.prev=null;t.m_edgeB.next=null;Ut.Destroy(t,null);--this.m_jointCount;if(e==false){var r=n.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}};ot.prototype.AddController=function(t){t.m_next=this.m_controllerList;t.m_prev=null;this.m_controllerList=t;t.m_world=this;this.m_controllerCount++;return t};ot.prototype.RemoveController=function(t){if(t.m_prev)t.m_prev.m_next=t.m_next;if(t.m_next)t.m_next.m_prev=t.m_prev;if(this.m_controllerList==t)this.m_controllerList=t.m_next;this.m_controllerCount--};ot.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");t.m_next=this.m_controllerList;t.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=t;this.m_controllerList=t;++this.m_controllerCount;t.m_world=this;return t};ot.prototype.DestroyController=function(t){t.Clear();if(t.m_next)t.m_next.m_prev=t.m_prev;if(t.m_prev)t.m_prev.m_next=t.m_next;if(t==this.m_controllerList)this.m_controllerList=t.m_next;--this.m_controllerCount};ot.prototype.SetWarmStarting=function(t){ot.m_warmStarting=t};ot.prototype.SetContinuousPhysics=function(t){ot.m_continuousPhysics=t};ot.prototype.GetBodyCount=function(){return this.m_bodyCount};ot.prototype.GetJointCount=function(){return this.m_jointCount};ot.prototype.GetContactCount=function(){return this.m_contactCount};ot.prototype.SetGravity=function(t){this.m_gravity=t};ot.prototype.GetGravity=function(){return this.m_gravity};ot.prototype.GetGroundBody=function(){return this.m_groundBody};ot.prototype.Step=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;if(this.m_flags&ot.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~ot.e_newFixture}this.m_flags|=ot.e_locked;var n=ot.s_timestep2;n.dt=t;n.velocityIterations=e;n.positionIterations=i;if(t>0){n.inv_dt=1/t}else{n.inv_dt=0}n.dtRatio=this.m_inv_dt0*t;n.warmStarting=ot.m_warmStarting;this.m_contactManager.Collide();if(n.dt>0){this.Solve(n)}if(ot.m_continuousPhysics&&n.dt>0){this.SolveTOI(n)}if(n.dt>0){this.m_inv_dt0=n.inv_dt}this.m_flags&=~ot.e_locked};ot.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next){t.m_force.SetZero();t.m_torque=0}};ot.prototype.DrawDebugData=function(){if(this.m_debugDraw==null){return}this.m_debugDraw.m_sprite.graphics.clear();var t=this.m_debugDraw.GetFlags();var e=0;var i;var n;var r;var a;var s;var l=new o;var u=new o;var p=new o;var f;var m=new c;var d=new c;var g=[new o,new o,new o,new o];var y=new h(0,0,0);if(t&$.e_shapeBit){for(i=this.m_bodyList;i;i=i.m_next){f=i.m_xf;for(n=i.GetFixtureList();n;n=n.m_next){r=n.GetShape();if(i.IsActive()==false){y.Set(.5,.5,.3);this.DrawShape(r,f,y)}else if(i.GetType()==z.b2_staticBody){y.Set(.5,.9,.5);this.DrawShape(r,f,y)}else if(i.GetType()==z.b2_kinematicBody){y.Set(.5,.5,.9);this.DrawShape(r,f,y)}else if(i.IsAwake()==false){y.Set(.6,.6,.6);this.DrawShape(r,f,y)}else{y.Set(.9,.7,.7);this.DrawShape(r,f,y)}}}}if(t&$.e_jointBit){for(a=this.m_jointList;a;a=a.m_next){this.DrawJoint(a)}}if(t&$.e_controllerBit){for(var v=this.m_controllerList;v;v=v.m_next){v.Draw(this.m_debugDraw)}}if(t&$.e_pairBit){y.Set(.3,.9,.9);for(var _=this.m_contactManager.m_contactList;_;_=_.GetNext()){var I=_.GetFixtureA();var w=_.GetFixtureB();var x=I.GetAABB().GetCenter();var S=w.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(x,S,y)}}if(t&$.e_aabbBit){s=this.m_contactManager.m_broadPhase;g=[new o,new o,new o,new o];for(i=this.m_bodyList;i;i=i.GetNext()){if(i.IsActive()==false){continue}for(n=i.GetFixtureList();n;n=n.GetNext()){var C=s.GetFatAABB(n.m_proxy);g[0].Set(C.lowerBound.x,C.lowerBound.y);g[1].Set(C.upperBound.x,C.lowerBound.y);g[2].Set(C.upperBound.x,C.upperBound.y);g[3].Set(C.lowerBound.x,C.upperBound.y);this.m_debugDraw.DrawPolygon(g,4,y)}}}if(t&$.e_centerOfMassBit){for(i=this.m_bodyList;i;i=i.m_next){f=ot.s_xf;f.R=i.m_xf.R;f.position=i.GetWorldCenter();this.m_debugDraw.DrawTransform(f)}}};ot.prototype.QueryAABB=function(t,e){var i=this;var n=i.m_contactManager.m_broadPhase;function r(e){return t(n.GetUserData(e))}n.Query(r,e)};ot.prototype.QueryShape=function(t,e,i){var n=this;if(i===undefined)i=null;if(i==null){i=new a;i.SetIdentity()}var r=n.m_contactManager.m_broadPhase;function o(n){var a=r.GetUserData(n)instanceof it?r.GetUserData(n):null;if(X.TestOverlap(e,i,a.GetShape(),a.GetBody().GetTransform()))return t(a);return true}var s=new c;e.ComputeAABB(s,i);r.Query(o,s)};ot.prototype.QueryPoint=function(t,e){var i=this;var n=i.m_contactManager.m_broadPhase;function r(i){var r=n.GetUserData(i)instanceof it?n.GetUserData(i):null;if(r.TestPoint(e))return t(r);return true}var a=new c;a.lowerBound.Set(e.x-u.b2_linearSlop,e.y-u.b2_linearSlop);a.upperBound.Set(e.x+u.b2_linearSlop,e.y+u.b2_linearSlop);n.Query(r,a)};ot.prototype.RayCast=function(t,e,i){var n=this;var r=n.m_contactManager.m_broadPhase;var a=new E;function s(n,s){var h=r.GetUserData(s);var l=h instanceof it?h:null;var u=l.RayCast(a,n);if(u){var c=a.fraction;var p=new o((1-c)*e.x+c*i.x,(1-c)*e.y+c*i.y);return t(l,p,a.normal,c)}return n.maxFraction}var h=new A(e,i);r.RayCast(s,h)};ot.prototype.RayCastOne=function(t,e){var i=this;var n;function r(t,e,i,r){if(r===undefined)r=0;n=t;return r}i.RayCast(r,t,e);return n};ot.prototype.RayCastAll=function(t,e){var i=this;var n=new Vector;function r(t,e,i,r){if(r===undefined)r=0;n[n.length]=t;return 1}i.RayCast(r,t,e);return n};ot.prototype.GetBodyList=function(){return this.m_bodyList};ot.prototype.GetJointList=function(){return this.m_jointList};ot.prototype.GetContactList=function(){return this.m_contactList};ot.prototype.IsLocked=function(){return(this.m_flags&ot.e_locked)>0};ot.prototype.Solve=function(t){var e;for(var i=this.m_controllerList;i;i=i.m_next){i.Step(t)}var n=this.m_island;n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~z.e_islandFlag}for(var r=this.m_contactList;r;r=r.m_next){r.m_flags&=~ht.e_islandFlag}for(var a=this.m_jointList;a;a=a.m_next){a.m_islandFlag=false}var o=parseInt(this.m_bodyCount);var s=this.s_stack;for(var h=this.m_bodyList;h;h=h.m_next){if(h.m_flags&z.e_islandFlag){continue}if(h.IsAwake()==false||h.IsActive()==false){continue}if(h.GetType()==z.b2_staticBody){continue}n.Clear();var l=0;s[l++]=h;h.m_flags|=z.e_islandFlag;while(l>0){e=s[--l];n.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()==z.b2_staticBody){continue}var u;for(var c=e.m_contactList;c;c=c.next){if(c.contact.m_flags&ht.e_islandFlag){continue}if(c.contact.IsSensor()==true||c.contact.IsEnabled()==false||c.contact.IsTouching()==false){continue}n.AddContact(c.contact);c.contact.m_flags|=ht.e_islandFlag;u=c.other;if(u.m_flags&z.e_islandFlag){continue}s[l++]=u;u.m_flags|=z.e_islandFlag}for(var p=e.m_jointList;p;p=p.next){if(p.joint.m_islandFlag==true){continue}u=p.other;if(u.IsActive()==false){continue}n.AddJoint(p.joint);p.joint.m_islandFlag=true;if(u.m_flags&z.e_islandFlag){continue}s[l++]=u;u.m_flags|=z.e_islandFlag}}n.Solve(t,this.m_gravity,this.m_allowSleep);for(var f=0;f<n.m_bodyCount;++f){e=n.m_bodies[f];if(e.GetType()==z.b2_staticBody){e.m_flags&=~z.e_islandFlag}}}for(f=0;f<s.length;++f){if(!s[f])break;s[f]=null}for(e=this.m_bodyList;e;e=e.m_next){if(e.IsAwake()==false||e.IsActive()==false){continue}if(e.GetType()==z.b2_staticBody){continue}e.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};ot.prototype.SolveTOI=function(t){var e;var i;var n;var r;var a;var o;var s;var h=this.m_island;h.Initialize(this.m_bodyCount,u.b2_maxTOIContactsPerIsland,u.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var l=ot.s_queue;for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~z.e_islandFlag;e.m_sweep.t0=0}var c;for(c=this.m_contactList;c;c=c.m_next){c.m_flags&=~(ht.e_toiFlag|ht.e_islandFlag)}for(s=this.m_jointList;s;s=s.m_next){s.m_islandFlag=false}for(;;){var p=null;var f=1;for(c=this.m_contactList;c;c=c.m_next){if(c.IsSensor()==true||c.IsEnabled()==false||c.IsContinuous()==false){continue}var m=1;if(c.m_flags&ht.e_toiFlag){m=c.m_toi}else{i=c.m_fixtureA;n=c.m_fixtureB;r=i.m_body;a=n.m_body;if((r.GetType()!=z.b2_dynamicBody||r.IsAwake()==false)&&(a.GetType()!=z.b2_dynamicBody||a.IsAwake()==false)){continue}var d=r.m_sweep.t0;if(r.m_sweep.t0<a.m_sweep.t0){d=a.m_sweep.t0;r.m_sweep.Advance(d)}else if(a.m_sweep.t0<r.m_sweep.t0){d=r.m_sweep.t0;a.m_sweep.Advance(d)}m=c.ComputeTOI(r.m_sweep,a.m_sweep);u.b2Assert(0<=m&&m<=1);if(m>0&&m<1){m=(1-m)*d+m;if(m>1)m=1}c.m_toi=m;c.m_flags|=ht.e_toiFlag}if(Box2D.MIN_VALUE<m&&m<f){p=c;f=m}}if(p==null||1-100*Box2D.MIN_VALUE<f){break}i=p.m_fixtureA;n=p.m_fixtureB;r=i.m_body;a=n.m_body;ot.s_backupA.Set(r.m_sweep);ot.s_backupB.Set(a.m_sweep);r.Advance(f);a.Advance(f);p.Update(this.m_contactManager.m_contactListener);p.m_flags&=~ht.e_toiFlag;if(p.IsSensor()==true||p.IsEnabled()==false){r.m_sweep.Set(ot.s_backupA);a.m_sweep.Set(ot.s_backupB);r.SynchronizeTransform();a.SynchronizeTransform();continue}if(p.IsTouching()==false){continue}var g=r;if(g.GetType()!=z.b2_dynamicBody){g=a}h.Clear();var y=0;var v=0;l[y+v++]=g;g.m_flags|=z.e_islandFlag;while(v>0){e=l[y++];--v;h.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()!=z.b2_dynamicBody){continue}for(o=e.m_contactList;o;o=o.next){if(h.m_contactCount==h.m_contactCapacity){break}if(o.contact.m_flags&ht.e_islandFlag){continue}if(o.contact.IsSensor()==true||o.contact.IsEnabled()==false||o.contact.IsTouching()==false){continue}h.AddContact(o.contact);o.contact.m_flags|=ht.e_islandFlag;var _=o.other;if(_.m_flags&z.e_islandFlag){continue}if(_.GetType()!=z.b2_staticBody){_.Advance(f);_.SetAwake(true)}l[y+v]=_;++v;_.m_flags|=z.e_islandFlag}for(var I=e.m_jointList;I;I=I.next){if(h.m_jointCount==h.m_jointCapacity)continue;if(I.joint.m_islandFlag==true)continue;_=I.other;if(_.IsActive()==false){continue}h.AddJoint(I.joint);I.joint.m_islandFlag=true;if(_.m_flags&z.e_islandFlag)continue;if(_.GetType()!=z.b2_staticBody){_.Advance(f);_.SetAwake(true)}l[y+v]=_;++v;_.m_flags|=z.e_islandFlag}}var w=ot.s_timestep;w.warmStarting=false;w.dt=(1-f)*t.dt;w.inv_dt=1/w.dt;w.dtRatio=0;w.velocityIterations=t.velocityIterations;w.positionIterations=t.positionIterations;h.SolveTOI(w);var x=0;for(x=0;x<h.m_bodyCount;++x){e=h.m_bodies[x];e.m_flags&=~z.e_islandFlag;if(e.IsAwake()==false){continue}if(e.GetType()!=z.b2_dynamicBody){continue}e.SynchronizeFixtures();for(o=e.m_contactList;o;o=o.next){o.contact.m_flags&=~ht.e_toiFlag}}for(x=0;x<h.m_contactCount;++x){c=h.m_contacts[x];c.m_flags&=~(ht.e_toiFlag|ht.e_islandFlag)}for(x=0;x<h.m_jointCount;++x){s=h.m_joints[x];s.m_islandFlag=false}this.m_contactManager.FindNewContacts()}};ot.prototype.DrawJoint=function(t){var e=t.GetBodyA();var i=t.GetBodyB();var n=e.m_xf;var r=i.m_xf;var a=n.position;var o=r.position;var s=t.GetAnchorA();var h=t.GetAnchorB();var l=ot.s_jointColor;switch(t.m_type){case Ut.e_distanceJoint:this.m_debugDraw.DrawSegment(s,h,l);break;case Ut.e_pulleyJoint:{var u=t instanceof Ft?t:null;var c=u.GetGroundAnchorA();var p=u.GetGroundAnchorB();this.m_debugDraw.DrawSegment(c,s,l);this.m_debugDraw.DrawSegment(p,h,l);this.m_debugDraw.DrawSegment(c,p,l)}break;case Ut.e_mouseJoint:this.m_debugDraw.DrawSegment(s,h,l);break;default:if(e!=this.m_groundBody)this.m_debugDraw.DrawSegment(a,s,l);this.m_debugDraw.DrawSegment(s,h,l);if(i!=this.m_groundBody)this.m_debugDraw.DrawSegment(o,h,l)}};ot.prototype.DrawShape=function(t,e,i){switch(t.m_type){case X.e_circleShape:{var r=t instanceof k?t:null;var a=n.MulX(e,r.m_p);var o=r.m_radius;var s=e.R.col1;this.m_debugDraw.DrawSolidCircle(a,o,s,i)}break;case X.e_polygonShape:{var h=0;var l=t instanceof J?t:null;var u=parseInt(l.GetVertexCount());var c=l.GetVertices();var p=new Vector(u);for(h=0;h<u;++h){p[h]=n.MulX(e,c[h])}this.m_debugDraw.DrawSolidPolygon(p,u,i)}break;case X.e_edgeShape:{var f=t instanceof H?t:null;this.m_debugDraw.DrawSegment(n.MulX(e,f.GetVertex1()),n.MulX(e,f.GetVertex2()),i)}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new at;Box2D.Dynamics.b2World.s_xf=new a;Box2D.Dynamics.b2World.s_backupA=new r;Box2D.Dynamics.b2World.s_backupB=new r;Box2D.Dynamics.b2World.s_timestep=new at;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new h(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,a=Box2D.Collision.Shapes.b2Shape,o=Box2D.Dynamics.Contacts.b2CircleContact,s=Box2D.Dynamics.Contacts.b2Contact,h=Box2D.Dynamics.Contacts.b2ContactConstraint,l=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,u=Box2D.Dynamics.Contacts.b2ContactEdge,c=Box2D.Dynamics.Contacts.b2ContactFactory,p=Box2D.Dynamics.Contacts.b2ContactRegister,f=Box2D.Dynamics.Contacts.b2ContactResult,m=Box2D.Dynamics.Contacts.b2ContactSolver,d=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,g=Box2D.Dynamics.Contacts.b2NullContact,y=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,v=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,_=Box2D.Dynamics.Contacts.b2PolygonContact,I=Box2D.Dynamics.Contacts.b2PositionSolverManifold,w=Box2D.Dynamics.b2Body,x=Box2D.Dynamics.b2BodyDef,S=Box2D.Dynamics.b2ContactFilter,C=Box2D.Dynamics.b2ContactImpulse,T=Box2D.Dynamics.b2ContactListener,b=Box2D.Dynamics.b2ContactManager,D=Box2D.Dynamics.b2DebugDraw,A=Box2D.Dynamics.b2DestructionListener,E=Box2D.Dynamics.b2FilterData,U=Box2D.Dynamics.b2Fixture,M=Box2D.Dynamics.b2FixtureDef,P=Box2D.Dynamics.b2Island,B=Box2D.Dynamics.b2TimeStep,L=Box2D.Dynamics.b2World,R=Box2D.Common.b2Color,O=Box2D.Common.b2internal,V=Box2D.Common.b2Settings,W=Box2D.Common.Math.b2Mat22,F=Box2D.Common.Math.b2Mat33,N=Box2D.Common.Math.b2Math,k=Box2D.Common.Math.b2Sweep,G=Box2D.Common.Math.b2Transform,H=Box2D.Common.Math.b2Vec2,Y=Box2D.Common.Math.b2Vec3,J=Box2D.Collision.b2AABB,X=Box2D.Collision.b2Bound,z=Box2D.Collision.b2BoundValues,K=Box2D.Collision.b2Collision,j=Box2D.Collision.b2ContactID,q=Box2D.Collision.b2ContactPoint,Z=Box2D.Collision.b2Distance,Q=Box2D.Collision.b2DistanceInput,$=Box2D.Collision.b2DistanceOutput,tt=Box2D.Collision.b2DistanceProxy,et=Box2D.Collision.b2DynamicTree,it=Box2D.Collision.b2DynamicTreeBroadPhase,nt=Box2D.Collision.b2DynamicTreeNode,rt=Box2D.Collision.b2DynamicTreePair,at=Box2D.Collision.b2Manifold,ot=Box2D.Collision.b2ManifoldPoint,st=Box2D.Collision.b2Point,ht=Box2D.Collision.b2RayCastInput,lt=Box2D.Collision.b2RayCastOutput,ut=Box2D.Collision.b2Segment,ct=Box2D.Collision.b2SeparationFunction,pt=Box2D.Collision.b2Simplex,ft=Box2D.Collision.b2SimplexCache,mt=Box2D.Collision.b2SimplexVertex,dt=Box2D.Collision.b2TimeOfImpact,gt=Box2D.Collision.b2TOIInput,yt=Box2D.Collision.b2WorldManifold,vt=Box2D.Collision.ClipVertex,_t=Box2D.Collision.Features,It=Box2D.Collision.IBroadPhase;Box2D.inherit(o,Box2D.Dynamics.Contacts.b2Contact);o.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;o.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};o.Create=function(t){return new o};o.Destroy=function(t,e){};o.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};o.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();K.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};s.b2Contact=function(){this.m_nodeA=new u;this.m_nodeB=new u;this.m_manifold=new at;this.m_oldManifold=new at};s.prototype.GetManifold=function(){return this.m_manifold};s.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();var n=this.m_fixtureA.GetShape();var r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)};s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag};s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag};s.prototype.SetSensor=function(t){if(t){this.m_flags|=s.e_sensorFlag}else{this.m_flags&=~s.e_sensorFlag}};s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag};s.prototype.SetEnabled=function(t){if(t){this.m_flags|=s.e_enabledFlag}else{this.m_flags&=~s.e_enabledFlag}};s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag};s.prototype.GetNext=function(){return this.m_next};s.prototype.GetFixtureA=function(){return this.m_fixtureA};s.prototype.GetFixtureB=function(){return this.m_fixtureB};s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag};s.prototype.b2Contact=function(){};s.prototype.Reset=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;this.m_flags=s.e_enabledFlag;if(!t||!e){this.m_fixtureA=null;this.m_fixtureB=null;return}if(t.IsSensor()||e.IsSensor()){this.m_flags|=s.e_sensorFlag}var i=t.GetBody();var n=e.GetBody();if(i.GetType()!=w.b2_dynamicBody||i.IsBullet()||n.GetType()!=w.b2_dynamicBody||n.IsBullet()){this.m_flags|=s.e_continuousFlag}this.m_fixtureA=t;this.m_fixtureB=e;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null};s.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=e;this.m_flags|=s.e_enabledFlag;var i=false;var n=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag;var r=this.m_fixtureA.m_body;var o=this.m_fixtureB.m_body;var h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(h){var l=this.m_fixtureA.GetShape();var u=this.m_fixtureB.GetShape();var c=r.GetTransform();var p=o.GetTransform();i=a.TestOverlap(l,c,u,p)}this.m_manifold.m_pointCount=0}else{if(r.GetType()!=w.b2_dynamicBody||r.IsBullet()||o.GetType()!=w.b2_dynamicBody||o.IsBullet()){this.m_flags|=s.e_continuousFlag}else{this.m_flags&=~s.e_continuousFlag}if(h){this.Evaluate();i=this.m_manifold.m_pointCount>0;for(var f=0;f<this.m_manifold.m_pointCount;++f){var m=this.m_manifold.m_points[f];m.m_normalImpulse=0;m.m_tangentImpulse=0;var d=m.m_id;for(var g=0;g<this.m_oldManifold.m_pointCount;++g){var y=this.m_oldManifold.m_points[g];if(y.m_id.key==d.key){m.m_normalImpulse=y.m_normalImpulse;m.m_tangentImpulse=y.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(i!=n){r.SetAwake(true);o.SetAwake(true)}}if(i){this.m_flags|=s.e_touchingFlag}else{this.m_flags&=~s.e_touchingFlag}if(n==false&&i==true){t.BeginContact(this)}if(n==true&&i==false){t.EndContact(this)}if((this.m_flags&s.e_sensorFlag)==0){t.PreSolve(this,this.m_oldManifold)}};s.prototype.Evaluate=function(){};s.prototype.ComputeTOI=function(t,e){s.s_input.proxyA.Set(this.m_fixtureA.GetShape());s.s_input.proxyB.Set(this.m_fixtureB.GetShape());s.s_input.sweepA=t;s.s_input.sweepB=e;s.s_input.tolerance=V.b2_linearSlop;return dt.TimeOfImpact(s.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new gt});h.b2ContactConstraint=function(){this.localPlaneNormal=new H;this.localPoint=new H;this.normal=new H;this.normalMass=new W;this.K=new W};h.prototype.b2ContactConstraint=function(){this.points=new Vector(V.b2_maxManifoldPoints);for(var t=0;t<V.b2_maxManifoldPoints;t++){this.points[t]=new l}};l.b2ContactConstraintPoint=function(){this.localPoint=new H;this.rA=new H;this.rB=new H};u.b2ContactEdge=function(){};c.b2ContactFactory=function(){};c.prototype.b2ContactFactory=function(t){this.m_allocator=t;this.InitializeRegisters()};c.prototype.AddType=function(t,e,i,n){if(i===undefined)i=0;if(n===undefined)n=0;this.m_registers[i][n].createFcn=t;this.m_registers[i][n].destroyFcn=e;this.m_registers[i][n].primary=true;if(i!=n){this.m_registers[n][i].createFcn=t;this.m_registers[n][i].destroyFcn=e;this.m_registers[n][i].primary=false}};c.prototype.InitializeRegisters=function(){this.m_registers=new Vector(a.e_shapeTypeCount);for(var t=0;t<a.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(a.e_shapeTypeCount);for(var e=0;e<a.e_shapeTypeCount;e++){this.m_registers[t][e]=new p}}this.AddType(o.Create,o.Destroy,a.e_circleShape,a.e_circleShape);this.AddType(y.Create,y.Destroy,a.e_polygonShape,a.e_circleShape);this.AddType(_.Create,_.Destroy,a.e_polygonShape,a.e_polygonShape);this.AddType(d.Create,d.Destroy,a.e_edgeShape,a.e_circleShape);this.AddType(v.Create,v.Destroy,a.e_polygonShape,a.e_edgeShape)};c.prototype.Create=function(t,e){var i=parseInt(t.GetType());var n=parseInt(e.GetType());var r=this.m_registers[i][n];var a;if(r.pool){a=r.pool;r.pool=a.m_next;r.poolCount--;a.Reset(t,e);return a}var o=r.createFcn;if(o!=null){if(r.primary){a=o(this.m_allocator);a.Reset(t,e);return a}else{a=o(this.m_allocator);a.Reset(e,t);return a}}else{return null}};c.prototype.Destroy=function(t){if(t.m_manifold.m_pointCount>0){t.m_fixtureA.m_body.SetAwake(true);t.m_fixtureB.m_body.SetAwake(true)}var e=parseInt(t.m_fixtureA.GetType());var i=parseInt(t.m_fixtureB.GetType());var n=this.m_registers[e][i];if(true){n.poolCount++;t.m_next=n.pool;n.pool=t}var r=n.destroyFcn;r(t,this.m_allocator)};p.b2ContactRegister=function(){};f.b2ContactResult=function(){this.position=new H;this.normal=new H;this.id=new j};m.b2ContactSolver=function(){this.m_step=new B;this.m_constraints=new Vector};m.prototype.b2ContactSolver=function(){};m.prototype.Initialize=function(t,e,i,n){if(i===undefined)i=0;var r;this.m_step.Set(t);this.m_allocator=n;var a=0;var o;var s;this.m_constraintCount=i;while(this.m_constraints.length<this.m_constraintCount){this.m_constraints[this.m_constraints.length]=new h}for(a=0;a<i;++a){r=e[a];var l=r.m_fixtureA;var u=r.m_fixtureB;var c=l.m_shape;var p=u.m_shape;var f=c.m_radius;var d=p.m_radius;var g=l.m_body;var y=u.m_body;var v=r.GetManifold();var _=V.b2MixFriction(l.GetFriction(),u.GetFriction());var I=V.b2MixRestitution(l.GetRestitution(),u.GetRestitution());var w=g.m_linearVelocity.x;var x=g.m_linearVelocity.y;var S=y.m_linearVelocity.x;var C=y.m_linearVelocity.y;var T=g.m_angularVelocity;var b=y.m_angularVelocity;V.b2Assert(v.m_pointCount>0);m.s_worldManifold.Initialize(v,g.m_xf,f,y.m_xf,d);var D=m.s_worldManifold.m_normal.x;var A=m.s_worldManifold.m_normal.y;var E=this.m_constraints[a];E.bodyA=g;E.bodyB=y;E.manifold=v;E.normal.x=D;E.normal.y=A;E.pointCount=v.m_pointCount;E.friction=_;E.restitution=I;E.localPlaneNormal.x=v.m_localPlaneNormal.x;E.localPlaneNormal.y=v.m_localPlaneNormal.y;E.localPoint.x=v.m_localPoint.x;E.localPoint.y=v.m_localPoint.y;E.radius=f+d;E.type=v.m_type;for(var U=0;U<E.pointCount;++U){var M=v.m_points[U];var P=E.points[U];P.normalImpulse=M.m_normalImpulse;P.tangentImpulse=M.m_tangentImpulse;P.localPoint.SetV(M.m_localPoint);var B=P.rA.x=m.s_worldManifold.m_points[U].x-g.m_sweep.c.x;var L=P.rA.y=m.s_worldManifold.m_points[U].y-g.m_sweep.c.y;var R=P.rB.x=m.s_worldManifold.m_points[U].x-y.m_sweep.c.x;var O=P.rB.y=m.s_worldManifold.m_points[U].y-y.m_sweep.c.y;var W=B*A-L*D;var F=R*A-O*D;W*=W;F*=F;var N=g.m_invMass+y.m_invMass+g.m_invI*W+y.m_invI*F;P.normalMass=1/N;var k=g.m_mass*g.m_invMass+y.m_mass*y.m_invMass;k+=g.m_mass*g.m_invI*W+y.m_mass*y.m_invI*F;P.equalizedMass=1/k;var G=A;var H=-D;var Y=B*H-L*G;var J=R*H-O*G;Y*=Y;J*=J;var X=g.m_invMass+y.m_invMass+g.m_invI*Y+y.m_invI*J;P.tangentMass=1/X;P.velocityBias=0;var z=S+-b*O-w- -T*L;var K=C+b*R-x-T*B;var j=E.normal.x*z+E.normal.y*K;if(j<-V.b2_velocityThreshold){P.velocityBias+=-E.restitution*j}}if(E.pointCount==2){var q=E.points[0];var Z=E.points[1];var Q=g.m_invMass;var $=g.m_invI;var tt=y.m_invMass;var et=y.m_invI;var it=q.rA.x*A-q.rA.y*D;var nt=q.rB.x*A-q.rB.y*D;var rt=Z.rA.x*A-Z.rA.y*D;var at=Z.rB.x*A-Z.rB.y*D;var ot=Q+tt+$*it*it+et*nt*nt;var st=Q+tt+$*rt*rt+et*at*at;var ht=Q+tt+$*it*rt+et*nt*at;var lt=100;if(ot*ot<lt*(ot*st-ht*ht)){E.K.col1.Set(ot,ht);E.K.col2.Set(ht,st);E.K.GetInverse(E.normalMass)}else{E.pointCount=1}}}};m.prototype.InitVelocityConstraints=function(t){var e;var i;var n;for(var r=0;r<this.m_constraintCount;++r){var a=this.m_constraints[r];var o=a.bodyA;var s=a.bodyB;var h=o.m_invMass;var l=o.m_invI;var u=s.m_invMass;var c=s.m_invI;var p=a.normal.x;var f=a.normal.y;var m=f;var d=-p;var g=0;var y=0;var v=0;if(t.warmStarting){v=a.pointCount;for(y=0;y<v;++y){var _=a.points[y];_.normalImpulse*=t.dtRatio;_.tangentImpulse*=t.dtRatio;var I=_.normalImpulse*p+_.tangentImpulse*m;var w=_.normalImpulse*f+_.tangentImpulse*d;o.m_angularVelocity-=l*(_.rA.x*w-_.rA.y*I);o.m_linearVelocity.x-=h*I;o.m_linearVelocity.y-=h*w;s.m_angularVelocity+=c*(_.rB.x*w-_.rB.y*I);s.m_linearVelocity.x+=u*I;s.m_linearVelocity.y+=u*w}}else{v=a.pointCount;for(y=0;y<v;++y){var x=a.points[y];x.normalImpulse=0;x.tangentImpulse=0}}}};m.prototype.SolveVelocityConstraints=function(){var t=0;var e;var i=0;var n=0;var r=0;var a=0;var o=0;var s=0;var h=0;var l=0;var u=0;var c=0;var p=0;var f=0;var m=0;var d=0;var g=0;var y=0;var v=0;var _=0;var I=0;var w;var x;for(var S=0;S<this.m_constraintCount;++S){var C=this.m_constraints[S];var T=C.bodyA;var b=C.bodyB;var D=T.m_angularVelocity;var A=b.m_angularVelocity;var E=T.m_linearVelocity;var U=b.m_linearVelocity;var M=T.m_invMass;var P=T.m_invI;var B=b.m_invMass;var L=b.m_invI;var R=C.normal.x;var O=C.normal.y;var V=O;var W=-R;var F=C.friction;var k=0;for(t=0;t<C.pointCount;t++){e=C.points[t];
o=U.x-A*e.rB.y-E.x+D*e.rA.y;s=U.y+A*e.rB.x-E.y-D*e.rA.x;l=o*V+s*W;u=e.tangentMass*-l;c=F*e.normalImpulse;p=N.Clamp(e.tangentImpulse+u,-c,c);u=p-e.tangentImpulse;f=u*V;m=u*W;E.x-=M*f;E.y-=M*m;D-=P*(e.rA.x*m-e.rA.y*f);U.x+=B*f;U.y+=B*m;A+=L*(e.rB.x*m-e.rB.y*f);e.tangentImpulse=p}var G=parseInt(C.pointCount);if(C.pointCount==1){e=C.points[0];o=U.x+-A*e.rB.y-E.x- -D*e.rA.y;s=U.y+A*e.rB.x-E.y-D*e.rA.x;h=o*R+s*O;u=-e.normalMass*(h-e.velocityBias);p=e.normalImpulse+u;p=p>0?p:0;u=p-e.normalImpulse;f=u*R;m=u*O;E.x-=M*f;E.y-=M*m;D-=P*(e.rA.x*m-e.rA.y*f);U.x+=B*f;U.y+=B*m;A+=L*(e.rB.x*m-e.rB.y*f);e.normalImpulse=p}else{var H=C.points[0];var Y=C.points[1];var J=H.normalImpulse;var X=Y.normalImpulse;var z=U.x-A*H.rB.y-E.x+D*H.rA.y;var K=U.y+A*H.rB.x-E.y-D*H.rA.x;var j=U.x-A*Y.rB.y-E.x+D*Y.rA.y;var q=U.y+A*Y.rB.x-E.y-D*Y.rA.x;var Z=z*R+K*O;var Q=j*R+q*O;var $=Z-H.velocityBias;var tt=Q-Y.velocityBias;w=C.K;$-=w.col1.x*J+w.col2.x*X;tt-=w.col1.y*J+w.col2.y*X;var et=.001;for(;;){w=C.normalMass;var it=-(w.col1.x*$+w.col2.x*tt);var nt=-(w.col1.y*$+w.col2.y*tt);if(it>=0&&nt>=0){d=it-J;g=nt-X;y=d*R;v=d*O;_=g*R;I=g*O;E.x-=M*(y+_);E.y-=M*(v+I);D-=P*(H.rA.x*v-H.rA.y*y+Y.rA.x*I-Y.rA.y*_);U.x+=B*(y+_);U.y+=B*(v+I);A+=L*(H.rB.x*v-H.rB.y*y+Y.rB.x*I-Y.rB.y*_);H.normalImpulse=it;Y.normalImpulse=nt;break}it=-H.normalMass*$;nt=0;Z=0;Q=C.K.col1.y*it+tt;if(it>=0&&Q>=0){d=it-J;g=nt-X;y=d*R;v=d*O;_=g*R;I=g*O;E.x-=M*(y+_);E.y-=M*(v+I);D-=P*(H.rA.x*v-H.rA.y*y+Y.rA.x*I-Y.rA.y*_);U.x+=B*(y+_);U.y+=B*(v+I);A+=L*(H.rB.x*v-H.rB.y*y+Y.rB.x*I-Y.rB.y*_);H.normalImpulse=it;Y.normalImpulse=nt;break}it=0;nt=-Y.normalMass*tt;Z=C.K.col2.x*nt+$;Q=0;if(nt>=0&&Z>=0){d=it-J;g=nt-X;y=d*R;v=d*O;_=g*R;I=g*O;E.x-=M*(y+_);E.y-=M*(v+I);D-=P*(H.rA.x*v-H.rA.y*y+Y.rA.x*I-Y.rA.y*_);U.x+=B*(y+_);U.y+=B*(v+I);A+=L*(H.rB.x*v-H.rB.y*y+Y.rB.x*I-Y.rB.y*_);H.normalImpulse=it;Y.normalImpulse=nt;break}it=0;nt=0;Z=$;Q=tt;if(Z>=0&&Q>=0){d=it-J;g=nt-X;y=d*R;v=d*O;_=g*R;I=g*O;E.x-=M*(y+_);E.y-=M*(v+I);D-=P*(H.rA.x*v-H.rA.y*y+Y.rA.x*I-Y.rA.y*_);U.x+=B*(y+_);U.y+=B*(v+I);A+=L*(H.rB.x*v-H.rB.y*y+Y.rB.x*I-Y.rB.y*_);H.normalImpulse=it;Y.normalImpulse=nt;break}break}}T.m_angularVelocity=D;b.m_angularVelocity=A}};m.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t){var e=this.m_constraints[t];var i=e.manifold;for(var n=0;n<e.pointCount;++n){var r=i.m_points[n];var a=e.points[n];r.m_normalImpulse=a.normalImpulse;r.m_tangentImpulse=a.tangentImpulse}}};m.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;for(var i=0;i<this.m_constraintCount;i++){var n=this.m_constraints[i];var r=n.bodyA;var a=n.bodyB;var o=r.m_mass*r.m_invMass;var s=r.m_mass*r.m_invI;var h=a.m_mass*a.m_invMass;var l=a.m_mass*a.m_invI;m.s_psm.Initialize(n);var u=m.s_psm.m_normal;for(var c=0;c<n.pointCount;c++){var p=n.points[c];var f=m.s_psm.m_points[c];var d=m.s_psm.m_separations[c];var g=f.x-r.m_sweep.c.x;var y=f.y-r.m_sweep.c.y;var v=f.x-a.m_sweep.c.x;var _=f.y-a.m_sweep.c.y;e=e<d?e:d;var I=N.Clamp(t*(d+V.b2_linearSlop),-V.b2_maxLinearCorrection,0);var w=-p.equalizedMass*I;var x=w*u.x;var S=w*u.y;r.m_sweep.c.x-=o*x;r.m_sweep.c.y-=o*S;r.m_sweep.a-=s*(g*S-y*x);r.SynchronizeTransform();a.m_sweep.c.x+=h*x;a.m_sweep.c.y+=h*S;a.m_sweep.a+=l*(v*S-_*x);a.SynchronizeTransform()}}return e>-1.5*V.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new yt;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new I});Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact);d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;d.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};d.Create=function(t){return new d};d.Destroy=function(t,e){};d.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};d.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var n=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,n.m_xf)};d.prototype.b2CollideEdgeAndCircle=function(t,e,i,n,r){};Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact);g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;g.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};g.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};g.prototype.Evaluate=function(){};Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact);y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;y.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};y.Create=function(t){return new y};y.Destroy=function(t,e){};y.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);V.b2Assert(t.GetType()==a.e_polygonShape);V.b2Assert(e.GetType()==a.e_circleShape)};y.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body;var i=this.m_fixtureB.m_body;K.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(t){return new v};v.Destroy=function(t,e){};v.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);V.b2Assert(t.GetType()==a.e_polygonShape);V.b2Assert(e.GetType()==a.e_edgeShape)};v.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)};v.prototype.b2CollidePolyAndEdge=function(t,e,i,n,r){};Box2D.inherit(_,Box2D.Dynamics.Contacts.b2Contact);_.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;_.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};_.Create=function(t){return new _};_.Destroy=function(t,e){};_.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};_.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();K.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,e.m_xf)};I.b2PositionSolverManifold=function(){};I.prototype.b2PositionSolverManifold=function(){this.m_normal=new H;this.m_separations=new Vector_a2j_Number(V.b2_maxManifoldPoints);this.m_points=new Vector(V.b2_maxManifoldPoints);for(var t=0;t<V.b2_maxManifoldPoints;t++){this.m_points[t]=new H}};I.prototype.Initialize=function(t){V.b2Assert(t.pointCount>0);var e=0;var i=0;var n=0;var r;var a;var o=0;var s=0;switch(t.type){case at.e_circles:{r=t.bodyA.m_xf.R;a=t.localPoint;var h=t.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);var l=t.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);r=t.bodyB.m_xf.R;a=t.points[0].localPoint;var u=t.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);var c=t.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);var p=u-h;var f=c-l;var m=p*p+f*f;if(m>Box2D.MIN_VALUE*Box2D.MIN_VALUE){var d=Math.sqrt(m);this.m_normal.x=p/d;this.m_normal.y=f/d}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=.5*(h+u);this.m_points[0].y=.5*(l+c);this.m_separations[0]=p*this.m_normal.x+f*this.m_normal.y-t.radius}break;case at.e_faceA:{r=t.bodyA.m_xf.R;a=t.localPlaneNormal;this.m_normal.x=r.col1.x*a.x+r.col2.x*a.y;this.m_normal.y=r.col1.y*a.x+r.col2.y*a.y;r=t.bodyA.m_xf.R;a=t.localPoint;o=t.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);s=t.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);r=t.bodyB.m_xf.R;for(e=0;e<t.pointCount;++e){a=t.points[e].localPoint;i=t.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);n=t.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);this.m_separations[e]=(i-o)*this.m_normal.x+(n-s)*this.m_normal.y-t.radius;this.m_points[e].x=i;this.m_points[e].y=n}}break;case at.e_faceB:{r=t.bodyB.m_xf.R;a=t.localPlaneNormal;this.m_normal.x=r.col1.x*a.x+r.col2.x*a.y;this.m_normal.y=r.col1.y*a.x+r.col2.y*a.y;r=t.bodyB.m_xf.R;a=t.localPoint;o=t.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);s=t.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);r=t.bodyA.m_xf.R;for(e=0;e<t.pointCount;++e){a=t.points[e].localPoint;i=t.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);n=t.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);this.m_separations[e]=(i-o)*this.m_normal.x+(n-s)*this.m_normal.y-t.radius;this.m_points[e].Set(i,n)}this.m_normal.x*=-1;this.m_normal.y*=-1}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new H;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new H})})();(function(){var t=Box2D.Dynamics.b2Body,e=Box2D.Dynamics.b2BodyDef,i=Box2D.Dynamics.b2ContactFilter,n=Box2D.Dynamics.b2ContactImpulse,r=Box2D.Dynamics.b2ContactListener,a=Box2D.Dynamics.b2ContactManager,o=Box2D.Dynamics.b2DebugDraw,s=Box2D.Dynamics.b2DestructionListener,h=Box2D.Dynamics.b2FilterData,l=Box2D.Dynamics.b2Fixture,u=Box2D.Dynamics.b2FixtureDef,c=Box2D.Dynamics.b2Island,p=Box2D.Dynamics.b2TimeStep,f=Box2D.Dynamics.b2World,m=Box2D.Common.Math.b2Mat22,d=Box2D.Common.Math.b2Mat33,g=Box2D.Common.Math.b2Math,y=Box2D.Common.Math.b2Sweep,v=Box2D.Common.Math.b2Transform,_=Box2D.Common.Math.b2Vec2,I=Box2D.Common.Math.b2Vec3,w=Box2D.Common.b2Color,x=Box2D.Common.b2internal,S=Box2D.Common.b2Settings,C=Box2D.Collision.Shapes.b2CircleShape,T=Box2D.Collision.Shapes.b2EdgeChainDef,b=Box2D.Collision.Shapes.b2EdgeShape,D=Box2D.Collision.Shapes.b2MassData,A=Box2D.Collision.Shapes.b2PolygonShape,E=Box2D.Collision.Shapes.b2Shape,U=Box2D.Dynamics.Controllers.b2BuoyancyController,M=Box2D.Dynamics.Controllers.b2ConstantAccelController,P=Box2D.Dynamics.Controllers.b2ConstantForceController,B=Box2D.Dynamics.Controllers.b2Controller,L=Box2D.Dynamics.Controllers.b2ControllerEdge,R=Box2D.Dynamics.Controllers.b2GravityController,O=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(U,Box2D.Dynamics.Controllers.b2Controller);U.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;U.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new _(0,-1);this.offset=0;this.density=0;this.velocity=new _(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};U.prototype.Step=function(t){if(!this.m_bodyList)return;if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()==false){continue}var n=new _;var r=new _;var a=0;var o=0;for(var s=i.GetFixtureList();s;s=s.GetNext()){var h=new _;var l=s.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),h);a+=l;n.x+=l*h.x;n.y+=l*h.y;var u=0;if(this.useDensity){u=1}else{u=1}o+=l*u;r.x+=l*h.x*u;r.y+=l*h.y*u}n.x/=a;n.y/=a;r.x/=o;r.y/=o;if(a<Box2D.MIN_VALUE)continue;var c=this.gravity.GetNegative();c.Multiply(this.density*a);i.ApplyForce(c,r);var p=i.GetLinearVelocityFromWorldPoint(n);p.Subtract(this.velocity);p.Multiply(-this.linearDrag*a);i.ApplyForce(p,n);i.ApplyTorque(-i.GetInertia()/i.GetMass()*a*i.GetAngularVelocity()*this.angularDrag)}};U.prototype.Draw=function(t){var e=1e3;var i=new _;var n=new _;i.x=this.normal.x*this.offset+this.normal.y*e;i.y=this.normal.y*this.offset-this.normal.x*e;n.x=this.normal.x*this.offset-this.normal.y*e;n.y=this.normal.y*this.offset+this.normal.x*e;var r=new w(0,0,1);t.DrawSegment(i,n,r)};Box2D.inherit(M,Box2D.Dynamics.Controllers.b2Controller);M.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;M.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new _(0,0)};M.prototype.Step=function(t){var e=new _(this.A.x*t.dt,this.A.y*t.dt);for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(!n.IsAwake())continue;n.SetLinearVelocity(new _(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}};Box2D.inherit(P,Box2D.Dynamics.Controllers.b2Controller);P.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;P.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new _(0,0)};P.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(!i.IsAwake())continue;i.ApplyForce(this.F,i.GetWorldCenter())}};B.b2Controller=function(){};B.prototype.Step=function(t){};B.prototype.Draw=function(t){};B.prototype.AddBody=function(t){var e=new L;e.controller=this;e.body=t;e.nextBody=this.m_bodyList;e.prevBody=null;this.m_bodyList=e;if(e.nextBody)e.nextBody.prevBody=e;this.m_bodyCount++;e.nextController=t.m_controllerList;e.prevController=null;t.m_controllerList=e;if(e.nextController)e.nextController.prevController=e;t.m_controllerCount++};B.prototype.RemoveBody=function(t){var e=t.m_controllerList;while(e&&e.controller!=this)e=e.nextController;if(e.prevBody)e.prevBody.nextBody=e.nextBody;if(e.nextBody)e.nextBody.prevBody=e.prevBody;if(e.nextController)e.nextController.prevController=e.prevController;if(e.prevController)e.prevController.nextController=e.nextController;if(this.m_bodyList==e)this.m_bodyList=e.nextBody;if(t.m_controllerList==e)t.m_controllerList=e.nextController;t.m_controllerCount--;this.m_bodyCount--};B.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)};B.prototype.GetNext=function(){return this.m_next};B.prototype.GetWorld=function(){return this.m_world};B.prototype.GetBodyList=function(){return this.m_bodyList};L.b2ControllerEdge=function(){};Box2D.inherit(R,Box2D.Dynamics.Controllers.b2Controller);R.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;R.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};R.prototype.Step=function(t){var e=null;var i=null;var n=null;var r=0;var a=null;var o=null;var s=null;var h=0;var l=0;var u=0;var c=null;if(this.invSqr){for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;n=i.GetWorldCenter();r=i.GetMass();for(a=this.m_bodyList;a!=e;a=a.nextBody){o=a.body;s=o.GetWorldCenter();h=s.x-n.x;l=s.y-n.y;u=h*h+l*l;if(u<Box2D.MIN_VALUE)continue;c=new _(h,l);c.Multiply(this.G/u/Math.sqrt(u)*r*o.GetMass());if(i.IsAwake())i.ApplyForce(c,n);c.Multiply(-1);if(o.IsAwake())o.ApplyForce(c,s)}}}else{for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;n=i.GetWorldCenter();r=i.GetMass();for(a=this.m_bodyList;a!=e;a=a.nextBody){o=a.body;s=o.GetWorldCenter();h=s.x-n.x;l=s.y-n.y;u=h*h+l*l;if(u<Box2D.MIN_VALUE)continue;c=new _(h,l);c.Multiply(this.G/u*r*o.GetMass());if(i.IsAwake())i.ApplyForce(c,n);c.Multiply(-1);if(o.IsAwake())o.ApplyForce(c,s)}}}};Box2D.inherit(O,Box2D.Dynamics.Controllers.b2Controller);O.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;O.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new m;this.maxTimestep=0};O.prototype.SetAxisAligned=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.T.col1.x=-t;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-e;if(t>0||e>0){this.maxTimestep=1/Math.max(t,e)}else{this.maxTimestep=0}};O.prototype.Step=function(t){var e=t.dt;if(e<=Box2D.MIN_VALUE)return;if(e>this.maxTimestep&&this.maxTimestep>0)e=this.maxTimestep;for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(!n.IsAwake()){continue}var r=n.GetWorldVector(g.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity())));n.SetLinearVelocity(new _(n.GetLinearVelocity().x+r.x*e,n.GetLinearVelocity().y+r.y*e))}}})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,a=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,l=Box2D.Common.Math.b2Vec3,u=Box2D.Dynamics.Joints.b2DistanceJoint,c=Box2D.Dynamics.Joints.b2DistanceJointDef,p=Box2D.Dynamics.Joints.b2FrictionJoint,f=Box2D.Dynamics.Joints.b2FrictionJointDef,m=Box2D.Dynamics.Joints.b2GearJoint,d=Box2D.Dynamics.Joints.b2GearJointDef,g=Box2D.Dynamics.Joints.b2Jacobian,y=Box2D.Dynamics.Joints.b2Joint,v=Box2D.Dynamics.Joints.b2JointDef,_=Box2D.Dynamics.Joints.b2JointEdge,I=Box2D.Dynamics.Joints.b2LineJoint,w=Box2D.Dynamics.Joints.b2LineJointDef,x=Box2D.Dynamics.Joints.b2MouseJoint,S=Box2D.Dynamics.Joints.b2MouseJointDef,C=Box2D.Dynamics.Joints.b2PrismaticJoint,T=Box2D.Dynamics.Joints.b2PrismaticJointDef,b=Box2D.Dynamics.Joints.b2PulleyJoint,D=Box2D.Dynamics.Joints.b2PulleyJointDef,A=Box2D.Dynamics.Joints.b2RevoluteJoint,E=Box2D.Dynamics.Joints.b2RevoluteJointDef,U=Box2D.Dynamics.Joints.b2WeldJoint,M=Box2D.Dynamics.Joints.b2WeldJointDef,P=Box2D.Dynamics.b2Body,B=Box2D.Dynamics.b2BodyDef,L=Box2D.Dynamics.b2ContactFilter,R=Box2D.Dynamics.b2ContactImpulse,O=Box2D.Dynamics.b2ContactListener,V=Box2D.Dynamics.b2ContactManager,W=Box2D.Dynamics.b2DebugDraw,F=Box2D.Dynamics.b2DestructionListener,N=Box2D.Dynamics.b2FilterData,k=Box2D.Dynamics.b2Fixture,G=Box2D.Dynamics.b2FixtureDef,H=Box2D.Dynamics.b2Island,Y=Box2D.Dynamics.b2TimeStep,J=Box2D.Dynamics.b2World;Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint);u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;u.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new h;this.m_localAnchor2=new h;this.m_u=new h};u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};u.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)};u.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};u.prototype.GetLength=function(){return this.m_length};u.prototype.SetLength=function(t){if(t===undefined)t=0;this.m_length=t};u.prototype.GetFrequency=function(){return this.m_frequencyHz};u.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};u.prototype.GetDampingRatio=function(){return this.m_dampingRatio};u.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};u.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_length=t.length;this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};u.prototype.InitVelocityConstraints=function(t){var e;var n=0;var r=this.m_bodyA;var a=this.m_bodyB;e=r.m_xf.R;var o=this.m_localAnchor1.x-r.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-r.m_sweep.localCenter.y;n=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=n;e=a.m_xf.R;var h=this.m_localAnchor2.x-a.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-a.m_sweep.localCenter.y;n=e.col1.x*h+e.col2.x*l;l=e.col1.y*h+e.col2.y*l;h=n;this.m_u.x=a.m_sweep.c.x+h-r.m_sweep.c.x-o;this.m_u.y=a.m_sweep.c.y+l-r.m_sweep.c.y-s;var u=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(u>i.b2_linearSlop){this.m_u.Multiply(1/u)}else{this.m_u.SetZero()}var c=o*this.m_u.y-s*this.m_u.x;var p=h*this.m_u.y-l*this.m_u.x;var f=r.m_invMass+r.m_invI*c*c+a.m_invMass+a.m_invI*p*p;this.m_mass=f!=0?1/f:0;if(this.m_frequencyHz>0){var m=u-this.m_length;var d=2*Math.PI*this.m_frequencyHz;var g=2*this.m_mass*this.m_dampingRatio*d;var y=this.m_mass*d*d;this.m_gamma=t.dt*(g+t.dt*y);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=m*t.dt*y*this.m_gamma;this.m_mass=f+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(t.warmStarting){this.m_impulse*=t.dtRatio;var v=this.m_impulse*this.m_u.x;var _=this.m_impulse*this.m_u.y;r.m_linearVelocity.x-=r.m_invMass*v;r.m_linearVelocity.y-=r.m_invMass*_;r.m_angularVelocity-=r.m_invI*(o*_-s*v);a.m_linearVelocity.x+=a.m_invMass*v;a.m_linearVelocity.y+=a.m_invMass*_;a.m_angularVelocity+=a.m_invI*(h*_-l*v)}else{this.m_impulse=0}};u.prototype.SolveVelocityConstraints=function(t){var e;var i=this.m_bodyA;var n=this.m_bodyB;e=i.m_xf.R;var r=this.m_localAnchor1.x-i.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-i.m_sweep.localCenter.y;var o=e.col1.x*r+e.col2.x*a;a=e.col1.y*r+e.col2.y*a;r=o;e=n.m_xf.R;var s=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=e.col1.x*s+e.col2.x*h;h=e.col1.y*s+e.col2.y*h;s=o;var l=i.m_linearVelocity.x+-i.m_angularVelocity*a;var u=i.m_linearVelocity.y+i.m_angularVelocity*r;var c=n.m_linearVelocity.x+-n.m_angularVelocity*h;var p=n.m_linearVelocity.y+n.m_angularVelocity*s;var f=this.m_u.x*(c-l)+this.m_u.y*(p-u);var m=-this.m_mass*(f+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var d=m*this.m_u.x;var g=m*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*d;i.m_linearVelocity.y-=i.m_invMass*g;i.m_angularVelocity-=i.m_invI*(r*g-a*d);n.m_linearVelocity.x+=n.m_invMass*d;n.m_linearVelocity.y+=n.m_invMass*g;n.m_angularVelocity+=n.m_invI*(s*g-h*d)};u.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;if(this.m_frequencyHz>0){return true}var n=this.m_bodyA;var r=this.m_bodyB;e=n.m_xf.R;var o=this.m_localAnchor1.x-n.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-n.m_sweep.localCenter.y;var h=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=h;e=r.m_xf.R;var l=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var u=this.m_localAnchor2.y-r.m_sweep.localCenter.y;h=e.col1.x*l+e.col2.x*u;u=e.col1.y*l+e.col2.y*u;l=h;var c=r.m_sweep.c.x+l-n.m_sweep.c.x-o;var p=r.m_sweep.c.y+u-n.m_sweep.c.y-s;var f=Math.sqrt(c*c+p*p);c/=f;p/=f;var m=f-this.m_length;m=a.Clamp(m,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);var d=-this.m_mass*m;this.m_u.Set(c,p);var g=d*this.m_u.x;var y=d*this.m_u.y;n.m_sweep.c.x-=n.m_invMass*g;n.m_sweep.c.y-=n.m_invMass*y;n.m_sweep.a-=n.m_invI*(o*y-s*g);r.m_sweep.c.x+=r.m_invMass*g;r.m_sweep.c.y+=r.m_invMass*y;r.m_sweep.a+=r.m_invI*(l*y-u*g);n.SynchronizeTransform();r.SynchronizeTransform();return a.Abs(m)<i.b2_linearSlop};Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef);c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;c.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new h;this.localAnchorB=new h};c.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};c.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n));var r=n.x-i.x;var a=n.y-i.y;this.length=Math.sqrt(r*r+a*a);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(p,Box2D.Dynamics.Joints.b2Joint);p.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;p.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new h;this.m_localAnchorB=new h;this.m_linearMass=new n;this.m_linearImpulse=new h};p.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};p.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};p.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)};p.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_angularImpulse};p.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};p.prototype.GetMaxForce=function(){return this.m_maxForce};p.prototype.SetMaxTorque=function(t){if(t===undefined)t=0;this.m_maxTorque=t};p.prototype.GetMaxTorque=function(){return this.m_maxTorque};p.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=t.maxForce;this.m_maxTorque=t.maxTorque};p.prototype.InitVelocityConstraints=function(t){var e;var i=0;var r=this.m_bodyA;var a=this.m_bodyB;e=r.m_xf.R;var o=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var s=this.m_localAnchorA.y-r.m_sweep.localCenter.y;i=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=i;e=a.m_xf.R;var h=this.m_localAnchorB.x-a.m_sweep.localCenter.x;var l=this.m_localAnchorB.y-a.m_sweep.localCenter.y;i=e.col1.x*h+e.col2.x*l;l=e.col1.y*h+e.col2.y*l;h=i;var u=r.m_invMass;var c=a.m_invMass;var p=r.m_invI;var f=a.m_invI;var m=new n;m.col1.x=u+c;m.col2.x=0;m.col1.y=0;m.col2.y=u+c;m.col1.x+=p*s*s;m.col2.x+=-p*o*s;m.col1.y+=-p*o*s;m.col2.y+=p*o*o;m.col1.x+=f*l*l;m.col2.x+=-f*h*l;m.col1.y+=-f*h*l;m.col2.y+=f*h*h;m.GetInverse(this.m_linearMass);this.m_angularMass=p+f;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(t.warmStarting){this.m_linearImpulse.x*=t.dtRatio;this.m_linearImpulse.y*=t.dtRatio;this.m_angularImpulse*=t.dtRatio;var d=this.m_linearImpulse;r.m_linearVelocity.x-=u*d.x;r.m_linearVelocity.y-=u*d.y;r.m_angularVelocity-=p*(o*d.y-s*d.x+this.m_angularImpulse);a.m_linearVelocity.x+=c*d.x;a.m_linearVelocity.y+=c*d.y;a.m_angularVelocity+=f*(h*d.y-l*d.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};p.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;var o=n.m_linearVelocity;var s=n.m_angularVelocity;var l=r.m_linearVelocity;var u=r.m_angularVelocity;var c=n.m_invMass;var p=r.m_invMass;var f=n.m_invI;var m=r.m_invI;e=n.m_xf.R;var d=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var g=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*d+e.col2.x*g;g=e.col1.y*d+e.col2.y*g;d=i;e=r.m_xf.R;var y=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var v=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*y+e.col2.x*v;v=e.col1.y*y+e.col2.y*v;y=i;var _=0;{var I=u-s;var w=-this.m_angularMass*I;var x=this.m_angularImpulse;_=t.dt*this.m_maxTorque;this.m_angularImpulse=a.Clamp(this.m_angularImpulse+w,-_,_);w=this.m_angularImpulse-x;s-=f*w;u+=m*w}{var S=l.x-u*v-o.x+s*g;var C=l.y+u*y-o.y-s*d;var T=a.MulMV(this.m_linearMass,new h(-S,-C));var b=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(T);_=t.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>_*_){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(_)}T=a.SubtractVV(this.m_linearImpulse,b);o.x-=c*T.x;o.y-=c*T.y;s-=f*(d*T.y-g*T.x);l.x+=p*T.x;l.y+=p*T.y;u+=m*(y*T.y-v*T.x)}n.m_angularVelocity=s;r.m_angularVelocity=u};p.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(f,Box2D.Dynamics.Joints.b2JointDef);f.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;f.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new h;this.localAnchorB=new h};f.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_frictionJoint;this.maxForce=0;this.maxTorque=0};f.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))};Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint);m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;m.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new h;this.m_groundAnchor2=new h;this.m_localAnchor1=new h;this.m_localAnchor2=new h;this.m_J=new g};m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};m.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)};m.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;var e=this.m_bodyB.m_xf.R;var i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x;var n=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y;var r=e.col1.x*i+e.col2.x*n;n=e.col1.y*i+e.col2.y*n;i=r;var a=this.m_impulse*this.m_J.linearB.x;var o=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*o+n*a)};m.prototype.GetRatio=function(){return this.m_ratio};m.prototype.SetRatio=function(t){if(t===undefined)t=0;this.m_ratio=t};m.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type);var i=parseInt(t.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var n=0;var r=0;this.m_ground1=t.joint1.GetBodyA();this.m_bodyA=t.joint1.GetBodyB();if(e==y.e_revoluteJoint){this.m_revolute1=t.joint1 instanceof A?t.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);n=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=t.joint1 instanceof C?t.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);n=this.m_prismatic1.GetJointTranslation()}this.m_ground2=t.joint2.GetBodyA();this.m_bodyB=t.joint2.GetBodyB();if(i==y.e_revoluteJoint){this.m_revolute2=t.joint2 instanceof A?t.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);r=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=t.joint2 instanceof C?t.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);r=this.m_prismatic2.GetJointTranslation()}this.m_ratio=t.ratio;this.m_constant=n+this.m_ratio*r;this.m_impulse=0};m.prototype.InitVelocityConstraints=function(t){var e=this.m_ground1;var i=this.m_ground2;var n=this.m_bodyA;var r=this.m_bodyB;var a=0;var o=0;var s=0;var h=0;var l;var u;var c=0;var p=0;var f=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;f+=n.m_invI}else{l=e.m_xf.R;u=this.m_prismatic1.m_localXAxis1;a=l.col1.x*u.x+l.col2.x*u.y;o=l.col1.y*u.x+l.col2.y*u.y;l=n.m_xf.R;s=this.m_localAnchor1.x-n.m_sweep.localCenter.x;h=this.m_localAnchor1.y-n.m_sweep.localCenter.y;p=l.col1.x*s+l.col2.x*h;h=l.col1.y*s+l.col2.y*h;s=p;c=s*o-h*a;this.m_J.linearA.Set(-a,-o);this.m_J.angularA=-c;f+=n.m_invMass+n.m_invI*c*c}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;f+=this.m_ratio*this.m_ratio*r.m_invI}else{l=i.m_xf.R;u=this.m_prismatic2.m_localXAxis1;a=l.col1.x*u.x+l.col2.x*u.y;o=l.col1.y*u.x+l.col2.y*u.y;l=r.m_xf.R;s=this.m_localAnchor2.x-r.m_sweep.localCenter.x;h=this.m_localAnchor2.y-r.m_sweep.localCenter.y;p=l.col1.x*s+l.col2.x*h;h=l.col1.y*s+l.col2.y*h;s=p;c=s*o-h*a;this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*o);this.m_J.angularB=-this.m_ratio*c;f+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*c*c)}this.m_mass=f>0?1/f:0;if(t.warmStarting){n.m_linearVelocity.x+=n.m_invMass*this.m_impulse*this.m_J.linearA.x;n.m_linearVelocity.y+=n.m_invMass*this.m_impulse*this.m_J.linearA.y;n.m_angularVelocity+=n.m_invI*this.m_impulse*this.m_J.angularA;r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x;r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y;r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};m.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity);var r=-this.m_mass*n;this.m_impulse+=r;e.m_linearVelocity.x+=e.m_invMass*r*this.m_J.linearA.x;e.m_linearVelocity.y+=e.m_invMass*r*this.m_J.linearA.y;e.m_angularVelocity+=e.m_invI*r*this.m_J.angularA;
i.m_linearVelocity.x+=i.m_invMass*r*this.m_J.linearB.x;i.m_linearVelocity.y+=i.m_invMass*r*this.m_J.linearB.y;i.m_angularVelocity+=i.m_invI*r*this.m_J.angularB};m.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var n=this.m_bodyA;var r=this.m_bodyB;var a=0;var o=0;if(this.m_revolute1){a=this.m_revolute1.GetJointAngle()}else{a=this.m_prismatic1.GetJointTranslation()}if(this.m_revolute2){o=this.m_revolute2.GetJointAngle()}else{o=this.m_prismatic2.GetJointTranslation()}var s=this.m_constant-(a+this.m_ratio*o);var h=-this.m_mass*s;n.m_sweep.c.x+=n.m_invMass*h*this.m_J.linearA.x;n.m_sweep.c.y+=n.m_invMass*h*this.m_J.linearA.y;n.m_sweep.a+=n.m_invI*h*this.m_J.angularA;r.m_sweep.c.x+=r.m_invMass*h*this.m_J.linearB.x;r.m_sweep.c.y+=r.m_invMass*h*this.m_J.linearB.y;r.m_sweep.a+=r.m_invI*h*this.m_J.angularB;n.SynchronizeTransform();r.SynchronizeTransform();return e<i.b2_linearSlop};Box2D.inherit(d,Box2D.Dynamics.Joints.b2JointDef);d.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;d.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};d.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};g.b2Jacobian=function(){this.linearA=new h;this.linearB=new h};g.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};g.prototype.Set=function(t,e,i,n){if(e===undefined)e=0;if(n===undefined)n=0;this.linearA.SetV(t);this.angularA=e;this.linearB.SetV(i);this.angularB=n};g.prototype.Compute=function(t,e,i,n){if(e===undefined)e=0;if(n===undefined)n=0;return this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*n};y.b2Joint=function(){this.m_edgeA=new _;this.m_edgeB=new _;this.m_localCenterA=new h;this.m_localCenterB=new h};y.prototype.GetType=function(){return this.m_type};y.prototype.GetAnchorA=function(){return null};y.prototype.GetAnchorB=function(){return null};y.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return null};y.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};y.prototype.GetBodyA=function(){return this.m_bodyA};y.prototype.GetBodyB=function(){return this.m_bodyB};y.prototype.GetNext=function(){return this.m_next};y.prototype.GetUserData=function(){return this.m_userData};y.prototype.SetUserData=function(t){this.m_userData=t};y.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};y.Create=function(t,e){var i=null;switch(t.type){case y.e_distanceJoint:{i=new u(t instanceof c?t:null)}break;case y.e_mouseJoint:{i=new x(t instanceof S?t:null)}break;case y.e_prismaticJoint:{i=new C(t instanceof T?t:null)}break;case y.e_revoluteJoint:{i=new A(t instanceof E?t:null)}break;case y.e_pulleyJoint:{i=new b(t instanceof D?t:null)}break;case y.e_gearJoint:{i=new m(t instanceof d?t:null)}break;case y.e_lineJoint:{i=new I(t instanceof w?t:null)}break;case y.e_weldJoint:{i=new U(t instanceof M?t:null)}break;case y.e_frictionJoint:{i=new p(t instanceof f?t:null)}break;default:break}return i};y.Destroy=function(t,e){};y.prototype.b2Joint=function(t){i.b2Assert(t.bodyA!=t.bodyB);this.m_type=t.type;this.m_prev=null;this.m_next=null;this.m_bodyA=t.bodyA;this.m_bodyB=t.bodyB;this.m_collideConnected=t.collideConnected;this.m_islandFlag=false;this.m_userData=t.userData};y.prototype.InitVelocityConstraints=function(t){};y.prototype.SolveVelocityConstraints=function(t){};y.prototype.FinalizeVelocityConstraints=function(){};y.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return false};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});v.b2JointDef=function(){};v.prototype.b2JointDef=function(){this.type=y.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=false};_.b2JointEdge=function(){};Box2D.inherit(I,Box2D.Dynamics.Joints.b2Joint);I.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;I.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new h;this.m_localAnchor2=new h;this.m_localXAxis1=new h;this.m_localYAxis1=new h;this.m_axis=new h;this.m_perp=new h;this.m_K=new n;this.m_impulse=new h};I.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};I.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};I.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};I.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};I.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var n=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var a=r.x-n.x;var o=r.y-n.y;var s=t.GetWorldVector(this.m_localXAxis1);var h=s.x*a+s.y*o;return h};I.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var a=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r;n=a;i=e.m_xf.R;var o=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var s=this.m_localAnchor2.y-e.m_sweep.localCenter.y;a=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s;o=a;var h=t.m_sweep.c.x+n;var l=t.m_sweep.c.y+r;var u=e.m_sweep.c.x+o;var c=e.m_sweep.c.y+s;var p=u-h;var f=c-l;var m=t.GetWorldVector(this.m_localXAxis1);var d=t.m_linearVelocity;var g=e.m_linearVelocity;var y=t.m_angularVelocity;var v=e.m_angularVelocity;var _=p*(-y*m.y)+f*(y*m.x)+(m.x*(g.x+-v*s-d.x- -y*r)+m.y*(g.y+v*o-d.y-y*n));return _};I.prototype.IsLimitEnabled=function(){return this.m_enableLimit};I.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};I.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};I.prototype.GetUpperLimit=function(){return this.m_upperTranslation};I.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};I.prototype.IsMotorEnabled=function(){return this.m_enableMotor};I.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};I.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};I.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};I.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};I.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};I.prototype.GetMotorForce=function(){return this.m_motorImpulse};I.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=y.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};I.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var o=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var s=e.GetTransform();var h=n.GetTransform();r=e.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x;var u=this.m_localAnchor1.y-this.m_localCenterA.y;o=r.col1.x*l+r.col2.x*u;u=r.col1.y*l+r.col2.y*u;l=o;r=n.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x;var p=this.m_localAnchor2.y-this.m_localCenterB.y;o=r.col1.x*c+r.col2.x*p;p=r.col1.y*c+r.col2.y*p;c=o;var f=n.m_sweep.c.x+c-e.m_sweep.c.x-l;var m=n.m_sweep.c.y+p-e.m_sweep.c.y-u;this.m_invMassA=e.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=n.m_invI;{this.m_axis.SetV(a.MulMV(s.R,this.m_localXAxis1));this.m_a1=(f+l)*this.m_axis.y-(m+u)*this.m_axis.x;this.m_a2=c*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Box2D.MIN_VALUE?1/this.m_motorMass:0}{this.m_perp.SetV(a.MulMV(s.R,this.m_localYAxis1));this.m_s1=(f+l)*this.m_perp.y-(m+u)*this.m_perp.x;this.m_s2=c*this.m_perp.y-p*this.m_perp.x;var d=this.m_invMassA;var g=this.m_invMassB;var v=this.m_invIA;var _=this.m_invIB;this.m_K.col1.x=d+g+v*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=d+g+v*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2}if(this.m_enableLimit){var I=this.m_axis.x*f+this.m_axis.y*m;if(a.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=y.e_equalLimits}else if(I<=this.m_lowerTranslation){if(this.m_limitState!=y.e_atLowerLimit){this.m_limitState=y.e_atLowerLimit;this.m_impulse.y=0}}else if(I>=this.m_upperTranslation){if(this.m_limitState!=y.e_atUpperLimit){this.m_limitState=y.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=y.e_inactiveLimit;this.m_impulse.y=0}}else{this.m_limitState=y.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var w=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;var x=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;var S=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;var C=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*w;e.m_linearVelocity.y-=this.m_invMassA*x;e.m_angularVelocity-=this.m_invIA*S;n.m_linearVelocity.x+=this.m_invMassB*w;n.m_linearVelocity.y+=this.m_invMassB*x;n.m_angularVelocity+=this.m_invIB*C}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};I.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=e.m_linearVelocity;var r=e.m_angularVelocity;var o=i.m_linearVelocity;var s=i.m_angularVelocity;var l=0;var u=0;var c=0;var p=0;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var f=this.m_axis.x*(o.x-n.x)+this.m_axis.y*(o.y-n.y)+this.m_a2*s-this.m_a1*r;var m=this.m_motorMass*(this.m_motorSpeed-f);var d=this.m_motorImpulse;var g=t.dt*this.m_maxMotorForce;this.m_motorImpulse=a.Clamp(this.m_motorImpulse+m,-g,g);m=this.m_motorImpulse-d;l=m*this.m_axis.x;u=m*this.m_axis.y;c=m*this.m_a1;p=m*this.m_a2;n.x-=this.m_invMassA*l;n.y-=this.m_invMassA*u;r-=this.m_invIA*c;o.x+=this.m_invMassB*l;o.y+=this.m_invMassB*u;s+=this.m_invIB*p}var v=this.m_perp.x*(o.x-n.x)+this.m_perp.y*(o.y-n.y)+this.m_s2*s-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var _=this.m_axis.x*(o.x-n.x)+this.m_axis.y*(o.y-n.y)+this.m_a2*s-this.m_a1*r;var I=this.m_impulse.Copy();var w=this.m_K.Solve(new h,-v,-_);this.m_impulse.Add(w);if(this.m_limitState==y.e_atLowerLimit){this.m_impulse.y=a.Max(this.m_impulse.y,0)}else if(this.m_limitState==y.e_atUpperLimit){this.m_impulse.y=a.Min(this.m_impulse.y,0)}var x=-v-(this.m_impulse.y-I.y)*this.m_K.col2.x;var S=0;if(this.m_K.col1.x!=0){S=x/this.m_K.col1.x+I.x}else{S=I.x}this.m_impulse.x=S;w.x=this.m_impulse.x-I.x;w.y=this.m_impulse.y-I.y;l=w.x*this.m_perp.x+w.y*this.m_axis.x;u=w.x*this.m_perp.y+w.y*this.m_axis.y;c=w.x*this.m_s1+w.y*this.m_a1;p=w.x*this.m_s2+w.y*this.m_a2;n.x-=this.m_invMassA*l;n.y-=this.m_invMassA*u;r-=this.m_invIA*c;o.x+=this.m_invMassB*l;o.y+=this.m_invMassB*u;s+=this.m_invIB*p}else{var C=0;if(this.m_K.col1.x!=0){C=-v/this.m_K.col1.x}else{C=0}this.m_impulse.x+=C;l=C*this.m_perp.x;u=C*this.m_perp.y;c=C*this.m_s1;p=C*this.m_s2;n.x-=this.m_invMassA*l;n.y-=this.m_invMassA*u;r-=this.m_invIA*c;o.x+=this.m_invMassB*l;o.y+=this.m_invMassB*u;s+=this.m_invIB*p}e.m_linearVelocity.SetV(n);e.m_angularVelocity=r;i.m_linearVelocity.SetV(o);i.m_angularVelocity=s};I.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var o=this.m_bodyA;var s=this.m_bodyB;var l=o.m_sweep.c;var u=o.m_sweep.a;var c=s.m_sweep.c;var p=s.m_sweep.a;var f;var m=0;var d=0;var g=0;var y=0;var v=0;var _=0;var I=0;var w=false;var x=0;var S=n.FromAngle(u);var C=n.FromAngle(p);f=S;var T=this.m_localAnchor1.x-this.m_localCenterA.x;var b=this.m_localAnchor1.y-this.m_localCenterA.y;m=f.col1.x*T+f.col2.x*b;b=f.col1.y*T+f.col2.y*b;T=m;f=C;var D=this.m_localAnchor2.x-this.m_localCenterB.x;var A=this.m_localAnchor2.y-this.m_localCenterB.y;m=f.col1.x*D+f.col2.x*A;A=f.col1.y*D+f.col2.y*A;D=m;var E=c.x+D-l.x-T;var U=c.y+A-l.y-b;if(this.m_enableLimit){this.m_axis=a.MulMV(S,this.m_localXAxis1);this.m_a1=(E+T)*this.m_axis.y-(U+b)*this.m_axis.x;this.m_a2=D*this.m_axis.y-A*this.m_axis.x;var M=this.m_axis.x*E+this.m_axis.y*U;if(a.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){x=a.Clamp(M,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);_=a.Abs(M);w=true}else if(M<=this.m_lowerTranslation){x=a.Clamp(M-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);_=this.m_lowerTranslation-M;w=true}else if(M>=this.m_upperTranslation){x=a.Clamp(M-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);_=M-this.m_upperTranslation;w=true}}this.m_perp=a.MulMV(S,this.m_localYAxis1);this.m_s1=(E+T)*this.m_perp.y-(U+b)*this.m_perp.x;this.m_s2=D*this.m_perp.y-A*this.m_perp.x;var P=new h;var B=this.m_perp.x*E+this.m_perp.y*U;_=a.Max(_,a.Abs(B));I=0;if(w){d=this.m_invMassA;g=this.m_invMassB;y=this.m_invIA;v=this.m_invIB;this.m_K.col1.x=d+g+y*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2;this.m_K.col1.y=y*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=d+g+y*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2;this.m_K.Solve(P,-B,-x)}else{d=this.m_invMassA;g=this.m_invMassB;y=this.m_invIA;v=this.m_invIB;var L=d+g+y*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2;var R=0;if(L!=0){R=-B/L}else{R=0}P.x=R;P.y=0}var O=P.x*this.m_perp.x+P.y*this.m_axis.x;var V=P.x*this.m_perp.y+P.y*this.m_axis.y;var W=P.x*this.m_s1+P.y*this.m_a1;var F=P.x*this.m_s2+P.y*this.m_a2;l.x-=this.m_invMassA*O;l.y-=this.m_invMassA*V;u-=this.m_invIA*W;c.x+=this.m_invMassB*O;c.y+=this.m_invMassB*V;p+=this.m_invIB*F;o.m_sweep.a=u;s.m_sweep.a=p;o.SynchronizeTransform();s.SynchronizeTransform();return _<=i.b2_linearSlop&&I<=i.b2_angularSlop};Box2D.inherit(w,Box2D.Dynamics.Joints.b2JointDef);w.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;w.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new h;this.localAnchorB=new h;this.localAxisA=new h};w.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};w.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(n)};Box2D.inherit(x,Box2D.Dynamics.Joints.b2Joint);x.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;x.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.m_localAnchor=new h;this.m_target=new h;this.m_impulse=new h;this.m_mass=new n;this.m_C=new h};x.prototype.GetAnchorA=function(){return this.m_target};x.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};x.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*this.m_impulse.x,t*this.m_impulse.y)};x.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};x.prototype.GetTarget=function(){return this.m_target};x.prototype.SetTarget=function(t){if(this.m_bodyB.IsAwake()==false){this.m_bodyB.SetAwake(true)}this.m_target=t};x.prototype.GetMaxForce=function(){return this.m_maxForce};x.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};x.prototype.GetFrequency=function(){return this.m_frequencyHz};x.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};x.prototype.GetDampingRatio=function(){return this.m_dampingRatio};x.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};x.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t);this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x;var i=this.m_target.y-this.m_bodyB.m_xf.position.y;var n=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*n.col1.x+i*n.col1.y;this.m_localAnchor.y=e*n.col2.x+i*n.col2.y;this.m_maxForce=t.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_beta=0;this.m_gamma=0};x.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB;var i=e.GetMass();var n=2*Math.PI*this.m_frequencyHz;var r=2*i*this.m_dampingRatio*n;var a=i*n*n;this.m_gamma=t.dt*(r+t.dt*a);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=t.dt*a*this.m_gamma;var o;o=e.m_xf.R;var s=this.m_localAnchor.x-e.m_sweep.localCenter.x;var h=this.m_localAnchor.y-e.m_sweep.localCenter.y;var l=o.col1.x*s+o.col2.x*h;h=o.col1.y*s+o.col2.y*h;s=l;var u=e.m_invMass;var c=e.m_invI;this.K1.col1.x=u;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=u;this.K2.col1.x=c*h*h;this.K2.col2.x=-c*s*h;this.K2.col1.y=-c*s*h;this.K2.col2.y=c*s*s;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=e.m_sweep.c.x+s-this.m_target.x;this.m_C.y=e.m_sweep.c.y+h-this.m_target.y;e.m_angularVelocity*=.98;this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;e.m_linearVelocity.x+=u*this.m_impulse.x;e.m_linearVelocity.y+=u*this.m_impulse.y;e.m_angularVelocity+=c*(s*this.m_impulse.y-h*this.m_impulse.x)};x.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyB;var i;var n=0;var r=0;i=e.m_xf.R;var a=this.m_localAnchor.x-e.m_sweep.localCenter.x;var o=this.m_localAnchor.y-e.m_sweep.localCenter.y;n=i.col1.x*a+i.col2.x*o;o=i.col1.y*a+i.col2.y*o;a=n;var s=e.m_linearVelocity.x+-e.m_angularVelocity*o;var h=e.m_linearVelocity.y+e.m_angularVelocity*a;i=this.m_mass;n=s+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;r=h+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var l=-(i.col1.x*n+i.col2.x*r);var u=-(i.col1.y*n+i.col2.y*r);var c=this.m_impulse.x;var p=this.m_impulse.y;this.m_impulse.x+=l;this.m_impulse.y+=u;var f=t.dt*this.m_maxForce;if(this.m_impulse.LengthSquared()>f*f){this.m_impulse.Multiply(f/this.m_impulse.Length())}l=this.m_impulse.x-c;u=this.m_impulse.y-p;e.m_linearVelocity.x+=e.m_invMass*l;e.m_linearVelocity.y+=e.m_invMass*u;e.m_angularVelocity+=e.m_invI*(a*u-o*l)};x.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(S,Box2D.Dynamics.Joints.b2JointDef);S.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;S.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new h};S.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint);C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;C.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new h;this.m_localAnchor2=new h;this.m_localXAxis1=new h;this.m_localYAxis1=new h;this.m_axis=new h;this.m_perp=new h;this.m_K=new r;this.m_impulse=new l};C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};C.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};C.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};C.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var n=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var a=r.x-n.x;var o=r.y-n.y;var s=t.GetWorldVector(this.m_localXAxis1);var h=s.x*a+s.y*o;return h};C.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var a=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r;n=a;i=e.m_xf.R;var o=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var s=this.m_localAnchor2.y-e.m_sweep.localCenter.y;a=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s;o=a;var h=t.m_sweep.c.x+n;var l=t.m_sweep.c.y+r;var u=e.m_sweep.c.x+o;var c=e.m_sweep.c.y+s;var p=u-h;var f=c-l;var m=t.GetWorldVector(this.m_localXAxis1);var d=t.m_linearVelocity;var g=e.m_linearVelocity;var y=t.m_angularVelocity;var v=e.m_angularVelocity;var _=p*(-y*m.y)+f*(y*m.x)+(m.x*(g.x+-v*s-d.x- -y*r)+m.y*(g.y+v*o-d.y-y*n));return _};C.prototype.IsLimitEnabled=function(){return this.m_enableLimit};C.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};C.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};C.prototype.GetUpperLimit=function(){return this.m_upperTranslation};C.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};C.prototype.IsMotorEnabled=function(){return this.m_enableMotor};C.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};C.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};C.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};C.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};C.prototype.GetMotorForce=function(){return this.m_motorImpulse};C.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=y.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};C.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var o=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var s=e.GetTransform();var h=n.GetTransform();r=e.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x;var u=this.m_localAnchor1.y-this.m_localCenterA.y;o=r.col1.x*l+r.col2.x*u;u=r.col1.y*l+r.col2.y*u;l=o;r=n.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x;var p=this.m_localAnchor2.y-this.m_localCenterB.y;o=r.col1.x*c+r.col2.x*p;p=r.col1.y*c+r.col2.y*p;c=o;var f=n.m_sweep.c.x+c-e.m_sweep.c.x-l;var m=n.m_sweep.c.y+p-e.m_sweep.c.y-u;this.m_invMassA=e.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=n.m_invI;{this.m_axis.SetV(a.MulMV(s.R,this.m_localXAxis1));this.m_a1=(f+l)*this.m_axis.y-(m+u)*this.m_axis.x;this.m_a2=c*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Box2D.MIN_VALUE)this.m_motorMass=1/this.m_motorMass}{this.m_perp.SetV(a.MulMV(s.R,this.m_localYAxis1));this.m_s1=(f+l)*this.m_perp.y-(m+u)*this.m_perp.x;this.m_s2=c*this.m_perp.y-p*this.m_perp.x;var d=this.m_invMassA;var g=this.m_invMassB;var v=this.m_invIA;var _=this.m_invIB;this.m_K.col1.x=d+g+v*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1+_*this.m_s2;this.m_K.col1.z=v*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+_;this.m_K.col2.z=v*this.m_a1+_*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=d+g+v*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2}if(this.m_enableLimit){var I=this.m_axis.x*f+this.m_axis.y*m;if(a.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=y.e_equalLimits}else if(I<=this.m_lowerTranslation){if(this.m_limitState!=y.e_atLowerLimit){this.m_limitState=y.e_atLowerLimit;this.m_impulse.z=0}}else if(I>=this.m_upperTranslation){if(this.m_limitState!=y.e_atUpperLimit){this.m_limitState=y.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=y.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=y.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var w=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;var x=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;var S=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;var C=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*w;e.m_linearVelocity.y-=this.m_invMassA*x;e.m_angularVelocity-=this.m_invIA*S;n.m_linearVelocity.x+=this.m_invMassB*w;n.m_linearVelocity.y+=this.m_invMassB*x;n.m_angularVelocity+=this.m_invIB*C}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};C.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=e.m_linearVelocity;var r=e.m_angularVelocity;var o=i.m_linearVelocity;var s=i.m_angularVelocity;var u=0;var c=0;var p=0;var f=0;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var m=this.m_axis.x*(o.x-n.x)+this.m_axis.y*(o.y-n.y)+this.m_a2*s-this.m_a1*r;var d=this.m_motorMass*(this.m_motorSpeed-m);var g=this.m_motorImpulse;var v=t.dt*this.m_maxMotorForce;this.m_motorImpulse=a.Clamp(this.m_motorImpulse+d,-v,v);d=this.m_motorImpulse-g;u=d*this.m_axis.x;c=d*this.m_axis.y;p=d*this.m_a1;f=d*this.m_a2;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*c;r-=this.m_invIA*p;o.x+=this.m_invMassB*u;o.y+=this.m_invMassB*c;s+=this.m_invIB*f}var _=this.m_perp.x*(o.x-n.x)+this.m_perp.y*(o.y-n.y)+this.m_s2*s-this.m_s1*r;var I=s-r;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var w=this.m_axis.x*(o.x-n.x)+this.m_axis.y*(o.y-n.y)+this.m_a2*s-this.m_a1*r;var x=this.m_impulse.Copy();var S=this.m_K.Solve33(new l,-_,-I,-w);this.m_impulse.Add(S);if(this.m_limitState==y.e_atLowerLimit){this.m_impulse.z=a.Max(this.m_impulse.z,0)}else if(this.m_limitState==y.e_atUpperLimit){this.m_impulse.z=a.Min(this.m_impulse.z,0)}var C=-_-(this.m_impulse.z-x.z)*this.m_K.col3.x;var T=-I-(this.m_impulse.z-x.z)*this.m_K.col3.y;var b=this.m_K.Solve22(new h,C,T);b.x+=x.x;b.y+=x.y;this.m_impulse.x=b.x;this.m_impulse.y=b.y;S.x=this.m_impulse.x-x.x;S.y=this.m_impulse.y-x.y;S.z=this.m_impulse.z-x.z;u=S.x*this.m_perp.x+S.z*this.m_axis.x;c=S.x*this.m_perp.y+S.z*this.m_axis.y;p=S.x*this.m_s1+S.y+S.z*this.m_a1;f=S.x*this.m_s2+S.y+S.z*this.m_a2;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*c;r-=this.m_invIA*p;o.x+=this.m_invMassB*u;o.y+=this.m_invMassB*c;s+=this.m_invIB*f}else{var D=this.m_K.Solve22(new h,-_,-I);this.m_impulse.x+=D.x;this.m_impulse.y+=D.y;u=D.x*this.m_perp.x;c=D.x*this.m_perp.y;p=D.x*this.m_s1+D.y;f=D.x*this.m_s2+D.y;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*c;r-=this.m_invIA*p;o.x+=this.m_invMassB*u;o.y+=this.m_invMassB*c;s+=this.m_invIB*f}e.m_linearVelocity.SetV(n);e.m_angularVelocity=r;i.m_linearVelocity.SetV(o);i.m_angularVelocity=s};C.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var o=this.m_bodyA;var s=this.m_bodyB;var u=o.m_sweep.c;var c=o.m_sweep.a;var p=s.m_sweep.c;var f=s.m_sweep.a;var m;var d=0;var g=0;var y=0;var v=0;var _=0;var I=0;var w=0;var x=false;var S=0;var C=n.FromAngle(c);var T=n.FromAngle(f);m=C;var b=this.m_localAnchor1.x-this.m_localCenterA.x;var D=this.m_localAnchor1.y-this.m_localCenterA.y;d=m.col1.x*b+m.col2.x*D;D=m.col1.y*b+m.col2.y*D;b=d;m=T;var A=this.m_localAnchor2.x-this.m_localCenterB.x;var E=this.m_localAnchor2.y-this.m_localCenterB.y;d=m.col1.x*A+m.col2.x*E;E=m.col1.y*A+m.col2.y*E;A=d;var U=p.x+A-u.x-b;var M=p.y+E-u.y-D;if(this.m_enableLimit){this.m_axis=a.MulMV(C,this.m_localXAxis1);this.m_a1=(U+b)*this.m_axis.y-(M+D)*this.m_axis.x;this.m_a2=A*this.m_axis.y-E*this.m_axis.x;var P=this.m_axis.x*U+this.m_axis.y*M;if(a.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){S=a.Clamp(P,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);I=a.Abs(P);x=true}else if(P<=this.m_lowerTranslation){S=a.Clamp(P-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);I=this.m_lowerTranslation-P;x=true}else if(P>=this.m_upperTranslation){S=a.Clamp(P-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);I=P-this.m_upperTranslation;x=true}}this.m_perp=a.MulMV(C,this.m_localYAxis1);this.m_s1=(U+b)*this.m_perp.y-(M+D)*this.m_perp.x;this.m_s2=A*this.m_perp.y-E*this.m_perp.x;var B=new l;var L=this.m_perp.x*U+this.m_perp.y*M;var R=f-c-this.m_refAngle;I=a.Max(I,a.Abs(L));w=a.Abs(R);if(x){g=this.m_invMassA;y=this.m_invMassB;v=this.m_invIA;_=this.m_invIB;this.m_K.col1.x=g+y+v*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1+_*this.m_s2;this.m_K.col1.z=v*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+_;this.m_K.col2.z=v*this.m_a1+_*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=g+y+v*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2;this.m_K.Solve33(B,-L,-R,-S)}else{g=this.m_invMassA;y=this.m_invMassB;v=this.m_invIA;_=this.m_invIB;var O=g+y+v*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;var V=v*this.m_s1+_*this.m_s2;var W=v+_;this.m_K.col1.Set(O,V,0);this.m_K.col2.Set(V,W,0);var F=this.m_K.Solve22(new h,-L,-R);B.x=F.x;B.y=F.y;B.z=0}var N=B.x*this.m_perp.x+B.z*this.m_axis.x;var k=B.x*this.m_perp.y+B.z*this.m_axis.y;var G=B.x*this.m_s1+B.y+B.z*this.m_a1;var H=B.x*this.m_s2+B.y+B.z*this.m_a2;u.x-=this.m_invMassA*N;u.y-=this.m_invMassA*k;c-=this.m_invIA*G;p.x+=this.m_invMassB*N;p.y+=this.m_invMassB*k;f+=this.m_invIB*H;
o.m_sweep.a=c;s.m_sweep.a=f;o.SynchronizeTransform();s.SynchronizeTransform();return I<=i.b2_linearSlop&&w<=i.b2_angularSlop};Box2D.inherit(T,Box2D.Dynamics.Joints.b2JointDef);T.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;T.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new h;this.localAnchorB=new h;this.localAxisA=new h};T.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};T.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(n);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(b,Box2D.Dynamics.Joints.b2Joint);b.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;b.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new h;this.m_groundAnchor2=new h;this.m_localAnchor1=new h;this.m_localAnchor2=new h;this.m_u1=new h;this.m_u2=new h};b.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};b.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)};b.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};b.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor1);return t};b.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor2);return t};b.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var n=t.x-e;var r=t.y-i;return Math.sqrt(n*n+r*r)};b.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var n=t.x-e;var r=t.y-i;return Math.sqrt(n*n+r*r)};b.prototype.GetRatio=function(){return this.m_ratio};b.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_ratio=t.ratio;this.m_constant=t.lengthA+this.m_ratio*t.lengthB;this.m_maxLength1=a.Min(t.maxLengthA,this.m_constant-this.m_ratio*b.b2_minPulleyLength);this.m_maxLength2=a.Min(t.maxLengthB,(this.m_constant-b.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};b.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;r=e.m_xf.R;var a=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=r.col1.x*a+r.col2.x*o;o=r.col1.y*a+r.col2.y*o;a=s;r=n.m_xf.R;var h=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=r.col1.x*h+r.col2.x*l;l=r.col1.y*h+r.col2.y*l;h=s;var u=e.m_sweep.c.x+a;var c=e.m_sweep.c.y+o;var p=n.m_sweep.c.x+h;var f=n.m_sweep.c.y+l;var m=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var d=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var g=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var v=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(u-m,c-d);this.m_u2.Set(p-g,f-v);var _=this.m_u1.Length();var I=this.m_u2.Length();if(_>i.b2_linearSlop){this.m_u1.Multiply(1/_)}else{this.m_u1.SetZero()}if(I>i.b2_linearSlop){this.m_u2.Multiply(1/I)}else{this.m_u2.SetZero()}var w=this.m_constant-_-this.m_ratio*I;if(w>0){this.m_state=y.e_inactiveLimit;this.m_impulse=0}else{this.m_state=y.e_atUpperLimit}if(_<this.m_maxLength1){this.m_limitState1=y.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=y.e_atUpperLimit}if(I<this.m_maxLength2){this.m_limitState2=y.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=y.e_atUpperLimit}var x=a*this.m_u1.y-o*this.m_u1.x;var S=h*this.m_u2.y-l*this.m_u2.x;this.m_limitMass1=e.m_invMass+e.m_invI*x*x;this.m_limitMass2=n.m_invMass+n.m_invI*S*S;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(t.warmStarting){this.m_impulse*=t.dtRatio;this.m_limitImpulse1*=t.dtRatio;this.m_limitImpulse2*=t.dtRatio;var C=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;var T=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;var b=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;var D=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*C;e.m_linearVelocity.y+=e.m_invMass*T;e.m_angularVelocity+=e.m_invI*(a*T-o*C);n.m_linearVelocity.x+=n.m_invMass*b;n.m_linearVelocity.y+=n.m_invMass*D;n.m_angularVelocity+=n.m_invI*(h*D-l*b)}else{this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0}};b.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=n.col1.x*r+n.col2.x*o;o=n.col1.y*r+n.col2.y*o;r=s;n=i.m_xf.R;var h=this.m_localAnchor2.x-i.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=n.col1.x*h+n.col2.x*l;l=n.col1.y*h+n.col2.y*l;h=s;var u=0;var c=0;var p=0;var f=0;var m=0;var d=0;var g=0;var v=0;var _=0;var I=0;var w=0;if(this.m_state==y.e_atUpperLimit){u=e.m_linearVelocity.x+-e.m_angularVelocity*o;c=e.m_linearVelocity.y+e.m_angularVelocity*r;p=i.m_linearVelocity.x+-i.m_angularVelocity*l;f=i.m_linearVelocity.y+i.m_angularVelocity*h;_=-(this.m_u1.x*u+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*p+this.m_u2.y*f);I=this.m_pulleyMass*-_;w=this.m_impulse;this.m_impulse=a.Max(0,this.m_impulse+I);I=this.m_impulse-w;m=-I*this.m_u1.x;d=-I*this.m_u1.y;g=-this.m_ratio*I*this.m_u2.x;v=-this.m_ratio*I*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*m;e.m_linearVelocity.y+=e.m_invMass*d;e.m_angularVelocity+=e.m_invI*(r*d-o*m);i.m_linearVelocity.x+=i.m_invMass*g;i.m_linearVelocity.y+=i.m_invMass*v;i.m_angularVelocity+=i.m_invI*(h*v-l*g)}if(this.m_limitState1==y.e_atUpperLimit){u=e.m_linearVelocity.x+-e.m_angularVelocity*o;c=e.m_linearVelocity.y+e.m_angularVelocity*r;_=-(this.m_u1.x*u+this.m_u1.y*c);I=-this.m_limitMass1*_;w=this.m_limitImpulse1;this.m_limitImpulse1=a.Max(0,this.m_limitImpulse1+I);I=this.m_limitImpulse1-w;m=-I*this.m_u1.x;d=-I*this.m_u1.y;e.m_linearVelocity.x+=e.m_invMass*m;e.m_linearVelocity.y+=e.m_invMass*d;e.m_angularVelocity+=e.m_invI*(r*d-o*m)}if(this.m_limitState2==y.e_atUpperLimit){p=i.m_linearVelocity.x+-i.m_angularVelocity*l;f=i.m_linearVelocity.y+i.m_angularVelocity*h;_=-(this.m_u2.x*p+this.m_u2.y*f);I=-this.m_limitMass2*_;w=this.m_limitImpulse2;this.m_limitImpulse2=a.Max(0,this.m_limitImpulse2+I);I=this.m_limitImpulse2-w;g=-I*this.m_u2.x;v=-I*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*g;i.m_linearVelocity.y+=i.m_invMass*v;i.m_angularVelocity+=i.m_invI*(h*v-l*g)}};b.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=this.m_bodyA;var n=this.m_bodyB;var r;var o=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var h=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var u=0;var c=0;var p=0;var f=0;var m=0;var d=0;var g=0;var v=0;var _=0;var I=0;var w=0;var x=0;var S=0;var C=0;var T=0;var b=0;if(this.m_state==y.e_atUpperLimit){r=e.m_xf.R;u=this.m_localAnchor1.x-e.m_sweep.localCenter.x;c=this.m_localAnchor1.y-e.m_sweep.localCenter.y;T=r.col1.x*u+r.col2.x*c;c=r.col1.y*u+r.col2.y*c;u=T;r=n.m_xf.R;p=this.m_localAnchor2.x-n.m_sweep.localCenter.x;f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;T=r.col1.x*p+r.col2.x*f;f=r.col1.y*p+r.col2.y*f;p=T;m=e.m_sweep.c.x+u;d=e.m_sweep.c.y+c;g=n.m_sweep.c.x+p;v=n.m_sweep.c.y+f;this.m_u1.Set(m-o,d-s);this.m_u2.Set(g-h,v-l);_=this.m_u1.Length();I=this.m_u2.Length();if(_>i.b2_linearSlop){this.m_u1.Multiply(1/_)}else{this.m_u1.SetZero()}if(I>i.b2_linearSlop){this.m_u2.Multiply(1/I)}else{this.m_u2.SetZero()}w=this.m_constant-_-this.m_ratio*I;b=a.Max(b,-w);w=a.Clamp(w+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);x=-this.m_pulleyMass*w;m=-x*this.m_u1.x;d=-x*this.m_u1.y;g=-this.m_ratio*x*this.m_u2.x;v=-this.m_ratio*x*this.m_u2.y;e.m_sweep.c.x+=e.m_invMass*m;e.m_sweep.c.y+=e.m_invMass*d;e.m_sweep.a+=e.m_invI*(u*d-c*m);n.m_sweep.c.x+=n.m_invMass*g;n.m_sweep.c.y+=n.m_invMass*v;n.m_sweep.a+=n.m_invI*(p*v-f*g);e.SynchronizeTransform();n.SynchronizeTransform()}if(this.m_limitState1==y.e_atUpperLimit){r=e.m_xf.R;u=this.m_localAnchor1.x-e.m_sweep.localCenter.x;c=this.m_localAnchor1.y-e.m_sweep.localCenter.y;T=r.col1.x*u+r.col2.x*c;c=r.col1.y*u+r.col2.y*c;u=T;m=e.m_sweep.c.x+u;d=e.m_sweep.c.y+c;this.m_u1.Set(m-o,d-s);_=this.m_u1.Length();if(_>i.b2_linearSlop){this.m_u1.x*=1/_;this.m_u1.y*=1/_}else{this.m_u1.SetZero()}w=this.m_maxLength1-_;b=a.Max(b,-w);w=a.Clamp(w+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);x=-this.m_limitMass1*w;m=-x*this.m_u1.x;d=-x*this.m_u1.y;e.m_sweep.c.x+=e.m_invMass*m;e.m_sweep.c.y+=e.m_invMass*d;e.m_sweep.a+=e.m_invI*(u*d-c*m);e.SynchronizeTransform()}if(this.m_limitState2==y.e_atUpperLimit){r=n.m_xf.R;p=this.m_localAnchor2.x-n.m_sweep.localCenter.x;f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;T=r.col1.x*p+r.col2.x*f;f=r.col1.y*p+r.col2.y*f;p=T;g=n.m_sweep.c.x+p;v=n.m_sweep.c.y+f;this.m_u2.Set(g-h,v-l);I=this.m_u2.Length();if(I>i.b2_linearSlop){this.m_u2.x*=1/I;this.m_u2.y*=1/I}else{this.m_u2.SetZero()}w=this.m_maxLength2-I;b=a.Max(b,-w);w=a.Clamp(w+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);x=-this.m_limitMass2*w;g=-x*this.m_u2.x;v=-x*this.m_u2.y;n.m_sweep.c.x+=n.m_invMass*g;n.m_sweep.c.y+=n.m_invMass*v;n.m_sweep.a+=n.m_invI*(p*v-f*g);n.SynchronizeTransform()}return b<i.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef);D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;D.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new h;this.groundAnchorB=new h;this.localAnchorA=new h;this.localAnchorB=new h};D.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=true};D.prototype.Initialize=function(t,e,i,n,r,a,o){if(o===undefined)o=0;this.bodyA=t;this.bodyB=e;this.groundAnchorA.SetV(i);this.groundAnchorB.SetV(n);this.localAnchorA=this.bodyA.GetLocalPoint(r);this.localAnchorB=this.bodyB.GetLocalPoint(a);var s=r.x-i.x;var h=r.y-i.y;this.lengthA=Math.sqrt(s*s+h*h);var l=a.x-n.x;var u=a.y-n.y;this.lengthB=Math.sqrt(l*l+u*u);this.ratio=o;var c=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=c-this.ratio*b.b2_minPulleyLength;this.maxLengthB=(c-b.b2_minPulleyLength)/this.ratio};Box2D.inherit(A,Box2D.Dynamics.Joints.b2Joint);A.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;A.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.K3=new n;this.impulse3=new l;this.impulse2=new h;this.reduced=new h;this.m_localAnchor1=new h;this.m_localAnchor2=new h;this.m_impulse=new l;this.m_mass=new r};A.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};A.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};A.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*this.m_impulse.x,t*this.m_impulse.y)};A.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};A.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};A.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};A.prototype.IsLimitEnabled=function(){return this.m_enableLimit};A.prototype.EnableLimit=function(t){this.m_enableLimit=t};A.prototype.GetLowerLimit=function(){return this.m_lowerAngle};A.prototype.GetUpperLimit=function(){return this.m_upperAngle};A.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_lowerAngle=t;this.m_upperAngle=e};A.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};A.prototype.EnableMotor=function(t){this.m_enableMotor=t};A.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};A.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};A.prototype.SetMaxMotorTorque=function(t){if(t===undefined)t=0;this.m_maxMotorTorque=t};A.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};A.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=t.lowerAngle;this.m_upperAngle=t.upperAngle;this.m_maxMotorTorque=t.maxMotorTorque;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=y.e_inactiveLimit};A.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var o=0;if(this.m_enableMotor||this.m_enableLimit){}r=e.m_xf.R;var s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var h=this.m_localAnchor1.y-e.m_sweep.localCenter.y;o=r.col1.x*s+r.col2.x*h;h=r.col1.y*s+r.col2.y*h;s=o;r=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=r.col1.x*l+r.col2.x*u;u=r.col1.y*l+r.col2.y*u;l=o;var c=e.m_invMass;var p=n.m_invMass;var f=e.m_invI;var m=n.m_invI;this.m_mass.col1.x=c+p+h*h*f+u*u*m;this.m_mass.col2.x=-h*s*f-u*l*m;this.m_mass.col3.x=-h*f-u*m;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=c+p+s*s*f+l*l*m;this.m_mass.col3.y=s*f+l*m;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=f+m;this.m_motorMass=1/(f+m);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var d=n.m_sweep.a-e.m_sweep.a-this.m_referenceAngle;if(a.Abs(this.m_upperAngle-this.m_lowerAngle)<2*i.b2_angularSlop){this.m_limitState=y.e_equalLimits}else if(d<=this.m_lowerAngle){if(this.m_limitState!=y.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=y.e_atLowerLimit}else if(d>=this.m_upperAngle){if(this.m_limitState!=y.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=y.e_atUpperLimit}else{this.m_limitState=y.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=y.e_inactiveLimit}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var g=this.m_impulse.x;var v=this.m_impulse.y;e.m_linearVelocity.x-=c*g;e.m_linearVelocity.y-=c*v;e.m_angularVelocity-=f*(s*v-h*g+this.m_motorImpulse+this.m_impulse.z);n.m_linearVelocity.x+=p*g;n.m_linearVelocity.y+=p*v;n.m_angularVelocity+=m*(l*v-u*g+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};A.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n;var r=0;var o=0;var s=0;var h=0;var l=0;var u=0;var c=e.m_linearVelocity;var p=e.m_angularVelocity;var f=i.m_linearVelocity;var m=i.m_angularVelocity;var d=e.m_invMass;var g=i.m_invMass;var v=e.m_invI;var _=i.m_invI;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var I=m-p-this.m_motorSpeed;var w=this.m_motorMass*-I;var x=this.m_motorImpulse;var S=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=a.Clamp(this.m_motorImpulse+w,-S,S);w=this.m_motorImpulse-x;p-=v*w;m+=_*w}if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){n=e.m_xf.R;s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;h=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*h;h=n.col1.y*s+n.col2.y*h;s=r;n=i.m_xf.R;l=this.m_localAnchor2.x-i.m_sweep.localCenter.x;u=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*l+n.col2.x*u;u=n.col1.y*l+n.col2.y*u;l=r;var C=f.x+-m*u-c.x- -p*h;var T=f.y+m*l-c.y-p*s;var b=m-p;this.m_mass.Solve33(this.impulse3,-C,-T,-b);if(this.m_limitState==y.e_equalLimits){this.m_impulse.Add(this.impulse3)}else if(this.m_limitState==y.e_atLowerLimit){o=this.m_impulse.z+this.impulse3.z;if(o<0){this.m_mass.Solve22(this.reduced,-C,-T);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==y.e_atUpperLimit){o=this.m_impulse.z+this.impulse3.z;if(o>0){this.m_mass.Solve22(this.reduced,-C,-T);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}c.x-=d*this.impulse3.x;c.y-=d*this.impulse3.y;p-=v*(s*this.impulse3.y-h*this.impulse3.x+this.impulse3.z);f.x+=g*this.impulse3.x;f.y+=g*this.impulse3.y;m+=_*(l*this.impulse3.y-u*this.impulse3.x+this.impulse3.z)}else{n=e.m_xf.R;s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;h=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*h;h=n.col1.y*s+n.col2.y*h;s=r;n=i.m_xf.R;l=this.m_localAnchor2.x-i.m_sweep.localCenter.x;u=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*l+n.col2.x*u;u=n.col1.y*l+n.col2.y*u;l=r;var D=f.x+-m*u-c.x- -p*h;var A=f.y+m*l-c.y-p*s;this.m_mass.Solve22(this.impulse2,-D,-A);this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;c.x-=d*this.impulse2.x;c.y-=d*this.impulse2.y;p-=v*(s*this.impulse2.y-h*this.impulse2.x);f.x+=g*this.impulse2.x;f.y+=g*this.impulse2.y;m+=_*(l*this.impulse2.y-u*this.impulse2.x)}e.m_linearVelocity.SetV(c);e.m_angularVelocity=p;i.m_linearVelocity.SetV(f);i.m_angularVelocity=m};A.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var n=0;var r;var o=this.m_bodyA;var s=this.m_bodyB;var h=0;var l=0;var u=0;var c=0;var p=0;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var f=s.m_sweep.a-o.m_sweep.a-this.m_referenceAngle;var m=0;if(this.m_limitState==y.e_equalLimits){n=a.Clamp(f-this.m_lowerAngle,-i.b2_maxAngularCorrection,i.b2_maxAngularCorrection);m=-this.m_motorMass*n;h=a.Abs(n)}else if(this.m_limitState==y.e_atLowerLimit){n=f-this.m_lowerAngle;h=-n;n=a.Clamp(n+i.b2_angularSlop,-i.b2_maxAngularCorrection,0);m=-this.m_motorMass*n}else if(this.m_limitState==y.e_atUpperLimit){n=f-this.m_upperAngle;h=n;n=a.Clamp(n-i.b2_angularSlop,0,i.b2_maxAngularCorrection);m=-this.m_motorMass*n}o.m_sweep.a-=o.m_invI*m;s.m_sweep.a+=s.m_invI*m;o.SynchronizeTransform();s.SynchronizeTransform()}{r=o.m_xf.R;var d=this.m_localAnchor1.x-o.m_sweep.localCenter.x;var g=this.m_localAnchor1.y-o.m_sweep.localCenter.y;u=r.col1.x*d+r.col2.x*g;g=r.col1.y*d+r.col2.y*g;d=u;r=s.m_xf.R;var v=this.m_localAnchor2.x-s.m_sweep.localCenter.x;var _=this.m_localAnchor2.y-s.m_sweep.localCenter.y;u=r.col1.x*v+r.col2.x*_;_=r.col1.y*v+r.col2.y*_;v=u;var I=s.m_sweep.c.x+v-o.m_sweep.c.x-d;var w=s.m_sweep.c.y+_-o.m_sweep.c.y-g;var x=I*I+w*w;var S=Math.sqrt(x);l=S;var C=o.m_invMass;var T=s.m_invMass;var b=o.m_invI;var D=s.m_invI;var E=10*i.b2_linearSlop;if(x>E*E){var U=I/S;var M=w/S;var P=C+T;var B=1/P;c=B*-I;p=B*-w;var L=.5;o.m_sweep.c.x-=L*C*c;o.m_sweep.c.y-=L*C*p;s.m_sweep.c.x+=L*T*c;s.m_sweep.c.y+=L*T*p;I=s.m_sweep.c.x+v-o.m_sweep.c.x-d;w=s.m_sweep.c.y+_-o.m_sweep.c.y-g}this.K1.col1.x=C+T;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=C+T;this.K2.col1.x=b*g*g;this.K2.col2.x=-b*d*g;this.K2.col1.y=-b*d*g;this.K2.col2.y=b*d*d;this.K3.col1.x=D*_*_;this.K3.col2.x=-D*v*_;this.K3.col1.y=-D*v*_;this.K3.col2.y=D*v*v;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(A.tImpulse,-I,-w);c=A.tImpulse.x;p=A.tImpulse.y;o.m_sweep.c.x-=o.m_invMass*c;o.m_sweep.c.y-=o.m_invMass*p;o.m_sweep.a-=o.m_invI*(d*p-g*c);s.m_sweep.c.x+=s.m_invMass*c;s.m_sweep.c.y+=s.m_invMass*p;s.m_sweep.a+=s.m_invI*(v*p-_*c);o.SynchronizeTransform();s.SynchronizeTransform()}return l<=i.b2_linearSlop&&h<=i.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new h});Box2D.inherit(E,Box2D.Dynamics.Joints.b2JointDef);E.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;E.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new h;this.localAnchorB=new h};E.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false};E.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(U,Box2D.Dynamics.Joints.b2Joint);U.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;U.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new h;this.m_localAnchorB=new h;this.m_impulse=new l;this.m_mass=new r};U.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};U.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};U.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new h(t*this.m_impulse.x,t*this.m_impulse.y)};U.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};U.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_mass=new r};U.prototype.InitVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;e=n.m_xf.R;var a=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var o=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*o;o=e.col1.y*a+e.col2.y*o;a=i;e=r.m_xf.R;var s=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var h=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*s+e.col2.x*h;h=e.col1.y*s+e.col2.y*h;s=i;var l=n.m_invMass;var u=r.m_invMass;var c=n.m_invI;var p=r.m_invI;this.m_mass.col1.x=l+u+o*o*c+h*h*p;this.m_mass.col2.x=-o*a*c-h*s*p;this.m_mass.col3.x=-o*c-h*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=l+u+a*a*c+s*s*p;this.m_mass.col3.y=a*c+s*p;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=c+p;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_impulse.z*=t.dtRatio;n.m_linearVelocity.x-=l*this.m_impulse.x;n.m_linearVelocity.y-=l*this.m_impulse.y;n.m_angularVelocity-=c*(a*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z);r.m_linearVelocity.x+=u*this.m_impulse.x;r.m_linearVelocity.y+=u*this.m_impulse.y;r.m_angularVelocity+=p*(s*this.m_impulse.y-h*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};U.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;var a=n.m_linearVelocity;var o=n.m_angularVelocity;var s=r.m_linearVelocity;var h=r.m_angularVelocity;var u=n.m_invMass;var c=r.m_invMass;var p=n.m_invI;var f=r.m_invI;e=n.m_xf.R;var m=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var d=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*m+e.col2.x*d;d=e.col1.y*m+e.col2.y*d;m=i;e=r.m_xf.R;var g=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var y=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*g+e.col2.x*y;y=e.col1.y*g+e.col2.y*y;g=i;var v=s.x-h*y-a.x+o*d;var _=s.y+h*g-a.y-o*m;var I=h-o;var w=new l;this.m_mass.Solve33(w,-v,-_,-I);this.m_impulse.Add(w);a.x-=u*w.x;a.y-=u*w.y;o-=p*(m*w.y-d*w.x+w.z);s.x+=c*w.x;s.y+=c*w.y;h+=f*(g*w.y-y*w.x+w.z);n.m_angularVelocity=o;r.m_angularVelocity=h};U.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;var n=0;var r=this.m_bodyA;var o=this.m_bodyB;e=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var h=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=e.col1.x*s+e.col2.x*h;h=e.col1.y*s+e.col2.y*h;s=n;e=o.m_xf.R;var u=this.m_localAnchorB.x-o.m_sweep.localCenter.x;var c=this.m_localAnchorB.y-o.m_sweep.localCenter.y;n=e.col1.x*u+e.col2.x*c;c=e.col1.y*u+e.col2.y*c;u=n;var p=r.m_invMass;var f=o.m_invMass;var m=r.m_invI;var d=o.m_invI;var g=o.m_sweep.c.x+u-r.m_sweep.c.x-s;var y=o.m_sweep.c.y+c-r.m_sweep.c.y-h;var v=o.m_sweep.a-r.m_sweep.a-this.m_referenceAngle;var _=10*i.b2_linearSlop;var I=Math.sqrt(g*g+y*y);var w=a.Abs(v);if(I>_){m*=1;d*=1}this.m_mass.col1.x=p+f+h*h*m+c*c*d;this.m_mass.col2.x=-h*s*m-c*u*d;this.m_mass.col3.x=-h*m-c*d;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=p+f+s*s*m+u*u*d;this.m_mass.col3.y=s*m+u*d;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+d;var x=new l;this.m_mass.Solve33(x,-g,-y,-v);r.m_sweep.c.x-=p*x.x;r.m_sweep.c.y-=p*x.y;r.m_sweep.a-=m*(s*x.y-h*x.x+x.z);o.m_sweep.c.x+=f*x.x;o.m_sweep.c.y+=f*x.y;o.m_sweep.a+=d*(u*x.y-c*x.x+x.z);r.SynchronizeTransform();o.SynchronizeTransform();return I<=i.b2_linearSlop&&w<=i.b2_angularSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new h;this.localAnchorB=new h};M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=y.e_weldJoint;this.referenceAngle=0};M.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}};t.prototype._color=function(t,e){return"rgba("+((t&16711680)>>16)+","+((t&65280)>>8)+","+(t&255)+","+e+")"};t.prototype.b2DebugDraw=function(){this.m_drawFlags=0};t.prototype.SetFlags=function(t){if(t===undefined)t=0;this.m_drawFlags=t};t.prototype.GetFlags=function(){return this.m_drawFlags};t.prototype.AppendFlags=function(t){if(t===undefined)t=0;this.m_drawFlags|=t};t.prototype.ClearFlags=function(t){if(t===undefined)t=0;this.m_drawFlags&=~t};t.prototype.SetSprite=function(t){this.m_ctx=t};t.prototype.GetSprite=function(){return this.m_ctx};t.prototype.SetDrawScale=function(t){if(t===undefined)t=0;this.m_drawScale=t};t.prototype.GetDrawScale=function(){return this.m_drawScale};t.prototype.SetLineThickness=function(t){if(t===undefined)t=0;this.m_lineThickness=t;this.m_ctx.strokeWidth=t};t.prototype.GetLineThickness=function(){return this.m_lineThickness};t.prototype.SetAlpha=function(t){if(t===undefined)t=0;this.m_alpha=t};t.prototype.GetAlpha=function(){return this.m_alpha};t.prototype.SetFillAlpha=function(t){if(t===undefined)t=0;this.m_fillAlpha=t};t.prototype.GetFillAlpha=function(){return this.m_fillAlpha};t.prototype.SetXFormScale=function(t){if(t===undefined)t=0;this.m_xformScale=t};t.prototype.GetXFormScale=function(){return this.m_xformScale};t.prototype.DrawPolygon=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.moveTo(t[0].x*r,t[0].y*r);for(var a=1;a<e;a++){n.lineTo(t[a].x*r,t[a].y*r)}n.lineTo(t[0].x*r,t[0].y*r);n.closePath();n.stroke()};t.prototype.DrawSolidPolygon=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.fillStyle=this._color(i.color,this.m_fillAlpha);n.moveTo(t[0].x*r,t[0].y*r);for(var a=1;a<e;a++){n.lineTo(t[a].x*r,t[a].y*r)}n.lineTo(t[0].x*r,t[0].y*r);n.closePath();n.fill();n.stroke()};t.prototype.DrawCircle=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.arc(t.x*r,t.y*r,e*r,0,Math.PI*2,true);n.closePath();n.stroke()};t.prototype.DrawSolidCircle=function(t,e,i,n){if(!e)return;var r=this.m_ctx,a=this.m_drawScale,o=t.x*a,s=t.y*a;r.moveTo(0,0);r.beginPath();r.strokeStyle=this._color(n.color,this.m_alpha);r.fillStyle=this._color(n.color,this.m_fillAlpha);r.arc(o,s,e*a,0,Math.PI*2,true);r.moveTo(o,s);r.lineTo((t.x+i.x*e)*a,(t.y+i.y*e)*a);r.closePath();r.fill();r.stroke()};t.prototype.DrawSegment=function(t,e,i){var n=this.m_ctx,r=this.m_drawScale;n.strokeStyle=this._color(i.color,this.m_alpha);n.beginPath();n.moveTo(t.x*r,t.y*r);n.lineTo(e.x*r,e.y*r);n.closePath();n.stroke()};t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(16711680,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i);e.strokeStyle=this._color(65280,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i);e.closePath();e.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;if(typeof require!=="undefined"&&typeof module!=="undefined"){module.exports=Box2D}window.b2Color=Box2D.Common.b2Color,window.b2internal=Box2D.Common.b2internal,window.b2Settings=Box2D.Common.b2Settings,window.b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,window.b2EdgeChainDef=Box2D.Collision.Shapes.b2EdgeChainDef,window.b2EdgeShape=Box2D.Collision.Shapes.b2EdgeShape,window.b2MassData=Box2D.Collision.Shapes.b2MassData,window.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,window.b2Shape=Box2D.Collision.Shapes.b2Shape,window.b2Mat22=Box2D.Common.Math.b2Mat22,window.b2Mat33=Box2D.Common.Math.b2Mat33,window.b2Math=Box2D.Common.Math.b2Math,window.b2Sweep=Box2D.Common.Math.b2Sweep,window.b2Transform=Box2D.Common.Math.b2Transform,window.b2Vec2=Box2D.Common.Math.b2Vec2,window.b2Vec3=Box2D.Common.Math.b2Vec3,window.b2Body=Box2D.Dynamics.b2Body,window.b2BodyDef=Box2D.Dynamics.b2BodyDef,window.b2ContactFilter=Box2D.Dynamics.b2ContactFilter,window.b2ContactImpulse=Box2D.Dynamics.b2ContactImpulse,window.b2ContactListener=Box2D.Dynamics.b2ContactListener,window.b2ContactManager=Box2D.Dynamics.b2ContactManager,window.b2DebugDraw=Box2D.Dynamics.b2DebugDraw,window.b2DestructionListener=Box2D.Dynamics.b2DestructionListener,window.b2FilterData=Box2D.Dynamics.b2FilterData,window.b2Fixture=Box2D.Dynamics.b2Fixture,window.b2FixtureDef=Box2D.Dynamics.b2FixtureDef,window.b2Island=Box2D.Dynamics.b2Island,window.b2TimeStep=Box2D.Dynamics.b2TimeStep,window.b2World=Box2D.Dynamics.b2World,
window.b2AABB=Box2D.Collision.b2AABB,window.b2Bound=Box2D.Collision.b2Bound,window.b2BoundValues=Box2D.Collision.b2BoundValues,window.b2Collision=Box2D.Collision.b2Collision,window.b2ContactID=Box2D.Collision.b2ContactID,window.b2ContactPoint=Box2D.Collision.b2ContactPoint,window.b2Distance=Box2D.Collision.b2Distance,window.b2DistanceInput=Box2D.Collision.b2DistanceInput,window.b2DistanceOutput=Box2D.Collision.b2DistanceOutput,window.b2DistanceProxy=Box2D.Collision.b2DistanceProxy,window.b2DynamicTree=Box2D.Collision.b2DynamicTree,window.b2DynamicTreeBroadPhase=Box2D.Collision.b2DynamicTreeBroadPhase,window.b2DynamicTreeNode=Box2D.Collision.b2DynamicTreeNode,window.b2DynamicTreePair=Box2D.Collision.b2DynamicTreePair,window.b2Manifold=Box2D.Collision.b2Manifold,window.b2ManifoldPoint=Box2D.Collision.b2ManifoldPoint,window.b2Point=Box2D.Collision.b2Point,window.b2RayCastInput=Box2D.Collision.b2RayCastInput,window.b2RayCastOutput=Box2D.Collision.b2RayCastOutput,window.b2Segment=Box2D.Collision.b2Segment,window.b2SeparationFunction=Box2D.Collision.b2SeparationFunction,window.b2Simplex=Box2D.Collision.b2Simplex,window.b2SimplexCache=Box2D.Collision.b2SimplexCache,window.b2SimplexVertex=Box2D.Collision.b2SimplexVertex,window.b2TimeOfImpact=Box2D.Collision.b2TimeOfImpact,window.b2TOIInput=Box2D.Collision.b2TOIInput,window.b2WorldManifold=Box2D.Collision.b2WorldManifold,window.b2DistanceJoint=Box2D.Dynamics.Joints.b2DistanceJoint,window.b2DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef,window.b2FrictionJoint=Box2D.Dynamics.Joints.b2FrictionJoint,window.b2FrictionJointDef=Box2D.Dynamics.Joints.b2FrictionJointDef,window.b2GearJoint=Box2D.Dynamics.Joints.b2GearJoint,window.b2GearJointDef=Box2D.Dynamics.Joints.b2GearJointDef,window.b2Jacobian=Box2D.Dynamics.Joints.b2Jacobian,window.b2Joint=Box2D.Dynamics.Joints.b2Joint,window.b2JointDef=Box2D.Dynamics.Joints.b2JointDef,window.b2JointEdge=Box2D.Dynamics.Joints.b2JointEdge,window.b2LineJoint=Box2D.Dynamics.Joints.b2LineJoint,window.b2LineJointDef=Box2D.Dynamics.Joints.b2LineJointDef,window.b2MouseJoint=Box2D.Dynamics.Joints.b2MouseJoint,window.b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef,window.b2PrismaticJoint=Box2D.Dynamics.Joints.b2PrismaticJoint,window.b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef,window.b2PulleyJoint=Box2D.Dynamics.Joints.b2PulleyJoint,window.b2PulleyJointDef=Box2D.Dynamics.Joints.b2PulleyJointDef,window.b2RevoluteJoint=Box2D.Dynamics.Joints.b2RevoluteJoint,window.b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,window.b2WeldJoint=Box2D.Dynamics.Joints.b2WeldJoint,window.b2WeldJointDef=Box2D.Dynamics.Joints.b2WeldJointDef;function UIWeixin(){return}UIWeixin.prototype=new UIElement;UIWeixin.prototype.isUIWeixin=true;UIWeixin.prototype.initUIWeixin=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);this.setCanRectSelectable(false,true);return this};UIWeixin.prototype.onAppendedInParent=function(){TangideApp.addUserScript("http://res.wx.qq.com/open/js/jweixin-1.0.0.js");return};UIWeixin.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"];UIWeixin.prototype.getConfig=function(t,e,i){if(UIWeixin.config){return}else{UIWeixin.config={}}httpGetJSON(t,function n(t){UIWeixin.config=t;if(UIWeixin.config){UIWeixin.config.jsApiList=e;UIWeixin.config.debug=i;console.log("Fetch UIWeixin.config success:")}else{console.log("Fetch weixin config failed.");return}function n(){try{wx.config(UIWeixin.config);UIWeixin.configDone=true;console.log(JSON.stringify(UIWeixin.config,null,"	"));console.log("Call wx.config done:")}catch(t){console.log("wx script is not load yet, try to config lator:");setTimeout(n,100)}}if(isWeiXin()){console.log("Is WeiXin, try to config it.");n()}else{console.log("It is not weixin browser")}})};UIWeixin.prototype.onFromJsonDone=function(){var t=window.btoa(location.href);var e=this.configURL?this.configURL:"/weixin/php/json_config.php";if(e.indexOf("?")>0){e=e+"&url="+t}else{e=e+"?url="+t}var i=UIWeixin.jsApiList;if(this.apiList){i=this.apiList.split("\n")}this.getConfig(e,i,this.debug);return};UIWeixin.prototype.onInit=function(){var t=this;if(!window.wx){console.log("UIWeixin.prototype.onInit wx not defined.");return}wx.ready(function(){UIWeixin.ready=true;t.updateShareInfo();console.log("wx.ready")});wx.error(function(t){});console.log("UIWeixin.prototype.onInit end");return};UIWeixin.prototype.onDeinit=function(){return};UIWeixin.prototype.shapeCanBeChild=function(t){return false};UIWeixin.prototype.setShareTitle=function(t){this.shareTitle=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareDesc=function(t){this.shareDesc=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareLink=function(t){this.shareLink=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareImage=function(t){this.shareImage=t;this.updateShareInfo();return this};UIWeixin.prototype.updateShareInfo=function(){if(!window.wx){return}var t=this.view;var e=this.shareTitle?this.shareTitle:t.getAppName();var i=this.shareDesc?this.shareDesc:t.getAppDesc();var n=this.shareLink?this.shareLink:location.href;var r=ResLoader.toAbsURL(this.shareImage?this.shareImage:t.getAppIcon());var a={title:e,desc:i,link:n,imgUrl:r,trigger:function(t){console.log("weixin operation trigger:"+JSON.stringify(t))},success:function(t){console.log("weixin operation success:"+JSON.stringify(t))},cancel:function(t){console.log("weixin operation cancel:"+JSON.stringify(t))},fail:function(t){console.log("weixin operation fail:"+JSON.stringify(t))}};wx.onMenuShareAppMessage(a);wx.onMenuShareTimeline(a);wx.onMenuShareQQ(a);wx.onMenuShareWeibo(a);return};function UIWeixinCreator(){var t=["ui-weixin","ui-weixin",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWeixin;return e.initUIWeixin(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIWeixinCreator);if(!window.CanTK){window.CanTK={}}CanTK.isOldIE=isOldIE;CanTK.isTizen=isTizen;CanTK.isMobile=isMobile;CanTK.isAndroid=isAndroid;CanTK.isFirefoxOS=isFirefoxOS;CanTK.isRightMouseEvent=isRightMouseEvent;CanTK.delayLoadScripts=delayLoadScripts;CanTK.initViewPort=cantkInitViewPort;CanTK.restoreViewPort=cantkRestoreViewPort;CanTK.httpGetURL=httpGetURL;CanTK.httpGetJSON=httpGetJSON;CanTK.httpDoRequest=httpDoRequest;CanTK.LinearInterpolator=LinearInterpolator;CanTK.BounceInterpolator=BounceInterpolator;CanTK.AccelerateInterpolator=AccelerateInterpolator;CanTK.AccDecelerateInterpolator=AccDecelerateInterpolator;CanTK.DecelerateInterpolator=DecelerateInterpolator;CanTK.detectDeviceConfig=cantkDetectDeviceConfig;CanTK.regShapeCreator=cantkRegShapeCreator;CanTK.ShapeCreator=ShapeCreator;window.isOldIE=isOldIE;window.isTizen=isTizen;window.isMobile=isMobile;window.isAndroid=isAndroid;window.isFirefoxOS=isFirefoxOS;window.httpGetURL=httpGetURL;window.httpGetJSON=httpGetJSON;window.httpDoRequest=httpDoRequest;window.cantkGetLocale=cantkGetLocale;window.cantkInitViewPort=cantkInitViewPort;window.cantkRestoreViewPort=cantkRestoreViewPort;window.cantkRegisterUIElements=cantkRegisterUIElements;window.cantkGetViewPort=cantkGetViewPort;window.Shape=Shape;window.UIElement=UIElement;window.UIWindowManager=UIWindowManager;window.ShapeFactory=ShapeFactory;CanTK.UIImage=UIImage;CanTK.Physics=Physics;CanTK.Shape=Shape;CanTK.UIElement=UIElement;CanTK.init=function(){return cantkRegisterUIElements()};CanTK.createElement=function(t){return ShapeFactoryGet().createShape(t,C_CREATE_FOR_PROGRAM)};CanTK.createElementWithJson=function(t){var e=t.type;var i=ShapeFactoryGet().createShape(e,C_CREATE_FOR_PROGRAM);if(i){i.fromJson(t);i.setMode(Shape.MODE_RUNNING,true)}return i};CanTK.UIElement.RUNNING=Shape.MODE_RUNNING;CanTK.UIElement.DEFAULT_IMAGE=UIElement.IMAGE_DEFAULT;CanTK.setResRoot=function(t){return ResLoader.setResRoot(t)};function stableSortMerge(t,e){function i(t,i){var n=t.length,r=i.length,a=n+r,o=new Array(a);for(var s=0,h=0,l=0;l<a;){if(s===n)o[l++]=i[h++];else if(h===r||e(t[s],i[h])<=0)o[l++]=t[s++];else o[l++]=i[h++]}return o}function n(t){var e=t.length,r=Math.ceil(e/2);return e<=1?t:i(n(t.slice(0,r)),n(t.slice(r)))}return n(t)}UIFrameAnimation.prototype.getSupportedImageDisplay=function(){return["scale","incenter","auto"]};UIScene.prototype.getSupportedImageDisplay=function(){return["scale","incenter","tile","vtile","htile","fit-width","fit-height"]};UIScene.prototype.setDebug=function(t){this.debug=t;return};UIScene.prototype.beforePaintChildren=function(t){var e=0;var i=0;var n=[];var r=null;if(!this.debug&&this.mode!=Shape.MODE_EDITING){return}for(var a=0;a<this.children.length;a++){var o=this.children[a];if(!o.isUIFootprint){continue}n.push(o)}stableSortMerge(n,function(t,e){if(t.name>e.name){return 1}if(t.name<e.name){return-1}else{return 0}});t.lineCap="round";t.lineJoin="round";t.lineWidth=5;for(var a=0;a<n.length;a++){var o=n[a];e=o.x+(o.w>>1);i=o.y+(o.h>>1);if(a===0||o.name!=n[a-1].name){if(a!=0){t.strokeStyle=r;t.stroke();t.beginPath()}t.moveTo(e,i);r=o.style.fillColor}else{t.lineTo(e,i)}}t.strokeStyle=r;t.stroke();return};UICircle.prototype.getEventNames=function(){var t=this.getParent();if(t&&(t.isUISprite||t.isUISkeletonAnimation||t.isUITransformAnimation||t.isUIFrameAnimation)){return[]}else{return UIElement.prototype.getEventNames.call(this)}};UIBox.prototype.getEventNames=UICircle.prototype.getEventNames;UIPolygon.prototype.getEventNames=UICircle.prototype.getEventNames;UISprite.prototype.getMoreSelectMark=RShape.prototype.getRotateSelectMark;UIBox.prototype.getMoreSelectMark=RShape.prototype.getRotateSelectMark;UIFrameAnimation.prototype.getMoreSelectMark=RShape.prototype.getRotateSelectMark;UISoundEffects.prototype.setParent=function(t){Shape.prototype.setParent.call(this,t);var e=this.getWindowManager();if(e&&!e.soundEffectURLs){e.setSoundEffectURLs("/cantk-game/assets/sound/disappear.mp3")}return this};UISoundMusic.prototype.setParent=function(t){Shape.prototype.setParent.call(this,t);var e=this.getWindowManager();if(e&&!e.soundMusicURLs){e.setSoundMusicURLs("/cantk-game/assets/sound/bg.mp3")}return this};root.CanTK=CanTK;UIElement.prototype.setsd=function(t){window.statisticsData=t;return this};UIElement.prototype.sendsd=function(t){window.statisticsStr=t;setTimeout(window.sendStatistics,10)}}).call(this);
