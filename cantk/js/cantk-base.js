var gCantkBuildDate="2016年 06月 30日 星期四 18:16:48 CST";console.log("cantk build date: "+gCantkBuildDate);if(!window.CanTK){window.CanTK={}}window.CanTK.config={logoImageSrc:null,progressBarBgSrc:null,progressBarFgSrc:null};function Shape(){return}Shape.MODE_EDITING=0;Shape.MODE_RUNNING=1;Shape.MODE_PREVIEW=2;Shape.HIT_TEST_NONE=0;Shape.HIT_TEST_TL=1;Shape.HIT_TEST_TM=2;Shape.HIT_TEST_TR=3;Shape.HIT_TEST_ML=4;Shape.HIT_TEST_MR=5;Shape.HIT_TEST_BL=6;Shape.HIT_TEST_BM=7;Shape.HIT_TEST_BR=8;Shape.HIT_TEST_HANDLE=9;Shape.HIT_TEST_WORKAREA=10;Shape.HIT_TEST_ROTATION=11;Shape.HIT_TEST_MOVE=12;Shape.HIT_TEST_MAX=13;Shape.HIT_TEST_MM=-1;Shape.ALIGN_LEFT=1;Shape.ALIGN_RIGHT=2;Shape.ALIGN_TOP=3;Shape.ALIGN_BOTTOM=4;Shape.ALIGN_CENTER=5;Shape.ALIGN_MIDDLE=6;Shape.ALIGN_TO_SAME_WIDTH=7;Shape.ALIGN_TO_SAME_HEIGHT=8;Shape.ALIGN_DIST_VER=9;Shape.ALIGN_DIST_HOR=10;Shape.STAT_CREATING_0=0;Shape.STAT_CREATING_1=1;Shape.STAT_CREATING_2=2;Shape.STAT_NORMAL=3;Shape.TEXT_NONE=0;Shape.TEXT_INPUT=1;Shape.TEXT_TEXTAREA=2;Shape.EVT_POINTER_DOWN=1;Shape.EVT_POINTER_MOVE=0;Shape.EVT_POINTER_UP=-1;Shape.prototype.initPanelShape=function(){return};Shape.prototype.initIconShape=function(){return};Shape.prototype.setNearRange=function(t){this.nearRange=t;return this};Shape.prototype.getNearRange=function(){return this.nearRange?this.nearRange:20};Shape.prototype.findNear=function(t){return null};Shape.prototype.getCreatingShape=function(){return this.view?this.view.getCreatingShape():null};Shape.prototype.getTextCookie=function(t){return 0};Shape.isTransparentColor=function(t){return!t||t==="rgba(0,0,0,0)"};Shape.prototype.isFillColorTransparent=function(){return Shape.isTransparentColor(this.style.fillColor)};Shape.prototype.isStrokeColorTransparent=function(){return Shape.isTransparentColor(this.style.lineColor)};Shape.prototype.isTextColorTransparent=function(){return Shape.isTransparentColor(this.style.textColor)};Shape.prototype.setParent=function(t){this.parentShape=t;return this};Shape.prototype.getParent=function(t){if(t){for(var e=this.parentShape;e!=null;e=e.parentShape){if(e.name===t||e.type===t){return e}}}return t?null:this.parentShape};Shape.prototype.textEditable=function(t){return true};Shape.prototype.setInputType=function(t){this.inputType=t;return this};Shape.prototype.editText=function(t){return};Shape.prototype.exec=function(t){if(this.app){this.app.exec(t)}else{t.doit();delete t}return};Shape.prototype.setTextTitle=function(t){this.textTitle=t;return this};Shape.prototype.initShape=function(t,e,i,n,r){this.w=i;this.h=n;this._x=t;this._y=e;this._left=t;this._top=e;this.type=r;this.text="";this.app=null;this.view=null;this.rotation=0;this.scaleX=1;this.scaleY=1;this.selected=false;this.parentShape=null;this.pointerDown=false;this.userMovable=true;this.userResizable=true;this.state=Shape.STAT_NORMAL;this.lastPosition={x:0,y:0};this.selectMarkPoint={x:0,y:0};this.textType=Shape.TEXT_INPUT;this.setDefaultStyle();this.setTextAlignV("middle");this.setTextAlignH("center");this.hitTestResult=Shape.HIT_TEST_NONE;return};Shape.prototype.setDefaultStyle=function(){this.style=new ShapeStyle;this.setStyle(Shape.getDefaultStyle());return this};Shape.prototype.setState=function(t){this.state=t;return this};Shape.prototype.setTextType=function(t){this.textType=t;return this};Shape.prototype.isSelected=function(){return this.selected};Shape.prototype.userRemovable=function(){return true};Shape.prototype.intersectWithRect=function(t){var e=false;var i=this.getX();var n=this.getY();var r=this.getWidth();var o=this.getHeight();var a={x:i,y:n};var s={x:i+r,y:n+o};var h={x:i+r,y:n};var l={x:i,y:n+o};return isPointInRect(a,t)||isPointInRect(s,t)||isPointInRect(h,t)||isPointInRect(l,t)};Shape.prototype.isThisInRect=function(t){var e=false;var i=this.getX();var n=this.getY();var r=this.getWidth();var o=this.getHeight();if(i>=t.x&&i<t.x+t.w&&(n>=t.y&&n<t.y+t.h)){e=true}return e};Shape.prototype.isClicked=function(){if(this.view){return this.view.isClicked()}return false};Shape.prototype.isAltDown=function(){if(this.view){return this.view.isAltDown()}return false};Shape.prototype.isCtrlDown=function(){if(this.view){return this.view.isCtrlDown()}return false};Shape.prototype.onMoving=function(){};Shape.prototype.onMoved=function(){};Shape.prototype.onSized=function(){};Shape.prototype.onUserMoved=function(t,e){};Shape.prototype.onUserResized=function(){};Shape.prototype.fixChildPosition=function(t){var e=this.w;var i=this.h;var n=t.left>=0?t.left:0;var r=t.top>=0?t.top:0;if(n+t.w>e){n=e-t.w}if(r+t.h>i){r=i-t.h}t.left=n;t.top=r;return};Shape.prototype.fixPosition=function(){if(!this.parentShape){return}this.parentShape.fixChildPosition(this);return};Shape.prototype.move=function(t,e){if(this.left!==t||this.top!==e){this.setLeftTop(t,e);if(!this.isIcon){this.fixPosition();this.onMoved()}}return this};Shape.prototype.moveDelta=function(t,e){return this.move(this.left+t,this.top+e)};Shape.prototype.getWidth=function(){return this.w};Shape.prototype.getHeight=function(){return this.h};Shape.prototype.getPositionInScreen=function(){var t={x:0,y:0};var e=this.getRealScale();var i=this.getPositionInView();if(this.view){t=this.view.getAbsPosition()}i.x=t.x+i.x*e;i.y=t.y+i.y*e;return i};Shape.prototype.getRealScale=function(){return this.view?this.view.getScale():1};Shape.prototype.getAbsPosition=function(){var t=this.getPositionInView();if(this.view){var e=this.view.getAbsPosition();t.x=t.x+e.x;t.y=t.y+e.y}return t};Shape.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.parentShape;while(n!=null){t+=n.left;e+=n.top;n=n.parentShape}i.x=t;i.y=e;return i};Shape.prototype.getXinView=function(){var t=this.getPositionInView().x;return t};Shape.prototype.getYinView=function(){var t=this.getPositionInView().y;return t};Shape.prototype.getX=function(){return this.x};Shape.prototype.getY=function(){return this.y};Shape.prototype.setX=function(t){this.x=t;return this};Shape.prototype.setY=function(t){this.y=t;return this};Shape.prototype.align=function(t,e){return};Shape.prototype.setRotatable=function(t){this.rotatable=t;return this};Shape.prototype.setScaleX=function(t){this.scaleX=t;return this};Shape.prototype.setScaleY=function(t){this.scaleY=t;return this};Shape.prototype.getScale=Shape.prototype.getScaleX=function(){return this.scaleX!==undefined?this.scaleX:this.scale};Shape.prototype.getScaleY=function(){return this.scaleY!==undefined?this.scaleY:this.scale};Shape.prototype.setScale=function(t,e){this.scaleX=t;this.scaleY=e!==undefined?e:t;return this};Shape.prototype.getRotation=function(){return this.rotation};Shape.prototype.setRotation=function(t){this.rotation=t;return this};Shape.prototype.getOpacity=function(){return this.opacity};Shape.prototype.setOpacity=function(t){this.opacity=Math.max(0,t);this.opacity=Math.min(1,this.opacity);return this};Shape.prototype.setStyle=function(t){this.style.copy(t);this.textNeedRelayout=true;return this};Shape.prototype.getStyle=function(){return this.style};Shape.prototype.setName=function(t){this.name=t;return this};Shape.prototype.getName=function(){return this.name};Shape.prototype.getLocaleText=function(t){return t};Shape.prototype.getLocaleInputTips=function(t){return dappGetText(t)};Shape.prototype.setNeedRelayoutText=function(){this.textNeedRelayout=true;return this};Shape.prototype.setTextAlignH=function(t){this.hTextAlign=t;return this};Shape.prototype.setTextAlignV=function(t){this.vTextAlign=t;return this};Shape.prototype.getTextAlignH=function(){var t=this.hTextAlign?this.hTextAlign:"left";return t};Shape.prototype.getTextAlignV=function(){var t=this.vTextAlign?this.vTextAlign:"top";return t};Shape.prototype.toText=function(t){if(t!==null&&t!=undefined){return t+""}else{return""}};Shape.prototype.setText=function(t){this.text=this.toText(t);this.textNeedRelayout=true;return this};Shape.prototype.setText2=function(t){this.text2=t;return this};Shape.prototype.setText3=function(t){this.text3=t;return this};Shape.prototype.getText=function(){return this.text};Shape.prototype.getApp=function(){return this.app};Shape.prototype.getView=function(){return this.view};Shape.prototype.setApp=function(t){this.app=t;return this};Shape.prototype.setView=function(t){this.view=t;return this};Shape.prototype.redrawSelf=function(){if(this.view){var t=this.getRealScale();var e=this.getPositionInView();var i={x:e.x*t,y:e.y*t,w:this.w*t,h:this.h*t};this.view.redraw(i)}return};Shape.prototype.postRedraw=function(t){if(this.view){this.view.postRedraw(t)}return};Shape.prototype.beforePropertyChanged=function(){return};Shape.prototype.afterPropertyChanged=function(){return};Shape.prototype.showProperty=function(){return};Shape.prototype.setSelectedMarkSize=function(t){this.selectedMarkSize=t;return};Shape.prototype.paint=function(t){this.paintSelf(t);if(this.near){var e=this.near.point;var i=this.getNearRange();t.beginPath();t.arc(e.x,e.y,4,0,Math.PI*2);t.fillStyle="Red";t.fill();t.beginPath();t.lineWidth=2;t.arc(e.x,e.y,i,0,Math.PI*2);t.strokeStyle="Black";t.stroke()}return};Shape.prototype.paintSelf=function(t){return};Shape.prototype.setSelected=function(t){if(t){this.selectedTime=Date.now()}if(this.selected===t){return}this.selected=t;if(this.view&&this.view.onShapeSelected){this.view.onShapeSelected(this)}return};Shape.prototype.isVisible=function(){return true};Shape.prototype.findNearPoint=function(t){var e=null;for(var i=0;i<100;i++){e=this.getNearPoint(i);if(!e){break}if(isPointInRect(e,t)){var n={shape:this};n.nearPointIndex=i;n.point={x:e.x,y:e.y};return n}}return null};Shape.prototype.dup=function(){var t=ShapeFactoryGet().createShape(this.type,C_CREATE_FOR_PROGRAM);t.fromJson(this.toJson());t.state=Shape.STAT_NORMAL;return t};Shape.prototype.hitTest=function(t){return Shape.HIT_TEST_NONE};Shape.prototype.showProperty=function(){return};Shape.prototype.onLongPress=function(t){return};Shape.prototype.onGesture=function(t){};Shape.prototype.onDoubleClick=function(t){return true};Shape.prototype.onPointerDown=function(t){this.pointerDown=true;this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.handlePointerEvent(t,Shape.EVT_POINTER_DOWN);return true};Shape.prototype.handlePointerEvent=function(t,e){return false};Shape.prototype.onPointerMove=function(t){if(this.hitTestResult){this.handlePointerEvent(t,Shape.EVT_POINTER_MOVE);return true}return false};Shape.prototype.onPointerUp=function(t){if(this.hitTestResult){this.handlePointerEvent(t,Shape.EVT_POINTER_UP);this.hitTestResult=Shape.HIT_TEST_NONE;return true}this.pointerDown=false;return false};Shape.prototype.onKeyDown=function(t){console.log("onKeyUp Widget: code="+t);return};Shape.prototype.onKeyUp=function(t){console.log("onKeyUp Widget: code="+t);return};Shape.prototype.canBeComponent=function(){return false};Shape.prototype.shouldShowContextMenu=function(){return true};Shape.prototype.toJson=function(){return null};Shape.prototype.fromJson=function(t){return this};Shape.prototype.afterApplyFormat=function(){return};Shape.prototype.applyFormat=function(t){if(!t){return}for(var e in t){var i=t[e];var n=typeof i;if(n==="function"||n==="object"||n==="undefined"){continue}if(e=="type"){continue}if(n==="number"||n==="string"||n==="boolean"){this[e]=i}}if(t.images){for(var e in t.images){var i=t.images[e];if(e==="display"){this.images[e]=i}else{var r=i.getImageSrc();this.setImage(e,r)}}}if(t.style){this.style.fromJson(t.style)}if(t.animations){this.animations=JSON.parse(t.animations);this.defaultAnimationName=t.defaultAnimationName}this.afterApplyFormat();this.textNeedRelayout=true;return};Shape.prototype.setUserMovable=function(t){this.userMovable=t;return this};Shape.prototype.setUserResizable=function(t){this.userResizable=t;return this};Shape.prototype.isUserMovable=function(){return this.userMovable&&!this.isLocked()};Shape.prototype.isUserResizable=function(){return this.userResizable};function splitText(t){t=t.replaceAll("\r\n","\n");t=t.replaceAll("\r","\n");return t.split("\n--\n")}Shape.onRestacked=function(t,e){};function restackShapeInArray(t,e){var i=0;var n=0;var r=null;var o=0;var a=null;for(var s=0;s<t.length;s++){r=t[s];if(r.selected){i++;if(!a){a=r;n=s}}}if(i>1||!a){return}o=n+e;if(o<0||o>=t.length){return}t[n]=t[o];t[o]=a;Shape.onRestacked(t,a);return}function getParentShapeOfShape(t,e){var i=t.parentShape?t.parentShape:t.container;if(!i){i=e}return i}function getParentShapeOfShapes(t){if(!t||t.length===0){return null}var e=t[0];var i=e.parentShape;for(var n=0;n<t.length;n++){var r=t[n];if(r.parentShape!=i){return null}}return i?i:e.view}Shape.prototype.getTextColor=function(t){return this.style.textColor};Shape.prototype.getBgColor=function(t){return this.style.fillColor};Shape.prototype.getLineColor=function(t){return this.style.lineColor};Shape.prototype.defaultDrawText=function(t){var e=this.getWidth(true);var i=this.getLocaleText(this.text);if(!i||this.editing){return}t.save();t.beginPath();t.lineWidth=1;t.font=this.style.getFont();t.fillStyle=this.getTextColor();t.strokeStyle=this.getLineColor();var n=i.split(/\n/);if(n.length<2){if(this.singleLineMode||t.measureText(i).width<1.2*e){this.draw1LText(t)}else{this.drawMLText(t)}}else{this.drawMLText(t)}t.restore();return};Shape.prototype.draw1LText=function(t,e){var i=this.getLocaleText(this.text);if(!i||this.editing){return}if(!this.lines){this.layoutText(t)}if(!this.lines){return}i=this.lines[0];var n=0;var r=0;var o=this.hMargin;var a=this.getWidth(true);var s=this.getTextAlignH();var h=this.getTextAlignV();var l=this.style.textU;var u=this.style.fontSize;var p=t.measureText(i).width;var c=0;var f=0;var d=Math.min(p,a);switch(h){case"middle":{r=this.h>>1;t.textBaseline="middle";if(l){f=Math.floor(r+u*.8)}break}case"bottom":{r=this.h-this.vMargin;t.textBaseline="bottom";if(l){f=r}break}default:{r=this.vMargin;t.textBaseline="top";if(l){f=Math.floor(r+u*1.5)}break}}switch(s){case"center":{n=this.w>>1;t.textAlign="center";if(l){c=Math.max(this.w-p>>1,0)}break}case"right":{n=this.w-this.hMargin;t.textAlign="right";if(l){c=Math.max(this.w-p-o,0)}break}default:{n=this.hMargin;t.textAlign="left";if(l){c=n}break}}if(l){t.moveTo(c,f);t.lineTo(c+d,f);t.stroke()}t.fillText(i,n,r,a);return p};Shape.prototype.drawMLText=function(t,e){if(!this.lines){this.layoutText(t)}if(!this.lines){return}var i=0;var n=0;var r=0;var o=0;var a=0;var s=this.vMargin;var h=this.hMargin;var l=this.getWidth(true);var u=this.getTextAlignH();var p=this.getTextAlignV();var c=this.style.textU;var f=this.style.fontSize;var d=this.getTextLineHeight();var I=this.getTextHeight();t.textBaseline="top";switch(p){case"middle":{n=this.h-I>>1;break}case"bottom":{n=this.h-I-s;break}default:{n=s;break}}n=n<0?0:n;for(var g=0;g<this.lines.length;g++){var m=this.lines[g];if(!m||m==" "){n+=f;continue}if(n+d>=this.h&&!e){break}var v=t.measureText(m).width;a=Math.min(v,l);o=Math.floor(n+(f+d)/2);switch(u){case"center":{i=this.w>>1;t.textAlign="center";if(c){r=Math.max(this.w-v>>1,0)}break}case"right":{i=this.w-h;t.textAlign="right";if(c){r=Math.max(this.w-v-h,0)}break}default:{i=h;t.textAlign="left";if(c){r=i}break}}if(c){t.moveTo(r,o);t.lineTo(r+a,o);t.stroke()}t.fillText(m,i,n,l);n+=d}return};Shape.prototype.getTextHeight=function(){var t=0;var e=this.style.fontSize;var i=this.getTextLineHeight();if(!this.text||!this.lines){return i}for(var n=0;n<this.lines.length;n++){var r=this.lines[n];if(!r||r==" "){t+=e}else{t+=i}}return t};Shape.prototype.getTextLineHeight=function(){return Math.floor(this.style.fontSize*1.5)};Shape.prototype.setTextShadow=function(t){this.textShadow=t;return this};Shape.prototype.isValid=function(){return!this.isInvalid};Shape.prototype.canCopy=function(){return true};Shape.prototype.onDestroy=function(){};Shape.prototype.onRemoved=function(t){};Shape.prototype.detachFromParent=function(){};Shape.prototype.destroy=function(){this.detachFromParent();if(this.container){this.container=null}this.app=null;this.view=null;if(this.children){this.children.clear(true);this.children=null}if(this.images){this.images=null}if(this.events){this.events=null}if(this.style){this.style=null}this.onDestroy();this.isInvalid=true;this.jsonData=null;return};Shape.prototype.isInDesignMode=function(){return false};Shape.iconShapeStyle=null;Shape.getIconShapeStyle=function(){if(!Shape.iconShapeStyle){Shape.iconShapeStyle=ShapeStyle.create();Shape.iconShapeStyle.setLineWidth(1);Shape.iconShapeStyle.setFontSize(8);Shape.iconShapeStyle.setLineColor("Black");Shape.iconShapeStyle.setFillColor("White");Shape.iconShapeStyle.setTextColor("Black")}return Shape.iconShapeStyle};Shape.defaultStyle=null;Shape.getDefaultStyle=function(){if(!Shape.defaultStyle){Shape.defaultStyle=ShapeStyle.create()}return Shape.defaultStyle};function ShapeStyle(){}ShapeStyle.prototype.getFont=function(){var t="";if(this.textI){t="italic  "}if(this.textB){t=t+"bold "}t=t+this.fontSize+'pt "'+this.fontFamily+'"';return t};ShapeStyle.prototype.setLineWidth=function(t){this.lineWidth=t>0?t:1;return};ShapeStyle.prototype.setLineColor=function(t){this.lineColor=t;return};ShapeStyle.prototype.setFillColor=function(t){this.fillColor=t;return};ShapeStyle.prototype.setTextColor=function(t){this.textColor=t;return};ShapeStyle.prototype.setFontSize=function(t){var e=Math.max(t,6);this.fontSize=e;return};ShapeStyle.prototype.setFontFamily=function(t){this.fontFamily=t?t:"serif";return};ShapeStyle.prototype.setTextB=function(t){this.textB=t;return};ShapeStyle.prototype.setTextU=function(t){this.textU=t;return};ShapeStyle.prototype.setTextI=function(t){this.textI=t;return};ShapeStyle.prototype.getStrokeStyle=function(t){return this.strokeColor};ShapeStyle.prototype.copy=function(t){var e=t.toJson();this.fromJson(e);return};ShapeStyle.prototype.toJson=function(){var t={};for(var e in this){var i=this[e];if(typeof i==="string"||typeof i==="number"||typeof i==="boolean"){t[e]=i}}return t};ShapeStyle.prototype.fromJson=function(t){for(var e in t){var i=t[e];if(e.length<4)continue;if(typeof i==="string"||typeof i==="number"||typeof i==="boolean"){this[e]=i}}return};ShapeStyle.prototype.dup=function(){var t=new ShapeStyle;t.copy(this);return t};ShapeStyle.prototype.equalTo=function(t){var e=JSON.stringify(this.toJson());var i=JSON.stringify(t.toJson());return e===i};ShapeStyle.createFromJson=function(t){var e=new ShapeStyle;e.fromJson(t);return e};ShapeStyle.create=function(){return new ShapeStyle};function RShape(){return}RShape.prototype=new Shape;RShape.prototype.MIN_SIZE=10;RShape.prototype.isRect=true;RShape.prototype.getX=function(){if(this.anchor){return this._x}else{return this._left}};RShape.prototype.getY=function(){if(this.anchor){return this._y}else{return this._top}};RShape.prototype.setX=function(t){return this.setPosition(t,this.y)};RShape.prototype.setY=function(t){return this.setPosition(this.x,t)};RShape.prototype.getLeft=function(){return this._left};RShape.prototype.getTop=function(){return this._top};RShape.prototype.setLeft=function(t){this._left=t;return this};RShape.prototype.setTop=function(t){this._top=t;return this};RShape.prototype.setLeftTop=function(t,e){this._left=t;this._top=e;return this};RShape.prototype.setPivot=function(t,e){this.pivotX=t;this.pivotY=e;return this};RShape.prototype.getPivot=function(){return{x:this.pivotX,y:this.pivotY}};RShape.prototype.onPositionChanged=function(){};RShape.prototype.getAnchorX=function(){return this.getAnchor().x};RShape.prototype.getAnchorY=function(){return this.getAnchor().y};RShape.prototype.setAnchorX=function(t){return this.setAnchor(t,this.getAnchorY())};RShape.prototype.setAnchorY=function(t){return this.setAnchor(this.getAnchorX(),t)};RShape.prototype.setAnchor=function(t,e){var i=this.getAnchor();i.x=t;i.y=e;this.pivotX=t;this.pivotY=e;this._x=this._left+this.w*t;this._y=this._top+this.h*e;return this};RShape.prototype.getAnchor=function(){if(!this.anchor){this.anchor={x:0,y:0};this._x=this._left;this._y=this._top}return this.anchor};RShape.prototype.getPosition=function(){var t={};if(!this.anchor){t.x=this._left;t.y=this._top}else{t.x=this._x;t.y=this._y}return t};RShape.prototype.setPosition=function(t,e){var i=this._x!==t||this._y!==e;this._x=t;this._y=e;if(this.anchor){var n=this._x-this.w*this.anchor.x;var r=this._y-this.h*this.anchor.y;this.setLeftTop(n,r)}else{this.setLeftTop(this._x,this._y)}if(i){this.onPositionChanged()}return this};RShape.prototype.realResize=RShape.prototype.setSize=function(t,e){if(this.w!==t||this.h!==e){var i=Math.max(Math.round(t),4);var n=Math.max(Math.round(e),4);if(this.anchor){this._left=this._x-i*this.anchor.x;this._top=this._y-n*this.anchor.y}this.w=i;this.h=n;this.textNeedRelayout=true}return this};RShape.prototype.initRShape=function(t,e,i,n,r){this.initShape(t,e,i,n,r);this.w=i;this.h=i;this.opacity=1;this.hMargin=0;this.vMargin=0;this.rotation=0;this.defWidth=i;this.defHeight=i;this.enable=true;this.visible=true;this.events={};this.pivotX=.5;this.pivotY=.5;this.text="";this.pointerDown=false;this.lastPosition={x:0,y:0};this.pointerDownPosition={x:0,y:0};this.setScale(1,1);if(i===0||n===0){this.w=this.MIN_SIZE;this.h=this.MIN_SIZE;this.setState(Shape.STAT_CREATING_0)}return};RShape.prototype.onPointerDown=function(t){if(!this.enable&&!this.isInDesignMode()){console.log(this.name+" is disable, ignore pointer events.");return}this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y;this.postRedraw();return this.onPointerDownNormal(t)};RShape.prototype.onPointerMove=function(t){if(!this.enable&&!this.isInDesignMode()){console.log("Ignore pointer event because this.enable is false.");return}if(this.isLocked()){return false}return this.onPointerMoveNormal(t)};RShape.prototype.onPointerUp=function(t){if(!this.enable&&!this.isInDesignMode()){console.log("Ignore pointer event because this.enable is false.");return}var e=this.onPointerUpNormal(t);this.pointerDown=false;this.postRedraw();return e};RShape.prototype.onPointerDownNormal=function(t){this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.pointerDown=true;this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.handlePointerEvent(t,1);return true};RShape.prototype.onPointerMoveNormal=function(t){if(this.hitTestResult){this.handlePointerEvent(t,0);return true}return false};RShape.prototype.onPointerUpNormal=function(t){if(this.hitTestResult){this.handlePointerEvent(t,-1);this.hitTestResult=Shape.HIT_TEST_NONE;return true}return false};RShape.prototype.fixSize=function(){if(this.w<this.MIN_SIZE){this.w=this.MIN_SIZE}if(this.h<this.MIN_SIZE){this.h=this.MIN_SIZE}if(this.wMin&&this.w<this.wMin){this.w=this.wMin}if(this.wMax&&this.w>this.wMax){this.w=this.wMax}if(this.hMax&&this.h>this.hMax){this.h=this.hMax}if(this.hMin&&this.h<this.hMin){this.h=this.hMin}if(this.whRadio){if(this.whRadio>1){this.h=Math.floor(this.w/this.whRadio)}else{this.w=Math.floor(this.h*this.whRadio)}}if(this.parentShape){this.parentShape.fixChildSize(this)}return};RShape.prototype.fixChildSize=function(t){var e=this.w;var i=this.h;if(t.x+t.w>e){t.w=e-t.x}if(t.y+t.h>i){t.h=i-t.y}return};RShape.prototype.setDefSize=function(t,e){this.defWidth=t;this.defHeight=e;this.w=t;this.h=e;return this};RShape.prototype.setSizeLimit=function(t,e,i,n,r){this.wMin=t;this.wMax=i;this.hMin=e;this.hMax=n;this.whRadio=r;return this};RShape.prototype.resizeDelta=function(t,e){this.resize(this.w+t,this.h+e);return};RShape.prototype.resize=function(t,e){if(this.w!==t||this.h!==e){this.setSize(t,e);if(!this.isIcon){this.onSized();this.fixSize()}}return this};RShape.prototype.translate=function(t){t.translate(this._left,this._top);return};RShape.prototype.setClipRect=function(t,e,i,n){if(arguments.length>3){var r={};r.x=t;r.y=e;r.w=i;r.h=n;this.clipInfo=r}else{this.clipInfo=null}return this};RShape.prototype.setClipCircle=function(t,e,i){if(arguments.length>2){circle={};circle.x=t;circle.y=e;circle.r=i;this.clipInfo=circle}else{this.clipInfo=null}return this};RShape.prototype.onClip=function(t){if(this.clipInfo){var e=this.clipInfo;t.beginPath();if(e.r){t.arc(e.x,e.y,e.r,0,Math.PI*2)}else{t.rect(e.x,e.y,e.w,e.h)}t.clip();t.beginPath()}};RShape.prototype.applyScale=function(t){var e=this.getScaleX();var i=this.getScaleY();var n=this.w*this.pivotX;var r=this.h*this.pivotY;t.translate(n,r);t.scale(e,i);t.translate(-n,-r)};RShape.prototype.applyRotation=function(t){if(Math.abs(this.rotation)>1e-4){var e=this.w*this.pivotX;var i=this.h*this.pivotY;t.translate(e,i);t.rotate(this.rotation);t.translate(-e,-i)}};RShape.prototype.applyTransform=function(t){t.globalAlpha*=this.opacity;if(this.offsetX){t.translate(this.offsetX,0)}if(this.offsetY){t.translate(0,this.offsetY)}this.applyRotation(t);this.applyScale(t);return};RShape.prototype.isPointIn=function(t,e){return isPointInRect(e,this)};RShape.prototype.drawImage=function(t){return};RShape.prototype.paintShape=function(t){t.rect(0,0,this.w,this.h);return};RShape.prototype.setTextNeedRelayout=function(t){this.textNeedRelayout=t;return this};RShape.prototype.layoutText=function(t){if(!this.textNeedRelayout||this.textType===Shape.TEXT_NONE){return}t.font=this.style.getFont();var e=this.vMargin?this.vMargin:10;var i=this.w-2*e;if(i>0){this.lines=layoutText(t,this.style.fontSize,this.getLocaleText(this.text),i)}else{this.lines=[]}this.textNeedRelayout=false;return};RShape.prototype.drawTextUnderLine=function(t,e,i,n){var r=0;var o=0;var a=0;var s=0;if(!this.style.textU){return}s=t.measureText(n).width;if(this.textBaseline==="middle"){a=this.style.fontSize/2;if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}else if(this.textBaseline==="top"){a=this.style.fontSize;if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}else{if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}o=i+a;t.moveTo(r,o);t.lineTo(r+s,o);t.lineWidth=1;t.stroke();return};RShape.prototype.needDrawTextTips=function(){return true};RShape.prototype.setInputTips=function(t){this.inputTips=t;return this};RShape.prototype.getTextTipsPosition=function(){var t={};t.x=this.getWidth()>>1;t.y=this.getHeight()>>1;t.textAlign="center";t.textBaseline="middle";return t};RShape.prototype.drawTextTips=function(t){if(this.text||this.isIcon||this.w<120||this.h<20||this.editing){return}var e=this.getTextTipsPosition();var i=e.x;var n=e.y;t.textAlign=e.textAlign;t.textBaseline=e.textBaseline;t.font=this.style.getFont();t.fillStyle="#E0E0E0";if(this.inputTips){t.fillText(this.getLocaleInputTips(this.inputTips),i,n,this.getWidth())}return};RShape.prototype.getOneLineText=function(t,e){var i="";var n=this.getWidth(true);if(t.measureText(e).width<=n){return e}for(var r=0;r<e.length;r++){var o=e[r];n=n-t.measureText(o).width;if(n<0){break}i=i+o}return i};RShape.prototype.setMargin=function(t,e){this.vMargin=Math.floor(Math.min(t,.5*this.w));this.hMargin=Math.floor(Math.min(e,.5*this.h));return this};RShape.prototype.getVMargin=function(){return this.vMargin?this.vMargin:0};RShape.prototype.getHMargin=function(){return this.hMargin?this.hMargin:0};RShape.prototype.setWidth=function(t){return this.setSize(t,this.h)};RShape.prototype.setHeight=function(t){return this.setSize(this.w,t)};RShape.prototype.getWidth=function(t){if(t){return this.w-2*this.getHMargin()}else{return this.w}};RShape.prototype.getHeight=function(t){if(t){return this.h-2*this.getVMargin()}else{return this.h}};RShape.prototype.drawText=function(t){this.defaultDrawText(t);return};RShape.prototype.prepareStyle=function(t){var e=this.style;t.lineWidth=e.lineWidth;t.strokeStyle=e.lineColor;t.fillStyle=e.fillColor;return};RShape.prototype.resetStyle=function(t){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=0;t.fillStyle="White";t.beginPath();return};RShape.prototype.strokeFill=function(t){if(this.style.enableShadow||isOldIE()){if(t.lineWidth>=1){if(!this.isStrokeColorTransparent()){t.stroke()}}if(!this.isFillColorTransparent()){t.fill()}}else{if(!this.isFillColorTransparent()){t.fill()}if(t.lineWidth>=1){if(!this.isStrokeColorTransparent()){t.stroke()}}}return};RShape.prototype.paintSelf=function(t){return};RShape.prototype.getCanvasContext2D=function(){return this.view.getCanvas2D()};RShape.prototype.getHitTestCanavs=function(){var t=this.view.getCanvas2D();if(CantkRT.isCantkRTCordova()){return t.getCanvasRenderingContext2D("2d")}else{return t}};RShape.prototype.hitTest=function(t){var e=Shape.HIT_TEST_NONE;if(!this.enable&&!this.isInDesignMode()){return e}var i=this;var n=this.getHitTestCanavs();function r(t){i.translate(t);i.applyTransform(t)}if(this.isPointInMatrix({x:0,y:0,w:this.w,h:this.h},t,r)){e=Shape.HIT_TEST_MM}return e};RShape.prototype.isLocked=function(){return false};RShape.prototype.lock=function(){this.locked=true;return this};RShape.prototype.unlock=function(){this.locked=false;return this};RShape.prototype.execMoveResize=function(t,e,i,n){if(window.MoveResizeCommand){this.exec(new MoveResizeCommand(this,t,e,i,n))}else{if(t||t===0){this.setLeft(t)}if(e||e===0){this.setTop(e)}if(i||i===0){this.w=i}if(n||n===0){this.h=n}}return};RShape.prototype.onUserMoving=function(){};RShape.prototype.onUserResizing=function(){};RShape.prototype.onUserRotating=function(){};RShape.prototype.handlePointerEvent=function(t,e){if(e===Shape.EVT_POINTER_DOWN){this.saveLeft=this.getLeft();this.saveTop=this.getTop();this.saveW=this.w;this.saveH=this.h;this.saveRotation=this.rotation;return}var i=this.saveW;var n=this.saveH;var r=t.x-this.pointerDownPosition.x;var o=t.y-this.pointerDownPosition.y;var a=0;var s=0;var h=i;var l=n;switch(this.hitTestResult){case Shape.HIT_TEST_TL:{a=r;s=o;h=i-r;l=n-o;break}case Shape.HIT_TEST_TM:{s=o;l=n-o;break}case Shape.HIT_TEST_TR:{a=0;s=o;h=i+r;l=n-o;break}case Shape.HIT_TEST_ML:{a=r;h=i-r;break}case Shape.HIT_TEST_MR:{h=i+r;break}case Shape.HIT_TEST_BL:{a=r;h=i-r;l=n+o;break}case Shape.HIT_TEST_BM:{l=n+o;break}case Shape.HIT_TEST_BR:{h=i+r;l=n+o;break}case Shape.HIT_TEST_MOVE:case Shape.HIT_TEST_MM:{a=r;s=o;break}case Shape.HIT_TEST_ROTATION:{var u=(this.w>>1)+this.getLeft();var p=(this.h>>1)+this.getTop();var c=Math.lineAngle({x:u,y:p},t)+Math.PI*.5;if(c>Math.PI*2){c=c-Math.PI*2}this.setRotation(c);this.onUserRotating();if(e===Shape.EVT_POINTER_UP){var f=this.rotation;this.rotation=this.saveRotation;this.exec(AttributeCommand.create(this,"rotation",null,f))}break}default:break}if(e===Shape.EVT_POINTER_UP){if(!this.isUserMovable()){this.setLeftTop(this.saveLeft,this.saveTop)}if(!this.isUserResizable()){this.w=i;this.h=n}var d=this.w;var I=this.h;var g=this.getLeft();var m=this.getTop();if(g!==this.saveLeft||m!==this.saveTop||d!==i||I!==n){this.w=i;this.h=n;this.setLeftTop(this.saveLeft,this.saveTop);g=g===this.saveLeft?null:Math.round(g);m=m===this.saveTop?null:Math.round(m);d=d===i?null:Math.round(d);I=I===n?null:Math.round(I);this.execMoveResize(g,m,d,I);this.onUserMoved();this.onUserResized()}}else{if(a||s){if(this.isUserMovable()){this.setLeftTop(Math.round(this.saveLeft+a),Math.round(this.saveTop+s));this.onUserMoving()}}if(i!==h||n!==l){if(this.isUserResizable()){this.w=Math.max(Math.round(h),this.MIN_SIZE);this.h=Math.max(Math.round(l),this.MIN_SIZE);this.onUserResizing()}}}if(this.hitTestResult===Shape.HIT_TEST_HANDLE){r=t.x-this.lastPosition.x;o=t.y-this.lastPosition.y;this.moveHandle(r,o)}this.postRedraw();this.lastPosition.x=t.x;this.lastPosition.y=t.y;return true};RShape.prototype.onKeyDown=function(t){return};RShape.prototype.onKeyUp=function(t){return};RShape.prototype.toJson=function(){var t={};return this.doToJson(t)};RShape.saveProps=["type","name","uid","z","w","h","pivotX","pivotY","rotation","opacity","hMargin","vMargin","scaleX","scaleY","spacer","roundRadius","runtimeVisible","enable","visible","text","iconVMargin","iconHMargin","locked"];RShape.prototype.propsToJson=function(t,e){var i=e.length;for(var n=0;n<i;n++){var r=e[n];var o=this[r];if(o!==undefined){t[r]=o}}return this;
};RShape.prototype.propsFromJson=function(t,e){var i=e.length;for(var n=0;n<i;n++){var r=e[n];var o=t[r];if(o!==undefined){this[r]=o}}return this};RShape.prototype.doToJson=function(t){this.propsToJson(t,RShape.saveProps);t.x=this.left;t.y=this.top;t.style=this.style.toJson();return t};RShape.prototype.onFromJsonDone=function(t){};RShape.prototype.fromJson=function(t){this.isUnpacking=true;this.doFromJson(t);this.onFromJsonDone(t);this.isUnpacking=false;return this};RShape.prototype.doFromJson=function(t){this.textNeedRelayout=true;this.state=Shape.STAT_NORMAL;this.propsFromJson(t,RShape.saveProps);if(t.x!==undefined){this.left=t.x}if(t.y!==undefined){this.top=t.y}if(t.docURL!==undefined&&t.docURL.length>0){this.docURL=t.docURL}this.setText(t.text);this.setEnable(t.enable);this.setVisible(t.visible!==false);this.style.fromJson(t.style);return};RShape.prototype.setImage=function(t){if(t===this.imageUrl){return}this.imageUrl=t;this.image=new WImage(t);return this};RShape.prototype.asIcon=function(){this.setSize(36,36);if(!this.isIcon){this.setStyle(Shape.getIconShapeStyle())}this.isIcon=true;return};RShape.prototype.showProperty=function(){var t=this.getApp();if(t){t.showRShapePropertyDialog(this)}return};RShape.prototype.getMoveDeltaX=function(){return this.view?this.view.getMoveDeltaX():0};RShape.prototype.getMoveDeltaY=function(){return this.view?this.view.getMoveDeltaY():0};RShape.prototype.getMoveAbsDeltaX=function(){return this.view?this.view.getMoveAbsDeltaX():0};RShape.prototype.getMoveAbsDeltaY=function(){return this.view?this.view.getMoveAbsDeltaY():0};RShape.prototype.setRoundRadius=function(t){this.roundRadius=t;return this};RShape.prototype.setFillColor=function(t){this.style.setFillColor(t);return this};RShape.prototype.setLineColor=function(t){this.style.setLineColor(t);return this};RShape.prototype.setTextColor=function(t){this.style.setTextColor(t);return this};RShape.prototype.getFillColor=function(){return this.style.fillColor};RShape.prototype.getLineColor=function(){return this.style.lineColor};RShape.prototype.getTextColor=function(){return this.style.textColor};Object.defineProperty(RShape.prototype,"x",{get:function(){return this.getX()},set:function(t){this.setX(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"y",{get:function(){return this.getY()},set:function(t){this.setY(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"left",{get:function(){return this.getLeft()},set:function(t){this.setLeft(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"top",{get:function(){return this.getTop()},set:function(t){this.setTop(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"width",{get:function(){return this.getWidth()},set:function(t){this.setWidth(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"height",{get:function(){return this.getHeight()},set:function(t){this.setHeight(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"anchorX",{get:function(){return this.getAnchorX()},set:function(t){this.setAnchorX(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"anchorY",{get:function(){return this.getAnchorY()},set:function(t){this.setAnchorY(t)},enumerable:true,configurable:true});function RShapeInit(t,e){t.initRShape(0,0,40,40,e);return t}var C_CREATE_FOR_USER=0;var C_CREATE_FOR_ICON=1;var C_CREATE_FOR_PROGRAM=2;function ShapeCreator(t,e,i,n){this.type=t;this.icon=i;this.name=e;this.visible=n;this.isVisibleToUser=function(){return this.visible};this.getID=function(){return this.type};this.getIcon=function(){return this.icon};this.getName=function(){return this.name};this.createIconShape=function(){if(!this.iconShape){this.iconShape=this.createShape(C_CREATE_FOR_ICON);this.iconShape.initIconShape()}return this.iconShape};this.createShape=function(t){return null};return}function ShapeFactory(){this.defaultCategory=null;this.recentUsed=[];this.creators=[];this.categories={};this.categoryNames=[];this.diagramTypes=[];this.listeners=[];ShapeFactory.CATEGORY_RECENT_USED="Recent Used";ShapeFactory.CATEGORY_USER_COMPONENTS="User Component";ShapeFactory.CATEGORY_USER="User";ShapeFactory.CATEGORY_GAME="Game";ShapeFactory.CATEGORY_ORGANIZATION="Organization";this.setDefaultCategory=function(t){this.defaultCategory=t;return};this.getDiagramTypes=function(){return this.diagramTypes};this.addDiagramType=function(t,e){var i={name:t,defaultCategory:e};this.diagramTypes.push(i);return};this.removeCategoryName=function(t){this.categoryNames.remove(t);return};this.removeShapeCreator=function(t,e){var i=this.find(t);var n=this.categories[e];if(i){this.creators.remove(i);if(n){n.remove(i);this.notifyChanged("remove",e,i)}}return};this.isPlacehodler=function(t){return t==="---"};this.isUserComponents=function(t){return t===ShapeFactory.CATEGORY_USER_COMPONENTS};this.addPlaceholder=function(){this.categoryNames.push("---");return};this.loadRecentUsedShapeCreators=function(){var t=WebStorage.get("recentUsed");var e=t?JSON.parse(t):[];for(var i=0;i<e.length;i++){var n=e[i];var r=this.find(n);if(r){this.addShapeCreator(r,ShapeFactory.CATEGORY_RECENT_USED);this.recentUsed.push(n)}}return};this.addRecentUsedShapeCreator=function(t){var e=this.find(t);if(e){this.recentUsed.remove(t);this.recentUsed.push(t);if(this.recentUsed.length>10){this.recentUsed.shift()}WebStorage.set("recentUsed",JSON.stringify(this.recentUsed));this.addShapeCreator(e,ShapeFactory.CATEGORY_RECENT_USED)}};this.addShapeCreator=function(t,e){this.notifyChanged("add",e,t);if(e!=ShapeFactory.CATEGORY_RECENT_USED){this.creators.push(t)}if(e){if(!this.defaultCategory){this.setDefaultCategory(e)}if(!this.categories[e]){this.categories[e]=[];if(e==ShapeFactory.CATEGORY_RECENT_USED){this.categoryNames.unshift(e)}else{this.categoryNames.push(e)}}this.categories[e].remove(t);if(e==ShapeFactory.CATEGORY_RECENT_USED){this.categories[e].unshift(t)}else{this.categories[e].push(t)}}return};this.getCategoryNames=function(){return this.categoryNames};this.getDefaultCategory=function(){return this.categories[this.defaultCategory]};this.getByCategory=function(t){return this.categories[t]};this.find=function(t){for(var e=0;e<this.creators.length;e++){var i=this.creators[e];if(i.getID()===t){return i}}return null};this.createShapeByUser=function(t,e){return this.createShape(t,C_CREATE_FOR_USER,e)};this.createShapeByProgram=function(t,e){return this.createShape(t,C_CREATE_FOR_PROGRAM,e)};this.createShape=function(t,e,i){if(!t){return null}var n=this.find(t);if(n){var r=n.createShape(e);if(e===C_CREATE_FOR_USER){r.initPanelShape()}return r}console.log("not found type "+t+", create ui-unkown instead.");if(!i){n=this.find("ui-unkown");if(n){return n.createShape(e)}return null}};this.addListener=function(t){this.listeners.push(t);return this};this.removeListener=function(t){this.listeners.remove(t);return this};this.notifyChanged=function(t,e,i){var n=this.listeners;for(var r=0;r<n.length;r++){var o=n[r];if(o){o(t,e,i)}}return};return}ShapeFactory.instance=null;ShapeFactory.getInstance=function(){if(!ShapeFactory.instance){ShapeFactory.instance=new ShapeFactory;setTimeout(function(){ShapeFactory.instance.loadRecentUsedShapeCreators()},2e3)}return ShapeFactory.instance};function ShapeFactoryGet(){return ShapeFactory.getInstance()}function dappSetDefaultCategory(t){return ShapeFactory.getInstance().setDefaultCategory(t)}function cantkRegShapeCreator(t,e){return ShapeFactory.getInstance().addShapeCreator(t,e)}function TView(){}TView.prototype=new WWidget;TView.prototype.init=function(t,e,i,n,r){WWidget.prototype.init.call(this,t,e,i,n,r);this.scale=1;this.wmRect={};this.lastPointerPosition={x:0,y:0};this.pointerDownPosition={x:0,y:0};return this};TView.prototype.setDoc=function(t){this.doc=t;return this};TView.prototype.loadJson=function(t){return this.doc.loadJson(t)};TView.prototype.loadString=function(t){return this.doc.loadString(t)};TView.prototype.loadURL=function(t){return this.doc.loadURL(t)};TView.prototype.getDeviceConfig=function(){return this.doc.getDeviceConfig()};TView.prototype.getWindowManager=function(){return this.doc.getWindowManager()};TView.prototype.getCurrentWindow=function(){return this.doc.getCurrentWindow()};TView.prototype.getMetaInfo=TView.prototype.getMeta=function(){return this.doc.getMeta()};TView.prototype.getMoveDeltaX=function(){return this.moveDeltaX};TView.prototype.getMoveDeltaY=function(){return this.moveDeltaY};TView.prototype.getMoveAbsDeltaX=function(){return this.moveAbsDeltaX};TView.prototype.getMoveAbsDeltaY=function(){return this.moveAbsDeltaY};TView.prototype.updateLastPointerPoint=function(t,e){if(e){this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y}this.moveDeltaX=t.x-this.lastPointerPosition.x;this.moveDeltaY=t.y-this.lastPointerPosition.y;this.moveAbsDeltaX=t.x-this.pointerDownPosition.x;this.moveAbsDeltaY=t.y-this.pointerDownPosition.y;this.lastPointerPosition.x=t.x;this.lastPointerPosition.y=t.y;return};TView.prototype.autoScale=function(){var t=this.getWindowManager();if(!t)return;var e=1;var i=this.getWidth();var n=this.getHeight();if(t.w<t.h){e=n/(t.h+100)}else{e=i/(t.w+100)}if(e>1){e=1}this.zoomTo(e);return};TView.prototype.getScale=function(){return this.scale};TView.prototype.onScaled=function(t){return};TView.prototype.zoomTo=TView.prototype.setScale=function(t){this.scale=Math.min(2,Math.max(.5,Math.round(t*10)/10));this.onScaled(this.scale);return this};TView.prototype.zoomIn=function(){return this.zoomTo(this.scale*1.2)};TView.prototype.zoomOut=function(){return this.zoomTo(this.scale*.8)};TView.prototype.getWmRect=function(){var t=this.wmRect;var e=this.getWindowManager();if(e){var i=this.getWidth();var n=this.getHeight();t.w=e.w*this.scale;t.h=e.h*this.scale;t.x=i-t.w>>1;t.y=n-t.h>>1}else{t.x=0;t.y=0;t.w=0;t.h=0}return t};TView.prototype.paintSelf=function(t){var e=this.getWidth();var i=this.getHeight();t.save();t.beginPath();t.rect(0,0,e,i);t.clip();t.beginPath();var n=this.getWindowManager();if(n){var r=this.getWmRect();t.translate(r.x,r.y);t.scale(this.scale,this.scale);n.setLeftTop(0,0);n.paintSelf(t)}t.restore();return};TView.prototype.translatePointToWm=function(t){var e=this.getWmRect();var i=this.translatePoint(t);var n={x:i.x-e.x,y:i.y-e.y};n.x=n.x/this.scale;n.y=n.y/this.scale;return n};TView.prototype.translatePointToView=function(t){var e={x:t.x,y:t.y};var i=this.getWindowManager();e.x+=i.getX();e.y+=i.getY();return e};TView.prototype.onDoubleClick=function(t){this.updateLastPointerPoint(t,true);WWidget.prototype.onDoubleClick.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){var i=this.translatePointToWm(t);e.onDoubleClick(i)}}return};TView.prototype.onPointerDown=function(t){this.updateLastPointerPoint(t,true);WWidget.prototype.onPointerDown.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){var i=this.translatePointToWm(t);e.onPointerDown(i)}}return};TView.prototype.onPointerMove=function(t){this.updateLastPointerPoint(t);WWidget.prototype.onPointerMove.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){var i=this.translatePointToWm(t);e.onPointerMove(i)}}return};TView.prototype.onPointerUp=function(t){WWidget.prototype.onPointerUp.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){var i=this.translatePointToWm(t);e.onPointerUp(i)}}return};TView.prototype.onKeyDown=function(t){WWidget.prototype.onKeyDown.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){e.onKeyDown(t)}}return};TView.prototype.onKeyUp=function(t){WWidget.prototype.onKeyUp.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){e.onKeyUp(t)}}return};TView.prototype.detectDeviceConfig=function(){return this.doc.detectDeviceConfig()};function TDocument(){}TDocument.magic="cantk";TDocument.prototype.loadURL=function(t){httpGetJSON(t,this.loadJson.bind(this));return this};TDocument.prototype.loadString=function(t){try{var e=JSON.parse(t);this.loadJson(e)}catch(i){console.log("loadString:"+i.message)}return this};TDocument.prototype.getEmptyDoc=function(){var t={};t.version=2;t.magic=TDocument.magic;return t};TDocument.prototype.getLocales=function(){if(!this.doc.locales){this.doc.locales={"default":{},en:{},zh:{}}}return this.doc.locales};TDocument.prototype.getAssetsConfig=function(){var t=this.getMeta();return t.assetsConfig||TDocument.getDefaultAssetsConfig()};TDocument.prototype.getAssetsConfigStr=function(){var t=this.getAssetsConfig();return JSON.stringify(t,null,"	")};TDocument.prototype.setAssetsConfigStr=function(t){try{var e=JSON.parse(t);this.setAssetsConfig(e)}catch(i){console.log("setAssetsConfigStr:"+i.message)}return this};TDocument.prototype.setAssetsConfig=function(t){var e=this.getMeta();e.assetsConfig=t;return this};TDocument.getDefaultAssetsConfig=function(){if(!TDocument.defaultAssetsConfig){var t={};t.assets={};t.assets.sizes=["1280x800","480x800"];t.assets.densities=["hdpi","xhdpi"];t.assets.languages=["en","zh"];t.design={};t.design.size="480x800";t.design.density="hdpi";t.design.language="en";t.map={};t.map.size={"1280x720":"480x800","480x800":"480x800"};t.map.density={ldpi:"hdpi",mdpi:"hdpi",xhdpi:"hdpi",xxhdpi:"hdpi"};t.map.language={en:"en",zh:"en"};TDocument.defaultAssetsConfig=t}return TDocument.defaultAssetsConfig};TDocument.prototype.setLocales=function(t){this.doc.locales=t;return this};TDocument.prototype.getMetaInfo=TDocument.prototype.getMeta=function(){return this.doc.meta};TDocument.prototype.getDocID=function(){return this.doc.docid};TDocument.prototype.getDeviceConfig=function(){return this.wm.deviceConfig};TDocument.prototype.loadV1=function(t){if(!t.pages||!t.pages[0].shapes||!t.pages[0].shapes[0].children){return this}var e=this.getEmptyDoc();e.meta=t.meta;e.docid=t.docid;var i=t.pages[0].shapes[0];function n(t){if(t.type==="ui-window-manager"){e.wm=t;return}if(t.children){var i=t.children.length;for(var r=0;r<i;r++){var o=t.children[r];n(o)}}}n(i);e.deviceConfig=i.config;this.loadV2(e);return};TDocument.prototype.createWindowManager=function(t){var e=ShapeFactory.getInstance();var i=e.createShapeByProgram(t.wm.type);i.fromJson(t.wm);i.deviceConfig=t.deviceConfig;return i};TDocument.prototype.onBeforeLoad=function(t){};TDocument.prototype.loadV2=function(t){this.doc=t;this.onBeforeLoad(t);this.wm=this.createWindowManager(t);var e=this.getMeta();if(e&&e.general){document.title=e.general.appname}if(e&&e.extfonts){ResLoader.loadFonts(e.extfonts)}var i=["soundMusicAutoPlay","soundMusicLoop","soundMusicVolume","soundMusicURLs","soundEffectsEnalbe","soundEffectVolume","soundEffectURLs"];i.forEach(function(e){if(e in t.wm){this.wm[e]=t.wm[e]}},this);var n=this.wm;if(e&&e.soundConfig){var i=["soundMusicAutoPlay","soundMusicLoop","soundMusicVolume","soundMusicURLs","soundEffectsEnalbe","soundEffectVolume","soundEffectURLs"];i.forEach(function(t){n[t]=e.soundConfig[t]});n.setSoundMusicVolume(n.soundMusicVolume);n.setSoundEffectVolume(n.soundEffectVolume)}this.onLoad();return};TDocument.prototype.loadJson=function(t){if(!t)return this;if(t.magic==="drawapps"){this.loadV1(t)}else if(t.magic===TDocument.magic){this.loadV2(t)}else if(t.code===302){window.location.href=t.data}else{console.log("invalid json")}return this};TDocument.prototype.getWindowManager=function(){return this.wm};TDocument.prototype.getCurrentWindow=function(){return this.wm?this.wm.getCurrentWindow():null};TDocument.prototype.detectDeviceConfig=function(){if(this.detectedDeviceConfig){return this.detectedDeviceConfig}var t={version:4};if(isAndroid()){t.platform="android"}else if(isIPhone()||isIPad()){t.platform="iphone"}else if(isFirefoxOS()){t.platform="firefox"}else if(isWinPhone()){t.platform="winphone"}else if(isTizen()){t.platform="tizen"}else{t.platform="android"}if(window.devicePixelRatio>2.2){t.lcdDensity="xxhdpi"}else if(window.devicePixelRatio>1.5){t.lcdDensity="xhdpi"}else if(window.devicePixelRatio>1.1){t.lcdDensity="hdpi"}else if(window.devicePixelRatio>.8){t.lcdDensity="mdpi"}else if(!window.devicePixelRatio){var e=Math.min(window.orgViewPort.width,window.orgViewPort.height);if(e>600){t.lcdDensity="xhdpi"}else{t.lcdDensity="hdpi"}}else{t.lcdDensity="ldpi"}if(isFirefoxOS()){t.lcdDensity="mdpi"}if(!isMobile()){t.lcdDensity="hdpi"}this.detectedDeviceConfig=t;return t};function TRuntimeView(){}TRuntimeView.prototype=new TView;TRuntimeView.prototype.init=function(t,e,i,n,r,o){this.app=o;this.type="app-view";TView.prototype.init.call(this,t,e,i,n,r);this.preview=o.preview;this.setDoc(new TRuntimeDocument);this.doc.onLoad=this.onLoad.bind(this);WWindowManager.onMultiTouch=this.onMultiTouch.bind(this);WWindowManager.instance.drawWindows=this.paintSelf.bind(this);return this};TRuntimeView.prototype.onMultiTouch=function(t,e,i){var n=this.getWindowManager();if(n){n.onMultiTouch(t,e,i)}};TRuntimeView.prototype.resizeForFixWidth=function(t){var e=cantkGetViewPort();var i=t.w/e.width;var n=t.w;var r=e.height*i;var o=e.width;var a=e.height;this.app.resizeWin(n,r);this.app.resizeCanvas(n,r,0,0,o,a);WWindowManager.setInputScale(i,i);t.setSize(n,r);t.relayout()};TRuntimeView.prototype.resizeForFixHeight=function(t){var e=cantkGetViewPort();var i=t.h/e.height;var n=t.h;var r=e.width*i;var o=e.width;var a=e.height;this.app.resizeWin(r,n);this.app.resizeCanvas(r,n,0,0,o,a);WWindowManager.setInputScale(i,i);t.setSize(r,n);t.relayout()};TRuntimeView.prototype.resizeForFixResolution=function(t){var e=cantkGetViewPort();var i=t.w/e.width;var n=t.h/e.height;var r=Math.max(i,n);var o=r*e.width;var a=r*e.height;var s=e.width;var h=e.height;var l=o-t.w>>1;var u=a-t.h>>1;t.setLeftTop(l,u);this.app.resizeWin(o,a);this.app.resizeCanvas(o,a,0,0,s,h);WWindowManager.setInputScale(r,r);t.relayout()};TRuntimeView.prototype.translatePointToWm=function(t){return t};TRuntimeView.prototype.resizeForAuto=function(t){var e=cantkGetViewPort();t.setSize(e.width,e.height);t.relayout()};TRuntimeView.prototype.adjustWMSizePositionPreview=function(t){var e=cantkGetViewPort();var i=t.w;var n=t.h;var r=Math.min(1,Math.min(e.width/i,e.height/n));var o=i*r;var a=n*r;var s=e.width-o>>1;var h=e.height-a>>1;t.setLeftTop(0,0);this.app.resizeWin(i,n);this.app.resizeCanvas(i,n,s,h,o,a);WWindowManager.setInputOffset(s,h);WWindowManager.setInputScale(1/r,1/r);t.relayout()};TRuntimeView.prototype.adjustWMSizePositionRun=function(t){var e=this.getMeta();var i=e.general;var n=i.orientation;t.forcePortrait=false;t.forceLandscape=false;var r=this.designWidth;var o=this.designHeight;if(n==="landscape"&&r>o){t.forceLandscape=true}else if(n==="portrait"&&o>r){t.forcePortrait=true}t.screenScaleMode=i.screenscale;t.setLeftTop(0,0);switch(t.screenScaleMode){case"fix-width":{this.resizeForFixWidth(t);break}case"fix-height":{this.resizeForFixHeight(t);break}case"fix-resolution":{this.resizeForFixResolution(t);break}default:{this.resizeForAuto(t);break}}return};TRuntimeView.prototype.adjustWMSizePosition=function(){var t=this.getWindowManager();if(this.preview){return this.adjustWMSizePositionPreview(t)}else{return this.adjustWMSizePositionRun(t)}};TRuntimeView.prototype.onLoad=function(){var t=this.getWindowManager();var e=this.getMeta();if(e.general.useWebGL){WWindowManager.setCanvasContextName("2d-webgl")}if(window.cantkInitWindow!==undefined){t.setInitWindow(window.cantkInitWindow);console.log("window.cantkInitWindow:"+window.cantkInitWindow)}t.setView(this);t.setApp(this.app);t.setMode(Shape.MODE_RUNNING,true);this.designWidth=t.w;this.designHeight=t.h;this.adjustWMSizePosition();this.run()};TRuntimeView.prototype.paintLoading=function(t){};TRuntimeView.prototype.getViewScale=function(){return 1};TRuntimeView.prototype.paintSelf=function(t){var e=this.getWindowManager();if(!e){this.paintLoading(t);return}t.save();e.paint(t);t.restore();var i=e.x;var n=e.y;var r=e.w;var o=e.h;var a=this.rect.w;var s=this.rect.h;t.beginPath();if(n>0){t.rect(0,0,a,n)}if(i>0){t.rect(0,0,i,s)}var h=i+r;var l=a-h;if(l>0){t.rect(h,0,l,s)}var u=n+o;var p=s-u;if(p>0){t.rect(0,u,a,p)}if(n>0||i>0||l>0||p>0){t.fillStyle=e.style.fillColor;t.fill()}return};TRuntimeView.prototype.onGesture=function(t){var e=wm.getCurrentWindow();e.onGesture(t);return};TRuntimeView.prototype.getAppInfo=function(){var t=this.getMetaInfo();return t.general};TRuntimeView.prototype.onLoadUserScriptsDone=function(){var t=this.getAppInfo();HolaSDK.init(t.appid,false);console.log("TRuntimeView.prototype.onLoadUserScriptsDone.")};TRuntimeView.prototype.loadUserScripts=function(t){if(t){var e=t.extlibs;var i=window.location.href.indexOf("appid=preview")>0;if(!e){e=[]}if(e.length>0){var n=[];var r=[];e.forEach(function(e){if(e.indexOf("read.php?")>0&&e.indexOf("/libs/")>0){var i=t.docSavedTime?t.docSavedTime:Date.now();n.push(e+"&timestamp="+i)}else{r.push(e)}});n.sort();e=r.concat(n)}if(e){var o=[];for(var a=0;a<e.length;a++){var s=e[a];if(s.indexOf("res.wx.qq.com")>=0&&!isWeiXin()){console.log("not weixin browser skip weixin jssdk");continue}o.push(s)}if(o.length){ResLoader.loadScriptsSync(o,this.onLoadUserScriptsDone.bind(this))}}}return};TRuntimeView.prototype.paintBackground=function(t){};TRuntimeView.prototype.startRedrawTimer=function(t){var t=t||60;var e=1e3/t;var i=WWindowManager.getInstance();setInterval(i.postRedraw.bind(i),e);return};TRuntimeView.prototype.run=function(){var t=this.getMeta();var e=this.getWindowManager();var i=this.detectDeviceConfig();if(this.preview){i.lcdDensity=e.deviceConfig.lcdDensity}e.setDeviceConfig(i);this.modifyTitle(t);this.loadUserScripts(t);this.startRedrawTimer(t.general.fps);e.systemInit();e.postRedraw();return};TRuntimeView.prototype.modifyTitle=function(t){if(t&&t.general){var e=t.general.appname;document.title=e;if(isIPhone()||isIPad()){var i=document.getElementsByTagName("title");if(i&&i.length){var n=i[0];n.innerHTML=e}}}};TRuntimeView.create=function(t,e,i,n,r,o){var a=new TRuntimeView;return a.init(t,e,i,n,r,o)};function dappGetText(t){return t}function dappIsEditorApp(){return false}function TRuntimeDocument(){}TRuntimeDocument.prototype=new TDocument;TRuntimeDocument.prototype.updateAssetsMapRule=function(t){var e=null;var i=t.mapped;var n=t.runtime;var r=t.design;var o=t.map.language;for(e in o){if(n.language.indexOf(e)>=0){i.language=o[e];break}}if(!i.language){i.language=r.language}var a=t.map.size;for(e in a){if(e===n.size){i.size=a[e]}}if(!i.size){i.size=r.size}var s=t.map.density;for(e in s){if(e===n.density){i.density=s[e]}}if(!i.density){i.density=r.density}return this};TRuntimeDocument.prototype.fixAssetsConfig=function(t){var e={};var i=cantkGetViewPort();var n=this.detectDeviceConfig();e.width=i.width;e.height=i.height;e.density=n.lcdDensity;e.language=Locales.getLang();e.size=e.width+"x"+e.height;t.mapped={};t.runtime=e;this.updateAssetsMapRule(t);return this};TRuntimeDocument.prototype.createWindowManager=function(t){var e=this.getAssetsConfig();if(e){this.fixAssetsConfig(e);ResLoader.setAssetsConfig(e);ResLoader.mapImageURL=this.mapAssetURL.bind(this)}return TDocument.prototype.createWindowManager.call(this,t)};TRuntimeDocument.prototype.applyLocales=function(t){var e=null;var i=t.locales;var n=Locales.getLang();if(!i)return;for(var r in i){var o=r.toLowerCase().split(";");for(var a=0;a<o.length;a++){var s=o[a];if(s===n||n.startWith(s)){e=i[r];console.log("Matched locale:"+n+" ==> "+r);break}}if(e)break}if(!e){e=i["default"];if(e){console.log("Matched locale:"+n+" ==> default")}}if(e){webappSetLocaleStrings(e)}return};TRuntimeDocument.prototype.onBeforeLoad=function(t){this.applyLocales(t)};TRuntimeDocument.prototype.mapAssetURL=function(t,e){if(!e||!t||t.length>1024){return t}var i=e.design;var n=e.mapped;if(i.language!==n.language&&t.indexOf(i.language)>=0){t=t.replace(new RegExp(i.language,"g"),n.language)}if(i.density!==n.density&&t.indexOf(i.density)>=0){t=t.replace(new RegExp(i.density,"g"),n.density)}if(i.size!==n.size&&t.indexOf(i.size)>=0){t=t.replace(new RegExp(i.size,"g"),n.size)}return t};function TWebApp(t){document.body.style.overflow="hidden";this.viewPort=cantkGetViewPort();this.preview=!!t;this.init(t);return this}TWebApp.prototype.prepareCanvas=function(){this.canvas=CantkRT.getMainCanvas();var t=this.canvas;var e=cantkGetViewPort();var i=e.width;var n=e.height;CantkRT.resizeMainCanvas(i,n,i,i);this.manager=WWindowManager.create(this,this.canvas,this.canvas);return};TWebApp.prototype.init=function(){this.prepareCanvas();var t=this.canvas.width;var e=this.canvas.height;var i=this;this.win=WWindow.create(this.manager,0,0,t,e);this.view=TRuntimeView.create(this.win,0,0,t,e,this);var n=this.view;this.win.paintBackground=function(t){};this.win.onGesture=function(t){return n.onGesture(t)};window.onresize=function(){setTimeout(i.onSizeChanged.bind(i),50)};return};TWebApp.prototype.resizeWin=function(t,e){this.win.resize(t,e);this.view.resize(t,e)};TWebApp.prototype.resizeCanvas=function(t,e,i,n,r,o){var a=this.canvas;CantkRT.moveMainCanvas(i,n);CantkRT.resizeMainCanvas(t,e,r,o);return};TWebApp.prototype.onSizeChanged=function(){var t=cantkGetViewPort();if(EditorElement.imeOpen){console.log("EditorElement.imeOpen is true.");return}if(t.width===this.viewPort.width&&t.height===this.viewPort.height){console.log("onSizeChanged: size is not changed.");return}var e=t.width;var i=t.height;this.viewPort=t;this.manager.resize(e,i);this.view.adjustWMSizePosition();UIElement.getMainCanvasScale(true)};TWebApp.prototype.exitApp=function(){if(isTizen()){tizen.application.getCurrentApplication().exit()}else if(navigator.app){navigator.app.exitApp()}console.log("exitApp");return};TWebApp.prototype.runWithURL=function(t){this.view.loadURL(t);return this};TWebApp.prototype.runWithData=function(t){if(typeof t==="string"){this.view.loadString(t)}else{this.view.loadJson(t)}return this};window.webappRunWithURL=function(t){var e=new TWebApp;return e.runWithURL(t)};window.webappRunWithData=function(t){var e=new TWebApp;return e.runWithData(t)};window.webappPreviewWithURL=function(t){var e=new TWebApp(true);return e.runWithURL(t)};window.webappPreviewWithData=function(t){var e=new TWebApp(true);return e.runWithData(t)};window.webappGetText=webappGetText;window.webappSetLocaleStrings=webappSetLocaleStrings;window.webappSnapshot=function(){var t=CantkRT.getMainCanvas();var e=t.toDataURL();var i={};i.src=e;i.width=t.width;i.height=t.height;return i};function dupDeviceConfig(t){var e={};e.name=t.name;e.bg=t.bg;e.platform=t.platform;e.version=t.version;e.lcdDensity=t.lcdDensity;e.width=t.width;e.height=t.height;e.screenX=t.screenX;e.screenY=t.screenY;e.screenW=t.screenW;e.screenH=t.screenH;e.hasMenuBar=t.hasMenuBar;return e}function cantkDetectDeviceConfig(){var t={version:4};if(isAndroid()){t.platform="android"}else if(isIPhone()||isIPad()){t.platform="iphone"}else if(isFirefoxOS()){t.platform="firefox"}else if(isWinPhone()){t.platform="winphone"}else if(isTizen()){t.platform="tizen"}else{t.platform="android"}if(window.devicePixelRatio>2.2){t.lcdDensity="xxhdpi"}else if(window.devicePixelRatio>1.5){t.lcdDensity="xhdpi"}else if(window.devicePixelRatio>1.1){t.lcdDensity="hdpi"}else if(window.devicePixelRatio>.8){t.lcdDensity="mdpi"}else if(!window.devicePixelRatio){var e=Math.min(window.orgViewPort.width,window.orgViewPort.height);if(e>600){t.lcdDensity="xhdpi"}else{t.lcdDensity="hdpi"}}else{t.lcdDensity="ldpi"}if(isFirefoxOS()){t.lcdDensity="mdpi"}if(!isMobile()){t.lcdDensity="hdpi"}console.log("deviceConfig.lcdDensity:"+t.lcdDensity);console.log("deviceConfig.platform:"+t.platform);return t}function isDeviceConfigEqual(t,e){var i=JSON.stringify(t);var n=JSON.stringify(e);return i===n}function cantkPreloadImage(t){var e=new WImage(t);return e}var gTempCanvas=null;function cantkGetTempCanvas(t,e){if(!gTempCanvas){gTempCanvas=document.createElement("canvas");gTempCanvas.type="backend_canvas";gTempCanvas.width=t;gTempCanvas.height=e}if(gTempCanvas){if(gTempCanvas.width!=t){gTempCanvas.width=t}if(gTempCanvas.height!=e){gTempCanvas.height=e}}return gTempCanvas}var gApp8LocaleStrings={"Loading...":"正在努力加载..."};function webappGetText(t){var e=null;if(!t){return""}if(gApp8LocaleStrings){e=gApp8LocaleStrings[t]}if(!e){e=t}return e}function webappSetLocaleStrings(t){gApp8LocaleStrings=t;return}VelocityTracker.prototype.HISTORY_SIZE=20;VelocityTracker.prototype.HORIZON=200*1e6;VelocityTracker.prototype.MIN_DURATION=10*1e6;function Movement(){this.eventTime=0;this.point=new Point(0,0);this.getPoint=function(){return this.point};return this}function VelocityTracker(){this.clear();return this}VelocityTracker.prototype.clear=function(){this.index=0;var t=this.HISTORY_SIZE;if(!this.movements){this.movements=new Array;for(var e=0;e<t;e++){this.movements.push(new Movement)}}for(var e=0;e<t;e++){var i=this.movements[e];i.eventTime=0;i.point={x:0,y:0}}return};VelocityTracker.prototype.addMovement=function(t,e){if(++this.index==this.HISTORY_SIZE){this.index=0}this.movements[this.index].eventTime=t;this.movements[this.index].point=e;return};VelocityTracker.prototype.getVelocity=function(){var t={x:0,y:0};this.estimate();t.x=this.xVelocity;t.y=this.yVelocity;return t};VelocityTracker.prototype.estimate=function(){var t=this.HORIZON;var e=this.MIN_DURATION;var i=this.HISTORY_SIZE;var n=this.movements[this.index];var r=n.eventTime-t;var o=this.index;var a=1;do{var s=(o==0?i:o)-1;var h=this.movements[s];if(h.eventTime<r){break}o=s}while(++a<i);var l=0;var u=0;var p=o;var c=0;var f=this.movements[o];var d=f.getPoint();var I=0;while(a-->1){if(++p==i){p=0}var g=this.movements[p];var m=g.eventTime-f.eventTime;if(m>=e){var v=g.getPoint();var y=1e9/m;var U=(v.x-d.x)*y;var S=(v.y-d.y)*y;l=(l*I+U*m)/(m+I);u=(u*I+S*m)/(m+I);I=m;c+=1}}if(c){this.xVelocity=l;this.yVelocity=u}else{this.xVelocity=0;this.yVelocity=0}return true};function testVelocityTracker(){var t=null;var e=new VelocityTracker;function i(t){return t*1e6}for(var n=0;n<20;n++){e.addMovement(i(10*n),{x:10*n,y:10*n*n/2})}t=e.getVelocity();console.log("xv: "+t.x+" yv: "+t.y);return}function Interpolator(){this.get=function(t){return 0};return this}function LinearInterpolator(){this.get=function(t){return t};return this}Interpolator.create=function(t,e){return AnimationFactory.createInterpolator(t,e)};function BounceInterpolator(){function t(t){return 8*t*t}this.get=function(e){e*=1.1226;if(e<.3535)return t(e);else if(e<.7408)return t(e-.54719)+.7;else if(e<.9644)return t(e-.8526)+.9;else return t(e-1.0435)+.95};return this}function AccelerateInterpolator(){this.get=function(t){return t*t};return this}function AccDecelerateInterpolator(){this.get=function(t){return Math.cos((t+1)*Math.PI)/2+.5};return this}function DecelerateInterpolator(t){this.factor=t?t:2;this.get=function(t){if(this.factor===1){return 1-(1-t)*(1-t)}else{return 1-Math.pow(1-t,2*this.factor)}};return this}function SineAccelerateInterpolator(){this.get=function(t){return-Math.cos(t*(Math.PI/2))+1};return this}function SineAccDecelerateInterpolator(){this.get=function(t){return-.5*(Math.cos(Math.PI*t)-1)};return this}function SineDecelerateInterpolator(){this.get=function(t){return Math.sin(t*(Math.PI/2))};return this}function AnimationFactory(){this.createAnimation=function(t,e){UIElement.getMainCanvasScale(true);var i=isIPhone()?400:600;e=e?e:i;switch(t){case"anim-forward":{var n=new DecelerateInterpolator;animation=new AnimationHTranslate(true);animation.toLeft();animation.init(e,n);break}case"anim-backward":{var n=new DecelerateInterpolator;animation=new AnimationHTranslate(false);animation.toRight();animation.init(e,n);break}case"anim-upward":{var n=new DecelerateInterpolator;animation=new AnimationVTranslate(true);animation.init(e,n);break}case"anim-downward":{var n=new DecelerateInterpolator;animation=new AnimationVTranslate(false);animation.init(e,n);break}case"anim-scale-show-win":{var n=new DecelerateInterpolator;animation=new AnimationScale(true);animation.setRange(.9,1);animation.init(e,n);break}case"anim-scale-hide-win":{var n=new AccelerateInterpolator;animation=new AnimationScale(false);
animation.setRange(1,.9);animation.init(e,n);break}case"anim-scale-show-dialog":{e=e?e:300;var n=new DecelerateInterpolator;animation=new AnimationScale(true);animation.setRange(.9,1);animation.init(e,n);break}case"anim-scale-hide-dialog":{e=e?e:300;var n=new AccelerateInterpolator;animation=new AnimationScale(false);animation.setRange(1,.9);animation.init(e,n);break}case"anim-fade-in":{var n=new AccelerateInterpolator;animation=new AnimationAlpha(true);animation.setRange(.1,1);animation.init(800,n);break}case"anim-fade-out":{var n=new AccelerateInterpolator;animation=new AnimationAlpha(false);animation.setRange(1,.1);animation.init(300,n);break}case"anim-move-up":{var n=new DecelerateInterpolator;animation=new AnimationMove(true);animation.init(e,n);break}case"anim-move-down":{var n=new AccelerateInterpolator;animation=new AnimationMove(false);animation.init(e,n);break}}return animation};return this}AnimationFactory.createInterpolator=function(t,e){switch(t){case"l":case"linear":{return new LinearInterpolator}case"b":case"bounce":{return new BounceInterpolator}case"a":case"accelerate":{return new AccelerateInterpolator}case"ad":case"accelerate-decelerate":{return new AccDecelerateInterpolator}case"sa":case"sine-accelerate":{return new SineAccelerateInterpolator}case"sd":case"sine-decelerate":{return new SineDecelerateInterpolator}case"sad":case"sine-accelerate-decelerate":{return new SineAccDecelerateInterpolator}default:{return new DecelerateInterpolator}}};AnimationFactory.create=function(t,e){if(!AnimationFactory.instance){AnimationFactory.instance=new AnimationFactory}return AnimationFactory.instance.createAnimation(t,e)};Animation.getCanvas=function(){return UIElement.getMainCanvas()};function Animation(t){this.scale=1;this.visible=false;this.showWin=t;this.init=function(t,e){this.duration=t?t:500;this.interpolator=e;return};this.setWins=function(t,e){this.oldWin=t;this.newWin=e;this.wm=t.getWindowManager()};this.setRectOfFront=function(t,e,i,n){this.frontX=t;this.frontY=e;this.frontW=i;this.frontH=n;return};this.setScale=function(t){this.scale=t;return};this.prepare=function(t,e,i,n,r){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.onFinish=r;this.setRectOfFront(0,0,i,n);this.show();return true};this.show=function(){var t=this.w*this.scale;var e=this.h*this.scale;this.visible=true;this.canvasElement=Animation.getCanvas();return true};this.hide=function(){this.visible=false;if(this.canvasElement&&this.canvasElement.parentNode){this.canvasElement=null}return true};this.getTimePercent=function(){var t=new Date;var e=t.getTime()-this.startTime;return e/this.duration};this.getPercent=function(t){return this.interpolator.get(t)};this.step=function(t){return true};this.beforeRun=function(){return true};this.afterRun=function(){return true};this.drawBackground=function(t){return};this.doStep=function(t){this.canvas.save();this.canvas.scale(this.scale,this.scale);this.step(t);this.canvas.restore();return};this.run=function(){var t=new Date;var e=this;this.startTime=t.getTime();e.isFirstStep=true;this.beforeRun();WWindowManager.getInstance().setPaintEnable(false);this.wm.setEnable(false);function i(){var t=0;var n=e.getTimePercent();if(n<1){t=e.getPercent(n);e.doStep(t);requestAnimationFrame(i)}else{e.cleanup();e.afterRun();WWindowManager.getInstance().setPaintEnable(true);console.log("Animation done.")}e.isFirstStep=false}i();return};this.cleanup=function(){var t=this;var e=this.onFinish;setTimeout(function(){t.hide();t.wm.setEnable(true)},100);if(e){e()}};this.hide();return this}function setElementPosition(t,e,i){var n=UIElement.getMainCanvasScale();e=e/n.x;i=i/n.y;t.style.position="absolute";t.style.left=Math.round(e)+"px";t.style.top=Math.round(i)+"px";t.style["opacity"]=1;return}function moveElement(t,e,i){setElementPosition(t,e,i);return}function alphaElement(t,e){t.style["opacity"]=e;return}function showElement(t){t.style["opacity"]=1}function hideElement(t){t.style["opacity"]=0}function scaleElement(t,e,i,n,r){var o=n&&r?n+" "+r:"50% 50%";var a=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var s=0;s<a.length;s++){var h=a[s];t.style[h+"-origin"]=o;t.style[h]="scale("+e+")"}t.style["opacity"]=i;return}function rotateElement(t,e){var i="50% 50%";var n=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var r=0;r<n.length;r++){var o=n[r];t.style[o+"-origin"]=i;t.style[o]="rotate("+e+"deg)"}return}function AnimationVTranslate(t){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(t){var e=this.frontX;var i=this.frontY;var n=this.frontW;var r=this.range*t;var o=this.showWin?r:this.range-r;var a=this.showWin?this.frontY+this.range-r:this.frontY+r;var s=this.canvas;s.save();var h=this.oldWin.getWindowManager();s.translate(h.x,h.y);if(this.showWin){s.translate(0,a-this.h);s.save();s.clipRect(0,0,this.w,this.h);this.oldWin.paintSelf(s);s.restore();s.translate(0,this.h);s.save();s.clipRect(0,0,this.w,this.h);this.newWin.paintSelf(s);s.restore()}else{s.translate(0,a-this.h);s.save();s.clipRect(0,0,this.w,this.h);this.newWin.paintSelf(s);s.restore();s.translate(0,this.h);s.save();s.clipRect(0,0,this.w,this.h);this.oldWin.paintSelf(s);s.restore()}s.restore();return true}}function AnimationHTranslate(){Animation.apply(this,arguments);this.leftToRight=true;this.beforeRun=function(){var t=this.newWin.w;this.range=t;this.start=t-this.range;this.canvas=this.canvasElement.getContext("2d")};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(t){var e=0;if(this.leftToRight){e=this.start+this.range*t}else{e=this.w-this.range*t-this.start}if(this.lastOffset===e){return true}var i=this.canvas;i.save();var n=this.oldWin.getWindowManager();i.translate(n.x,n.y);if(this.leftToRight){i.translate(-e,0);i.save();i.clipRect(0,0,this.w,this.h);this.oldWin.paintSelf(i);i.restore();i.translate(this.w,0);i.save();i.clipRect(0,0,this.w,this.h);this.newWin.paintSelf(i);i.restore()}else{i.translate(-e,0);i.save();i.clipRect(0,0,this.w,this.h);this.newWin.paintSelf(i);i.restore();i.translate(this.w,0);i.save();i.clipRect(0,0,this.w,this.h);this.oldWin.paintSelf(i);i.restore()}i.restore();this.lastOffset=e;return true}}function AnimationScale(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(t,e){this.to=e;this.from=t;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=this.to>this.from?t:1-t;var n=this.canvas;var r=this.w>>1;var o=this.h>>1;n.save();var a=this.oldWin.getWindowManager();n.translate(a.x,a.y);n.clipRect(0,0,this.w,this.h);if(this.to>this.from){this.oldWin.paintSelf(n);n.globalAlpha=i;n.translate(r,o);n.scale(e,e);n.translate(-r,-o);this.newWin.paintSelf(n)}else{this.newWin.paintSelf(n);n.globalAlpha=i;n.translate(r,o);n.scale(e,e);n.translate(-r,-o);this.oldWin.paintSelf(n)}n.restore();return true}}function AnimationAlpha(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(t,e){this.to=e;this.from=t;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=this.canvas;i.save();var n=this.oldWin.getWindowManager();i.translate(n.x,n.y);i.clipRect(0,0,this.w,this.h);if(this.to>this.from){this.oldWin.paintSelf(i);i.globalAlpha=e;this.newWin.paintSelf(i)}else{this.newWin.paintSelf(i);i.globalAlpha=e;this.oldWin.paintSelf(i)}i.restore();return true}}function AnimationMove(t){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(e){var i=this.frontX;var n=this.frontY;var r=this.frontW;var o=this.range*e;var a=this.showWin?o:this.range-o;var s=this.showWin?this.frontY+this.range-o:this.frontY+o;var h=this.canvas;h.save();var l=this.oldWin.getWindowManager();h.translate(l.x,l.y);h.clipRect(0,0,this.w,this.h);if(t){this.oldWin.paintSelf(h);h.translate(0,s);this.newWin.paintSelf(h)}else{this.newWin.paintSelf(h);h.translate(0,s);this.oldWin.paintSelf(h)}h.restore();return true}}function UIElement(){return}UIElement.IMAGE_DISPLAY_CENTER=WImage.DISPLAY_CENTER;UIElement.IMAGE_DISPLAY_TILE=WImage.DISPLAY_TILE;UIElement.IMAGE_DISPLAY_9PATCH=WImage.DISPLAY_9PATCH;UIElement.IMAGE_DISPLAY_SCALE=WImage.DISPLAY_SCALE;UIElement.IMAGE_DISPLAY_AUTO=WImage.DISPLAY_AUTO;UIElement.IMAGE_DISPLAY_DEFAULT=WImage.DISPLAY_DEFAULT;UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO=WImage.DISPLAY_SCALE_KEEP_RATIO;UIElement.IMAGE_DISPLAY_TILE_V=WImage.DISPLAY_TILE_V;UIElement.IMAGE_DISPLAY_TILE_H=WImage.DISPLAY_TILE_H;UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN=WImage.DISPLAY_AUTO_SIZE_DOWN;UIElement.IMAGE_DISPLAY_FIT_WIDTH=WImage.DISPLAY_FIT_WIDTH;UIElement.IMAGE_DISPLAY_FIT_HEIGHT=WImage.DISPLAY_FIT_HEIGHT;UIElement.IMAGE_DISPLAY_3PATCH_V=WImage.DISPLAY_3PATCH_V;UIElement.IMAGE_DISPLAY_3PATCH_H=WImage.DISPLAY_3PATCH_H;UIElement.HTEXT_ALIGNS=["left","center","right"];UIElement.VTEXT_ALIGNS=["top","middle","bottom"];UIElement.IMAGE_DISPLAY_NAMES=["incenter","tile","9patch","scale","auto","default","scale(keep ratio)","vtile","htile","auto-size-down","fit-width","fit-height"];UIElement.X_FIX_LEFT=0;UIElement.X_FIX_RIGHT=1;UIElement.X_SCALE=2;UIElement.X_CENTER_IN_PARENT=3;UIElement.X_LEFT_IN_PARENT=4;UIElement.X_RIGHT_IN_PARENT=5;UIElement.X_AFTER_PREV=6;UIElement.X_LAYOUT_NAMES=["fix_left","fix_right","scale","center_in_parent","left_in_parent","right_in_parent"];UIElement.Y_FIX_TOP=0;UIElement.Y_FIX_BOTTOM=1;UIElement.Y_SCALE=2;UIElement.Y_MIDDLE_IN_PARENT=3;UIElement.Y_TOP_IN_PARENT=4;UIElement.Y_BOTTOM_IN_PARENT=5;UIElement.Y_AFTER_PREV=6;UIElement.Y_LAYOUT_NAMES=["fix_top","fix_bottom","scale","middle_in_parent","top_in_parent","bottom_in_parent"];UIElement.WIDTH_FIX=0;UIElement.WIDTH_SCALE=1;UIElement.WIDTH_FILL_PARENT=2;UIElement.WIDTH_FILL_AVAILABLE=3;UIElement.WIDTH_FILL_TO_PARENT_RIGHT=4;UIElement.HEIGHT_FIX=0;UIElement.HEIGHT_SCALE=1;UIElement.HEIGHT_FILL_PARENT=2;UIElement.HEIGHT_FILL_AVAILABLE=3;UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH=4;UIElement.HEIGHT_FILL_TO_PARENT_BOTTOM=5;UIElement.WIDTH_LAYOUT_NAMES=["fix","scale","fill_parent"];UIElement.HEIGHT_LAYOUT_NAMES=["fix","scale","fill_parent"];UIElement.IMAGE_DEFAULT="default_bg";UIElement.IMAGE_MASK="mask_fg";UIElement.IMAGE_NORMAL="normal_bg";UIElement.IMAGE_NORMAL_BG="normal_bg";UIElement.IMAGE_FOCUSED="focused_bg";UIElement.IMAGE_ACTIVE="active_bg";UIElement.IMAGE_POINTER_OVER="pointer_over_bg";UIElement.IMAGE_DISABLE="disable_bg";UIElement.IMAGE_DISABLE_FG="disable_fg";UIElement.IMAGE_NORMAL_FG="normal_fg";UIElement.IMAGE_ACTIVE_FG="active_fg";UIElement.IMAGE_CURRENT_PAGE_BG="current_page_bg";UIElement.IMAGE_CURRENT_PAGE_FG="current_page_fg";UIElement.IMAGE_NOT_CURRENT_PAGE_BG="not_current_page_bg";UIElement.IMAGE_NOT_CURRENT_PAGE_FG="not_current_page_fg";UIElement.IMAGE_ON_FG="on_fg";UIElement.IMAGE_OFF_FG="off_fg";UIElement.IMAGE_ON_BG="on_bg";UIElement.IMAGE_OFF_BG="off_bg";UIElement.IMAGE_CHECKED_BG="checked_bg";UIElement.IMAGE_UNCHECK_BG="unchecked_bg";UIElement.IMAGE_CHECKED_FG="checked_fg";UIElement.IMAGE_UNCHECK_FG="unchecked_fg";UIElement.IMAGE_ON_FOCUSED="focused_on_bg";UIElement.IMAGE_ON_ACTIVE="active_on_bg";UIElement.IMAGE_OFF_FOCUSED="focused_off_bg";UIElement.IMAGE_OFF_ACTIVE="active_off_bg";UIElement.IMAGE_NORMAL_DRAG="normal_drag";UIElement.IMAGE_DELETE_ITEM="delete_item_icon";UIElement.IMAGE_CHECKED_ITEM="checked_item_icon";UIElement.IMAGE_POINT="point_img";UIElement.IMAGE_POINT1="point1_img";UIElement.IMAGE_POINT2="point2_img";UIElement.IMAGE_POINT3="point3_img";UIElement.IMAGE_POINT4="point4_img";UIElement.IMAGE_TIPS1="tips_img_1";UIElement.IMAGE_TIPS2="tips_img_2";UIElement.IMAGE_TIPS3="tips_img_3";UIElement.IMAGE_TIPS4="tips_img_4";UIElement.IMAGE_TIPS5="tips_img_5";UIElement.IMAGE_V_SCROLL_BAR_BG="v-scroll-bar-bg";UIElement.IMAGE_V_SCROLL_BAR_FG="v-scroll-bar-fg";UIElement.IMAGE_H_SCROLL_BAR_BG="h-scroll-bar-bg";UIElement.IMAGE_H_SCROLL_BAR_FG="h-scroll-bar-fg";UIElement.ITEM_BG_NORMAL="item_bg_normal";UIElement.ITEM_BG_ACTIVE="item_bg_active";UIElement.ITEM_BG_CURRENT_NORMAL="item_bg_current_normal";UIElement.ITEM_BG_CURRENT_ACTIVE="item_bg_current_active";UIElement.TEXT_ALIGN_CENTER=0;UIElement.TEXT_ALIGN_LEFT=0;UIElement.TEXT_ALIGN_RIGHT=0;UIElement.TEXT_ALIGN_NAMES=["center","left","right"];UIElement.ORIGIN_UP=1;UIElement.ORIGIN_DOWN=2;UIElement.ORIGIN_LEFT=3;UIElement.ORIGIN_RIGHT=4;UIElement.ORIGIN_UP_LEFT=5;UIElement.ORIGIN_UP_RIGHT=6;UIElement.ORIGIN_DOWN_LEFT=7;UIElement.ORIGIN_DOWN_RIGHT=8;UIElement.ORIGIN_MIDDLE_CENTER=9;UIElement.STATE_STOP=1;UIElement.STATE_RUNNING=2;UIElement.STATE_PAUSED=3;UIElement.prototype=new RShape;TEventTarget.apply(UIElement.prototype);UIElement.Style=function(){this.lineWidth=2;this.lineColor="Orange";this.fillColor="White";this.textColor="Blue";this.fontSize=24;return};UIElement.Style.prototype=new ShapeStyle;UIElement.prototype.isUIElement=true;UIElement.prototype.hasChildren=true;UIElement.prototype.isContainer=true;UIElement.disableGetRelativePathOfURL=false;UIElement.prototype.addResource=function(t){if(!this.resources){this.resources=[]}if(this.resources.indexOf(t)<0){this.resources.push(t)}return};UIElement.prototype.setDefaultStyle=function(){this.style=new UIElement.Style;return};UIElement.prototype.clone=function(){var t=null;UIElement.disableGetRelativePathOfURL=true;t=this.dup();UIElement.disableGetRelativePathOfURL=false;t.setVisible(true);t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FIX;t.uid=UIElement.uidStart++;if(this.anchor){t.setAnchor(this.anchor.x,this.anchor.y)}return t};UIElement.prototype.getRelativePathOfURL=function(t){if(UIElement.disableGetRelativePathOfURL||!t){return t}return t.toRelativeURL()};UIElement.prototype.setFreePosition=function(t){this.freePosition=t;return};UIElement.prototype.fixChildPosition=function(t){return};UIElement.prototype.setFreeSize=function(t){this.freeSize=t;return};UIElement.prototype.fixChildSize=function(t){return};UIElement.prototype.onInit=function(){this.callOnInitHandler();if(this.dataSourceUrl&&this.dataSourceUrl.length>5){this.bindDataUrl(this.dataSourceUrl)}return};UIElement.prototype.onDeinit=function(){if(this.animatingInfo){this.stopAnimation(true)}return};UIElement.prototype.onWindowOpen=function(){if(this.animations&&this.defaultAnimationName){var t=this.animations[this.defaultAnimationName];if(t){this.animate(t)}}return};UIElement.prototype.initChildren=function(){var t=this.children;var e=this.children.length;for(var i=0;i<e;i++){var n=t[i];n.init()}return};UIElement.prototype.init=function(){try{this.onInit()}catch(t){console.log("onInit Failed:"+t.message+"\n"+t.stack)}this.initChildren();return};UIElement.prototype.deinit=function(){var t=0;var e=null;var i=this.children;var n=this.children.length;for(t=0;t<n;t++){e=i[t];e.deinit()}this.onDeinit();return};UIElement.prototype.onModeChanged=function(){return};UIElement.prototype.userRemovable=function(){return this.isInDesignMode()};UIElement.prototype.postRedraw=function(){if(this.view){this.view.postRedrawAll()}return this};UIElement.prototype.requestRedraw=UIElement.prototype.postRedraw;UIElement.prototype.setMode=function(t,e){this.mode=t;if(this.type!=="ui-menu-bar"){if(this.isInDesignMode()){this.setVisible(true)}}if(e){for(var i=0;i<this.children.length;i++){var n=this.children[i];if(n.isContainer){n.setMode(t,true)}}}this.onModeChanged();return this};UIElement.prototype.calcChildrenRange=function(){return this.calcShapesRange(this.children)};UIElement.prototype.calcShapesRange=function(t){var e=0;var i=0;var n=0;var r=0;var o=0;var a=0;var s=1e4;var h=1e4;var l={};if(t.length>0){for(var u=0;u<t.length;u++){var p=t[u];e=p.getX();i=p.getY();n=p.getWidth();r=p.getHeight();if(e<h)h=e;if(i<s)s=i;if(e+n>o)o=e+n;if(i+r>a)a=i+r}l.l=h;l.r=o;l.t=s;l.b=a}else{l.l=0;l.r=0;l.t=0;l.b=0}return l};UIElement.prototype.relayoutChildren=function(){};UIElement.prototype.onSized=function(){this.updateLayoutParams();return};UIElement.prototype.findSelectedShapes=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.selected){t.push(i);continue}if(i.isContainer){i.findSelectedShapes(t)}}return};UIElement.onSelected=function(t){};UIElement.prototype.onSelectChanged=function(){if(this.selected){UIElement.onSelected(this)}return};UIElement.prototype.setSelected=function(t){if(!t){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setSelected(false)}}if(t){this.selectedTime=Date.now()}if(this.selected===t){return}this.targetShape=null;this.selected=t;this.onSelectChanged();return};UIElement.prototype.setPointerEventTarget=function(t){this.pointerEventTarget=t;return};UIElement.prototype.getPointerEventTarget=function(){return this.pointerEventTarget?this.pointerEventTarget:this.targetShape};UIElement.prototype.foreachImage=function(t){for(var e in this.images){if(e!=="display"){var i=this.getImageSrcByType(e);t(e,i)}}return};UIElement.prototype.forEach=function(t){if(t(this)){return true}for(var e=0;e<this.children.length;e++){var i=this.children[e];i.forEach(t)}return false};UIElement.prototype.getAllTabStopElements=function(){var t=[];var e=this.getWindow();if(e){e.forEach(function(e){if(e.isUIButton||e.isUIEdit){t.push(e)}})}return t};UIElement.prototype.findNextTabStop=function(){var t=this.getAllTabStopElements();if(!t.length){return}var e=t.indexOf(this);if(e>=0&&e+1<t.length){return t[e+1]}else{return t[0]}};UIElement.prototype.moveToNextStop=function(){var t=this.findNextTabStop();return};UIElement.prototype.isPointerOverShape=function(){return this.parentShape&&this.parentShape.pointerOverShape===this};UIElement.prototype.setPointerOverShape=function(t){if(this.pointerOverShape!==t){if(this.pointerOverShape){this.pointerOverShape.setPointerOverShape(null)}this.pointerOverShape=t;this.postRedraw()}return};UIElement.prototype.setTarget=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i!==t){i.setSelected(false)}}this.targetShape=t;this.selected=!t;this.onSelectChanged();return this};UIElement.prototype.getTarget=function(){return this.targetShape};UIElement.prototype.initContainerShape=function(t){this.children=new Array;RShapeInit(this,t);this.mode=Shape.MODE_EDITING;this.rectSelectable=true;return this};UIElement.prototype.defaultDispatchPointerDownToChildren=function(t){var e=this.targetShape;if(e&&e.isInDesignMode()){var i=this.hitTest(t);if(i!=Shape.HIT_TEST_MM&&i!=Shape.HIT_TEST_NONE){if(this.selected){this.setTarget(null);return true}if(this.targetShape.onPointerDown(t)){return true}}}var n=this.children;var r=n.length;for(var o=r;o>0;o--){var a=n[o-1];if(a.visible&&a.onPointerDown(t)){this.setTarget(a);if(!a.shouldPropagatePointerEvent()){return true}}}return false};UIElement.prototype.dispatchPointerDownToChildren=function(t){return this.defaultDispatchPointerDownToChildren(t)};UIElement.prototype.onPointerDownEditing=function(t,e){return};UIElement.prototype.onPointerDownRunning=function(t,e){if(!this.pointerDown){return}return this.callOnPointerDownHandler(t,e)};UIElement.prototype.onPointerMoveEditing=function(t,e){return};UIElement.prototype.onPointerMoveRunning=function(t,e){return this.callOnPointerMoveHandler(t,e)};UIElement.prototype.onPointerUpEditing=function(t,e){return};UIElement.prototype.onPointerUpRunning=function(t,e){if(!this.pointerDown){return}return this.callOnPointerUpHandler(t,e)};UIElement.prototype.onDoubleClick=function(t){if(this.targetShape){var e=this.translatePoint(t);return this.targetShape.onDoubleClick(e)}else{return this.callOnDoubleClickHandler(t)}};UIElement.prototype.onGesture=function(t){if(this.popupWindow){return}if(this.targetShape){return this.targetShape.onGesture(t)}return};UIElement.prototype.onLongPress=function(t){if(!this.pointerDown){return}this.longPressed=true;this.callOnLongPressHandler(t);if(this.targetShape){var e=this.translatePoint(t);return this.targetShape.onLongPress(e)}return};UIElement.prototype.onClick=function(t,e){if(e||!this.pointerDown){return}return this.callOnClickHandler(t)};UIElement.prototype.translatePoint=function(t){var e={x:t.x-this.left,y:t.y-this.top};return e};UIElement.prototype.setCanRectSelectable=function(t,e){this.rectSelectable=t;for(var i=0;i<this.children.length;i++){var n=this.children[i];n.setCanRectSelectable(t,e)}return};UIElement.prototype.canRectSelectable=function(){return this.isUIWindow||this.isUIPage};UIElement.prototype.setDraggable=function(t){if(this.draggable===t){return}this.draggable=t;if(t){this.addEventNames(["onDragStart","onDragging","onDragEnd"])}else{this.removeEventNames(["onDragStart","onDragging","onDragEnd"])}return};UIElement.prototype.onDragStart=function(){console.log("Drag Start");this.callOnDragStartHandler();return};UIElement.prototype.onDragging=function(){console.log("Dragging");this.callOnDragingHandler();return};UIElement.prototype.onDragEnd=function(){console.log("Drag End");this.callOnDragEndHandler();return};UIElement.prototype.dragMove=function(t,e,i){this.left=this.left+t;this.top=this.top+e;this.onDragging(i);return};UIElement.prototype.handleDragMove=function(t){var e=this.getMoveDeltaX();var i=this.getMoveDeltaY();if(!this.dragging){var n=this.getMoveAbsDeltaX();var r=this.getMoveAbsDeltaY();if(Math.abs(n)>5||Math.abs(r)>5){this.dragging=true;this.onDragStart();e=n;i=r}}if(this.dragging){this.dragMove(e,i,t);if(this.parentShape){this.parentShape.onChildDragging(this,t)}}return};UIElement.prototype.onChildDragging=function(t,e){return};UIElement.prototype.onChildDragged=function(t,e){this.sortChildren();this.relayoutChildren("default");return};UIElement.prototype.handleDragUp=function(t){this.onDragEnd();delete this.dragging;if(this.parentShape){this.parentShape.onChildDragged(this,t)}return};UIElement.prototype.animMove=function(t,e){if(!this.dragging){this.animate({x:t,y:e})}return};UIElement.getIntFromConfig=function(t,e,i){var n=t[e];if(!n&&n!==0){return i}if(typeof n==="string"){if(n[1]==="+"||n[1]==="-"){n=i+parseInt(n.substr(1))}else{n=parseInt(n)}}return n};UIElement.prototype.stopAnimation=function(t){if(!this.animatingInfo){return this}if(t){this.stepAnimation({needRedraw:0},Date.now()+1e8)}this.animatingInfo=null;return this};UIElement.prototype.animate=function(t,e,i,n){var r=this;var o=Deferred();var i=i||t.onStep;var e=e||t.onDone;this.doAnimate(t,function(){if(typeof e==="function"){e.apply(r,arguments)}o.resolve()},function(){if(typeof i==="function"){return i.apply(r,arguments)}return true},n);return o.promise};UIElement.prototype.doAnimate=function(t,e,i,n){if(typeof t==="string"){t=this.animations[t]}if(!this.parentShape){UIElement.logWarning("animate error - parentShape is null.");return false}if(this.dragging){UIElement.logWarning("animate error - busy.");return false}var r=this.animatingInfo;if(r){var o=n||t.actionWhenBusy||"replace";if(o==="replace"){this.callOnAnimateDone(r)}else if(o==="append"){var a=0;for(var s=r;s;s=s.next){if(s===t){UIElement.logWarning("animate error - already appended.");return false}if(!s.next||a>30){s.next=t;break}a++}UIElement.logNotice("busy action - append animation.");return true}else{UIElement.logWarning("animate error - busy.");return false}}if(!t){UIElement.logWarning("animate error - config is null.");return false}var h=this.getX();var l=this.getY();var u=this.w;var p=this.h;var c=t.duration||800;var f=UIElement.getIntFromConfig(t,"xStart",h);var d=UIElement.getIntFromConfig(t,"xEnd",h);var I=UIElement.getIntFromConfig(t,"yStart",l);var g=UIElement.getIntFromConfig(t,"yEnd",l);var m=UIElement.getIntFromConfig(t,"wStart",u);var v=UIElement.getIntFromConfig(t,"wEnd",u);var y=UIElement.getIntFromConfig(t,"hStart",p);var U=UIElement.getIntFromConfig(t,"hEnd",p);var S=t.valueStart||0;var w=t.valueEnd||0;var E=t.opacityStart||t.opacityStart===0?t.opacityStart:this.opacity;var T=t.opacityEnd||t.opacityEnd===0?t.opacityEnd:this.opacity;var C=t.rotationStart||t.rotationStart===0?t.rotationStart:this.rotation;var M=t.rotationEnd||t.rotationEnd===0?t.rotationEnd:this.rotation;var A=t.scaleXStart||t.scaleXStart===0?t.scaleXStart:this.getScaleX();var P=t.scaleXEnd||t.scaleXEnd===0?t.scaleXEnd:this.getScaleX();var x=t.scaleYStart||t.scaleYStart===0?t.scaleYStart:this.getScaleY();var D=t.scaleYEnd||t.scaleYEnd===0?t.scaleYEnd:this.getScaleY();if(t.scaleEnd!==undefined){P=t.scaleEnd;D=t.scaleEnd}if(t.scaleStart!==undefined){A=t.scaleStart;x=t.scaleStart}if(t.scale!==undefined){P=t.scale;D=t.scale}if(t.scaleX!==undefined){P=t.scaleX}if(t.scaleY!==undefined){D=t.scaleY}if(t.x!==undefined){d=t.x}if(t.y!==undefined){g=t.y}if(t.opacity!==undefined){T=t.opacity}if(t.rotation!==undefined){M=t.rotation}var _=e||t.onDone;var R=i||t.onStep;var L=d-f;var b=g-I;var O=P-A;var V=D-x;var W=T-E;var F=M-C;var H=w-S;var B=null;if(typeof t.interpolator==="string"){B=AnimationFactory.createInterpolator(t.interpolator)}else{B=t.interpolator?t.interpolator:new DecelerateInterpolator}if(!L){this.setX(f);d=f}if(!b){this.setY(I);g=I}if(!O){this.setScaleX(A);P=A}if(!V){this.setScaleY(x);D=x}if(!W&&E){this.setOpacity(E);T=E}if(!F){this.setRotation(C);M=C}var a={};a.xRange=L;a.yRange=b;a.scaleXRange=O;a.scaleYRange=V;a.opacityRange=W;a.rotationRange=F;a.valueRange=H;a.wStart=m;a.hStart=y;a.xStart=f;a.yStart=I;a.scaleXStart=A;a.scaleYStart=x;a.opacityStart=E;a.rotationStart=C;a.valueStart=S;a.startTime=Date.now();a.duration=c;a.onDone=_;a.onStep=R;a.interpolator=B;a.next=t.next;a.name=t.name;a.now=a.startTime;if(t.delay){a.startTime+=t.delay}this.animatingInfo=a;this.postRedraw();return true};UIElement.prototype.callOnAnimateDone=function(t){this.animating=false;this.animatingInfo=null;var e=t.onDone;if(e){e.call(this,t.name)}if(!this.parentShape)return false;this.callOnAnimateDoneHandler(t.name);if(!this.parentShape)return false;var i=t.next;if(i){if(typeof i==="string"){if(!this.animations[i]){return false}}this.animate(i);return true}return false};UIElement.prototype.isAnimating=function(){return this.animatingInfo&&this.parentShape};UIElement.prototype.stepAnimation=function(t,e){var i=this.animatingInfo;if(!i||!this.parentShape)return;i.now+=t.timeStep;if(!e){e=i.now}t.needRedraw++;if(i.startTime>e){return}if(!this.visible){this.visible=true}var n=i.xRange;var r=i.yRange;var o=i.valueRange;var a=i.scaleXRange;var s=i.scaleYRange;var h=i.opacityRange;var l=i.rotationRange;var u=i.wStart;var p=i.hStart;var c=i.xStart;var f=i.yStart;var d=i.scaleXStart;var I=i.scaleYStart;var g=i.opacityStart;var m=i.rotationStart;var v=i.valueStart;var y=i.onStep;var U=i.duration;var S=i.startTime;var w=i.interpolator;var E=(e-S)/U;var T=w.get(E);if(o){i.value=v+T*o}if(E>=1){T=1}if(n||r){var C=Math.floor(c+T*n);var M=Math.floor(f+T*r);this.setPosition(C,M)}if(h){this.opacity=g+T*h}if(l){this.setRotation(m+T*l)}if(a){this.setScaleX(d+T*a)}if(s){this.setScaleY(I+T*s)}if(y&&!y(this,E,i)){this.callOnAnimateDone(i);return}if(T<1){this.animating=true}else{this.callOnAnimateDone(i)}return};UIElement.prototype.isHitWorkArea=function(){return this.hitTestResult===Shape.HIT_TEST_MM&&this.children.length>1&&this.canRectSelectable()};UIElement.prototype.setPropagatePointerEvent=function(t){this.propagatePointerEvent=t;return this};UIElement.prototype.getPropagatePointerEvent=function(){return this.propagatePointerEvent};UIElement.prototype.shouldPropagatePointerEvent=function(){return this.propagatePointerEvent&&!this.isInDesignMode()&&(!this.targetShape||this.targetShape.shouldPropagatePointerEvent())};UIElement.prototype.onPointerDownNormal=function(t){var e=this.translatePoint(t);this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){if(this.isUIScrollView&&!this.isInDesignMode()){return false}if(this.dispatchPointerDownToChildren(e)){this.setPointerEventTarget(this.targetShape);return true}return false}this.pointerDown=true;this.pointerDownTime=Date.now();this.childrenRange=this.calcChildrenRange();if(this.isInDesignMode()){this.onPointerDownEditing(t,true)}else if(this.enable){this.onPointerDownRunning(e,true)}this.setPointerEventTarget(null);if(this.hitTestResult===Shape.HIT_TEST_MM||!this.selected){if(this.dispatchPointerDownToChildren(e)){if(this.isInDesignMode()){this.onPointerDownEditing(t,false)}else if(this.enable){this.onPointerDownRunning(e,false)}this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.setPointerEventTarget(this.targetShape);return true}}if(this.isHitWorkArea()){this.hitTestResult=Shape.HIT_TEST_WORKAREA}this.setTarget(null);this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;if(this.isInDesignMode()){this.handlePointerEvent(t,1)}if(this.isInDesignMode()){this.onPointerDownEditing(t,false)}else if(this.enable){this.onPointerDownRunning(e,false)}this.postRedraw();return true};UIElement.prototype.getPointerPosition=function(){var t=this.getWindow();return t.lastPosition};UIElement.prototype.onPointerMoveNormal=function(t){if(!this.isInDesignMode()&&!this.isUIWindowManager&&!this.isUIWindow){if(!this.win.pointerDown){return}}var e=this.translatePoint(t);if(this.draggable&&this.pointerDown){if(!this.isInDesignMode()){this.handleDragMove(t);return}else{delete this.dragging}}if(this.hitTestResult){if(this.isInDesignMode()){this.onPointerMoveEditing(t,true)}else if(this.enable){this.onPointerMoveRunning(e,true)}var i=this.getPointerEventTarget();if(i){i.onPointerMove(e);if(this.isInDesignMode()){this.onPointerMoveEditing(t,false)}else if(this.enable){this.onPointerMoveRunning(e,false)}}else{if(this.isInDesignMode()){this.onPointerMoveEditing(t,false);if(this.hitTestResult===Shape.HIT_TEST_WORKAREA&&this.isUIWindow){var e={x:0,y:0};var n=t.x-this.pointerDownPosition.x;var r=t.y-this.pointerDownPosition.y;var o=this.pointerDownPosition.x-this.left;var a=this.pointerDownPosition.y-this.top;var s={x:o,y:a,w:n,h:r};if(Math.abs(n)>5&&Math.abs(r)>5){s=fixRect(s);this.setSelected(false);for(var h=this.children.length-1;h>=0;h--){var l=this.children[h];e.x=l.left+l.w/2;e.y=l.top+l.h/2;l.setSelected(isPointInRect(e,s))}}}else{this.handlePointerEvent(t,0)}}else if(this.enable){this.onPointerMoveRunning(e,false)}}this.lastPosition.x=t.x;this.lastPosition.y=t.y;return true}else{var i=this.getPointerEventTarget();if(i){i.onPointerMove(e)}if(i||this.isUIWindow){if(this.isInDesignMode()){this.onPointerMoveEditing(t,false)}else if(this.enable){this.onPointerMoveRunning(e,true);this.onPointerMoveRunning(e,false)}}}this.lastPosition.x=t.x;this.lastPosition.y=t.y;return false};UIElement.prototype.onPointerUpNormal=function(t){if(this.hitTestResult){var e=this.translatePoint(t);var i=this.isClicked();if(this.isInDesignMode()){this.onPointerUpEditing(t,true)}else if(this.enable){this.onPointerUpRunning(e,true)}if(i&&this.enable){this.onClick(e,true)}var n=this.getPointerEventTarget();if(n){n.onPointerUp(e)}else{if(this.isInDesignMode()){this.handlePointerEvent(t,-1)}}if(this.isInDesignMode()){this.onPointerUpEditing(t,false)}else{if(this.dragging){this.handleDragUp(t)}else if(this.enable){this.onPointerUpRunning(e,false)}}if(i&&this.enable){this.onClick(e,false)}this.hitTestResult=Shape.HIT_TEST_NONE;if(this.longPressed){this.longPressed=false}if(this.isUIWindow){UIElement.hScrollHandledBy=null;UIElement.vScrollHandledBy=null}return true}else{this.targetShape=null;if(!this.isInDesignMode()&&this.enable){this.onPointerUpRunning(e,false);if(i){this.onClick(e,false)}}if(this.longPressed){this.longPressed=false}var n=this.getPointerEventTarget();if(n){var e=this.translatePoint(t);n.onPointerUp(e)}if(this.isUIWindow){
UIElement.hScrollHandledBy=null;UIElement.vScrollHandledBy=null}}return false};UIElement.prototype.needDrawTextTips=function(t){return this.isInDesignMode()&&!this.children.length};UIElement.prototype.textEditable=function(t){return this.isInDesignMode()};UIElement.prototype.isClicked=function(){if(!this.view){return false}if(this.longPressed&&this.events["onLongPress"]){console.log("Long Pressed, Ignore Click Event.");return false}return this.view.isClicked()};UIElement.prototype.onKeyDownRunning=function(code){if(!this.handleKeyDown||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onKeyDown"];if(sourceCode){sourceCode="this.handleKeyDown = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyDown){try{this.handleKeyDown(code)}catch(e){console.log("this.handleKeyDown:"+e.message)}}return true};UIElement.prototype.onKeyDownEditing=function(t){};UIElement.prototype.onKeyDown=function(t){if(this.targetShape){this.targetShape.onKeyDown(t)}if(this.isInDesignMode()){this.onKeyDownEditing(t)}else{this.onKeyDownRunning(t)}return};UIElement.prototype.onKeyUpRunning=function(code){if(!this.handleKeyUp||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onKeyUp"];if(sourceCode){sourceCode="this.handleKeyUp = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyUp){try{this.handleKeyUp(code)}catch(e){console.log("this.handleKeyUp:"+e.message)}}else if(this.isUIWindow&&code==KeyEvent.DOM_VK_BACK_BUTTON&&!cantkIsEditorActive()){console.log("Back Key Pressed On: "+this.name);if(this.isMainWindow()){var app=this.getApp();var wm=this.getWindowManager();if(this.mode===Shape.MODE_RUNNING){wm.systemExit();app.exitApp();console.log("Back Key Pressed, Exit App.")}}else{this.closeWindow(0);console.log("Back Key Pressed, Close Current Window.")}}return true};UIElement.prototype.onKeyUpEditing=function(t){};UIElement.prototype.onKeyUp=function(t){if(t===KeyEvent.DOM_VK_BACK&&this.isUIWindow){this.closeWindow(0);return}if(this.targetShape){this.targetShape.onKeyUp(t)}if(this.isInDesignMode()){this.onKeyUpEditing(t)}else{this.onKeyUpRunning(t)}return};UIElement.prototype.afterSetView=function(){return true};UIElement.prototype.setView=function(t){this.view=t;for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setView(t)}this.afterSetView(t);return};UIElement.prototype.setApp=function(t){this.app=t;for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setApp(t)}return};UIElement.prototype.shapeCanBeChild=function(t){return true};UIElement.prototype.onAppendedInParent=function(){if(this._win){delete this._win}};UIElement.prototype.setParent=function(t){if(!t){this.detachNameFromParent()}this.parentShape=t;return this};Object.defineProperty(UIElement.prototype,"name",{set:function(t){this.detachNameFromParent();this._name=t;this.attachNameToParent()},get:function(){return this._name}});UIElement.prototype.setName=function(t){if(this.name!==t){this.name=t}return this};UIElement.prototype.detachFromParent=function(){var t=this.getParent();if(t){if(t.targetShape===this){t.targetShape=null}if(t.pointerEventTarget===this){t.pointerEventTarget=null}this.detachNameFromParent()}this.parentShape=null};UIElement.prototype.attachNameToParent=function(){var t=this.getParent();if(t){if(!this.isInDesignMode()){var e=this.name;if(t[e]===undefined){t[e]=this}else{UIElement.logWarning("skip duplicated name:"+e)}}}return this};UIElement.prototype.detachNameFromParent=function(){var t=this.getParent();if(t){if(!this.isInDesignMode()){var e=this.name;var i=t[e];if(i===this){delete t[e]}}}return this};UIElement.prototype.afterChildAppended=function(t){if(this.isUILayout){this.relayoutChildren()}return true};UIElement.prototype.beforeAddShapeIntoChildren=function(t){return true};UIElement.prototype.addShapeIntoChildren=function(t,e){var i={x:0,y:0,w:0,h:0};for(var n=this.children.length-1;n>=0;n--){var r=this.children[n];if(r===t)continue;if(r.isContainer&&r.visible){i.x=r.left;i.y=r.top;i.w=r.w;i.h=r.h;if(isPointInRect(e,i)){return r.addShape(t,true,e)}}}return false};UIElement.prototype.addChildWithJson=function(t,e){var i=t.type?t.type:t.id;var n=ShapeFactoryGet().createShape(i,C_CREATE_FOR_USER);if(n){n.fromJson(t);this.addShape(n,false,null,e||n.z);n.setVisible(true);n.attachNameToParent()}return n};UIElement.prototype.setAlwaysOnTop=function(t){this.alwaysOnTop=t;return};UIElement.onAddShape=function(t,e){};UIElement.prototype.fixName=function(){var t=this;var e=this.getParent();if(!t.name){t.name=t.type}var i=t.name;if(!this.isInDesignMode()){t.name=t.name+"_"+Date.now()+"_"+Math.round(Math.random()*1e4);return}i=i.replaceAll("-","_");var n=i;var r=i.lastIndexOf("_");var o=i.substring(r+1);var a=Math.abs(parseInt(o));var s;if(!isNaN(a)){n=i.slice(0,r);s=a}else{s=1}for(var a=s;a<1e3;a++){if(e.find(i)){if(n[n.length-1]==="_"){i=n+a}else{i=n+"_"+a}}else{break}}t.name=i;return this};UIElement.prototype.addShape=function(t,e,i,n){if(!t.isUIElement){return false}if(t.parentShape){UIElement.logWarning("child has a parent, cannot call addChild again.");return false}if(e){t.moveDelta(-this.left,-this.top)}if(this.beforeAddShapeIntoChildren(t)&&i){var r=this.translatePoint(i);if(this.addShapeIntoChildren(t,r)){return true}t.setLeftTop(r.x,r.y)}if(!this.shapeCanBeChild(t)){return false}t.setParent(this);t.setView(this.view);t.setApp(this.app);var o=this.children;var a=o.length;if(n===undefined){if(a){n=this.children[a-1].z+1}else{n=0}}o.push(t);t.setZIndex(n);a=o.length;if(t.isUIElement){t.setMode(this.mode,true);if(!this.isInDesignMode()){t.init()}}for(var s=0;s<o.length;s++){var h=o[s];if(h.alwaysOnTop){o.remove(h);o.push(h);break}}if(t.isCreatingElement()){t.callOnBirthedHandler(true)}t.onAppendedInParent();this.afterChildAppended(t);UIElement.onAddShape(t,e);return true};UIElement.prototype.appendChild=function(t){var e=this.children;var i=e.length;if(t.z===undefined){t.z=i}if(!i){e.push(t);return}for(var n=i-1;n>=0;n--){var r=e[n];if(r.z<=t.z){e.splice(n+1,0,t);return}}e.splice(0,0,t);return};UIElement.prototype.addShapeDirectly=function(t){if(!this.shapeCanBeChild(t)){return false}this.setDisableRelayout(true);t.setDisableRelayout(true);t.setParent(this);t.setView(this.view);t.setApp(this.app);this.appendChild(t);if(t.isUIElement){t.mode=this.mode}this.afterChildAppended(t);t.onAppendedInParent();this.setDisableRelayout(false);t.setDisableRelayout(false);return true};UIElement.prototype.addChild=function(t,e){if(this.addShape(t,false,null,e||t.z)){t.attachNameToParent();return t}else{return null}};UIElement.prototype.shapeCanBeRemove=function(t){return true};UIElement.prototype.afterChildRemoved=function(t){return true};UIElement.prototype.remove=function(t,e){var i=this.getParent();if(i){i.removeChild(this,t,e)}return this};UIElement.prototype.removeAll=function(){var t=this.children.length;for(var e=0;e<t;e++){var i=this.children[0];this.removeShape(i)}return};UIElement.prototype.removeChildren=function(t){this.targetShape=null;this.pointerEventTarget=null;var e=this.children.length;for(var i=0;i<e;i++){var n=this.children[i];if(n.getParent()===this){n.onRemoved(this);n.setParent(null);n.setView(null);n.setApp(null)}}if(t){this.children.clear()}else{this.children.length=0}return this};UIElement.prototype.removeChild=function(t,e,i){var n=this;if(t.animatingInfo){UIElement.logWarning("removing animating element.")}if(i){this.removeShape(t,e)}else{t.removed=true;setTimeout(function(){n.removeShape(t,e);t=null;n=null},0)}if(this.targetShape===t){this.targetShape=null}if(this.pointerEventTarget===t){this.pointerEventTarget=null}return this};UIElement.onRemoveShape=function(t,e){};UIElement.prototype.removeShape=function(t,e){if(!this.shapeCanBeRemove(t)||!t.parentShape){return false}if(t.animatingInfo){UIElement.logWarning("removing animating element.")}this.children.remove(t);t.callOnRemovedHandler();this.afterChildRemoved(t);if(t.getParent()===this){t.setParent(null);t.setView(null);t.setApp(null)}if(this.isUILayout){this.relayoutChildren()}UIElement.onRemoveShape(this,t);t.onRemoved(this);if(e){t.destroy()}return};UIElement.prototype.reparent=function(t,e){var i=this.getParent();if(t===i){return}if(!t||!i){return}if(e){var n=i.getPositionInWindow();var r=t.getPositionInWindow();var o=n.x-r.x;var a=n.y-r.y;this.left+=o;this.top+=a}i.children.remove(this);t.addShapeDirectly(this);return};UIElement.prototype.afterPropertyChanged=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.getIndexOfChild=function(t){return this.children.indexOf(t)};UIElement.prototype.getIndex=function(){if(this.parentShape){return this.parentShape.getIndexOfChild(this)}else{return-1}};UIElement.prototype.getZIndex=function(){return this.z};UIElement.prototype.onRestack=function(){};UIElement.prototype.setZIndex=function(t){this.z=t;var e=this.parentShape;if(e){var i=e.children;var n=i.length;for(var r=0;r<n;r++){var o=i[r];if(o.z===undefined){o.z=r}}i.stableSort(function(t,e){return t.z-e.z})}this.onRestack();return this};UIElement.prototype.findChildByType=function(t,e){var i=0;var n=null;var r=null;var o=this.children.length;for(i=0;i<o;i++){r=this.children[i];if(r.type===t){return r}}if(e){for(i=0;i<o;i++){r=this.children[i];n=r.findChildByType(t,e);if(n){return n}}}return null};UIElement.prototype.findChildByPath=function(t){var e=t.shift();var i=this.findChildByName(e);if(t.length){return i.findChildByPath(t)}return i};UIElement.prototype.findChildByName=function(t,e){var i=0;var n=null;var r=null;var o=this.children.length;for(i=0;i<o;i++){r=this.children[i];if(r.name===t){return r}}if(e){for(i=0;i<o;i++){r=this.children[i];n=r.findChildByName(t,e);if(n){return n}}}return null};UIElement.prototype.find=function(t,e){if(!t){return this}if(t.indexOf("/")>=0){var i=t.split("/");i.remove("");return this.findChildByPath(i)}else{return this.findChildByName(t,e)}};UIElement.prototype.setValueOf=function(t,e){var i=this.findChildByName(t,true);return i?i.setValue(e):null};UIElement.prototype.getValueOf=function(t){var e=this.findChildByName(t,true);return e?e.getValue():null};UIElement.prototype.beforePaintChild=function(t,e){return};UIElement.prototype.afterPaintChild=function(t,e){return};UIElement.prototype.paintTargetShape=function(t){var e=this.targetShape;if(e&&(this.isUIList&&this.isInDesignMode()||this.isUIGrid)){shape=e;this.beforePaintChild(shape,t);shape.paintSelf(t);this.afterPaintChild(shape,t)}return};UIElement.prototype.defaultPaintChildren=function(t){t.save();t.beginPath();var e=null;var i=this.children.length;for(var n=0;n<i;n++){e=this.children[n];if(!e){continue}if(e.visible){this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}else if(e.isAnimating()){e.stepAnimation(t)}}this.paintTargetShape(t);t.restore();return};UIElement.prototype.beforePaintChildren=function(t){if(!this.rotateChildren&&this.rotation){var e=this.w>>1;var i=this.h>>1;t.translate(e,i);t.rotate(-this.rotation);t.translate(-e,-i)}return};UIElement.prototype.afterPaintChildren=function(t){return};UIElement.prototype.paintChildren=function(t){this.defaultPaintChildren(t);return};UIElement.prototype.paintSelfOnly=function(t){return};UIElement.prototype.drawImageAtCenter=function(t,e,i,n,r,o,a){if(e&&e.width>0){var s=e.width;var h=e.height;if(a){var l=Math.min(1,Math.min(o/h,r/s));var u=s*l;var p=h*l;var c=(r-u>>1)+i;var f=(o-p>>1)+n;c=Math.max(c,i);f=Math.max(f,n)}else{c=i;f=n;u=r;p=o}t.drawImage(e,0,0,s,h,c,f,u,p)}return};UIElement.prototype.drawImage=function(t){this.drawFgImage(t);return};UIElement.prototype.drawFgImage=function(t){return};UIElement.prototype.getBgHtmlImage=function(){var t=this.getBgImage();return t?t.getImage():null};UIElement.prototype.getBgImage=function(){var t=null;if(this.enable){if(this.pointerDown&&!this.isClicked()){t=this.images.normal_bg}else{if(this.pointerDown){t=this.images.active_bg}else{if(this.isPointerOverShape()&&this.getHtmlImageByType(UIElement.IMAGE_POINTER_OVER)){t=this.images.pointer_over_bg}else if(this.isFocused()){t=this.images.focused_bg}else{t=this.images.normal_bg}}}}else{t=this.images.disable_bg}if(!t||!t.getImage()){t=this.images.default_bg}if(!t||!t.getImage()){t=this.images.normal_bg}if(!t||!t.getImage()){return}return t};UIElement.prototype.drawImageAt=function(t,e,i,n,r,o,a,s){UIElement.drawImageAt(t,e,i,n,r,o,a,s)};UIElement.drawImageAt=function(t,e,i,n,r,o,a,s){return WImage.draw(t,e,i,n,r,o,a,s)};UIElement.drawImageLine=function(t,e,i,n,r,o){var a=Math.lineAngle(n,r);var s=Math.round(Math.distanceBetween(n,r));t.save();t.translate(n.x,n.y);t.rotate(a);t.translate(0,-e.height>>1);UIElement.drawImageAt(t,e,i,0,0,s,e.height,o);t.restore();return};UIElement.prototype.setImageScale=function(t,e){this.imageScaleX=t;this.imageScaleY=e;this.images.display=UIElement.IMAGE_DISPLAY_SCALE;return this};UIElement.prototype.drawBgImageScale=function(t,e,i,n,r){var o=this._w;var a=this._h;var s=o>>1;var h=a>>1;t.save();t.translate(s,h);t.scale(n,r);t.translate(-s,-h);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,o,a,i);t.restore()};UIElement.prototype.drawBgImage=function(t){var e=this.getBgImage();if(e){var i=e.image;var n=e.rect;var r=this.images.display;var o=this.imageScaleX;var a=this.imageScaleY;if(o===1&&a===1||!o&&!a||r!==UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,i,r,0,0,this.w,this.h,n)}else{this.drawBgImageScale(t,i,n,o,a)}}return};UIElement.prototype.beforeDrawIcon=function(t){return false};UIElement.prototype.afterDrawIcon=function(t){return false};UIElement.prototype.prepareStyle=function(t){var e=this.style;t.beginPath();if(t.lineWidth!==e.lineWidth){t.lineWidth=e.lineWidth}if(t.strokeStyle!=e.lineColor){t.strokeStyle=e.lineColor}if(t.fillStyle!=e.fillColor){t.fillStyle=e.fillColor}return};UIElement.prototype.updateTransform=function(t){if(this.events["onUpdateTransform"]||this.hasEventListener("updatetransform")){if(!this.isInDesignMode()){this.callOnUpdateTransformHandler(t)}}return};UIElement.prototype.saveTransform=function(){this.savedTransform={};this.savedTransform.opacity=this.opacity;this.savedTransform.scale=this.scale;this.savedTransform.scaleX=this.scaleX;this.savedTransform.scaleY=this.scaleY;this.savedTransform.rotation=this.rotation;this.savedTransform.offsetX=this.offsetX;this.savedTransform.offsetY=this.offsetY;return};UIElement.prototype.restoreTransform=function(){if(this.savedTransform){this.opacity=this.savedTransform.opacity;this.scale=this.savedTransform.scale;this.scaleX=this.savedTransform.scaleX;this.scaleY=this.savedTransform.scaleY;this.rotation=this.savedTransform.rotation;this.offsetX=this.savedTransform.offsetX;this.offsetY=this.savedTransform.offsetY}return};UIElement.prototype.setHighlightConfig=function(t){if(t){var e=JSON.parse(JSON.stringify(t));e.startTime=0;this.saveTransform();this.removeHighlightConfig=false;this.highlightConfig=e;if(e.rotationFrom!==undefined&&e.rotationTo!==undefined){e.rotationRange=e.rotationTo-e.rotationFrom;e.rotationMiddle=(e.rotationTo+e.rotationFrom)/2}else{e.rotationRange=0}if(e.opacityFrom!==undefined&&e.opacityTo!==undefined){e.opacityRange=e.opacityTo-e.opacityFrom;e.opacityMiddle=(e.opacityTo+e.opacityFrom)/2}else{e.opacityRange=0}if(e.scaleFrom!==undefined&&e.scaleTo!==undefined){e.scaleRange=e.scaleTo-e.scaleFrom;e.scaleMiddle=(e.scaleTo+e.scaleFrom)/2}else{e.scaleRange=0}if(e.scaleXFrom!==undefined&&e.scaleXTo!==undefined){e.scaleXRange=e.scaleXTo-e.scaleXFrom;e.scaleXMiddle=(e.scaleXTo+e.scaleXFrom)/2}else{e.scaleXRange=0}if(e.scaleYFrom!==undefined&&e.scaleYTo!==undefined){e.scaleYRange=e.scaleYTo-e.scaleYFrom;e.scaleYMiddle=(e.scaleYTo+e.scaleYFrom)/2}else{e.scaleYRange=0}if(e.offsetXFrom!==undefined&&e.offsetXTo!==undefined){e.offsetXRange=e.offsetXTo-e.offsetXFrom;e.offsetXMiddle=(e.offsetXTo+e.offsetXFrom)/2}else{e.offsetXRange=0}if(e.offsetYFrom!==undefined&&e.offsetYTo!==undefined){e.offsetYRange=e.offsetYTo-e.offsetYFrom;e.offsetYMiddle=(e.offsetYTo+e.offsetYFrom)/2}else{e.offsetYRange=0}}else{this.removeHighlightConfig=true}return};UIElement.prototype.updateHighlightTransform=function(t){var e=this.timeScaleIsZero()||this.isInDesignMode()&&this.disablePreview;if(this.highlightConfig&&!e){var i=this.highlightConfig;if(i.paused)return;var n=this;var r=0;var o=i.random?i.random/1e3:0;var a=i.frequency?i.frequency:4;if(i.startTime){r=(t.now-i.startTime)/1e3}else{i.startTime=Date.now()}r+=1/(a*4)+o;var s=a*Math.PI*2;var h=this.scaleTime(Math.cos(s*r)*.5);if(this.removeHighlightConfig&&Math.abs(h)<.1){this.removeHighlightConfig=false;this.highlightConfig=null;this.restoreTransform();return}if(i.rotationRange){this.rotation=i.rotationMiddle+i.rotationRange*h}if(i.opacityRange){this.opacity=i.opacityMiddle+i.opacityRange*h}if(i.scaleRange){var l=i.scaleMiddle+i.scaleRange*h;this.scaleX=l;this.scaleY=l}if(i.scaleXRange){this.scaleX=i.scaleXMiddle+i.scaleXRange*h}if(i.scaleYRange){this.scaleY=i.scaleYMiddle+i.scaleYRange*h}if(i.offsetXRange){this.offsetX=i.offsetXMiddle+i.offsetXRange*h}if(i.offsetYRange){this.offsetY=i.offsetYMiddle+i.offsetYRange*h}t.needRedraw++}return};UIElement.prototype.paintSelf=function(t){this.stepAnimation(t);if(!this.visible)return;var e=this.animating;t.save();this.translate(t);if(!e){this.updateTransform(t)}if(this.highlightConfig){this.updateHighlightTransform(t)}this.applyTransform(t);this.onClip(t);t.save();var i=this.flipX?-1:1;var n=this.flipY?-1:1;if(i<0||n<0){t.save();var r=this.w>>1;var o=this.h>>1;t.translate(r,o);t.scale(i,n);t.translate(-r,-o)}if(this.beforePaint){this.beforePaint(t)}this.drawBgImage(t);this.paintSelfOnly(t);this.drawImage(t);if(i<0||n<0){t.restore()}t.restore();if(this.children.length||this.isInDesignMode()){t.save();if(e){t.animating++}this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);if(e){t.animating--}t.restore()}if(this.drawText&&this.textType!==Shape.TEXT_NONE){this.drawText(t);this.drawTextTips(t)}if(this.afterPaint){this.afterPaint(t)}t.restore();return};UIElement.prototype.saveProps=[];UIElement.prototype.urlProps=["dataURL"];UIElement.saveProps=["xAttr","yAttr","widthAttr","heightAttr","xParam","yParam","widthParam","heightParam","sticky","flipX","flipY","rotateChildren","defaultAnimationName","dataURL","disablePreview","dataSourceUrl","imageScaleX","imageScaleY","propagatePointerEvent"];UIElement.prototype.doToJsonCustom=function(t){t.propertySheetDesc=this.propertySheetDesc;for(var e in t.propertySheetDesc){var i=this[e];if(i!==undefined){t[e]=i}}return this};UIElement.prototype.doToJson=function(t){this.updateLayoutParams();RShape.prototype.doToJson.call(this,t);t.runtimeVisible=this.runtimeVisible;if(this.isUILoadingWindow){t.isUILoadingWindow=true}if(this.value!==undefined){t.value=this.value}this.propsToJson(t,this.saveProps);this.propsToJson(t,UIElement.saveProps);if(this.urlProps){for(var e=0;e<this.urlProps.length;e++){var i=this.urlProps[e];var n=t[i];if(n){t[i]=this.getRelativePathOfURL(n)}}}this.imagesToJson(t);t.events=this.events;if(this.animations){t.animations=JSON.parse(JSON.stringify(this.animations))}if(this.handle){t.handle={};t.handle.x=this.handle.x;t.handle.y=this.handle.y}if(this.settings){t.settings=this.settings}if(this.propertySheetDesc){this.doToJsonCustom(t)}this.childrenToJson(t);return t};UIElement.prototype.childToJson=function(t){return t.toJson()};UIElement.prototype.childrenToJson=function(t){var e=this.children.length;var i=this.children;t.children=[];for(var n=0;n<e;n++){var r=i[n];t.children.push(this.childToJson(r))}return this};UIElement.prototype.childrenFromJson=function(t){if(t.children){var e=t.children.length;var i=ShapeFactoryGet();this.children.clear(true);for(var n=0;n<e;n++){var r=t.children[n];if(!r){console.log("Warning: child is null.");continue}var o=r.type?r.type:r.id;var a=i.createShape(o,C_CREATE_FOR_USER);if(a){if(r.z===undefined){r.z=n}a.z=r.z;if(this.addShapeDirectly(a)){a.fromJson(r)}}}}this.targetShape=null;this.pointerEventTarget=null;return};UIElement.prototype.doFromJsonCustom=function(t){this.propertySheetDesc=t.propertySheetDesc;for(var e in t.propertySheetDesc){var i=t[e];if(i!==undefined){this[e]=i}}};UIElement.prototype.doFromJson=function(t){RShape.prototype.doFromJson.call(this,t);if(t.runtimeVisible===undefined){this.runtimeVisible=true}else{this.runtimeVisible=t.runtimeVisible}if(t.isUILoadingWindow){this.isUILoadingWindow=true}this.propsFromJson(t,UIElement.saveProps);this.propsFromJson(t,this.saveProps);Object.keys(t.events).forEach(function(e){this.events[e]=t.events[e]},this);this.imagesFromJson(t);if(t.animations){this.animations=t.animations}else if(this.animations){delete this.animations}if(t.handle){this.handle={};this.handle.x=t.handle.x;this.handle.y=t.handle.y}if(t.settings){this.settings=t.settings}if(t.propertySheetDesc){this.doFromJsonCustom(t)}if(t.value!==undefined){this.value=t.value;this.setValue(this.getValue())}this.childrenFromJson(t);return this};UIElement.prototype.afterApplyFormat=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.findChildByPoint=function(t,e,i){var n=t;var r=this.children.length;for(var o=r;o>0;o--){var a=this.children[o-1];if(!a.visible)continue;if(a.hitTest(n)){if(i&&!i(a)){continue}if(e){var s={};s.x=n.x-a.left+(a.xOffset||0);s.y=n.y-a.top+(a.yOffset||0);return a.findChildByPoint(s,e,i)}else{return a}}else{if(e){var s={};s.x=n.x-a.left+(a.xOffset||0);s.y=n.y-a.top+(a.yOffset||0);var h=a.findChildByPoint(s,e,i);if(h!==a){return h}}}}return this};UIElement.prototype.findShapeByPoint=UIElement.prototype.findChildByPoint;UIElement.prototype.getChildren=function(){return this.children};UIElement.prototype.getChildrenNr=function(){return this.children.length};UIElement.prototype.getChild=function(t){return t<this.children.length&&t>=0?this.children[t]:null};UIElement.prototype.canBindingData=function(){return!this.isUIDevice&&!this.isUIScreen&&!this.isUIWindowManager&&this.children.length>0};UIElement.prototype.onDataBindingTemplate=function(t){if(this.isUIImage){var e=this.getImageByType(UIElement.IMAGE_DEFAULT);var i=e?e.getImageSrc():"";i=this.getRelativePathOfURL(i);t.image=i}else{if(this.value!==undefined){t.value=this.value}}if(this.text||this.isUILabel){t.text=this.text}return t};UIElement.prototype.getDataBindingTemplate=function(){var t=0;var e=null;var i={};var n=this.children;var r=this.children.length;this.onDataBindingTemplate(i);if(r>0){i.children=[];for(t=0;t<r;t++){e=n[t];if(!this.childIsBuiltin(e)){i.children.push(e.getDataBindingTemplate())}}}return i};UIElement.prototype.setUserData=function(t){this.userData=t;return};UIElement.prototype.getUserData=function(){return this.userData};UIElement.prototype.onBindData=function(t){var e=t.text;var i=t.image;var n=t.value;if(e!==undefined){this.setText(e)}if(i!==undefined){this.setImage(UIElement.IMAGE_DEFAULT,i)}if(n!==undefined){this.setValue(n)}if(t.enable!==undefined){this.setEnable(t.enable)}if(t.visible!==undefined){this.setVisible(t.visible)}if(t.textColor){this.style.setTextColor(t.textColor)}if(t.fillColor){this.style.setFillColor(t.fillColor)}if(t.lineColor){this.style.setLineColor(t.lineColor)}if(t.fontSize){this.style.setFontSize(t.fontSize)}this.setUserData(t.userData);if(t.height){this.h=t.height}if(t.width){this.w=t.width}if(this.offset){this.offset=0}var r=["children","text","value","image","visible","enable","textColor","fillColor","lineColor","fontSize","userData"];for(var o in t){if(r.indexOf(o)>=0)continue;var n=t[o];var a=this.find(o,true);if(!a)continue;if(typeof n==="object"){a.doBindData(n)}else{a.setValue(n)}}return};UIElement.prototype.moveMustBeLastItemToLast=function(){var t=null;var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=e[n];if(r.name==="ui-last"){t=r;e[n]=e[i-1];e[i-1]=t;break}}return};UIElement.prototype.childIsBuiltin=function(t){return false};UIElement.makeImageURLToAbsOfJson=function(t){if(!t){return}var e=t.images;var i=window.location.protocol+"//"+window.location.host+"/";for(var n in e){var r=e[n];if(n!=="display"){if(r.indexOf("http://")<0&&r.indexOf("https://")<0){r=i+r;e[n]=r}}}if(!t.children){return}for(var o=0;o<t.children.length;o++){var a=t.children[o];UIElement.makeImageURLToAbsOfJson(a)}return};UIElement.prototype.getTemplateChildJson=function(){if(!this.templateChildJson){var t=this.getTemplateChild();this.templateChildJson=t?t.toJson():null;UIElement.makeImageURLToAbsOfJson(this.templateChildJson);if(this.templateChildJson){delete this.templateChildJson.isTemplate}else{console.log("No Template Child.")}}return this.templateChildJson};UIElement.prototype.getTemplateChild=function(){if(!this.templateChild){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isTemplate){this.children.remove(e);this.templateChild=e;break}}if(!this.templateChild){this.templateChild=this.getLastUserChild()}}return this.templateChild};UIElement.prototype.dupTemplateChild=function(){var t=this.getTemplateChild().clone();delete t.isTemplate;return t};UIElement.prototype.dupChild=function(t,e){var i=this.findChildByName(t);if(i){var n=i.clone();if(isNaN(e)){e=i.z+1}this.addShape(n,false,null,e);n.fixName();return n}else{return null}};UIElement.prototype.getLastUserChild=function(){var t=this.children;var e=this.children.length;if(e>0){for(var i=e-1;i>=0;i--){var n=t[i];if(!this.childIsBuiltin(n)){return n}}}return null};UIElement.prototype.countUserChildren=function(){var t=0;var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(!this.childIsBuiltin(r)){t=t+1}}return t};UIElement.prototype.setDisableRelayout=function(t){this.disableRelayout=t;return this};UIElement.prototype.bindData=function(t,e,i){var n=this;n.setDisableRelayout(true);n.doBindData(t,i);n.setDisableRelayout(false);n.relayoutChildren(e);console.log("bindData: done");n.postRedraw();return this};UIElement.prototype.doBindData=function(t,e){var i=0;var n=0;var r=null;var o=this.isUIList||this.isUIGrid?this.getTemplateChildJson():null;this.onBindData(t);var a=this.children;var s=this.countUserChildren();if(s<1&&!o||!t.children){return}var h=t.children.length;if(this.isUIList||this.isUIGrid){if(h>s){o.y=0;o.visible=true;for(i=s;i<h;i++){this.addChildWithJson(o)}}else if(h<s&&e){var l=[];n=s-h;for(i=this.children.length-1;i>=0;i--){var r=this.children[i];if(!this.childIsBuiltin(r)&&!r.isTemplate){l.push(r)}}for(var i=0;i<l.length;i++){var r=l[i];if(i===n){break}this.children.remove(r);r.setParent(null);r.setApp(null);r.setView(null)}}s=this.children.length}else{s=this.children.length}for(i=0,n=0;n<s&i<h;n++){r=a[n];if(!this.childIsBuiltin(r)){r.doBindData(t.children[i]);i=i+1}}return};UIElement.prototype.bindDataUrl=function(t,e,i){var n={};var r=this;httpGetJSON(t,function(t){if(e){t=e(t)}if(t){r.bindData(t,"default",true)}if(i){i(t)}});return};function UIElementCreator(t){t=t?t:"ui-element";var e=[t,"UI-Element",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIElement;return e.initUIElement(this.type)};return}UIElement.prototype.sortChildren=function(){return};UIElement.prototype.shouldShowContextMenu=function(){return this.isInDesignMode()};UIElement.prototype.setText=function(t,e){if(this.text!=t){this.text=this.toText(t);if(e){this.callOnChangedHandler(t)}this.textNeedRelayout=true}this.postRedraw();return this};UIElement.prototype.getValue=function(){return this.getText()};UIElement.prototype.setValue=function(t,e,i){var n=this;var r=this.getText()||0;t=String(t);if(t==String(r))return this;if(!!i&&!isNaN(+t)&&!isNaN(+r)){var o=t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0;this.animate({duration:300,valueEnd:+t,valueStart:+r,onStep:function(t,e,i){n.setText(i.value.toFixed(o));return true},onDone:function(e,i){n.setText(t);console.debug("element setValue onDone")}})}else{this.setText(t)}return this};UIElement.prototype.addValue=function(t,e,i){var n=this.getValue();var r=String(n).indexOf(":");if(r==-1){n=+n;var o=(isNaN(n)?0:n)+(isNaN(+t)?0:+t);var a=u(String(n));var s=u(String(t));var h=u(String(o));var l=a>s?a:s;l=l>h?h:l;function u(t){return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}return this.setValue(o.toFixed(l),e,i)}else{var p=+n.substr(0,r);var c=+n.substr(r+1,2);var f=(isNaN(p)?0:p*60)+(isNaN(c)?0:c);var d=f+t>>0;if(isNaN(+t)||d<0){return this}else{var p=Math.floor(d/60);var c=d%60;p=p<10?"0"+p:p;c=c<10?"0"+c:c;return this.setValue(p+":"+c)}}};UIElement.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.parentShape;while(n!=null){t+=n.getX();e+=n.getY();if(n.isUIVScrollView){e=e-n.offset}else if(n.isUIHScrollView){t=t-n.offset}else if(n.isUIScene||n.isUIScrollViewX){t=t-n.xOffset;e=e-n.yOffset}n=n.parentShape}i.x=t;i.y=e;return i};UIElement.prototype.getLocaleText=function(t){var e=webappGetText(t);if(!e){return t}if(!this.locale){this.locale={text:e};this.needRelayout=true}return e};UIElement.prototype.getLocaleInputTips=function(t){var e=webappGetText(t);return e?e:t};UIElement.prototype.setBgImage=function(t){return this.setImage(UIElement.IMAGE_DEFAULT,t)};UIElement.prototype.onImageLoad=function(){this.postRedraw()};UIElement.prototype.getDefaultImageType=function(){return UIElement.IMAGE_DEFAULT};UIElement.prototype.setImage=function(t,e){var i=this;var n=arguments.length;if(n<2){e=t;t=this.getDefaultImageType()}else{t=t?t:this.getDefaultImageType()}var r=null;if(e===null||e===undefined){r=WImage.create(null)}else if(typeof e==="object"){if(e.image){r=e}else{r=WImage.createWithImage(e)}}else if(typeof e==="number"||e.length<4){r=this.images["option_image_"+e]}else{r=WImage.create(e,this.onImageLoad.bind(this))}this.images[t]=r;return this};UIElement.prototype.getHtmlImageByType=function(t){if(typeof t==="number"){t="option_image_"+t}var e=this.images[t];return e?e.getImage():null};UIElement.prototype.getImageByType=function(t){if(typeof t==="number"){t="option_image_"+t}return this.images[t]};UIElement.prototype.getImageSrcByType=function(t){if(typeof t==="number"){t="option_image_"+t}var e=this.images[t];return e?e.getImageSrc():""};UIElement.prototype.getImageTypes=function(){var t=[];for(var e in this.images){var i=this.images[e];if(e!="display"){t.push(e)}}return t};UIElement.prototype.addEventNames=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];if(!this.events[i]){this.events[i]=null}}}return this};UIElement.prototype.removeEventNames=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];delete this.events[i]}}return this};UIElement.prototype.getEventNames=function(){var t=[];for(var e in this.events){t.push(e)}return t};UIElement.uidStart=1e4+Math.floor(Math.random()*1e4);UIElement.prototype.initUIElement=function(t){this.initContainerShape(t);this.enable=true;this.visible=true;this.opacity=1;this.vMargin=0;this.hMargin=0;this.xAttr=UIElement.X_FIX_LEFT;this.yAttr=UIElement.Y_FIX_TOP;this.widthAttr=UIElement.WIDTH_FIX;this.heightAttr=UIElement.HEIGHT_FIX;this.name=t;this.events={};this.uid=UIElement.uidStart++;this.runtimeVisible=true;this.images={};this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.addEventNames(["onClick"]);return this};UIElement.prototype.updateLayoutParams=function(){var t=this.parentShape;if(!t){return}this.xParam=1;this.yParam=1;this.widthParam=1;this.heightParam=1;var e=t.getRelayoutWidth();var i=t.getRelayoutHeight();if(this.xAttr===UIElement.X_SCALE){this.xParam=this.left/e}else if(this.xAttr===UIElement.X_FIX_RIGHT){this.xParam=e-(this.left+this.w)}if(this.yAttr===UIElement.Y_SCALE){this.yParam=this.top/i}else if(this.yAttr===UIElement.Y_FIX_BOTTOM){this.yParam=i-(this.top+this.h)}if(this.widthAttr===UIElement.WIDTH_SCALE){this.widthParam=this.w/e;this.widthScaleMin=this.w>>1;this.widthScaleMax=this.w<<1}if(this.heightAttr===UIElement.HEIGHT_SCALE){this.heightParam=this.h/i;
this.heightScaleMin=this.h>>1;this.heightScaleMax=this.h<<1}if(this.heightAttr===UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH){this.heightParam=this.h/this.w}return this};UIElement.prototype.imagesToJson=function(t){t.images={};for(var e in this.images){var i=this.images[e];if(e==="display"){t.images[e]=i}else{var n=i.getImageSrc();n=this.getRelativePathOfURL(n);if(n){t.images[e]=n;var r=n.indexOf("#");if(r>0){var o=i.getRealImageSrc();o=this.getRelativePathOfURL(o);var a=n.substr(0,r);if(o&&o.indexOf(n)<0){t.images["real-image-"+a]=decodeURI(o)}}}}}return t};UIElement.prototype.imagesFromJson=function(t){if(t.images){for(var e in t.images){var i=t.images[e];if(e==="display"){this.images[e]=i}else if(e.indexOf("real-image")!==0){this.setImage(e,i)}}}return};UIElement.prototype.getEnable=function(){return this.enable};UIElement.prototype.setEnable=function(t){this.enable=t;return this};UIElement.prototype.isEnable=function(){var t=this;if(!this.isValid()){return false}while(t!=null){if(!t.enable){return false}t=t.parentShape}return true};UIElement.prototype.getVisible=function(t){return this.visible};UIElement.prototype.setVisible=function(t){this.visible=t;if(!t){if(this.animatingInfo){UIElement.logWarning("hide animating element invisble.")}}return this};UIElement.prototype.isVisible=function(){var t=this;if(!this.isValid()){return false}while(t!=null){if(!t.visible){return false}t=t.parentShape}return true};UIElement.prototype.isFocused=function(){return this.parentShape&&this.parentShape.targetShape==this};UIElement.prototype.onShowHTML=function(){return};UIElement.prototype.onHideHTML=function(){return};UIElement.prototype.showHTML=function(){var t=0;var e=this.children.length;for(t=0;t<e;t++){var i=this.children[t];i.showHTML()}this.onShowHTML();return};UIElement.prototype.hideHTML=function(){var t=0;var e=this.children.length;for(t=0;t<e;t++){var i=this.children[t];i.hideHTML()}this.onHideHTML();return};UIElement.prototype.show=function(){return this.setVisible(true)};UIElement.prototype.hide=function(){return this.setVisible(false)};UIElement.prototype.beforeRelayout=function(){};UIElement.prototype.afterRelayout=function(){};UIElement.prototype.getPrevSibling=function(){if(!this.parentShape||this.parentShape.children.length<2){return null}var t=0;for(t=0;t<this.parentShape.children.length;t++){if(this.parentShape.children[t]===this){break}}return t>0?this.parentShape.children[t-1]:null};UIElement.prototype.setAutoScaleFontSize=function(t){this.enableAutoScaleFontSize=t;return this};UIElement.prototype.autoScaleFontSize=function(t){if(this.enableAutoScaleFontSize){var e=Math.round(this.style.fontSize*t);e=Math.min(e,36);e=Math.max(e,12);this.style.setFontSize(e)}return};UIElement.prototype.getRelayoutWidth=function(){return this.getWidth()};UIElement.prototype.getRelayoutHeight=function(){return this.getHeight()};UIElement.prototype.relayout=function(){if(this.disableRelayout){return}var t=getParentShapeOfShape(this);if(!t||!t.isUIElement){if(this.isInDesignMode()){this.setUserMovable(true);this.setUserResizable(true)}}if(this.isUIDevice){this.setUserResizable(false)}if(!t){this.relayoutChildren();return}var e=0;var i=0;var n=0;var r=0;var o=this.xAttr;var a=this.yAttr;var s=t.getRelayoutWidth();var h=t.getRelayoutHeight();var l=t.getHMargin();var u=t.getVMargin();var p=s-l-l;var c=h-u-u;var f=this.top+this.h;var d=this.left+this.w;this.beforeRelayout();switch(this.widthAttr){case UIElement.WIDTH_SCALE:{e=s*this.widthParam;if(this.widthScaleMin&&e<this.widthScaleMin){if(this.pointerDown){this.widthScaleMin=e}else{e=this.widthScaleMin}}if(this.widthScaleMax&&e>this.widthScaleMax){if(this.pointerDown){this.widthScaleMax=e}else{e=this.widthScaleMax}}break}case UIElement.WIDTH_FILL_PARENT:{e=p;this.left=l;o=UIElement.X_FIX_LEFT;break}default:{e=this.w;break}}switch(this.heightAttr){case UIElement.HEIGHT_SCALE:{i=h*this.heightParam;if(this.heightScaleMin&&i<this.heightScaleMin){if(this.pointerDown){this.heightScaleMin=i}else{i=this.heightScaleMin}}if(this.heightScaleMax&&i>this.heightScaleMax){if(this.pointerDown){this.heightScaleMax=i}else{i=this.heightScaleMax}}break}case UIElement.HEIGHT_FILL_PARENT:{i=c;this.top=u;a=UIElement.Y_FIX_TOP;break}default:{i=this.h;break}}switch(o){case UIElement.X_SCALE:{n=s*this.xParam;break}case UIElement.X_FIX_RIGHT:{n=s-this.xParam-this.w;break}case UIElement.X_CENTER_IN_PARENT:{n=s-e>>1;break}case UIElement.X_LEFT_IN_PARENT:{n=l;break}case UIElement.X_RIGHT_IN_PARENT:{n=s-e-l;break}default:{n=this.left;break}}switch(a){case UIElement.Y_SCALE:{r=h*this.yParam;break}case UIElement.Y_FIX_BOTTOM:{r=h-this.yParam-this.h;break}case UIElement.Y_MIDDLE_IN_PARENT:{r=h-i>>1;break}case UIElement.Y_TOP_IN_PARENT:{r=u;break}case UIElement.Y_BOTTOM_IN_PARENT:{r=h-i-u;break}default:{r=this.top;break}}if(this.widthAttr===UIElement.WIDTH_FILL_TO_PARENT_RIGHT){e=s-n-l}if(this.heightAttr===UIElement.HEIGHT_FILL_TO_PARENT_BOTTOM){i=h-r-u}if(this.heightAttr===UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH){i=e*this.heightParam}var I=this.w;this.w=Math.round(e);this.h=Math.round(i);this.setLeftTop(n,r);if(t.isUIElement){if(this.isInDesignMode()){var g=this.getWindow();if(g&&!g.isUIScene&&!g.isUIDialog){t.fixChildSize(this)}}t.fixChildPosition(this)}this.setSize(this.w,this.h);this.autoScaleFontSize(e/I);this.relayoutChildren();this.afterRelayout();this.setTextNeedRelayout(true);return};UIElement.prototype.beforeRelayoutChild=function(t){return true};UIElement.prototype.afterRelayoutChild=function(t){return true};UIElement.prototype.relayoutChildren=function(){if(this.disableRelayout||!this.children){return}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||e.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){continue}if(this.beforeRelayoutChild(e)){e.relayout()}this.afterRelayoutChild(e)}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(!(e.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||e.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE)){continue}if(this.beforeRelayoutChild(e)){e.relayout()}this.afterRelayoutChild(e)}return};UIElement.prototype.getWindowManager=function(){return UIWindowManager.getInstance()};UIElement.prototype.getDevice=function(){var t=this;while(t!=null&&!t.isUIDevice){t=t.parentShape}return t};UIElement.prototype.getDeviceConfig=function(){var t=this.getWindowManager();if(t){return t.getDeviceConfig()}return null};UIElement.prototype.getTopWindow=function(){var t=this.getWindowManager();return t.getCurrentWindow()};UIElement.prototype.setAssetsLoadingWindow=function(t){var e=this.getWindowManager();if(e){e.setAssetsLoadingWindow(t)}return this};UIElement.prototype.isTopWindow=function(){var t=this.getWindow();return t===this.getTopWindow()};UIElement.prototype.getWindow=function(){var t=this;while(t!=null&&!t.isUIWindow){t=t.parentShape}return t};UIElement.prototype.getPositionInWindow=function(){var t=this.getAbsLeftTop();var e=this.anchor;if(e){t.x+=e.x*this.w;t.y+=e.y*this.h}return t};UIElement.prototype.getAbsLeftTop=function(){var t=this;var e=t.left;var i=t.top;while(t!=null&&!t.isUIWindow){t=t.parentShape;if(t.isUIWindow){break}e=e+t.left;i=i+t.top}return{x:e,y:i}};UIElement.prototype.localToGlobal=function(t){var e=this.getAbsLeftTop();e.x+=t.x;e.y+=t.y;return e};UIElement.prototype.globalToLocal=function(t){var e=this.getAbsLeftTop();e.x=t.x-e.x;e.y=t.y-e.y;return e};UIElement.prototype.getWindowNames=function(){var t=this.getWindowManager();if(t){return t.getWindowNames()}return[]};UIElement.prototype.openScene=function(t,e){var i=this.getWindowManager();setTimeout(function(){i.openWindow(t,null,true,e)},0)};UIElement.prototype.isWindowOpen=function(t){var e=this.getWindowManager();var i=e.find(t);return i&&i.isOpen()};UIElement.prototype.openWindow=function(t,e,i,n,r){var o=this.getWindowManager();if(o){return o.openWindow(t,e,i,n,r)}return false};UIElement.prototype.closeAllWindows=function(){var t=this.getWindowManager();if(t){t.closeAll()}return};UIElement.prototype.backToHomeWin=function(){var t=this.getWindowManager();if(t){t.backToHomeWin()}return};UIElement.prototype.closeWindow=function(t,e){var i=this.getWindow();var n=this.getWindowManager();if(n&&i){if(i.isOpen()){return n.closeWindow(i,t,e)}else{console.log("Current Window Is Not Open.")}}return false};UIElement.prototype.canBeComponent=function(){return true};UIElement.prototype.isCreatingElement=function(){if(this.view&&this.view.creatingShape===this){return true}return false};UIElement.prototype.onScaleForDensityDone=function(t,e){};UIElement.prototype.setNotScaleForDensity=function(t){this.notScaleForDensity=t;return};UIElement.prototype.scaleForDensity=function(t,e,i){if(!t||t===1||this.notScaleForDensity){return}if(this.widthAttr===UIElement.WIDTH_FIX){this.w=Math.floor(this.w*t)}if(this.heightAttr===UIElement.HEIGHT_FIX){this.h=this.h*t;if(this.h<36&&(this.isUIButton||this.isUIProgressBar||this.isUIColorTile||this.isUIColorButton||this.isUIEdit||this.isUIRadioBox||this.isUICheckBox||this.isUIWaitBar||this.isUISwitch)){this.h=40}if(this.h<50&&(this.isUIToolBar||this.isUIButtonGroup)){this.h=50}if(this.hMin>this.h){this.hMin=this.h}}var n=this.isCreatingElement();if(!n&&this.yAttr===UIElement.Y_FIX_TOP){this.top=Math.floor(this.top*t)}if(!n&&this.xAttr===UIElement.X_FIX_LEFT){this.left=Math.floor(this.left*t)}this.style.setFontSize(Math.floor(this.style.fontSize*t));if(this.itemHeight>20){this.itemHeight=Math.floor(this.itemHeight*t)}if(this.roundRadius){this.roundRadius=Math.floor(this.roundRadius*t)}this.vMargin=Math.floor(this.vMargin*t);this.hMargin=Math.floor(this.hMargin*t);if(this.buttonHeight>40){this.buttonHeight=Math.floor(this.buttonHeight*t)}this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.w=Math.round(this.w);this.h=Math.round(this.h);if(i){for(var r=0;r<this.children.length;r++){var o=this.children[r];o.scaleForDensity(t,e,true)}}if(this.isUIProgressBar){var a=this.getValue();this.setValue(0);this.setValue(a)}this.onScaleForDensityDone(t,e);return};UIElement.prototype.onDeviceConfigChanged=function(t,e){return};UIElement.prototype.fixImagePath=function(t,e){var i=t.version;var n=t.platform;var r=t.lcdDensity;var o=e.version;var a=e.platform;var s=e.lcdDensity;for(var h in this.images){var l=this.images[h];if(h==="display"){continue}var u=l.getImageSrc();if(u){u=u.replaceAll("/"+r+"/","/"+s+"/");l.setImageSrc(u)}}return};UIElement.prototype.scaleForCurrentDensity=function(t){var e=this.getDeviceConfig();var i=this.getDensitySizeByName(e?e.lcdDensity:"hdpi");return t*(i/160)};UIElement.prototype.getDensitySizeByName=function(t){switch(t){case"ldpi":{return 80}case"mdpi":{return 160}case"hdpi":{return 240}case"xhdpi":{return 350}case"xxhdpi":{return 450}default:{console.log("not supported density: "+t)}}return 160};UIElement.prototype.getSizeScale=function(t,e){var i=this.getDensitySizeByName(t);var n=this.getDensitySizeByName(e);var r=n/i;return r};UIElement.prototype.notifyDeviceConfigChanged=function(t,e){for(var i=0;i<this.children.length;i++){var n=this.children[i];n.notifyDeviceConfigChanged(t,e)}this.fixImagePath(t,e);this.onDeviceConfigChanged(t,e);return};UIElement.prototype.addMovementForVelocityTracker=function(){if(this.velocityTracker){var t={};t.x=this.getMoveAbsDeltaX();t.y=this.getMoveAbsDeltaY();var e=Date.now()*1e6;this.velocityTracker.addMovement(e,t);delete date}return};UIElement.prototype.isUserMovable=function(){return this.userMovable&&!this.isLocked()};UIElement.prototype.isUserResizable=function(){return this.userResizable};UIElement.prototype.getEditorRect=function(){var t={};t.x=this.left;t.y=this.top;t.w=this.w;t.h=this.h;return t};UIElement.funcs=[];UIElement.setAnimTimer=function(t,e){return UIElement.setTimeout(t,e)};UIElement.setTimeout=function(t,e){e=e?Math.max(e,16):16;t.deltaTime=e;t.time=Date.now()+e;UIElement.funcs.push(t);function i(){var t=UIElement.funcs;var e=Date.now();var n=t.length;UIElement.funcs=[];for(var r=0;r<n;r++){var o=t[r];if(o.time<=e){if(o()){o.time=e+o.deltaTime;UIElement.funcs.push(o)}}else{UIElement.funcs.push(o)}}t=null;if(UIElement.funcs.length){UIElement.animTimerID=requestAnimFrame(i)}else{UIElement.animTimerID=0}}if(!UIElement.animTimerID){UIElement.animTimerID=requestAnimFrame(i,16)}return};UIElement.getMainCanvas=function(){return CantkRT.getMainCanvas()};UIElement.getMainCanvasScale=function(t){return CantkRT.getMainCanvasScale()};UIElement.prototype.isFullscreenMode=function(){return cantkIsFullscreen()};UIElement.prototype.setFlipX=function(t){this.flipX=t;return this};UIElement.prototype.setFlipY=function(t){this.flipY=t;return this};UIElement.prototype.getFlipX=function(){return this.flipX};UIElement.prototype.getFlipY=function(){return this.flipY};UIElement.prototype.requestFullscreen=function(t){if(!isMobile()){if(t){t(false)}console.log("UIElement.requestFullScreen Rejected(not mobile)")}else{if(!cantkRequestFullscreen(t)){t(false)}console.log("UIElement.requestFullScreen")}return};UIElement.prototype.pickFiles=function(t,e){return showFileDialog(t,true,false,e)};UIElement.prototype.pickFile=function(t,e){if(!window.FileReader){return false}showFileDialog(t,false,true,function(t){var i=t[0];if(i){var n=new FileReader;n.readAsDataURL(i);n.onloadend=function(){if(e){e(i,n.result)}n=null}}});return true};UIElement.prototype.pickAudio=function(t){return this.pickFile("audio/*",t)};UIElement.prototype.pickImage=function(t){return this.pickFile("image/*",t)};UIElement.fixArtTextStyle=function(t){t.fontSize=t.fontSize?t.fontSize:16;t.imageBorder=t.imageBorder?t.imageBorder:10;t.textAlignH=t.textAlignH?t.textAlignH:"left";t.startColor=t.startColor?t.startColor:"Green";t.endColor=t.endColor?t.endColor:"Green";t.lineWidth=t.lineWidth?t.lineWidth:0;t.lineColor=t.lineColor?t.lineColor:"Black";t.shadowColor=t.shadowColor?t.shadowColor:"Black";t.shadowBlur=t.shadowBlur?t.shadowBlur:0;t.shadowOffsetX=t.shadowOffsetX?t.shadowOffsetX:0;t.shadowOffsetY=t.shadowOffsetY?t.shadowOffsetY:0;return t};UIElement.createArtTextImage=function(t,e,i){UIElement.fixArtTextStyle(e);if(!t){return null}var n=300;var r=80;var o=e.imageBorder;var a=e.fontSize;var s=e.fontFamily;var h=e.textAlignH;var l=e.monospace;var u=cantkGetTempCanvas(n,r);var p=u.getContext("2d");p.clearRect(0,0,n,r);var c=n>>1;var f=r>>1;var d="";var I=t.length;if(e.textB){d+="Bold "}if(e.textI){d+="Italic "}d+=a+"pt '"+s+"'";p.font=d;p.textBaseline="middle";p.textAlign="center";switch(h){case"left":{c=o;p.textAlign="left";break}case"right":{c=n-o;p.textAlign="right";break}default:break}if(l){var g=0;for(var m=0;m<I;m++){var v=t[m];var y=p.measureText(v).width;if(y>g){g=y}}g=g+4;n=I*g}else{var U=p.measureText(t).width;n=U+o*2}r=e.fontSize+2*(Math.abs(e.shadowOffsetY)+e.shadowOffsetY+o);u.width=n;u.height=r;if(i){p.fillStyle=i;p.fillRect(0,0,n,r)}p.font=d;p.textBaseline="middle";p.textAlign="center";if(e.useTexture&&e.texture){var S=WImage.create(e.texture);var w=S.getImage();if(w){var E=p.createPattern(w,"repeat");p.fillStyle=E}}else{if(e.startColor!=e.endColor){var T=p.createLinearGradient(0,0,0,r);if(e.horizonalGradient){T=p.createLinearGradient(0,0,n,0)}T.addColorStop(0,e.startColor);T.addColorStop(1,e.endColor);p.fillStyle=T}else{p.fillStyle=e.startColor}}if(e.shadowBlur){p.shadowOffsetX=e.shadowOffsetX;p.shadowOffsetY=e.shadowOffsetY;p.shadowBlur=e.shadowBlur;p.shadowColor=e.shadowColor}c=n>>1;f=r>>1;p.lineWidth=e.lineWidth;p.strokeStyle=e.lineColor;if(l){c=0;var C=g>>1;var I=t.length;p.textAlign="center";for(var m=0;m<I;m++){c=m*g+C;var v=t[m];p.fillText(v,c,f);p.strokeText(v,c,f)}}else{p.fillText(t,c,f);if(p.lineWidth){p.strokeText(t,c,f)}}var M=u.toDataURL();return M};ShapeFactoryGet().addShapeCreator(new UIGroupCreator(200,200,null));UIElement.prototype.timeScaleIsZero=function(){return Math.abs(this.getTimeScale())<1e-5};UIElement.prototype.getTimeScale=function(){return this.win.getTimeScale()};UIElement.prototype.scaleTime=function(t){return this.win.getTimeScale()*t};UIElement.prototype.setTimeScale=function(t){this.win.setTimeScale(t);return this};UIElement.prototype.getAppInfo=function(){var t=this.view.getMetaInfo();return t.general};UIElement.logNotice=function(t){console.log("%cNotice: "+t,"color: green; font-weight: bold")};UIElement.logWarning=function(t){console.log("%cWarning: "+t,"color: red; font-weight: bold")};UIElement.logError=function(t,e){console.log("%cWarning: "+t+"("+e.message+")\n"+e.stack,"color: red; font-weight: bold")};UIElement.prototype.isPointIn=function(t,e){var i=false;if(t){t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();i=t.isPointInPath(e.x,e.y)}else{i=isPointInRect(e,this)}return i};UIElement.prototype.pInPolygon=function(t,e,i){var n=false;for(var r=0,o=t.length-1;r<t.length;o=r++){if(t[r].y>i!=t[o].y>i&&e<(t[o].x-t[r].x)*(i-t[r].y)/(t[o].y-t[r].y)+t[r].x)n=!n}return n};UIElement.prototype.isPointInMatrix=function(t,e,i){var n=t.x,r=t.y,o=t.w,a=t.h,s={x:n,y:r},h={x:n+o,y:r},l={x:n+o,y:r+a},u={x:n,y:r+a},p=Matrix2D.identity;p.beginPath=function(){};p.clip=function(){};p.rect=function(){};p.arc=function(){};try{i.call(this,p)}catch(c){console.debug("applyTransform catch err",err)}var f=p.transformPoint(s.x,s.y),d=p.transformPoint(h.x,h.y),I=p.transformPoint(l.x,l.y),g=p.transformPoint(u.x,u.y),m=[f,d,I,g];p.identity();return this.pInPolygon(m,e.x,e.y)};UIElement.prototype.setImageDisplay=function(t){this.images.display=t;return this};UIElement.prototype.getPointerDeviceType=function(){return WEventsManager.getInstance().getPointerDeviceType()};function UIElementCreator(t){var e=[t,"ui-element",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIElement;return e.initUIElement(this.type)};return}UIElement.prototype.clearAssetsCache=function(t){this.getWindowManager().clearAssetsCache(t);return this};UIElement.prototype.loadAssets=function(t,e,i){ResLoader.reset();this.getWindowManager().loadAssets(t,e,i);return this};UIElement.prototype.createElement=function(t){return ShapeFactoryGet().createShape(t,C_CREATE_FOR_PROGRAM)};ShapeFactoryGet().addShapeCreator(new UIElementCreator("ui-element"));UIElement.audioAssets=["soundURL"];UIElement.imagesAssets=["textureURL"];UIElement.jsonAssets=["textureJsonURL","skeletonJsonURL","soundURL","dataURL"];UIElement.assets=UIElement.audioAssets.concat(UIElement.jsonAssets,UIElement.imagesAssets);Object.defineProperty(UIElement.prototype,"win",{get:function(){if(!this._win){this._win=this.getWindow()}return this._win},set:function(t){console.log("Warning: can not set window.")},enumerable:false,configurable:true});function UIGroup(){return}UIGroup.prototype=new UIElement;UIGroup.prototype.isUIGroup=true;UIGroup.prototype.initUIGroup=function(t,e,i,n){this.initUIElement(t);this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);this.style.lineColor="rgba(0,0,0,0)";this.style.fillColor="rgba(0,0,0,0)";this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UIGroup.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIListItem){return false}return true};UIGroup.prototype.onPointerUpEditing=function(t,e){return};UIGroup.prototype.fixChildPosition=function(t){};UIGroup.prototype.fixChildSize=function(t){};UIGroup.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();drawRoundRect(t,this.w,this.h,this.roundRadius);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke()}}return};UIGroup.prototype.onPositionChanged=function(){var t=this.children;var e=t.length;for(var i=0;i<e;i++){var n=t[i];if(n.isUIBody||n.isUIGroup||n.isUIEdge){n.onPositionChanged()}}return};function UIGroupCreator(t,e,i){var n=["ui-group","ui-group",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIGroup;return r.initUIGroup(this.type,t,e,i)};return}UIGroup.create=function(){var t=new UIGroup;t.initUIGroup("ui-group",200,200,null);t.state=Shape.STAT_NORMAL;return t};function UIWindow(){return}UIWindow.serialNo=0;UIWindow.prototype=new UIElement;UIWindow.prototype.isUIWindow=true;UIWindow.prototype.saveProps=["openAnimationDuration","closeAnimationDuration","animHint","windowType","closeWhenPointerUpOutside","refLinesV","refLinesH","windowNameToBeOpen","preloadWindows","isUILoadingWindowV2","isUILoadingWindow","sceneId"];UIWindow.prototype.fromJson=function(t){this.jsonData=t;this.name=t.name;if(t.isUILoadingWindow){RShape.prototype.fromJson.call(this,t)}else{Object.keys(t.events).forEach(function(e){this.events[e]=t.events[e]},this)}return this};UIWindow.prototype.fromJsonNow=function(t){RShape.prototype.fromJson.call(this,t);this.relayout();return this};UIWindow.prototype.onGesture=function(t){if(!this.isInDesignMode()){this.callOnGestureHandler(t)}return};UIWindow.prototype.onMultiTouch=function(t,e,i){this.callOnMultiTouchHandler(t,e,i)};UIWindow.prototype.isMainWindow=function(){var t=this.getWindowManager();var e=t.history[0];var i=t.children[e];return i===this};UIWindow.prototype.getTimeScale=function(){return this.timeScale};UIWindow.prototype.setTimeScale=function(t){this.timeScale=t;return this};UIWindow.prototype.initUIWindow=function(t,e,i,n,r,o){this.initUIElement(t);this.timeScale=1;this.setLeftTop(e,i);this.settings={};this.setDefSize(n,r);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,o);this.setName("window-"+UIWindow.serialNo++);if(!o){this.style.setFillColor("White")}this.addEventNames(["onSystemInit","onLoad","onOpen","onBeforeOpen","onClose","onSwitchToBack","onSwitchToFront","onGesture","onKeyDown","onKeyUp"]);this.setAnimHint("htranslate");this.oldHitTest=this.hitTest;this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.intervals=[];this.timeouts=[];return this};UIWindow.prototype.setAnimHint=function(t){this.animHint=t;return true};UIWindow.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow){return false}return true};UIWindow.prototype.onModeChanged=function(){if(this.isInDesignMode()){this.popupWindow=null}return};UIWindow.prototype.removePopupWindow=function(t){if(this.popupWindow){if(this.popupWindow===t){this.popupWindow=t.popupWindow;if(this.popupWindow){this.popupWindow.parentWindow=this}t.parentWindow=null;t.popupWindow=null;return true}return this.popupWindow.removePopupWindow(t)}return false};UIWindow.prototype.setPopupWindow=function(t){if(this===t){return false}if(this.popupWindow){return this.popupWindow.setPopupWindow(t)}else{this.popupWindow=t;if(t){t.parentWindow=this}}return true};UIWindow.prototype.getPopupWindow=function(){if(this.popupWindow){return this.popupWindow.getPopupWindow()}return this.isUIPopupWindow?this:null};UIWindow.prototype.isGrabElement=function(t){return this.grabElement===t};UIWindow.prototype.grab=function(t){this.grabElement=t;return};UIWindow.prototype.ungrab=function(t){this.grabElement=null;return};UIWindow.prototype.dispatchPointerDownToChildren=function(t){if(this.grabElement){this.grabElement.onPointerDown(t);this.setTarget(this.grabElement);return true}return this.defaultDispatchPointerDownToChildren(t)};UIWindow.prototype.onPointerDownNormal=function(t){this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y;if(this.popupWindow){this.popupWindow.onPointerDownNormal(t);this.setTarget(this.popupWindow);this.pointerDown=false;if(!this.popupWindow||!this.popupWindow.shouldPropagatePointerEvent()){return true}}return UIElement.prototype.onPointerDownNormal.call(this,t)};UIWindow.prototype.onDoubleClick=function(t){if(this.popupWindow){this.popupWindow.onDoubleClick(t);if(!this.popupWindow||!this.popupWindow.shouldPropagatePointerEvent()){return true}}return UIElement.prototype.onDoubleClick.call(this,t)};UIWindow.prototype.onPointerMoveNormal=function(t){if(this.popupWindow){this.popupWindow.onPointerMoveNormal(t);if(!this.popupWindow||!this.popupWindow.shouldPropagatePointerEvent()){return true}}return UIElement.prototype.onPointerMoveNormal.call(this,t)};UIWindow.prototype.onPointerUpNormal=function(t){if(this.popupWindow){this.popupWindow.onPointerUpNormal(t);if(!this.popupWindow||!this.popupWindow.shouldPropagatePointerEvent()){return true}}if(!this.pointerDown){return true}if(!this.isInDesignMode()&&this.enable){var e=this.lastPosition.x-this.pointerDownPosition.x;var i=this.lastPosition.y-this.pointerDownPosition.y;var n=Math.abs(e);var r=Math.abs(i);var o=this.lastPosition;var a=this.pointerDownPosition;if(n>20||r>20){if(n>>1>r){if(e<0){this.callOnSwipeLeftHandler(a,o)}else{this.callOnSwipeRightHandler(a,o)}}if(r>>1>n){if(i<0){this.callOnSwipeUpHandler(a,o)}else{this.callOnSwipeDownHandler(a,o)}}}}return UIElement.prototype.onPointerUpNormal.call(this,t)};UIWindow.prototype.paintSelfOnly=function(t){var e=this.opacity;if(e!==1){t.globalAlpha*=e}this.clearBackground(t);this.drawBgImage(t);return};UIWindow.prototype.beforePaintChildren=function(t){t.globalAlpha=1};UIWindow.prototype.paintSelf=function(t){var e=t.timeStep;t.timeStep=this.scaleTime(e);if(this.isInDesignMode()){UIElement.prototype.paintSelf.call(this,t)}else{t.save();this.translate(t);this.updateTransform(t);this.paintSelfOnly(t);this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);t.restore()}if(this.popupWindow&&!this.popupWindow.closePending){t.timeStep=this.popupWindow.scaleTime(e);this.popupWindow.paintSelf(t)}t.timeStep=e;return};UIWindow.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIWindow.prototype.hide=function(){this.setVisible(false);this.hideHTML();cantkHideAllInput();return};UIWindow.prototype.setCloseWhenPointerUpOutside=function(t){if(t){this.hitTest=function(t){var e=this.oldHitTest(t);if(!e){if(!this.isInDesignMode()){e=Shape.HIT_TEST_MM}}return e}}else{this.hitTest=this.oldHitTest}this.closeWhenPointerUpOutside=t;return};UIWindow.prototype.isAnimationEnabled=function(){return this.animHint&&this.animHint!=="none"};UIWindow.prototype.getAnimationDuration=function(t){return t?this.openAnimationDuration:this.closeAnimationDuration};UIWindow.prototype.getAnimationName=function(t){var e="";switch(this.animHint){case"fade":{e=t?"anim-fade-in":"anim-fade-out";break}case"scale":{if(this.isUIDialog){e=t?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{e=t?"anim-scale-show-win":"anim-scale-hide-win"}break}case"popup":{e=t?"anim-move-up":"anim-move-down";break}case"htranslate":{e=t?"anim-forward":"anim-backward";break}case"vtranslate":{e=t?"anim-upward":"anim-downward";break}default:{if(this.isUIDialog){e=t?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{if(isAndroid()||isFirefoxMobile()){e=t?"anim-scale-show-win":"anim-scale-hide-win"}else{e=t?"anim-forward":"anim-backward"}}break}}return e};UIWindow.prototype.isSplashWindow=function(){return this.isUINormalWindow&&this.windowType==="splash"};UIWindow.prototype.getSupportedAnimations=function(){var t=["none","default","scale","fade","popup"];if(!this.isUIDialog){t=t.concat(["htranslate","vtranslate"])}return t};UIWindow.prototype.clearBackground=function(t){var e=this.images.display;var i=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(i){switch(e){case UIElement.IMAGE_DISPLAY_TILE:case UIElement.IMAGE_DISPLAY_TILE_V:case UIElement.IMAGE_DISPLAY_TILE_H:case UIElement.IMAGE_DISPLAY_SCALE:case UIElement.IMAGE_DISPLAY_9PATCH:case UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO:return;default:break}if(i.width>=this.w&&i.height>=this.h){return}}if(!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};UIWindow.prototype.defaultChildrenFromJson=UIElement.prototype.childrenFromJson;UIWindow.prototype.loadChildren=function(){if(this.childrenJson){this.defaultChildrenFromJson(this.childrenJson);delete this.childrenJson;delete this.pendingLoadChildren;console.log("Now To Load Children Of "+this.name);if(this.scaleInfo){this.scaleForDensity(this.scaleInfo.sizeScale,this.scaleInfo.lcdDensity,true)}var t=this.getWindowManager();var e=t.oldConfig;var i=t.deviceConfig;if(e&&i){this.notifyDeviceConfigChanged(e,i)}}return};UIWindow.prototype.childrenFromJson=function(t){if(t.lazyLoad&&!dappIsEditorApp()){this.childrenJson=t;this.pendingLoadChildren=true;console.log("Delay To Load Children Of "+this.name)}else{delete this.pendingLoadChildren;this.defaultChildrenFromJson(t)}return};UIWindow.prototype.initStageOne=function(){this.callOnInitHandler();this.clearAllTimeouts();this.clearAllIntervals();this.enablePhysics=false;var t=this;this.forEach(function(e){if(e.offset){e.offset=0}e.visible=e.runtimeVisible;if(e.animatingInfo){e.animatingInfo=null;e.animating=false}if(e.animations&&e.animations[e.defaultAnimationName]){console.log(e.name+" has default animation, set it invisible initially.");e.visible=false}if(e.isUIBody||e.isUIEdge){t.enablePhysics=true}});return};UIWindow.prototype.onInit=function(){this.initStageOne();return};UIWindow.prototype.prepareForOpen=function(){if((!this.isUILoadingWindow||this.children.length<1)&&this.jsonData){this.fromJsonNow(this.jsonData)}this.setMode(Shape.MODE_RUNNING,true);this.relayout();return this};UIWindow.prototype.callOnBeforeOpen=function(t){this._open=true;var e=this.getParent();if(e&&e.hasEventListener("windowopen")){var i=e.createEvent("windowopen");i.win=this;e.dispatchEvent(i)}this.show();this.init();return this.callOnBeforeOpenHandler(t)};UIWindow.prototype.callOnOpen=function(t){delete this.openPending;this.getParent().pointerEventTarget=this;if(this.onOpen){try{this.onOpen(t)}catch(e){console.log("onOpen"+e.message)}}this.callOnOpenHandler(t);if(this.isSplashWindow()){var i=this;var n=i.duration?i.duration:3e3;if(window.splashWinTimeID){clearTimeout(window.splashWinTimeID);delete window.splashWinTimeID}window.splashWinTimeID=setTimeout(function(){if(i.visible){i.openWindow(null,null,true)}},n)}this.forEach(function(t){t.onWindowOpen()});return true};UIWindow.prototype.callOnClose=function(t){this._open=false;delete this.closePending;var e=this.getParent();if(e&&e.hasEventListener("windowclose")){var i=e.createEvent("windowclose");i.win=this;e.dispatchEvent(i)}if(this.onClose){try{this.onClose(t)}catch(n){console.log("onClose: "+n.message)}}this.callOnCloseHandler(t);this.deinit();this.hide();if(this.destroyWhenClose){this.getWindowManager().removeChild(this,true)}this.resetEvents();this.clearAllTimeouts();this.clearAllIntervals();var r=this.children;for(var o=0;o<r.length;o++){var a=r[o];a.detachNameFromParent()}this.children=[];if(this.parentWindow){this.parentWindow.popupWindow=this.popupWindow}if(this.popupWindow){this.popupWindow.parentWindow=this.parentWindow}this.popupWindow=null;this.parentWindow=null;setTimeout(function(){r.clear(true)},100);return true};UIWindow.prototype.callOnSwitchToBack=function(t){this.callOnSwitchToBackHandler();if(!t){this.hide()}return true};UIWindow.prototype.callOnSwitchToFront=function(t){if(this.isUINormalWindow&&(this.w!=this.parentShape.w||this.h!=this.parentShape.h)){this.relayout();console.log("WindowManager Size Changed, Relayout Current Window.")}this.show();this.callOnSwitchToFrontHandler();return true};UIWindow.prototype.isOpen=function(){return!!this._open};UIWindow.prototype.setTimeout=function(t,e){if(this.isInDesignMode()){console.log("Can not UIWindow.prototype.setTimeout in edit mode.");
return}if(typeof t!=="function"){console.log("invalid func for UIWindow.prototype.setTimeout");return}function i(){this.timeouts.remove(n);t()}var n=window.setTimeout(i.bind(this),e);this.timeouts.push(n);return n};UIWindow.prototype.clearTimeout=function(t){window.clearTimeout(t);this.timeouts.remove(t)};UIWindow.prototype.setInterval=function(t,e){if(this.isInDesignMode()){console.log("Can not UIWindow.prototype.setInterval in edit mode.");return}if(typeof t!=="function"){console.log("invalid func for UIWindow.prototype.setInterval");return}function i(){t()}var n=window.setInterval(i.bind(this),e);this.intervals.push(n);return n};UIWindow.prototype.clearInterval=function(t){window.clearInterval(t);this.intervals.remove(t)};UIWindow.prototype.clearAllIntervals=function(){var t=this.intervals;for(var e=0;e<t.length;e++){var i=t[e];window.clearInterval(i)}this.intervals.length=0};UIWindow.prototype.clearAllTimeouts=function(){var t=this.timeouts;for(var e=0;e<t.length;e++){var i=t[e];window.clearTimeout(i)}this.timeouts.length=0};UIWindow.prototype.loadInitAssets=function(t,e,i){var n=this;function r(o){if(o.percent>99.9){n.doLoadInitAssets(t,e,i);ResLoader.off(ResLoader.EVENT_ASSETS_LOAD_PROGRESS,r)}}if(ResLoader.isLoadCompleted()){n.doLoadInitAssets(t,e,i)}else{ResLoader.on(ResLoader.EVENT_ASSETS_LOAD_PROGRESS,r)}};UIWindow.prototype.doLoadInitAssets=function(t,e,i){var n=this;var r=n.getParent();if(!t){t=n.findChildByType("ui-progressbar")}if(!i){i=n.findChildByType("ui-label")}if(!e){e=n.preloadWindows}function o(e,o,a){if(i){i.setText("Loading...")}if(t){t.setPercent(e,true)}var s=r.getInitWindow();if(o>=a&&s!=n){r.showInitWindow(n.windowNameToBeOpen)}n.postRedraw()}function a(e,n,o){if(i){if(e>=100){i.setText("Loading...")}else{i.setText("Downloading...")}}if(t){if(e>=100){if(AssetsDownloader.isAvailable()){r.loadAudios();r.loadFonts()}t.setPercent(0,true)}else{t.setPercent(e,true)}}}var s=e?e.split(","):r.getWindowNames(this);if(AssetsDownloader.isAvailable()){s.push("__audios__");s.push("__fonts__")}else{r.loadAudios();r.loadFonts()}r.loadAssets(s,o,a);this.loadInitAssets=function(){};return this};UIWindow.prototype.relayout=function(){if(!this.getWindowManager().isDeviceDirectionOK()){console.log("UIWindow.prototype.relayout Reject Relayout");return}UIElement.prototype.relayout.call(this);return this};ShapeFactoryGet().addShapeCreator(new UINormalWindowCreator(null));function UINormalWindow(){return}UINormalWindow.prototype=new UIWindow;UINormalWindow.prototype.isUINormalWindow=true;function UINormalWindowCreator(t){var e=["ui-window","ui-window",null,1];ShapeCreator.apply(this,e);this.createShape=function(e){var i=new UINormalWindow;i.initUIWindow(this.type,0,0,100,100,t);i.widthAttr=UIElement.WIDTH_FILL_PARENT;i.heightAttr=UIElement.HEIGHT_FILL_PARENT;i.addEventNames(["onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown"]);return i};return}function UIDialog(){return}UIDialog.prototype=new UIWindow;UIDialog.prototype.isUIDialog=true;UIDialog.prototype.isUIPopupWindow=true;UIDialog.prototype.fixChildSize=function(t){return};UIDialog.prototype.fixChildPosition=function(t){return};function UIDialogCreator(t,e,i){var n=["ui-dialog","ui-dialog",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIDialog;r.initUIWindow(this.type,0,0,t,e,i);r.setMargin(8,8);r.xAttr=UIElement.X_CENTER_IN_PARENT;r.yAttr=UIElement.Y_MIDDLE_IN_PARENT;r.images.display=UIElement.IMAGE_DISPLAY_SCALE;r.setAnimHint("scale");return r};return}ShapeFactoryGet().addShapeCreator(new UIDialogCreator(600,400,null));function UIEdit(){return}UIEdit.prototype=new UIElement;UIEdit.prototype.isUIEdit=true;UIEdit.prototype.saveProps=["leftMargin","rightMargin","inputType","inputTips","maxLength"];UIEdit.prototype.initUIEdit=function(t,e,i,n,r,o,a,s){this.initUIElement(t);this.setDefSize(e,i);this.setText(o);this.leftMargin=n;this.rightMargin=r;this.setSizeLimit(60,30,1e3,80);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,a);this.setImage(UIElement.IMAGE_FOCUSED,s);this.setMargin(5,5);this.setInputType("text");this.addEventNames(["onChanged","onChanging","onFocusIn","onFocusOut"]);this.setTextAlignV("middle");this.setTextAlignH("left");this.maxLength=1024;return this};UIEdit.prototype.shapeCanBeChild=function(t){if(t.isUIButton){return true}return false};UIEdit.prototype.textEditable=function(t){return true};UIEdit.prototype.getLocaleText=function(t){if(t===" "){return t}if(this.inputType==="password"&&t&&t===this.text){var e="";var i=t.length;for(var n=0;n<i;n++){e=e+"*"}return e}else{return t}};UIEdit.prototype.drawText=function(t){var e=this.h>>1;var i=this.leftMargin;var n=this.getLocaleText(this.text);var r=this.w-i-this.rightMargin;var o=this.inputTips;if(!n&&!o||this.editing){return}t.save();t.font=this.style.getFont();if(n){t.fillStyle=this.style.textColor}else{n=o;t.fillStyle="#E0E0E0"}t.beginPath();t.rect(0,0,this.w-this.rightMargin,this.h);t.clip();t.textAlign="left";t.textBaseline="middle";t.fillText(n,i,e);t.restore();return};UIEdit.prototype.isFocused=function(){return this.editing};UIEdit.prototype.paintSelfOnly=function(t){var e=this.getBgImage();if(e){return}t.beginPath();drawRoundRect(t,this.w,this.h,8);t.fillStyle=this.style.fillColor;t.fill();t.strokeStyle=this.style.lineColor;t.lineWidth=this.isFocused()?4:2;t.stroke();return};UIEdit.prototype.onClick=function(t,e){if(e){return}if(!this.isInDesignMode()){this.editText()}return this.callOnClickHandler(t)};UIEdit.prototype.getWidth=function(t){var e=this.w;if(t){e=e-this.leftMargin-this.rightMargin}return e};UIEdit.prototype.getEditorRect=function(){var t=this.leftMargin||0;var e=this.getPositionInView();var i=CantkRT.getMainCanvasPosition();var n=this.view.getAbsPosition();var r=this.view.getViewScale();var o=UIElement.getMainCanvasScale();var a=(n.x+(e.x+t)*r)/o.x+i.x;var s=(n.y+e.y*r)/o.y+i.y;var h=this.getWidth(true)*r/o.x;var l=this.getHeight()*r/o.y;var u={x:a,y:s,w:h,h:l};if(this.isInDesignMode()){var p=window.devicePixelRatio||1;u.x*=p;u.y*=p;u.w*=p;u.h*=p}return u};UIEdit.prototype.editText=function(t){var e=this;if(this.textEditable(t)){var i=this;var n=this.getText();var r=this.getEditorRect();var o=this.getRealScale()/UIElement.getMainCanvasScale().y;var a=this.inputType?this.inputType:"text";var s=this.style.fontSize*o;var h=cantkShowInput(a,s,n,r.x,r.y,r.w,r.h);i.editing=true;h.setTextColor(this.style.textColor);h.showBorder(this.isInDesignMode());h.show();function l(t){if(t!==i.text){i.setText(t,true);i.postRedraw()}else{i.text=t}h.setOnChangedHandler(null);h.setOnChangeHandler(null);h.hide();delete i.editing;i.callOnFocusOutHandler();return}function u(t){i.callOnChangingHandler(t)}h.setMaxLength(e.maxLength||1024);h.setOnChangedHandler(l);h.setOnChangeHandler(u);this.callOnFocusInHandler()}return};UIEdit.prototype.drawTextTips=function(t){};function UIEditCreator(t,e,i,n,r,o){var a=["ui-edit","ui-edit",null,1];ShapeCreator.apply(this,a);this.createShape=function(a){var s=new UIEdit;return s.initUIEdit(this.type,t,e,i,n,dappGetText("Edit"),r,o)};return}ShapeFactoryGet().addShapeCreator(new UIEditCreator(120,50,12,12,null,null));function UIGauge(){return}UIGauge.prototype=new UIElement;UIGauge.prototype.isUIGauge=true;UIGauge.IMAGE_POINTER="pointer-image";UIGauge.prototype.initUIGauge=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onInit"]);return this};UIGauge.prototype.shapeCanBeChild=function(t){return t.isUILedDigits||t.isUILabel||t.isUIGaugePointer};UIGauge.prototype.afterChildAppended=function(t){var e=20;var i=0;if(t.isUIGaugePointer){t.xAttr=UIElement.X_CENTER_IN_PARENT;t.yAttr=UIElement.Y_MIDDLE_IN_PARENT}for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.isUIGaugePointer){continue}switch(i){case 0:{e=100;break}case 1:{e=70;break}case 2:{e=40;break}}i=i+1;r.setSizeLimit(e,e,e,e,1);r.setSize(e,e)}this.setSizeLimit(100,100,1e3,1e3,1);return};UIGauge.prototype.paintSelfOnly=function(t){return};function UIGaugeCreator(){var t=["ui-gauge","ui-gauge",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGauge;return e.initUIGauge(this.type,200,200)};return}function UIGaugePointer(){return}UIGaugePointer.prototype=new UIElement;UIGaugePointer.prototype.isUIGaugePointer=true;UIGaugePointer.prototype.saveProps=["minAngle","maxAngle","minValue","maxValue"];UIGaugePointer.prototype.initUIGaugePointer=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIGauge.IMAGE_POINTER,null);this.value=0;this.minAngle=0;this.maxAngle=360;this.minValue=0;this.maxValue=60;return this};UIGaugePointer.prototype.shapeCanBeChild=function(t){return false};UIGaugePointer.prototype.setText=function(t){t=this.toText(t?t:0);try{this.setValue(parseInt(t))}catch(e){console.log("UIGaugePointer.prototype.setText:"+e.message)}return this};UIGaugePointer.prototype.getText=function(){return this.getValue()+""};UIGaugePointer.prototype.setValue=function(t){if(t>=this.minValue&&t<=this.maxValue){this.value=t}else{console.log("UIGaugePointer.prototype.setValue: Out Of Range.")}return this};UIGaugePointer.prototype.getValue=function(){return this.value};UIGaugePointer.prototype.animSetValue=function(t,e){return this.animSetValue(t,e)};UIGaugePointer.prototype.animateSetValue=function(t,e){if(t<this.minValue){t=this.minValue}if(t>this.maxValue){t=this.maxValue}var i=this;var n=t;var r=this.getValue();var o=t-r;var a=Math.abs(o*(this.maxAngle-this.minAngle)/(this.maxValue-this.minValue));if(a<5){this.setValue(t);return}var s=(new Date).getTime();var h=e&&e=="slow"?1e3:500;function l(){var t=new Date;var e=(t.getTime()-s)/h;if(e<1){var a=r+o*e;i.setValue(a);setTimeout(l,10)}else{delete s;i.setValue(n)}delete t;i.postRedraw()}l();return};UIGaugePointer.prototype.getAngle=function(t){var e=this.maxAngle-this.minAngle;var i=this.maxValue-this.minValue;var n=this.value/i*e+this.minAngle;n=Math.PI*(n/180);return n};UIGaugePointer.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=this.w;var r=this.h;var o=this.getAngle();var a=this.getHtmlImageByType(UIGauge.IMAGE_POINTER);if(a&&a.width){var s=a.width;var h=a.height;t.translate(n/2,r/2);t.rotate(o);t.translate(-n/2,-r/2);e=(n-s)/2;i=(r-h)/2;t.drawImage(a,e,i)}else{t.fillRect(0,0,this.w,this.h)}return};function UIGaugePointerCreator(){var t=["ui-gauge-pointer","ui-gauge-pointer",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGaugePointer;return e.initUIGaugePointer(this.type,20,200)};return}ShapeFactoryGet().addShapeCreator(new UIGaugePointerCreator);ShapeFactoryGet().addShapeCreator(new UIGaugeCreator);function UIHtml(){return}UIHtml.prototype=new UIElement;UIHtml.prototype.isUIHtml=true;UIHtml.prototype.saveProps=["htmlContent"];UIHtml.prototype.initUIHtml=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);return this};UIHtml.prototype.shapeCanBeChild=function(t){return false};UIHtml.prototype.drawBgImage=function(t){if(this.isInDesignMode()||this.isIcon){var e=this.getBgImage();if(e){var i=e.getImage();var n=e.getImageRect();this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,n)}else{t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}}return};UIHtml.prototype.scaleElement=function(t,e,i,n,r){var o=n&&r?n+" "+r:"50% 50%";var a=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var s=0;s<a.length;s++){var h=a[s];t.style[h+"-origin"]=o;t.style[h]="scale("+e+","+i+")"}return};UIHtml.prototype.rotateElement=function(t,e){var i="50% 50%";var n=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var r=0;r<n.length;r++){var o=n[r];t.style[o+"-origin"]=i;t.style[o]="rotate("+e+"deg)"}return};UIHtml.prototype.setRotation=function(t){this.rotation=t;if(this.element){this.rotateElement(this.element,t*180/Math.PI)}return this};UIHtml.prototype.setOpacity=function(t){this.opacity=t;if(this.element){this.element.style["opacity"]=t}return this};UIHtml.prototype.setScale=function(t,e){this.scaleX=t;this.scaleY=e;if(this.element){this.scaleElement(this.element,t,e)}return this};UIHtml.prototype.setScaleX=function(t){this.setScale(t,this.scaleY);return this};UIHtml.prototype.setScaleY=function(t){this.setScale(this.scaleX,t);return this};UIHtml.prototype.setVisible=function(t){if(this.element){this.element.style.display=t?"block":"none"}return this};UIHtml.prototype.setPosition=function(t,e){if(this.element){this.element.style.left=t+"px";this.element.style.top=e+"px"}return this};UIHtml.prototype.showHTMLElement=function(){var t=this.element;if(t){var e=this.getPositionInView();var i=CantkRT.getMainCanvasPosition();var n=this.view.getAbsPosition();var r=this.view.getViewScale();var o=UIElement.getMainCanvasScale();var a=(n.x+e.x*r)/o.x+i.x;var s=(n.y+e.y*r)/o.y+i.y;var h=this.getWidth()*r/o.x;var l=this.getHeight()*r/o.y;t.style.position="absolute";t.style.left=a+"px";t.style.top=s+"px";t.style.width=h+"px";t.style.height=l+"px";t.style.visibility="visible";this.htmlVisible=true}return};UIHtml.prototype.createHTMLElement=function(t){var e=null;if(!this.element){e=document.createElement(t);e.id=this.type+this.name;document.body.appendChild(e);this.element=e}return this.element};UIHtml.prototype.beforeShowHTML=function(){};UIHtml.prototype.setScrollable=function(t){this.scrollable=t;return};UIHtml.prototype.onSetElementStyle=function(){var t=Math.floor(this.scaleForCurrentDensity(14));this.element.style.fontSize=t+"px";this.element.style.marginLeft="0px";this.element.style.marginTop="0px";this.element.style.marginBottom="0px";this.element.style.marginRight="0px";return};UIHtml.prototype.onShowHTML=function(){this.reload()};UIHtml.prototype.reload=function(){if(!this.isInDesignMode()){this.createHTMLElement("div");this.element.innerHTML=this.getHtmlContent();this.element.style.overflow=this.scrollable?"scroll":"hidden";this.element.style.zIndex=5;this.element.style["-ms-touch-action"]="auto";this.onSetElementStyle();this.beforeShowHTML();this.showHTMLElement()}return};UIHtml.prototype.beforeHideHTML=function(){};UIHtml.prototype.onHideHTML=function(){this.htmlVisible=false;if(this.element){this.beforeHideHTML();this.element.style.visibility="hidden"}return};UIHtml.prototype.getValue=function(){return this.value};UIHtml.prototype.setValue=function(t){this.value=t;return this};UIHtml.prototype.setHtmlContent=function(t){this.htmlContent=t;if(this.element){this.element.innerHTML=t}return this};UIHtml.prototype.getHtmlContent=function(){return this.htmlContent};Object.defineProperty(UIElement.prototype,"innerHTML",{get:function(){return this.getHtmlContent()},set:function(t){this.setHtmlContent(t);this.reload()},enumerable:false,configurable:true});function UIHtmlCreator(t,e){var i=["ui-html","ui-html",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIHtml;return n.initUIHtml(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlCreator);function UIVideo(){return}UIVideo.prototype=new UIHtml;UIVideo.prototype.isUIVideo=true;UIVideo.prototype.getHtmlContent=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.value?this.value:"";var n=this.loop?'loop="loop" ':"";var r=this.autoPlay?'autoplay="true" ':"";var o=this.showControls?'controls="controls" ':"";var a='<video width="'+t+'" height="'+e+'" preload="true" '+o+n+r+'src="'+i+'"></video>';return a};UIVideo.prototype.beforeHideHTML=function(){video=this.getVideoElement();if(video.src&&!video.puased){video.pause()}return};UIVideo.prototype.getVideoElement=function(){if(this.element){var t=this.element.getElementsByTagName("video");return t.length?t[0]:null}return null};UIVideo.prototype.setShowControls=function(t){this.showControls=t;return};UIVideo.prototype.isShowControls=function(){return this.showControls};UIVideo.prototype.setLoop=function(t){this.loop=t;return};UIVideo.prototype.isLoop=function(){return this.loop};UIVideo.prototype.setAutoPlay=function(t){this.autoPlay=t;return};UIVideo.prototype.isAutoPlay=function(){return this.autoPlay};UIVideo.prototype.initUIVideo=function(t){this.initUIHtml(t,400,300);this.setValue("http://www.w3school.com.cn/i/movie.ogg");this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIVideoCreator(){var t=["ui-video","ui-video",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVideo;return e.initUIVideo(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIVideoCreator);function UIFlash(){return}UIFlash.prototype=new UIHtml;UIFlash.prototype.isUIFlash=true;UIFlash.prototype.getHtmlContent=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.value?this.value:"";var n='<object type="application/x-shockwave-flash" width="'+t+'" height="'+e+'"> <param name="movie" value="'+i+'" /> <param name="quality" value="high" /></object>';return n};UIFlash.prototype.initUIFlash=function(t){this.initUIHtml(t,400,300);this.setValue("test/5.swf");this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIFlashCreator(){var t=["ui-flash","ui-flash",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFlash;return e.initUIFlash(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIFlashCreator);function UIHtmlImage(){return}UIHtmlImage.prototype=new UIHtml;UIHtmlImage.prototype.isUIHtmlImage=true;UIHtmlImage.prototype.getHtmlContent=function(){var t=this.getRealScale();var e=Math.round(t*this.w);var i=Math.round(t*this.h);var n=this.getImageSrcByType(UIElement.IMAGE_DEFAULT);var r='<img src="'+n+'" width='+e+" height="+i+">";return r};UIHtmlImage.prototype.initUIHtmlImage=function(t){this.initUIHtml(t,400,300);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIHtmlImageCreator(){var t=["ui-html-image","ui-html-image",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIHtmlImage;return e.initUIHtmlImage(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlImageCreator);function UIImageView(){return}UIImageView.prototype=new UIElement;UIImageView.prototype.isUIImageView=true;UIImageView.cachedImages={};UIImageView.IMAGE_STATE_PENDING=0;UIImageView.IMAGE_STATE_ERROR=1;UIImageView.IMAGE_STATE_DONE=2;imageViewInitCustomProp=function(t){};imageThumbViewInitCustomProp=function(t){};imageAnimationInitCustomProp=function(t){};imageSlideViewInitCustomProp=function(t){};UIImageView.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.userImages=this.getImages();return t};UIImageView.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.cacheInvalid=true;if(t.userImages){this.userImages=[];var e=t.userImages.split("\n");var i=e.length;for(var n=0;n<i;n++){var r="image_"+(n+1);var o=this.getImageSrcByType(r);if(o&&o.length>4){this.userImages.push(o)}}}return};UIImageView.prototype.initUIImageView=function(t,e){this.setDefSize(t,e);this.userImages=[];this.onSized=UIImageView.prototype.onSized;this.afterRelayout=UIImageView.prototype.afterRelayout;this.setImages=UIImageView.prototype.setImages;this.getImages=UIImageView.prototype.getImages;this.setValue=UIImageView.prototype.setValue;this.getValue=UIImageView.prototype.getValue;this.ensureImages=UIImageView.prototype.ensureImages;this.addUserImage=UIImageView.prototype.addUserImage;this.doToJson=UIImageView.prototype.doToJson;this.doFromJson=UIImageView.prototype.doFromJson;this.onScaleForDensityDone=UIImageView.prototype.onScaleForDensityDone;imageViewInitCustomProp(this);return this};UIImageView.createImage=function(t,e){var i=UIImageView.cachedImages[t];if(!i){i=new Image;i.src=t;i.onLoadDoneListeners=[];function n(t,e){if(!t||!t.onLoadDoneListeners){return}for(var i=0;i<t.onLoadDoneListeners.length;i++){var n=t.onLoadDoneListeners[i];n(t,e)}t.onLoadDoneListeners.clear();return}i.onload=function(t){n(this,true);this.loaded=true};i.onabort=function(t){n(this,false);this.failed=true;console.log("load "+this.src+" failed.")};i.onerror=function(t){n(this,false);this.failed=true;console.log("load "+this.src+" failed.")}}else{console.log("Create Image From Cache: "+t)}if(e){if(i.loaded){e(i,true)}else if(i.failed){e(i,false)}else{i.onLoadDoneListeners.push(e)}}return i};UIImageView.drawImageAtCenter=function(t,e,i,n,r,o,a,s){if(s){t.fillStyle=s;t.fillRect(i,n,r,o)}else{t.clearRect(i,n,r,o)}if(e&&e.width>0){var h=r;var l=o;var u=e.width;var p=e.height;var c=e.width;var f=e.height;if(a){var d=h/c;var I=l/f;if(d<I){u=Math.min(c,h/I)}else{p=Math.min(f,l/d)}}t.drawImage(e,0,0,u,p,i,n,h,l)}return};UIImageView.prototype.ensureImages=function(){if(!this.cacheInvalid){return}var t=this;function e(e,i){t.postRedraw();return}this.cachedImages=[];for(var i=0;i<this.userImages.length;i++){var n=this.userImages[i];var r=UIImageView.createImage(n,e);this.cachedImages.push(r)}delete this.cacheInvalid;return};UIImageView.prototype.afterRelayout=function(){this.cacheInvalid=true;return};UIImageView.prototype.onSized=function(){this.cacheInvalid=true;return};UIImageView.prototype.onScaleForDensityDone=function(){this.cacheInvalid=true;return};UIImageView.prototype.addUserImage=function(t){this.cacheInvalid=true;this.userImages.push(t);var e="image_"+this.userImages.length;this.setImage(e,t);return};UIImageView.prototype.getCurrentImage=function(){return this.curentImage};UIImageView.prototype.getValue=function(){var t=this.getCurrentImage();return t?t.src:null};UIImageView.prototype.setValue=function(t){return this};UIImageView.prototype.setImages=function(t){var e=this.images.display;var i=t.split("\n");this.userImages=[];this.images={};this.images.display=e;for(var n=0;n<i.length;n++){var r=i[n];if(r){this.addUserImage(r)}}return};UIImageView.prototype.getImages=function(){var t="";var e=location.protocol+"//"+location.host+"/";for(var i=0;i<this.userImages.length;i++){var n=this.userImages[i];n=n.replace(e,"");t=t+n+"\n"}return t};function UIScrollView(){return this}UIScrollView.prototype=new UIElement;UIScrollView.prototype.isUIScrollView=true;UIScrollView.prototype.afterChildAppended=function(t){t.setCanRectSelectable(false,true);return true};UIScrollView.prototype.initUIScrollView=function(t,e,i){this.initUIElement(t);this.offset=0;this.scrollBarOpacity=0;this.setMargin(e,e);this.setSizeLimit(100,100,2e3,2e3);this.setDefSize(300+2*e,300+2*e);this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator(2);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,i);this.setScrollable("always");if(!i){this.style.setFillColor("#f0f0f0")}this.setCanRectSelectable(false,true);return this};UIScrollView.prototype.setScrollable=function(t){this.scrollable=t;return};UIScrollView.prototype.fixChildSize=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.w=this.getWidth(true)}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.h=this.getHeight(true)}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false);t.setUserResizable(false)}return};UIScrollView.prototype.shapeCanBeChild=function(t){if(t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage||t.isUIList||t.isUIGrid||t.isUIProgressBar||t.isUICheckBox||t.isUIRadioBox||t.isUIWaitBar||t.isUIButtonGroup||t.isUITips||t.isUIGroup){return true}return false};UIScrollView.prototype.onModeChanged=function(){this.offset=0;return};UIScrollView.prototype.scrollToEnd=function(){var t=this.getScrollRange();this.offset=t-this.h;return this};UIScrollView.prototype.scrollTo=function(t){this.offset=Math.round(t);return};UIScrollView.prototype.scrollDelta=function(t){var e=this.offset+t;this.scrollTo(e);return};UIScrollView.prototype.scrollToPageDelta=function(t){var e=Math.floor(this.offset/this.w)+t;this.scrollToPage(e);return};UIScrollView.prototype.scrollToPage=function(t){if(t<0){t=0}var e=this.w*t;var i=this.offset-e;this.animScrollTo(i,300);return};UIScrollView.prototype.onPointerDownRunning=function(t,e){if(e){return}this.velocityTracker.clear();return};UIScrollView.prototype.onDrag=function(t){return};UIScrollView.prototype.isScrollable=function(){if(this.scrollable==="always"){return true}else if(this.scrollable==="never"){return false}else{var t=this.getScrollRange();var e=this.getPageSize();return t>e}};UIScrollView.prototype.onPointerMoveRunning=function(t,e){if(e||!this.isScrollable()){return}this.scrollBarOpacity=0;var i=this.getScrollDelta(t);if(this.pointerDown&&this.needScroll(t)){this.scrollBarOpacity=1;this.scrollDelta(-i)}this.addMovementForVelocityTracker();this.onDrag(this.offset);return};UIScrollView.prototype.animScrollTo=function(t,e){var i=this;var n=new Date;var r=n.getTime();var o=this.offset;var a=o-t;var s=this.getScrollRange();var h=this.getPageSize();e=e<400?400:e;if(a<0){e=600;t=o}if(!this.isInDesignMode()){if(a>s-h){t=o-(s-h)}}if(s<=h){a=0;t=o}function l(){var n=new Date;var a=n.getTime();var s=(a-r)/e;var h=i.interpolator.get(s);var u=o-t*Math.min(h,1);if(s<1&&!i.pointerDown){setTimeout(l,5);i.scrollTo(u);i.scrollBarOpacity=1-h}else{var u=o-t;i.scrollBarOpacity=0;i.scrollTo(u)}i.postRedraw();return}setTimeout(l,5);return};UIScrollView.prototype.whenScrollOutOfRange=function(t){return};UIScrollView.prototype.onPointerUpRunning=function(t,e){if(e||!this.isScrollable()){return}var i=this.getScrolledSize();if(!this.needScroll(t)){this.scrollBarOpacity=0;return}var n=0;var r=0;var o=this.getVelocity();var a=this.getPageSize();var s=o/a;var h=.5*a*s*s;r=Math.abs(h);n=2*r/o;r=i<0?-r:r;n=Math.abs(n);if(n>3){n=3}var l=this.offset;var u=l-r;var p=this.offset;var c=p+this.h;var f=this.getScrollRange();if(p<0){this.whenScrollOutOfRange(p)}else if(c>f){this.whenScrollOutOfRange(c-f)}this.animScrollTo(r,n*1e3);return true};UIScrollView.prototype.paintSelfOnly=function(t){return};function UIHScrollView(){return}UIHScrollView.prototype=new UIScrollView;UIHScrollView.prototype.isUIHScrollView=true;UIHScrollView.prototype.initUIHScrollView=function(t,e,i){this.initUIScrollView(t,e,i);this.setSizeLimit(100,40,2e3,2e3);return this};UIHScrollView.prototype.needScroll=function(t){var e=Math.abs(this.getMoveAbsDeltaX());var i=Math.abs(this.getMoveAbsDeltaY());return e>20&&e>i||e>20&&!this.isInDesignMode()};UIHScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaX())};UIHScrollView.prototype.getScrollDelta=function(t){return Math.floor(this.getMoveDeltaX())};UIHScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIHScrollView.prototype.getPageSize=function(){return this.w};UIHScrollView.prototype.onPointerUpRunning=function(t,e){if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();var i=0;var n=this.getVelocity();var r=this.getScrolledSize();var o=Math.abs(r);if(o>this.w/4||n>this.w){if(r<0){i=1}else{i=-1}}this.scrollToPageDelta(i);return true};UIHScrollView.prototype.translatePoint=function(t){var e={x:t.x-this.left+this.offset,y:t.y-this.top};return e};UIHScrollView.prototype.getScrollRange=function(){var t=0;var e=this.calcChildrenRange();t=e.r-e.l;if(t<this.w){t=this.w}t=Math.ceil(t/this.w)*this.w;return t};UIHScrollView.prototype.fixChildPosition=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=this.offset+this.hMargin;t.widthAttr=UIElement.WIDTH_SCALE}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=this.vMargin}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false)}return};UIHScrollView.prototype.paintChildren=function(t){var e=null;var i=this.offset;var n=this.offset+this.w;t.save();t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();t.clip();t.beginPath();t.translate(-this.offset,0);for(var r=0;r<this.children.length;r++){e=this.children[r];if(!e.visible){continue}if(e.left+e.w<i||e.left>n){continue}this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}this.paintTargetShape(t);t.restore();return};function UIHScrollViewCreator(t,e){var i=["ui-h-scroll-view","ui-h-scroll-view",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIHScrollView;return n.initUIHScrollView(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIHScrollViewCreator(0,null));function UIVScrollView(){return}UIVScrollView.prototype=new UIScrollView;UIVScrollView.prototype.isUIVScrollView=true;UIVScrollView.prototype.initUIVScrollView=function(t,e,i,n){this.initUIScrollView(t,e,i);this.setSizeLimit(40,100,2e3,2e3);this.setImage("scrollBarImg",n);this.rectSelectable=false;return this};UIVScrollView.prototype.needScroll=function(t){var e=Math.abs(this.getMoveAbsDeltaX());var i=Math.abs(this.getMoveAbsDeltaY());return i>50&&i>e||i>50&&!this.isInDesignMode()};UIVScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaY())};UIVScrollView.prototype.getScrollDelta=function(t){return Math.floor(this.getMoveDeltaY())};UIVScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().y};UIVScrollView.prototype.getPageSize=function(){return this.h};UIVScrollView.prototype.translatePoint=function(t){var e={x:t.x-this.left,y:t.y-this.top+this.offset};return e};UIVScrollView.prototype.getScrollRange=function(){var t=0;var e=this.calcChildrenRange();t=e.b;if(t<this.h){t=this.h}var i=this.isInDesignMode()?this.h:10;t=Math.ceil(t/i)*i;return t};UIVScrollView.prototype.fixChildPosition=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=this.hMargin}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=this.offset+this.vMargin;t.heightAttr=UIElement.HEIGHT_SCALE}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false)}return};UIVScrollView.prototype.paintChildren=function(t){var e=null;var i=this.offset;var n=this.offset+this.h;t.save();t.beginPath();t.rect(this.getHMargin(),this.getVMargin(),this.getWidth(true),this.getHeight(true));t.closePath();t.clip();t.beginPath();t.translate(0,-this.offset);for(var r=0;r<this.children.length;r++){e=this.children[r];if(!e.visible){continue}if(e.top+e.h<i||e.top>n){continue}this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}this.paintTargetShape(t);t.restore();return};UIVScrollView.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);return};UIVScrollView.prototype.drawScrollBar=function(t){var e=this.getHtmlImageByType("scrollBarImg");if(!this.scrollBarOpacity||!e){return}var i=this.getScrollRange();var n=this.w-e.width-2;var r=e.width;var o=this.h*this.h/i;var a=this.offset/i*this.h;if(a+o>this.h){o=this.h-a;a=this.h-o}if(a<0){o=o+a;a=0}t.save();t.globalAlpha=this.scrollBarOpacity;drawNinePatchEx(t,e,0,0,e.width,e.height,n,a,r,o);t.restore();return};function UIVScrollViewCreator(t,e,i){var n=["ui-v-scroll-view","ui-v-scroll-view",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIVScrollView;return r.initUIVScrollView(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIVScrollViewCreator(0,null,null));function UIVScrollViewGeneral(){return}UIVScrollViewGeneral.prototype=new UIVScrollView;UIVScrollViewGeneral.prototype.isUIList=true;UIVScrollViewGeneral.prototype.isUILayout=true;UIVScrollViewGeneral.prototype.isUIVScrollViewGeneral=true;UIVScrollViewGeneral.prototype.sortChildren=UIList.prototype.sortChildren;UIVScrollViewGeneral.prototype.initUIVScrollViewGeneral=function(t){this.initUIVScrollView(t,0,null,null);this.setTextType(Shape.TEXT_NONE);return this};UIVScrollViewGeneral.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getVMargin();var i=this.children.length;var n=e;for(var r=0;r<i;r++){var o=this.children[r];if(!o.visible){continue}o.yAttr=UIElement.Y_FIX_TOP;o.heightAttr=UIElement.HEIGHT_FIX;
o.relayout();o.top=n;n+=o.h}return};UIVScrollViewGeneral.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.isInDesignMode()){this.drawPageDownUp(t)}return};function UIVScrollViewGeneralCreator(){var t=["ui-g-scroll-view","ui-g-scroll-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVScrollViewGeneral;return e.initUIVScrollViewGeneral(this.type)};return}function UIScrollViewX(){return}UIScrollViewX.prototype=new UIElement;UIScrollViewX.prototype.isUIScrollViewX=true;UIScrollViewX.prototype.isUIScrollView=true;UIScrollViewX.prototype.saveProps=["virtualWidth","virtualHeight","showOutside","maxAnimationDuration","scrollBgImage"];UIScrollViewX.prototype.initUIScrollViewX=function(t){this.initUIElement(t);this.ox=0;this.oy=0;this.xDragLimit=.3;this.yDragLimit=.3;this.scrollBarOpacity=0;this.maxAnimationDuration=1e4;this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator(2);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_V_SCROLL_BAR_BG,null);this.setImage(UIElement.IMAGE_V_SCROLL_BAR_FG,null);this.setImage(UIElement.IMAGE_H_SCROLL_BAR_BG,null);this.setImage(UIElement.IMAGE_H_SCROLL_BAR_FG,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.addEventNames(["onScrolling","onScrollDone"]);return this};UIScrollViewX.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIScrollViewX.prototype.setVirtualWidth=function(t){this.vw=t;return this};UIScrollViewX.prototype.setVirtualHeight=function(t){this.vh=t;return this};UIScrollViewX.prototype.getVirtualWidth=function(){return Math.max(this.vw,this.w)};UIScrollViewX.prototype.getVirtualHeight=function(){return Math.max(this.vh,this.h)};UIScrollViewX.prototype.getXOffset=function(){return this.ox};UIScrollViewX.prototype.getYOffset=function(){return this.oy};UIScrollViewX.prototype.fixXOffset=function(t){return Math.min(Math.max(0,t),this.getVirtualWidth()-this.w)>>0};UIScrollViewX.prototype.fixYOffset=function(t){return Math.min(Math.max(0,t),this.getVirtualHeight()-this.h)>>0};UIScrollViewX.prototype.setXOffset=function(t){this.ox=this.fixXOffset(t);return this};UIScrollViewX.prototype.setYOffset=function(t){this.oy=this.fixYOffset(t);return this};UIScrollViewX.prototype.setDragLimit=function(t,e){this.xDragLimit=t;this.yDragLimit=e;return this};UIScrollViewX.prototype.setOffset=function(t,e,i){if(i){var n=0;var r=t>>0;var o=e>>0;var a=this.xDragLimit>1?this.xDragLimit:this.xDragLimit*this.w;var s=this.yDragLimit>1?this.yDragLimit:this.yDragLimit*this.h;if(r<-a){r=-a}else if(this.vw-r<this.w-a){r=Math.max(0,this.vw-(this.w-a))}if(o<-s){o=-s}else if(this.vh-o<this.h-s){o=Math.max(0,this.vh-(this.h-s))}this.ox=r;this.oy=o}else{this.setXOffset(t);this.setYOffset(e)}this.callOnScrollingHandler(this.ox,this.oy);return this};Object.defineProperty(UIScrollViewX.prototype,"xOffset",{get:UIScrollViewX.prototype.getXOffset,set:UIScrollViewX.prototype.setXOffset});Object.defineProperty(UIScrollViewX.prototype,"yOffset",{get:UIScrollViewX.prototype.getYOffset,set:UIScrollViewX.prototype.setYOffset});Object.defineProperty(UIScrollViewX.prototype,"virtualWidth",{get:UIScrollViewX.prototype.getVirtualWidth,set:UIScrollViewX.prototype.setVirtualWidth});Object.defineProperty(UIScrollViewX.prototype,"virtualHeight",{get:UIScrollViewX.prototype.getVirtualHeight,set:UIScrollViewX.prototype.setVirtualHeight});UIScrollViewX.prototype.dragStart=function(){this.saveOX=this.ox;this.saveOY=this.oy;this.velocityTracker.clear()};UIScrollViewX.prototype.drag=function(){this.addMovementForVelocityTracker();var t=this.saveOX-this.getMoveAbsDeltaX();var e=this.saveOY-this.getMoveAbsDeltaY();if(this.getVirtualWidth()<=this.w){t=0}else if(!UIElement.hScrollHandledBy){UIElement.hScrollHandledBy=this}if(UIElement.hScrollHandledBy!==this){t=0}if(this.getVirtualHeight()<=this.h){e=0}else if(!UIElement.vScrollHandledBy){UIElement.vScrollHandledBy=this}if(UIElement.vScrollHandledBy!==this){e=0}if(t||e){this.setOffset(t,e,true)}return};UIScrollViewX.prototype.getScrollDuration=function(t){var e=Math.max(Math.abs(t.x),Math.abs(t.y))*2/2;return Math.min(e,this.maxAnimationDuration)};UIScrollViewX.prototype.dragEnd=function(){var t=this.velocityTracker.getVelocity();var e=this.getScrollDuration(t);if(!e||e<10){return}var i=e/1e3;var n=t.x;var r=t.y;if(UIElement.hScrollHandledBy&&UIElement.hScrollHandledBy!==this){n=0}if(UIElement.hScrollHandledBy&&UIElement.vScrollHandledBy!==this){r=0}var o=.5*n*i;var a=.5*r*i;var s=this.ox;var h=this.oy;var l=Math.min(Math.max(0,s-o),this.virtualWidth-this.w);var u=Math.min(Math.max(0,h-a),this.virtualHeight-this.h);var p=this.ox<0||this.oy<0||this.ox+this.w>this.virtualWidth||this.oy+this.h>this.virtualHeight;if(!p&&Math.abs(o)<10&&Math.abs(a)<10){this.callOnScrollDoneHandler(this.ox,this.oy);return}this.scrollTo(l,u,e);return};UIScrollViewX.prototype.scrollToPercent=function(t,e,i){var n=(this.virtualWidth-this.w)*(t/100);var r=(this.virtualHeight-this.h)*(e/100);return this.scrollTo(n,r,i)};UIScrollViewX.prototype.scrollTo=function(t,e,i){var n=this.ox;var r=this.oy;var o=this.fixXOffset(t);var a=this.fixYOffset(e);var s=o-n;var h=a-r;if(!i||!s&&!h){this.setOffset(t,e);this.callOnScrollDoneHandler(this.ox,this.oy);return this}var l=Date.now();function u(t){var e=(t-l)/i;if(e>=1){e=1;this.setStepScroll(null)}if(this.pointerDown){this.setStepScroll(null)}var o=this.interpolator.get(e);var a=n+s*o;var u=r+h*o;this.setOffset(a,u,true);this.scrollBarOpacity=1-o;if(e>=1){this.callOnScrollDoneHandler(this.ox,this.oy)}}this.setStepScroll(u);return this};UIScrollViewX.prototype.setStepScroll=function(t){this.stepScroll=t;return this};UIScrollViewX.prototype.stepAnimation=function(t,e){UIElement.prototype.stepAnimation.call(this,t,e);if(this.stepScroll){this.stepScroll(e||t.now||Date.now());this.postRedraw()}return this};UIScrollViewX.prototype.isDraggable=function(){if(this.isInDesignMode()){if(this.hitTestResult!==UIElement.HIT_TEST_MM){return false}return!this.getTarget()||this.view.isAltDown()}else{return true}};UIScrollViewX.prototype.onPointerDownRunning=UIScrollViewX.prototype.onPointerDownEditing=function(t,e){this.scrollBarOpacity=1;if(!e&&this.isDraggable()){this.dragStart();return true}return false};UIScrollViewX.prototype.onPointerMoveRunning=UIScrollViewX.prototype.onPointerMoveEditing=function(t,e){if(!e&&this.pointerDown&&this.isDraggable()){this.drag();return true}return false};UIScrollViewX.prototype.onPointerUpRunning=UIScrollViewX.prototype.onPointerUpEditing=function(t,e){if(!e&&this.pointerDown&&this.isDraggable()){this.dragEnd();return true}this.scrollBarOpacity=0;return false};UIScrollViewX.prototype.translatePoint=function(t){var e={x:t.x-this.left+this.xOffset,y:t.y-this.top+this.yOffset};return e};UIScrollViewX.prototype.onClip=function(t){if(this.showOutside&&this.isInDesignMode()){return this}t.clipRect(0,0,this.w,this.h);return this};UIScrollViewX.prototype.isChildVisibleRecursive=function(t){if(t.children&&t.children.length){return true}return false};UIScrollViewX.prototype.isChildVisible=function(t,e){var i=this.ox;var n=i+this.w;var r=this.oy;var o=r+this.h;if(!e.visible){return false}if(this.showOutside&&this.isInDesignMode()){return true}if(this.isChildVisibleRecursive(e)){return true}if(e.top+e.h<r||e.top>o||e.left+e.w<i||e.left>n){return false}return true};UIScrollViewX.prototype.paintChildren=function(t){var e=this.ox;var i=this.oy;var n=this.children;var r=n.length;t.save();t.translate(-e,-i);for(var o=0;o<r;o++){var a=this.children[o];if(this.isChildVisible(t,a)){this.beforePaintChild(a,t);a.paintSelf(t);this.afterPaintChild(a,t)}}t.restore();this.drawScrollBar(t);return};UIScrollViewX.prototype.dispatchPointerDownToChildren=function(t){if(!this.hitTestResult&&!this.showOutside){return false}if(this.isInDesignMode()&&this.view.isAltDown()){return false}return this.defaultDispatchPointerDownToChildren(t)};function UIScrollViewXCreator(){var t=["ui-scroll-view-x","ui-scroll-view-x",null,true];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIScrollViewX;return e.initUIScrollViewX(this.type)};return}UIScrollViewX.prototype.drawBgImageScroll=function(t,e,i,n){switch(e){case WImage.DISPLAY_SCALE:{var r=n.w/this.virtualWidth;var o=n.h/this.virtualHeight;var a=this.xOffset*r;var s=this.yOffset*o;var h=this.w*r;var l=this.h*o;t.drawImage(i,a,s,h,l,0,0,this.w,this.h);break}case WImage.DISPLAY_TILE:{var u=Math.floor(this.xOffset/n.w)*n.w-this.xOffset;var p=Math.floor(this.yOffset/n.h)*n.h-this.yOffset;var c=Math.ceil((this.w-u)/n.w)*n.w;var f=Math.ceil((this.h-p)/n.h)*n.h;t.save();t.clipRect(0,0,this.w,this.h);WImage.draw(t,i,e,u,p,c,f,n);t.restore();break}default:break}return this};UIScrollViewX.prototype.afterChildAppended=function(t){t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FIX;if(this.isUILayout){this.relayoutChildren()}return true};UIScrollViewX.prototype.drawBgImage=function(t){if(this.scrollBgImage){var e=this.getBgImage();if(e){var i=e.getImage();var n=e.getImageRect();if(i&&n){this.drawBgImageScroll(t,this.images.display,i,n)}}}else{UIElement.prototype.drawBgImage.call(this,t)}};UIScrollViewX.prototype.drawVScrollBar=function(t){var e=0;var i=0;var n=0;var r=0;var o=null;var a=null;var s=this.getImageByType(UIElement.IMAGE_V_SCROLL_BAR_BG);var a=s?s.getImage():null;if(a){o=s.getImageRect();n=o.rw||o.w;e=this.w-n;i=0;r=this.h;this.drawImageAt(t,a,UIElement.IMAGE_DISPLAY_3PATCH_V,e,i,n,r)}var h=this.getImageByType(UIElement.IMAGE_V_SCROLL_BAR_FG);var a=h?h.getImage():null;if(a){o=h.getImageRect();n=o.rw||o.w;e=this.w-n;i=this.h*(this.yOffset/this.virtualHeight);r=this.h*(this.h/this.virtualHeight);if(i<0){r=Math.max(10,r+i);i=0}if(i+r>this.h){r=Math.max(10,this.h-i);i=this.h-r}this.drawImageAt(t,a,UIElement.IMAGE_DISPLAY_3PATCH_V,e,i,n,r)}return};UIScrollViewX.prototype.drawHScrollBar=function(t){var e=0;var i=0;var n=0;var r=0;var o=null;var a=null;var s=this.getImageByType(UIElement.IMAGE_H_SCROLL_BAR_BG);var a=s?s.getImage():null;if(a){o=s.getImageRect();e=0;n=this.w;r=o.rh||o.h;i=this.h-r;this.drawImageAt(t,a,UIElement.IMAGE_DISPLAY_3PATCH_H,e,i,n,r)}var h=this.getImageByType(UIElement.IMAGE_H_SCROLL_BAR_FG);var a=h?h.getImage():null;if(a){o=h.getImageRect();r=o.rh||o.h;i=this.h-r;e=this.w*(this.xOffset/this.virtualWidth);n=this.w*(this.w/this.virtualWidth);if(e<0){n=Math.max(10,n+e);e=0}if(e+n>this.w){n=Math.max(10,this.w-e);e=this.w-n}this.drawImageAt(t,a,UIElement.IMAGE_DISPLAY_3PATCH_H,e,i,n,r)}};UIScrollViewX.prototype.drawScrollBar=function(t){if(this.scrollBarOpacity<1e-4){return this}t.save();t.globalAlpha=this.scrollBarOpacity;if(this.w<this.virtualWidth){this.drawHScrollBar(t)}if(this.h<this.virtualHeight){this.drawVScrollBar(t)}t.restore();return this};ShapeFactoryGet().addShapeCreator(new UIScrollViewXCreator);function UIGridViewX(){return}UIGridViewX.prototype=new UIScrollViewX;UIGridViewX.prototype.isUILayout=true;UIGridViewX.prototype.isUIGridViewX=true;UIGridViewX.prototype.saveProps=UIScrollViewX.prototype.saveProps.concat(["cols","rows","isVertical"]);UIGridViewX.prototype.initUIGridViewX=function(t){this.initUIScrollViewX(t);this.rows=3;this.cols=3;this.setMargin(0,0);this.setDefSize(200,200);return this};UIGridViewX.prototype.setVertical=function(t){this.isVertical=t;this.relayoutChildren();return this};UIGridViewX.prototype.getVertical=function(){return this.isVertical};UIGridViewX.prototype.setRows=function(t){this.rows=t;this.relayoutChildren();return this};UIGridViewX.prototype.getRows=function(){return this.rows};UIGridViewX.prototype.setCols=function(t){this.cols=t;this.relayoutChildren();return this};UIGridViewX.prototype.getCols=function(){return this.cols};UIGridViewX.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIGridViewX.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.cols;var i=this.rows;var n=this.w/e;var r=this.h/i;var o=0;var a=0;var s=this.children;var h=s.length;var l=this.spacer;var u=n+l;var p=r+l;var c=0;for(var f=0;f<h;f++){var d=s[f];if(!d.visible){continue}if(this.isVertical){a=c%e;o=Math.floor(c/e)}else{o=c%i;a=Math.floor(c/i)}d.left=a*u;d.top=o*p;d.w=n;d.h=r;d.setUserMovable(false);d.setUserResizable(false);c++}if(this.isVertical){this.vw=this.w;this.vh=Math.ceil(h/this.cols)*p;if(this.isInDesignMode()){this.vh+=p}}else{this.vh=this.h;this.vw=Math.ceil(h/this.rows)*u;if(this.isInDesignMode()){this.vw+=u}}if(this.xOffset+this.w>this.vw){this.xOffset=this.vw-this.w}if(this.yOffset+this.h>this.vh){this.yOffset=this.vh-this.h}return};UIGridViewX.prototype.isChildVisibleRecursive=function(t){return false};UIGridViewX.prototype.isDraggable=function(){if(this.isInDesignMode()){if(this.hitTestResult!==Shape.HIT_TEST_MM){return false}var t=this.getTarget();return!t||!t.getTarget()||this.view.isAltDown()}else{return true}};function UIGridViewXCreator(t){var e=["ui-grid-view-x","ui-grid-view-x",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIGridViewX;return e.initUIGridViewX(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridViewXCreator);function UIListViewX(){return}UIListViewX.prototype=new UIScrollViewX;UIListViewX.prototype.isUILayout=true;UIListViewX.prototype.isUIListViewX=true;UIListViewX.prototype.saveProps=UIScrollViewX.prototype.saveProps.concat(["cols","rows","isVertical","itemSize"]);UIListViewX.prototype.initUIListViewX=function(t){this.initUIScrollViewX(t);this.itemSize=100;this.setMargin(0,0);this.setDefSize(200,200);return this};UIListViewX.prototype.setVertical=function(t){this.isVertical=t;this.relayoutChildren();return this};UIListViewX.prototype.getVertical=function(){return this.isVertical};UIListViewX.prototype.setItemSize=function(t){this.itemSize=t;this.relayoutChildren();return this};UIListViewX.prototype.getItemSize=function(){return this.itemSize};UIListViewX.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIListViewX.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.children;var i=e.length;var n=this.spacer||0;var r=this.itemSize;var o=0;var a=0;var s=this.w;var h=this.h;for(var l=0;l<i;l++){var u=e[l];if(!u.visible){continue}if(this.isVertical){u.left=0;u.w=s;u.h=r||u.h;u.y=a;a+=u.h+n}else{u.top=0;u.h=h;u.w=r||u.w;u.x=o;o+=u.w+n}u.setUserMovable(false);u.setUserResizable(false)}if(this.isVertical){this.vw=this.w;this.vh=a;if(this.isInDesignMode()){this.vh+=r||80}}else{this.vh=this.h;this.vw=o;if(this.isInDesignMode()){this.vw+=r||80}}this.xOffset=0;this.yOffset=0;return};UIListViewX.prototype.isChildVisibleRecursive=function(t){return false};UIListViewX.prototype.isDraggable=function(){if(this.isInDesignMode()){if(this.hitTestResult!==Shape.HIT_TEST_MM){return false}var t=this.getTarget();return!t||!t.getTarget()||this.view.isAltDown()}else{return true}};function UIListViewXCreator(t){var e=["ui-list-view-x","ui-list-view-x",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIListViewX;return e.initUIListViewX(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIListViewXCreator);function UIShortcut(){return}UIShortcut.prototype=new UIElement;UIShortcut.prototype.isUIShortcut=true;UIShortcut.prototype.initUIShortcut=function(t){this.initUIElement(t);this.setText("#ABCDEFGHIJKLMNOPQRSTUVYWXYZ");this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onChanged"]);return this};UIShortcut.prototype.shapeCanBeChild=function(t){return false};UIShortcut.prototype.drawText=function(t){var e=this.text;var i=e.length;if(!i){return}t.textBaseline="middle";t.textAlign="center";t.font=this.style.getFont();var n=this.w>>1;var r=this.vMargin;var o=this.getWidth(true);var a=this.getHeight(true)/i;var s=a>>1;t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;for(var h=0;h<e.length;h++){var l=e[h];if(this.currentItem===h){t.rect(0,r,this.w,a);if(this.pointerDown){t.fillStyle=this.style.fillColor;t.fill()}t.stroke()}t.fillStyle=this.style.textColor;t.fillText(l,n,r+s);r+=a}return};UIShortcut.prototype.findItemByPoint=function(t){var e=this.text;var i=this.vMargin;var n=this.getHeight(true);var r=Math.floor(e.length*(t.y-i)/n);return r};UIShortcut.prototype.changeItemByPoint=function(t){var e=this.text;var i=this.findItemByPoint(t);if(i>=0&&i<e.length){var n=e[i];if(this.currentItem!=i){this.callOnChangedHandler(n);this.currentItem=i}}return};UIShortcut.prototype.setValue=function(t){var e=this.text.indexOf(t);if(e>=0){if(this.currentItem!=e){this.currentItem=e;this.callOnChangedHandler(t)}}return};UIShortcut.prototype.getValue=function(){if(this.text&&this.currentItem>=0&&this.currentItem<this.text.length){return this.text[this.currentItem]}else{return""}};UIShortcut.prototype.onPointerDownRunning=function(t,e){if(e||!this.text){return}this.changeItemByPoint(t);return};UIShortcut.prototype.onPointerMoveRunning=function(t,e){if(e||!this.text){return}if(this.pointerDown){this.changeItemByPoint(t)}return};function UIShortcutCreator(){var t=["ui-shortcut","ui-shortcut",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIShortcut;return e.initUIShortcut(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIShortcutCreator);function UIScrollText(){return}UIScrollText.prototype=new UIElement;UIScrollText.prototype.isUIScrollText=true;UIScrollText.prototype.initUIScrollText=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onScrollDone"]);return this};UIScrollText.prototype.onModeChanged=function(){this.offsetX=0;this.offsetY=0;return};UIScrollText.prototype.shapeCanBeChild=function(t){return false};UIScrollText.prototype.getAnimationDuration=function(){return this.animationDuration?this.animationDuration:1e3};UIScrollText.prototype.setAnimationDuration=function(t){this.animationDuration=t;return};UIScrollText.prototype.getPauseDuration=function(){return this.pauseDuration?this.pauseDuration:0};UIScrollText.prototype.setPauseDuration=function(t){this.pauseDuration=t;return};UIScrollText.prototype.startVScroll=function(){var t=this;var e=this.getTextHeight();var i=this.getLineHeight(true);if(e<=this.h){return}this.offsetX=0;this.offsetY=0;var n=0;var r=0;var o=this.getAnimationDuration();var a=this.getPauseDuration();this.h=Math.floor(this.h/i)*i;var s=-this.h;var h=true;var l=new DecelerateInterpolator;function u(){if(h){h=false;n=(new Date).getTime()}if(!t.isVisible()){return}var i=new Date;var p=(i.getTime()-n)/o;var c=a>0?l.get(p):p;delete i;if(p<1){t.offsetY=r+s*c;setTimeout(u,10)}else{t.offsetY=r+s;if(Math.abs(t.offsetY)<e-t.h){h=true;r=t.offsetY;setTimeout(u,a)}else{delete l;t.callOnScrollDoneHandler()}delete n}delete i;t.postRedraw()}setTimeout(u,a);return};UIScrollText.prototype.startHScroll=function(){var t=this;var e=this.textWidth;if(e<=this.w){return}this.offsetX=0;this.offsetY=0;var i=0;var n=0;var r=this.getAnimationDuration();var o=this.getPauseDuration();var a=-this.w;var s=true;var h=new DecelerateInterpolator;function l(){if(s){s=false;i=(new Date).getTime()}if(!t.isVisible()){return}var u=new Date;var p=(u.getTime()-i)/r;var c=o>0?h.get(p):p;if(p<1){t.offsetX=n+a*c;setTimeout(l,10)}else{t.offsetX=n+a;if(Math.abs(t.offsetX)<e-t.w){s=true;n=t.offsetX;setTimeout(l,o)}else{delete i;t.callOnScrollDoneHandler()}}delete u;t.postRedraw()}setTimeout(l,o);return};UIScrollText.prototype.startScroll=function(){if(!this.isVisible()){return}if(this.type==="ui-vscroll-text"){this.startVScroll()}else{this.startHScroll()}return};UIScrollText.prototype.onInit=function(){this.offsetX=0;this.offsetY=0;var t=this;setTimeout(function(){t.startScroll()},1e3);return};UIScrollText.prototype.drawText=function(t){var e=this.offsetX?this.offsetX:0;var i=this.offsetY?this.offsetY:0;t.save();t.rect(0,0,this.w,this.h);t.clip();t.translate(e,i);t.beginPath();t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.strokeStyle=this.style.lineColor;t.lineWidth=1;if(this.type==="ui-vscroll-text"){this.drawMLText(t,false,true)}else{this.textWidth=this.draw1LText(t,true)}t.restore();return};function UIScrollTextCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIScrollText;return n.initUIScrollText(this.type,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIScrollTextCreator("ui-vscroll-text",200,200));ShapeFactoryGet().addShapeCreator(new UIScrollTextCreator("ui-hscroll-text",200,50));function UIList(){return}UIList.prototype=new UIElement;UIList.prototype.isUIList=true;UIList.prototype.isUILayout=true;UIList.prototype.saveProps=["spacer","itemHeightVariable","itemDraggable","itemHeight"];UIList.prototype.initUIList=function(t,e,i,n){this.initUIElement(t);this.setMargin(e,e);this.setSizeLimit(100,100,1e3,1e3);this.setDefSize(400,i*3+2*e);this.spacer=0;this.itemHeight=i;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,n);this.rectSelectable=false;this.itemHeightVariable=false;this.addEventNames(["onInit"]);if(!n){this.style.setFillColor("White")}return this};UIList.prototype.getItemHeight=function(){return this.itemHeight};UIList.prototype.setItemHeight=function(t){this.itemHeight=t;return};UIList.prototype.shapeCanBeChild=function(t){if(!t.isUIListItem){return false}return true};UIList.prototype.childIsBuiltin=function(t){return t.name==="ui-list-item-update-status"||t.name==="ui-list-item-update-tips"||t.name==="ui-last"||t.name.indexOf("prebuild")>=0||t.name.indexOf("builtin")>=0};UIList.FIRST_ITEM=-1;UIList.LAST_ITEM=1;UIList.MIDDLE_ITEM=0;UIList.SINGLE_ITEM=2;UIList.prototype.fixListItemImage=function(t,e){var i=t.images;for(var n in i){var r=i[n];if(n!="display"){var o=r.getImageSrc();if(!o){continue}switch(e){case UIList.FIRST_ITEM:{o=o.replace(/\.single\./,".first.");o=o.replace(/\.middle\./,".first.");o=o.replace(/\.last\./,".first.");break}case UIList.MIDDLE_ITEM:{o=o.replace(/\.single\./,".middle.");o=o.replace(/\.first\./,".middle.");o=o.replace(/\.last\./,".middle.");break}case UIList.LAST_ITEM:{o=o.replace(/\.single\./,".last.");o=o.replace(/\.first\./,".last.");o=o.replace(/\.middle\./,".last.");break}case UIList.SINGLE_ITEM:{o=o.replace(/\.first\./,".single.");o=o.replace(/\.middle\./,".single.");o=o.replace(/\.last\./,".single.");break}}r.setImageSrc(o)}}return};UIList.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var o=this.getWidth(true);var a=this.getItemHeight();var s=a;var h=this.itemHeightVariable;var l=0;var u=this.spacer;var p=this.children.length;var c=this.children;for(var f=0;f<p;f++){var d=c[f];var I={};var g=false;if(d.removed||!d.visible)continue;if(h||d.isHeightVariable()){s=d.measureHeight(a)}else{s=a}if(p===1){this.fixListItemImage(d,UIList.SINGLE_ITEM)}else if(l===0){this.fixListItemImage(d,UIList.FIRST_ITEM)}else if(l===p-1){this.fixListItemImage(d,UIList.LAST_ITEM)}else{this.fixListItemImage(d,UIList.MIDDLE_ITEM)}if(this.h<=r+i+s){this.h=r+i+s}g=r<this.h&&(t||this.isInDesignMode());if(g){d.setSize(o,s);I.xStart=d.left;I.yStart=d.top;I.wStart=d.w;I.hStart=d.h;I.xEnd=n;I.yEnd=r;I.wEnd=o;I.hEnd=s;I.delay=10;I.duration=500;I.element=d;I.onDone=function(t){this.relayoutChildren()};d.animate(I)}else{d.move(n,r);d.setSize(o,s);d.relayoutChildren()}d.setUserMovable(true);d.widthAttr=UIElement.WIDTH_FILL_PARENT;if(d.heightAttr===UIElement.HEIGHT_FILL_PARENT){d.heightAttr=UIElement.HEIGHT_FIX}d.setUserResizable(h||d.isHeightVariable());if(!this.isUIScrollView){d.setDraggable(this.itemDraggable)}r+=s+u;l++}return};UIList.prototype.beforePaintChildren=function(t){t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();return};UIList.prototype.afterPaintChildren=function(t){return};UIList.prototype.afterChildAppended=function(t){if(t.view&&this.isInDesignMode()&&t.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();t.setUserMovable(true);t.setUserResizable(false);t.setCanRectSelectable(false,true);t.autoAdjustHeight=this.itemHeightVariable;t.setDraggable(this.itemDraggable);this.relayoutChildren();return true};UIList.prototype.sortChildren=function(){};UIList.prototype.onKeyUpRunning=function(t){var e=0;if(!this.children.length){return}switch(t){case KeyEvent.DOM_VK_UP:{e=this.children.indexOf(this.targetShape)-1;break}case KeyEvent.DOM_VK_DOWN:{e=this.children.indexOf(this.targetShape)+1;break}default:{return}}var i=this.children.length;e=(e+this.children.length)%i;var n=this.children[e];this.setTarget(n);this.postRedraw();if(this.isUIListView){if(this.offset>n.top){this.offset=n.top}if(this.offset+this.h<n.top+n.h){this.offset=n.top-(this.h-n.h)}}return};UIList.prototype.onKeyDownRunning=function(t){};UIList.prototype.getValue=function(){var t=null;var e=this.children.length;if(e<1)return t;for(var i=0;i<e;i++){var n=this.children[i];if(!n.isUIListCheckableItem||!n.value)continue;if(n.isRadio){return i}else{if(!t)t=[];t.push(i)}}return t};UIList.prototype.setValue=function(t){var e=null;if(typeof t==="array"){e=t}else if(typeof t==="number"){e=[t]}else{e=[]}var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(r.isUIListCheckableItem){r.setValue(false)}}for(var n=0;n<e.length;n++){var o=e[n];if(o>=0&&o<i){var r=this.children[o];if(r.isUIListCheckableItem){r.setChecked(true)}}}return this};function UIListCreator(t,e,i){var n=["ui-list","ui-list",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIList;return r.initUIList(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIListCreator(5,114,null));function UIListView(){return}UIListView.prototype=new UIVScrollView;UIListView.prototype.isUIList=true;UIListView.prototype.isUILayout=true;UIListView.prototype.isUIListView=true;UIListView.prototype.setItemHeight=UIList.prototype.setItemHeight;UIListView.prototype.sortChildren=UIList.prototype.sortChildren;UIListView.prototype.initUIList=UIList.prototype.initUIList;UIListView.prototype.shapeCanBeChild=UIList.prototype.shapeCanBeChild;UIListView.prototype.paintSelfOnly=UIList.prototype.paintSelfOnly;UIListView.prototype.fixListItemImage=function(t,e){};UIListView.prototype.afterChildAppended=UIList.prototype.afterChildAppended;UIListView.prototype.childIsBuiltin=UIList.prototype.childIsBuiltin;UIListView.prototype.onKeyUpRunning=UIList.prototype.onKeyUpRunning;UIListView.prototype.onKeyDownRunning=UIList.prototype.onKeyDownRunning;UIListView.prototype.getValue=UIList.prototype.getValue;UIListView.prototype.setValue=UIList.prototype.setValue;UIListView.UPDATE_STATUS_NONE=0;UIListView.UPDATE_STATUS_TIPS=1;UIListView.UPDATE_STATUS_SYNC=2;UIListView.prototype.saveProps=UIList.prototype.saveProps;UIListView.prototype.beginUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_SYNC;var t=this.findChildByName("ui-list-item-update-status");if(t){var e=t.findChildByName("ui-wait-box");if(e){e.show()}var i=t.findChildByName("ui-label-loading");if(i){i.setText(dappGetText("Loading..."))}}return};UIListView.prototype.drawBgImage=function(t){t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();UIElement.prototype.drawBgImage.call(this,t);return this};UIListView.prototype.endUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_NONE;var t=this.findChildByName("ui-list-item-update-status");if(t){this.setLastUpdateTime(new Date)}this.relayoutChildren(true);return};UIListView.prototype.initUIListView=function(t,e,i,n){this.spacer=0;this.initUIList(t,e,i,n);this.initUIVScrollView(t,0,n,null);this.updateStatus=UIListView.UPDATE_STATUS_NONE;this.addEventNames(["onUpdateData","onScrollOutOfRange"]);this.setTextType(Shape.TEXT_INPUT);return this};UIListView.prototype.onModeChanged=function(){this.offset=0;this.updateStatus=UIListView.UPDATE_STATUS_NONE;return};UIListView.prototype.updateDone=function(){var t=this;t.endUpdate();setTimeout(function(){if(t.parentShape){t.relayoutChildren();t.postRedraw()}},1e3);return};UIListView.prototype.callOnUpdateData=function(){this.callOnUpdateDataHandler();this.beginUpdate();var t=this;setTimeout(function(){if(t.parentShape){t.updateDone()}},1e4);return true};UIListView.prototype.setLastUpdateTime=function(t){var e=this.findChildByName("ui-list-item-update-tips");if(e&&t){var i="";var n=new Date;if(n.getFullYear()===t.getFullYear()&&n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()){i=dappGetText("Today")}else{i=t.getMonth()+"-"+t.getDate()}i=i+" "+t.getHours()+":"+t.getMinutes();var r=e.findChildByName("ui-label-update-time");if(r){r.setText(i)}var r=e.findChildByName("ui-label-update-time");if(r){r.setText(i)}var o=e.findChildByName("ui-label-update-time-tips");if(o){o.setText(dappGetText("Last Update:"))}}return};UIListView.prototype.onDrag=function(t){var e=this.findChildByName("ui-list-item-update-tips");if(e){var i=e.findChildByName("ui-image");var n=e.findChildByName("ui-label-tips");if(i){if(t<-115){if(i.rotation===0){function r(){var t=i.rotation+.2*Math.PI;if(t>Math.PI){t=Math.PI}i.setRotation(t);if(t<Math.PI){setTimeout(r,50)}i.postRedraw();return}r();if(n){n.setText(dappGetText("Release To Update."))}}}else{i.setRotation(0);if(n){n.setText(dappGetText("Pull To Update."))}}}}return};UIListView.prototype.whenScrollOutOfRange=function(t){if(t<-115){this.callOnUpdateData();this.relayoutChildren()}this.callOnScrollOutOfRangeHandler(t);return};UIListView.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var o=this.getWidth(true);var a=this.itemHeight;var s=this.itemHeightVariable;var h=this.getScrollRange();var l=this.getPageSize();var u=true;var p=0;var c=this.spacer||0;var f=this.children.length;var d=this.children;for(var I=0;I<f;I++){var g=d[I];var m={};var v=false;if(g.removed||!g.visible)continue;if(s||g.isHeightVariable()){a=g.measureHeight(this.itemHeight)}else{a=this.itemHeight}if(g.name==="ui-list-item-update-tips"){if(!this.isInDesignMode()){g.move(n,-a);g.left=n;g.top=-a;g.w=o;g.h=a;g.setUserMovable(false);g.setUserResizable(false);g.setVisible(this.updateStatus!==UIListView.UPDATE_STATUS_TIPS);continue}else{g.setVisible(true)}v=true}else if(g.name==="ui-list-item-update-status"){if(!this.isInDesignMode()){if(this.updateStatus!==UIListView.UPDATE_STATUS_SYNC){g.setVisible(false)}else{g.setVisible(true)}}else{g.setVisible(true)}v=true}if(!g.visible){continue}animatable=g.isVisible()&&!v&&r<this.h&&(t||this.isInDesignMode());if(animatable&&(n!=g.left||r!=g.top||o!=g.w||a!=g.h)){g.setSize(o,a);m.xStart=g.left;m.yStart=g.top;m.wStart=g.w;m.hStart=g.h;m.xEnd=n;m.yEnd=r;m.wEnd=o;m.hEnd=a;m.delay=10;m.duration=1e3;m.element=g;m.onDone=function(t){this.relayoutChildren()};g.animate(m)}else{g.move(n,r);g.setSize(o,a);g.relayoutChildren()}g.widthAttr=UIElement.WIDTH_FILL_PARENT;if(g.heightAttr===UIElement.HEIGHT_FILL_PARENT){g.heightAttr=UIElement.HEIGHT_FIX}g.setUserMovable(u);g.setUserResizable(s||g.isHeightVariable());r+=a+c;p++}return};UIListView.prototype.drawText=UIList.prototype.drawText;UIListView.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.isInDesignMode()){this.drawPageDownUp(t)}return};function UIListViewCreator(t,e,i){var n=["ui-list-view","ui-list-view",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIListView;return r.initUIListView(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIListViewCreator(5,114,null));function UIListItem(){return}UIListItem.prototype=new UIElement;UIListItem.prototype.isUIListItem=true;UIListItem.prototype.saveProps=["heightVariable","slideToRemove","isTemplate","roundRadius"];UIListItem.prototype.initUIListItem=function(t){this.initUIElement(t);this.roundRadius=5;
this.setDefSize(200,120);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setImage(UIElement.IMAGE_FOCUSED,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.setImage(UIElement.IMAGE_POINTER_OVER,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.addEventNames(["onLongPress","onRemoved"]);return this};UIListItem.prototype.dragMove=function(t,e){this.top=this.top+e;this.onDragging();return};UIListItem.prototype.getDeleteItemIcon=function(){var t=this.getHtmlImageByType(UIElement.IMAGE_DELETE_ITEM);return t};UIListItem.prototype.shapeCanBeChild=function(t){if(t.isUIMenu||t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPageManager||t.isUIPage||t.isUIListItem){return false}return true};UIListItem.prototype.onUserResized=function(){var t=this.parentShape;if(t){t.relayoutChildren()}return};UIListItem.prototype.setSlideToRemove=function(t){this.slideToRemove=t;return this};UIListItem.prototype.setHeightVariable=function(t){this.heightVariable=t;return this};UIListItem.prototype.isHeightVariable=function(){return this.heightVariable};UIListItem.prototype.measureHeight=function(t){return this.h};UIListItem.prototype.ANIM_DRAW_LINE=1;UIListItem.prototype.onPointerUpRunning=function(t,e){if(e||!this.slideToRemove){return}var i=this.getMoveAbsDeltaX();var n=this.getMoveAbsDeltaY();if(Math.abs(i)<this.w/2||Math.abs(n)>this.h){return}var r=this;var o=300;var a=(new Date).getTime();r.animateState=this.ANIM_DRAW_LINE;for(var s=0;s<this.children.length;s++){var h=this.children[s];h.style.setTextColor("#C0C0C0")}function l(){var t=new Date;var e=(t.getTime()-a)/o;if(e<1){r.animatePercent=e;setTimeout(l,10)}else{r.animatePercent=1;setTimeout(function(){delete a;delete r.animatePercent;delete r.animateState;var t=r.parentShape;t.removeChild(r);t.relayoutChildren("default");t.postRedraw()},300)}delete t;r.postRedraw()}l();return};UIListItem.prototype.getFillColor=function(t){var e;if(this.pointerDown){var i=Math.abs(this.getMoveAbsDeltaY());if(i<5){var n=Date.now()-this.pointerDownTime;if(n<50&&this.getParent().isUIListView){e=this.style.fillColor;this.postRedraw()}else{e=this.style.textColor}}else{e=this.style.fillColor}}else if(this.isPointerOverShape()){e=this.style.overFillColor?this.style.overFillColor:this.style.fillColor}else if(this.isFocused()){e=this.style.focusedFillColor?this.style.focusedFillColor:this.style.fillColor}else{e=this.style.fillColor}return e};UIListItem.prototype.paintSelfOnly=function(t){if(this.getBgHtmlImage()){return}var e=this.parentShape;var i=this.getFillColor();var n=this.style.lineColor;var r=this.style.lineWidth;t.beginPath();if(!e||e.isUIListView||e.isUIMenu){if(!Shape.isTransparentColor(i)){t.fillStyle=i;t.fillRect(0,0,this.w,this.h)}if(!Shape.isTransparentColor(n)){t.moveTo(0,this.h);t.lineTo(this.w,this.h);t.lineWidth=r;t.strokeStyle=n;t.stroke()}return}var o=this.roundRadius;var a=this===e.children[0];var s=this===e.children[e.children.length-1];if(a&&s){drawRoundRect(t,this.w,this.h,o)}else if(a){drawRoundRect(t,this.w,this.h,o,RoundRect.TL|RoundRect.TR)}else if(s){drawRoundRect(t,this.w,this.h,o,RoundRect.BL|RoundRect.BR)}else{t.rect(0,0,this.w,this.h)}if(!Shape.isTransparentColor(i)){t.fillStyle=i;t.fill()}if(!Shape.isTransparentColor(n)){t.lineWidth=r;t.strokeStyle=n;t.stroke()}return};UIListItem.prototype.afterPaintChildren=function(t){if(!this.animateState){return}var e=this.getDeleteItemIcon();if(this.animateState===this.ANIM_DRAW_LINE&&e&&e.width>0){var i=20;var n=this.animatePercent;var r=(this.w-i)*n-e.width;if(r>i){t.lineWidth=1;t.strokeStyle="#D0D0D0";t.moveTo(i,this.h/2);t.lineTo(r,this.h/2);t.stroke();if(n>.9){var o=(this.h-e.height)/2;var a=this.w-e.width-i;t.drawImage(e,a,o)}}}return};UIListItem.prototype.afterChildAppended=function(t){if(t.isUIButton||t.isUICheckBox){this.setImage(UIElement.IMAGE_ACTIVE,this.getImageByType(UIElement.IMAGE_NORMAL).getImageSrc());this.setImage(UIElement.IMAGE_FOCUSED,this.getImageByType(UIElement.IMAGE_NORMAL).getImageSrc())}return true};function UIListItemCreator(){var t=["ui-list-item","ui-list-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListItem;e.initUIListItem(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIListItemCreator(null,null,null,null));function UIListCheckableItem(){return}UIListCheckableItem.prototype=new UIListItem;UIListCheckableItem.prototype.isUIListCheckableItem=true;UIListCheckableItem.prototype.initUIListCheckableItem=function(t){this.initUIListItem(t);this.isUIListRadioBoxItem=t==="ui-list-radiobox-item";this.isUIListCheckBoxItem=t==="ui-list-checkbox-item";this.setImage(UIElement.IMAGE_CHECKED_FG,null);this.setImage(UIElement.IMAGE_UNCHECK_FG,null);this.addEventNames(["onChanged"]);return this};UIListCheckableItem.prototype.getValue=function(){return this.value};UIListCheckableItem.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value)}return};UIListCheckableItem.prototype.setChecked=function(){var t=this.parentShape;if(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIListCheckableItem){i.setValue(false)}}}this.setValue(true);return};UIListCheckableItem.prototype.setParent=function(t){this.parentShape=t;if(this.value){this.setChecked()}return};UIListCheckableItem.prototype.onClick=function(t,e){if(e){return}if(this.isUIListRadioBoxItem){this.setChecked()}else{this.setValue(!this.value)}return};UIListCheckableItem.prototype.drawFgImage=function(t){var e=this.getHtmlImageByType(this.value?UIElement.IMAGE_CHECKED_FG:UIElement.IMAGE_UNCHECK_FG);if(e){var i=this.w-e.width-20;var n=(this.h-e.height)/2;t.drawImage(e,0,0,e.width,e.height,i,n,e.width,e.height)}return};function UIListCheckBoxItemCreator(){var t=["ui-list-checkbox-item","ui-list-checkbox-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListCheckableItem;e.initUIListCheckableItem(this.type);return e};return}function UIListRadioBoxItemCreator(){var t=["ui-list-radiobox-item","ui-list-radiobox-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListCheckableItem;e.initUIListCheckableItem(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIListCheckBoxItemCreator);ShapeFactoryGet().addShapeCreator(new UIListRadioBoxItemCreator);function UISelect(){return}UISelect.prototype=new UIElement;UISelect.prototype.isUISelect=true;UISelect.prototype.saveProps=["visibleItems","isVertical"];UISelect.prototype.initUISelect=function(t,e,i){this.initUIElement(t);this.offset=0;this.options=[];this.visibleItems=5;this.setDefSize(e,i);this.isVertical=true;this.addEventNames(["onChanged"]);this.setTextType(UIElement.TEXT_TEXTAREA);this.setCanRectSelectable(false,true);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UISelect.prototype.getItemSize=function(){var t=this.isVertical?this.h:this.w;return Math.round(t/this.visibleItems)};UISelect.prototype.getVisibleItems=function(){return this.visibleItems};UISelect.prototype.setVisibleItems=function(t){if(t<=3){this.visibleItems=3}else{this.visibleItems=5}};UISelect.prototype.scrollTo=function(t){var e=this.getItemSize();t=Math.round(t/e)*e;var i=this;var n=500;var r=this.offset;var o=t-r;var a=(new Date).getTime();var s=new DecelerateInterpolator;this.animating=true;function h(){var t=new Date;var e=(t.getTime()-a)/n;var l=s.get(e);if(e<1){i.setOffset(Math.floor(r+l*o));setTimeout(h,10)}else{i.setOffset(r+o,true);delete a;delete s;delete i.animating}delete t}setTimeout(function(){h()},10);return};UISelect.prototype.setOffset=function(t,e){this.offset=t;this.postRedraw();if(e){var i=this.getValue();this.callOnChangedHandler(i)}return};UISelect.prototype.onPointerDownRunning=function(t,e){if(e||this.animating){return}if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();this.saveOffset=this.offset;return true};UISelect.prototype.onPointerMoveRunning=function(t,e){if(e||this.animating){return}this.addMovementForVelocityTracker();var i=this.isVertical?this.getMoveAbsDeltaY():this.getMoveAbsDeltaX();this.setOffset(this.saveOffset+i);return};UISelect.prototype.getMaxOffset=function(){var t=Math.floor(.5*this.visibleItems);return t*this.getItemSize()};UISelect.prototype.getMinOffset=function(){var t=this.getItemSize();var e=Math.round(.5*this.visibleItems);if(this.options.length<=e){return 0}else{return-(this.options.length-e)*t}};UISelect.prototype.handleClicked=function(t){var e=this.getItemSize();var i=this.isVertical?this.h:this.w;var n=Math.floor((i/2-this.offset)/e);var r=Math.floor(((this.isVertical?t.y:t.x)-this.offset)/e);var o=(r-n)*e;var a=this.offset-o;var s=this.getMinOffset();var h=this.getMaxOffset();if(a<s){a=s}if(a>h){a=h}this.scrollTo(a);return};UISelect.prototype.onPointerUpRunning=function(t,e){if(e||this.animating){return}var i=this.velocityTracker.getVelocity();var n=this.isVertical?i.y:i.x;var r=this.isVertical?this.getMoveAbsDeltaY():this.getMoveAbsDeltaX();if(Date.now()-this.pointerDownTime>400){n=0}var o=r+n/2;if(Math.abs(o)<10){this.setOffset(this.saveOffset);this.handleClicked(t);return}var a=this.getMinOffset();var s=this.getMaxOffset();var h=this.saveOffset+r+n;if(h<a){h=a}if(h>s){h=s}this.scrollTo(h);return};UISelect.prototype.shapeCanBeChild=function(t){return false};UISelect.prototype.createOptionsFromText=function(t){if(t){this.options=t.split("\n");this.options.remove("")}else{this.options=[]}};UISelect.prototype.setText=function(t){t=this.toText(t);this.createOptionsFromText(t);this._text=t;return this};UISelect.prototype.setOptions=function(t){this.options=t||[];this.text=this.options.join("\n");return this};UISelect.prototype.getOptions=function(){return this.options};UISelect.prototype.drawText=function(t){return};UISelect.prototype.drawImage=function(t){var e=this.w;var i=this.h;var n=this.getItemSize();t.clipRect(0,0,e,i);this.drawBgImage(t);var r=this.options.length;this.style.setTextB(false);var o=this.style.getFont();var a=this.style.textColor;this.style.setTextB(true);var s=this.style.getFont();var h=this.style.textColorHighlight;t.textAlign="center";t.textBaseline="middle";var l=0;var u=0;var p=this.offset;var c=this.isVertical;var f=c?0:i>>1;var d=c?e>>1:0;var I=c?p:0;var g=c?0:p;t.translate(g,I);if(c){l=Math.floor((.5*i-I)/n)}else{l=Math.floor((.5*e-g)/n)}var m=0;var v=0;for(var y=0;y<r;y++){var U=this.options[y];if(c){f=y*n;m=f+n;u=-p;if(m<u&&f<u){continue}u=-(p-i);if(m>u&&f>u){continue}f=f+(n>>1)}else{d=y*n;v=d+n;u=-p;if(v<u&&d<u){continue}u=-(p-e);if(v>u&&d>u){continue}d=d+(n>>1)}if(l==y){t.font=s;t.fillStyle=h}else{t.font=o;t.fillStyle=a}t.fillText(U,d,f,e)}return};UISelect.prototype.getValue=function(){var t=this.offset;var e=this.getItemSize();var i=this.isVertical?this.h:this.w;var n=Math.floor((.5*i-t)/e);var r=n<this.options.length?this.options[n]:"";return r};UISelect.prototype.setValueByIndex=function(t,e){var i=t;var n=this.getItemSize();if(i>=0){var r=-(i-(this.getVisibleItems()>>1))*n;if(e){this.scrollTo(r)}else{this.setOffset(r,true)}}return this};UISelect.prototype.setValue=function(t,e,i){var n=this.options.indexOf(t.toString());this.setValueByIndex(n,i);if(e){this.callOnChangedHandler(this.getValue())}return this};Object.defineProperty(UISelect.prototype,"text",{set:function(t){t=this.toText(t);this.createOptionsFromText(t);this._text=t},get:function(){return this._text}});function UISelectCreator(t,e){var i=["ui-select","ui-select",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UISelect;return n.initUISelect(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UISelectCreator("ui-select",300,50));function UIImage(){return}UIImage.prototype=new UIElement;UIImage.prototype.isUIImage=true;UIImage.prototype.saveProps=["keepSizeWithImage"];UIImage.prototype.initUIImage=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.setCanRectSelectable(false,true);this.addEventNames(["onUpdateTransform"]);this.scaleX=1;this.scaleY=1;this.drawText=null;this.beforePaint=null;this.afterPaint=null;this.highlightConfig=null;return this};UIImage.prototype.setValue=function(t){this.v=t;return this.setImageSrc(t)};UIImage.prototype.getValue=function(){return this.v!==undefined?this.v:-1};UIImage.prototype.setImageSrc=function(t){this.setImage(UIElement.IMAGE_DEFAULT,t);return this};UIImage.prototype.getImageSrc=function(t){return this.getImageSrcByType(t?t:UIElement.IMAGE_DEFAULT)};UIImage.prototype.getHtmlImage=function(t){return this.getHtmlImageByType(t?t:UIElement.IMAGE_DEFAULT)};UIImage.prototype.getImageSrcRect=function(){var t=this.getImageByType(UIElement.IMAGE_DEFAULT);if(this.srcRect){return this.srcRect}else if(t){return t.getImageRect()}else{return null}};UIImage.prototype.setImageSrcRect=function(t,e,i,n){this.srcRect={};this.srcRect.x=t;this.srcRect.y=e;this.srcRect.w=i;this.srcRect.h=n;return};UIImage.prototype.fitToImage=function(){var t=this.getImageSrcRect();if(t&&t.w&&t.h){this.w=t.rw||t.w;this.h=t.rh||t.h}return};UIImage.prototype.fixChildSize=function(){return};UIImage.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;function UIImageCreator(t){var e=[t,"ui-image",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIImage;return e.initUIImage(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIImageCreator("ui-image"));ShapeFactoryGet().addShapeCreator(new UIImageCreator("ui-icon"));UIImage.prototype.setBorderStyle=function(t,e){return};UIImage.prototype.setClickedStyle=function(t,e){return};UIImage.prototype.getBgImage=function(){return this.images.default_bg};UIImage.prototype.drawTextTips=function(t){};UIImage.prototype.paintSelfFast=function(t){var e=this.opacity;var i=this.w*this.pivotX;var n=this.h*this.pivotY;t.save();if(e!==1){t.globalAlpha*=e}t.translate(this._left,this._top);t.translate(i,n);t.scale(this.scaleX,this.scaleY);t.rotate(this.rotation);t.translate(-i,-n);this.drawBgImage(t);t.restore()};function UILabel(){return}UILabel.prototype=new UIElement;UILabel.prototype.isUILabel=true;UILabel.prototype.saveProps=["hTextAlign","vTextAlign","singleLineMode"];UILabel.prototype.initUILabel=function(t){this.initUIElement(t);this.setText("");this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onChanged","onUpdateTransform"]);return this};UILabel.prototype.setTextAlign=function(t){this.hTextAlign=t;return this};UILabel.prototype.setTextBaseline=function(t){this.vTextAlign=t;return this};UILabel.prototype.getTextAlign=function(){return this.hTextAlign};UILabel.prototype.getTextBaseline=function(){return this.vTextAlign};UILabel.prototype.shapeCanBeChild=function(t){return t.isUILabel||t.isUIImage};UILabel.prototype.setText=function(t){this.text=this.toText(t);this.textNeedRelayout=true;this.callOnChangedHandler(t);this.postRedraw();return this};UILabel.prototype.drawText=function(t){this.layoutText(t);this.defaultDrawText(t);return};UILabel.prototype.layoutText=function(t){RShape.prototype.layoutText.call(this,t);if(this.singleLineMode&&this.lines.length>1){this.lines.length=1}return this};UILabel.prototype.setSingleLineMode=function(t){this.singleLineMode=t;this.setTextNeedRelayout(true);return this};UILabel.prototype.getSingleLineMode=function(){return this.singleLineMode};UILabel.prototype.fitToTextContent=function(){if(!this.text){this.w=30;this.h=30;return}var t=this.getCanvasContext2D();this.layoutText(t);var e=this.lines.length;var i=this.w;var n=this.getTextHeight()+this.vMargin*2;if(e===1){var r=this.lines[0];i=t.measureText(r).width+2*this.hMargin}this.w=i;this.h=n;return this};function UILabelCreator(){var t=["ui-label","ui-label",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UILabel;return e.initUILabel(this.type)};return}ShapeFactoryGet().addShapeCreator(new UILabelCreator);function UITips(){return}UITips.prototype=new UILabel;UITips.prototype.isUITips=true;UITips.prototype.saveProps=["clickable","triangleSize","hTextAlign","vTextAlign"];UITips.prototype.initUITips=function(t){this.initUILabel(t);this.roundRadius=8;this.triangleSize=16;this.setMargin(20,20);this.setClickable(true);this.setDefSize(200,200);this.setSizeLimit(40,40);this.handle={x:-20,y:-20};return this};UITips.prototype.getMoreSelectMark=function(t,e){if(t===Shape.HIT_TEST_HANDLE){e.x=this.handle.x;e.y=this.handle.y;return true}return false};UITips.prototype.getPointer=function(){return this.handle};UITips.prototype.moveHandle=function(t,e){return this.setPointer(this.handle.x+t,this.handle.y+e)};UITips.prototype.setPointer=function(t,e){this.handle.x=t;this.handle.y=e;return this};UITips.prototype.setClickable=function(t){this.clickable=t;return this};UITips.prototype.fitToTextContent=function(){UILabel.prototype.fitToTextContent.call(this);var t=this.roundRadius;var e=this.triangleSize;var i=t+t+e;this.w=Math.max(this.w,i);this.h=Math.max(this.h,i);return this};UITips.prototype.drawPath=function(t){var e=0;var i=0;var n=this.roundRadius;var r=this.triangleSize;var o=this.handle.x;var a=this.handle.y;var s=this.hMargin;var h=this.vMargin;var l=n+n+r;this.w=Math.max(this.w,l);this.h=Math.max(this.h,l);var u=this.w;var p=this.h;var c=r>>1;t.beginPath();function f(){t.lineTo(u-n,0);t.arc(u-n,n,n,1.5*Math.PI,2*Math.PI,false)}function d(){t.lineTo(u,p-n);t.arc(u-n,p-n,n,0,.5*Math.PI,false)}function I(){t.lineTo(n,p);t.arc(n,p-n,n,.5*Math.PI,Math.PI,false)}function g(){t.lineTo(0,n);t.arc(n,n,n,Math.PI,1.5*Math.PI,false)}function m(){t.arc(n,n,n,Math.PI,1.5*Math.PI,false)}function v(){t.arc(u-n,n,n,1.5*Math.PI,2*Math.PI,false)}function y(){t.arc(n,p-n,n,.5*Math.PI,Math.PI,false)}function U(){t.arc(u-n,p-n,n,0,.5*Math.PI,false)}t.moveTo(o,a);if(o<n){if(a<n+c){t.lineTo(n,0);f();d();I();t.lineTo(0,n)}else if(a>p-n-c){t.lineTo(0,p-n);g();f();d();t.lineTo(n,p)}else{t.lineTo(0,a-c);g();f();d();I();t.lineTo(0,a+c)}}else if(o<u-n){if(a<n){t.lineTo(o+c,0);f();d();I();g();t.lineTo(o-c,0)}else{t.lineTo(o-c,p);I();g();f();d();t.lineTo(o+c,p)}}else{if(a<n+c){t.lineTo(u,n);d();I();g();t.lineTo(u-n,0)}else if(a>p-n-c){t.lineTo(u-n,p);I();g();f();t.lineTo(u,p-n)}else{t.lineTo(u,a+c);d();I();g();f();t.lineTo(u,a-c)}}t.closePath();return};UITips.prototype.paintSelfOnlyByColor=function(t){this.drawPath(t);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){t.strokeStyle=this.style.lineColor;t.lineWidth=this.pointerDown&&this.clickable?4:2;t.stroke()}return};UITips.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){this.paintSelfOnlyByColor(t)}return};UITips.prototype.shapeCanBeChild=function(t){return t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage};function UITipsCreator(){var t=["ui-tips","ui-tips",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITips;return e.initUITips(this.type)};return}ShapeFactoryGet().addShapeCreator(new UITipsCreator);function UIMenu(){return}UIMenu.FREE_LAYOUT=0;UIMenu.ARC_LAYOUT=1;UIMenu.VLINEAR_LAYOUT=2;UIMenu.HLINEAR_LAYOUT=3;UIMenu.prototype=new UIElement;UIMenu.prototype.isUIMenu=true;UIMenu.prototype.saveProps=["autoHideWhenClicked","childrenAnimation","enableShowAnimation","enableHideAnimation","spacer","menuItemNr","animDuration","layoutType","originPoint"];UIMenu.prototype.initUIMenu=function(t){this.initUIElement(t,null);this.spacer=2;this.menuItemNr=2;this.animDuration=600;this.setTextType(Shape.TEXT_NONE);this.layoutType=UIMenu.FREE_LAYOUT;this.originPoint=UIElement.ORIGIN_RIGHT;this.setCanRectSelectable(false,false);this.enableHideAnimation=true;this.enableShowAnimation=true;return this};UIMenu.prototype.relayoutChildrenHLL=function(){var t=this.children.length;var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var o=this.spacer;var a=this.getWidth(true);var s=this.getHeight(true);var h=this.originPoint;var l=Math.max(t,this.menuItemNr);var u=Math.round((a-o*(l-1))/l);for(var p=0;p<t;p++){var c=this.children[p];c.h=s;c.w=u;c.left=n;c.top=r;n+=u+o;c.relayoutChildren()}return this};UIMenu.prototype.relayoutChildrenVLL=function(){var t=this.children.length;var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var o=this.spacer;var a=this.getWidth(true);var s=this.getHeight(true);var h=this.originPoint;var l=Math.max(t,this.menuItemNr);var u=Math.round((s-o*(l-1))/l);for(var p=0;p<t;p++){var c=this.children[p];c.w=a;c.h=u;c.left=n;c.top=r;r+=u+o;c.relayoutChildren()}return this};UIMenu.prototype.getChildPositionOfArc=function(t,e,i,n){var r={};var o=t.angleRange>Math.PI*1.9?n:n-1;var a=t.angleStart+t.angleRange*i/o;r.x=t.x+e*Math.cos(a);r.y=t.y+e*Math.sin(a);return r};UIMenu.prototype.relayoutChildrenARC=function(){var t=this.children.length;var e=this.getOrigin();var i=e.r;var n=this.w;var r=this.h;for(var o=0;o<t;o++){var a=this.children[o];var s=this.getChildPositionOfArc(e,i,o,t);a.left=s.x-(a.w>>1);a.top=s.y-(a.h>>1);a.relayoutChildren()}return};UIMenu.prototype.relayoutChildren=function(){var t=this.children.length;if(this.disableRelayout||!t){return}switch(this.layoutType){case UIMenu.HLINEAR_LAYOUT:{this.relayoutChildrenHLL();break}case UIMenu.VLINEAR_LAYOUT:{this.relayoutChildrenVLL();break}case UIMenu.ARC_LAYOUT:{this.relayoutChildrenARC();break}default:{for(var e=0;e<t;e++){this.children[e].relayout()}break}}return};UIMenu.prototype.prepareShowChildAnimation=function(t,e){var i={};i.duration=this.animDuration;i.interpolator="d";i.xStart=e.x-(t.w>>1);i.xEnd=t.left;i.yStart=e.y-(t.h>>1);i.yEnd=t.top;i.scaleXStart=0;i.scaleXEnd=1;i.scaleYStart=0;i.scaleYEnd=1;i.opacityStart=0;i.opacityEnd=1;i.rotationStart=0;i.rotationEnd=2*Math.PI;return i};UIMenu.prototype.prepareHideChildAnimation=function(t,e){var i={};i.duration=this.animDuration;i.interpolator="d";i.xStart=t.left;i.xEnd=e.x-(t.w>>1);i.yStart=t.top;i.yEnd=e.y-(t.h>>1);i.opacityStart=1;i.opacityEnd=0;i.scaleXStart=1;i.scaleXEnd=0;i.scaleYStart=1;i.scaleYEnd=0;i.rotationStart=Math.PI*2;i.rotationEnd=0;return i};UIMenu.prototype.animateShowChildren=function(){var t=this;var e=this.children.length;var i=this.getOrigin();this.busy=e;this.visible=true;for(var n=0;n<e;n++){var r=null;var o=this.children[n];if(o.animations){r=o.animations["show"]}if(!r){r=this.prepareShowChildAnimation(o,i)}else{console.log("Use child show animation.")}o.animate(r,function(){t.busy--})}return this};UIMenu.prototype.animateHideChild=function(t,e){var i=this;var n=t.left;var r=t.top;var o=t.w;var a=t.h;t.animate(e,function(){t.left=n;t.top=r;t.w=o;t.h=a;t.opacity=1;t.visible=false;i.busy--;if(!i.busy){i.visible=false}});return};UIMenu.prototype.animateHideChildren=function(){var t=this;var e=this.children.length;var i=this.getOrigin();this.busy=e;this.visible=true;for(var n=0;n<e;n++){var r=null;var o=this.children[n];if(o.animations){r=o.animations["hide"]}if(!r){r=this.prepareHideChildAnimation(o,i)}else{console.log("Use child hide animation.")}this.animateHideChild(o,r)}return this};UIMenu.prototype.prepareShowAnimation=function(){var t={};t.duration=this.animDuration;t.interpolator="d";t.scaleXStart=.5;t.scaleXEnd=1;t.scaleYStart=.5;t.scaleYEnd=1;t.opacityStart=0;t.opacityEnd=1;return t};UIMenu.prototype.prepareHideAnimation=function(){var t={};t.duration=this.animDuration;t.interpolator="a";t.scaleXStart=1;t.scaleXEnd=.5;t.scaleYStart=1;t.scaleYEnd=.5;t.opacityStart=1;t.opacityEnd=0;return t};UIMenu.prototype.animateShowSelf=function(){var t=this;t.busy=true;var e=null;if(this.animations){e=this.animations["show"]}if(!e){e=this.prepareShowAnimation()}this.animate(e,function(){t.visible=true;t.busy=false})};UIMenu.prototype.animateHideSelf=function(){var t=this;t.busy=true;this.visible=true;var e=null;if(this.animations){e=this.animations["hide"]}if(!e){e=this.prepareHideAnimation()}this.animate(e,function(){t.visible=false;t.busy=false});return this};UIMenu.prototype.show=function(){if(this.busy)return;if(this.autoHideWhenClicked){this.getWindow().grab(this)}if(!this.enableShowAnimation){this.visible=true;return}if(this.childrenAnimation){this.animateShowChildren()}else{this.animateShowSelf()}};UIMenu.prototype.hide=function(){if(this.busy)return;if(this.autoHideWhenClicked){this.getWindow().ungrab(this)}if(!this.enableHideAnimation){this.visible=false;return}if(this.childrenAnimation){return this.animateHideChildren()}else{return this.animateHideSelf()}};UIMenu.prototype.onPointerUpRunning=function(t,e){if(e){return}if(this.autoHideWhenClicked){this.hide()}return};UIMenu.prototype.setVisible=function(t){if(this.visible===t||this.busy){return this}return t?this.show():this.hide()};UIMenu.prototype.getOrigin=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.hMargin;var n=this.vMargin;var r={x:i,y:n};switch(this.originPoint){case UIElement.ORIGIN_UP:{r.x=this.w>>1;r.angleRange=Math.PI;r.angleStart=0;r.r=t>>1;break}case UIElement.ORIGIN_DOWN:{r.x=this.w>>1;r.y=this.h-n;r.angleRange=Math.PI;r.angleStart=Math.PI;r.r=t>>1;break}case UIElement.ORIGIN_LEFT:{r.x=i;r.y=this.h>>1;r.angleRange=Math.PI;r.angleStart=-Math.PI*.5;r.r=e>>1;break}case UIElement.ORIGIN_RIGHT:{r.x=this.w-i;r.y=this.h>>1;r.angleRange=Math.PI;r.angleStart=Math.PI*.5;r.r=e>>1;break}case UIElement.ORIGIN_UP_LEFT:{r.angleRange=Math.PI*.5;r.angleStart=0;r.r=Math.min(t,e);break}case UIElement.ORIGIN_UP_RIGHT:{r.x=this.w-i;r.angleStart=.5*Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_DOWN_LEFT:{r.x=i;r.y=this.h-n;r.angleStart=-.5*Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_DOWN_RIGHT:{r.x=this.w-i;r.y=this.h-n;r.angleStart=Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_MIDDLE_CENTER:{r.x=this.w>>1;r.y=this.h>>1;r.angleStart=-.5*Math.PI;r.angleRange=Math.PI*2;r.r=Math.min(t,e)>>1;break}default:break}return r};UIMenu.prototype.applyTransform=function(t){if(this.isInDesignMode())return;var e=this.getOrigin();if(t.globalAlpha!=this.opacity){t.globalAlpha=this.opacity}if(this.offsetX){t.translate(this.offsetX,0)}if(this.offsetY){t.translate(0,this.offsetY)}var i=this.getScaleX();var n=this.getScaleY();if(this.rotation||i&&i!==1||n&&n!==1){var r=e.x;var o=e.y;t.translate(r,o);if(i&&n){t.scale(i,n)}if(this.rotation){t.rotate(this.rotation)}t.translate(-r,-o)}return};UIMenu.prototype.shapeCanBeChild=function(t){return t.isUIListItem||t.isUIButton||t.isUIImage};function UIMenuCreator(){var t=["ui-menu","ui-menu",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMenu;return e.initUIMenu(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIMenuCreator);function UIPage(){return}UIPage.prototype=new UIElement;UIPage.prototype.isUIPage=true;UIPage.prototype.initUIPage=function(t,e){this.initUIElement(t);this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,e);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;if(!e){this.style.setFillColor("Gold")}return this};UIPage.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIPage.prototype.hide=function(){this.setVisible(false);this.hideHTML();cantkHideAllInput();return};UIPage.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPage){return false}if(t.isUIPageIndicator&&!this.isUIPageExt){return false}return true};UIPage.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};function UIPageCreator(t){var e=["ui-page","ui-page",null,1];ShapeCreator.apply(this,e);this.createShape=function(e){var i=new UIPage;return i.initUIPage(this.type,t)};return}ShapeFactoryGet().addShapeCreator(new UIPageCreator(null));function UICircleLayout(){return}UICircleLayout.prototype=new UIElement;UICircleLayout.prototype.isUILayout=true;UICircleLayout.prototype.isUICircleLayout=true;UICircleLayout.O_CENTER="c";UICircleLayout.O_TOP_LEFT="tl";UICircleLayout.O_TOP_MIDDLE="tm";UICircleLayout.O_TOP_RIGHT="tr";UICircleLayout.O_LEFT_MIDDLE="lm";UICircleLayout.O_RIGHT_MIDDLE="rm";UICircleLayout.O_BOTTOM_LEFT="bl";UICircleLayout.O_BOTTOM_MIDDLE="bm";UICircleLayout.O_BOTTOM_RIGHT="br";UICircleLayout.prototype.initUICircleLayout=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);this.origin=UICircleLayout.O_CENTER;this.setSizeLimit(120,120,1e3,1e3,1);return this};UICircleLayout.prototype.shapeCanBeChild=function(t){if(t.isUIImage||t.isUIButton){return true}return false};UICircleLayout.prototype.paintSelfOnly=function(t){if(this.isInDesignMode()){t.lineWidth=this.style.lineWidth;switch(this.origin){case UICircleLayout.O_CENTER:{var e=this.w>>1;var i=this.h>>1;var n=(this.w>>1)-30;var r=this.children.length?this.children.length:6;var o=r>1?2*Math.PI/(r-1):0;t.beginPath();t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;t.arc(e,i,n,0,Math.PI*2);t.stroke();var a=-.5*Math.PI;for(var s=0;s<r;s++){t.beginPath();if(s==0){t.arc(e,i,10,0,Math.PI*2);t.stroke()}else{var h=o*(s-1)+a;var l=e+n*Math.cos(h);var u=i+n*Math.sin(h);t.arc(l,u,10,0,Math.PI*2);t.stroke()}}t.stroke();break}default:break}}return};UICircleLayout.prototype.moveShapeToCenter=function(t,e,i){e=e-(t.w>>1);i=i-(t.h>>1);t.move(e,i);return};UICircleLayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}switch(this.origin){case UICircleLayout.O_CENTER:{var t=this.w>>1;var e=this.h>>1;var i=(this.w>>1)-30;var n=this.children.length-1;var r=n>0?2*Math.PI/n:0;var o=-.5*Math.PI;for(var a=0;a<this.children.length;a++){var s=this.children[a];if(a==0){this.moveShapeToCenter(s,t,e)}else{var h=r*(a-1)+o;var l=t+i*Math.cos(h);var u=e+i*Math.sin(h);this.moveShapeToCenter(s,l,u)}}break}default:break}return};UICircleLayout.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_FIX_TOP;t.xAttr=UIElement.X_FIX_LEFT;t.widthAttr=UIElement.WIDTH_SCALE;t.heightAttr=UIElement.HEIGHT_SCALE;t.setUserMovable(true);t.setUserResizable(true);t.setCanRectSelectable(false,true);this.relayoutChildren();return true};function UICircleLayoutCreator(t,e,i){var n=["ui-circle-layout","ui-circle-layout",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UICircleLayout;return r.initUICircleLayout(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UICircleLayoutCreator(400,400));function UIGrid(){return}UIGrid.prototype=new UIElement;UIGrid.prototype.isUIGrid=true;UIGrid.prototype.isUILayout=true;UIGrid.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.cols=this.cols;t.rows=this.rows;t.spacer=this.spacer;t.scrollDirection=this.scrollDirection;return t};UIGrid.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.cols=t.cols;
this.rows=t.rows;this.spacer=t.spacer;this.scrollDirection=t.scrollDirection;return t};UIGrid.prototype.initUIGrid=function(t){this.initUIElement(t);this.spacer=0;this.offset=0;this.setMargin(0,0);this.setDefSize(200,200);this.rows=3;this.cols=3;this.checkable=false;this.rectSelectable=false;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.setImage(UIElement.IMAGE_CHECKED_ITEM,null);this.addEventNames(["onChildDragged","onChildDragging","onInit"]);return this};UIGrid.prototype.setRows=function(t){this.rows=t;return this};UIGrid.prototype.getRows=function(){return this.rows};UIGrid.prototype.setCols=function(t){this.cols=t;return this};UIGrid.prototype.getCols=function(){return this.cols};UIGrid.prototype.isCheckable=function(t){return this.checkable};UIGrid.prototype.setCheckable=function(t){this.checkable=t;return this};UIGrid.prototype.setChildChecked=function(t,e){if(t>=0&&t<this.children.length){this.children[t].checked=e}return this};UIGrid.prototype.isChildChecked=function(t){if(t<this.children.length){return this.children[t].checked}return false};UIGrid.prototype.getChildByRowCol=function(t,e){var i=this.getCols();var n=t*i+e;if(n<this.children.length){return this.children[n]}else{return null}};UIGrid.prototype.getChildRow=function(t){var e=this.getCols();var i=this.children.indexOf(t);return Math.floor(i/e)};UIGrid.prototype.getChildCol=function(t){var e=this.getCols();var i=this.children.indexOf(t);return i%e};UIGrid.prototype.exchangeTwoChildren=function(t,e,i){var n=this.children.length;if(t<0||t>=n||e<0||e>=n){return this}var r=this.children[t];this.children[t]=this.children[e];this.children[e]=r;this.relayoutChildren(i);return this};UIGrid.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIGrid.prototype.childIsBuiltin=function(t){return t.name==="ui-last"};UIGrid.prototype.calcItemSize=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=Math.floor(t/this.cols);var n=Math.floor(e/this.rows);return{w:i,h:n,cols:this.cols,rows:this.rows}};UIGrid.prototype.sortChildren=function(){};UIGrid.prototype.getChildIndexByPoint=function(t){var e=this.getHMargin();var i=this.calcItemSize();var n=this.spacer;var r=this.getWidth(true);var o=this.getHeight(true);var a=i.w+n;var s=i.h+n;var h=Math.floor(r/a);var l=Math.floor(o/s);var u=Math.floor((t.y-e)/i.h);var p=Math.floor((t.x-e)/i.w);var c=u*h+p;return c};UIGrid.prototype.onChildDragging=function(t,e){var i=this.getChildIndexByPoint(e);var n=this.getIndexOfChild(t);this.callOnChildDraggingHandler(n,i);return};UIGrid.prototype.onChildDragged=function(t,e){var i=this.getChildIndexByPoint(e);var n=this.getIndexOfChild(t);this.callOnChildDraggedHandler(n,i);this.relayoutChildren("default");return};UIGrid.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=0;var i=0;var n=0;var r=0;var o=this.cols;var a=this.rows;var s=this.spacer;var h=this.getWidth(true);var l=this.getHeight(true);var u=Math.floor((h-(o-1)*s)/o);var p=Math.floor((l-(a-1)*s)/a);var c=u+s;var f=p+s;var d=this.h-a*f>>1;var I=this.w-o*c>>1;var g=0;var m=this.children.length;var v=this.children;for(var y=0;y<m;y++){var U=v[y];U.z=y;if(U.removed||!U.visible)continue;e=Math.floor(g/o);i=Math.floor(g%o);n=I+i*c;r=d+e*f;U.setSize(u,p);if(t||this.isInDesignMode()){U.animMove(n,r,t)}else{U.move(n,r)}U.xAttr=UIElement.X_FIX_LEFT;U.yAttr=UIElement.Y_FIX_TOP;U.widthAttr=UIElement.WIDTH_FIX;U.heightAttr=UIElement.HEIGHT_FIX;U.setUserMovable(true);U.setUserResizable(false);U.relayoutChildren();if(!this.isUIScrollView){U.setDraggable(this.itemDraggable)}g++}return};UIGrid.prototype.afterChildAppended=function(t){if(this.isInDesignMode()&&!this.disableRelayout){this.sortChildren()}this.moveMustBeLastItemToLast();t.setUserMovable(true);t.setUserResizable(false);t.setCanRectSelectable(false,true);t.setDraggable(this.itemDraggable);t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FIX;if(this.isInDesignMode()&&!this.disableRelayout){this.relayoutChildren()}return true};UIGrid.prototype.triggerDeleteMode=function(){if(this.isInDesignMode()){return}this.deleteMode=!this.deleteMode;var t=this;function e(){t.postRedraw();if(t.deleteMode){setTimeout(e,20)}}e();return};UIGrid.prototype.isInDeleteMode=function(){return this.deleteMode&&!this.isInDesignMode()};UIGrid.prototype.beforePaintChild=function(t,e){if(this.isInDeleteMode()){e.save();var i=t.left+t.w/2;var n=t.top+t.h/2;var r=e.now/1e3;var o=.03*Math.cos(20*r);e.translate(i,n);e.rotate(o);e.translate(-i,-n)}return};UIGrid.prototype.afterPaintChild=function(t,e){if(this.isInDeleteMode()){var i=this.getImageByType(UIElement.IMAGE_DELETE_ITEM);if(WImage.isValid(i)){var n=i.getImage();var r=i.getImageRect();var o=t.top+t.vMargin;var a=t.left+t.w-r.w-t.hMargin;e.drawImage(n,a,o);WImage.draw(e,n,WImage.DISPLAY_CENTER,a,o,r.w,r.h,r)}e.restore();return}if(this.checkable){if(t.checked){var i=this.getImageByType(UIElement.IMAGE_CHECKED_ITEM);if(WImage.isValid(i)){var n=i.getImage();var r=i.getImageRect();WImage.draw(e,n,WImage.DISPLAY_AUTO_SIZE_DOWN,t.left,t.top,t.w,t.h,r)}}}return};function UIGridCreator(t){var e=["ui-grid","ui-grid",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIGrid;return e.initUIGrid(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridCreator);function UIGridView(){return}UIGridView.prototype=new UIVScrollView;UIGridView.prototype.isUIGrid=true;UIGridView.prototype.isUILayout=true;UIGridView.prototype.isUIGridView=true;UIGridView.prototype.doToJson=UIGrid.prototype.doToJson;UIGridView.prototype.doFromJson=UIGrid.prototype.doFromJson;UIGridView.prototype.sortChildren=UIGrid.prototype.sortChildren;UIGridView.prototype.initUIGrid=UIGrid.prototype.initUIGrid;UIGridView.prototype.shapeCanBeChild=UIGrid.prototype.shapeCanBeChild;UIGridView.prototype.childIsBuiltin=UIGrid.prototype.childIsBuiltin;UIGridView.prototype.paintSelfOnly=UIGrid.prototype.paintSelfOnly;UIGridView.prototype.calcItemSize=UIGrid.prototype.calcItemSize;UIGridView.prototype.relayoutChildren=UIGrid.prototype.relayoutChildren;UIGridView.prototype.afterChildAppended=UIGrid.prototype.afterChildAppended;UIGridView.prototype.isInDeleteMode=UIGrid.prototype.isInDeleteMode;UIGridView.prototype.beforePaintChild=UIGrid.prototype.beforePaintChild;UIGridView.prototype.afterPaintChild=UIGrid.prototype.afterPaintChild;UIGridView.prototype.triggerDeleteMode=UIGrid.prototype.triggerDeleteMode;UIGridView.prototype.setCheckable=UIGrid.prototype.setCheckable;UIGridView.prototype.setChildChecked=UIGrid.prototype.setChildChecked;UIGridView.prototype.isChildChecked=UIGrid.prototype.isChildChecked;UIGridView.prototype.initUIGridView=function(t){this.initUIGrid(t);this.initUIVScrollView(t,0,null,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.setImage(UIElement.IMAGE_CHECKED_ITEM,null);return this};UIGridView.prototype.onModeChanged=function(){this.offset=0;return};function UIGridViewCreator(){var t=["ui-grid-view","ui-grid-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGridView;return e.initUIGridView(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridViewCreator);function UIImageValue(){return}UIImageValue.prototype=new UIImage;UIImageValue.prototype.isUIImageValue=true;UIImageValue.prototype.initUIImageValue=function(t,e,i){this.initUIImage(t,e,i,null);this.value=0;return this};UIImageValue.prototype.getImageSrcByValue=function(t){var e="option_image_"+t;return this.getImageSrcByType(e)};UIImageValue.prototype.getValue=function(){return this.value};UIImageValue.prototype.setValue=function(t){var e=this.getImageSrcByValue(t);if(e){this.value=t;this.setImage(UIElement.IMAGE_DEFAULT,e)}return this.value};UIImageValue.prototype.inc=function(){var t=this.value+1;return this.setValue(t)};UIImageValue.prototype.dec=function(){var t=this.value-1;return this.setValue(t)};UIImageValue.prototype.getImages=function(){var t="";for(var e in this.images){var i=this.images[e];if(e.indexOf("option_image_")>=0&&i&&i.src){t+=i.src+"\n"}}return t};UIImageValue.prototype.setImages=function(t){var e=this.images.display;this.images={};this.images.display=e;if(t){var i=0;var n=0;var r=t.split("\n");for(var i=0;i<r.length;i++){var o=r[i];if(!o)continue;if(o.indexOf("/")===0){o=o.substr(1)}var a="option_image_"+n++;this.setImage(a,o)}this.setValue(this.value)}return this};UIImageValue.prototype.shapeCanBeChild=function(t){return false};function UIImageValueCreator(t,e,i){var n=["ui-image-value","ui-image-value",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIImageValue;return r.initUIImageValue(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIImageValueCreator(200,200,null));function UIImageThumbView(){return}UIImageThumbView.prototype=new UIImageView;UIImageThumbView.prototype.isUIImageThumbView=true;UIImageThumbView.prototype.saveProps=["keepRatio","itemSize"];UIImageThumbView.prototype.initUIImageThumbView=function(t,e){this.userImages=[];this.imageProxies=[];this.itemSize=0;this.setDefSize(t,e);this.initUIImageView(t,e);this.setItemSize=UIImageThumbView.prototype.setItemSize;this.getCacheCanvas=UIImageThumbView.prototype.getCacheCanvas;this.getCacheCanvasContext=UIImageThumbView.prototype.getCacheCanvasContext;this.setValue=UIImageThumbView.prototype.setValue;this.getCurrentImage=UIImageThumbView.prototype.getCurrentImage;this.getCurrentImageSrc=UIImageThumbView.prototype.getCurrentImageSrc;imageThumbViewInitCustomProp(this);this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);this.addEventNames(["onChanged"]);return this};UIImageThumbView.prototype.setItemSize=function(t){this.itemSize=t?t:100;if(t){this.setSizeLimit(100,t+10,2e3,2e3)}return};UIImageThumbView.prototype.setKeepRatio=function(t){if(this.keepRatio!=t){this.cacheInvalid=true}this.keepRatio=t;return};UIImageThumbView.prototype.getCacheCanvasContext=function(t,e){if(!this.cacheImagesCanvas){canvas=document.createElement("canvas");canvas.width=t;canvas.height=e;this.cacheImagesCanvas=canvas}if(canvas.width!=t){canvas.width=t}if(canvas.height!=e){canvas.height=e}var i=canvas.getContext("2d");i.clearRect(0,0,t,e);return i};UIImageThumbView.prototype.getCurrentImageSrc=function(){return this.currentImageProxy?this.currentImageProxy.src:null};UIImageThumbView.prototype.getCurrentImage=function(){return this.currentImageProxy?this.currentImageProxy.image:null};UIImageThumbView.prototype.setValue=function(t){for(var e=0;e<this.imageProxies.length;e++){var i=this.imageProxies[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){this.currentImageProxy=i;return this}}return this};UIImageThumbView.createImageProxy=function(t,e,i,n,r,o,a,s,h){var l={};l.x=o;l.y=a;l.w=s;l.h=h;l.src=e;l.imageState=UIImageView.IMAGE_STATE_PENDING;function u(e,i){var o=t.keepRatio;if(i){l.imageState=UIImageView.IMAGE_STATE_DONE;UIImageView.drawImageAtCenter(r,e,l.x,l.y,l.w,l.h,o)}else{l.imageState=UIImageView.IMAGE_STATE_ERROR;UIImageView.drawImageAtCenter(r,n,l.x,l.y,l.w,l.h,o)}console.log("onLoadDone: "+e.src);t.postRedraw()}l.image=UIImageView.createImage(e,u);if(l.imageState===UIImageView.IMAGE_STATE_PENDING){var p=t.keepRatio;UIImageView.drawImageAtCenter(r,i,l.x,l.y,l.w,l.h,p)}return l};UIImageThumbView.prototype.createCacheCanvas=function(){};UIImageThumbView.prototype.getCacheCanvas=function(){if(this.cacheInvalid||!this.cacheImagesCanvas){this.createCacheCanvas()}return this.cacheImagesCanvas};function UIImageThumbViewTape(){return}UIImageThumbViewTape.prototype=new UIHScrollView;UIImageThumbViewTape.prototype.isUIImageView=true;UIImageThumbViewTape.prototype.isUIImageThumbView=true;UIImageThumbViewTape.prototype.isUIImageThumbViewTape=true;UIImageThumbViewTape.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewTape.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewTape.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewTape.prototype.initUIImageThumbViewTape=function(t,e,i){this.initUIHScrollView(t,10,null);this.initUIImageThumbView(e,i);this.heightAttr=UIElement.HEIGHT_FIX;return this};UIImageThumbViewTape.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewTape.prototype.createCacheCanvas=function(){var t=this.getSpaceBetweenImages();var e=this.w;var i=this.h;var n=this.itemSize>0&&this.itemSize<i?this.itemSize:i;var r=this.cacheImagesCanvas;var o=this.userImages.length;delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;if(!o){return}e=o*(n+t);var a=0;var s=Math.floor((i-n)/2);var h=this.errorImage;var l=this.loadingImage;var u=this.getCacheCanvasContext(e,i);for(var p=0;p<this.userImages.length;p++){var c=this.userImages[p];var f=UIImageThumbView.createImageProxy(this,c,l,h,u,a,s,n,n);this.imageProxies.push(f);a=a+n+t}return};UIImageThumbViewTape.prototype.getScrollRange=function(){var t=this.h;var e=this.getSpaceBetweenImages();var i=this.userImages.length*(t+e)+e;return i};UIImageThumbViewTape.prototype.paintChildren=function(t){return};UIImageThumbViewTape.prototype.getCacheCanvasOffset=function(){var t=Math.max(0,(this.w-this.cacheImagesCanvas.width)/2);return t};UIImageThumbViewTape.prototype.onClick=function(t,e){if(!this.imageProxies||!this.imageProxies.length||e){return}this.currentImageProxy=null;var i=t.x-this.getCacheCanvasOffset();for(var n=0;n<this.imageProxies.length;n++){var r=this.imageProxies[n];if(i>=r.x&&i<r.x+r.w){this.currentImageProxy=r}}this.callOnClickHandler(t);this.callOnChangedHandler(this.getCurrentImageSrc());return};UIImageThumbViewTape.prototype.paintSelfOnly=function(t){if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){t.rect(0,0,this.w,this.h);t.stroke();return}var e=0;var i=0;var n=this.h;var r=this.w;var o=this.getCacheCanvas();var a=this.getCacheCanvasOffset();var s=a;t.rect(0,0,this.w,this.h);t.clip();t.beginPath();if(this.offset>=0){if(s>this.offset){s=s-this.offset;var e=o.width;t.drawImage(this.cacheImagesCanvas,0,0,e,n,s,i,e,n);a=s}else{var h=this.offset-s;var e=Math.min(r,o.width-h);t.drawImage(this.cacheImagesCanvas,h,0,e,n,0,i,e,n);a=-h}}else{s=s-this.offset;var e=Math.min(r+this.offset,o.width);t.drawImage(this.cacheImagesCanvas,0,0,e,n,s,i,e,n);a=s}if(this.currentImageProxy){s=a+this.currentImageProxy.x;i=this.currentImageProxy.y;t.lineWidth=3;t.rect(s,i,this.currentImageProxy.w,this.currentImageProxy.h);t.stroke()}return};function UIImageThumbViewTapeCreator(){var t=["ui-image-thumb-view-tape","ui-image-thumb-view-tape",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageThumbViewTape;return e.initUIImageThumbViewTape(this.type,300,100)};return}function UIImageThumbViewGrid(){return}UIImageThumbViewGrid.prototype=new UIHScrollView;UIImageThumbViewGrid.prototype.isUIImageView=true;UIImageThumbViewGrid.prototype.isUIImageThumbView=true;UIImageThumbViewGrid.prototype.isUIImageThumbViewGrid=true;UIImageThumbViewGrid.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewGrid.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewGrid.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewGrid.prototype.initUIImageThumbViewGrid=function(t,e,i){this.initUIHScrollView(t,10,null);this.initUIImageThumbView(e,i);this.setSizeLimit(100,40,2e3,2e3);this.rows=4;this.cols=3;this.pageNr=1;this.itemSize=100;return this};UIImageThumbViewGrid.prototype.calcSize=function(){if(!this.userImages){return}if(this.isIcon){this.cols=3;this.rows=4;this.pageNr=1;return}var t=this.userImages.length;var e=this.getDeviceConfig();var i=e?e.lcdDensity:"hdpi";var n=this.getDensitySizeByName(i)/160;var r=this.w/n;var o=this.h/n;var a=Math.round(r/this.itemSize);var s=Math.round(o/this.itemSize);this.cols=a;this.rows=s;this.pageNr=Math.ceil(t/(s*a));return};UIImageThumbViewGrid.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewGrid.prototype.createCacheCanvas=function(){var t=this.userImages.length;var e=this.getSpaceBetweenImages();delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;this.calcSize();if(!t){return}var i=0;var n=0;var r=0;var o=this.h;var a=this.pageNr*this.w;var s=this.getCacheCanvasContext(a,o);var h=Math.floor((this.w-e)/this.cols)-e;var l=Math.floor((this.h-e)/this.rows)-e;var u=this.errorImage;var p=this.loadingImage;for(var c=0;c<this.pageNr;c++){n=e;for(var f=0;f<this.rows;f++){i=c*this.w+e;for(var d=0;d<this.cols;d++,r++){if(r>=t){break}var I=this.userImages[r];var g=UIImageThumbView.createImageProxy(this,I,p,u,s,i,n,h,l);this.imageProxies.push(g);i=i+h+e}n=n+l+e}}return};UIImageThumbViewGrid.prototype.getScrollRange=function(){var t=this.pageNr*this.w;return t};UIImageThumbViewGrid.prototype.paintChildren=function(t){return};UIImageThumbViewGrid.prototype.getCacheCanvasOffset=function(){return this.getSpaceBetweenImages()};UIImageThumbViewGrid.prototype.onClick=function(t,e){if(!this.imageProxies||!this.imageProxies.length||e){return}var i=t.x;var n=t.y;var r=this.imageProxies.length;var o=Math.floor(i/this.w);var a=Math.floor(n*this.rows/this.h);var s=Math.floor(i%this.w*this.cols/this.w);var h=o*this.rows*this.cols+a*this.cols+s;if(h<r){this.currentImageProxy=this.imageProxies[h]}this.callOnClickHandler(t);this.callOnChangedHandler(this.getCurrentImageSrc());return this.callOnClickHandler(t)};UIImageThumbViewGrid.prototype.paintSelfOnly=function(t){var e=this.getSpaceBetweenImages();if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){t.rect(0,0,this.w,this.h);t.stroke();return}var i=0;var n=this.w;var r=this.offset;var o=this.getCacheCanvas();var a=o.height;var s=o.width;if(r>=0){var i=Math.min(n,s-r);t.drawImage(this.cacheImagesCanvas,r,0,i,a,0,0,i,a)}else{var i=Math.min(s+r,n);t.drawImage(this.cacheImagesCanvas,0,0,i,a,-r,0,i,a)}if(this.currentImageProxy){y=this.currentImageProxy.y;x=this.currentImageProxy.x-r;t.rect(x,y,this.currentImageProxy.w,this.currentImageProxy.h);t.lineWidth=3;t.strokeStyle=this.style.lineColor;t.stroke()}return};UIImageThumbViewGrid.prototype.saveProps=UIImageThumbView.prototype.saveProps;UIImageThumbViewTape.prototype.saveProps=UIImageThumbView.prototype.saveProps;function UIImageThumbViewGridCreator(){var t=["ui-image-thumb-view-grid","ui-image-thumb-view-grid",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageThumbViewGrid;return e.initUIImageThumbViewGrid(this.type,300,100)};return}ShapeFactoryGet().addShapeCreator(new UIImageThumbViewTapeCreator);ShapeFactoryGet().addShapeCreator(new UIImageThumbViewGridCreator);function UILayout(){return}UILayout.prototype=new UIElement;UILayout.prototype.isUILayout=true;UILayout.prototype.initUILayout=function(t,e,i){this.initUIElement(t);this.spacer=10;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);this.vLayout=this.type==="ui-v-layout";this.addEventNames(["onInit"]);return this};UILayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=this.w;var e=this.h;var i=this.hMargin;var n=this.vMargin;var r=this.vLayout;var o=this.spacer?this.spacer:0;var a=this.children.length;var s=this.children;for(var h=0;h<a;h++){var l=s[h];if(!l.isVisible()){continue}if(r){l.top=n;l.left=t-l.w>>1;if(l.heightAttr===UIElement.HEIGHT_SCALE){l.h=l.heightParam*e}n+=l.h+o}else{l.left=i;l.top=e-l.h>>1;if(l.widthAttr===UIElement.WIDTH_SCALE){l.w=l.widthParam*t}i+=l.w+o}l.relayoutChildren()}return};function UILayoutCreator(t){var e=[t,t,null,true];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UILayout;return e.initUILayout(this.type,100,100)};return}UILayout.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;ShapeFactoryGet().addShapeCreator(new UILayoutCreator("ui-v-layout"));ShapeFactoryGet().addShapeCreator(new UILayoutCreator("ui-h-layout"));function UIFrames(){return}UIFrames.prototype=new UIElement;UIFrames.prototype.isUIFrames=true;UIFrames.prototype.saveProps=["current"];UIFrames.prototype.initUIFrames=function(t){this.initUIElement(t);this.current=0;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.addEventNames(["onChanged"]);return this};UIFrames.preparseBackendCanvas=function(t,e){var i=t.w;var n=t.h;var r=Animation.getBackendCanvas(2*i,n);var o=r.getContext("2d");o.now=Date.now();o.timeStep=0;o.clearRect(0,0,2*i,n);o.save();t.paint(o);o.translate(i,0);e.paint(o);o.restore();return r};UIFrames.prototype.getStatusString=function(){var t="";var e=this.current+1;var i=this.children.length;var n=this.getCurrentFrame();e=e<=i?e:i;if(n&&n.name){t=n.name+"("+e+"/"+i+")"}else{t=e+"/"+i}return t};UIFrames.prototype.getCurrent=function(){return this.current};UIFrames.prototype.setCurrent=function(t){if(this.current!==t){this.current=t;if(!this.isInDesignMode()){this.callOnChangedHandler(t)}}return this};UIFrames.prototype.getCurrentFrame=function(){if(this.children.length<1){return null}if(this.current<0||!this.current){this.current=0}if(this.current>=this.children.length){this.current=this.children.length-1}return this.children[this.current]};UIFrames.prototype.fixChildSize=function(t){return};UIFrames.prototype.fixChildPosition=function(t){var e=t.left;var i=t.top;var n=t.h;var r=t.w;if(t.freePosition){return}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){e=this.getHMargin();r=this.getWidth(true)}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){i=this.getVMargin();n=this.getHeight(true)}t.left=e;t.top=i;t.h=n;t.w=r;return};UIFrames.prototype.setTarget=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(!t){i.setSelected(false);continue}if(i!=t&&i!=t.popupWindow){i.setSelected(false)}}this.targetShape=t;this.selected=!t;return};UIFrames.prototype.dispatchPointerDownToChildren=function(t){var e=null;if(this.children.length<1){return false}e=this.getCurrentFrame();if(e.onPointerDown(t)){this.setTarget(e);return true}return false};UIFrames.prototype.addShapeIntoChildren=function(t,e){var i=null;if(this.children.length<1){return false}i=this.getCurrentFrame();return i.addShape(t,true,e)};UIFrames.prototype.paintChildren=function(t){var e=this.getCurrentFrame();if(e){t.save();t.beginPath();e.paintSelf(t);t.restore()}return};UIFrames.prototype.showNextFrame=function(){this.showFrame(this.current+1);this.relayoutChildren();return};UIFrames.prototype.getFrame=function(t){if(t<0||t>=this.children.length){return null}return this.children[t]};UIFrames.prototype.getFrameIndex=function(t){return this.getIndexOfChild(t)};UIFrames.prototype.getFrames=function(){return this.children.length};UIFrames.prototype.showPrevFrame=function(){this.showFrame(this.current-1);this.relayoutChildren();return};UIFrames.prototype.showFrame=function(t){var e=(t+this.children.length)%this.children.length;this.setCurrent(e);var i=this.children[this.current];if(i){i.show(true)}return};UIFrames.prototype.shapeCanBeChild=function(t){return true};UIFrames.prototype.relayoutChildren=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.left=0;e.top=0;e.w=this.w;e.h=this.h;e.widthAttr=UIElement.WIDTH_FILL_PARENT;e.heightAttr=UIElement.HEIGHT_FILL_PARENT;e.relayoutChildren()}return};UIFrames.prototype.afterChildAppended=function(t){this.current=this.children.length-1;return};UIFrames.prototype.onChildRemoved=function(t){return};UIFrames.prototype.afterChildRemoved=function(t){if(this.children.length===0){this.current=0}else if(this.current>=this.children.length){this.current--}this.onChildRemoved(t);return};UIFrames.prototype.findChildByPoint=function(t,e){var i=t;var n=this.getCurrentFrame();if(n){var r=n.findChildByPoint(i,e);if(r===n&&!n.hitTest(i)){return this}return r}return this};function UIFramesCreator(){var t=["ui-frames","ui-frames",null,0];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFrames;return e.initUIFrames(this.type)};return}function UICheckBox(){return}UICheckBox.prototype=new UIElement;UICheckBox.prototype.isUICheckBox=true;UICheckBox.prototype.initUICheckBox=function(t){this.initUIElement(t);this.setDefSize(100,100);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.setImage(UIElement.IMAGE_CHECKED_FG,null);this.setImage(UIElement.IMAGE_UNCHECK_FG,null);this.addEventNames(["onChanged","onUpdateTransform"]);this.value=false;return this};UICheckBox.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUILabel};UICheckBox.prototype.getValue=function(){return this.value};UICheckBox.prototype.setValue=function(t,e){if(this.value!=t){this.value=t;if(e){this.callOnChangedHandler(this.value)}}return this};UICheckBox.prototype.getBgImage=function(){return this.getImageByType(this.getValue()?UIElement.IMAGE_CHECKED_FG:UIElement.IMAGE_UNCHECK_FG)};UICheckBox.prototype.getTextColor=function(t){return this.getValue()?this.style.textColorOn:this.style.textColor};UICheckBox.prototype.onClick=function(t,e){if(e){return}this.setValue(!this.getValue(),true);this.callOnClickHandler(t);return};function UICheckBoxCreator(){var t=["ui-checkbox","ui-checkbox",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UICheckBox;return e.initUICheckBox(this.type)};return}ShapeFactoryGet().addShapeCreator(new UICheckBoxCreator);function UISwitch(){return}UISwitch.prototype=new UICheckBox;UISwitch.prototype.isUISwitch=true;UISwitch.prototype.initUISwitch=function(t,e,i,n,r){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,r);this.value=true;this.imageWidth=412;this.maskWidth=n;this.offsetImage=n;this.addEventNames(["onChanged"]);this.interpolator=new DecelerateInterpolator(2);return this};UISwitch.prototype.updateImageSize=function(t){this.imageWidth=t;this.maskWidth=Math.floor(t*.373786);if(!this.animating){this.offsetImage=this.value?this.maskWidth:this.imageWidth-this.maskWidth}return};UISwitch.prototype.animateChange=function(){var t=this;var e=new Date;var i=e.getTime();var n=this.offsetImage;var r=this.value?this.maskWidth:this.imageWidth-this.maskWidth;var o=r-n;this.animating=true;var a=500;function s(){var e=new Date;var h=e.getTime();var l=(h-i)/a;var u=t.interpolator.get(l);var p=n+o*u;if(l<1){t.offsetImage=p;setTimeout(s,10)}else{t.offsetImage=r;delete this.animating}t.postRedraw();delete e;return}setTimeout(s,30);return};UISwitch.prototype.onClick=function(t,e){if(e||!this.isInDesignMode()){return}this.setValue(!this.value);return};UISwitch.prototype.onPointerDownRunning=function(t,e){if(e){return}this.pointerDownPosition=t;return};UISwitch.prototype.onPointerUpRunning=function(t,e){if(e){return}var i=t.x-this.pointerDownPosition.x;if(Math.abs(i)<5){this.setValue(!this.value)}else{this.setValue(i>0)}return};UISwitch.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value);this.animateChange()}return this};UISwitch.prototype.drawBgImage=function(t){return};UISwitch.prototype.drawFgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(e){this.updateImageSize(e.width);var i=e.height;var n=this.maskWidth;var r=(this.w-n)/2;var o=(this.h-i)/2;this.imageWidth=e.width;t.drawImage(e,this.offsetImage,0,n,i,r,o,n,i);t.drawImage(e,0,0,n,i,r,o,n,i)}return};function UISwitchCreator(t,e,i,n){var r=["ui-switch","ui-switch",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var o=new UISwitch;return o.initUISwitch(this.type,t,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UISwitchCreator(154,54,154,null));function UISimpleHTML(){return}UISimpleHTML.prototype=new UIVScrollView;UISimpleHTML.prototype.isUISimpleHTML=true;UISimpleHTML.prototype.saveProps=["scrollable"];UISimpleHTML.prototype.initUISimpleHTML=function(t,e,i){this.initUIVScrollView(t,10,i,null);this.setText(e);this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,i);return this};UISimpleHTML.prototype.extractHtmlElements=function(t,e){var i=0;var n=null;var r=this;var o=t.localName;var a=t.childNodes.length;var s=t.childNodes;function h(t){var e={x:0,y:0};e.type=t;return e}if(o==="b"){this.bold=this.bold+1}else if(o==="i"){this.italic=this.italic+1}else if(o==="u"){this.underline=this.underline+1}else if(o==="a"){this.anchor=this.anchor+1}else if(o==="ol"||o==="ul"){if(e>0){n=h("newline")}}else if(o==="li"){n=h("text");if(t.parentNode.localName==="ol"){n.value="    "+(e+1)+". "}else{n.value="    o. "}n.bold=true;n.color="gray";n.fontStyle="bold "}var l=null;if(t.style&&t.style.color){l=t.style.color}if(!l&&t.getAttribute){l=t.getAttribute("color")}if(!l&&this.colors.length){l=this.colors[this.colors.length-1]}this.colors.push(l||"black");if(n){n.tag=o;this.elements.push(n);n=null}for(var i=0;i<a;i++){var u=s[i];this.extractHtmlElements(u,i)}if(o==="img"&&t.src){var p=t.src;var c=new Image;c.onload=function(t){n.imageLoaded=true;r.textNeedRelayout=true;return};c.onerror=function(t){n.imageLoaded=false;if(p){console.log("load "+p+" failed.")}};c.onabort=function(t){n.imageLoaded=false;if(p){console.log("load "+p+" failed(abort).")}};c.src=p;n=h("img");n.value=c;n.displayWidth=t.width;n.displayHeight=t.height}else if(!a&&t.textContent){var f=t.textContent.replace(/(\t|\n|\r)+/g,"");var d=f.replace(/ +/g," ");if(d){n=h("text");n.value=d;n.bold=this.bold;n.italic=this.italic;n.underline=this.underline;n.anchor=this.anchor;n.fontStyle="";if(this.colors.length){n.color=this.colors[this.colors.length-1]}if(n.bold){n.fontStyle=n.fontStyle+"bold "}if(n.italic){n.fontStyle=n.fontStyle+"italic "}}}if(o==="b"){this.bold=this.bold-1}if(o==="i"){this.italic=this.italic-1}if(o==="u"){this.underline=this.underline-1}if(o==="a"){n=h("a");n.href=t.href;this.anchor=this.anchor-1}if(o==="p"||t.style!=null&&t.style.display==="block"){n=h("newblock")}else if(o==="li"||o==="br"||o==="hr"||o==="dd"){n=h("newline")}this.colors.pop();if(n){n.tag=o;this.elements.push(n)}return};UISimpleHTML.prototype.getNodeByPoint=function(t){var e=0;var i=t.x;var n=t.y;var r=null;var o=null;var a={};var s=this.elements.length;var h=this.elements;for(e=0;e<s;e++){r=h[e];o=e+1<s?h[e+1]:null;if(n<r.y){continue}if(o&&(n>o.y&&r.y<o.y)){continue}if(r.type==="text"){var l=0;var u=r.lines.length;a.h=r.lineHeight;for(l=0;l<u;l++){a.x=0;a.y=r.y+l*r.lineHeight;if(l===0){a.x=r.x;a.w=r.firstLineWidth}else if(l+1===u){a.w=r.lastLineWidth}else{a.w=this.w}if(isPointInRect(t,a)){return r}}}else if(r.type==="img"){a.x=r.x;a.y=r.y;a.w=r.w;a.h=r.h;if(isPointInRect(t,a)){return r}}}return r};UISimpleHTML.prototype.layoutHtmlElements=function(t){var e=0;var i=0;var n=0;var r=null;var o=0;var a=null;var s=this.elements.length;var h=this.elements;var l=this.getWidth(true);var u=this.style.fontSize;var p=new TextLayout(t);var c=u+"pt "+this.style.fontFamily;var f=u*2;t.font=c;for(e=0;e<s;e++){r=h[e];if(r.type==="text"){r.lines=[];r.x=i;r.y=n;r.firstLineWidth=0;t.font=r.fontStyle+c;r.lineHeight=f;p.setText(r.value);while(true){o=l-i;if(p.hasNext()){a=p.nextLine(o,u);r.lines.push(a.text);if(r.lines.length===1){r.firstLineWidth=a.width}if(p.hasNext()){i=0;n=n+f}else{i=i+a.width;r.lastLineWidth=a.width;break}}else{break}}}else if(r.type==="newline"){r.x=i;r.y=n;i=0;n=n+f}else if(r.type==="newblock"){r.x=i;r.y=n;i=0;n=n+f*1.5}else if(r.type==="img"){if(r.imageLoaded){var d=r.value;var I=d.height/d.width;var g=r.displayWidth?r.displayWidth:d.width;var m=r.displayHeight?r.displayHeight:d.height;r.y=n+f*.5;if(g<l){r.w=g;r.x=Math.floor((l-g)/2);r.h=Math.floor(r.w*I)}else{r.x=0;r.w=l;r.h=Math.floor(r.w*I);
}n=r.y+r.h;n=n+.5*f}else{n=n+f}i=0}this.scrollRange=n}return};UISimpleHTML.prototype.getScrollRange=function(){return this.scrollRange?this.scrollRange:this.h};UISimpleHTML.prototype.loadUrl=function(t,e){var i={};var n=this;i.method="GET";i.url=t;i.headers={"Cache-Control":"no-cache",Pragma:"no-cache"};i.onDone=function(t,i,r){var o=i.status===200;if(i.status===200){var a=r;try{n.setText(a);console.log("loadUrl: done")}catch(s){o=false;console.log("loadUrl: failed"+s.message)}}if(e){e(o)}return};httpDoRequest(i);return};UISimpleHTML.prototype.setText=function(t){this.text=this.toText(t);this.elements=[];var e=document.createElement("div");e.innerHTML=this.text;this.bold=0;this.anchor=0;this.italic=0;this.underline=0;this.strong=0;this.colors=[];this.extractHtmlElements(e,0);delete this.colors;delete this.anchor;delete this.bold;delete this.italic;delete this.underline;delete this.strong;this.textNeedRelayout=true;return};UISimpleHTML.prototype.layoutHtml=function(t){if(!this.textNeedRelayout){return}if(!this.text){return}this.layoutHtmlElements(t);this.textNeedRelayout=false;return};UISimpleHTML.prototype.shapeCanBeChild=function(t){return false};UISimpleHTML.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=0;var r=0;var o=this.h;var a=this.w;var s=null;var h=this.hMargin;var l=this.getWidth(true);var u=this.style.fontSize;var p=2*u;var c=this.hMargin;var f=-this.offset+this.vMargin;var d=u+"pt "+this.style.fontFamily;this.layoutHtml(t);t.save();t.rect(0,0,a,o);t.clip();if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}t.beginPath();t.font=d;t.textAlign="left";t.textBaseline="top";t.fillStyle=this.style.textColor;var I=this.elements.length;var g=this.elements;for(e=0;e<I;e++){s=g[e];if(s.type==="text"&&s.lines&&s.lines.length){var m=s.lines.length;t.font=s.fontStyle+d;if(s.color){t.fillStyle=s.color}else if(s.anchor){t.fillStyle="Blue"}else{t.fillStyle=this.style.textColor}for(k=0;k<m;k++){if(k===0){i=s.x;n=s.y}else{i=0;n=s.y+k*p}i=i+c;n=n+f;r=n+u;if(n<o&&r>=0){l=a-i-h;t.fillText(s.lines[k],i,n,l)}}}else if(s.type==="img"&&s.imageLoaded){var v=s.value;var y=v.width;var U=v.height;i=s.x+c;n=s.y+f;r=n+s.h;if(n<o&&r>=0){t.drawImage(v,0,0,y,U,i,n,s.w,s.h)}}}t.restore();return};function UISimpleHTMLCreator(){var t=["ui-simple-html","ui-simple-html",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISimpleHTML;var i="Simpe HTML";return e.initUISimpleHTML(this.type,i,null)};return}ShapeFactoryGet().addShapeCreator(new UISimpleHTMLCreator);function UIHtmlView(){return}UIHtmlView.prototype=new UIHtml;UIHtmlView.prototype.isUIHtmlView=true;UIHtmlView.prototype.getHtmlContent=function(){var t="<p>hello html view";var e=this.getWidth(true);var i=this.getHeight(true);var n=this.getUrl();var r=this.getValue();if(n){t='<iframe seamless="seamless" scrolling="yes" width="'+e+'" height="'+i+'" src="'+n+'"></iframe>'}else if(r){t=r}return t};UIHtmlView.prototype.setText=function(t){this.text=t;return};UIHtmlView.prototype.getValue=function(){return this.text?this.text:""};UIHtmlView.prototype.setValue=function(t){this.text=t;return};UIHtmlView.prototype.getUrl=function(){return this.url?this.url:""};UIHtmlView.prototype.setUrl=function(t){this.url=t;return};UIHtmlView.prototype.paintSelfOnly=function(t){if(!this.htmlVisible){var e=this.w>>1;var i=this.h>>1;var n=dappGetText("HtmlView");t.textBaseline="middle";t.textAlign="center";t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.fillText(n,e,i)}return};UIHtmlView.prototype.initUIHtmlView=function(t){this.initUIHtml(t,400,300);this.setValue("<p>hello html view");this.setImage(UIElement.IMAGE_DEFAULT,null);this.setScrollable(true);return this};function UIHtmlViewCreator(){var t=["ui-html-view","ui-html-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIHtmlView;return e.initUIHtmlView(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlViewCreator);function UIButtonGroup(){return}UIButtonGroup.prototype=new UIElement;UIButtonGroup.prototype.isUIButtonGroup=true;UIButtonGroup.prototype.initUIButtonGroup=function(t,e,i,n){this.initUIElement(t);this.setMargin(e,e);this.setDefSize(300,60);this.setSizeLimit(100,40,1e3,120);this.buttonMaxWidth=i;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.rectSelectable=false;this.addEventNames(["onInit"]);if(!n){this.style.setFillColor("White")}return this};UIButtonGroup.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton||t.isUIGroup||t.isUIRadioBox||t.isUICheckBox){return true}return false};UIButtonGroup.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};UIButtonGroup.prototype.relayoutChildren=function(){var t=this.getHMargin();var e=this.getVMargin();var i=this.children.length;if(i===0||this.disableRelayout){return}var n=t;var r=e;var o=this.h-2*e;var a=this.buttonMaxWidth;var s=Math.floor((this.w-2*t)/i);var h=Math.min(s,a);for(var l=0;l<i;l++){var u=this.children[l];n=l*s+(s-h)/2+t;u.setLeftTop(n,r);u.setSize(h,o);u.setUserMovable(false);u.setUserResizable(false);u.relayoutChildren()}this.w=s*i+2*t;return};UIButtonGroup.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return true};function UIButtonGroupCreator(t,e,i){var n=["ui-button-group","ui-button-group",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIButtonGroup;return r.initUIButtonGroup(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIButtonGroupCreator(5,200,null));function UIColorBar(){return}UIColorBar.prototype=new UIElement;UIColorBar.prototype.isUIButton=false;UIColorBar.prototype.isUIColorBar=true;UIColorBar.prototype.saveProps=["barPosition"];UIColorBar.prototype.initUIColorBar=function(t,e,i){this.initUIElement(t);this.setBarPosition(0);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);this.barDierction=0;return this};UIColorBar.prototype.setBarDirection=function(t){this.barDirection=t;return this};UIColorBar.prototype.getBarDirection=function(){return this.barDirection};UIColorBar.prototype.setBarPosition=function(t){this.barPosition=t;return this};UIColorBar.prototype.getBarPosition=function(){return this.barPosition};UIColorBar.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUIColorTile||t.isUILabel};UIColorBar.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=this.barDirection;var r=this.style.lineWidth;t.beginPath();switch(this.barPosition){case-1:{break}case 1:{if(n){e=this.w-r}else{i=this.h-r}break}default:{if(n){e=Math.floor(this.w-r>>1)}else{i=Math.floor(this.h-r>>1)}}}if(n){t.moveTo(e,0);t.lineTo(e,this.h)}else{t.moveTo(0,i);t.lineTo(this.w,i)}t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke();return};function UIColorBarCreator(t,e){var i=["ui-color-bar","ui-color-bar",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorBar;return n.initUIColorBar(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIColorBarCreator(100,10));function UIImageAnimation(){return}UIImageAnimation.prototype=new UIImageView;UIImageAnimation.prototype.isUIImageAnimation=true;UIImageAnimation.prototype.saveProps=["frameRate"];UIImageAnimation.prototype.initUIImageAnimation=function(t,e,i){this.initUIElement(t);this.initUIImageView(e,i);this.addEventNames(["onChanged"]);this.setTextType(Shape.TEXT_NONE);imageAnimationInitCustomProp(this);return this};UIImageAnimation.prototype.setCurrent=function(t){if(this.userImages.length){t=t%this.userImages.length}if(this.currFrame!=t){this.callOnChangedHandler(t)}this.currFrame=t;return this};UIImageAnimation.prototype.setValue=function(t){for(var e=0;e<this.cachedImages.length;e++){var i=this.cachedImages[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){return this.setCurrent(e)}}return this};UIImageAnimation.prototype.getCurrentImage=function(){var t=this.cachedImages[this.currFrame];return t};UIImageAnimation.prototype.onInit=function(){var t=this;this.currFrame=0;function e(){if(t.isVisible()){var i=1e3/t.getFrameRate();t.postRedraw();setTimeout(e,i);t.setCurrent(t.currFrame+1)}}var i=1e3/this.getFrameRate();setTimeout(e,i);return};UIImageAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIImageAnimation.prototype.setFrameRate=function(t){this.frameRate=Math.max(1,Math.min(t,30));return};UIImageAnimation.prototype.drawImage=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=(this.currFrame?this.currFrame:0)%this.userImages.length;var i=this.cachedImages[e];if(i&&i.width>0){this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h)}return};UIImageAnimation.prototype.shapeCanBeChild=function(t){return false};function UIImageAnimationCreator(){var t=["ui-image-animation","ui-image-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageAnimation;return e.initUIImageAnimation(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageAnimationCreator);UIElement.eventsStoped={};UIElement.prototype.callOnUpdateTransformHandler=function(canvas){if(this.isInDesignMode()||!this.events)return true;if(!this.handleOnUpdateTransform){var sourceCode=this.events["onUpdateTransform"];if(sourceCode){sourceCode="this.handleOnUpdateTransform = function(canvas) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUpdateTransform eval",e)}}}if(this.hasEventListener("updatetransform")){var event=this.createEvent("updatetransform");event.canvas=canvas;this.dispatchEvent(event)}if(this.handleOnUpdateTransform){try{this.handleOnUpdateTransform(canvas)}catch(e){UIElement.logError("this.handleOnUpdateTransform",e)}}return};UIElement.prototype.callOnPointerDownHandler=function(point,beforeChild){if(this.isUIWindow){UIElement.eventsStoped.click=false;UIElement.eventsStoped.pointerDown=false}if(!this.enable||!this.events||UIElement.eventsStoped.pointerDown){return false}if(this.hasEventListener("pointerdown")){var event=this.createEvent("pointerdown");event.point=point;event.beforeChild=beforeChild;if(this.dispatchEvent(event)){UIElement.eventsStoped.pointerDown=true;return true}}if(!this.handlePointerDown){var sourceCode=this.events["onPointerDown"];if(sourceCode){sourceCode="this.handlePointerDown = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerDown eval",e)}}}if(this.handlePointerDown){try{if(this.handlePointerDown(point,beforeChild)){UIElement.eventsStoped.pointerDown=true}}catch(e){UIElement.logError("this.handlePointerDown",e)}}return true};UIElement.prototype.callOnPointerMoveHandler=function(point,beforeChild){if(this.isUIWindow){UIElement.eventsStoped.pointerMove=false}if(!this.enable||!this.events||UIElement.eventsStoped.pointerMove){return false}if(this.hasEventListener("pointermove")){var event=this.createEvent("pointermove");event.point=point;event.beforeChild=beforeChild;if(this.dispatchEvent(event)){UIElement.eventsStoped.pointerMove=true;return true}}if(!this.handlePointerMove){var sourceCode=this.events["onPointerMove"];if(sourceCode){sourceCode="this.handlePointerMove = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerMove eval",e)}}}if(this.handlePointerMove){try{if(this.handlePointerMove(point,beforeChild)){UIElement.eventsStoped.pointerMove=true}}catch(e){UIElement.logError("this.handlePointerMove",e)}}return true};UIElement.prototype.callOnPointerUpHandler=function(point,beforeChild){if(this.isUIWindow){UIElement.eventsStoped.pointerUp=false}if(!this.enable||!this.events||UIElement.eventsStoped.pointerUp){return false}if(this.hasEventListener("pointerup")){var event=this.createEvent("pointerup");event.point=point;event.beforeChild=beforeChild;if(this.dispatchEvent(event)){UIElement.eventsStoped.pointerUp=true;return true}}if(!this.handlePointerUp){var sourceCode=this.events["onPointerUp"];if(sourceCode){sourceCode="this.handlePointerUp = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerUp eval",e)}}}if(this.handlePointerUp){try{if(this.handlePointerUp(point,beforeChild)){UIElement.eventsStoped.pointerUp=true}}catch(e){UIElement.logError("this.handlePointerUp",e)}}return true};UIElement.prototype.callOnClickHandler=function(point){if(!this.enable||!this.events||this.isInDesignMode()){return false}if(UIElement.eventsStoped.click){return true}if(this.hasEventListener("click")){var event=this.createEvent("click");event.point=point;if(this.dispatchEvent(event)){UIElement.eventsStoped.click=true;return true}}if(!this.handleClick){var sourceCode=this.events["onClick"];if(sourceCode){sourceCode="this.handleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleClick eval",e)}}}if(this.handleClick){try{if(this.handleClick(point)){UIElement.eventsStoped.click=true}}catch(e){UIElement.logError("this.handleClick",e)}}return true};UIElement.prototype.callOnDoubleClickHandler=function(point){if(this.isUIWindow){UIElement.eventsStoped.doubleClick=false}if(!this.enable||!this.events||this.isInDesignMode()){return false}if(UIElement.eventsStoped.doubleClick){return false}if(this.hasEventListener("doubleclick")){var event=this.createEvent("doubleclick");event.point=point;if(this.dispatchEvent(event)){UIElement.eventsStoped.doubleClick=true;return true}}if(!this.handleDoubleClick){var sourceCode=this.events["onDoubleClick"];if(sourceCode){sourceCode="this.handleDoubleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDoubleClick eval",e)}}}if(this.handleDoubleClick){try{if(this.handleDoubleClick(point)){UIElement.eventsStoped.doubleClick=true}}catch(e){UIElement.logError("this.handleDoubleClick",e)}}this.hitTestResult=0;return true};UIElement.prototype.callOnLongPressHandler=function(point){if(!this.enable||!this.events){return false}if(!this.handleLongPress){var sourceCode=this.events["onLongPress"];if(sourceCode){sourceCode="this.handleLongPress = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleLongPress eval",e)}}}if(this.hasEventListener("longpress")){var event=this.createEvent("longpress");event.point=point;this.dispatchEvent(event)}if(this.handleLongPress){try{this.handleLongPress(point)}catch(e){UIElement.logError("this.handleLongPress",e)}}return true};UIElement.prototype.callOnPaintHandler=function(canvas2dCtx){if(this.isInDesignMode()){return true}if(!this.enable||!this.events){return false}if(!this.handlePaint){var sourceCode=this.events["onPaint"];if(sourceCode){sourceCode="this.handlePaint = function(canvas2dCtx) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePaint eval",e)}}}if(this.hasEventListener("paint")){var event=this.createEvent("paint");event.canvas2dCtx=canvas2dCtx;this.dispatchEvent(event)}if(this.handlePaint){try{this.handlePaint(canvas2dCtx)}catch(e){UIElement.logError("this.handlePaint",e)}}return true};UIElement.prototype.callOnScrollDoneHandler=function(xOffset,yOffset){if(!this.enable||!this.events){return false}if(this.hasEventListener("scrolldone")){var event=this.createEvent("scrolldone");event.xOffset=xOffset;event.yOffset=yOffset;if(this.dispatchEvent(event)){return true}}if(!this.handleOnScrollDone){var sourceCode=this.events["onScrollDone"];if(sourceCode){sourceCode="this.handleOnScrollDone = function(xOffset, yOffset) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnScrollDone eval",e)}}}if(this.handleOnScrollDone){try{this.handleOnScrollDone(xOffset,yOffset)}catch(e){UIElement.logError("this.handleOnScrollDone",e)}}return true};UIElement.prototype.callOnScrollingHandler=function(xOffset,yOffset){if(!this.enable||!this.events||this.isInDesignMode()){return false}if(this.hasEventListener("scrolling")){var event=this.createEvent("scrolling");event.xOffset=xOffset;event.yOffset=yOffset;if(this.dispatchEvent(event)){return true}}if(!this.handleOnScrolling){var sourceCode=this.events["onScrolling"];if(sourceCode){sourceCode="this.handleOnScrolling = function(xOffset, yOffset) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnScrolling eval",e)}}}if(this.handleOnScrolling){try{this.handleOnScrolling(xOffset,yOffset)}catch(e){UIElement.logError("this.handleOnScrolling",e)}}return true};UIElement.prototype.callOnRemovedHandler=function(){if(!this.enable||!this.events||this.isInDesignMode()){return false}if(!this.handleOnRemoved){var sourceCode=this.events["onRemoved"];if(sourceCode){sourceCode="this.handleOnRemoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode);UIElement.logError("this.handleOnRemoved eval",e)}}}if(this.hasEventListener("removed")){var event=this.createEvent("removed");this.dispatchEvent(event)}if(this.handleOnRemoved){try{this.handleOnRemoved()}catch(e){UIElement.logError("this.handleOnRemoved",e)}}return true};UIElement.prototype.callOnChildDraggingHandler=function(sourceChildIndex,targetChildIndex){if(!this.enable||!this.events){return false}if(!this.handleOnChildDragging){var sourceCode=this.events["onChildDragging"];if(sourceCode){sourceCode="this.handleOnChildDragging = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChildDragging eval",e)}}}if(this.hasEventListener("childdragging")){var event=this.createEvent("childdragging");event.sourceChildIndex=sourceChildIndex;event.targetChildIndex=targetChildIndex;this.dispatchEvent(event)}if(this.handleOnChildDragging){try{this.handleOnChildDragging(sourceChildIndex,targetChildIndex)}catch(e){UIElement.logError("this.handleOnChildDragging",e)}}return true};UIElement.prototype.callOnChildDraggedHandler=function(sourceChildIndex,targetChildIndex){if(!this.enable||!this.events){return false}if(!this.handleOnChildDragged){var sourceCode=this.events["onChildDragged"];if(sourceCode){sourceCode="this.handleOnChildDragged = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChildDragged eval",e)}}}if(this.hasEventListener("childdragged")){var event=this.createEvent("childdragged");event.sourceChildIndex=sourceChildIndex;event.targetChildIndex=targetChildIndex;this.dispatchEvent(event)}if(this.handleOnChildDragged){try{this.handleOnChildDragged(sourceChildIndex,targetChildIndex)}catch(e){UIElement.logError("this.handleOnChildDragged",e)}}return true};UIElement.prototype.callOnChangingHandler=function(value){if(!this.enable||this.isInDesignMode()||!this.events){return false}if(this.hasEventListener("changing")){var event=this.createEvent("changing");event.value=value;this.dispatchEvent(event)}if(!this.handleOnChanging){var sourceCode=this.events["onChanging"];if(sourceCode){sourceCode="this.handleOnChanging = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChanging eval",e)}}}if(this.handleOnChanging){try{this.handleOnChanging(value)}catch(e){UIElement.logError("this.handleOnChanging",e)}}return true};UIElement.prototype.callOnChangedHandler=function(value){if(!this.enable||this.isInDesignMode()||!this.events){return false}if(this.hasEventListener("change")){var event=this.createEvent("change");event.value=value;this.dispatchEvent(event)}if(this.hasEventListener("changed")){var event=this.createEvent("changed");event.value=value;this.dispatchEvent(event)}if(!this.handleOnChanged){var sourceCode=this.events["onChanged"];if(sourceCode){sourceCode="this.handleOnChanged = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChanged eval",e)}}}if(this.handleOnChanged){try{this.handleOnChanged(value)}catch(e){UIElement.logError("this.handleOnChanged",e)}}return true};UIElement.prototype.callOnInitHandler=function(){if(!this.events)return;if(!this.handleOnInit){var sourceCode=this.events["onInit"];if(sourceCode){sourceCode="this.handleOnInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnInit eval",e)}}}if(this.hasEventListener("init")){var event=this.createEvent("init");this.dispatchEvent(event)}if(this.handleOnInit){try{this.handleOnInit()}catch(e){UIElement.logError("this.handleOnInit",e)}}return true};UIElement.prototype.callOnFocusInHandler=function(){if(this.onFocusIn){try{this.onFocusIn()}catch(e){console.log("onFocusIn:"+e.message)}}if(!this.events)return;if(!this.handleOnFocusIn){var sourceCode=this.events["onFocusIn"];if(sourceCode){sourceCode="this.handleOnFocusIn = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnFocusIn eval",e)}}}if(this.hasEventListener("focusin")){var event=this.createEvent("focusin");this.dispatchEvent(event)}if(this.handleOnFocusIn){try{this.handleOnFocusIn()}catch(e){UIElement.logError("this.handleOnFocusIn",e)}}return true};UIElement.prototype.callOnFocusOutHandler=function(){if(this.onFocusOut){try{this.onFocusOut()}catch(e){UIElement.logError("this.onFocusOut ",e)}}if(!this.events)return;if(!this.handleOnFocusOut){var sourceCode=this.events["onFocusOut"];if(sourceCode){sourceCode="this.handleOnFocusOut = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.onFocusOut eval",e)}}}if(this.hasEventListener("focusout")){var event=this.createEvent("focusout");this.dispatchEvent(event)}if(this.handleOnFocusOut){try{this.handleOnFocusOut()}catch(e){UIElement.logError("this.onFocusOut",e)}}return true};UIElement.prototype.callOnUpdateDataHandler=function(){if(!this.events)return;if(!this.handleOnUpdateData){var sourceCode=this.events["onUpdateData"];if(sourceCode){sourceCode="this.handleOnUpdateData = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUpdateData eval",e)}}}if(this.hasEventListener("updatedata")){var event=this.createEvent("updatedata");this.dispatchEvent(event)}if(this.handleOnUpdateData){try{this.handleOnUpdateData()}catch(e){UIElement.logError("this.handleOnUpdateData",e)}}return true};UIElement.prototype.callOnGestureHandler=function(gesture){if(!this.enable||!this.events){return false}if(!this.handleOnGesture){var sourceCode=this.events["onGesture"];if(sourceCode){sourceCode="this.handleOnGesture = function(gesture) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnGesture eval",e)}}}if(this.hasEventListener("gesture")){var event=this.createEvent("gesture");event.gesture=gesture;this.dispatchEvent(event)}if(this.handleOnGesture){try{this.handleOnGesture(gesture)}catch(e){UIElement.logError("this.handleOnGesture",e)}}console.log("callOnGestureHandler: scale="+gesture.scale+" rotation="+gesture.rotation);return true};UIElement.prototype.callOnBeforeOpenHandler=function(initData){if(!this.events)return;if(!this.handleOnBeforeOpen){var sourceCode=this.events["onBeforeOpen"];if(sourceCode){sourceCode="this.handleOnBeforeOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBeforeOpen eval",e)}}}if(this.hasEventListener("beforeopen")){var event=this.createEvent("beforeopen");event.initData=initData;this.dispatchEvent(event)}if(this.handleOnBeforeOpen){try{this.handleOnBeforeOpen(initData)}catch(e){UIElement.logError("this.handleOnBeforeOpen",e)}}return true};UIElement.prototype.callOnOpenHandler=function(initData){if(!this.events)return;if(!this.handleOnOpen){var sourceCode=this.events["onOpen"];if(sourceCode){sourceCode="this.handleOnOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnOpen eval",e)}}}if(this.hasEventListener("open")){var event=this.createEvent("open");event.initData=initData;this.dispatchEvent(event)}if(this.handleOnOpen){try{this.handleOnOpen(initData)}catch(e){UIElement.logError("this.handleOnOpen",e)}}return true};UIElement.prototype.callOnCloseHandler=function(retInfo){if(!this.events)return;if(!this.handleOnClose){var sourceCode=this.events["onClose"];if(sourceCode){sourceCode="this.handleOnClose = function(retInfo) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnClose eval",e)}}}if(this.hasEventListener("close")){var event=this.createEvent("close");event.retInfo=retInfo;this.dispatchEvent(event)}if(this.handleOnClose){try{this.handleOnClose(retInfo)}catch(e){UIElement.logError("this.handleOnClose",e)}}return true};UIElement.prototype.callOnSwitchToBackHandler=function(){if(!this.events)return;if(!this.handleOnSwitchToBack){var sourceCode=this.events["onSwitchToBack"];if(sourceCode){sourceCode="this.handleOnSwitchToBack = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwitchToBack eval",e)}}}if(this.hasEventListener("switchtoback")){var event=this.createEvent("switchtoback");this.dispatchEvent(event)}if(this.handleOnSwitchToBack){try{this.handleOnSwitchToBack()}catch(e){UIElement.logError("this.handleOnSwitchToBack",e)}}return true};UIElement.prototype.callOnSwitchToFrontHandler=function(){if(!this.events)return;if(!this.handleOnSwitchToFront){var sourceCode=this.events["onSwitchToFront"];if(sourceCode){sourceCode="this.handleOnSwitchToFront = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwitchToFront eval",e)}}}if(this.hasEventListener("switchtofront")){var event=this.createEvent("switchtofront");this.dispatchEvent(event)}if(this.handleOnSwitchToFront){try{this.handleOnSwitchToFront()}catch(e){UIElement.logError("this.handleOnSwitchToFront",e)}}return true};UIElement.prototype.callOnLoadHandler=function(){if(!this.events)return;if(!this.handleOnLoad){var sourceCode=this.events["onLoad"];if(sourceCode){sourceCode="this.handleOnLoad = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnLoad eval",e)}}}if(this.hasEventListener("load")){var event=this.createEvent("load");this.dispatchEvent(event)}if(this.handleOnLoad){try{this.handleOnLoad()}catch(e){UIElement.logError("this.handleOnLoad",e)}}return true};UIElement.prototype.callOnUnloadHandler=function(){if(!this.events)return;if(!this.handleOnUnload){var sourceCode=this.events["onUnload"];if(sourceCode){sourceCode="this.handleOnUnload = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUnload eval",e)}}}if(this.hasEventListener("unload")){var event=this.createEvent("unload");this.dispatchEvent(event)}if(this.handleOnUnload){try{this.handleOnUnload()}catch(e){UIElement.logError("this.handleOnUnload",e)}}return true};UIElement.prototype.callOnMovedHandler=function(){if(this.cameraFollowMe){this.getWindow().cameraFollow(this)}if(this.hasEventListener("moved")){var event=this.createEvent("moved");this.dispatchEvent(event)}if(!this.events)return;if(!this.handleOnMoved){var sourceCode=this.events["onMoved"];if(sourceCode){sourceCode="this.handleOnMoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnMoved eval",e)}}}if(this.handleOnMoved){try{this.handleOnMoved()}catch(e){UIElement.logError("this.handleOnMoved",e)}}return true};UIElement.prototype.callOnPreSolveHandler=function(body,contact,oldManifold){if(!this.events)return;if(!this.handleOnPreSolve){var sourceCode=this.events["onPreSolve"];if(sourceCode){sourceCode="this.handleOnPreSolve = function(body, contact, oldManifold) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnPreSolve eval",e)}}}if(this.hasEventListener("presolve")){var event=this.createEvent("presolve");event.body=body;event.contact=contact;event.oldManifold=oldManifold;this.dispatchEvent(event)}if(this.handleOnPreSolve){try{this.handleOnPreSolve(body,contact,oldManifold)}catch(e){UIElement.logError("this.handleOnPreSolve",e)}}return true};UIElement.prototype.callOnPostSolveHandler=function(body,contact,impulse){if(!this.events)return;if(!this.handleOnPostSolve){var sourceCode=this.events["onPostSolve"];if(sourceCode){sourceCode="this.handleOnPostSolve = function(body, contact, impulse) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnPostSolve eval",e)}}}if(this.hasEventListener("postsolve")){var event=this.createEvent("postsolve");event.body=body;event.contact=contact;event.impulse=impulse;this.dispatchEvent(event)}if(this.handleOnPostSolve){try{this.handleOnPostSolve(body,contact,impulse)}catch(e){UIElement.logError("this.handleOnPostSolve",e)}}return true};UIElement.prototype.callOnBeginContactHandler=function(body,contact){if(!this.events)return;if(this.hasEventListener("begincontact")){var event=this.createEvent("begincontact");event.body=body;event.contact=contact;this.dispatchEvent(event)}if(!this.handleOnBeginContact){var sourceCode=this.events["onBeginContact"];if(sourceCode){sourceCode="this.handleOnBeginContact = function(body, contact) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBeginContact eval",e)}}}if(this.handleOnBeginContact){try{this.handleOnBeginContact(body,contact)}catch(e){UIElement.logError("this.handleOnBeginContact",e)}}return true};UIElement.prototype.callOnEndContactHandler=function(body,contact){if(!this.events)return;if(this.hasEventListener("endcontact")){var event=this.createEvent("endcontact");event.body=body;event.contact=contact;this.dispatchEvent(event)}if(!this.handleOnEndContact){var sourceCode=this.events["onEndContact"];if(sourceCode){sourceCode="this.handleOnEndContact = function(body, contact) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnEndContact eval",e)}}}if(this.handleOnEndContact){try{this.handleOnEndContact(body,contact)}catch(e){UIElement.logError("this.handleOnEndContact",e)}}return true};UIElement.prototype.callOnAnimateDoneHandler=function(name){if(!this.events)return;if(!this.handleOnAnimateDone){var sourceCode=this.events["onAnimateDone"];if(sourceCode){sourceCode="this.handleOnAnimateDone = function(name) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnAnimateDone eval",e)}}}if(this.hasEventListener("animatedone")){var event=this.createEvent("animatedone");event.name=name;this.dispatchEvent(event)}if(this.handleOnAnimateDone){try{this.handleOnAnimateDone(name)}catch(e){UIElement.logError("this.handleOnAnimateDone",e)}}return true};UIElement.prototype.callOnSwipeLeftHandler=function(start,end){if(!this.events)return;if(!this.handleOnSwipeLeft){var sourceCode=this.events["onSwipeLeft"];if(sourceCode){sourceCode="this.handleOnSwipeLeft = function(start, end) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeLeft eval",e)}}}if(this.hasEventListener("swipeleft")){var event=this.createEvent("swipeleft");event.start=start;event.end=end;this.dispatchEvent(event)}if(this.handleOnSwipeLeft){try{this.handleOnSwipeLeft(start,end)}catch(e){UIElement.logError("this.handleOnSwipeLeft",e)}}return true};UIElement.prototype.callOnSwipeRightHandler=function(start,end){if(!this.events)return;if(!this.handleOnSwipeRight){var sourceCode=this.events["onSwipeRight"];if(sourceCode){sourceCode="this.handleOnSwipeRight = function(start, end) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeRight eval",e)}}}if(this.hasEventListener("swiperight")){
var event=this.createEvent("swiperight");event.start=start;event.end=end;this.dispatchEvent(event)}if(this.handleOnSwipeRight){try{this.handleOnSwipeRight(start,end)}catch(e){UIElement.logError("this.handleOnSwipeRight",e)}}return true};UIElement.prototype.callOnSwipeUpHandler=function(start,end){if(!this.events)return;if(!this.handleOnSwipeUp){var sourceCode=this.events["onSwipeUp"];if(sourceCode){sourceCode="this.handleOnSwipeUp = function(start, end) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeUp eval",e)}}}if(this.hasEventListener("swipeup")){var event=this.createEvent("swipeup");event.start=start;event.end=end;this.dispatchEvent(event)}if(this.handleOnSwipeUp){try{this.handleOnSwipeUp(start,end)}catch(e){UIElement.logError("this.handleOnSwipeUp",e)}}return true};UIElement.prototype.callOnSwipeDownHandler=function(start,end){if(!this.events)return;if(!this.handleOnSwipeDown){var sourceCode=this.events["onSwipeDown"];if(sourceCode){sourceCode="this.handleOnSwipeDown = function(start, end) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeDown eval",e)}}}if(this.hasEventListener("swipedown")){var event=this.createEvent("swipedown");event.start=start;event.end=end;this.dispatchEvent(event)}if(this.handleOnSwipeDown){try{this.handleOnSwipeDown(start,end)}catch(e){UIElement.logError("this.handleOnSwipeDown",e)}}return true};UIElement.prototype.callOnBecomeZeroHandler=function(){if(!this.events)return;if(!this.handleOnBecomeZero){var sourceCode=this.events["onBecomeZero"];if(sourceCode){sourceCode="this.handleOnBecomeZero = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBecomeZero eval",e)}}}if(this.hasEventListener("becomezero")){var event=this.createEvent("becomezero");this.dispatchEvent(event)}if(this.handleOnBecomeZero){try{this.handleOnBecomeZero()}catch(e){UIElement.logError("this.handleOnBecomeZero",e)}}return true};UIElement.prototype.callOnBecomeFullHandler=function(){if(!this.events)return;if(!this.handleOnBecomeFull){var sourceCode=this.events["onBecomeFull"];if(sourceCode){sourceCode="this.handleOnBecomeFull = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBecomeFull eval",e)}}}if(this.hasEventListener("becomefull")){var event=this.createEvent("becomefull");this.dispatchEvent(event)}if(this.handleOnBecomeFull){try{this.handleOnBecomeFull()}catch(e){UIElement.logError("this.handleOnBecomeFull",e)}}return true};UIElement.prototype.callOnTimeoutHandler=function(){if(!this.events)return;if(!this.handleOnTimeout){var sourceCode=this.events["onTimeout"];if(sourceCode){sourceCode="this.handleOnTimeout = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnTimeout eval",e)}}}if(this.hasEventListener("timer")){var event=this.createEvent("timer");this.dispatchEvent(event)}if(this.hasEventListener("timeout")){var event=this.createEvent("timeout");this.dispatchEvent(event)}if(this.handleOnTimeout){try{this.handleOnTimeout()}catch(e){UIElement.logError("this.handleOnTimeout",e)}}return true};UIElement.prototype.callOnSystemInitHandler=function(){if(!this.events)return;if(!this.handleOnSystemInit){var sourceCode=this.events["onSystemInit"];if(sourceCode){sourceCode="this.handleOnSystemInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSystemInit eval",e)}}}if(this.hasEventListener("systeminit")){var event=this.createEvent("systeminit");this.dispatchEvent(event)}if(this.handleOnSystemInit){try{this.handleOnSystemInit()}catch(e){UIElement.logError("this.handleOnSystemInit",e)}}return true};UIElement.prototype.callOnScrollOutOfRangeHandler=function(offset){if(!this.enable||!this.events){return false}if(this.onScrollOutOfRange){this.onScrollOutOfRange(offset);return}if(!this.handleOnScrollOutOfRange){var sourceCode=this.events["onScrollOutOfRange"];if(sourceCode){sourceCode="this.handleOnScrollOutOfRange = function(offset) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnScrollOutOfRange eval",e)}}}if(this.hasEventListener("scrolloutofrange")){var event=this.createEvent("scrolloutofrange");event.offset=offset;this.dispatchEvent(event)}if(this.handleOnScrollOutOfRange){try{this.handleOnScrollOutOfRange(offset)}catch(e){UIElement.logError("this.handleOnScrollOutOfRange",e)}}return true};UIElement.prototype.callOnBirthedHandler=function(){if(this.onBirthed){this.onBirthed()}if(!this.events)return;if(!this.handleOnBirthed){var sourceCode=this.events["onBirthed"];if(sourceCode){sourceCode="this.handleOnBirthed = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBirthed eval",e)}}}if(this.hasEventListener("birthed")){var event=this.createEvent("birthed");this.dispatchEvent(event)}if(this.handleOnBirthed){try{this.handleOnBirthed()}catch(e){UIElement.logError("this.handleOnBirthed",e)}}return true};UIElement.prototype.callOnDeviceOrientation=function(x,y,z,evt){if(!this.events)return;if(!this.handleOnDeviceOrientation){var sourceCode=this.events["onDeviceOrientation"];if(sourceCode){sourceCode="this.handleOnDeviceOrientation = function(x, y, z, event) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnDeviceOrientation eval",e)}}}if(this.hasEventListener("deviceorientation")){var event=this.createEvent("deviceorientation");event.x=x;event.y=y;event.z=z;event.event=evt;this.dispatchEvent(event)}if(this.handleOnDeviceOrientation){try{this.handleOnDeviceOrientation(x,y,z,evt)}catch(e){UIElement.logError("this.handleOnDeviceOrientation",e)}}return true};UIElement.prototype.dispatchCustomEvent=function(eventName,args){if(!this.events)return;if(!this.customEventHandler){this.customEventHandler={}}var handleCustomEvent=this.customEventHandler[eventName];if(!handleCustomEvent){var sourceCode=this.events[eventName];if(sourceCode){sourceCode="this.handleCustomEvent = function(args) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleCustomEvent eval",e)}}if(this.handleCustomEvent){handleCustomEvent=this.handleCustomEvent;this.customEventHandler[eventName]=handleCustomEvent;this.handleCustomEvent=null}}if(handleCustomEvent){try{handleCustomEvent.call(this,args)}catch(e){UIElement.logError("this.handleCustomEvent",e)}}return true};UIWindow.prototype.callOnMultiTouchHandler=function(action,points,evt){if(!this.enable||!this.events){return false}if(this.isInDesignMode()){return false}if(!this.handleMultiTouch){var sourceCode=this.events["onMultiTouch"];if(sourceCode){sourceCode="this.handleMultiTouch = function(action, points, event) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleMultiTouch eval",e)}}}if(this.hasEventListener("multitouch")){var event=this.createEvent("multitouch");event.action=action;event.points=points;event.event=evt;this.dispatchEvent(event)}if(this.handleMultiTouch){try{this.handleMultiTouch(action,points,evt)}catch(e){UIElement.logError("this.handleMultiTouch",e)}}return};UIElement.prototype.callOnDragStartHandler=function(){if(!this.enable||!this.events){return false}if(!this.handleDragStart){var sourceCode=this.events["onDragStart"];if(sourceCode){sourceCode="this.handleDragStart = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDragStart eval",e)}}}if(this.hasEventListener("dragstart")){var event=this.createEvent("dragstart");this.dispatchEvent(event)}if(this.handleDragStart){try{this.handleDragStart()}catch(e){UIElement.logError("this.handleDragStart",e)}}return};UIElement.prototype.callOnDragEndHandler=function(){if(!this.enable||!this.events){return false}if(!this.handleDragEnd){var sourceCode=this.events["onDragEnd"];if(sourceCode){sourceCode="this.handleDragEnd = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDragEnd eval",e)}}}if(this.hasEventListener("dragend")){var event=this.createEvent("dragend");this.dispatchEvent(event)}if(this.handleDragEnd){try{this.handleDragEnd()}catch(e){UIElement.logError("this.handleDragEnd",e)}}return};UIElement.prototype.callOnDraggingHandler=function(){if(!this.enable||!this.events){return false}if(!this.handleDragging){var sourceCode=this.events["onDragging"];if(sourceCode){sourceCode="this.handleDragging = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDragging eval",e)}}}if(this.hasEventListener("dragging")){var event=this.createEvent("dragging");this.dispatchEvent(event)}if(this.handleDragging){try{this.handleDragging()}catch(e){UIElement.logError("this.handleDragging",e)}}return};function UIVScrollImage(){return}UIVScrollImage.prototype=new UIVScrollView;UIVScrollImage.prototype.initUIVScrollImage=function(t){this.initUIVScrollView(t,0,null,null);this.setImage(UIElement.IMAGE_DEFAULT,null);this.widthAttr=UIElement.WIDTH_SCALE;this.heightAttr=UIElement.HEIGHT_SCALE;this.setSize(200,200);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UIVScrollImage.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e||!e.height){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);return}var i=this.w/e.width;var n=e.height*i;var r=0;var o=this.offset/i;var a=e.width;var s=Math.min(this.h/i,e.height-o);var h=0;var l=0;var u=this.w;var p=s*i;t.drawImage(e,r,o,a,s,h,l,u,p);return};UIVScrollImage.prototype.getScrollRange=function(){var t=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(t&&t.height&&t.width){var e=this.w/t.width;return e*t.height+60}else{return this.h}};UIVScrollImage.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.isInDesignMode()){this.drawPageDownUp(t)}return};function UIVScrollImageCreator(){var t=["ui-v-scroll-image","ui-v-scroll-image",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVScrollImage;return e.initUIVScrollImage(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIVScrollImageCreator);function UIPageManager(){}UIPageManager.prototype=new UIFrames;UIPageManager.prototype.isUIPageManager=true;UIPageManager.prototype.initUIPageManager=function(t){return this.initUIFrames(t)};UIPageManager.prototype.beforeAddShapeIntoChildren=function(t){return!t.isUIPage};UIPageManager.prototype.shapeCanBeChild=function(t){return t.isUIPage};UIPageManager.prototype.relayoutChildren=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.left=0;e.top=0;e.w=this.w;e.h=this.h;e.relayoutChildren();e.setUserMovable(false);e.setUserResizable(false)}return};UIPageManager.prototype.showHTML=function(){var t=this.getCurrentFrame();if(t){t.showHTML()}return};UIPageManager.prototype.hideHTML=function(){var t=this.getCurrentFrame();if(t){t.hideHTML()}return};UIPageManager.prototype.switchTo=function(t){var e=this;var i=this.getCurrentFrame();var n=this.getFrame(t);var r=this.current;if(i){i.hideHTML()}if(r<0||r===t||!i||!n){this.showFrame(t);if(n){n.showHTML()}return}function o(){e.showFrame(t);e.postRedraw();return}if(!this.isTopWindow()){o();return}var a=null;var s=null;var h=this.getPositionInScreen();if(t<r){a=AnimationFactory.create("anim-backward");s=UIFrames.preparseBackendCanvas(n,i)}else{a=AnimationFactory.create("anim-forward");s=UIFrames.preparseBackendCanvas(i,n)}a.setScale(this.getRealScale());a.prepare(h.x,h.y,this.w,this.h,s,o);a.run();return};function UIPageManagerCreator(){var t=["ui-page-manager","ui-page-manager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageManager;e.initUIPageManager(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIPageManagerCreator);function UIWaitBar(){return}UIWaitBar.TILES=8;UIWaitBar.prototype=new UIElement;UIWaitBar.prototype.initUIWaitBar=function(t,e,i){this.initUIElement(t);this.offset=0;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};UIWaitBar.prototype.shapeCanBeChild=function(t){return false};UIWaitBar.prototype.step=function(){if(this.isVisible()&&this.getParent()){this.offset++;if(this.isUIWaitBar){this.offset=this.offset%UIWaitBar.TILES}this.postRedraw()}return this};UIWaitBar.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){return}if(this.isUIWaitBar){this.drawBgImageBar(t,e)}else{this.drawBgImageBox(t,e)}return};UIWaitBar.prototype.drawBgImageBox=function(t,e){var i=.05*Math.PI*this.offset;this.setRotation(i);UIElement.prototype.drawBgImage.call(this,t);return};UIWaitBar.prototype.onInit=function(){UIElement.prototype.onInit.call(this);var t=this;function e(){t.step();if(t.getParent()){setTimeout(e,50)}}e();return};UIWaitBar.prototype.drawBgImageBar=function(t,e){var i=e.width;var n=e.height;var r=Math.round(n/UIWaitBar.TILES);var o=this.offset*r;var a={x:0,y:o,w:i,h:r};UIElement.drawImageAt(t,e,this.images.display,0,0,this.w,this.h,a);return};function UIWaitBarCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIWaitBar;n.isUIWaitBar=true;return n.initUIWaitBar(this.type,e,i)};return}function UIWaitBoxCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIWaitBar;n.isUIWaitBox=true;return n.initUIWaitBar(this.type,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIWaitBarCreator("ui-wait-bar",200,24));ShapeFactoryGet().addShapeCreator(new UIWaitBoxCreator("ui-wait-box",60,60));function UIStaticMap(){return}UIStaticMap.prototype=new UIImage;UIStaticMap.prototype.isUIStaticMap=true;UIStaticMap.prototype.initUIStaticMap=function(t){this.initUIImage(t,200,200,null);return this};UIStaticMap.prototype.setMapProvider=function(t){this.mapProvider=t;return};UIStaticMap.prototype.setMapType=function(t){this.mapType=t;return};UIStaticMap.prototype.setMapZoom=function(t){this.mapZoom=t;return};UIStaticMap.prototype.setMapCenter=function(t){this.mapCenter=t;return};UIStaticMap.prototype.setMapWidth=function(t){this.mapWidth=t;return};UIStaticMap.prototype.setMapHeight=function(t){this.mapHeight=t;return};UIStaticMap.prototype.setMapExtraParams=function(t){this.mapEtraParams=t;return};UIStaticMap.prototype.getMapType=function(){return this.mapType?this.mapType:""};UIStaticMap.prototype.getMapProvider=function(){return this.mapProvider?this.mapProvider:"google"};UIStaticMap.prototype.getMapZoom=function(){return this.mapZoom?this.mapZoom:10};UIStaticMap.prototype.getMapWidth=function(){return this.mapWidth?this.mapWidth:600};UIStaticMap.prototype.getMapHeight=function(){return this.mapHeight?this.mapHeight:600};UIStaticMap.prototype.getMapCenter=function(){if(!this.mapCenter&&this.currentLocation){return this.currentLocation}else{return this.mapCenter?this.mapCenter:"China"}};UIStaticMap.prototype.getMapExtraParams=function(){return this.mapEtraParams?this.mapEtraParams:""};UIStaticMap.prototype.getMapURL=function(){var t="";if(this.mapProvider==="baidu"){t="http://api.map.baidu.com/staticimage?center="+this.getMapCenter()+"&width="+this.getMapWidth()+"&height="+this.getMapHeight()+"&zoom="+this.getMapZoom()+this.getMapExtraParams()}else if(this.mapProvider==="google"){t="http://maps.googleapis.com/maps/api/staticmap?center="+this.getMapCenter()+"&size="+this.getMapWidth()+"x"+this.getMapHeight()+"&zoom="+this.getMapZoom()+"&maptype="+this.getMapType()+"&sensor=true"+this.getMapExtraParams()}console.log("Map URL:"+t);return t};UIStaticMap.prototype.updateMap=function(){var t=this.getMapURL();this.setImageSrc(t);return};UIStaticMap.prototype.onInit=function(){var t=this;function e(e){t.currentLocation=e.coords.latitude+","+e.coords.longitude;t.updateMap();return}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e)}this.updateMap();return};UIStaticMap.prototype.drawImage=function(t){this.drawBgImage(t);return};function UIStaticMapCreator(){var t=["ui-static-map","ui-static-map",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIStaticMap;return e.initUIStaticMap(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIStaticMapCreator);function UIStatusBar(){return}UIStatusBar.prototype=new UIElement;UIStatusBar.prototype.isUIStatusBar=true;UIStatusBar.prototype.initUIStatusBar=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.widthAttr=UIElement.WIDTH_FILL_PARENT;return this};UIStatusBar.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton){return true}return false};UIStatusBar.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;if(this.type==="ui-menu-bar"){t.hideSelectMark=true;t.textType=Shape.TEXT_NONE;this.hideSelectMark=true}return true};UIStatusBar.prototype.beforeRelayoutChild=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return true};function UIStatusBarCreator(t,e,i,n){var r=[t,"ui-status-bar",null,true];ShapeCreator.apply(this,r);this.createShape=function(t){var r=new UIStatusBar;return r.initUIStatusBar(this.type,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UIStatusBarCreator("ui-status-bar",640,40,null));ShapeFactoryGet().addShapeCreator(new UIStatusBarCreator("ui-menu-bar",640,96,null));function UIUnkown(){return}UIUnkown.prototype=new UIElement;UIUnkown.prototype.isUIUnkown=true;UIUnkown.prototype.initUIUnkown=function(t){this.initUIElement(t);return this};function UIUnkownCreator(){var t=["ui-unkown","ui-unkown",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIUnkown;return e.initUIUnkown(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIUnkownCreator);function SuggestionProvider(){this.query=function(t,e){};this.init=function(t){};return}function StaticSuggestionProvider(){this.init=function(t){if(typeof t=="string"){t=t.split("\n")}this.options=t;if(this.options){this.options.sort()}return};this.query=function(t,e){if(!t||!this.options){e([]);return}function i(t,e){if(t.indexOf(e)==0){return 0}if(t<e){return-1}else{return 1}}var n=[];var r=this.options.binarySearch(t,i);if(r>=0){var o=this.options.length;for(;r>=0;r--){var a=this.options[r];if(a.indexOf(t)!==0){r=r+1;break}}for(var s=r;s<o;s++){var a=this.options[s];if(a.indexOf(t)===0){n.push(a)}else{break}}}e(n);return};return}function createSuggestionProvider(t,e){var i=null;if(t==="static"){i=new StaticSuggestionProvider}if(i){i.init(e)}return i}function UISuggestion(){return}UISuggestion.prototype=new UIListView;UISuggestion.prototype.isUISuggestion=true;UISuggestion.prototype.initUISuggestion=function(t){this.initUIListView(t,5,100,null);this.maxSuggestionItems=10;this.suggestionProviderParams="";this.suggestionProviderName="static";return this};UISuggestion.prototype.onInit=function(){this.suggestionProvider=createSuggestionProvider(this.suggestionProviderName,this.suggestionProviderParams);return};UISuggestion.prototype.setSuggestionProvider=function(t){this.suggestionProvider=t;return};UISuggestion.prototype.getSuggestionProvider=function(){return this.suggestionProvider};UISuggestion.prototype.onSuggestionSelected=function(t){};UISuggestion.prototype.showSuggestion=function(t){var e={children:[]};if(t.length>this.maxSuggestionItems){t.length=this.maxSuggestionItems}for(var i=0;i<t.length;i++){var n={children:[]};var r=t[i];n.children.push({text:r});e.children.push(n)}this.bindData(e,null,true);return};UISuggestion.prototype.onSuggestionShow=function(){};UISuggestion.prototype.query=function(t){var e=this;this.suggestionProvider.query(t,function(t){e.showSuggestion(t);e.onSuggestionShow()})};function UISuggestionCreator(){var t=["ui-suggestion","ui-suggestion",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISuggestion;return e.initUISuggestion(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISuggestionCreator);function UIButton(){return}UIButton.prototype=new UIElement;UIButton.prototype.isUIButton=true;UIButton.prototype.initUIButton=function(t,e,i){this.initUIElement(t);this.setMargin(5,5);this.setDefSize(e,i);this.setSizeLimit(20,20);this.setAutoScaleFontSize(true);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.addEventNames(["onUpdateTransform"]);return this};UIButton.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIButton.prototype.paintSelfOnly=function(t){if(this.pointerDown){var e=this.getHtmlImageByType(UIElement.IMAGE_ACTIVE);if(!e){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}}return};function UIButtonCreator(t,e){var i=["ui-button","ui-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIButton;return n.initUIButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIButtonCreator(120,60));function UIMLEdit(){return}UIMLEdit.prototype=new UIElement;UIMLEdit.prototype.isUIMLEdit=true;UIMLEdit.prototype.saveProps=["inputTips"];UIMLEdit.prototype.initUIMLEdit=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setText("");this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_FOCUSED,null);this.setMargin(12,12);this.addEventNames(["onChanged","onFocusIn","onFocusOut"]);this.setTextAlignV("top");this.setTextAlignH("left");return this};UIMLEdit.prototype.drawText=function(t){if(!this.text||this.editing){return}if(this.textNeedRelayout){this.layoutText(t)}return this.defaultDrawText(t)};UIMLEdit.prototype.shapeCanBeChild=function(t){return false};UIMLEdit.prototype.textEditable=function(t){return true};UIMLEdit.prototype.onClick=function(t,e){if(e){return}if(!this.isInDesignMode()){this.editText()}return this.callOnClickHandler(t)};UIMLEdit.prototype.isFocused=function(){return this.editing};UIMLEdit.prototype.getEditorRect=function(){var t=this.getPositionInView();var e=CantkRT.getMainCanvasPosition();var i=this.view.getAbsPosition();var n=this.view.getViewScale();var r=UIElement.getMainCanvasScale();var o=(i.x+t.x*n)/r.x+e.x;var a=(i.y+t.y*n)/r.y+e.y;var s=this.getWidth()*n/r.x;var h=this.getHeight()*n/r.y;var l={x:o,y:a,w:s,h:h};if(this.isInDesignMode()){var u=window.devicePixelRatio||1;l.x*=u;l.y*=u;l.w*=u;l.h*=u}return l};UIMLEdit.prototype.editText=function(t){if(this.textEditable(t)){var e=this;var i=this.getEditorRect();var n=this.getRealScale()/UIElement.getMainCanvasScale().y;var r=this.inputType?this.inputType:"text";var o=this.style.fontSize*n;var a=cantkShowTextArea(this.getText(),o,i.x,i.y,i.w,i.h);e.editing=true;a.setTextColor(this.style.textColor);a.showBorder(this.isInDesignMode());a.show();function s(t){if(t!==e.text){e.setText(t,true);e.postRedraw()}else{e.text=t}a.setOnChangedHandler(null);a.setOnChangeHandler(null);a.hide();delete e.editing;e.callOnFocusOutHandler();return}function h(t){e.callOnChangingHandler(t)}a.setOnChangedHandler(s);a.setOnChangeHandler(h);this.callOnFocusInHandler()}return};UIMLEdit.prototype.getTextTipsPosition=function(){var t={};t.x=this.hMargin;t.y=this.vMargin;t.textAlign="left";t.textBaseline="top";return t};function UIMLEditCreator(t,e){var i=["ui-mledit","ui-mledit",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIMLEdit;return n.initUIMLEdit(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIMLEditCreator(300,300));function UIToolBar(){return}UIToolBar.prototype=new UIElement;UIToolBar.prototype.isUIToolBar=true;UIToolBar.prototype.initUIToolBar=function(t,e,i,n){this.initUIElement(t);this.xAttr=UIElement.X_LEFT_IN_PARENT;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.yAttr=e?UIElement.Y_TOP_IN_PARENT:UIElement.Y_BOTTOM_IN_PARENT;this.setDefSize(200,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.setSizeLimit(100,50,2e3,200);return this};UIToolBar.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton||t.isUIGroup||t.isUIButtonGroup||t.isUIEdit||t.isUIImageButton||t.isUICheckBox||t.isUIRadioBox||t.isUIProgressBar||t.isUISwitch||t.isUILedDigits||t.isUIGroup||t.isUILayout||t.isUIWaitBar||t.isUIColorBar){return true}return false};UIToolBar.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};function UIToolBarCreator(t,e,i,n){var r=[t,"ui-toolbar",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var o=new UIToolBar;return o.initUIToolBar(t,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UIToolBarCreator("ui-toolbar",true,85,null));function UIPlaceholder(){return}UIPlaceholder.prototype=new UIElement;UIPlaceholder.prototype.isUIPlaceholder=true;UIPlaceholder.prototype.initUIPlaceholder=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);return this};UIPlaceholder.prototype.shapeCanBeChild=function(t){return false};UIPlaceholder.prototype.paintSelfOnly=function(t){if(this.isInDesignMode()){var e=this.vMargin;var i=this.hMargin;var n=this.getWidth(true);var r=this.getHeight(true);t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;drawDashedRect(t,e,i,n,r);t.stroke()}return};function UIVPlaceholderCreator(t,e){var i=["ui-v-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIPlaceholder;n.initUIPlaceholder(this.type,t,e);n.widthAttr=UIElement.WIDTH_FILL_PARENT;n.MIN_SIZE=4;n.setSizeLimit(20,4);return n};return}function UIHPlaceholderCreator(t,e){var i=["ui-h-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIPlaceholder;n.initUIPlaceholder(this.type,t,e);n.heightAttr=UIElement.HEIGHT_FILL_PARENT;n.MIN_SIZE=4;n.setSizeLimit(4,20);return n};return}ShapeFactoryGet().addShapeCreator(new UIVPlaceholderCreator(100,20));ShapeFactoryGet().addShapeCreator(new UIHPlaceholderCreator(20,100));function UIRadioBox(){return}UIRadioBox.prototype=new UICheckBox;UIRadioBox.prototype.isUIRadioBox=true;UIRadioBox.prototype.initUIRadioBox=function(t){return this.initUICheckBox(t)};UIRadioBox.prototype.setParent=function(t){UIElement.prototype.setParent.call(this,t);if(this.value){this.setChecked()}return this};UIRadioBox.prototype.onFromJsonDone=function(){if(this.value){this.setChecked()}return this};UIRadioBox.prototype.setChecked=function(){var t=this.getParent();if(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIRadioBox){i.setValue(false)}}}this.setValue(true);return this};UIRadioBox.prototype.onClick=function(t,e){if(e){return}this.setChecked();return this.callOnClickHandler(t)};function UIRadioBoxCreator(t,e){var i=["ui-radiobox","ui-radiobox",null,1];ShapeCreator.apply(this,i);this.createShape=function(t){var e=new UIRadioBox;e.initUIRadioBox(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIRadioBoxCreator(50,50,null,null,null,null,null,null));function UILedDigits(){return}UILedDigits.prototype=new UIElement;UILedDigits.prototype.isUILedDigits=true;UILedDigits.prototype.initUILedDigits=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);return this};UILedDigits.prototype.shapeCanBeChild=function(t){return false};UILedDigits.prototype.setText=function(t){this.text="";t=this.toText(t);for(var e=0;e<t.length;e++){var i=t[e];switch(i){case".":case":":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"F":case"F":{this.text=this.text+i}default:break}}return};UILedDigits.prototype.drawBarVL=function(t,e,i){t.beginPath();t.moveTo(0,0);t.lineTo(0,i);t.lineTo(e,i-e);t.lineTo(e,e);t.lineTo(0,0);return};UILedDigits.prototype.drawBarVR=function(t,e,i){t.beginPath();t.moveTo(e,0);t.lineTo(e,i);t.lineTo(0,i-e);t.lineTo(0,e);t.lineTo(e,0);return};UILedDigits.prototype.drawBarHT=function(t,e,i){t.beginPath();t.moveTo(0,0);t.lineTo(e,0);t.lineTo(e-i,i);t.lineTo(i,i);t.lineTo(0,0);return};UILedDigits.prototype.drawBarHM=function(t,e,i){t.beginPath();var n=Math.round(i/3);e=e-2*n;t.translate(n,0);t.moveTo(0,i/2);t.lineTo(i/2,0);t.lineTo(e-i/2,0);t.lineTo(e,i/2);t.lineTo(e-i/2,i);t.lineTo(i/2,i);t.lineTo(0,i/2);t.translate(-n,0);return};UILedDigits.prototype.drawBarHB=function(t,e,i){t.beginPath();t.moveTo(0,i);t.lineTo(e,i);t.lineTo(e-i,0);t.lineTo(i,0);t.lineTo(0,i);return};UILedDigits.prototype.drawBar=function(t,e,i){if(e<i){this.drawBarV(t,e,i)}else{this.drawBarH(t,e,i)}return};UILedDigits.prototype.drawDot=function(t,e,i,n){var r=(e/4+i/8)/2;if(n==="."){t.fillRect((e-r)/2,.75*i-r/2,r,r)}else if(n=":"){t.fillRect((e-r)/2,.25*i-r/2,r,r);t.fillRect((e-r)/2,.75*i-r/2,r,r)}return};UILedDigits.prototype.map={0:125,1:96,2:55,3:103,4:106,5:79,6:95,7:97,8:127,9:111,E:31,F:27,H:122};UILedDigits.prototype.fillBar=function(t,e){if(e){t.fillStyle=this.style.textColor;t.fill()}else{t.lineWidth=1;t.strokeStyle=this.style.lineColor;t.stroke()}return};UILedDigits.prototype.drawDigit=function(t,e,i,n){var r=Math.max(3,Math.round(i/10));var o=Math.max(3,Math.round(e/10));var a=Math.round((o+r)/2);var s=1;var h=e-2*s;var l=Math.floor(i/2-2*s);var u=this.map[n];t.translate(s,0);this.drawBarHT(t,h,a);t.translate(-s,0);this.fillBar(t,u&1);var p=Math.floor((i-r)/2);t.translate(s,p);this.drawBarHM(t,h,a);t.translate(-s,-p);this.fillBar(t,u>>1&1);var p=i-r;t.translate(s,p);this.drawBarHB(t,h,a);t.translate(-s,-p);this.fillBar(t,u>>2&1);t.translate(0,s);this.drawBarVL(t,a,l);t.translate(0,-s);this.fillBar(t,u>>3&1);var p=Math.round(2*s+(i-r)/2)+s;t.translate(0,p);this.drawBarVL(t,a,l);t.translate(0,-p);this.fillBar(t,u>>4&1);t.translate(e-a,s);this.drawBarVR(t,a,l);t.translate(-(e-a),-s);this.fillBar(t,u>>5&1);t.translate(e-a,p);this.drawBarVR(t,a,l);t.translate(-(e-a),-p);this.fillBar(t,u>>6&1);return};UILedDigits.prototype.drawDigits=function(t){var e=0;var i=this.text;var n=i.length;if(!n){return}for(var r=0;r<n;r++){var o=i[r];if(o==="."||o===":"){e=e+1}}var a=this.w/n*.2;var s=this.w/n-a;var h=this.h;t.save();t.translate(s/4*e,0);for(var r=0;r<n;r++){var o=i[r];if(o==="."||o===":"){this.drawDot(t,s/2,h,i[r]);t.translate(s/2+a,0)}else{this.drawDigit(t,s,h,i[r]);t.translate(s+a,0)}}t.restore();return};UILedDigits.prototype.paintSelfOnly=function(t){if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}t.fillStyle=this.style.lineColor;this.drawDigits(t);return};function UILedDigitsCreator(t,e){var i=["ui-led-digits","ui-led-digits",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UILedDigits;return n.initUILedDigits(this.type,t,e);
};return}ShapeFactoryGet().addShapeCreator(new UILedDigitsCreator(100,100));function UICanvas(){return}UICanvas.prototype=new UIElement;UICanvas.prototype.isUICanvas=true;UICanvas.prototype.initUICanvas=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.addEventNames(["onPaint","onPointerDown","onPointerMove","onPointerUp","onKeyDown","onKeyUp"]);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UICanvas.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUIButton||t.isUIGroup||t.isUILabel};UICanvas.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}t.beginPath();this.callOnPaintHandler(t);return};function UICanvasCreator(t,e){var i=["ui-canvas","ui-canvas",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UICanvas;return n.initUICanvas(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UICanvasCreator(200,200));function UIColorButton(){return}UIColorButton.prototype=new UIElement;UIColorButton.prototype.isUIButton=true;UIColorButton.prototype.isUIColorButton=true;UIColorButton.prototype.initUIColorTile=function(t,e,i){this.initUIColorButton(t,e,i);this.isUIButton=false;this.isUIColorButton=false;this.isUIColorTile=true;this.setAutoScaleFontSize(true);this.addEventNames(["onUpdateTransform"]);this.style.roundStyle="a";return this};UIColorButton.prototype.initUIColorButton=function(t,e,i){this.initUIElement(t);this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_INPUT);this.setCanRectSelectable(false,false);this.setMargin(0,0);this.addEventNames(["onUpdateTransform"]);return this};UIColorButton.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIColorButton.prototype.setRoundStyle=function(t){this.style.roundStyle=t;return this};UIColorButton.prototype.getRoundStyle=function(){return this.style.roundStyle};UIColorButton.prototype.setActiveFillColor=function(t){this.style.activeFillColor=t;return this};UIColorButton.prototype.getRoundStyleValue=function(){var t=this.style.roundStyle;if(t==="t"){return RoundRect.TL|RoundRect.TR}else if(t==="l"){return RoundRect.TL|RoundRect.BL}else if(t==="r"){return RoundRect.TR|RoundRect.BR}else if(t==="b"){return RoundRect.BL|RoundRect.BR}else{return RoundRect.TL|RoundRect.TR|RoundRect.BL|RoundRect.BR}};UIColorButton.prototype.paintSelfOnly=function(t){var e=this.getRoundStyleValue();var i=this.style.fillColor;var n=this.style.lineColor;if(this.pointerDown&&this.style.activeFillColor){i=this.style.activeFillColor}var r=!Shape.isTransparentColor(i);var o=!Shape.isTransparentColor(n);if(!r&&!o){return}t.save();t.beginPath();t.translate(this.hMargin,this.vMargin);drawRoundRect(t,this.w-2*this.hMargin,this.h-2*this.vMargin,this.roundRadius,e);if(r){t.fillStyle=i;t.fill()}if(o){if(this.isUIColorButton&&this.pointerDown){t.lineWidth=this.style.lineWidth+1}else{t.lineWidth=this.style.lineWidth}t.strokeStyle=n;t.stroke()}t.restore();return};function UIColorTileCreator(t,e){var i=["ui-color-tile","ui-color-tile",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorButton;return n.initUIColorTile(this.type,t,e)};return}function UIColorButtonCreator(t,e){var i=["ui-color-button","ui-color-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorButton;return n.initUIColorButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIColorTileCreator(80,80));ShapeFactoryGet().addShapeCreator(new UIColorButtonCreator(80,80));function UIViewPager(){return}UIViewPager.prototype=new UIPageManager;UIViewPager.prototype.isUIViewPager=true;UIViewPager.prototype.saveProps=["slideToChange"];UIViewPager.prototype.initUIViewPager=function(t){this.initUIPageManager(t);this.current=0;this.setDefSize(200,200);this.setTextType(UIElement.TEXT_NONE);this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator(2);this.animateQueue=[];return this};UIViewPager.prototype.getPrevFrame=function(){var t=this.children.length;var e=(this.current-1+t)%t;return this.children[e]};UIViewPager.prototype.getNextFrame=function(){var t=this.children.length;var e=(this.current+1)%t;return this.children[e]};UIViewPager.prototype.animScrollTo=function(t,e){var i=1e3;var n=this;var r=this.offset;var o=Date.now();var a=this.interpolator;if(n.animating){return}n.animating=true;function s(){var h=Date.now();var l=(h-o)/i;var u=a.get(l);if(l<1&&!n.halt){n.offset=r+t*u;setTimeout(s,16)}else{n.offset=0;n.setCurrent(e);n.setAnimatingFrames(null,null);delete o;delete a;delete n.animating;delete n.halt;n.queueAnimation()}n.postRedraw()}s();return};UIViewPager.prototype.onPointerDownRunning=function(t,e){if(e||this.animating||!this.slideToChange){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.velocityTracker.clear();return true};UIViewPager.prototype.isEventHandledByChild=function(){if(UIElement.hScrollHandledBy&&UIElement.hScrollHandledBy!==this){return true}else{return false}};UIViewPager.prototype.setEventHandled=function(){UIElement.hScrollHandledBy=this;return this};UIViewPager.prototype.onPointerMoveRunning=function(t,e){if(!this.slideToChange||e||!this.pointerDown){return}if(this.animating){this.setEventHandled();return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.current;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var r=Math.abs(this.getMoveAbsDeltaX());var o=Math.abs(this.getMoveAbsDeltaY());if(r>o&&r>10){this.offset=this.getMoveAbsDeltaX();this.setAnimatingFrames(this.getPrevFrame(),this.getNextFrame())}else{this.offset=0;this.setAnimatingFrames(null,null)}this.addMovementForVelocityTracker();return};UIViewPager.prototype.onPointerUpRunning=function(t,e){if(!this.slideToChange||e||!this.pointerDown){return}if(this.animating){this.setEventHandled();return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.current;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var o=0;var a=this.offset;var s=this.current;var h=Math.abs(this.getMoveAbsDeltaY());var l=this.velocityTracker.getVelocity().x;if(Math.abs(a)<5||h>60){this.offset=0;return}var u=this.children.length;var p=a+l;if(Math.abs(p)>this.w/3){if(a>0){o=this.w-a;s=(this.current-1+u)%u}else{o=-this.w-a;s=(this.current+1)%u}}else{o=-a}this.animScrollTo(o,s);return};UIViewPager.prototype.setAnimatingFrames=function(t,e){this.leftFrame=t;this.rightFrame=e;return this};UIViewPager.prototype.switchTo=function(t){var e=this.children;var i=e.length;this.offset=0;if(t<0||t>i-1){return}if(this.animateQueue===undefined){this.animateQueue=[]}this.animateQueue.push(t);if(this.animating){console.log("busy...");this.halt=true;return}this.queueAnimation();return this};UIViewPager.prototype.queueAnimation=function(){if(this.animateQueue.length<1){return}var t=this.children;var e=this.animateQueue.pop();this.animateQueue=[];var i=t[e];if(e<this.current){this.animScrollTo(this.w,e);this.setAnimatingFrames(i,null)}else{this.animScrollTo(-this.w,e);this.setAnimatingFrames(null,i)}};UIViewPager.prototype.paintChildrenAnimating=function(t){var e=this.getCurrentFrame();var i=this.leftFrame;var n=this.rightFrame;t.save();t.clipRect(0,0,this.w,this.h);if(this.offset>0){var r=this.w-this.offset;i.x=-r;i.paintSelf(t);r=this.offset;e.x=r;e.paintSelf(t)}else{e.x=this.offset;e.paintSelf(t);n.x=this.w+this.offset;n.paintSelf(t)}if(e){e.x=0}if(n){n.x=0}if(i){i.x=0}t.restore();return};UIViewPager.prototype.paintChildrenNormal=function(t){var e=this.getCurrentFrame();if(e){t.save();t.beginPath();e.paintSelf(t);t.restore()}return};UIViewPager.prototype.paintChildren=function(t){if(this.offset&&this.children.length>1&&(this.leftFrame||this.rightFrame)){this.paintChildrenAnimating(t)}else{this.paintChildrenNormal(t)}return};UIViewPager.prototype.setSlideToChange=function(t){this.slideToChange=t;return};function UIViewPagerCreator(){var t=["ui-view-pager","ui-view-pager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIViewPager;return e.initUIViewPager(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIViewPagerCreator);function UIProgressBar(){return}UIProgressBar.prototype=new UIElement;UIProgressBar.prototype.isUIProgressBar=true;UIProgressBar.prototype.saveProps=["stepSize","minValue","maxValue"];UIProgressBar.prototype.initUIProgressBar=function(t,e,i,n){this.initUIElement(t);this.setRange(0,100);this.setPercent(50);this.setDefSize(e,i);this.setStepSize(0);this.roundRadius=0;this.setInteractive(n);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_NORMAL_FG,null);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;if(n){this.addEventNames(["onChanged"]);this.addEventNames(["onChanging"])}return this};UIProgressBar.prototype.shapeCanBeChild=function(t){if(this.dragger){return false}return t.isUIImage||t.isUILabel||t.isUIColorTile};UIProgressBar.prototype.updateDraggerParams=function(){var t=this.dragger;if(!t)return;if(this.w<this.h){t.yAttr=UIElement.Y_FIX_TOP;t.xAttr=UIElement.X_CENTER_IN_PARENT;t.widthAttr=UIElement.WIDTH_FILL_PARENT;t.heightAttr=UIElement.HEIGHT_FIX}else{t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;t.xAttr=UIElement.X_FIX_LEFT;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FILL_PARENT}};UIProgressBar.prototype.relayoutChildren=function(){if(!this.dragger){return}if(this.w>this.h){var t=this.value*(this.w-this.dragger.w);var e=this.w-this.dragger.w;this.dragger.setLeft(Math.max(0,Math.min(e,t)))}else{var i=(1-this.value)*(this.h-this.dragger.h);var n=this.h-this.dragger.h;this.dragger.setTop(Math.max(0,Math.min(n,i)))}UIElement.prototype.relayoutChildren.call(this);return};UIProgressBar.prototype.resizeDragger=function(){if(this.dragger){var t=this.dragger.w;var e=this.dragger.h;if(this.w>this.h){e=this.h;t=Math.min(this.h,t)}else{t=this.w;e=Math.min(this.w,e)}this.dragger.setSize(t,e)}return this};UIProgressBar.prototype.setStepSize=function(t){var e=this.maxValue-this.minValue;this.stepSize=Math.max(0,Math.min(t,e));return this};UIProgressBar.prototype.setRange=function(t,e){this.minValue=Math.max(0,Math.min(t,e));this.maxValue=Math.max(0,Math.max(t,e));if(this.minValue===this.maxValue){this.minValue=0;this.maxValue=100}return this};UIProgressBar.prototype.getStepSize=function(){return this.stepSize||0};UIProgressBar.prototype.getMinValue=function(){return this.minValue};UIProgressBar.prototype.getMaxValue=function(){return this.maxValue};UIProgressBar.prototype.afterChildRemoved=function(t){if(t===this.dragger){this.dragger=null}};UIProgressBar.prototype.afterChildAppended=function(t){var e=this;this.dragger=t;this.updateDraggerParams();this.setTextType(Shape.TEXT_NONE);e.onPointerDownRunning=e.onPointerMoveRunning=function(t,e){if(e){return}var i=this.dragger.w>>1;var n=this.dragger.h>>1;if(this.pointerDown&&this.dragger){var r=t.x-i;var o=t.y-n;r=Math.min(Math.max(-2,r),this.w-i+2);o=Math.min(Math.max(-2,o),this.h-n+2);this.dragger.move(r,o)}return};e.onPointerUpRunning=function(t,e){if(e){return}if(this.changed){this.changed=false;this.callOnChangedHandler(this.getValue())}return};e.onSized=function(){var t=Math.min(this.w,this.h);this.updateLayoutParams();this.setPercent(this.getPercent());this.resizeDragger();this.updateDraggerParams();return};t.onSized=function(){e.resizeDragger()};t.onMoved=function(){var t=0;if(e.w>e.h){var i=this.left/(e.w-this.w);t=i*100;if(this.left<=0){t=0}if(this.left+this.w>=e.w){t=100}}else{var i=(e.h-this.h-this.top)/(e.h-this.h);t=i*100;if(this.top<=0){t=100}if(this.top+this.h>=e.h){t=0}}e.changed=true;e.setPercentOnly(t);e.callOnChangingHandler(e.getValue());return};return};UIProgressBar.prototype.setInteractive=function(t){this.interactive=t;return this};UIProgressBar.prototype.fixPercent=function(t,e){var i=t;if(e&&t<100){var n=this.maxValue-this.minValue;var r=Math.round(t/100*n/e)*e;i=r/n*100}return Math.min(i,100)/100};UIProgressBar.prototype.setPercentOnly=function(t,e,i){var n=this.stepSize;var r=this.fixPercent(t,this.stepSize);if(!i){this.value=r;this.relayoutChildren()}if(this.isInDesignMode()||!this.isVisible()){return this}if(!i){if(e){this.callOnChangedHandler(this.getValue())}}else{if(this.value==r)return this;this.setupAnimation({notify:e,valueStart:this.value,valueEnd:r})}return this};UIProgressBar.prototype.setupAnimation=function(t){var e=this;var i={duration:300,actionWhenBusy:"replace",onStep:function(t,i,n){e.value=n.value;e.relayoutChildren();return true},onDone:function(i,n){e.value=t.valueEnd;if(t.notify){e.callOnChangedHandler(e.getValue())}}};if(!t){t=i}else{var n=Object.keys(i);for(var r=0,o=n.length;r<o;r++){var a=n[r];if(!t[a]){t[a]=i[a]}}}this.animate(t);return this};UIProgressBar.prototype.setPercent=function(t,e,i){t=Math.max(0,Math.min(t,100));this.setPercentOnly(t,e,i);this.relayoutChildren();return this};UIProgressBar.prototype.getPercent=function(){return this.value*100};UIProgressBar.prototype.getValue=function(){var t=this.maxValue-this.minValue;var e=this.minValue+this.value*t;var i=this.stepSize;if(i){var n=Math.floor(e/i)*i;e=Math.max(e,n)}return Math.min(this.maxValue,Math.round(e))};UIProgressBar.prototype.setValue=function(t,e,i){var n=this.maxValue-this.minValue;var r=100*((t-this.minValue)/n);this.setPercent(r,e,i);return this};UIProgressBar.prototype.drawText=function(t){var e=Math.round(this.getPercent())+"%";if(!this.isTextColorTransparent()){t.font=this.style.getFont();t.fillStyle=this.getTextColor();t.textBaseline="middle";t.textAlign="center";t.fillText(e,this.w>>1,this.h>>1)}return};UIProgressBar.prototype.paintSelfOnly=function(t){};UIProgressBar.prototype.drawBgImageV=function(t){var e=null;var i=this.w>>1;var n=this.w-i>>1;var r=this.style.lineColor;var o=this.style.fillColor;var a=this.roundRadius?this.roundRadius:0;var s=this.getImageByType(UIElement.IMAGE_DEFAULT);if(s&&s.getImage()){var h=s.getImageRect();e=s.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,h)}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,n,0,i,this.h,h)}}else if(!Shape.isTransparentColor(o)){t.beginPath();t.translate(n,0);drawRoundRect(t,i,this.h,a);t.translate(-n,0);t.fillStyle=this.style.fillColor;t.fill()}s=this.getImageByType(UIElement.IMAGE_NORMAL_FG);var l=Math.round(this.h*this.value);var u=this.h-l;if(s&&s.getImage()){var h=s.getImageRect();e=s.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){var p=h.h;var c=h.y;var f=h.rh;var d=Math.round(p*this.value);h.h=d;h.y=h.y+p-d;h.h=d;h.rh=Math.round(f*this.value);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,u,this.w,l,h);h.y=c;h.h=p;h.rh=f}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,n,u,i,l,h)}}else if(!Shape.isTransparentColor(r)){if(l>2*a){t.beginPath();t.translate(n,u);drawRoundRect(t,i,l,a);t.fillStyle=this.style.lineColor;t.fill()}}return};UIProgressBar.prototype.drawBgImageH=function(t){var e=null;var i=this.h>>1;var n=this.h-i>>1;var r=this.style.lineColor;var o=this.style.fillColor;var a=this.roundRadius?this.roundRadius:0;var s=this.getImageByType(UIElement.IMAGE_DEFAULT);if(s&&s.getImage()){var h=s.getImageRect();e=s.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,h)}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,0,n,this.w,i,h)}}else if(!Shape.isTransparentColor(o)){t.beginPath();t.translate(0,n);drawRoundRect(t,this.w,i,a);t.translate(0,-n);t.fillStyle=this.style.fillColor;t.fill()}var l=Math.round(this.w*this.value);var s=this.getImageByType(UIElement.IMAGE_NORMAL_FG);if(s&&s.getImage()){var h=s.getImageRect();e=s.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){var u=h.w;var p=h.rw;h.w=Math.round(h.w*this.value);h.rw=Math.round(h.rw*this.value);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,l,this.h,h);h.w=u;h.rw=p}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,0,n,l,i,h)}}else if(!Shape.isTransparentColor(r)){if(l>2*a){t.beginPath();t.translate(0,n);drawRoundRect(t,l,i,a);t.fillStyle=this.style.lineColor;t.fill()}}return};UIProgressBar.prototype.drawCircle=function(t){var e=this.w>>1;var i=this.h>>1;var n=Math.min(e,i);var r=Math.PI*2*this.value-.5*Math.PI;var o=Math.min(n,Math.max(this.style.lineWidth,5));var a=this.getImageByType(UIElement.IMAGE_NORMAL_FG);var s=this.getImageByType(UIElement.IMAGE_DEFAULT);if(s&&s.getImage()){var h=s.getImage();var l=s.getImageRect();WImage.draw(t,h,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,l)}else if(!this.isFillColorTransparent()){t.beginPath();t.arc(e,i,n,0,Math.PI*2);t.fillStyle=this.style.fillColor;t.fill()}if(a&&a.getImage()){t.beginPath();t.moveTo(n,n);t.lineTo(n,0);t.arc(e,i,n,-Math.PI*.5,r);t.lineTo(n,n);t.clip();var h=a.getImage();var l=a.getImageRect();WImage.draw(t,h,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,l)}else if(!this.isStrokeColorTransparent()){n=n-(o>>1);t.beginPath();t.lineCap="round";t.lineWidth=o;t.arc(e,i,n,-Math.PI*.5,r);t.strokeStyle=this.style.lineColor;t.stroke()}return};UIProgressBar.prototype.drawBgImage=function(t){t.save();if(Math.abs(this.w-this.h)<10){this.drawCircle(t)}else if(this.w>this.h){this.drawBgImageH(t)}else{this.drawBgImageV(t)}t.restore()};UIProgressBar.prototype.onFromJsonDone=function(){this.setPercent(this.getPercent());return};function UIProgressBarCreator(t,e,i){var n=i?"ui-slider":"ui-progressbar";var r=[n,"ui-progressbar",null,1];ShapeCreator.apply(this,r);this.createShape=function(n){var r=new UIProgressBar;return r.initUIProgressBar(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIProgressBarCreator(200,45,false));ShapeFactoryGet().addShapeCreator(new UIProgressBarCreator(200,45,true));function UIWindowManager(){}UIWindowManager.prototype=new UIFrames;UIWindowManager.prototype.isUIWindowManager=true;UIWindowManager.prototype.saveProps=["current","sceneIdIndex"];UIWindowManager.prototype.initUIWindowManager=function(t){this.settings={};this.initUIFrames(t);this.history=new Array;this.showLoadingProgress=true;this.setImage("force-landscape-tips",null);this.setImage("force-portrait-tips",null);this.soundMusicAutoPlay=true;this.setSoundEffectsEnable(true);this.loadedAssets={};UIWindowManager.instance=this;return this};UIWindowManager.getInstance=function(){return UIWindowManager.instance};UIWindowManager.prototype.fromJson=function(t){this.jsonData=t;return RShape.prototype.fromJson.call(this,t)};UIWindowManager.prototype.onImageLoadDone=function(t,e){if(!t){return}};UIWindowManager.prototype.onImageLoadErr=function(t){console.log("onImageLoadErr:"+t)};UIWindowManager.prototype.onJsonLoadDone=function(t,e){};UIWindowManager.prototype.onJsonLoadErr=function(t){console.log("onJsonLoadErr:"+t)};UIWindowManager.prototype.loadElementAssets=function(t){if(t.images){for(var e in t.images){var i=t.images[e];if(typeof i==="string"){WImage.create(i,this.onImageLoadDone.bind(this))}}}var n=UIElement.jsonAssets;for(var r=0;r<n.length;r++){var e=n[r];var i=t[e];if(i){if(i.endWith(".json")){ResLoader.loadJson(i,this.onJsonLoadDone.bind(this),this.onJsonLoadErr.bind(this))}else{ResLoader.loadData(i,this.onJsonLoadDone.bind(this),this.onJsonLoadErr.bind(this))}}}var o=UIElement.imagesAssets;for(var r=0;r<o.length;r++){var e=o[r];var i=t[e];if(i){WImage.create(i,this.onImageLoadDone.bind(this))}}var a=t.children;for(var r=0;r<a.length;r++){var s=a[r];this.loadElementAssets(s)}return this};UIWindowManager.prototype.clearAssetsCache=function(t){WImage.clearCache(t);ResLoader.clearCache(t);return this};UIWindowManager.prototype.loadAssets=function(t,e,i){var n=this;t=t||this.getWindowNames();if(AssetsDownloader.isAvailable()){AssetsDownloader.downloadMulti(t,i,function(){n.doLoadAssets(t,e)})}else{n.doLoadAssets(t,e)}return this};UIWindowManager.prototype.shouldShowAssetsLoadingProgress=function(t){return!this.isAssetsLoaded(t)&&this.assetsLoadingWin};UIWindowManager.prototype.isAssetsLoaded=function(t){return this.loadedAssets[t]};UIWindowManager.prototype.doLoadAssets=function(t,e){var i=[];var n=this;function r(t){if(e){e(t.percent,t.finished,t.total)}if(t.finished>=t.total){ResLoader.off(ResLoader.EVENT_ASSETS_LOAD_PROGRESS,r);for(var o=0;o<i.length;o++){var a=i[o];n.loadedAssets[a]=true}i=null}}var o=this.jsonData.children;for(var a=0;a<o.length;a++){var s=o[a];if(!t||t.indexOf(s.name)>=0){i.push(s.name);this.loadElementAssets(s)}}if(ResLoader.isLoadCompleted()){setTimeout(function(){r({percent:100,finished:100,total:100})},10)}else{ResLoader.on(ResLoader.EVENT_ASSETS_LOAD_PROGRESS,r)}return this};UIWindowManager.prototype.onFromJsonDone=function(){this.designWidth=this.w;this.designHeight=this.h;this.forcePortrait=false;this.forceLandscape=false;return};UIWindowManager.prototype.beforeAddShapeIntoChildren=function(t){return!t.isUIWindow};UIWindowManager.prototype.getMainWindow=function(){var t=this.children;var e=t.length;for(var i=0;i<e;i++){var n=t[i];if(n.isUILoadingWindow)continue;if(n.isUINormalWindow&&n.windowType==="main"){return n}}for(var i=0;i<e;i++){var n=t[i];if(n.isUILoadingWindow)continue;if(n.isUINormalWindow){return n}}return null};UIWindowManager.prototype.getWindowNames=function(t){var e=[];var i=this.children;var n=i.length;for(var r=0;r<n;r++){var o=i[r];if(o!==t){e.push(o.name)}}return e};UIWindowManager.prototype.setInitWindow=function(t){if(t===null||t===undefined){this.initWindowIndex=null}else{this.initWindowIndex=Math.max(0,Math.min(t,this.children.length-1))}return this};UIWindowManager.prototype.getInitWindow=function(){var t=null;if(this.initWindowIndex||this.initWindowIndex===0){t=this.children[this.initWindowIndex]}if(!t){var e=cantkGetQueryParam("initwin");if(e){t=this.find(e)}}if(!t){var e=this.preferInitWindow;if(e){t=this.find(e)}}if(!t){t=this.getMainWindow()}if(!t||t.isUILoadingWindow){return null}return t};UIWindowManager.prototype.waitDeviceRotate=function(){var t=this;if(this.isDeviceDirectionOK()){this.doShowInitWindow()}else{setTimeout(function(){t.waitDeviceRotate()},100)}};UIWindowManager.prototype.showInitWindow=function(t){this.preferInitWindow=t;this.waitDeviceRotate()};UIWindowManager.prototype.doShowInitWindow=function(){this.history.clear();var t=this.getInitWindow();if(t){this.targetShape=t;t.prepareForOpen();index=this.getFrameIndex(t);this.showFrame(index);t.callOnBeforeOpen();t.callOnOpen();this.history.push(index);this.postRedraw();console.log("showInitWindow: set targetShape:"+this.targetShape.name)}else{console.log("Not Found Init Window.")}return true};UIWindowManager.prototype.callOnLoad=function(){this.resLoadDone=true;for(var t=0;t<this.children.length;t++){var e=this.children[t];try{e.callOnLoadHandler()}catch(i){console.log("Call onLoad fail:"+i.message)}}return true};UIWindowManager.prototype.callOnUnload=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnUnloadHandler()}return true};UIWindowManager.prototype.onResLoadDone=function(){this.callOnLoad();this.showInitWindow();return};UIWindowManager.prototype.getStartLoadingWindow=function(){var t=this.children;var e=t.length;for(var i=0;i<e;i++){var n=t[i];if(n.isUINormalWindow&&(n.isUILoadingWindow||n.name==="win-loading")){n.isUILoadingWindow=true;return n}}return null};UIWindowManager.prototype.loadAudios=function(){this.loadSoundEffects();this.loadSoundMusic();return this};UIWindowManager.prototype.loadFonts=function(){var t=this.view.getMeta();if(t&&t.extfonts){ResLoader.loadFonts(t.extfonts)}return this};UIWindowManager.prototype.setAssetsLoadingWindow=function(t){this.assetsLoadingWin=this.find(t);return this};UIWindowManager.prototype.getAssetsLoadingWindow=function(){return this.assetsLoadingWin};UIWindowManager.prototype.showStartLoadingWindow=function(){this.resLoadDone=false;var t=this.getStartLoadingWindow();if(t){if(!t.isUILoadingWindowV2){this.loadAssets(null,null);this.loadAudios();this.loadFonts();console.log("old version, load all assets.")}this.openWindow(t.name)}else{this.loadAssets(null,null);this.showInitWindow();console.log("no loading window, load all assets.")}return};UIWindowManager.prototype.systemInit=function(){UIWindowManager.soundEffects={};UIWindowManager.soundMusic={};UIElement.animTimerID=null;this.callOnSystemInitHandler();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnSystemInitHandler()}var i=this;this.showStartLoadingWindow();ResLoader.setOnLoadFinishListener(function(){i.callOnLoad()});return};UIWindowManager.prototype.systemExit=function(){console.log("systemExit: ");var t=this.history.length;for(var e=0;e<t;e++){this.closeCurrentWindow(0,true)}this.history.length=0;this.stopSoundMusic();this.callOnUnload();return};UIWindowManager.prototype.hasOpenPendingWindow=function(){var t=this.children;var e=t.length;for(var i=0;i<e;i++){var n=t[i];if(n.openPending){return true}}return false};UIWindowManager.prototype.openWindow=function(t,e,i,n,r){var o=null;if(t){o=this.find(t)}else{o=this.getMainWindow()}if(!o||!o.isUIWindow){alert("Can not find window: "+t);return}if(o.openPending){console.log("This window is already open:"+t);return}if(i){this.closeCurrentWindow(0,true)}if(o.pendingLoadChildren){o.loadChildren()}if(o.isOpen()){r=r||{closeOldIfOpened:true};if(r.closeOldIfOpened){o.callOnClose({});this.history.remove(o.getIndex())}else if(r.openNewIfOpened){var o=this.dupChild(o.name);o.destroyWhenClose=true}else{console.log(o.name+" is open already.");return false}}if(!o.isUILoadingWindow&&!o.isUILoadingWindowV2&&this.shouldShowAssetsLoadingProgress(o.name)){this.downloadAssetsAndOpenWindow(o,n,e)}else{this.doOpenWindow(o,n,e)}};UIWindowManager.prototype.doOpenWindow=function(t,e,i){t.prepareForOpen();t.openPending=true;t.initData=e;t.onClose=i;t.callOnBeforeOpen(e);this.targetShape=t;this.setPointerEventTarget(t);if(t.isUINormalWindow){return this.openNormalWindow(t)}else{return this.openPopupWindow(t)}};UIWindowManager.prototype.downloadAssetsAndOpenWindow=function(t,e,i){var n=this.getAssetsLoadingWindow();if(n===t){console.log("UIWindowManager.prototype.downloadAssetsAndOpenWindow failed.");return}this.doOpenWindow(n);var r=this;var o=n.findChildByType("ui-progressbar");var a=n.findChildByType("ui-label");if(o){o.setPercent(0)}if(a){a.setText("Downloading...")}function s(n,s,h){if(a){a.setText("Loading...")}if(o){o.setPercent(n,true)}if(s>=h){r.closeCurrentWindow(0,true);r.doOpenWindow(t,e,i)}}function h(t,e,i){if(a){if(t>=100){a.setText("Loading...")}else{a.setText("Downloading...")}}if(o){if(t>=100){o.setPercent(0,true)}else{o.setPercent(t,true)}}}this.loadAssets([t.name],s,h)};UIWindowManager.prototype.openPopupWindow=function(t){var e=this;var i=this.getCurrentFrame();function n(){if(!t.app){console.log("may be exited preview mode");return}var n=e.getFrameIndex(i);if(e.history.indexOf(n)<0){return}t.show();i.setPopupWindow(t);e.postRedraw();t.callOnOpen(t.initData)}if(i){i.callOnSwitchToBack(true);if(t.isAnimationEnabled()){var r=this.getPositionInScreen();var o=AnimationFactory.create(t.getAnimationName(true),t.getAnimationDuration(true));o.setWins(i,t);o.setScale(this.getRealScale());o.prepare(r.x,r.y,this.w,this.h,n);o.setRectOfFront(t.x,t.y,t.w,t.h);o.run()}else{n()}}return true};UIWindowManager.prototype.openNormalWindow=function(t){var e=this;var i=0;var n=this.getCurrentFrame();function r(){if(!t.app){console.log("may be exited preview mode");return}i=e.getFrameIndex(t);e.showFrame(i);e.history.push(i);n=e.getCurrentFrame();e.postRedraw();t.callOnOpen(t.initData);return}if(n){n.callOnSwitchToBack();if(t.isAnimationEnabled()){var o=this.getPositionInScreen();var a=AnimationFactory.create(t.getAnimationName(true),t.getAnimationDuration(true));a.setWins(n,t);a.setScale(this.getRealScale());a.prepare(o.x,o.y,this.w,this.h,r);a.run()}else{r()}}else{r()}return true};UIWindowManager.prototype.getCurrentWindow=function(){var t=this.getCurrentFrame();if(!t){return null}var e=t.getPopupWindow();return e?e:t};UIWindowManager.prototype.backToHomeWin=function(){var t=this.history;var e=t.length-1;var i=this.getCurrentWindow();if(!e){if(i.isUIPopupWindow){this.closeCurrentWindow(0)}return}if(e===1){if(i.isUIPopupWindow){this.closeCurrentWindow(0,true);this.closeCurrentWindow(0)}else{this.closeCurrentWindow(0)}return}var n=t[0];var r=this.getFrame(n);if(i.isAnimationEnabled()){var o=this.getPositionInScreen();var a=AnimationFactory.create(i.getAnimationName(false),i.getAnimationDuration(false));a.setWins(i,r);a.setScale(this.getRealScale());a.prepare(o.x,o.y,this.w,this.h,function(){});a.run()}for(var s=0;s<e;s++){this.closeCurrentWindow(0,true)}return};UIWindowManager.prototype.closeCurrentWindow=function(t,e){var i=this.getCurrentWindow();if(!i||i.isInDesignMode()){return false}return this.closeWindow(i,t,e)};UIWindowManager.prototype.closeWindow=function(t,e,i){t.closePending=true;if(t.isUINormalWindow){return this.closeNormalWindow(t,e,i)}else{return this.closePopupWindow(t,e,i)}};UIWindowManager.prototype.closePopupWindow=function(t,e,i){var n=this;var r=this.getCurrentFrame();if(r){function o(){if(!t.app){console.log("may be exited preview mode");return}r.removePopupWindow(t);r.callOnSwitchToFront(true);n.postRedraw();t.callOnClose(e)}if(!t.isTopWindow()){console.log("close background dialog");if(t.parentWindow){t.parentWindow.removePopupWindow(t)}t.callOnClose(e);return}if(r===t){i=true}if(t.isAnimationEnabled()&&!i&&!n.hasOpenPendingWindow()){var a=this.getPositionInScreen();var s=AnimationFactory.create(t.getAnimationName(false),t.getAnimationDuration(false));r.removePopupWindow(t);s.setWins(t,r);r.setPopupWindow(t);s.setScale(this.getRealScale());s.prepare(a.x,a.y,this.w,this.h,o);s.setRectOfFront(t.x,t.y,t.w,t.h);s.run()}else{o()}}return true};UIWindowManager.prototype.closeAll=function(){var t=[];for(var e=0;e<this.history.length;e++){var i=this.history[e];var n=this.getFrame(i);for(var r=n;r;r=r.popupWindow){t.push(r)}}for(var e=t.length-1;e>=0;e--){var n=t[e];n.callOnClose({});n.targetShape=null}this.history=[];return};UIWindowManager.prototype.closeNormalWindow=function(t,e,i){var n=this;var r=null;if(this.history.length<2){if(i||this.history.length){n.history.remove(n.current);t.callOnClose(e)}return false}if(!t.isTopWindow()){var o=n.getFrameIndex(t);console.log("closing background window "+t.name);n.history.remove(o);t.callOnClose();if(o===n.current&&n.history.length>0){n.showFrame(n.history[n.history.length-1])}return}lastWinIndex=this.history[this.history.length-2];r=this.getFrame(lastWinIndex);function a(){if(!r.app){console.log("may be exited preview mode");return}if(lastWinIndex!=n.history[n.history.length-1]||n.hasOpenPendingWindow()){return}n.showFrame(lastWinIndex);r.callOnSwitchToFront();n.postRedraw();t.callOnClose(e);return}n.history.remove(n.current);if(i){a()}else if(t.isAnimationEnabled()&&!n.hasOpenPendingWindow()){var s=this.getPositionInScreen();var h=AnimationFactory.create(t.getAnimationName(false),t.getAnimationDuration(false));h.setWins(t,r);h.setScale(this.getRealScale());h.prepare(s.x,s.y,this.w,this.h,a);h.run()}else{setTimeout(a,10)}return};UIWindowManager.prototype.isWindowOpen=function(t){return t&&t.isOpen()};UIWindowManager.prototype.onChildrenChanged=function(){};UIWindowManager.prototype.afterChildAppended=function(t){
if(this.mode!==Shape.MODE_RUNNING&&!this.isUnpacking){var e=this.getFrameIndex(t);this.showFrame(e)}this.onChildrenChanged();return};UIWindowManager.prototype.onChildRemoved=function(t){this.onChildrenChanged();return};UIWindowManager.prototype.scaleForDensity=function(t,e,i){if(!t||t===1){return}for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.lcddensity||r.lcddensity==="all"){if(r.pendingLoadChildren){r.scaleInfo={};r.scaleInfo.sizeScale=t;r.scaleInfo.lcdDensity=e}else{r.scaleForDensity(t,e,i)}}}return};UIWindowManager.prototype.resize=function(t,e){var i=0;var n=0;var r=this.screenScaleMode==="fix-width";var o=this.screenScaleMode==="fix-height";var a=this.screenScaleMode==="fix-resolution";var s=this.parentShape!=null;if(this.mode===Shape.MODE_RUNNING&&(r||o||a)&&!s){var h=this.view.getCanvas();var l=h.width;var u=h.height;var p=this.designWidth;var c=this.designHeight;var f=true;var d=l>u&&p>c||l<u&&p<c;h.style.width=l+"px";h.style.height=u+"px";if(f&&d){if(r){var I=p/l;h.width=p;h.height=u*I;t=h.width;e=h.height}else if(o){var I=c/u;h.height=c;h.width=l*I;t=h.width;e=h.height}else{var g=p/l;var m=c/u;var I=Math.max(g,m);if(Math.abs(g-m)<.1){h.width=p;h.height=c;i=0;n=0;t=h.width;e=h.height}else{h.width=l*I;h.height=u*I;i=h.width-p>>1;n=h.height-c>>1;t=p;e=c}}var v=h.width/l;var y=h.height/u;WWindowManager.setInputScale(v,y)}else{h.width=l;h.height=u;WWindowManager.setInputScale(1,1);t=h.width;e=h.height}var U=cantkGetViewPort();this.app.onCanvasSized(h.width,h.height);console.log("Canvas Size: w ="+h.width+" h="+h.height);console.log("ViewPort Size: w ="+U.width+" h="+U.height);console.log("Canvas Style Size: w ="+h.style.width+" h="+h.style.height)}this.lastWin=null;this.setLeftTop(i,n);this.setSizeLimit(t,e,t,e);UIElement.prototype.resize.call(this,t,e);return};UIWindowManager.prototype.setDeviceConfig=function(t){var e=this.screenScaleMode;if(e==="fix-resolution"||e==="fix-width"||e==="fix-height"){this.oldConfig=this.deviceConfig;return}var i=this.deviceConfig;this.oldConfig=this.deviceConfig;this.deviceConfig=t;if(i&&t){if(i.lcdDensity!=t.lcdDensity){var n=this.getSizeScale(i.lcdDensity,t.lcdDensity);this.scaleForDensity(n,t.lcdDensity,true)}this.notifyDeviceConfigChanged(i,t)}return};UIWindowManager.prototype.getDeviceConfig=function(){if(this.deviceConfig){return this.deviceConfig}else{var t=this.getDevice();if(t){return t.config}}return null};UIWindowManager.prototype.paintChildren=function(t){if(!this.isInDesignMode()){if(this.forcePortrait&&this.w>this.h){var e=this.getHtmlImageByType("force-portrait-tips");t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,this.w,this.h);return}else if(this.forceLandscape&&this.w<this.h){var e=this.getHtmlImageByType("force-landscape-tips");t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,this.w,this.h);return}}var i=this.getCurrentFrame();if(i.closePending){return}if(!this.isInDesignMode()&&this.history.length===0){UIElement.logWarning("All Windows Are Closed!")}else{if(i.isUIDialog){t.fillStyle="white";t.fillRect(0,0,this.w,this.h)}t.save();t.beginPath();i.paintSelf(t);t.restore()}return};UIWindowManager.prototype.paintSelf=function(t){var e=this.x;var i=this.y;var n=e||i;if(n){t.save();t.translate(e,i)}this.paintChildren(t);if(n){t.restore()}};UIWindowManager.prototype.isDeviceDirectionOK=function(){if(this.isInDesignMode()){return true}if(this.forcePortrait&&this.w>this.h||this.forceLandscape&&this.w<this.h){console.log("Device Direction Incorrect.");return false}return true};UIWindowManager.prototype.relayout=function(){if(this.isDeviceDirectionOK()){UIElement.prototype.relayout.call(this)}else{console.log("isDeviceDirectionNotOK ignore relayout")}return this};UIWindowManager.prototype.relayoutChildren=function(){if(!this.isDeviceDirectionOK()){console.log("isDeviceDirectionNotOK ignore relayout");return}var t=this.getCurrentFrame();if(this.isInDesignMode()){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.relayout()}}else{if(t){t.relayout();var n=t.getPopupWindow();if(n){n.relayout()}}}return};UIWindowManager.prototype.onKeyDown=function(t){var e=this.getCurrentWindow();return e&&e.onKeyDown(t)};UIWindowManager.prototype.onKeyUp=function(t){var e=this.getCurrentWindow();return e&&e.onKeyUp(t)};UIWindowManager.prototype.setSoundEffectURLs=function(t){this.soundEffectURLs=t;return this};UIWindowManager.prototype.getSoundEffectURLs=function(){return this.soundEffectURLs};UIWindowManager.prototype.getSoundEffectNames=function(){if(!this.soundEffectURLs){return[]}var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){t[e]=decodeURI(basename(t[e]))}return t};UIWindowManager.prototype.getSoundEnable=function(){return this.soundMusicsEnalbe||this.soundEffectsEnalbe};UIWindowManager.prototype.setSoundEnable=function(t){this.setSoundEffectsEnable(t);this.setSoundMusicsEnable(t);return this};UIWindowManager.prototype.setSoundEffectsEnable=function(t){this.soundEffectsEnalbe=t;return this};UIWindowManager.prototype.setSoundMusicsEnable=function(t){if(this.soundMusicsEnalbe!==t){this.soundMusicsEnalbe=t;if(t){this.playSoundMusic()}else{this.stopSoundMusic()}}return this};UIWindowManager.prototype.loadSoundEffects=function(){if(!this.soundEffectURLs){return}if(CantkRT.isCantkRTCordova()){console.log("Native Audio supported: load native Audio");this.loadSoundEffectsNative()}else if(isWebAudioSupported()){console.log("WebAudio supported: load Web Audio");this.loadSoundEffectsWebAudio()}else{console.log("WebAudio not supported: load HTML5 Audio");this.loadSoundEffectsHtml5Audio()}return this};UIWindowManager.prototype.loadSoundEffectsHtml5Audio=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];ResLoader.loadAudio(i,function(t){var e={audio:t};UIWindowManager.setVolumeOfAudio(e.audio,UIWindowManager.soundEffectVolume);var i=decodeURI(basename(t.src));UIWindowManager.soundEffects[i]=e})}return this};UIWindowManager.prototype.loadSoundEffectsNative=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];CantkRT.createSoundEffect(i,function(t){var e={audio:t};UIWindowManager.setVolumeOfAudio(e.audio,UIWindowManager.soundEffectVolume);var i=decodeURI(basename(t.src));UIWindowManager.soundEffects[i]=e;console.log("loadSoundEffectsNative success.")},function(){console.log("loadSoundEffectsNative fail.")})}return this};UIWindowManager.prototype.loadSoundEffectsWebAudio=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];var n={src:[i],autoplay:false,loop:false,volume:.8};var r=decodeURI(basename(i));var o={audio:new Howl(n),playing:false};UIWindowManager.setVolumeOfAudio(o.audio,UIWindowManager.soundEffectVolume);UIWindowManager.soundEffects[r]=o}return this};UIWindowManager.prototype.stopSoundEffect=function(t){for(var e in UIWindowManager.soundEffects){if(t===e||!t){var i=UIWindowManager.soundEffects[e];if(i&&i.audio){if(i.audio.stop){i.audio.stop()}else{i.audio.pause()}i.playing=false}}}return this};UIWindowManager.prototype.stopAllSound=function(){try{this.stopSoundMusic().stopSoundEffect()}catch(t){console.log(t.message)}return this};UIWindowManager.soundMusicVolume=.8;UIWindowManager.soundEffectVolume=.8;UIWindowManager.prototype.setSoundEffectVolume=function(t){UIWindowManager.soundEffectVolume=t;return this};UIWindowManager.prototype.setSoundMusicVolume=function(t){UIWindowManager.soundMusicVolume=t;var e=this.lastAudioInfo;if(e&&e.audio){UIWindowManager.setVolumeOfAudio(e.audio,UIWindowManager.soundMusicVolume)}return this};UIWindowManager.setVolumeOfAudio=function(t,e){if(typeof t.volume==="function"){t.volume(e)}else{t.volume=e}};UIWindowManager.prototype.playSoundEffect=function(t,e){if(!this.soundEffectsEnalbe){console.log("this.soundEffectsEnalbe is disable ");return this}var i=UIWindowManager.soundEffects[t];if(!i||!i.audio){console.log("not found: "+t);return this}if(e){if(i.audio.once){i.audio.once("end",e)}else{i.audio.addEventListener("ended",function(t){e()})}}UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundEffectVolume);i.audio.play();console.log("playSoundEffect:"+t);return this};UIWindowManager.prototype.onMultiTouch=function(t,e,i){var n=this.getCurrentWindow();if(n){var r=this.left+n.left;var o=this.top+n.top;for(var a=0;a<e.length;a++){var s=e[a];s.x-=r;s.y-=o}n.onMultiTouch(t,e,i)}};UIWindowManager.prototype.onPointerDownRunning=function(t,e){if(this.autoPlayPending){this.playSoundMusic();this.autoPlayPending=false}if(!e||this.popupWindow||!this.pointerDown){return}return this.callOnPointerDownHandler(t)};UIWindowManager.prototype.setSoundMusicURLs=function(t){this.soundMusicURLs=t;return this};UIWindowManager.prototype.getSoundMusicURLs=function(){return this.soundMusicURLs};UIWindowManager.prototype.loadSoundMusicHTML5=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var o=n[r];ResLoader.loadAudio(o,function(n){var r={audio:n};var o=decodeURI(basename(n.src));UIWindowManager.setVolumeOfAudio(r.audio,UIWindowManager.soundMusicVolume);if(e){n.loop="loop"}if(i){n.play();i=false}t.autoPlayPending=true;UIWindowManager.soundMusic[o]=r})}return};UIWindowManager.prototype.loadSoundMusicWebAudio=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var o=n[r];var a={src:[o],autoplay:i,loop:e,volume:.8};var s=decodeURI(basename(o));var h={audio:new Howl(a),playing:i};UIWindowManager.setVolumeOfAudio(h.audio,UIWindowManager.soundMusicVolume);if(i){this.lastAudioInfo=h}i=false;UIWindowManager.soundMusic[s]=h}return};UIWindowManager.prototype.loadSoundMusicNative=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var o=n[r];CantkRT.createSoundMusic(o,function(t){var n={audio:t};var r=decodeURI(basename(t.src));UIWindowManager.setVolumeOfAudio(n.audio,UIWindowManager.soundMusicVolume);if(e){t.loop="loop"}if(i){t.play();this.lastAudioInfo=n;i=false}UIWindowManager.soundMusic[r]=n})}return};UIWindowManager.prototype.loadSoundMusic=function(){if(!this.soundMusicURLs){return}this.soundMusicsEnalbe=true;if(CantkRT.isCantkRTCordova()){console.log("Native Audio supported: load native Audio");this.loadSoundMusicNative()}else if(isWebAudioSupported()){console.log("WebAudio supported: load Web Audio");this.loadSoundMusicWebAudio()}else{this.loadSoundMusicHTML5()}this.soundMusicsPlaying=this.soundMusicAutoPlay;return this};UIWindowManager.prototype.isSoundMusicPlaying=function(t){var e=false;for(var i in UIWindowManager.soundMusic){if(t===i||!t){var n=UIWindowManager.soundMusic[i];if(n&&n.audio){if(n.playing){e=true;break}}}}return e};UIWindowManager.prototype.stopSoundMusic=function(t){for(var e in UIWindowManager.soundMusic){if(t===e||!t){var i=UIWindowManager.soundMusic[e];if(i&&i.audio){i.audio.pause();i.playing=false;this.soundMusicsPlaying=false}}}return this};UIWindowManager.prototype.playSoundMusic=function(t,e){if(this.soundMusicsPlaying){this.stopSoundMusic()}if(!this.soundMusicsEnalbe){if(t){this.lastAudioInfo=UIWindowManager.soundMusic[t]}console.log("this.soundMusicsEnalbe is disable ");return this}if(!t&&this.lastAudioInfo&&this.lastAudioInfo.audio){var i=this.lastAudioInfo;UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundMusicVolume);i.audio.play();i.playing=true;this.soundMusicsPlaying=true;return this}for(var n in UIWindowManager.soundMusic){if(t===n||!t){var i=UIWindowManager.soundMusic[n];if(i&&i.audio){if(e){if(i.audio.once){i.audio.once("end",e)}else{i.audio.addEventListener("ended",function(t){e()})}}UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundMusicVolume);i.audio.play();i.playing=true;this.lastAudioInfo=i;this.soundMusicsPlaying=true;console.log("UIWindowManager.prototype.playSoundMusic");break}}}console.log("playSoundMusic:"+t);return this};UIWindowManager.prototype.getSoundMusicNames=function(){if(!this.soundMusicURLs){return[]}var t=this.soundMusicURLs.split("\n");for(var e=0;e<t.length;e++){t[e]=basename(t[e])}return t};UIWindowManager.prototype.shapeCanBeChild=function(t){return t.isUIWindow};function UIWindowManagerCreator(){var t=["ui-window-manager","ui-window-manager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWindowManager;return e.initUIWindowManager(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIWindowManagerCreator);function UIImageButton(){return}UIImageButton.prototype=new UIElement;UIImageButton.prototype.isUIImageButton=true;UIImageButton.prototype.initUIImageButton=function(t,e,i){this.initUIElement(t,e,i);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.addEventNames(["onUpdateTransform"]);return this};UIImageButton.prototype.shapeCanBeChild=function(t){return false};function UIImageButtonCreator(t,e){var i=["ui-image-button","ui-image-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIImageButton;return n.initUIImageButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIImageButtonCreator(120,90));function UIImageNormalView(){return}UIImageNormalView.prototype=new UIImageView;UIImageNormalView.prototype.isUIImageNormalView=true;UIImageNormalView.prototype.initUIImageNormalView=function(t,e,i){this.userImages=[];this.cachedImages=[];this.initUIElement(t);this.initUIImageView(e,i);this.setTextType(Shape.TEXT_NONE);this.current=0;this.offsetX=0;this.offsetY=0;this.imageScale=1;this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator;this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);return this};UIImageNormalView.prototype.onPointerDownRunning=function(t,e){if(e){return}this.velocityTracker.clear();return};UIImageNormalView.prototype.onPointerMoveRunning=function(t,e){if(e){return}this.offsetX=this.offsetX+this.getMoveDeltaX();this.offsetY=this.offsetY+this.getMoveDeltaY();this.addMovementForVelocityTracker();return};UIImageNormalView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIImageNormalView.prototype.onPointerUpRunning=function(t,e){if(e){return}var i=this.velocityTracker.getVelocity();var n=this.w;var r=this.h;var o=i.x/n;var a=i.y/r;var s=Math.max(o,a);var h=.5*n*o*o;var l=.5*r*a*a;h=i.x>0?h:-h;l=i.y>0?l:-l;this.scrollTo(h,l,s*1e3);return true};UIImageNormalView.prototype.scrollTo=function(t,e,i){var n=this;var r=Math.max(500,Math.min(i,1e3));var o=(new Date).getTime();var a=this.offsetX;var s=this.offsetY;var h=this.cachedImages[this.current];var l=Math.min(h.width/2,t);var u=Math.min(h.height/2,e);function p(){var t=new Date;var e=(t.getTime()-o)/r;if(e<1){n.offsetX=a+e*l;n.offsetY=s+e*u;setTimeout(p,10)}else{delete o;n.offsetX=a+l;n.offsetY=s+u}delete t;n.postRedraw()}p();return};UIImageNormalView.prototype.switchTo=function(t){var e=this.current;var i=this.userImages.length;if(t>0){if(this.current+t<i){e=this.current+t}}else{if(this.current+t>0){e=this.current+t}}};UIImageNormalView.prototype.calcImageDefaultOffset=function(){var t=this.current;if(t<0||t>=this.cachedImages.length){return}var e=this.cachedImages[t];if(!e||!e.width){return}this.imageScale=Math.min(this.w/e.width,this.h/e.height);var i=this.imageScale*e.width;var n=this.imageScale*e.height;this.offsetX=(this.w-i)/2;this.offsetY=(this.h-n)/2;return};UIImageNormalView.prototype.setCurrentImage=function(t){if(t<0||t>=this.userImages.length){return}this.current=t;this.calcImageDefaultOffset();return};UIImageNormalView.prototype.onDoubleClick=function(t,e){this.calcImageDefaultOffset();return this.callOnDoubleClickHandler(t)};UIImageNormalView.prototype.paintSelfOnly=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=this.cachedImages[this.current];if(!e||!e.width){return}this.imageScale=1;t.save();t.rect(0,0,this.w,this.h);t.clip();t.translate(this.offsetX,this.offsetY);t.scale(this.imageScale,this.imageScale);t.drawImage(e,0,0);t.restore();return};function UIUIImageNormalViewCreator(){var t=["ui-image-normal-view","ui-image-normal-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageNormalView;return e.initUIImageNormalView(this.type,300,300)};return}ShapeFactoryGet().addShapeCreator(new UIUIImageNormalViewCreator);function UIImageSlideView(){return}UIImageSlideView.prototype=new UIImageView;UIImageSlideView.prototype.isUIImageSlideView=true;UIImageSlideView.prototype.saveProps=["showIndicator","frameDuration"];UIImageSlideView.prototype.initUIImageSlideView=function(t,e,i){this.initUIElement(t);this.initUIImageView(e,i);this.offset=0;this.addEventNames(["onChanged"]);this.setTextType(Shape.TEXT_NONE);imageSlideViewInitCustomProp(this);return this};UIImageSlideView.prototype.onInit=function(){var t=this;this.currFrame=0;function e(){if(!t.isInDesignMode()&&t.isVisible()){var i=t.getFrameDuration();t.postRedraw();setTimeout(e,i);var n=t.currFrame+1;t.animScrollTo(-t.w,n)}}var i=this.getFrameDuration();setTimeout(e,i);return};UIImageSlideView.prototype.getFrameDuration=function(){return this.frameDuration?this.frameDuration:5e3};UIImageSlideView.prototype.setFrameDuration=function(t){this.frameDuration=Math.max(1e3,Math.min(t,3e5));return};UIImageSlideView.prototype.setShowIndicator=function(t){this.showIndicator=t;return};UIImageSlideView.prototype.getFrameIndicatorParams=function(){var t=this.userImages.length;var e=Math.min(.5*this.w/t,40);var i=e*t;var n=(this.w-i)/2;var r=.8*this.h;return{offsetX:n,offsetY:r,itemSize:e,n:t}};UIImageSlideView.prototype.getCurrent=function(){return this.currFrame};UIImageSlideView.prototype.getCurrentImage=function(){var t=this.cachedImages[this.currFrame];return t};UIImageSlideView.prototype.setValue=function(t){for(var e=0;e<this.cachedImages.length;e++){var i=this.cachedImages[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){return this.setCurrent(e)}}return this};UIImageSlideView.prototype.setCurrent=function(t){this.setCurrentFrame(t);return this};UIImageSlideView.prototype.setCurrentFrame=function(t){this.offset=0;this.currFrame=(t+this.userImages.length)%this.userImages.length;this.postRedraw();this.callOnChangedHandler(this.currFrame);return this};UIImageSlideView.prototype.animScrollTo=function(t,e){var i=1e3;var n=this;var r=this.offset;var o=(new Date).getTime();var a=new DecelerateInterpolator(2);if(n.animating){return}n.animating=true;function s(){var h=new Date;var l=(h.getTime()-o)/i;var u=a.get(l);if(l<1){n.offset=r+t*u;setTimeout(s,10)}else{n.offset=0;n.setCurrentFrame(e);delete o;delete a;delete n.animating}delete h;n.postRedraw()}s();return};UIImageSlideView.prototype.onPointerDownRunning=function(t,e){if(this.isEventHandledByChild()){return}this.setEventHandled();if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();return true};UIImageSlideView.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;return t&UIElement.EVENT_HSCROLL_HANDLED};UIImageSlideView.prototype.setEventHandled=function(){this.setLastEventStatus(UIElement.EVENT_HSCROLL_HANDLED);return this};UIImageSlideView.prototype.onPointerMoveRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.currFrame;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}this.offset=r;this.addMovementForVelocityTracker();return};UIImageSlideView.prototype.onPointerUpRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.currFrame;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var o=0;var a=this.offset;var s=this.currFrame;var h=this.velocityTracker.getVelocity().x;var l=a+h;if(Math.abs(a)<10){this.offset=0;return}if(Math.abs(l)>this.w/3){if(a>0){o=this.w-a;s=this.currFrame-1}else{o=-this.w-a;s=this.currFrame+1}}else{o=-a}this.animScrollTo(o,s);return};UIImageSlideView.prototype.onClick=function(t,e){if(e||this.animating){return}var i=this.getFrameIndicatorParams();var n=i.offsetX;var r=i.offsetY;var o=i.itemSize;var a=i.n;var s=t.x;var h=t.y;if(h<r||h>r+o||s<n||s>n+a*o){return}for(var l=0;l<a;l++){if(s>n&&s<n+o){this.setCurrentFrame(l);break}n+=o}return};UIImageSlideView.prototype.drawFrameIndicator=function(t,e){var i=this.getFrameIndicatorParams();var n=i.offsetX;var r=i.offsetY;var o=i.itemSize;var a=i.n;n+=o/2;r+=o/2;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;for(var s=0;s<a;s++){t.beginPath();t.arc(n,r,10,0,Math.PI*2);n+=o;if(s===e){t.save();t.shadowColor=this.style.lineColor;t.shadowBlur=5;t.shadowOffsetX=0;t.shadowOffsetY=0;t.fill();t.stroke();t.restore()}else{t.fill()}}return};UIImageSlideView.prototype.getPrevFrame=function(){var t=(this.currFrame-1+this.userImages.length)%this.userImages.length;return this.cachedImages[t]};UIImageSlideView.prototype.getFrames=function(){return this.userImages.length};UIImageSlideView.prototype.getNextFrame=function(){var t=(this.currFrame+1)%this.userImages.length;return this.cachedImages[t]};UIImageSlideView.prototype.drawOneImage=function(t,e){var i=this.style.fillColor;if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){t.drawImage(e,0,0,e.width,e.height,0,0,this.w,this.h)}else if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO){var n={x:0,y:0};n.w=e.width;n.h=e.height;this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO,0,0,this.w,this.h,n)}else{UIImageView.drawImageAtCenter(t,e,0,0,this.w,this.h,true,i)}return};UIImageSlideView.prototype.drawImage=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=(this.currFrame?this.currFrame:0)%this.userImages.length;var i=this.cachedImages[e];if(i&&i.width>0){t.save();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();t.translate(this.offset,0);this.drawOneImage(t,i);var n=Math.abs(this.offset);if(this.offset<0){i=this.getNextFrame();if(i&&i.width>0){t.translate(this.w,0);this.drawOneImage(t,i)}}else if(n>0){i=this.getPrevFrame();if(i&&i.width>0){t.translate(-this.w,0);this.drawOneImage(t,i)}}t.restore();if(this.showIndicator){this.drawFrameIndicator(t,e)}}return};UIImageSlideView.prototype.shapeCanBeChild=function(t){return t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage};function UIImageSlideViewCreator(){var t=["ui-image-slide-view","ui-image-slide-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageSlideView;return e.initUIImageSlideView(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageSlideViewCreator);function UIPageIndicator(){return}UIPageIndicator.prototype=new UIHScrollView;UIPageIndicator.prototype.isUIPageIndicator=true;UIPageIndicator.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIPageIndicator.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicator.prototype.setVisibleTabs=function(t){this.visibleTabs=t;return};UIPageIndicator.prototype.getVisibleTabs=function(){return this.visibleTabs?this.visibleTabs:6};UIPageIndicator.prototype.getTabWidth=function(){var t=this.getPages();var e=this.getVisibleTabs();if(t<e){return this.w/t}else{return this.w/e}};UIPageIndicator.prototype.getScrollRange=function(){var t=this.getVisibleTabs();if(t<6){return this.w}else{var e=this.getPages();return this.getTabWidth()*e}};UIPageIndicator.prototype.initUIPageIndicator=function(t,e,i){this.initUIHScrollView(t,10,null);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setCanRectSelectable(false,false);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UIPageIndicator.prototype.getViewPager=function(){if(!this.getParent()){return}if(this.viewPager&&!this.viewPager.parentShape){this.viewPager=null}if(!this.viewPager){this.viewPager=this.getParent().findChildByType("ui-view-pager",true);if(!this.viewPager&&this.isUIPageIndicatorSimple){this.viewPager=this.getWindow().findChildByType("ui-view-pager",true)}}return this.viewPager};UIPageIndicator.prototype.getViewPagerOffset=function(){var t=this.getViewPager();return t?t.offset/t.w:0};UIPageIndicator.prototype.getPages=function(){var t=this.getViewPager();if(t){t.pageIndicator=this}return t?t.getFrames():3};UIPageIndicator.prototype.getCurrent=function(){var t=this.getViewPager();return t?t.getCurrent():0};UIPageIndicator.prototype.paintOneIndicator=function(t,e,i,n,r,o,a){t.beginPath();t.arc(n+o/2,r+a/2,10,0,2*Math.PI);t.fill();if(e){t.stroke()}return};UIPageIndicator.prototype.shapeCanBeChild=function(t){return false};UIPageIndicator.prototype.paintOneIndicatorCircle=function(t,e,i,n,r,o,a){var s=Math.floor(Math.max(5,a/4));t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.style.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.style.lineColorOfCurrent:this.style.lineColor;t.beginPath();t.arc(n+o/2,r+a/2,s,0,2*Math.PI);t.fill();t.stroke();return};UIPageIndicator.prototype.paintOneIndicatorNumber=function(t,e,i,n,r,o,a){var s=Math.floor(Math.max(5,a/4));var h=Math.floor(n+o/2);var l=Math.floor(r+a/2);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.style.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.style.lineColorOfCurrent:this.style.lineColor;t.beginPath();t.arc(h,l,s,0,2*Math.PI);t.fill();t.stroke();t.font=s<20?"16px sans":"22px sans";t.textAlign="center";t.textBaseline="middle";t.fillStyle=this.style.textColor;t.fillText(i+1,h,l);return};UIPageIndicator.prototype.paintOneIndicatorRect=function(t,e,i,n,r,o,a){var s=10;if(o>a){s=Math.max(20,a/4)}else{s=Math.max(20,o/4)}s=Math.floor(s);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.style.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.style.lineColorOfCurrent:this.style.lineColor;var h=(o-s)/2;var l=(a-s)/2;t.beginPath();t.rect(n+h,r+l,s,s);t.fill();t.stroke();return};UIPageIndicator.prototype.paintOneIndicatorLine=function(t,e,i,n,r,o,a){var s=4;if(o>a){s=Math.max(4,a/4)}else{s=Math.max(4,o/4)}s=Math.floor(s);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.style.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.style.lineColorOfCurrent:this.style.lineColor;var h=(o-s)/2;var l=(a-s)/2;t.beginPath();if(o>a){t.rect(n,r+l,o,s)}else{t.rect(n+h,r,s,a)}t.fill();t.stroke();return};UIPageIndicator.prototype.onClickItem=function(t){var e=this.getViewPager();if(e){e.setCurrent(t)}return};UIPageIndicator.prototype.findItemByPoint=function(t){var e=this.getPages();if(this.w>this.h){var i=this.getTabWidth();for(var n=0;n<e;n++){if(t.x>n*i&&t.x<(n+1)*i){return n}}}else{var r=this.h/e;for(var n=0;n<e;n++){if(t.y>n*r&&t.y<(n+1)*r){return n}}}return-1};UIPageIndicator.prototype.onClick=function(t,e){if(e){return}var i=this.findItemByPoint(t);if(i>=0){this.onClickItem(i)}this.callOnClickHandler(t);return};UIPageIndicator.prototype.paintBackground=function(t){var e=this.getPages();if(!e){t.lineWidth=1;t.strokeStyle="Red";t.rect(0,0,this.w,this.h);t.stroke()}};UIPageIndicator.prototype.paintSelfOnly=function(t){var e=this.getPages();var i=this.getCurrent();var n={};n.x=this.lastPosition.x-this.left;n.y=this.lastPosition.y-this.top;this.pointerOnItem=this.findItemByPoint(n);this.paintBackground(t);t.translate(-this.offset,0);if(this.w>this.h){var r=this.h;var o=this.getTabWidth();var a=Math.floor(this.getViewPagerOffset()*o);for(var s=0;s<e;s++){var h=s*o;this.paintOneIndicator(t,s===i,s,h,0,o,r)}}else{var o=this.w;var r=this.h/e;for(var s=0;s<e;s++){var l=s*r;this.paintOneIndicator(t,s===i,s,0,l,o,r)}}t.translate(this.offset,0);delete this.pointerOnItem;return};function UIPageIndicatorCreator(){var t=["ui-page-indicator","ui-page-indicator",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicator;return e.initUIPageIndicator(this.type,200,60)};return}function UIPageIndicatorSimple(){return}UIPageIndicatorSimple.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicatorSimple.prototype=new UIPageIndicator;UIPageIndicatorSimple.prototype.isUIPageIndicatorSimple=true;UIPageIndicatorSimple.prototype.saveProps=["indicatorStyle"];UIPageIndicatorSimple.prototype.initUIPageIndicatorSimple=function(t,e,i,n){this.initUIPageIndicator(t,e,i);this.style.fillColorOfCurrent="Gray";this.style.lineColorOfCurrent="Black";this.setAlwaysOnTop(true);this.setVisibleTabs(12);this.setIndicatorStyle(n);return this};UIPageIndicatorSimple.prototype.setLineColorOfCurrent=function(t){this.style.lineColorOfCurrent=t;return};UIPageIndicatorSimple.prototype.setFillStyleOfCurrent=function(t){this.style.fillColorOfCurrent=t;return};UIPageIndicatorSimple.prototype.setIndicatorStyle=function(t){this.indicatorStyle=t;return this};UIPageIndicatorSimple.prototype.paintOneIndicator=function(t,e,i,n,r,o,a){switch(this.indicatorStyle){case"circle":{this.paintOneIndicatorCircle(t,e,i,n,r,o,a);break}case"rect":{this.paintOneIndicatorRect(t,e,i,n,r,o,a);break}case"line":{this.paintOneIndicatorLine(t,e,i,n,r,o,a);break}default:{this.paintOneIndicatorNumber(t,e,i,n,r,o,a);break}}};function UIPageIndicatorCircleCreator(){var t=["ui-page-indicator-circle","ui-page-indicator-circle",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"circle")};return}function UIPageIndicatorNumberCreator(){var t=["ui-page-indicator-number","ui-page-indicator-number",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"number")};return}function UIPageIndicatorRectCreator(){var t=["ui-page-indicator-rect","ui-page-indicator-rect",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"rect")};return}function UIPageIndicatorLineCreator(){var t=["ui-page-indicator-line","ui-page-indicator-line",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"line")};return}function UIPageIndicatorSimpleCreator(){var t=["ui-page-indicator-simple","ui-page-indicator-simple",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"line")};return}function UIPageIndicatorNormal(){return}UIPageIndicatorNormal.prototype=new UIPageIndicator;UIPageIndicatorNormal.prototype.isUIPageIndicatorNormal=true;UIPageIndicatorNormal.prototype.saveProps=["enableAnimatePage","strItemImages","strItemTexts","strItemImagesOfCurrent"];UIPageIndicatorNormal.prototype.initUIPageIndicatorNormal=function(t,e,i){this.initUIPageIndicator(t,e,i);this.itemTexts=[];this.itemImages=[];this.imagePosition="left";this.itemImagesOfCurrent=[];this.setMargin(5,5);this.setAlwaysOnTop(false);this.setImage(UIElement.ITEM_BG_NOTMAL,null);this.setImage(UIElement.ITEM_BG_ACTIVE,null);this.setImage(UIElement.ITEM_BG_CURRENT_NOTMAL,null);this.setImage(UIElement.ITEM_BG_CURRENT_ACTIVE,null);return this};UIPageIndicatorNormal.prototype.onInit=function(){this.syncImages()};UIPageIndicatorNormal.prototype.syncImages=function(){this.itemImages=[];this.itemImagesOfCurrent=[];for(var t in this.images){if(t==="display")continue;var e=this.images[t];if(t.indexOf("current-item-images-")===0){this.itemImagesOfCurrent.push(e)}else if(t.indexOf("item-images-")===0){this.itemImages.push(e);
}}return};UIPageIndicatorNormal.prototype.setEnableAnimatePage=function(t){this.enableAnimatePage=t;return};UIPageIndicatorNormal.prototype.setItemImagesByStr=function(t){var e=t.split("\n");var i="item-images-";var n=this.itemImages.length;for(var r=0;r<n;r++){this.setImage(i+r,null)}for(var r=0;r<e.length;r++){var o=e[r];if(o){this.setImage(i+r,o)}}this.syncImages();this.strItemImages=t;return};UIPageIndicatorNormal.prototype.setItemImagesOfCurrentByStr=function(t){var e=t.split("\n");var i="current-item-images-";var n=this.itemImagesOfCurrent.length;for(var r=0;r<n;r++){this.setImage(i+r,null)}for(var r=0;r<e.length;r++){var o=e[r];if(o){this.setImage(i+r,o)}}this.syncImages();this.strItemImagesOfCurrent=t;return};UIPageIndicatorNormal.prototype.setItemTextsByStr=function(t){this.strItemTexts=t;this.itemTexts=t.split("\n");return};UIPageIndicatorNormal.prototype.setImagePosition=function(t){this.imagePosition=t;return};UIPageIndicatorNormal.prototype.getItemImagesStr=function(){return this.strItemImages?this.strItemImages:""};UIPageIndicatorNormal.prototype.getItemImagesStrOfCurrent=function(){return this.strItemImagesOfCurrent?this.strItemImagesOfCurrent:""};UIPageIndicatorNormal.prototype.getItemImages=function(){if(!this.itemImages.length){this.syncImages()}return this.itemImages};UIPageIndicatorNormal.prototype.getItemImagesOfCurrent=function(){if(!this.itemImagesOfCurrent.length){this.syncImages()}return this.itemImagesOfCurrent};UIPageIndicatorNormal.prototype.getItemTextsStr=function(){return this.strItemTexts?this.strItemTexts:""};UIPageIndicatorNormal.prototype.getItemTexts=function(){if(!this.itemTexts.length&&this.strItemTexts){this.setItemTextsByStr(this.strItemTexts)}return this.itemTexts};UIPageIndicatorNormal.prototype.getItemImage=function(t,e){var i=e?this.getItemImagesOfCurrent():this.getItemImages();if(i&&t<i.length){return i[t]}return null};UIPageIndicatorNormal.prototype.getBackgroundImage=function(t,e){var i="";var n=this.pointerDown&&this.pointerOnItem===t;if(e){i=n?UIElement.ITEM_BG_CURRENT_ACTIVE:UIElement.ITEM_BG_CURRENT_NOTMAL}else{i=n?UIElement.ITEM_BG_ACTIVE:UIElement.ITEM_BG_NOTMAL}return this.getImageByType(i)};UIPageIndicatorNormal.prototype.paintOneIndicatorBackground=function(t,e,i,n,r,o,a){var s=this.getBackgroundImage(i,e);if(!s||!s.getImage()){return}var h=s.getImage();var l=s.getImageRect();this.drawImageAt(t,h,this.images.display,n,r,o,a,l);return};UIPageIndicatorNormal.prototype.setItemTextColorOfCurrent=function(t){this.style.textColorOfCurrent=t;return};UIPageIndicatorNormal.prototype.getItemTextColorOfCurrent=function(){return this.style.textColorOfCurrent?this.style.textColorOfCurrent:"green"};UIPageIndicatorNormal.prototype.paintBackground=function(t){return};UIPageIndicatorNormal.prototype.getItemLocaleText=function(t){var e=null;var i=this.getItemTexts();if(i&&t<i.length){e=webappGetText(i[t]);if(!e){e=i[t]}}return e};UIPageIndicatorNormal.prototype.paintOneIndicator=function(t,e,i,n,r,o,a){var s=this.getItemImage(i,e);this.paintOneIndicatorBackground(t,e,i,n,r,o,a);var h=8;var l=this.style.fontSize;var u=this.getItemLocaleText(i);t.font=this.style.getFont();t.fillStyle=e?this.getItemTextColorOfCurrent():this.style.textColor;if(s&&s.getImage()){var p=s.getImage();var c=s.getImageRect();var f=this.hMargin;var d=this.vMargin;if(u){var l=this.style.fontSize;var I=n+f;var g=r+d;var m=o-2*f;var v=a-l-2*d-h;this.drawImageAt(t,p,UIElement.IMAGE_DISPLAY_AUTO,I,g,m,v,c);I=n+(o>>1);g=r+a-d;t.textAlign="center";t.textBaseline="bottom";t.fillText(u,I,g)}else{var I=n+f;var g=r+d;var m=o-2*f;var v=a-2*d;this.drawImageAt(t,p,UIElement.IMAGE_DISPLAY_AUTO,I,g,m,v,c)}}else{if(u){t.textAlign="center";t.textBaseline="middle";t.fillText(u,Math.floor(n+o/2),Math.floor(r+a/2))}}return};UIPageIndicator.prototype.onClickItem=function(t){var e=this.getViewPager();if(e){if(this.enableAnimatePage){e.switchTo(t)}else{e.setCurrent(t)}}return};function UIPageIndicatorNormalCreator(){var t=["ui-page-indicator-normal","ui-page-indicator-normal",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorNormal;return e.initUIPageIndicatorNormal(this.type,200,60)};return}function UIPageIndicatorNormalX(){return}UIPageIndicatorNormalX.prototype=new UIPageIndicator;UIPageIndicatorNormalX.prototype.isUIPageIndicatorNormalX=true;UIPageIndicatorNormalX.prototype.initUIPageIndicatorNormalX=function(t,e,i){this.initUIPageIndicator(t,e,i);return this};UIPageIndicatorNormalX.prototype.relayoutChildren=function(){var t=this.children;var e=this.getPages()||3;for(var i=t.length;i<e;i++){var n=this.addChild(this.createElement("ui-page-indicator-button"));n.setText(i)}t.length=e;var r=e;var o=this.h;var a=this.w/r;for(var i=0;i<r;i++){var s=t[i];s.h=o;s.w=a;s.y=0;s.x=i*a;s.xAttr=UIElement.X_FIX_LEFT;s.yAttr=UIElement.Y_FIX_TOP;s.widthAttr=UIElement.WIDTH_FIX;s.heightAttr=UIElement.HEIGHT_FIX}return this};UIPageIndicatorNormalX.prototype.paintOneIndicator=function(t,e,i,n,r,o,a){};UIPageIndicatorNormalX.prototype.shapeCanBeChild=function(t){return t.isUIPageIndicatorButton};function UIPageIndicatorNormalXCreator(){var t=["ui-page-indicator-normal-x","ui-page-indicator-normal-x",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorNormalX;return e.initUIPageIndicatorNormalX(this.type,200,60)};return}function UIPageIndicatorButton(){return}UIPageIndicatorButton.prototype=new UIRadioBox;UIPageIndicatorButton.prototype.isUIPageIndicatorButton=true;UIPageIndicatorButton.prototype.initUIPageIndicatorButton=function(t){this.initUIRadioBox(t);this.userMovable=false;this.userResizable=false;this.images={display:UIElement.IMAGE_DISPLAY_9PATCH};this.setImage(UIElement.IMAGE_CURRENT_PAGE_BG,null);this.setImage(UIElement.IMAGE_CURRENT_PAGE_FG,null);this.setImage(UIElement.IMAGE_NOT_CURRENT_PAGE_BG,null);this.setImage(UIElement.IMAGE_NOT_CURRENT_PAGE_FG,null);return this};UIPageIndicatorButton.prototype.getValue=function(){var t=this.parentShape;if(t){return t.getCurrent()===t.children.indexOf(this)}else{return this.value}};UIPageIndicatorButton.prototype.drawText=function(t){};UIPageIndicatorButton.prototype.drawImage=function(t){var e=null;var i=null;var n=this.getValue();var r=this.getImageByType(n?UIElement.IMAGE_CURRENT_PAGE_BG:UIElement.IMAGE_NOT_CURRENT_PAGE_BG);var o=this.getImageByType(n?UIElement.IMAGE_CURRENT_PAGE_FG:UIElement.IMAGE_NOT_CURRENT_PAGE_FG);i=r.getImage();e=r.getImageRect();if(i){this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,e)}i=o.getImage();e=o.getImageRect();var a=this.text;if(a){t.textAlign="center";t.font=this.style.getFont();t.fillStyle=n?this.style.textColorHighlight:this.style.textColor}if(i){if(a){var s=this.style.fontSize+10;this.drawImageAt(t,i,UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN,0,0,this.w,this.h-s,e);t.textBaseline="bottom";t.fillText(a,this.w>>1,this.h-3)}else{this.drawImageAt(t,i,UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN,0,0,this.w,this.h,e)}}else if(a){t.textBaseline="middle";t.fillText(a,this.w>>1,this.h>>1)}return};UIPageIndicatorButton.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUILabel};function UIPageIndicatorButtonCreator(){var t=["ui-page-indicator-button","ui-page-indicator-button",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorButton;return e.initUIPageIndicatorButton(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIPageIndicatorButtonCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNormalXCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNormalCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorCircleCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNumberCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorRectCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorLineCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorSimpleCreator);function UIPath(){return}UIPath.prototype=new UIElement;UIPath.prototype.isUIPath=true;UIPath.prototype.saveProps=["showPath"];UIPath.prototype.initUIPath=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onInit"]);return this};UIPath.prototype.shapeCanBeChild=function(t){return false};UIPath.prototype.onInit=function(){this.shapesInfo=[];this.elapsedTime=0;this.pathAnimation=new PathAnimation;this.animationState=UIElement.STATE_RUNNING;this.callOnInitHandler();return};UIPath.prototype.restart=function(){this.elapsedTime=0;this.animationState=UIElement.STATE_RUNNING;var t=this.shapesInfo;var e=this.shapesInfo.length;for(var i=0;i<e;i++){var n=t[i];n.done=false;n.startTime=n.delayTime}return this};UIPath.prototype.pause=function(){this.animationState=UIElement.STATE_PAUSED;return this};UIPath.prototype.resume=function(){this.animationState=UIElement.STATE_RUNNING;return this};UIPath.prototype.hasObj=function(t){var e=this.shapesInfo;var i=this.shapesInfo.length;for(var n=0;n<i;n++){var r=e[n];if(r.shape===t){return true}}return false};UIPath.prototype.addObj=function(t,e,i,n,r){if(this.hasObj(t)){console.log("obj exist in path.");return this}var o={shape:t,onStep:e,onDone:i,noRotation:r,delayTime:n?n:0,startTime:Date.now()};o.startTime=o.delayTime+this.elapsedTime;this.shapesInfo.push(o);return this};UIPath.prototype.removeObj=function(t){var e=this.shapesInfo;var i=this.shapesInfo.length;for(var n=0;n<i;n++){var r=e[n];if(r.shape===t){e.splice(n,1);break}}return this};UIPath.prototype.resetObjs=function(){this.shapesInfo=[];return this};UIPath.prototype.resetPath=function(){this.pathAnimation.reset();return this};UIPath.prototype.getStartPoint=function(){return this.pathAnimation.startPoint};UIPath.prototype.getEndPoint=function(){return this.endPoint};UIPath.prototype.addPath=function(t){this.pathAnimation.addPath(t);return this};UIPath.prototype.addLine=function(t,e,i,n){return this.addPath(LinePath.create(t,e,i.x,i.y,n.x,n.y))};UIPath.prototype.addArc=function(t,e,i,n,r,o){return this.addPath(ArcPath.create(t,e,i.x,i.y,n,r,o))};UIPath.prototype.addPara=function(t,e,i,n,r){return this.addPath(ParaPath.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};UIPath.prototype.addSin=function(t,e,i,n,r,o,a){return this.addPath(SinPath.create(t,e,i.x,i.y,n,r,o,a))};UIPath.prototype.addBezier=function(t,e,i,n,r,o){return this.addPath(Bezier3Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y,o.x,o.y))};UIPath.prototype.addQuad=function(t,e,i,n,r){return this.addPath(Bezier2Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};UIPath.prototype.getDuration=function(){return this.pathAnimation.duration};UIPath.prototype.getPosition=function(t){return this.pathAnimation.getPosition(t)};UIPath.prototype.getDirection=function(t){return this.pathAnimation.getDirection(t)};UIPath.prototype.updateObjs=function(t){this.elapsedTime+=t.timeStep;var e=this.elapsedTime;var i=this.shapesInfo.slice();var n=this.shapesInfo.length;var r=this.pathAnimation;var o=r.getDuration();for(var a=0;a<n;a++){var s=i[a];var h=s.shape;if(!h||!h.parentShape)continue;var l=e-s.startTime;if(l>0&&!s.done){var u=r.getDirection(l);var p=r.getPosition(l);if(!h.visible){h.setVisible(true)}if(h.anchor){h.setPosition(p.x,p.y)}else{h.setPosition(p.x-(h.w>>1),p.y-(h.h>>1))}if(!s.noRotation){h.setRotation(u)}if(s.onStep){var c=s.onStep;c(h,l,p,u)}if(l>o){s.done=true;if(s.onDone){var f=s.onDone;f(h)}}}}};UIPath.prototype.paintSelf=function(t){if(this.isIcon||this.isInDesignMode()){UIElement.prototype.paintSelf.call(this,t);return}if(this.showPath&&!this.isStrokeColorTransparent()){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;this.pathAnimation.draw(t)}if(this.animationState===UIElement.STATE_RUNNING){this.updateObjs(t);t.needRedraw++}return};function UIPathCreator(){var t=["ui-path","ui-path",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPath;return e.initUIPath(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIPathCreator);this.Matrix2D=function(){"use strict";function t(t,e,i,n,r,o){this.setValues(t,e,i,n,r,o)}var e=t.prototype;t.DEG_TO_RAD=Math.PI/180;t.identity=null;e.setValues=function(t,e,i,n,r,o){this.a=t==null?1:t;this.b=e||0;this.c=i||0;this.d=n==null?1:n;this.tx=r||0;this.ty=o||0;return this};e.append=function(t,e,i,n,r,o){var a=this.a;var s=this.b;var h=this.c;var l=this.d;if(t!=1||e!=0||i!=0||n!=1){this.a=a*t+h*e;this.b=s*t+l*e;this.c=a*i+h*n;this.d=s*i+l*n}this.tx=a*r+h*o+this.tx;this.ty=s*r+l*o+this.ty;return this};e.prepend=function(t,e,i,n,r,o){var a=this.a;var s=this.c;var h=this.tx;this.a=t*a+i*this.b;this.b=e*a+n*this.b;this.c=t*s+i*this.d;this.d=e*s+n*this.d;this.tx=t*h+i*this.ty+r;this.ty=e*h+n*this.ty+o;return this};e.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.appendTransform=function(e,i,n,r,o,a,s,h,l){if(o%360){var u=o*t.DEG_TO_RAD;var p=Math.cos(u);var c=Math.sin(u)}else{p=1;c=0}if(a||s){a*=t.DEG_TO_RAD;s*=t.DEG_TO_RAD;this.append(Math.cos(s),Math.sin(s),-Math.sin(a),Math.cos(a),e,i);this.append(p*n,c*n,-c*r,p*r,0,0)}else{this.append(p*n,c*n,-c*r,p*r,e,i)}if(h||l){this.tx-=h*this.a+l*this.c;this.ty-=h*this.b+l*this.d}return this};e.prependTransform=function(e,i,n,r,o,a,s,h,l){if(o%360){var u=o*t.DEG_TO_RAD;var p=Math.cos(u);var c=Math.sin(u)}else{p=1;c=0}if(h||l){this.tx-=h;this.ty-=l}if(a||s){a*=t.DEG_TO_RAD;s*=t.DEG_TO_RAD;this.prepend(p*n,c*n,-c*r,p*r,0,0);this.prepend(Math.cos(s),Math.sin(s),-Math.sin(a),Math.cos(a),e,i)}else{this.prepend(p*n,c*n,-c*r,p*r,e,i)}return this};e.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;var r=this.b;this.a=n*e+this.c*i;this.b=r*e+this.d*i;this.c=-n*i+this.c*e;this.d=-r*i+this.d*e;return this};e.skew=function(e,i){e=e*t.DEG_TO_RAD;i=i*t.DEG_TO_RAD;this.append(Math.cos(i),Math.sin(i),-Math.sin(e),Math.cos(e),0,0);return this};e.scale=function(t,e){this.a*=t;this.b*=t;this.c*=e;this.d*=e;return this};e.translate=function(t,e){this.tx+=this.a*t+this.c*e;this.ty+=this.b*t+this.d*e;return this};e.identity=function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this};e.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var o=t*n-e*i;this.a=n/o;this.b=-e/o;this.c=-i/o;this.d=t/o;this.tx=(i*this.ty-n*r)/o;this.ty=-(t*this.ty-e*r)/o;return this};e.isIdentity=function(){return this.tx===0&&this.ty===0&&this.a===1&&this.b===0&&this.c===0&&this.d===1};e.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d};e.transformPoint=function(t,e,i){i=i||{};i.x=t*this.a+e*this.c+this.tx;i.y=t*this.b+e*this.d+this.ty;return i};e.decompose=function(e){if(e==null){e={}}e.x=this.tx;e.y=this.ty;e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b);e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d);var n=Math.atan2(this.b,this.a);var r=Math.abs(1-i/n);if(r<1e-5){e.rotation=n/t.DEG_TO_RAD;if(this.a<0&&this.d>=0){e.rotation+=e.rotation<=0?180:-180}e.skewX=e.skewY=0}else{e.skewX=i/t.DEG_TO_RAD;e.skewY=n/t.DEG_TO_RAD}return e};e.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)};e.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"};t.identity=new t;return t}();function loadDragonBoneArmature(t,e,i,n){var r=new Image;r.onload=function(){httpGetJSON(t,function(i){var o=i;if(!i){console.log("Get Json Failed:"+t);return}httpGetJSON(e,function(t){if(!t){console.log("Get Json Failed:"+e);return}var i=t;var a=new dragonBones.factorys.GeneralFactory;a.addSkeletonData(dragonBones.objects.DataParser.parseSkeletonData(i));a.addTextureAtlas(new dragonBones.textures.GeneralTextureAtlas(r,o));for(var s=0;s<i.armature.length;s++){var h=i.armature[s].name;var l=a.buildArmature(h);if(s===0){n(l)}}})})};r.src=i;return}function onArmatureCreated(t){var e=document.getElementById("canvas");var i=e.getContext("2d");t.setPosition(300,300);function n(){i.clearRect(0,0,e.width,e.height);dragonBones.animation.WorldClock.clock.advanceTime(1/60);t.draw(i);setTimeout(n,16)}function r(){do{var e=Math.floor(Math.random()*t.animation.animationNameList.length);var i=t.animation.animationNameList[e]}while(i==t.animation.getLastAnimationName());t.animation.gotoAndPlay(i)}e.onclick=r;dragonBones.animation.WorldClock.clock.add(t);r();n();return}function UIScene(){return}UIScene.prototype=new UINormalWindow;UIScene.prototype.isUIScene=true;UIScene.prototype.saveProps=["enablePhysics","showFPS","maxFPSMode","fps","gravityX","gravityY","pixelsPerMeter","virtualWidth","virtualHeight","xOffset","yOffset","openAnimationDuration","closeAnimationDuration","animHint","windowType","refLinesV","refLinesH","sceneId"];UIScene.prototype.canRectSelectable=function(){return this.virtualHeight<=this.h&&this.virtualWidth<=this.w};UIScene.prototype.initUIScene=function(t,e,i,n){this.initUIWindow(t,0,0,e,i,n);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.xOffset=0;this.yOffset=0;this.virtualWidth=0;this.virtualHeight=0;this.autoClearForce=true;this.setAnimHint("none");this.setCanRectSelectable(false,true);this.addEventNames(["onPointerDown","onPointerMove","onPointerUp","onDoubleClick","onMultiTouch"]);this.addEventNames(["onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown"]);this.setImage(UIElement.IMAGE_TIPS1,null);this.setImage(UIElement.IMAGE_TIPS2,null);this.setImage(UIElement.IMAGE_TIPS3,null);this.setImage(UIElement.IMAGE_TIPS4,null);this.setImage(UIElement.IMAGE_TIPS5,null);this.setCameraFollowParams(.5,.5,.5,.5);this.velocityTracker=new VelocityTracker;return this};UIScene.prototype.resetGame=function(){UIElement.logWarning("This API is removed, don't call it anymore! call win.replay() instead. (don't call it in open/beforeopen event.)");return};UIScene.prototype.addStickyChild=function(t){if(t.parentShape!==this||t.left>=this.w||t.top>=this.h){console.log("%cWarning: invalid params to addStickyChild.","color: red; font-weight: bold");return this}t.orgX=t.left;t.orgY=t.top;this.stickyChildren.push(t);return this};UIScene.prototype.removeStickyChild=function(t){this.stickyChildren.remove(t);return this};UIScene.prototype.updateStickyChildren=function(){this.stickyChildren=[];var t=this.children;for(var e=0;e<t.length;e++){var i=t[e];if(i.sticky){if(i.orgX===undefined){i.orgX=i.left}if(i.orgY===undefined){i.orgY=i.top}this.stickyChildren.push(i)}}return this};UIScene.prototype.setEnablePhysics=function(t){this.enablePhysics=t;return this};UIScene.prototype.startPhysics=function(){if(this.enablePhysics){Physics.createWorld(this);if(this.world){if(this.map){this.map.createBodies(this.world)}}else{console.log("create world failed.")}}return this};UIScene.prototype.doInit=function(){this.xOffset=0;this.yOffset=0;this.setTimeScale(1);this.startPhysics();if(this.gameName){document.title=this.gameName}return};UIScene.prototype.onOpen=function(t){this.doInit();this.play();return};UIScene.prototype.onInit=function(){var t=this;this.initStageOne();this.updateStickyChildren();return};UIScene.prototype.onDeinit=function(){if(this.world){var t=this.world;Physics.destroyWorld(t);this.world=null}this.stop();return};UIScene.prototype.getVirtualWidth=function(){if(this.virtualWidth<this.w){return this.w}return this.virtualWidth};UIScene.prototype.getVirtualHeight=function(){if(this.virtualHeight<this.h){return this.h}return this.virtualHeight};UIScene.prototype.onScrolled=function(){var t=this.stickyChildren;if(t&&t.length){var e=this.xOffset;var i=this.yOffset;for(var n=0;n<t.length;n++){var r=t[n];var o=r.orgX+e;var a=r.orgY+i;r.setLeftTop(o,a);if(r.isUIBody){r.onPositionChanged()}}}return};UIScene.prototype.setOffsetDelta=function(t,e){return this.setOffset(this.xOffset+t,this.yOffset+e)};UIScene.prototype.setOffset=function(t,e){if(t||t===0){var i=this.getVirtualWidth()-this.w;var n=Math.max(0,t);if(n>i){n=i}this.xOffset=n>>0}if(e||e===0){var i=this.getVirtualHeight()-this.h;var r=Math.max(0,e);if(r>i){r=i}this.yOffset=r>>0}this.onScrolled();return this};UIScene.prototype.setOffsetPercent=function(t,e){var i=(this.virtualWidth-this.w)*(t/100);var n=(this.virtualHeight-this.h)*(e/100);return this.setOffset(i,n)};UIScene.prototype.getRelayoutWidth=function(){return this.getWidth()};UIScene.prototype.getRelayoutHeight=function(){return this.getHeight()};UIScene.prototype.defaultPaintChildren=function(t){var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=e[n];r.paintSelf(t)}return};UIScene.prototype.setMap=function(t){this.map=t;if(t){var e=t.getMapWidth();var i=t.getMapHeight();if(e>this.w){this.virtualWidth=e}if(i>this.h){this.virtualHeight=i}this.setOffset(0,0)}return this};UIScene.prototype.getMap=function(){return this.map};UIScene.prototype.drawBgImageTile=function(t,e,i){var n=i.w;var r=i.h;var o=0;var a=0;var s=this.w;var h=this.h;var l=s;var u=h;var p=i.x+this.xOffset%i.w;var c=i.y+this.yOffset%i.h;var f=p;var d=c;var I=i.x+i.w-p;var g=i.y+i.h-c;while(a<u){f=p;I=i.w-p;g=Math.min(g,Math.min(u-a,r));while(o<l){I=Math.min(I,Math.min(l-o,n));t.drawImage(e,f,d,I,g,o,a,I,g);o+=I;f=i.x;I=i.w}o=0;a+=g;g=i.h;d=i.y}};UIScene.prototype.drawBgImage=function(t){if(this.map){var e=this.xOffset;var i=this.yOffset;var n={x:e,y:i,w:this.w,h:this.h};t.translate(-e,-i);this.map.draw(t,n);t.translate(e,i);return}var r=this.getBgImage();if(r&&r.getImage()){var o=r.getImage();var a=r.getImageRect();var s=this.images.display;if(s===UIElement.IMAGE_DISPLAY_TILE_V){this.drawBgImageVTile(t,o,a)}else if(s===UIElement.IMAGE_DISPLAY_TILE_H){this.drawBgImageHTile(t,o,a)}else if(s===UIElement.IMAGE_DISPLAY_TILE){this.drawBgImageTile(t,o,a)}else{this.drawImageAt(t,o,s,0,0,this.w,this.h,a)}return}};UIScene.prototype.drawBgImageVTile=function(t,e,i){var n=this.w;var r=this.h;var o=i.w;var a=i.h;var s=n/o;var h=0;var l=i.x;var u=i.y+this.yOffset%a;var p=Math.min(i.y+a-u,r/s);for(var h=0;h<r;){var c=p*s;t.drawImage(e,l,u,o,p,0,h,n,c);h+=c;p=Math.min(a,(r-h)/s);u=i.y}};UIScene.prototype.drawBgImageHTile=function(t,e,i){var n=this.w;var r=this.h;var o=i.w;var a=i.h;var s=r/a;var h=0;var l=i.y;var u=i.x+this.xOffset%o;var p=Math.min(o-u,n/s);for(var h=0;h<n;){var c=p*s;t.drawImage(e,u,l,p,a,h,0,c,r);h+=c;p=Math.min(o,(n-h)/s);u=i.x}return};UIScene.prototype.afterPaintChildren=function(t){if(!this.isInDesignMode()){this.drawTipsImage(t)}if(!this.selected||!this.isInDesignMode()){return}var e=10;var i=this.w;var n=this.h;var r="";var o=i>>1;var a=this.getVirtualWidth();var s=this.getVirtualHeight();if(this.xOffset){r="XOffset:"+this.xOffset}if(this.yOffset){r+=" YOffset:"+this.yOffset}if(r){t.font="16pt Sans";t.textBaseline="top";t.textAlign="center";t.fillStyle="#202020";t.fillText(r,o,e)}if(!this.pointerDown){return}if(a===i&&s===n){return}var h=20;var l=t.globalAlpha;t.fillStyle=this.style.lineColor;if(a>i){var e=n-h;var u=i*(i/a);var o=i*(this.xOffset/a);t.globalAlpha=.2;t.fillRect(0,e,i,h);t.globalAlpha=.5;t.fillRect(o,e,u,h)}if(s>n){var o=i-h;var p=n*(n/s);var e=n*(this.yOffset/s);t.globalAlpha=.2;t.fillRect(o,0,h,n);t.globalAlpha=.5;t.fillRect(o,e,h,p)}t.globalAlpha=l;return};UIScene.prototype.paintFPS=function(t){var e=Math.floor(Date.now()/1e3);if(!this.lastSeconds){this.fps=0;this.drawCount=0;this.lastSeconds=e}this.drawCount++;if(e>this.lastSeconds){this.fps=this.drawCount;this.drawCount=0;this.lastSeconds=e}var i=30;var n=60;var r=this.fps;t.save();t.beginPath();t.rect(0,0,n,i);t.fillStyle="Black";t.fill();t.textAlign="center";t.textBaseline="middle";t.font="20px Sans";t.fillStyle="White";t.fillText(r,n>>1,i>>1);t.restore()};UIScene.prototype.paintSelf=function(t){this.stepAnimation(t);UIWindow.prototype.paintSelf.call(this,t);if(this.world&&this.debugBox2d){this.world.DrawDebugData()}if(t.setShowFPS){t.setShowFPS(this.showFPS)}else if(this.showFPS&&!this.isInDesignMode()){this.paintFPS(t)}return};UIScene.prototype.paintChildren=function(t){var e=this.xOffset;var i=this.yOffset;if(!e&&!i){this.defaultPaintChildren(t)}else{t.save();t.translate(-e,-i);this.defaultPaintChildren(t);t.restore()}return};UIScene.prototype.setTipsImage=function(t,e){this.tipsImageIndex=t;this.tipsImageDisplay=e;return this};UIScene.prototype.drawTipsImage=function(t){if(!this.tipsImageIndex){return}var e="tips_img_"+this.tipsImageIndex;var i=this.images[e];if(i){var n=i.getImage();if(n){var r=i.getImageRect();var o=this.tipsImageDisplay;if(!o&&o!==0){o=this.w<this.h?UIElement.IMAGE_DISPLAY_FIT_WIDTH:UIElement.IMAGE_DISPLAY_FIT_HEIGHT}this.drawImageAt(t,n,o,0,0,this.w,this.h,r)}}return};UIScene.prototype.stepAnimation=function(t){var e=this.animatingInfo;if(!e){return}var i=this.xOffset;var n=this.yOffset;var r=Math.min((t.now-e.startTime)/e.duration,1);var o=e.interpolator.get(r);console.log("stepAnimation:"+r+" "+o);if(e.xRange){i=e.xStart+o*e.xRange}if(e.yRange){n=e.yStart+o*e.yRange}if(r>=1){this.animatingInfo=null}this.setOffset(i,n);t.needRedraw++};UIScene.prototype.onPointerMoveEditing=function(t,e){if(!this.pointerDown||e||this.targetShape){return}return this.onPointerMoveCommon(t)};UIScene.prototype.onPointerMoveCommon=function(t){var e=this.getVirtualWidth();var i=this.getVirtualHeight();if(e===this.w&&i===this.h){return}var n=this.getMoveDeltaX();var r=this.getMoveDeltaY();if(e===this.w){n=0}if(i===this.h){r=0}this.setOffsetDelta(-n,-r);return};UIScene.prototype.fixChildSize=function(t){return};UIScene.prototype.fixChildPosition=function(t){return};UIScene.prototype.afterRelayoutChild=function(t){var e=this.getVirtualWidth();var i=this.getVirtualHeight();if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=0;t.w=e}else if(t.widthAttr===UIElement.WIDTH_FILL_AVAILABLE){t.w=e-t.left}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=0;t.h=i}else if(t.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){t.h=i-t.top}return};UIScene.prototype.getWorld=function(){return this.world};UIScene.prototype.createBodyForElement=function(t){Physics.createBodyForElement(this.world,this,t)};UIScene.prototype.afterChildAppended=function(t){if(this.isInDesignMode()||!this.world){return}if(this.world.IsLocked()){console.log("world IsLocked, so create body async");setTimeout(this.createBodyForElement.bind(this,t),0)}else{this.createBodyForElement(t)}};UIScene.prototype.afterChildRemoved=function(t){if(this.map===t){this.map=null}if(this.isInDesignMode()||!this.world){return}Physics.destroyBodyForElement(this.world,t);this.postRedraw();return};UIScene.prototype.translatePoint=function(t){var e={x:t.x-this.left+this.xOffset,y:t.y-this.top+this.yOffset};return e};UIScene.prototype.isPlaying=function(){return this.playing&&!this.isInDesignMode()};UIScene.prototype.replay=function(){this.openScene(this.name,this.initData);this.play();return this};UIScene.prototype.pause=function(){this.playing=false;this.setTimeScale(0);return this};UIScene.prototype.resume=function(){this.playing=true;this.setTimeScale(1);return this};UIScene.prototype.play=function(){this.playing=true;return};UIScene.prototype.stop=function(){this.playing=false;return};UIScene.prototype.toMeter=function(t){var e=this.pixelsPerMeter?this.pixelsPerMeter:10;return t/e};UIScene.prototype.toPixel=function(t){var e=this.pixelsPerMeter?this.pixelsPerMeter:10;return t*e};UIScene.prototype.getFPS=function(){return this.fps?this.fps:30};UIScene.prototype.setFPS=function(t){this.fps=Math.max(5,Math.min(50,t));return this};UIScene.prototype.setVelocityIterations=function(t){this.velocityIterations=t;return this};UIScene.prototype.setPositionIterations=function(t){this.positionIterations=t;return this};UIScene.prototype.setAutoClearForce=function(t){this.autoClearForce=t;return this};UIScene.prototype.setCameraFollowParams=function(t,e,i,n){this.cameraFollowParams={};this.cameraFollowParams.xMin=t;this.cameraFollowParams.xMax=e;this.cameraFollowParams.yMin=i;this.cameraFollowParams.yMax=n;return this};UIScene.prototype.cameraFollow=function(t){var e=this.w;var i=this.h;var n=t.left;var r=t.top;var o=n-this.xOffset;var a=r-this.yOffset;var s=this.cameraFollowParams;var h=this.xOffset;if(o>s.xMax*e){h=Math.round(n-s.xMax*e)+(t.w>>1)}else if(o<s.xMin*e){h=Math.round(n-s.xMin*e)+(t.w>>1)}var l=this.yOffset;if(a>s.yMax*i){l=Math.round(r-s.yMax*i)+(t.h>>1)}else if(a<s.yMin*i){l=Math.round(r-s.yMin*i)+(t.h>>1)}this.setOffset(h,l);return};UIScene.prototype.prepareForOpen=function(){if(this.world){var t=this.world;Physics.destroyWorld(t);this.world=null}UIWindow.prototype.prepareForOpen.call(this)};UIScene.prototype.isCurrent=function(){var t=this.getParent();return t&&t.getCurrentFrame()===this};UIScene.prototype.onCreateRUBEBody=function(t){if(t){return Physics.createUIRubeBody(t,this.world,this)}return null};UIScene.prototype.onRUBEJointCreated=function(t){if(t){return Physics.createElementForJoint(t,this.world,this)}return null};function UISceneCreator(){var t=["ui-scene","ui-scene",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIScene;return e.initUIScene(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UISceneCreator);function UISoundMusic(){return}UISoundMusic.prototype=new UICheckBox;UISoundMusic.prototype.isUISoundMusic=true;UISoundMusic.prototype.initUISoundMusic=function(t){this.initUICheckBox(t);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISoundMusic.prototype.shapeCanBeChild=function(t){if(t.isUISoundEffects||t.isUISoundMusic){return false}return UIGroup.prototype.shapeCanBeChild.call(this,t)};UISoundMusic.prototype.setValue=function(t){if(this.isInDesignMode()){return this}this.setSoundMusicEnable(t);return this};UISoundMusic.prototype.getValue=function(t){if(this.isInDesignMode()){return true}return this.getSoundMusicEnable()};UISoundMusic.prototype.isPlaying=UISoundMusic.prototype.getValue;function UISoundMusicCreator(){var t=["ui-sound-music","ui-sound-music",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISoundMusic;return e.initUISoundMusic(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISoundMusicCreator);function UISoundEffects(){return}UISoundEffects.prototype=new UICheckBox;UISoundEffects.prototype.isUISoundEffects=true;UISoundEffects.prototype.initUISoundEffects=function(t){this.initUICheckBox(t);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISoundEffects.prototype.shapeCanBeChild=function(t){if(t.isUISoundEffects||t.isUISoundMusic){return false}return UIGroup.prototype.shapeCanBeChild.call(this,t)};UISoundEffects.prototype.setValue=function(t){if(this.isInDesignMode()){return this}this.setSoundEffectEnable(t);return this};UISoundEffects.prototype.getValue=function(t){if(this.isInDesignMode()){return true}return this.getSoundEffectEnable(t)};UISoundEffects.prototype.isPlaying=UISoundEffects.prototype.getValue;function UISoundEffectsCreator(){var t=["ui-sound-effects","ui-sound-effects",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISoundEffects;return e.initUISoundEffects(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISoundEffectsCreator);function UIStatus(){return}UIStatus.prototype=new UIElement;UIStatus.prototype.isUIStatus=true;UIStatus.prototype.saveProps=["horizonal","realValue"];UIStatus.prototype.initUIStatus=function(t,e,i){this.initUIElement(t);this.realValue=.5;this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onBecomeZero","onBecomeFull","onChanged","onUpdateTransform"]);return this};UIStatus.prototype.shapeCanBeChild=function(t){return this.children.length===0&&t.isUILabel};UIStatus.prototype.setValue=function(t){this.realValue=Math.max(0,Math.min(100,t))/100;if(this.realValue===0){
this.callOnBecomeZeroHandler()}else if(this.realValue===1){this.callOnBecomeFullHandler()}this.callOnChangedHandler(this.getValue());return this.getValue()};UIStatus.prototype.getValue=function(){return Math.round(this.realValue*100)};UIStatus.prototype.paintSelfOnly=function(t){var e=this.realValue;var i=this.roundRadius;var n=Math.round(e*this.h);var r=Math.round((1-e)*this.h);var o=Math.round(e*this.w);var a=Math.round((1-e)*this.w);t.save();t.beginPath();drawRoundRect(t,this.w,this.h,i);t.clip();if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.beginPath();if(this.horizonal){t.translate(o,0);t.rect(0,0,a,this.h);t.translate(-o,0)}else{t.rect(0,0,this.w,r)}t.fill()}if(!this.isTextColorTransparent()){t.fillStyle=this.style.textColor;t.beginPath();if(this.horizonal){t.rect(0,0,o,this.h)}else{t.translate(0,r);t.rect(0,0,this.w,n);t.translate(0,-r)}t.fill()}t.restore();if(!this.isStrokeColorTransparent()&&this.style.lineWidth){t.beginPath();t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;drawRoundRect(t,this.w,this.h,i,RoundRect.BL|RoundRect.BR|RoundRect.TL|RoundRect.TR);t.stroke()}t.beginPath();return};function UIStatusCreator(){var t=["ui-status","ui-status",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIStatus;return e.initUIStatus(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIStatusCreator);function UITimer(){return}UITimer.prototype=new UIElement;UITimer.prototype.isUITimer=true;UITimer.prototype.saveProps=["times","delayStart","durationType","duration","durationMin","durationMax"];UITimer.prototype.initUITimer=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_AUTO;this.addEventNames(["onTimeout"]);return this};UITimer.prototype.shapeCanBeChild=function(t){return false};UITimer.prototype.onInit=function(){var t=this;var e=this.win;function i(){t.start();e.off("open",i)}if(this.enable){e.on("open",i);console.log("start timer.")}else{console.log("not start disable timer.")}return};UITimer.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}this.enable=t;if(t){this.start()}else{this.stop()}return};UITimer.prototype.getDuration=function(){if(this.durationType==="random"){var t=this.durationMin+Math.random()*(this.durationMax-this.durationMin);return t}else{return this.duration}};UITimer.prototype.start=function(){if(!this.enable){console.log("can not start disabled timer, please call setEnable first.")}if(this.timerID){console.log("Timer is alread started:"+this.timerID);return}var t=this;this.paused=false;this.startTime=Date.now();function e(){if(!t.enable||!t.timerID||!t.parentShape||!t.win){t.timerID=null;return}if(t.paused){t.timerID=setTimeout(e,t.getDuration());return}if(t.timeScaleIsZero()){t.timerID=setTimeout(e,t.getDuration());return}if(t.win.isVisible()){t.callOnTimeoutHandler();t.times--}if(t.times<=0){t.timerID=null;console.log("timer stop "+t.name)}else{t.timerID=setTimeout(e,t.getDuration())}}if(this.delayStart){this.timerID=setTimeout(function(){t.timerID=setTimeout(e,t.getDuration())},this.delayStart)}else{this.timerID=setTimeout(e,t.getDuration())}return this};UITimer.prototype.stop=function(){if(this.timerID){clearTimeout(this.timerID);this.timerID=null}return this};UITimer.prototype.pause=function(){this.paused=true;return this};UITimer.prototype.resume=function(){this.paused=false;return this};UITimer.prototype.getElapsedTime=function(){return Date.now()-this.startTime};function UITimerCreator(){var t=["ui-timer","ui-timer",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITimer;return e.initUITimer(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UITimerCreator);function UIDragger(){return}UIDragger.prototype=new UIElement;UIDragger.prototype.isUIDragger=true;UIDragger.prototype.saveProps=["enableVer","enableHor"];UIDragger.prototype.initUIDragger=function(t,e,i){this.initUIElement(t,e,i);this.enableVer=true;this.enableHor=true;this.addEventNames(["onDragStart","onDragging","onDragEnd"]);return this};UIDragger.prototype.onInit=function(){var t=this.getParent();var e=this.enableHor;var i=this.enableVer;var n=this;if(t.isUIPhysicsShape||t.isUIImage||t.isUISkeletonAnimation||t.isUIFrameAnimation||t.isUIScene){t.handlePointerDown=function(e,i){if(!i)return;n.callOnDragStartHandler();return UIDragger.handleSpritePointerDown(t,e)};t.handlePointerMove=function(r,o){if(!o)return;if(t.pointerDown){n.callOnDraggingHandler()}return UIDragger.handleSpritePointerMove(t,r,i,e)};t.handlePointerUp=function(e,i){if(!i)return;n.callOnDragEndHandler();return UIDragger.handleSpritePointerUp(t,e)}}};UIDragger.handleSpritePointerDown=function(t,e){if(t.isUIScene){t.saveXOffset=t.xOffset;t.saveYOffset=t.yOffset}else{t.saveX=t.left;t.saveY=t.top}return};UIDragger.handleSpritePointerUp=function(t,e){};UIDragger.handleSpritePointerMove=function(t,e,i,n){if(t.pointerDown){var r=t.getMoveAbsDeltaX();var o=t.getMoveAbsDeltaY();if(t.isUIScene){var a=n?t.saveXOffset-r:t.saveXOffset;var s=i?t.saveYOffset-o:t.saveYOffset;t.setOffset(a,s)}else{var a=n?t.saveX+r:t.saveX;var s=i?t.saveY+o:t.saveY;t.setLeftTop(a,s);t.onPositionChanged()}}return};function UIDraggerCreator(){var t=["ui-dragger","ui-dragger",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIDragger;return e.initUIDragger(this.type,20,20,null)};return}ShapeFactoryGet().addShapeCreator(new UIDraggerCreator);function UISprite(){return}UISprite.prototype=new UIImage;UISprite.prototype.isUISprite=true;UISprite.prototype.initUISprite=function(t,e,i,n){this.initUIImage(t,e,i,n);return this};function UISpriteCreator(){var t=["ui-sprite","ui-sprite",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISprite;return e.initUISprite(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UISpriteCreator);function UITransformAnimation(){return}UITransformAnimation.prototype=new UIImage;UITransformAnimation.prototype.isUITransformAnimation=true;UITransformAnimation.prototype.initUITransformAnimation=function(t,e,i,n){this.initUIImage(t,e,i,n);this.animationConfig={};this.animationConfig.opacityFrom=1;this.animationConfig.opacityTo=1;this.animationConfig.scaleXFrom=1;this.animationConfig.scaleXTo=1;this.animationConfig.scaleYFrom=1;this.animationConfig.scaleYTo=1;this.animationConfig.rotationFrom=0;this.animationConfig.rotationTo=0;this.animationConfig.offsetXFrom=0;this.animationConfig.offsetXTo=0;this.animationConfig.offsetYFrom=0;this.animationConfig.offsetYTo=0;this.animationConfig.frequency=2;this.animationConfig.random=1e3*Math.random();return this};UITransformAnimation.prototype.pause=function(){if(this.highlightConfig){this.highlightConfig.paused=true}return this};UITransformAnimation.prototype.resume=function(){if(this.highlightConfig){this.highlightConfig.paused=false}return this};UITransformAnimation.prototype.play=function(){this.setHighlightConfig(this.animationConfig);return this};UITransformAnimation.prototype.stop=function(){this.setHighlightConfig(null);return this};UITransformAnimation.prototype.getScaleXFrom=function(){return this.animationConfig.scaleXFrom};UITransformAnimation.prototype.setScaleXFrom=function(t){this.animationConfig.scaleXFrom=t;this.play();return this};UITransformAnimation.prototype.getScaleXTo=function(){return this.animationConfig.scaleXTo};UITransformAnimation.prototype.setScaleXTo=function(t){this.animationConfig.scaleXTo=t;this.play();return this};UITransformAnimation.prototype.getScaleYFrom=function(){return this.animationConfig.scaleYFrom};UITransformAnimation.prototype.setScaleYFrom=function(t){this.animationConfig.scaleYFrom=t;this.play();return this};UITransformAnimation.prototype.getScaleYTo=function(){return this.animationConfig.scaleYTo};UITransformAnimation.prototype.setScaleYTo=function(t){this.animationConfig.scaleYTo=t;this.play();return this};UITransformAnimation.RADIAN_TO_ANGLE=180/Math.PI;UITransformAnimation.prototype.getRotationFrom=function(){return this.animationConfig.rotationFrom*UITransformAnimation.RADIAN_TO_ANGLE};UITransformAnimation.prototype.setRotationFrom=function(t){this.animationConfig.rotationFrom=t/UITransformAnimation.RADIAN_TO_ANGLE;this.play();return this};UITransformAnimation.prototype.getRotationTo=function(){return this.animationConfig.rotationTo*UITransformAnimation.RADIAN_TO_ANGLE};UITransformAnimation.prototype.setRotationTo=function(t){this.animationConfig.rotationTo=t/UITransformAnimation.RADIAN_TO_ANGLE;this.play();return this};UITransformAnimation.prototype.getOpacityFrom=function(){return this.animationConfig.opacityFrom};UITransformAnimation.prototype.setOpacityFrom=function(t){this.animationConfig.opacityFrom=t;this.play();return this};UITransformAnimation.prototype.getOpacityTo=function(){return this.animationConfig.opacityTo};UITransformAnimation.prototype.setOpacityTo=function(t){this.animationConfig.opacityTo=t;this.play();return this};UITransformAnimation.prototype.getXFrom=function(){return this.animationConfig.offsetXFrom};UITransformAnimation.prototype.setXFrom=function(t){this.animationConfig.offsetXFrom=t;this.play();return this};UITransformAnimation.prototype.getXTo=function(){return this.animationConfig.offsetXTo};UITransformAnimation.prototype.setXTo=function(t){this.animationConfig.offsetXTo=t;this.play();return this};UITransformAnimation.prototype.getYFrom=function(){return this.animationConfig.offsetYFrom};UITransformAnimation.prototype.setYFrom=function(t){this.animationConfig.offsetYFrom=t;this.play();return this};UITransformAnimation.prototype.getYTo=function(){return this.animationConfig.offsetYTo};UITransformAnimation.prototype.setYTo=function(t){this.animationConfig.offsetYTo=t;this.play();return this};UITransformAnimation.prototype.getFrequency=function(){return this.animationConfig.frequency};UITransformAnimation.prototype.setFrequency=function(t){this.animationConfig.frequency=t;this.play();return this};UITransformAnimation.prototype.getRandom=function(){return this.animationConfig.random};UITransformAnimation.prototype.setRandom=function(t){this.animationConfig.random=t%1e3;this.play();return this};UITransformAnimation.prototype.doFromJson=function(t){UISprite.prototype.doFromJson.call(this,t);if(t.animationConfig){this.animationConfig=JSON.parse(JSON.stringify(t.animationConfig));this.play()}return};UITransformAnimation.prototype.doToJson=function(t){UISprite.prototype.doToJson.call(this,t);t.animationConfig=JSON.parse(JSON.stringify(this.animationConfig));return t};UITransformAnimation.prototype.beforePaintChildren=function(t){return this};UITransformAnimation.prototype.onInit=function(){this.play();return};function UITransformAnimationCreator(){var t=["ui-transform-animation","ui-transform-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITransformAnimation;return e.initUITransformAnimation(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UITransformAnimationCreator);function UISkeletonAnimation(){return}UISkeletonAnimation.prototype=new UIElement;UISkeletonAnimation.prototype.isUISkeletonAnimation=true;UISkeletonAnimation.prototype.saveProps=["enableCache","animationName","skinName","animationScaleX","animationScaleY","textureJsonURL","skeletonJsonURL","textureURL"];UISkeletonAnimation.prototype.urlProps=["textureJsonURL","skeletonJsonURL","textureURL"];UISkeletonAnimation.prototype.initUISkeletonAnimation=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setSizeLimit(50,50);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,true);this.addEventNames(["onDoubleClick","onUpdateTransform","onLoadDone"]);this.animTimeScale=1;this.animationScaleX=1;this.animationScaleY=1;this.animationNames=[];return this};UISkeletonAnimation.prototype.play=function(t,e,i,n,r,o){var a=this;if(a.loadDataDone!==true){this.initPlayArgs=[].slice.call(arguments);return}var s=Deferred();this.resume();this.doPlay(t,e,function(){if(typeof i==="function"){i.call(a)}s.resolve()},function(){if(typeof n==="function"){n.call(a)}},r,o);return s.promise};UISkeletonAnimation.prototype.setSkeletonJsonURL=function(t){this.skeletonJsonURL=t;return this};UISkeletonAnimation.prototype.getSkeletonJsonURL=function(){return this.skeletonJsonURL?this.skeletonJsonURL:""};UISkeletonAnimation.prototype.setTextureJsonURL=function(t){this.textureJsonURL=t;return this};UISkeletonAnimation.prototype.getTextureJsonURL=function(){return this.textureJsonURL?this.textureJsonURL:""};UISkeletonAnimation.prototype.setTextureURL=function(t){this.textureURL=t;return this};UISkeletonAnimation.prototype.getTextureURL=function(){return this.textureURL?this.textureURL:""};UISkeletonAnimation.prototype.loadSheletonData=function(t,e,i,n){var r=this;ResLoader.loadImage(i,function(i){var r=ResLoader.loadJson;if(t.indexOf(".atlas")>0){r=ResLoader.loadData}r(t,function(r){var o=r;if(!r){console.log("Get Json Failed:"+t);return}ResLoader.loadJson(e,function(t){if(!t){console.log("Get Json Failed:"+e);return}var r=t;n(i,o,r)})})});return};UISkeletonAnimation.prototype.createSkelentonAnimation=function(t){var e=this;this.destroyArmature();function i(i,n,r){e.createArmature(i,n,r);var o=e.getAnimationName();if(e.skinName){e.setSkin(e.skinName)}e.loadDataDone=true;if(e.initPlayArgs){e.play.apply(e,e.initPlayArgs);e.initPlayArgs=null}else{e.play(o)}e.callOnLoadDoneHandler();if(t){t()}}e.loadDataDone=false;this.loadSheletonData(this.textureJsonURL,this.skeletonJsonURL,this.textureURL,i);return};UISkeletonAnimation.prototype.onFromJsonDone=function(t){if(this.textureURL&&this.textureJsonURL&&this.skeletonJsonURL){function e(t,e,i){console.log("skeleton preload data done.")}this.loadSheletonData(this.textureJsonURL,this.skeletonJsonURL,this.textureURL,e)}if(t&&t.animationScale){if(!t.animationScaleX){this.animationScaleX=t.animationScale}if(!t.animationScaleY){this.animationScaleY=t.animationScale}delete this.animationScale}return};UISkeletonAnimation.prototype.onInit=function(){this.reload();return};UISkeletonAnimation.prototype.reload=function(t){if(this.textureURL&&this.textureJsonURL&&this.skeletonJsonURL){this.createSkelentonAnimation(t)}return this};UISkeletonAnimation.prototype.destroy=function(){this.destroyArmature();Shape.prototype.destroy.call(this);return};UISkeletonAnimation.prototype.callOnLoadDoneHandler=function(){if(this.isInDesignMode()){return}if(!this.handleOnLoadDone){var sourceCode=this.events["onLoadDone"];if(sourceCode){sourceCode="this.handleOnLoadDone = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnLoadDone){try{this.handleOnLoadDone()}catch(e){console.log("this.handleOnLoadDone:"+e.message)}}return true};UISkeletonAnimation.prototype.destroyArmature=function(){};UISkeletonAnimation.prototype.pause=function(){return this};UISkeletonAnimation.prototype.resume=function(){return this};UISkeletonAnimation.prototype.getAnimationDuration=function(t){};UISkeletonAnimation.prototype.getAnimationNames=function(){return this.animationNames};UISkeletonAnimation.prototype.setAnimationName=function(t){this.animationName=t;return this};UISkeletonAnimation.prototype.getAnimationName=function(){if(this.animationName)return this.animationName;var t=this.getAnimationNames();return t?t[0]:""};UISkeletonAnimation.prototype.setScale=function(t){this.animationScaleX=t;this.animationScaleY=t;return this};UISkeletonAnimation.prototype.getScale=function(){return this.animationScaleX};UISkeletonAnimation.prototype.setScaleX=function(t){this.animationScaleX=t;return this};UISkeletonAnimation.prototype.setScaleY=function(t){this.animationScaleY=t;return this};UISkeletonAnimation.prototype.getScaleX=function(t){return this.animationScaleX};UISkeletonAnimation.prototype.getScaleY=function(t){return this.animationScaleY};UISkeletonAnimation.prototype.applyScale=function(t){};UISkeletonAnimation.prototype.setTimeScale=function(t){this.animTimeScale=t;return this};UISkeletonAnimation.prototype.setDuration=function(t){};UISkeletonAnimation.prototype.preprocessTextureAtlas=function(t){return t};UISkeletonAnimation.prototype.setSkin=function(t){this.skinName=t;return this};UISkeletonAnimation.prototype.getSkin=function(){return this.skinName};UISkeletonAnimation.prototype.getSkins=function(){return["default"]};UISkeletonAnimation.prototype.isPaused=function(){return this.timeScaleIsZero()};UISkeletonAnimation.prototype.shapeCanBeChild=UISprite.prototype.shapeCanBeChild;function UIBitmapFontText(){return}UIBitmapFontText.prototype=new UIElement;UIBitmapFontText.prototype.isUIBitmapFontText=true;UIBitmapFontText.prototype.saveProps=["allText","textAlignment","imageRows","imageColumns"];UIBitmapFontText.prototype.initUIBitmapFontText=function(t,e,i){this.initUIElement(t);this.text="";this.textAlignment="center";this.setMargin(5,5);this.setDefSize(e,i);this.setSizeLimit(10,10);this.setTextType(Shape.TEXT_NONE);this.addEventNames(["onUpdateTransform"]);this.setImage(UIElement.IMAGE_NORMAL_FG,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);return this};UIBitmapFontText.prototype.getDefaultImageType=function(){return UIElement.IMAGE_NORMAL_FG};UIBitmapFontText.prototype.shapeCanBeChild=function(t){return false};UIBitmapFontText.prototype.setImageWithRowCols=function(t,e,i){this.imageRows=e;this.imageColumns=i;this.setImage(UIElement.IMAGE_NORMAL_FG,t);return};UIBitmapFontText.prototype.getRectOfChar=function(t,e,i){if(this.allText){var n=this.allText.length;var r=this.allText.indexOf(i);if(r>=0){var o=e.trimmed?e.rw:e.w;var a=e.trimmed?e.rh:e.h;var s=this.imageRows?this.imageRows:a>o?n:1;var h=this.imageColumns?this.imageColumns:o>a?n:1;var l=Math.round(o/h);var u=Math.round(a/s);var p=Math.floor(r/h);var i=r%h;var c={};c.w=l;c.h=u;c.x=l*i+e.x;c.y=u*p+e.y;if(r===0){c.w=c.w-(e.ox||0);c.h=c.h-(e.oy||0)}else{c.x=c.x-(e.ox||0);c.y=c.y-(e.oy||0)}return c}}return null};UIBitmapFontText.prototype.setAllText=function(t){this.allText=t;return this};UIBitmapFontText.prototype.getAllText=function(){return this.allText};UIBitmapFontText.prototype.getBgImage=function(){var t=null;if(this.pointerDown&&!this.isClicked()){t=this.images.active_bg}else{t=this.images.normal_bg}if(!t||!t.getImage()){t=this.images.default_bg}if(!t||!t.getImage()){return}return t};UIBitmapFontText.prototype.drawFgImage=function(t){var e=this.text;var i=this.getImageByType(UIElement.IMAGE_NORMAL_FG);if(!e||!i){return}var n=i.getImage();var r=i.getImageRect();if(!n){return}var o=0;var a=this.h;var s=15;for(var h=0;h<e.length;h++){var l=e[h];var u=this.getRectOfChar(n,r,l);if(u){o+=u.w;if(u.h>s){s=u.h}}}var p=0;var c=0;var f=0;var d=this.h>>1;var I=Math.min(this.h/s,this.w/o);switch(this.textAlignment){case"right":{c=this.w-this.hMargin-o;f=c+o;break}case"center":{c=this.w-o>>1;f=this.w>>1;break}default:{c=this.hMargin;f=c;break}}if(I!=1){t.translate(f,d);t.scale(I,I);t.translate(-f,-d)}for(var h=0;h<e.length;h++){var l=e[h];var u=this.getRectOfChar(n,r,l);if(u){p=a-u.h>>1;t.drawImage(n,u.x,u.y,u.w,u.h,c,p,u.w,u.h);c+=u.w}}return};function UIBitmapFontTextCreator(){var t=["ui-bitmap-font-text","ui-bitmap-font-text",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBitmapFontText;return e.initUIBitmapFontText(this.type,400,100)};return}ShapeFactoryGet().addShapeCreator(new UIBitmapFontTextCreator);function UIBitmapFontTextX(){return}UIBitmapFontTextX.prototype=new UIElement;UIBitmapFontTextX.prototype.isUIBitmapFontTextX=true;UIBitmapFontTextX.prototype.saveProps=["spacer"];UIBitmapFontTextX.prototype.initUIBitmapFontTextX=function(t){this.spacer=0;this.initUIElement(t);this.textAlignment="center";this.addEventNames(["onUpdateTransform"]);return this};UIBitmapFontTextX.prototype.getCharDesc=function(t){if(this.bitmapFont){return this.bitmapFont.getCharDesc(t)}else{if(!this.charsDesc){this.charsDesc={}}var e=this.charsDesc[t];var i=this.getImageByType(t);if(!e&&i){var n=i.getImageRect();if(n&&n.w){this.charsDesc[t]={};e=this.charsDesc[t];e.x=n.x;e.y=n.y;e.w=n.w;e.h=n.h;e.image=i}}return e}};UIBitmapFontTextX.prototype.parseFont=function(t,e){var i=e.dirname();this.bitmapFont=new BitmapFont;this.bitmapFont.parse(t);var n=this.bitmapFont.getPagesDesc();for(var r in n){var o=n[r];var a=i+"/"+o.file;this.setImage("page"+o.id,a)}var s=this.bitmapFont.getCharsDesc();for(var h in s){var l=s[h];l.image=this.getImageByType("page"+l.page)}return};UIBitmapFontTextX.prototype.parseJson=function(t,e){var i=t.frames;var n=e.dirname()+"/"+t.meta.image;for(var r in i){var o=r.replace(".png","");if(o.length===1){this.setImage(o,e+"#"+r)}}return};UIBitmapFontTextX.prototype.setDataURL=function(t){this.images={};this.images.display=0;this.dataURL=t;if(t){if(t.endWith(".fnt")){ResLoader.loadData(t,function(e){this.parseFont(e,t)}.bind(this))}else if(t.endWith(".json")){ResLoader.loadJson(t,function(e){this.parseJson(e,t)}.bind(this))}else{console.log("not supported:"+t)}}return this};UIBitmapFontTextX.prototype.setSpacer=function(t){this.spacer=t;return this};UIBitmapFontTextX.prototype.getDataURL=function(){return this.dataURL};UIBitmapFontTextX.prototype.measureText=function(){var t=0;var e=10;var i=this.text;var n=this.spacer;for(var r=0;r<i.length;r++){var o=this.getCharDesc(i[r]);if(o){var a=o.rw||o.w;var s=o.rh||o.h+(o.oy||0);t+=a;if(e<s){e=s}if(r){t+=n}}}return{w:t,h:e}};UIBitmapFontTextX.prototype.onFromJsonDone=function(){this.setDataURL(this.dataURL)};UIBitmapFontTextX.prototype.drawText=function(t){var e=this.text;if(!e){return}var i=0;var n=0;var r=0;var o=this.h;var a=this.w;var s=o>>1;var h=this.spacer;var l=this.hMargin;var u=this.measureText();if(u.w<1||u.h<1){return}var p=Math.min(o/u.h,a/u.w);switch(this.textAlignment){case"right":{n=a-l-u.w;r=n+u.w;break}case"center":{n=a-u.w>>1;r=a>>1;break}default:{n=l;r=n;break}}t.save();if(p!==1){t.translate(r,s);t.scale(p,p);t.translate(-r,-s)}var c=0;var f=0;var d=o-u.h>>1;for(var I=0;I<e.length;I++){var g=e[I];var m=this.getCharDesc(g);if(m&&m.image){var v=m;var y=m.image.getImage();if(y){c=n+(v.ox||0);f=d+(v.oy||0);t.drawImage(y,v.x,v.y,v.w,v.h,c,f,v.w,v.h);n+=v.rw||v.w;n+=h}}}t.restore();return};function UIBitmapFontTextXCreator(){var t=["ui-bitmap-font-text-x","ui-bitmap-font-text-x",null,true];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBitmapFontTextX;return e.initUIBitmapFontTextX(this.type,400,100)};return}ShapeFactoryGet().addShapeCreator(new UIBitmapFontTextXCreator);function UIFrameAnimation(){return}UIFrameAnimation.prototype=new UIElement;UIFrameAnimation.prototype.isUIFrameAnimation=true;UIFrameAnimation.prototype.saveProps=["autoPlay","frameRate","autoPlayDelay","defaultGroupName"];UIFrameAnimation.prototype.initUIFrameAnimation=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.current=0;this.frameRate=10;this.playing=false;this.autoPlay=true;this.repeatTimes=4294967295;this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.frames=[];this.addEventNames(["onDoubleClick","onUpdateTransform"]);return this};UIFrameAnimation.prototype.syncImageFrames=function(){this.frames=[];for(var t in this.images){var e=this.images[t];if(t.indexOf("option_image_")>=0&&e){this.frames.push(e)}}return};UIFrameAnimation.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);if(this.groups){t.groups=JSON.parse(JSON.stringify(this.groups))}return t};UIFrameAnimation.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.playing=false;this.syncImageFrames();if(t.groups){this.groups=t.groups}else if(t.groupsData){this.groups=this.parseGroupsData(t.groupsData);this.groupsData=null}return t};UIFrameAnimation.prototype.afterChildAppended=function(t){t.xAttr=UIElement.X_CENTER_IN_PARENT;t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return};UIFrameAnimation.prototype.setAutoPlay=function(t){this.autoPlay=t;return this};UIFrameAnimation.prototype.resume=function(){this.playing=true;return this};UIFrameAnimation.prototype.pause=function(){this.playing=false;return this};UIFrameAnimation.prototype.stop=function(){this.playing=false;return this};UIFrameAnimation.prototype.playSequence=function(t,e,i,n){this.deferred=Deferred();var r=this.frames.length;if(!r||!t||!t.length){return}this.current=0;this.playing=true;this.onDone=i;this.onOneCycle=n;this.runningSequence=t;this.nextUpdateTime=Date.now()+this.getDuration();this.repeatTimes=e?e:4294967295;return this.deferred.promise};UIFrameAnimation.prototype.playRange=function(t,e,i,n,r){var o=this.frames.length;if(t>e){var a=t;t=e;e=a}var s=[];for(var h=t;h<=e;h++){s.push(h)}return this.playSequence(s,i,n,r)};UIFrameAnimation.prototype.gotoAndPlayByName=function(t,e,i,n){var r=this.getGroupRange(t);if(r.start!==undefined&&r.end!==undefined){return this.gotoAndPlay(r.start,r.end,e,i,n)}else if(r&&r.length){return this.playSequence(r,e,i,n)}else if(this.animations&&t){return this.animate(t)}};UIFrameAnimation.prototype.play=UIFrameAnimation.prototype.gotoAndPlayByName;UIFrameAnimation.prototype.gotoAndPlay=UIFrameAnimation.prototype.playRange;UIFrameAnimation.prototype.nextFrame=function(){if(!this.frames||!this.frames.length||!this.runningSequence||!this.runningSequence.length){return}var t=this.current+1;var e=this.runningSequence.length;if(t===e){if(this.onOneCycle){try{this.onOneCycle(this)}catch(i){console.log("onOneCycle: "+i.message)}}this.repeatTimes--;if(this.repeatTimes<=0){this.playing=false;if(this.onDone){try{this.onDone(this)}catch(i){console.log("onDone: "+i.message)}}if(this.deferred){this.deferred.resolve()}return}}this.current=t%e;return};UIFrameAnimation.prototype.getCurrentImage=function(){if(!this.frames||!this.frames.length){return null}if(!this.runningSequence||!this.runningSequence.length){return this.frames[0]}if(this.current>=this.runningSequence.length){this.current=0}var t=this.runningSequence[this.current];return this.frames[t]};UIFrameAnimation.prototype.getGroupRange=function(t){var e=null;if(this.groups&&t){e=this.groups[t]}if(!e){e={start:0,end:this.frames.length-1}}return e};UIFrameAnimation.prototype.getImages=function(){var t="";for(var e in this.images){var i=this.images[e];if(e.indexOf("option_image_")>=0&&i&&i.src){t+=i.src.toRelativeURL()+"\n"}}return t};UIFrameAnimation.prototype.setImages=function(t){var e=this.images.display;this.images={};this.images.display=e;if(t){var i=0;var n=0;var r=t.split("\n");for(var i=0;i<r.length;i++){var o=r[i];if(!o)continue;if(o.indexOf("/")===0){o=o.substr(1)}var a="option_image_"+n++;this.setImage(a,o)}}this.syncImageFrames();return this};UIFrameAnimation.prototype.getValue=function(){return this.current};UIFrameAnimation.prototype.setValue=function(t){this.current=Math.min(t,this.frames.length);return this};UIFrameAnimation.prototype.startAutoPlay=function(){if(this.defaultGroupName){this.play(this.defaultGroupName,268435455)}else{this.gotoAndPlay(0,this.frames.length-1,268435455)}return};UIFrameAnimation.prototype.onInit=function(){this.syncImageFrames();if(this.autoPlay&&this.frames&&this.frames.length){this.startAutoPlay();if(this.autoPlayDelay){this.nextUpdateTime+=this.autoPlayDelay}}return};UIFrameAnimation.prototype.paintSelf=function(t){if(this.playing&&this.isVisible()){var e=this.getDuration();var i=t.now+e;if(t.now>this.nextUpdateTime){this.nextFrame();this.nextUpdateTime=i}else{this.nextUpdateTime=Math.min(this.nextUpdateTime,i)}t.needRedraw++}return UIElement.prototype.paintSelf.call(this,t)};UIFrameAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIFrameAnimation.prototype.setFrameRate=function(t){this.frameRate=Math.max(1,Math.min(t,30));return this};UIFrameAnimation.prototype.getDuration=function(){if(this.isInDesignMode()&&this.disablePreview){return 16777215}if(this.timeScaleIsZero()){return 16777215}else{return 1e3/this.frameRate/this.getTimeScale()}};UIFrameAnimation.prototype.shapeCanBeChild=UISprite.prototype.shapeCanBeChild;UIFrameAnimation.prototype.drawImage=function(t){var e=this.getCurrentImage();if(e){var i=e.getImageRect();var n=e.getImage();if(n){this.drawImageAt(t,n,this.images.display,0,0,this.w,this.h,i)}}return};function UIFrameAnimationCreator(){var t=["ui-frame-animation","ui-frame-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFrameAnimation;return e.initUIFrameAnimation(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIFrameAnimationCreator);function UIShaker(){return}UIShaker.prototype=new UIImage;UIShaker.prototype.isUIShaker=true;UIShaker.prototype.saveProps=["amplitudeX","amplitudeY","times","duration","amplitudeModifier"];UIShaker.prototype.initUIShaker=function(t,e,i){this.initUIImage(t,e,i);return this};UIShaker.prototype.setAmplitudeX=function(t){this.amplitudeX=t;return this};UIShaker.prototype.setAmplitudeY=function(t){this.amplitudeY=t;return this};UIShaker.prototype.setDuration=function(t){this.duration=t;return this};UIShaker.prototype.setTimes=function(t){this.times=t;return this};UIShaker.prototype.setAmplitudeModifier=function(t){this.amplitudeModifier=t;return this};UIShaker.prototype.getAmplitudeX=function(){return this.amplitudeX};UIShaker.prototype.getAmplitudeY=function(){return this.amplitudeY};UIShaker.prototype.getDuration=function(){return this.duration};UIShaker.prototype.getTimes=function(){return this.times};UIShaker.prototype.getAmplitudeModifier=function(){return this.amplitudeModifier};UIShaker.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}if(!t){this.enable=t;return this}var i=this;var n=this.amplitudeX?this.amplitudeX:0;var r=this.amplitudeY?this.amplitudeY:0;var o=this.times?this.times:1;var a=this.duration?this.duration:200;var s=Date.now();var h=e.paintSelf;var l=o*2*Math.PI;var u=this.amplitudeModifier;e.paintSelf=function(t){var o=Date.now()-s;if(o<a){var p=1;var c=o/a;var f=l*c;var d=n*Math.cos(f);var I=r*Math.sin(f);if(u==="i"){p=c}else if(u==="d"){p=1-c}else if(u==="i->d"){p=2*(c<.5?c:1-c)}d*=p;I*=p;t.translate(d,I)}else{e.paintSelf=h;i.enable=false}h.call(e,t)};return this};function UIShakerCreator(){var t=["ui-shaker","ui-shaker",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIShaker;return e.initUIShaker(this.type,80,80)};return}ShapeFactoryGet().addShapeCreator(new UIShakerCreator);function UISettings(){return}UISettings.prototype=new UIElement;UISettings.prototype.isUISettings=true;UISettings.prototype.initUISettings=function(t,e,i){this.initUIElement(t);this.setSize(e,i);this.settingsDef={};return this};UISettings.prototype.getSettingObj=function(t){var e=this.settingsDef[t];if(e&&e.isGlobal){return this.getWindowManager()}else{return this.getWindow()}};UISettings.prototype.getSetting=function(t){var e=this.getSettingObj(t);var i=e.settings[t];if(i===undefined){var n=this.settingsDef[t];if(n){i=n.defVal}}return i};UISettings.prototype.setSetting=function(t,e){var i=this.getSettingObj(t);i.settings[t]=e;return this};UISettings.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.settingsDef=t.settingsDef;return this};UISettings.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.settingsDef=this.settingsDef;return t};function UISettingsCreator(){var t=["ui-settings","ui-settings",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISettings;return e.initUISettings(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISettingsCreator);function UIAssets(){return}UIAssets.prototype=new UIElement;UIAssets.prototype.isUIAssets=true;UIAssets.prototype.initUIAssets=function(t,e,i){
this.initUIElement(t);this.setSize(e,i);this.assets={};return this};UIAssets.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.assets=t.assets;return this};UIAssets.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.assets=JSON.parse(JSON.stringify(this.assets||{}));return t};UIAssets.prototype.getAssetInfo=function(t){var e=this.assets[t];if(!e){console.log("not found asset:"+t)}return e};UIAssets.prototype.getAssetURL=function(t){var e=this.getAssetInfo(t);return e?e.url:null};UIAssets.prototype.loadJSON=function(t,e){var i=this.getAssetInfo(t);if(!i){return false}if(i.type!=="json"){console.log("asset is not json:"+t);return false}return ResLoader.loadJson(i.url,e,e)};UIAssets.prototype.loadImage=function(t,e){var i=this.getAssetInfo(t);if(!i){return false}if(i.type!=="image"){console.log("asset is not image:"+t);return false}return ResLoader.loadImage(i.url,e,e)};UIAssets.prototype.loadData=function(t,e){var i=this.getAssetInfo(t);if(!i){return false}if(i.type!=="data"){console.log("asset is not data:"+t);return false}return ResLoader.loadData(i.url,e,e)};UIAssets.prototype.loadAll=function(t){var e=0;var i=0;function n(){i++;if(t){t(100*(i/e),i,e)}}var r=this.assets;for(var o in r){e++}for(var o in r){var a=r[o];if(a.type==="json"){ResLoader.loadJson(a.url,n)}else if(a.type==="data"){ResLoader.loadData(a.url,n)}else if(a.type==="image"){ResLoader.loadImage(a.url,n)}}return this};function UIAssetsCreator(){var t=["ui-assets","ui-assets",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIAssets;return e.initUIAssets(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIAssetsCreator);function UITile(){return}UITile.prototype=new UIElement;UITile.prototype.isUITile=true;UITile.prototype.saveProps=["dataURL"];UITile.prototype.initUITile=function(t,e,i){this.initUIElement(t);this.setSize(e,i);return this};UITile.Layer=function(){};UITile.Layer.prototype.init=function(t,e){this.tile=t;this.info=e;return this};UITile.Layer.prototype.drawOrthogonal=function(t,e){var i=this.info;var n=i.x||0;var r=i.y||0;var o=i.data;var a=i.height;var s=i.width;var h=this.tile;var l=h.tileWidth;var u=h.tileHeight;var p=l*s;var c=Math.max(Math.floor(e.y/u),0);var f=Math.max(Math.floor(e.x/l),0);var d=Math.min(Math.ceil((e.x+e.w)/l),s);var I=Math.min(Math.ceil((e.y+e.h)/u),a);var g=f*l+n;var m=c*u+r;var e={x:g,y:m,w:l,h:u};n=g;t.globalAlpha=i.opacity;for(var v=c;v<=I;v++){for(var y=f;y<=d;y++){var U=v*s+y;var S=o[U];if(S){e.x=g;e.y=m;h.drawTile(t,e,S)}g+=l}g=n;m+=u}return};UITile.Layer.prototype.drawIsometric=function(t,e){var i=e.y;var n=e.x;var r=n+e.w;var o=i+e.h;var a=0;var s=this.info;var h=s.x||0;var l=s.y||0;var u=s.data;var p=s.height;var c=s.width;var f=this.tile;var d=f.tileWidth;var I=f.tileHeight;t.globalAlpha=s.opacity;var g=l;var m=h+this.info.width*d/2-d/2;var e={x:h,y:l,w:d,h:I};for(var v=0;v<p;v++){for(var y=0;y<c;y++,a++){var U=u[a];h=(y-v)*I+m;l=(y+v)*d/4+g;if(!U||h>r||l>o||h+d<n||l+I<i){continue}e.x=h;e.y=l;f.drawTile(t,e,U)}}return};UITile.Layer.prototype.drawHexagonal=function(t,e){var i=e.y;var n=e.x;var r=n+e.w;var o=i+e.h;var a=0;var s=this.info;var h=s.x||0;var l=s.y||0;var u=s.data;var p=s.height;var c=s.width;var f=this.tile;var d=f.tileWidth;var I=f.tileHeight;t.globalAlpha=s.opacity;var g=l;var m=h;var e={x:h,y:l,w:d,h:I};for(var v=0;v<p;v++){l=v*I/2+g;for(var y=0;y<c;y++,a++){var U=u[a];if(!U){continue}h=y*d+m;if(v%2>0)h+=d/2;if(h>r||l>o||h+d<n||l+I<i){continue}e.x=h;e.y=l;f.drawTile(t,e,U)}}return};UITile.Layer.prototype.draw=function(t,e){var i=this.info;if(!i.visible)return;switch(this.tile.orientation){case"orthogonal":{this.drawOrthogonal(t,e);break}case"isometric":{this.drawIsometric(t,e);break}case"staggered":case"hexagonal":{this.drawHexagonal(t,e);break}default:{throw new Error("unknow orientation: ",this.tile.orientation)}}return};UITile.Layer.prototype.getTileByPoint=function(t,e){var i=this.tile;var n=i.tileWidth;var r=i.tileHeight;var o=Math.floor(e/r);var a=Math.floor(t/n);var s=o*this.info.width+a;var h=this.info.data[s];return{row:o,col:a,index:s,imageIndex:h}};UITile.TileSet=function(){};UITile.TileSet.prototype.init=function(t,e,i){this.tile=t;this.info=i;this.imageURL=e+"/"+i.image.basename();this.image=WImage.create(this.imageURL);this.tileWidth=i.tilewidth+i.spacing;this.tileHeight=i.tileheight+i.spacing;this.cols=Math.floor((i.imagewidth-2*i.margin)/this.tileWidth);this.rows=Math.floor((i.imageheight-2*i.margin)/this.tileHeight);this.tileNr=this.cols*this.rows;this.startIndex=i.firstgid;return this};UITile.TileSet.prototype.testImageIndex=function(t){return t>=this.startIndex&&t<this.startIndex+this.tileNr};UITile.TileSet.prototype.drawTile=function(t,e,i,n){var r=this.image.getImage();var o=n-this.startIndex;if(o<0||o>=this.tileNr||!r||!r.width){return}var a=this.info;var s=o%this.cols;var h=Math.floor(o/this.cols);var l=s*this.tileWidth+a.margin;var u=h*this.tileHeight+a.margin;var p=a.tilewidth;var c=a.tileheight;if(this.tileHeight!==this.tile.tileHeight){i=i-(this.tileHeight-this.tile.tileHeight)}t.drawImage(r,l,u,p,c,e,i,p,c);return};UITile.prototype.loadTileSets=function(t,e){this.tilesets=[];var i=e.length;var n=t.dirname();this.images={};for(var r=0;r<i;r++){var o=new UITile.TileSet;o.init(this,n,e[r]);this.setImage("option_image_"+r,o.imageURL);this.tilesets.push(o)}return this};UITile.prototype.loadLayers=function(t){this.layers=[];var e=t.length;for(var i=0;i<e;i++){this.layers.push((new UITile.Layer).init(this,t[i]))}return this};UITile.prototype.getMapWidth=function(){return this.mapWidth};UITile.prototype.getMapHeight=function(){return this.mapHeight};UITile.prototype.getLayerNr=function(){return this.layers?this.layers.length:0};UITile.prototype.getLayerByIndex=function(t){if(this.layers&&t<this.layers.length){return this.layers[t]}return null};UITile.prototype.loadJSON=function(t,e){if(this.isIcon)return;if(!e||!e.width||!e.height){console.log("invalid tiled json");return}this.tileRows=e.height;this.tileCols=e.width;this.tileWidth=e.tilewidth;this.tileHeight=e.tileheight;this.orientation=e.orientation;this.renderorder=e.renderorder;this.properties=e.properties;this.mapWidth=this.tileWidth*this.tileCols;this.mapHeight=this.tileHeight*this.tileRows;this.loadTileSets(t,e.tilesets);this.loadLayers(e.layers);if(this.enable){var i=this.getWindow();if(i&&i.isUIScene){i.setMap(this)}}return};UITile.prototype.loadURL=function(t){var e=this;ResLoader.loadJson(t,function(i){e.loadJSON(t,i)});return};UITile.prototype.load=function(){var t=this.dataURL||this.tiledJsonURL;if(t){this.dataURL=t;this.loadURL(t)}return};UITile.prototype.setClipRegion=function(t){this.clipRegion=t;return this};UITile.prototype.isInClipRegion=function(t){if(!this.clipRegion)return true;var e=this.clipRegion;var i=e.length;for(var n=0;n<i;n++){var r=e[n];if(Rect.hasIntersection(r,t)){return true}}return false};UITile.prototype.drawTile=function(t,e,i){if(!this.isInClipRegion(e)){return}var n=this.tilesets.length;for(var r=0;r<n;r++){var o=this.tilesets[r];if(o.testImageIndex(i)){o.drawTile(t,e.x,e.y,i);break}}return};UITile.prototype.draw=function(t,e){if(!this.layers){return}var i=this.layers;var n=i.length;for(var r=0;r<n;r++){i[r].draw(t,e)}return};UITile.prototype.onAppendedInParent=function(){this.load()};UITile.prototype.createBody=function(t,e,i,n,r,o,a){var s=r>>1;var h=o>>1;var l=i+s;var u=n+h;var p=new b2FixtureDef;p.density=a.density;p.friction=a.friction;p.restitution=a.restitution;if(a.groupIndex){p.filter.groupIndex=a.groupIndex}if(a.isSensor){p.isSensor=true}p.shape=new b2PolygonShape;p.shape.SetAsBox(Physics.toMeter(s),Physics.toMeter(h));var c=new b2BodyDef;c.type=a.density?b2Body.b2_dynamicBody:b2Body.b2_staticBody;c.position.Set(Physics.toMeter(l),Physics.toMeter(u));c.allowSleep=true;body=t.CreateBody(c);body.CreateFixture(p);body.name=e;return};UITile.prototype.createLayerBodies=function(t,e,i){var n=i.data;var r=n.length;var o=i.properties||{};var a=i.height;var s=i.width;var h=this.tileWidth;var l=this.tileHeight;var u=i.x?i.x:0;var p=i.y?i.y:0;o.density=0;o.restitution=o.restitution?parseFloat(o.restitution):.5;o.friction=o.friction?parseFloat(o.friction):.5;for(var c=0;c<r;c++){var f=n[c];if(!f)continue;var d=Math.floor(c/s);var I=c%s;var g=u+I*h;var m=p+d*l;this.createBody(t,e+"-"+c,g,m,h,l,o)}return};UITile.prototype.createBodies=function(t){var e=this.layers;var i=e.length;for(var n=0;n<i;n++){var r=e[n];var o=r.info.properties;if(o&&o.physics){this.createLayerBodies(t,n,r.info)}}return};UITile.prototype.onFromJsonDone=function(t){this.load()};UITile.prototype.setTiledJsonURL=function(t){this.dataURL=t;this.load()};UITile.prototype.getTiledJsonURL=function(){return this.dataURL||this.tiledJsonURL};UITile.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}var i=this.getWindow();if(i&&i.isUIScene){if(t){i.setMap(this)}else{if(i.getMap()===this){i.setMap(null)}}}this.enable=t;return};function UITileCreator(){var t=["ui-tile","ui-tile",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITile;return e.initUITile(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UITileCreator);function UIGSensor(){return}UIGSensor.prototype=new UIElement;UIGSensor.prototype.isUIGSensor=true;UIGSensor.prototype.initUIGSensor=function(t,e,i){this.initUIElement(t);this.setSize(e,i);this.addEventNames(["onDeviceOrientation"]);return this};UIGSensor.prototype.onInit=function(){if(this.enable){this.setEnable(true)}};UIGSensor.prototype.setEnable=function(t){var e=this;if(this.isInDesignMode())return this;function i(t){var i=t.accelerationIncludingGravity;if(!i){console.log("accelerationIncludingGravity not available.");return}var n=i.x||0;var r=i.y||0;var o=i.z||-9.8;if(isAndroid()){n=-n}else if(isIPhone()){r=-r}e.callOnDeviceOrientation(n,r,o,t);return}this.enable=t;if(t){window.removeEventListener("devicemotion",i,false);window.addEventListener("devicemotion",i,false)}else{window.removeEventListener("devicemotion",i,false)}return this};function UIGSensorCreator(){var t=["ui-gsensor","ui-gsensor",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGSensor;return e.initUIGSensor(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIGSensorCreator);function UIMarquee(){return}UIMarquee.prototype=new UILabel;UIMarquee.isUIMarquee=true;UIMarquee.prototype.saveProps=["direction","behavior","scrollamount","scrolldelay","loop","autoPlay"];UIMarquee.DIR_UP="up";UIMarquee.DIR_DOWN="down";UIMarquee.DIR_LEFT="left";UIMarquee.DIR_RIGHT="right";UIMarquee.BEHAVIOR_SCROLL="scroll";UIMarquee.BEHAVIOR_SLIDE="slide";UIMarquee.BEHAVIOR_ALTERNATE="alternate";UIMarquee.LOOP_INFINITE="infinite";UIMarquee.DEFAULT_SCROLL_AMOUNT=1;UIMarquee.DEFAULT_SCROLL_DELAY=20;UIMarquee.prototype.initUIMarquee=function(t,e,i){this.initUIElement(t);this.setText(e);this.setDefSize(200,200);this.setMargin(5,5);this.running=false;this.scrollCounter=0;this.timeScale=1;this.autoPlay=false;this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,i);this.addEventNames(["onChanged","onUpdateTransform","onPlayStepDone","onPlayDone"]);return this};var configLeftResolve={onScroll:function(t,e,i,n,r,o){if(this.done){t.rect(0,0,0,0);t.clip();return}e=e%(r+i);if(e<=i){t.rect(r-i,0,i,o);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=r){t.rect(0,0,i,o);t.clip();this.needStep=true}t.translate(r-e,0)},onSlide:function(t,e,i,n,r,o){if(this.done)return;e%=r;if(e<=i){t.rect(r-i,0,i,o);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(r-e,0)},onAlternate:function(t,e,i,n,r,o){if(this.done){t.translate(r-i,0);return}var a=parseInt(e/(r-i),10)%2>0;var s=parseInt(e%(r-i),10);s=a?r-i-s:s;if(a){this.needStep=true}else if(!a&&this.needStep){this.callOnStep()}t.translate(r-i-s,0)}};var configUpResolve={onScroll:function(t,e,i,n,r,o){if(this.done){t.rect(0,0,0,0);t.clip();return}e=e%(o+n);if(e<=n){t.rect(0,o-n,r,n);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=o){t.rect(0,0,r,o);t.clip();this.needStep=true}t.translate(0,o-e)},onSlide:function(t,e,i,n,r,o){if(this.done){return}e%=o;if(e<=n){t.rect(0,o-n,r,n);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(0,o-e)},onAlternate:function(t,e,i,n,r,o){if(this.done){t.translate(0,o-n);return}var a=parseInt(e/(o-n),10)%2>0;var s=parseInt(e%(o-n),10);s=a?o-n-s:s;if(a){this.needStep=true}else if(!a&&this.needStep){this.callOnStep()}t.translate(0,o-n-s)}};var configRightResolve={onScroll:function(t,e,i,n,r,o){if(this.done){t.rect(0,0,0,0);t.clip();return}e%=r+i;if(e>=r){this.needStep=true;t.rect(r-i,0,i,o);t.clip()}else if(e<=i){t.rect(0,0,i,o);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}t.translate(e-i,0)},onSlide:function(t,e,i,n,r,o){if(this.done){t.translate(r-i,0);return}e%=r;if(e<=i){t.rect(0,0,i,o);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(e-i,0)},onAlternate:function(t,e,i,n,r,o){if(this.done){return}var a=parseInt(e/(r-i),10)%2>0;var s=parseInt(e%(r-i),10);s=a?r-i-s:s;if(a){this.needStep=true}if(!a&&this.needStep){this.callOnStep()}t.translate(s,0)}};var configDownResolve={onScroll:function(t,e,i,n,r,o){if(this.done){t.rect(0,0,0,0);t.clip();return}e%=o+n;if(e<=n){t.rect(0,0,r,n+e);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=o){t.rect(0,o-n,r,n);t.clip();this.needStep=true}t.translate(0,e-n)},onSlide:function(t,e,i,n,r,o){if(this.done){t.translate(0,o-n);return}e%=o;if(e<=n){t.rect(0,0,r,n);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(0,e-n)},onAlternate:function(t,e,i,n,r,o){if(this.done){return}var a=parseInt(e/(o-n),10)%2>0;var s=parseInt(e%(o-n),10);s=a?o-n-s:s;if(a){this.needStep=true}else if(this.needStep&&!a){this.callOnStep()}t.translate(0,s)}};UIMarquee.makeResolve=function(t,e,i){return function(n){var r=this.getWidth(true),o=this.getHeight(true),a=n.timeStep;var s=parseInt(this.scrollCounter*this.scrollamount/this.scrolldelay,10);n.font=this.style.getFont();var h=this.getLocaleText(this.text);var l=n.measureText(h).width;var u=parseInt(n.font);this.hTextAlign=t;this.vTextAlign=e;var p=[n,s,l,u,r,o];switch(this.behavior){case UIMarquee.BEHAVIOR_SCROLL:{i.onScroll.apply(this,p);break}case UIMarquee.BEHAVIOR_SLIDE:{i.onSlide.apply(this,p);break}case UIMarquee.BEHAVIOR_ALTERNATE:{i.onAlternate.apply(this,p);break}default:{throw new Error("unknow behavior")}}}};UIMarquee.prototype.leftResolve=UIMarquee.makeResolve("left","middle",configLeftResolve);UIMarquee.prototype.rightResolve=UIMarquee.makeResolve("left","middle",configRightResolve);UIMarquee.prototype.upResolve=UIMarquee.makeResolve("center","up",configUpResolve);UIMarquee.prototype.downResolve=UIMarquee.makeResolve("center","up",configDownResolve);UIMarquee.prototype.update=function(t){var e=t.timeStep;if(e<this.scrolldelay)e=this.scrolldelay;this.scrollCounter+=this.timeScale*e;switch(this.direction){case UIMarquee.DIR_RIGHT:{this.rightResolve(t);break}case UIMarquee.DIR_LEFT:{this.leftResolve(t);break}case UIMarquee.DIR_UP:{this.upResolve(t);break}case UIMarquee.DIR_DOWN:{this.downResolve(t);break}default:{throw new Error("unknow UIMarquee.direction:"+this.direction)}}};UIMarquee.prototype.onInit=function(){if(this.autoPlay){this.play()}return};UIMarquee.prototype.drawText=function(t){this.layoutText(t);if((this.running||this.done)&&!this.isInDesignMode()){this.update(t);this.defaultDrawText(t)}if(this.isInDesignMode()){this.defaultDrawText(t)}return};UIMarquee.prototype.initOpts=function(t,e,i){if(typeof t==="function"){i=e;e=t;t={}}this.onStep=i||t.onStep;this.onDone=e||t.onDone;this.direction=t.direction||this.direction||UIMarquee.DIR_RIGHT;this.behavior=t.behavior||this.behavior||UIMarquee.BEHAVIOR_SCROLL;this.loop=t.loop>0?t.loop:this.loop?this.loop:UIMarquee.LOOP_INFINITE;this.backloop=this.loop;this.scrolldelay=t.scrolldelay||this.scrolldelay||UIMarquee.DEFAULT_SCROLL_DELAY;this.scrollamount=t.scrollamount||this.scrollamount||UIMarquee.DEFAULT_SCROLL_AMOUNT;return this};UIMarquee.prototype.play=function(t,e,i){t=t||{};this.initOpts(t,e,i);this.reset();this.started=true;this.running=true;this.done=false;this.text=this.backText?this.backText:this.text;return this};UIMarquee.prototype.reset=function(){this.timeScale=1;this.scrollCounter=0;this.needStep=false;this.loop=this.backloop};UIMarquee.prototype.restart=function(){if(!this.started)return;this.running=true;this.done=false;this.text=this.backText?this.backText:this.text;this.reset();return this};UIMarquee.prototype.stop=function(){this.reset();this.running=false;return this};UIMarquee.prototype.pause=function(){if(!this.running)return;this.timeScale=0;return this};UIMarquee.prototype.resume=function(){if(!this.running)return;this.timeScale=1;return this};UIMarquee.prototype.callOnStep=function(){this.needStep=false;if(this.loop!==UIMarquee.LOOP_INFINITE){--this.loop;if(this.loop===0){this.callOnDone();return}}if(typeof this.onStep==="function"){if(!this.onStep()){this.callOnDone();return}}return this};UIMarquee.prototype.callOnDone=function(){if(typeof this.onDone==="function"){this.onDone()}this.done=true;this.stop();return this};function UIMarqueeCreator(){var t=["ui-marquee","ui-marquee",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMarquee;return e.initUIMarquee(this.type,dappGetText("Text"),null)}}ShapeFactoryGet().addShapeCreator(new UIMarqueeCreator);UIElement.prototype.getScence=function(){return this.getWindow()};UIElement.prototype.getFootprints=function(t){var e=0;var i=0;var n=[];var r=this.isUIWindow?this:this.getParent().children;for(var o=0;o<r.length;o++){var a=r[o];if(!a.isUIFootprint){continue}if(t&&t!=a.name){continue}e=a.left+(a.w>>1);i=a.top+(a.h>>1);n.push({x:e,y:i})}return n};UIElement.prototype.moveAlongPath=function(t,e,i,n){var r=this.getFootprints(t);return this.moveAlongPoints(r,e,i,n)};UIElement.prototype.moveAlongPoints=function(t,e,i,n){var r=0;var o=0;var a=0;var s={};var h=[];var l=0;if(!t.length){console.log("no footprint found.")}for(var u=0;u<t.length;u++){var p=t[u];if(u){o=t[u].x-t[u-1].x;a=t[u].y-t[u-1].y;r=Math.sqrt(o*o+a*a);h.push(r);l+=r}}s.onDone=n;s.duration=e;s.distances=h;s.points=t;s.totalDistance=l;s.enableRotation=i;this.startMove(s);return};UIElement.prototype.startMove=function(t){var e=0;var i=0;var n=0;var r=this;var o=this.w>>1;var a=this.h>>1;var s=t.duration;var h=t.distances;var l=t.points;var u=t.totalDistance;var p=t.enableRotation;function c(){if(n+1>=l.length){if(t.onDone){t.onDone()}return}var f=Date.now();var d=l[n+1];var I=l[n];var g=s*(h[n]/u);var m=d.x-I.x;var v=d.y-I.y;var y=Math.asin(Math.abs(v)/Math.sqrt(m*m+v*v));if(v<=0&&m<0){y=Math.PI-y}if(v>0&&m<0){y=Math.PI+y}if(v>0&&m>=0){y=2*Math.PI-y}y=-y;function U(){var t=(Date.now()-f)/g;if(t<1){e=I.x+m*t-o;i=I.y+v*t-a;r.setPosition(e,i);if(p){r.setRotation(y)}r.postRedraw();return true}else{n++;e=d.x-o;i=d.y-a;r.setPosition(e,i);r.postRedraw();c();return false}}UIElement.setAnimTimer(U)}c();return};UIElement.prototype.setPositionWithSticky=function(t,e){this.setPosition(t,e);if(this.sticky){this.orgX=this.x;this.orgY=this.y}return this};UIElement.prototype.setAngle=UIElement.prototype.setRotation;UIElement.prototype.setPositionByBody=function(t,e){if(this.anchor){this._x=t+this.w*this.anchor.x;this._y=e+this.h*this.anchor.y;this.setLeftTop(t,e)}else{this._x=t;this._y=e;this.setLeftTop(this._x,this._y)}this.callOnMovedHandler();return this};UIElement.prototype.setSoundMusicVolume=function(t){this.getWindowManager().setSoundMusicVolume(t);return this};UIElement.prototype.setSoundEffectVolume=function(t){this.getWindowManager().setSoundEffectVolume(t);return this};UIElement.prototype.playSoundEffect=function(t,e){this.getWindowManager().playSoundEffect(t,e);return this};UIElement.prototype.playSoundMusic=function(t,e){this.getWindowManager().playSoundMusic(t,e);return this};UIElement.prototype.stopSoundMusic=function(t){this.getWindowManager().stopSoundMusic(t);return this};UIElement.prototype.stopSoundEffect=function(t){this.getWindowManager().stopSoundEffect(t);return this};UIElement.prototype.setSoundEnable=function(t){var e=this.getWindowManager();e.setSoundEnable(t);return this};UIElement.prototype.isSoundEnable=UIElement.prototype.getSoundEnable=function(){var t=this.getWindowManager();return t.getSoundEnable()};UIElement.prototype.setSoundEffectEnable=function(t){var e=this.getWindowManager();e.setSoundEffectsEnable(t);return this};UIElement.prototype.isSoundEffectEnable=UIElement.prototype.getSoundEffectEnable=function(){var t=this.getWindowManager();return t.soundEffectsEnalbe};UIElement.prototype.setSoundMusicEnable=function(t){var e=this.getWindowManager();e.setSoundMusicsEnable(t);return this};UIElement.prototype.isSoundMusicEnable=UIElement.prototype.getSoundMusicEnable=function(){var t=this.getWindowManager();return t.soundMusicsEnalbe};UIElement.prototype.setVOf=function(t,e,i){var n=this.getWindow().findChildByName(t,true);if(n){n.setV(e,i)}else{console.log("not found "+t)}return this};UIElement.prototype.setV=function(t,e){var i=this.body;if(i){this.setVisible(true);if(!i.IsActive()){i.SetActive(true)}if(!i.IsAwake()){i.SetAwake(true)}var n=i.GetLinearVelocity();if(t!==null&&t!==undefined){n.x=t}if(e!==null&&e!==undefined){n.y=e}i.SetLinearVelocity(n)}return this};UIElement.prototype.onRemoved=function(t){if(!t){return}var e=t.getWindow();if(!e){return}var i=e.world;if(this.body){Physics.destroyBodyForElement(i,this);this.body=null}if(this.joint){Physics.destroyJointForElement(i,this);this.joint=null}return this};function UIWeixin(){return}UIWeixin.prototype=new UIElement;UIWeixin.prototype.isUIWeixin=true;UIWeixin.prototype.saveProps=["configURL","shareTitle","shareDesc","shareLink","shareImage","apiList","debug"];UIWeixin.prototype.initUIWeixin=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);this.setCanRectSelectable(false,true);return this};UIWeixin.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"];UIWeixin.prototype.getConfig=function(t,e,i){if(UIWeixin.config){return}else{UIWeixin.config={}}httpGetJSON(t,function n(t){UIWeixin.config=t;if(UIWeixin.config){UIWeixin.config.jsApiList=e;UIWeixin.config.debug=i;console.log("Fetch UIWeixin.config success:")}else{console.log("Fetch weixin config failed.");return}function n(){try{wx.config(UIWeixin.config);UIWeixin.configDone=true;console.log(JSON.stringify(UIWeixin.config,null,"	"));console.log("Call wx.config done:")}catch(t){console.log("wx script is not load yet, try to config lator:");setTimeout(n,100)}}if(isWeiXin()){console.log("Is WeiXin, try to config it.");n()}else{console.log("It is not weixin browser")}})};UIWeixin.prototype.onFromJsonDone=function(){var t=window.btoa(location.href);var e=null;if(location.href.indexOf("i5r.com.cn")>=0){e=this.configURL?this.configURL:"/weixin/php/json_config.php"}else{e=this.configURL?this.configURL:"/wechat/config"}if(e.indexOf("?")>0){e=e+"&url="+t}else{e=e+"?url="+t}var i=UIWeixin.jsApiList;if(this.apiList){i=this.apiList.split("\n")}this.getConfig(e,i,this.debug);return};UIWeixin.prototype.onInit=function(){var t=this;if(!window.wx){console.log("UIWeixin.prototype.onInit wx not defined.");return}wx.ready(function(){UIWeixin.ready=true;t.updateShareInfo();console.log("wx.ready")});wx.error(function(t){});console.log("UIWeixin.prototype.onInit end");return};UIWeixin.prototype.onDeinit=function(){return};UIWeixin.prototype.shapeCanBeChild=function(t){return false};UIWeixin.prototype.setShareTitle=function(t){this.shareTitle=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareDesc=function(t){this.shareDesc=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareLink=function(t){this.shareLink=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareImage=function(t){this.shareImage=t;this.updateShareInfo();return this};UIWeixin.prototype.updateShareInfo=function(){if(!window.wx){return}var t=this.view;var e=this.shareTitle?this.shareTitle:t.getAppName();var i=this.shareDesc?this.shareDesc:t.getAppDesc();var n=this.shareLink?this.shareLink:location.href;var r=ResLoader.toAbsURL(this.shareImage?this.shareImage:t.getAppIcon());var o={title:e,desc:i,link:n,imgUrl:r,trigger:function(t){console.log("weixin operation trigger:"+JSON.stringify(t))},success:function(t){console.log("weixin operation success:"+JSON.stringify(t))},cancel:function(t){console.log("weixin operation cancel:"+JSON.stringify(t))},fail:function(t){console.log("weixin operation fail:"+JSON.stringify(t))}};wx.onMenuShareAppMessage(o);wx.onMenuShareTimeline(o);wx.onMenuShareQQ(o);wx.onMenuShareWeibo(o);return};function UIWeixinCreator(){var t=["ui-weixin","ui-weixin",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWeixin;return e.initUIWeixin(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIWeixinCreator);function HolaSDK(){}HolaSDK.exec=function(t,e){if(window.HolaF){window.HolaF(t,e);console.log("HolaSDK.exec:"+t+":"+(e?JSON.stringify(e):"{}"))}else{console.log("HolaSDK.exec(e):"+t+":"+(e?JSON.stringify(e):"{}"))}};HolaSDK.init=function(t,e){if(HolaSDK.initialized){return}var i={};i.app_id=t;i.debug=e;HolaSDK.appID=t;HolaSDK.initialized=true;HolaSDK.startTime=Date.now();HolaSDK.exec("GameJsAdSdk.init",i);console.log("HolaSDK.init done")};HolaSDK.showAd=function(t,e,i,n){var r={};r.placement_id=HolaSDK.appID+"_"+t;r.placement_type=e;r.impression_time=i;r.closable=n;HolaSDK.exec("GameJsAdSdk.showAd",r)};HolaSDK.closeAd=function(){if(!HolaSDK.initialized)return;HolaSDK.exec("GameJsAdSdk.closeAd")};HolaSDK.share=function(t,e,i,n){var r={};r.title=t;r.description=e;HolaSDK.exec("share",r)};HolaSDK.fixTime=function(t){if(t>1e3){t=t/1e3}return t};HolaSDK.sendBarrage=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Barrage.send",n)};HolaSDK.ping=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Barrage.ping",n)};HolaSDK.onPaused=function(){if(HolaSDK.onPausedCallback){HolaSDK.onPausedCallback()}};HolaSDK.whenPaused=function(t){HolaSDK.onPausedCallback=t;HolaSDK.exec("Game.Event.onPause",HolaSDK.onPaused)};HolaSDK.onResumed=function(){if(HolaSDK.onResumedCallback){HolaSDK.onResumedCallback()}};HolaSDK.whenResumed=function(t){HolaSDK.onResumedCallback=t;HolaSDK.exec("Game.Event.onResume",HolaSDK.onResumed)};HolaSDK.onRestarted=function(){if(HolaSDK.onRestartedCallback){HolaSDK.onRestartedCallback()}};HolaSDK.whenRestarted=function(t){HolaSDK.onRestartedCallback=t;HolaSDK.exec("Game.Event.onRestart",HolaSDK.onRestarted)};HolaSDK.gameStarted=function(t){var e={};e.level=t;HolaSDK.exec("Game.Status.start",e)};HolaSDK.gamePaused=function(){HolaSDK.exec("Game.Status.pause")};HolaSDK.gameResumed=function(){HolaSDK.exec("Game.Status.resume")};HolaSDK.gameOver=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Game.Status.over",n)};HolaSDK.gameRestarted=function(){console.log("HolaSDK.gameRestarted is not supported now!!!")};HolaSDK.gameExited=function(){HolaSDK.exec("Game.Status.exit")};HolaSDK.exit=function(){HolaSDK.exec("Game.exit")};HolaSDK.getSDKURL=function(){return"http://game-ad-sdk.haloapps.com/static/abyhola/sdk/js_ad_sdk_loader.js?v=034"};window.HolaSDK=HolaSDK;if(!window.CanTK){window.CanTK={}}CanTK.isOldIE=isOldIE;CanTK.isTizen=isTizen;CanTK.isMobile=isMobile;CanTK.isAndroid=isAndroid;CanTK.isFirefoxOS=isFirefoxOS;CanTK.initViewPort=cantkInitViewPort;CanTK.restoreViewPort=cantkRestoreViewPort;CanTK.httpGetURL=httpGetURL;CanTK.httpGetJSON=httpGetJSON;CanTK.httpDoRequest=httpDoRequest;CanTK.LinearInterpolator=LinearInterpolator;CanTK.BounceInterpolator=BounceInterpolator;CanTK.AccelerateInterpolator=AccelerateInterpolator;CanTK.AccDecelerateInterpolator=AccDecelerateInterpolator;CanTK.DecelerateInterpolator=DecelerateInterpolator;CanTK.detectDeviceConfig=cantkDetectDeviceConfig;CanTK.regShapeCreator=cantkRegShapeCreator;CanTK.ShapeCreator=ShapeCreator;window.isOldIE=isOldIE;window.isTizen=isTizen;window.isMobile=isMobile;window.isAndroid=isAndroid;window.isFirefoxOS=isFirefoxOS;window.httpGetURL=httpGetURL;window.httpGetJSON=httpGetJSON;window.httpDoRequest=httpDoRequest;window.cantkInitViewPort=cantkInitViewPort;window.cantkRestoreViewPort=cantkRestoreViewPort;window.cantkGetViewPort=cantkGetViewPort;window.Shape=Shape;window.UIElement=UIElement;window.UIWindowManager=UIWindowManager;window.ShapeFactory=ShapeFactory;CanTK.UIImage=UIImage;CanTK.Shape=Shape;CanTK.UIElement=UIElement;CanTK.init=function(){};CanTK.createElement=function(t){return ShapeFactoryGet().createShape(t,C_CREATE_FOR_PROGRAM)};CanTK.createElementWithJson=function(t){var e=t.type;var i=ShapeFactoryGet().createShape(e,C_CREATE_FOR_PROGRAM);if(i){i.fromJson(t);i.setMode(Shape.MODE_RUNNING,true)}return i};CanTK.UIElement.RUNNING=Shape.MODE_RUNNING;CanTK.UIElement.DEFAULT_IMAGE=UIElement.IMAGE_DEFAULT;CanTK.setResRoot=function(t){return ResLoader.setResRoot(t)};
