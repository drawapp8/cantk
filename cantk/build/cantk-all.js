function isArrayish(t){if(!t){return false}return t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&t.constructor.name!=="String")}var concat=Array.prototype.concat;var slice=Array.prototype.slice;function swizzle(t){var e=[];for(var i=0,n=t.length;i<n;i++){var r=t[i];if(isArrayish(r)){e=concat.call(e,slice.call(r))}else{e.push(r)}}return e}swizzle.wrap=function(t){return function(){return t(swizzle(arguments))}};var colorNames={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var reverseNames={};for(var name in colorNames){if(colorNames.hasOwnProperty(name)){reverseNames[colorNames[name]]=name}}var cs={to:{}};cs.get=function(t){var e=t.substring(0,3).toLowerCase();var i;var n;switch(e){case"hsl":i=cs.get.hsl(t);n="hsl";break;case"hwb":i=cs.get.hwb(t);n="hwb";break;default:i=cs.get.rgb(t);n="rgb";break}if(!i){return null}return{model:n,value:i}};cs.abbrreg=/^#([a-fA-F0-9]{3})$/;cs.hexreg=/^#([a-fA-F0-9]{6})$/;cs.rgbareg=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/;cs.perreg=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/;cs.keywordreg=/(\D+)/;cs.cache={};cs.get.rgb=function(t){var e=cs.cache[t];if(!e){e=cs.get.rgbSlow(t);cs.cache[t]=e}return e};cs.get.rgbSlow=function(t){var e;var i;var n=[0,0,0,1];if(!t){return n}if(i=t.match(cs.abbrreg)){i=i[1];for(e=0;e<3;e++){n[e]=parseInt(i[e]+i[e],16)}}else if(i=t.match(cs.hexreg)){i=i[1];for(e=0;e<3;e++){var r=e*2;n[e]=parseInt(i.slice(r,r+2),16)}}else if(i=t.match(cs.rgbareg)){for(e=0;e<3;e++){n[e]=parseInt(i[e+1],0)}if(i[4]){n[3]=parseFloat(i[4])}}else if(i=t.match(cs.perreg)){for(e=0;e<3;e++){n[e]=Math.round(parseFloat(i[e+1])*2.55)}if(i[4]){n[3]=parseFloat(i[4])}}else if(i=t.match(cs.keywordreg)){if(i[1]==="transparent"){return[0,0,0,0]}n=colorNames[i[1]];if(!n){return null}n[3]=1;return n}for(e=0;e<n.length;e++){n[e]=clamp(n[e],0,255)}n[3]=clamp(n[3],0,1);return n};cs.get.hsl=function(t){if(!t){return null}var e=/^hsla?\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/;var i=t.match(e);if(i){var n=parseFloat(i[4]);var r=(parseFloat(i[1])%360+360)%360;var a=clamp(parseFloat(i[2]),0,100);var o=clamp(parseFloat(i[3]),0,100);var s=clamp(isNaN(n)?1:n,0,1);return[r,a,o,s]}};cs.get.hwb=function(t){if(!t){return null}var e=/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/;var i=t.match(e);if(i){var n=parseFloat(i[4]);var r=(parseFloat(i[1])%360+360)%360;var a=clamp(parseFloat(i[2]),0,100);var o=clamp(parseFloat(i[3]),0,100);var s=clamp(isNaN(n)?1:n,0,1);return[r,a,o,s]}};cs.to.hex=function(t){return"#"+hexDouble(t[0])+hexDouble(t[1])+hexDouble(t[2])};cs.to.rgb=function(){var t=swizzle(arguments);return t.length<4||t[3]===1?"rgb("+t[0]+", "+t[1]+", "+t[2]+")":"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"};cs.to.rgb.percent=function(){var t=swizzle(arguments);var e=Math.round(t[0]/255*100);var i=Math.round(t[1]/255*100);var n=Math.round(t[2]/255*100);return t.length<4||t[3]===1?"rgb("+e+"%, "+i+"%, "+n+"%)":"rgba("+e+"%, "+i+"%, "+n+"%, "+t[3]+")"};cs.to.hsl=function(){var t=swizzle(arguments);return t.length<4||t[3]===1?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"};cs.to.hwb=function(){var t=swizzle(arguments);var e="";if(t.length>=4&&t[3]!==1){e=", "+t[3]}return"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"};cs.to.keyword=function(t){return reverseNames[t.slice(0,3)]};function clamp(t,e,i){return Math.min(Math.max(e,t),i)}function hexDouble(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}function Int16DataBuffer(t){this.size=0;this.capacity=t;this.buffer=new ArrayBuffer(t*2);this.init16Buffer=new Int16Array(this.buffer)}Int16DataBuffer.prototype.extendTo=function(t){var e=new ArrayBuffer(t*2);var i=new Int16Array(e);i.set(this.init16Buffer,0);this.capacity=t;this.buffer=e;this.init16Buffer=i};Int16DataBuffer.prototype.extendIfFull=function(t){if(this.size+t>this.capacity){this.extendTo(Math.round(this.capacity*1.2)+t)}};Int16DataBuffer.prototype.pushX=function(){var t=arguments;var e=t.length;var i=this.size;this.extendIfFull(e);this.size+=e;var n=this.init16Buffer;for(var r=0;r<e;r++,i++){n[i]=t[r]}return this};Int16DataBuffer.prototype.push1=function(t){this.extendIfFull(1);this.init16Buffer[this.size++]=t;return this};Int16DataBuffer.prototype.push2=function(t,e){this.extendIfFull(2);this.init16Buffer[this.size++]=t;this.init16Buffer[this.size++]=e;return this};Int16DataBuffer.prototype.push3=function(t,e,i){this.extendIfFull(3);this.init16Buffer[this.size++]=t;this.init16Buffer[this.size++]=e;this.init16Buffer[this.size++]=i;return this};Int16DataBuffer.prototype.push4=function(t,e,i,n){this.extendIfFull(4);this.init16Buffer[this.size++]=t;this.init16Buffer[this.size++]=e;this.init16Buffer[this.size++]=i;this.init16Buffer[this.size++]=n;return this};Int16DataBuffer.prototype.push5=function(t,e,i,n,r){this.extendIfFull(5);this.init16Buffer[this.size++]=t;this.init16Buffer[this.size++]=e;this.init16Buffer[this.size++]=i;this.init16Buffer[this.size++]=n;this.init16Buffer[this.size++]=r;return this};Int16DataBuffer.prototype.push6=function(t,e,i,n,r,a){this.extendIfFull(6);this.init16Buffer[this.size++]=t;this.init16Buffer[this.size++]=e;this.init16Buffer[this.size++]=i;this.init16Buffer[this.size++]=n;this.init16Buffer[this.size++]=r;this.init16Buffer[this.size++]=a;return this};Int16DataBuffer.prototype.reset=function(){this.size=0};Int16DataBuffer.prototype.getReadBuffer=function(){var t=new Int16Array(this.buffer,0,this.size);t.size=this.size;return t};Int16DataBuffer.prototype.getWriteBuffer=function(t){this.extendIfFull(t);var e=this.init16Buffer;return e};Int16DataBuffer.prototype.getBufferType=function(){return"init16"};Int16DataBuffer.prototype.getElementBytes=function(){return 2};Int16DataBuffer.prototype.dup=function(){var t=Int16DataBuffer.create(this.size);var e=this.size;t.size=this.size;var i=this.init16Buffer;var n=t.init16Buffer;for(var r=0;r<e;r++){n[r]=i[r]}return t};Int16DataBuffer.create=function(t){var e=new Int16DataBuffer(t);return e};Int16DataBuffer.prototype.dump=function(){var t=this.size;var e=this.init16Buffer;console.log(this.size+" "+this.capacity+" "+this.getBufferType()+" "+this.getElementBytes());console.log(Array.prototype.join.call(e,","))};Int16DataBuffer.test=function(){var t=Int16DataBuffer.create(4);t.pushX(1,2,3,3,5,6,7,8,9,10,11);t.dump();var e=t.getReadBuffer();console.log("buffer("+e.length+")["+Array.prototype.join.call(e,",")+"]")};Int16DataBuffer.test();(function(t){"use strict";function e(t,e){var r,a,o,s,l,h,u;for(a=1;a<=8;a*=2){r=[];o=t[t.length-1];s=!(n(o,e)&a);for(l=0;l<t.length;l++){h=t[l];u=!(n(h,e)&a);if(u!==s)r.push(i(o,h,a,e));if(u)r.push(h);o=h;s=u}t=r;if(!t.length)break}return r}function i(t,e,i,n){return i&8?[t[0]+(e[0]-t[0])*(n[3]-t[1])/(e[1]-t[1]),n[3]]:i&4?[t[0]+(e[0]-t[0])*(n[1]-t[1])/(e[1]-t[1]),n[1]]:i&2?[n[2],t[1]+(e[1]-t[1])*(n[2]-t[0])/(e[0]-t[0])]:i&1?[n[0],t[1]+(e[1]-t[1])*(n[0]-t[0])/(e[0]-t[0])]:null}function n(t,e){var i=0;if(t[0]<e[0])i|=1;else if(t[0]>e[2])i|=2;if(t[1]<e[1])i|=4;else if(t[1]>e[3])i|=8;return i}Math.polygonclip=e;console.log(this)})(this);var result=Math.polygonclip([[10,-10],[10,30],[20,30],[20,-10]],[0,0,20,20]);console.log(result);(function(){var t=[];for(var e=0;e<360;e++){var i=e/57.2957;t.push(Math.sin(i)+1e-6)}Math.sinFast=function(e){var i=(e*57.2957>>0)%360;if(i<0){i+=360}return t[i]};Math.cosFast=function(t){return Math.sinFast(t+Math.PI*.5)}})();"use strict";var glMatrix={};glMatrix.EPSILON=1e-6;glMatrix.ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;glMatrix.RANDOM=Math.random;glMatrix.ENABLE_SIMD=false;glMatrix.SIMD_AVAILABLE=glMatrix.ARRAY_TYPE===this.Float32Array&&"SIMD"in this;glMatrix.USE_SIMD=glMatrix.ENABLE_SIMD&&glMatrix.SIMD_AVAILABLE;glMatrix.setMatrixArrayType=function(t){glMatrix.ARRAY_TYPE=t};var degree=Math.PI/180;glMatrix.toRadian=function(t){return t*degree};glMatrix.equals=function(t,e){return Math.abs(t-e)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))};var mat2d={};mat2d.create=function(){var t=new glMatrix.ARRAY_TYPE(6);t[0]=1;t[1]=0;t[2]=0;t[3]=1;t[4]=0;t[5]=0;return t};mat2d.clone=function(t){var e=new glMatrix.ARRAY_TYPE(6);e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e};mat2d.copy=function(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t};mat2d.identity=function(t){t[0]=1;t[1]=0;t[2]=0;t[3]=1;t[4]=0;t[5]=0;return t};mat2d.set=function(t,e,i,n,r,a,o){t[0]=e;t[1]=i;t[2]=n;t[3]=r;t[4]=a;t[5]=o;return t};mat2d.multiply=function(t,e,i){var n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],h=i[0],u=i[1],c=i[2],p=i[3],f=i[4],m=i[5];t[0]=n*h+a*u;t[1]=r*h+o*u;t[2]=n*c+a*p;t[3]=r*c+o*p;t[4]=n*f+a*m+s;t[5]=r*f+o*m+l;return t};mat2d.mult=function(t,e,i,n,r,a,o,s){var l=e[0],h=e[1],u=e[2],c=e[3],p=e[4],f=e[5];t[0]=l*i+u*n;t[1]=h*i+c*n;t[2]=l*r+u*a;t[3]=h*r+c*a;t[4]=l*o+u*s+p;t[5]=h*o+c*s+f;return t};mat2d.rotate=function(t,e){var i=t[0],n=t[1],r=t[2],a=t[3],o=mat2d.sin(e),s=mat2d.cos(e);t[0]=i*s+r*o;t[1]=n*s+a*o;t[2]=i*-o+r*s;t[3]=n*-o+a*s};mat2d.scale=function(t,e,i){t[0]*=e;t[1]*=e;t[2]*=i;t[3]*=i};mat2d.translate=function(t,e,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5];t[4]=n*e+a*i+s;t[5]=r*e+o*i+l};mat2d.points=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];mat2d.transformPoint=function(t,e,i,n){var r=mat2d.points[n||0];r.x=t[0]*e+t[2]*i+t[4];r.y=t[1]*e+t[3]*i+t[5];return r};mat2d.transformPointInt=function(t,e,i,n){var r=mat2d.points[n||0];r.x=(t[0]*e+t[2]*i+t[4])*10>>0;r.y=(t[1]*e+t[3]*i+t[5])*10>>0;return r};mat2d.transformPoints=function(t,e){for(var i=0;i<e.length;i+=2){var n=e[i];var r=e[i+1];e[i]=t[0]*n+t[2]*r+t[4];e[i+1]=t[1]*n+t[3]*r+t[5]}return e};mat2d.sin=Math.sinFast;mat2d.cos=Math.cosFast;function WebGLProgram(){}WebGLProgram.activeProgram=null;WebGLProgram.prototype.create=function(t,e,i,n){this.gl=t;this.buffer=e;var r=t.createProgram();var a=this.createShader(t.FRAGMENT_SHADER,i);var o=this.createShader(t.VERTEX_SHADER,n);t.attachShader(r,o);t.attachShader(r,a);t.linkProgram(r);var s=t.getProgramParameter(r,t.LINK_STATUS);if(!s){alert("Could not initialise shaders:"+t.getProgramInfoLog(r))}this.program=r;this.init();return this};WebGLProgram.prototype.init=function(){};WebGLProgram.prototype.createShader=function(t,e){var i=this.gl;var n=i.createShader(t);i.shaderSource(n,e);i.compileShader(n);if(!i.getShaderParameter(n,i.COMPILE_STATUS)){alert(i.getShaderInfoLog(n));return null}return n};WebGLProgram.prototype.use=function(){if(WebGLProgram.activeProgram!==this.program){this.gl.useProgram(this.program);WebGLProgram.activeProgram=this.program}};WebGLProgram.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.gl.program=null};WebGLProgram.prototype.createDataBuffer=function(t){return Int16DataBuffer.create(t)};WebGLProgram.prototype.getDataBufferElementSize=function(){return 2};WebGLProgram.prototype.getDataBufferElementType=function(){return this.gl.SHORT};function WebGLProgramDrawImage(t,e,i,n){var r=this.fs.replace(/custom-shader/,n);this.name=t;this.create(e,i,r,this.vs);WebGLProgramDrawImage.programs[t]=this}WebGLProgramDrawImage.prototype=new WebGLProgram;WebGLProgramDrawImage.prototype.fs=["precision mediump float;","varying vec4 color;","varying vec2 vTextureCoord;","uniform vec4 size;","uniform sampler2D texture;","void main(void) {","custom-shader","}"].join("\n");WebGLProgramDrawImage.prototype.vs=["precision mediump float;","attribute vec4 aTextureCoord;","attribute vec2 aVertexPosition;","uniform vec4 size;","varying vec4 color;","varying vec2 vTextureCoord;","void main(void) {","    vec2 viewSize = size.xy;","    vec2 textureSize = size.zw;","    vec2 pos = (vec2(aVertexPosition.x/10.0, viewSize.y-aVertexPosition.y/10.0)/ viewSize) * 2.0 - 1.0;","    gl_Position = vec4(pos, 0, 1.0);","    vec2 v = vec2(aTextureCoord.x, aTextureCoord.y)/textureSize;","    vTextureCoord = vec2(v.s, 1.0-v.t);","    float alpha = aTextureCoord.z/256.0;","    float tint = aTextureCoord.w/256.0;","    color = vec4(tint, tint, tint, alpha);","}"].join("\n");WebGLProgramDrawImage.prototype.init=function(){var t=this.gl;var e=this.program;e.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");e.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");e.size=t.getUniformLocation(e,"size");e.samplerUniform=t.getUniformLocation(e,"texture");return};WebGLProgramDrawImage.prototype.addTriangle=function(t,e,i,n,r,a,o,s,l,h,u,c,p,f,m){var d=(h-a)*(m-u)-(u-o)*(f-h)>=0;if(d){return t.pushX(n,r,e,i,a,o,s,l,e,i,h,u,c,p,e,i,f,m)}else{return t.pushX(n,r,e,i,a,o,c,p,e,i,f,m,s,l,e,i,h,u)}};WebGLProgramDrawImage.prototype.draw=function(t,e){this.use();var i=this.gl;var n=this.program;var r=this.getDataBufferElementType();var a=this.getDataBufferElementSize();var o=a*6;var s=t.texture;if(s.dirty){s.update()}var l=e;var h=l.size/6;i.bindBuffer(i.ARRAY_BUFFER,this.buffer);i.bufferData(i.ARRAY_BUFFER,l,i.DYNAMIC_DRAW);i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_2D,s);i.vertexAttribPointer(n.aTextureCoord,4,r,false,o,0);i.enableVertexAttribArray(n.aTextureCoord);i.vertexAttribPointer(n.aVertexPosition,2,r,false,o,a*4);i.enableVertexAttribArray(n.aVertexPosition);i.uniform4f(n.size,i.w,i.h,s.w,s.h);i.drawArrays(i.TRIANGLES,0,h)};WebGLProgramDrawImage.defaultCustomFs=["  vec4 c = texture2D(texture, vTextureCoord) * color;","  if(c.a > 0.01) {","     gl_FragColor = c;","  }else{","     discard;","  }",""].join("\n");WebGLProgramDrawImage.create=function(t,e){var i=new WebGLProgramDrawImage("normal",t,e,WebGLProgramDrawImage.defaultCustomFs);return i};WebGLProgramDrawImage.grayCustomFs=["    vec4 c = texture2D(texture, vTextureCoord);","    float gray = c.r*0.3 + c.g*0.59 + c.b*0.11;","    gl_FragColor = vec4(gray, gray, gray, c.a) * color;"].join("\n");WebGLProgramDrawImage.createGray=function(t,e){var i=new WebGLProgramDrawImage("gray",t,e,WebGLProgramDrawImage.grayCustomFs);return i};WebGLProgramDrawImage.programs={};WebGLProgramDrawImage.init=function(t,e){WebGLProgramDrawImage.create(t,e);WebGLProgramDrawImage.createGray(t,e)};WebGLProgramDrawImage.get=function(t){return WebGLProgramDrawImage.programs[t]||WebGLProgramDrawImage.programs.normal};function WebGLProgramDrawPrimitives(t,e){this.create(t,e,this.fs,this.vs)}WebGLProgramDrawPrimitives.prototype=new WebGLProgram;WebGLProgramDrawPrimitives.prototype.fs=["precision mediump float;","varying vec4 vColor;","void main(void) {","    gl_FragColor = vColor;","}"].join("\n");WebGLProgramDrawPrimitives.prototype.vs=["precision mediump float;","attribute vec2 aVertexPosition;","uniform vec4 aSizeAlphaTint;","uniform vec4 aColor;","varying vec4 vColor;","void main(void) {","   vec2 size = vec2(aSizeAlphaTint.x, aSizeAlphaTint.y);","   float tint = aSizeAlphaTint.z/256.0;","	float alpha = aSizeAlphaTint.w/256.0;","   vec3 pos = vec3(aVertexPosition.x/10.0, aVertexPosition.y/10.0, 1.0);","   vec2 pos2 = (vec2(pos.x, size.y-pos.y)/size) * 2.0 - 1.0;","   gl_Position = vec4(pos2, 0, 1.0);","	vColor = aColor * vec4(tint, tint, tint, alpha);","}"].join("\n");WebGLProgramDrawPrimitives.prototype.init=function(){var t=this.gl;var e=this.program;e.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");e.aColor=t.getUniformLocation(e,"aColor");e.aSizeAlphaTint=t.getUniformLocation(e,"aSizeAlphaTint");return};WebGLProgramDrawPrimitives.prototype.clip=function(t,e){this.draw(this.gl.TRIANGLE_FAN,t,e)};WebGLProgramDrawPrimitives.prototype.stroke=function(t,e){this.draw(this.gl.LINE_STRIP,t,e)};WebGLProgramDrawPrimitives.prototype.fill=function(t,e){this.draw(this.gl.TRIANGLE_FAN,t,e)};WebGLProgramDrawPrimitives.prototype.prepareDraw=function(t,e,i,n){this.use();var r=this.gl;var a=this.program;var o=this.getDataBufferElementType();var s=this.getDataBufferElementSize();r.bindBuffer(r.ARRAY_BUFFER,this.buffer);r.bufferData(r.ARRAY_BUFFER,t,r.DYNAMIC_DRAW);r.vertexAttribPointer(a.aVertexPosition,2,o,false,0,0);r.enableVertexAttribArray(a.aVertexPosition);r.uniform4f(a.aColor,e.r,e.g,e.b,e.a);r.uniform4f(a.aSizeAlphaTint,r.w,r.h,n,i)};WebGLProgramDrawPrimitives.prototype.draw=function(t,e,i){var n=this.gl;var r=e>>1;var a=i-e>>1;n.drawArrays(t,r,a)};WebGLProgramDrawPrimitives.prototype.createDataBuffer=function(t){return Int16DataBuffer.create(t)};WebGLProgramDrawPrimitives.prototype.getDataBufferElementSize=function(){return 2};WebGLProgramDrawPrimitives.prototype.getDataBufferElementType=function(){return this.gl.SHORT};Int16Array.prototype.push=function(){var t=arguments;var e=this.size;var i=this.length;var n=t.length;for(var r=0;r<n&&e<i;r++){this[e++]=t[r]}this.size=e;return this};Int16Array.prototype.extend=function(){var t=this.size;var e=this.length+1024;var i=Int16Array.create(e);i.size=t;for(var n=0;n<t;n++){i[n]=this[n]}return i};Float32Array.prototype.extend=function(){var t=this.size;var e=this.length+1024;var i=Float32Array.create(e);i.size=t;for(var n=0;n<t;n++){i[n]=this[n]}return i};Int16Array.prototype.pushX=function(){var t=this;var e=arguments;var i=e.length;if(this.size+1024+i>this.length){t=this.extend()}var n=this.size;for(var r=0;r<i;r++,n++){t[n]=e[r]}t.size+=i;return t};Int16Array.prototype.push1=function(t){var e=this;if(this.size+10>=this.length){e=this.extend()}e[this.size++]=t;return e};Float32Array.prototype.push1=function(t){var e=this;if(this.size+10>=this.length){e=this.extend()}e[this.size++]=t;return e};Int16Array.prototype.push2=function(t,e){var i=this;if(this.size+10>=this.length){i=this.extend()}i[this.size++]=t;i[this.size++]=e;return i};Float32Array.prototype.push2=function(t,e){var i=this;if(this.size+10>=this.length){i=this.extend()}i[this.size++]=t;i[this.size++]=e;return i};Float32Array.prototype.pushX=function(){var t=this;var e=arguments;var i=e.length;if(this.size+1024+i>this.length){t=this.extend()}var n=this.size;for(var r=0;r<i;r++,n++){t[n]=e[r]}t.size+=i;return t};Float32Array.prototype.pushArr=Int16Array.prototype.pushArr=function(t){var e=this;var i=t.length;if(this.size+1024+i>this.length){e=this.extend()}var n=this.size;for(var r=0;r<i;r++,n++){e[n]=t[r]}e.size+=i;return e};Float32Array.prototype.reset=Int16Array.prototype.reset=function(){this.size=0;return this};Int16Array.create=function(t){var e=new Int16Array(t);e.size=0;return e};Float32Array.create=function(t){var e=new Float32Array(t);e.size=0;return e};Int16Array.prototype.dup=function(){var t=this.size;var e=Int16Array.create(t);for(var i=0;i<t;i++){e[i]=this[i]}e.size=t;return e};Float32Array.prototype.dup=function(){var t=this.size;var e=Float32Array.create(t);for(var i=0;i<t;i++){e[i]=this[i]}e.size=t;return e};Float32Array.prototype.slice=Int16Array.prototype.slice=Array.prototype.slice;(function(){function t(t,e,i,n){this.x=t||0;this.y=e||0;this.width=i||0;this.height=n||0}t.prototype={constructor:t,clone:function(){return new t(this.x,this.y,this.width,this.height)}};t.isContainedIn=function(t,e){return t.x>=e.x&&t.y>=e.y&&t.x+t.width<=e.x+e.width&&t.y+t.height<=e.y+e.height};var e=0;var i=1;var n=2;var r=3;var a=4;function o(t,e,i){this.binWidth=0;this.binHeight=0;this.allowRotate=false;this.usedRectangles=[];this.freeRectangles=[];this.init(t,e,i)}o.prototype={constructor:o,init:function(e,i,n){this.binWidth=e;this.binHeight=i;this.allowRotate=n||false;this.usedRectangles.length=0;this.freeRectangles.length=0;this.freeRectangles.push(new t(0,0,e,i))},insert:function(o,s,l){var h=new t;var u={value:0};var c={value:0};l=l||0;switch(l){case e:h=this._findPositionForNewNodeBestShortSideFit(o,s,u,c);break;case r:h=this._findPositionForNewNodeBottomLeft(o,s,u,c);break;case a:h=this._findPositionForNewNodeContactPoint(o,s,u);break;case i:h=this._findPositionForNewNodeBestLongSideFit(o,s,c,u);break;case n:h=this._findPositionForNewNodeBestAreaFit(o,s,u,c);break}if(h.height===0){return h}this._placeRectangle(h);return h},insert2:function(e,i){var n=[];while(e.length>0){var r=Infinity;var a=Infinity;var o=-1;var s=new t;for(var l=0;l<e.length;l++){var h={value:0};var u={value:0};var c=this._scoreRectangle(e[l].width,e[l].height,i,h,u);if(h.value<r||h.value==r&&u.value<a){r=h.value;a=u.value;s=c;o=l}}if(o==-1){return n}this._placeRectangle(s);var p=e.splice(o,1)[0];p.x=s.x;p.y=s.y;n.push(p)}return n},_placeRectangle:function(t){var e=this.freeRectangles.length;for(var i=0;i<e;i++){if(this._splitFreeNode(this.freeRectangles[i],t)){this.freeRectangles.splice(i,1);i--;e--}}this._pruneFreeList();this.usedRectangles.push(t)},_scoreRectangle:function(o,s,l,h,u){var c=new t;h.value=Infinity;u.value=Infinity;switch(l){case e:c=this._findPositionForNewNodeBestShortSideFit(o,s,h,u);break;case r:c=this._findPositionForNewNodeBottomLeft(o,s,h,u);break;case a:c=this._findPositionForNewNodeContactPoint(o,s,h);h=-h;break;case i:c=this._findPositionForNewNodeBestLongSideFit(o,s,u,h);break;case n:c=this._findPositionForNewNodeBestAreaFit(o,s,h,u);break}if(c.height===0){h.value=Infinity;u.value=Infinity}return c},_occupancy:function(){var t=this.usedRectangles;var e=0;for(var i=0;i<t.length;i++){e+=t[i].width*t[i].height}return e/(this.binWidth*this.binHeight)},_findPositionForNewNodeBottomLeft:function(e,i,n,r){var a=this.freeRectangles;var o=new t;n.value=Infinity;var s;var l;for(var h=0;h<a.length;h++){s=a[h];if(s.width>=e&&s.height>=i){l=s.y+i;if(l<n.value||l==n.value&&s.x<r.value){o.x=s.x;o.y=s.y;o.width=e;o.height=i;n.value=l;r.value=s.x}}if(this.allowRotate&&s.width>=i&&s.height>=e){l=s.y+e;if(l<n.value||l==n.value&&s.x<r.value){o.x=s.x;o.y=s.y;o.width=i;o.height=e;n.value=l;r.value=s.x}}}return o},_findPositionForNewNodeBestShortSideFit:function(e,i,n,r){var a=this.freeRectangles;var o=new t;n.value=Infinity;var s;var l;var h;var u;var c;for(var p=0;p<a.length;p++){s=a[p];if(s.width>=e&&s.height>=i){l=Math.abs(s.width-e);h=Math.abs(s.height-i);u=Math.min(l,h);c=Math.max(l,h);if(u<n.value||u==n.value&&c<r.value){o.x=s.x;o.y=s.y;o.width=e;o.height=i;n.value=u;r.value=c}}var f;var m;var d;var y;if(this.allowRotate&&s.width>=i&&s.height>=e){f=Math.abs(s.width-i);m=Math.abs(s.height-e);d=Math.min(f,m);y=Math.max(f,m);if(d<n.value||d==n.value&&y<r.value){o.x=s.x;o.y=s.y;o.width=i;o.height=e;n.value=d;r.value=y}}}return o},_findPositionForNewNodeBestLongSideFit:function(e,i,n,r){var a=this.freeRectangles;var o=new t;r.value=Infinity;var s;var l;var h;var u;var c;for(var p=0;p<a.length;p++){s=a[p];if(s.width>=e&&s.height>=i){l=Math.abs(s.width-e);h=Math.abs(s.height-i);u=Math.min(l,h);c=Math.max(l,h);if(c<r.value||c==r.value&&u<n.value){o.x=s.x;o.y=s.y;o.width=e;o.height=i;n.value=u;r.value=c}}if(this.allowRotate&&s.width>=i&&s.height>=e){l=Math.abs(s.width-i);h=Math.abs(s.height-e);u=Math.min(l,h);c=Math.max(l,h);if(c<r.value||c==r.value&&u<n.value){o.x=s.x;o.y=s.y;o.width=i;o.height=e;n.value=u;r.value=c}}}return o},_findPositionForNewNodeBestAreaFit:function(e,i,n,r){var a=this.freeRectangles;var o=new t;n.value=Infinity;var s;var l;var h;var u;var c;for(var p=0;p<a.length;p++){s=a[p];c=s.width*s.height-e*i;if(s.width>=e&&s.height>=i){l=Math.abs(s.width-e);h=Math.abs(s.height-i);u=Math.min(l,h);if(c<n.value||c==n.value&&u<r.value){o.x=s.x;o.y=s.y;o.width=e;o.height=i;r.value=u;n=c}}if(this.allowRotate&&s.width>=i&&s.height>=e){l=Math.abs(s.width-i);h=Math.abs(s.height-e);u=Math.min(l,h);if(c<n.value||c==n.value&&u<r.value){o.x=s.x;o.y=s.y;o.width=i;o.height=e;r.value=u;n.value=c}}}return o},_commonIntervalLength:function(t,e,i,n){if(e<i||n<t){return 0}return Math.min(e,n)-Math.max(t,i)},_contactPointScoreNode:function(t,e,i,n){var r=this.usedRectangles;var a=0;if(t==0||t+i===this.binWidth)a+=n;if(e==0||e+n===this.binHeight)a+=i;var o;for(var s=0;s<r.length;s++){o=r[s];if(o.x==t+i||o.x+o.width==t)a+=this._commonIntervalLength(o.y,o.y+o.height,e,e+n);if(o.y==e+n||o.y+o.height==e)a+=this._commonIntervalLength(o.x,o.x+o.width,t,t+i)}return a},_findPositionForNewNodeContactPoint:function(e,i,n){var r=this.freeRectangles;var a=new t;n.value=-1;var o;var s;for(var l=0;l<r.length;l++){o=r[l];if(o.width>=e&&o.height>=i){s=this._contactPointScoreNode(o.x,o.y,e,i);if(s>n.value){a.x=o.x;a.y=o.y;a.width=e;a.height=i;n=s}}if(this.allowRotate&&o.width>=i&&o.height>=e){s=this._contactPointScoreNode(o.x,o.y,i,e);if(s>n.value){a.x=o.x;a.y=o.y;a.width=i;a.height=e;n.value=s}}}return a},_splitFreeNode:function(t,e){var i=this.freeRectangles;if(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)return false;var n;if(e.x<t.x+t.width&&e.x+e.width>t.x){if(e.y>t.y&&e.y<t.y+t.height){n=t.clone();n.height=e.y-n.y;i.push(n)}if(e.y+e.height<t.y+t.height){n=t.clone();n.y=e.y+e.height;n.height=t.y+t.height-(e.y+e.height);i.push(n)}}if(e.y<t.y+t.height&&e.y+e.height>t.y){if(e.x>t.x&&e.x<t.x+t.width){n=t.clone();n.width=e.x-n.x;i.push(n)}if(e.x+e.width<t.x+t.width){n=t.clone();n.x=e.x+e.width;n.width=t.x+t.width-(e.x+e.width);i.push(n)}}return true},_pruneFreeList:function(){var e=this.freeRectangles;for(var i=0;i<e.length;i++)for(var n=i+1;n<e.length;n++){if(t.isContainedIn(e[i],e[n])){e.splice(i,1);break}if(t.isContainedIn(e[n],e[i])){e.splice(n,1)}}}};window.MaxRectsBinPack=o})();Math.normalize=function(t,e,i){var n=Math.sqrt(t*t+e*e);if(n>1e-6){var r=1/n;i.x=t*r;i.y=e*r}i.d=n;return i};Math.cross=function(t,e,i,n){return i*e-t*n};Math.ptEquals=function(t,e,i,n,r){var a=i-t;var o=n-e;return a*a+o*o<r*r};Math.distPtSeg=function(t,e,i,n,r,a){var o,s,l,h,u,c;o=r-i;s=a-n;l=t-i;h=e-n;u=o*o+s*s;c=o*l+s*h;if(u>0)c/=u;if(c<0)c=0;else if(c>1)c=1;l=i+c*o-t;h=n+c*s-e;return l*l+h*h};function parseFontSize(t){var e=12;var i=t.match(/\d+pt|\d+px/g);if(i){var n=i[0];e=parseInt(n);if(n.indexOf("pt")>0){e=Math.round(e*1.2)}}return e}function AutoPacker(){}AutoPacker.prototype.init=function(t){this.gl=t;this.w=512;this.h=1024;this.imageMaxWidth=256;this.imageMaxHeight=256;this.canvas=document.createElement("canvas");this.canvas.cannotPack=true;this.glyphCache={};this.imagesCache=[];this.createTexture();this.setOverflow(false);return this.reset()};AutoPacker.prototype.resetImagesCache=function(){var t=this.imagesCache;var e=t.length;for(var i=0;i<e;i++){var n=t[i];n.ox=0;n.oy=0;n.packed=false;n.texture=null}t.length=0};AutoPacker.prototype.extendCanvas=function(){if(this.isOverflow()){if(this.w<2048||this.h<2048){if(this.w<this.h){this.w=this.w<<1}else{this.h=this.h<<1}}else{if(this.imageMaxWidth>this.imageMaxHeight){this.imageMaxWidth=this.imageMaxWidth<<1}else{this.imageMaxHeight=this.imageMaxHeight<<1}}this.setOverflow(false);console.log("extend canvas to "+this.w+"x"+this.h)}this.canvas.width=this.w;this.canvas.height=this.h;this.ctx=this.canvas.getContext("2d")};AutoPacker.prototype.reset=function(){this.resetImagesCache();this.glyphCache={};this.extendCanvas();var t=this.ctx;t.textAlign="left";t.textBaseline="middle";t.clearRect(0,0,this.w,this.h);this.binPacker=new MaxRectsBinPack(this.w,this.h,false);return this};AutoPacker.prototype.getAvailableRect=function(t,e){var i=this.binPacker.insert(t,e,0);if(i){i.w=t;i.h=e}return i};AutoPacker.prototype.addGlyph=function(t,e,i,n){var r=this.ctx;if(r.font!==t){r.font=t}if(r.fillStyle!==i){r.fillStyle=i}var a=Math.ceil(r.measureText(n).width);var o=Math.ceil(e*1.3);var s=a>>2;var l=e>>2;var h=this.getAvailableRect(a+s*2,o+l*2);if(h){h.x+=s;h.y+=l;h.w=a;h.h=o;if(t.indexOf("italic")>=0){h.charW=h.w+s}else{h.charW=h.w}var u=AutoPacker.toGlyphKey(t,n,i);r.fillText(n,h.x,h.y+(h.h>>1));this.glyphCache[u]=h;this.setDirty(true)}return h};AutoPacker.prototype.measureText=function(t,e,i,n){var r=0;var a=e.length;var o=parseFontSize(t);for(var s=0;s<a;s++){var l=e[s];var h=this.getGlyph(t,l,i);if(!h){h=this.addGlyph(t,o,i,l)}if(h){r+=h.w}}n.w=r;n.h=o;return n};AutoPacker.toGlyphKey=function(t,e,i){return t+e+i};AutoPacker.prototype.hasGlyph=function(t,e,i){return!!this.glyphCache[AutoPacker.toGlyphKey(t,e,i)]};AutoPacker.prototype.setOverflow=function(t){this.overflow=t};AutoPacker.prototype.isOverflow=function(t){return this.overflow};AutoPacker.prototype.getGlyph=function(t,e,i){return this.glyphCache[AutoPacker.toGlyphKey(t,e,i)]};AutoPacker.prototype.packImage=function(t){if(!t.src||t.src.indexOf("data:")===0||t.width>this.imageMaxWidth||t.height>this.imageMaxHeight){t.ox=0;t.oy=0;t.cannotPack=true;return}var e=this.getAvailableRect(t.width+4,t.height+4);if(e.height<t.height){t.ox=0;t.oy=0;this.setOverflow(true);return}var i=e.x+2;var n=e.y+2;var r=this.canvas.texture;this.setDirty(true);this.ctx.drawImage(t,i,n);t.ox=i;t.oy=n;t.packed=true;if(t.texture&&t.texture!==r){this.gl.deleteTexture(t.texture);
}t.texture=this.canvas.texture;this.imagesCache.push(t);return};AutoPacker.prototype.setDirty=function(t){this.canvas.texture.setDirty(t)};AutoPacker.prototype.createTexture=function(){var t=this.gl;var e=t.createTexture();e.src=null;e.image=this.canvas;this.canvas.texture=e;e.dirty=true;e.setDirty=function(t){this.dirty=t};e.update=function(){if(!this.dirty)return;var e=this.image;this.dirty=false;this.w=e.width;this.h=e.height;t.bindTexture(t.TEXTURE_2D,this);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,true);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);t.bindTexture(t.TEXTURE_2D,null)}};AutoPacker.prototype.getImage=function(){return this.canvas};function CanvasRenderingContext2DWebGL(t){this.distTol=.01;this.tessTol=.0025;this.currentID=1e3;this.fps=0;this.lastX=0;this.lastY=0;this.firstX=0;this.firstY=0;this.showFPS=false;this.renderTimes=0;this.startTime=Date.now();this.lastSeconds=this.startTime/1e3>>0;this.drawCalls=0;this.drawImageCalls=0;this.drawImageCount=0;this.fillCount=0;this.strokeCount=0;this.clipLevel=0;this.canvasWidth=0;this.canvasHeight=0;this.canvasWidth10=0;this.canvasHeight10=0;this.zeroPoint={x:0,y:0};this.tempRect={x:0,y:0,w:0,h:0};this.webglOptions=t||CanvasRenderingContext2DWebGL.webglOptions}CanvasRenderingContext2DWebGL.webglOptions={antialias:false,stencil:true,preserveDrawingBuffer:true,premultipliedAlpha:false};CanvasRenderingContext2DWebGL.prototype.save=function(){this.stack.push(this.state.clone())};CanvasRenderingContext2DWebGL.prototype.restore=function(){var t=this.state;var e=this.stack.pop();if(e){if(e.clipRect||t.clipRect){if(!e.clipRect||!t.clipRect||e.clipRect!==t.clipRect){this.doClipRect(e.clipRect)}}if(e.clipPaths||t.clipPaths){if(!e.clipPaths||!t.clipPaths||e.clipPaths.id!==t.clipPaths.id){this.clearClip(t.clipPaths)}}this.state=e;if(t.globalCompositeOperation!==e.globalCompositeOperation){this.globalCompositeOperationApply(e.globalCompositeOperation)}}else{console.log("restore times > save times.")}CanvasRenderingContext2DWebGL.destroyState(t)};CanvasRenderingContext2DWebGL.prototype.scale=function(t,e){mat2d.scale(this.state.m,t,e)};CanvasRenderingContext2DWebGL.prototype.rotate=function(t){mat2d.rotate(this.state.m,t)};CanvasRenderingContext2DWebGL.prototype.translate=function(t,e){mat2d.translate(this.state.m,t,e)};CanvasRenderingContext2DWebGL.prototype.transform=function(t,e,i,n,r,a){var o=this.state.m;mat2d.mult(o,o,t,e,i,n,r,a)};CanvasRenderingContext2DWebGL.prototype.setTransform=function(t,e,i,n,r,a){mat2d.set(this.state.m,t,e,i,n,r,a)};CanvasRenderingContext2DWebGL.prototype.scaleArr=function(t,e,i){mat2d.scale(this.state.m,t[e],t[i])};CanvasRenderingContext2DWebGL.prototype.rotateArr=function(t,e){mat2d.rotate(this.state.m,t[e])};CanvasRenderingContext2DWebGL.prototype.translateArr=function(t,e,i){mat2d.translate(this.state.m,t[e],t[i])};CanvasRenderingContext2DWebGL.prototype.transformMatrix=function(t){var e=this.state.m;mat2d.multiply(e,e,t)};CanvasRenderingContext2DWebGL.prototype.setTransformMatrix=function(t){mat2d.copy(this.state.m,t)};Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"globalTint",{get:function(){return this.state.globalTint},set:function(t){this.state.globalTint=t},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"globalImageFilter",{get:function(){return this.state.globalImageFilter},set:function(t){this.state.globalImageFilter=t},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"globalAlpha",{get:function(){return this.state.globalAlpha},set:function(t){this.state.globalAlpha=t},enumerable:false,configurable:true});CanvasRenderingContext2DWebGL.prototype.globalCompositeOperationApply=function(t){var e=this.gl;this.commitDrawImage();if("darker"==t){e.blendEquation(e.FUNC_SUBTRACT)}else{e.blendEquation(e.FUNC_ADD)}switch(t){case"source-over":e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case"destination-over":e.blendFunc(e.ONE_MINUS_DST_ALPHA,e.ONE);break;case"clear":e.blendFunc(e.ZERO,e.ZERO);break;case"copy":case"source":e.blendFunc(e.ONE,e.ZERO);break;case"destination":e.blendFunc(e.ZERO,e.ONE);break;case"source-atop":e.blendFunc(e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA);break;case"destination-atop":e.blendFunc(e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA);break;case"source-in":e.blendFunc(e.DST_ALPHA,e.ZERO);break;case"destination-in":e.blendFunc(e.ZERO,e.SRC_ALPHA);break;case"source-out":e.blendFunc(e.ONE_MINUS_DST_ALPHA,e.ZERO);break;case"destination-out":e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_ALPHA);break;case"lighter":case"darker":e.blendFunc(e.ONE,e.ONE);break;case"xor":e.blendFunc(e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA);break;case"normal":default:e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);break}};Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"globalCompositeOperation",{get:function(){return this.state.globalCompositeOperation},set:function(t){if(t!==this.state.globalCompositeOperation){this.state.globalCompositeOperation=t;this.globalCompositeOperationApply(t)}},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"strokeStyle",{get:function(){return this.state.strokeStyle.str},set:function(t){var e=this.state.strokeStyle.str;if(t&&e!==t){this.state.strokeStyle=CanvasRenderingContext2DWebGL.parseColor(t)}},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"fillStyle",{get:function(){return this.state.fillStyle.str},set:function(t){var e=this.state.fillStyle.str;if(t&&e!==t){this.state.fillStyle=CanvasRenderingContext2DWebGL.parseColor(t)}},enumerable:false,configurable:true});CanvasRenderingContext2DWebGL.prototype.clearRect=function(t,e,i,n){this.beginPath();this.rect(t,e,i,n);this.fill();this.beginPath()};CanvasRenderingContext2DWebGL.prototype.fillRect=function(t,e,i,n){this.beginPath();this.rect(t,e,i,n);this.fill();this.beginPath()};CanvasRenderingContext2DWebGL.prototype.strokeRect=function(t,e,i,n){this.beginPath();this.rect(t,e,i,n);this.stroke();this.beginPath()};CanvasRenderingContext2DWebGL.prototype.stroke=function(){if(this.lineWidth&&this.strokeStyle){this.gl.lineWidth(this.lineWidth);this.commitDrawImage();this.strokeCount++;var t=this.drawPrimitivesProgram;this.drawPrimitives(t,this.drawPrimitiveQueue,t.stroke,this.state.strokeStyle)}};CanvasRenderingContext2DWebGL.prototype.fill=function(){if(this.fillStyle){this.commitDrawImage();this.fillCount++;var t=this.drawPrimitivesProgram;this.drawPrimitives(t,this.drawPrimitiveQueue,t.fill,this.state.fillStyle)}};CanvasRenderingContext2DWebGL.prototype.drawStencil=function(t,e,i){var n=this.gl;var r=this.drawPrimitivesProgram;var a=i?n.DECR:n.INCR;n.stencilMask(255);n.stencilFunc(n.ALWAYS,1,255);n.stencilOp(n.KEEP,n.KEEP,a);n.colorMask(false,false,false,false);this.drawPrimitives(r,t,r.clip,this.stencilColor);n.stencilMask(0);n.stencilFunc(n.EQUAL,e,255);n.colorMask(true,true,true,true)};CanvasRenderingContext2DWebGL.prototype.clearClip=function(t){var e=this.gl;if(!t){e.disable(e.STENCIL_TEST);return}this.commitDrawImage();this.drawStencil(t,--this.clipLevel,true)};CanvasRenderingContext2DWebGL.prototype.clip=function(){this.savePrimitiveQueueForClip();var t=this.gl;if(this.clipLevel===0){t.enable(t.STENCIL_TEST)}this.commitDrawImage();var e=this.state.clipPaths;if(e){this.drawStencil(e,++this.clipLevel,false)}};CanvasRenderingContext2DWebGL.prototype.drawPrimitives=function(t,e,i,n){var r=e.dataBuffer.getReadBuffer();var a=e.paths;var o=this.state;var s=0;var l=0;var h=null;var u=a.size;var c=o.globalTint*256>>0;var p=o.globalAlpha*256>>0;t.prepareDraw(r,n,p,c);for(var f=0;f<u;f++){var l=a[f];if(f<u-1){s=a[f+1]}else{s=r.size}if(s>l){this.drawCalls++;i.call(t,l,s)}}};CanvasRenderingContext2DWebGL.prototype.doClipRect=function(t){var e=this.gl;var i=this.canvas;var n=i.width;var r=i.height;this.commitDrawImage();e.enable(e.SCISSOR_TEST);if(!t||!t.w||!t.h){e.scissor(0,0,n,r)}else{var a=e.w;var o=e.h;var s=n/a;var l=r/o;var h=(t.y-1)*l;var u=t.x*s;var c=t.w*s;var p=t.h*l;var f=r-(h+p);e.scissor(u,f,c,p)}};CanvasRenderingContext2DWebGL.prototype.clipRect=function(t,e,i,n){var r=this.state;var a=r.m;var o=mat2d.transformPoint(a,t,e);var s=r.clipRect;r.clipRect={x:o.x,y:o.y,w:i,h:n};if(s){r.clipRect=Rect.intersection(r.clipRect,s)}if(r.clipRect){this.doClipRect(r.clipRect)}};CanvasRenderingContext2DWebGL.prototype.drawGlyph=function(t,e,i,n,r,a,o,s,l,h){this.prepareDrawImage(t,e);this.drawImageEx(t,i,n,r,a,o*10,s*10,(o+l)*10,s*10,(o+l)*10,(s+h)*10,o*10,(s+h)*10)};CanvasRenderingContext2DWebGL.prototype.doFillText=function(t,e,i,n){var r=e;var a=i;var o=this.gl;var s=this.tempRect;var l=this.font||"16px sans";var h=this.autoPacker;var u=this.state.fillStyle;var c=u.str;if(!this.autoPacker.measureText(l,t,c,s)){console.log("invalid font size");return}var p=this.autoPacker.getImage();switch(this.textAlign){case"right":{r=e-s.w;break}case"center":{r=e-(s.w>>1);break}default:break}switch(this.textBaseline){case"bottom":{a=i-s.h;break}case"middle":{a=i-(s.h>>1);break}default:break}var f=t.length;var m=WebGLProgramDrawImage.get("normal");for(var d=0;d<f;d++){var y=t[d];var v=h.getGlyph(l,y,c);if(v){this.drawGlyph(p,m,v.x,v.y,v.charW,v.h,r,a,v.charW,v.h);r+=v.w}}return};CanvasRenderingContext2DWebGL.prototype.fillText=function(t,e,i,n){var r=this.state.m;var a=mat2d.transformPointInt(r,e,i);this.doFillText(t,a.x/10,a.y/10,n)};CanvasRenderingContext2DWebGL.prototype.strokeText=function(){console.log("strokeText NOT IMPL")};CanvasRenderingContext2DWebGL.prototype.drawImageTriArr=function(t,e){var i=0;var n=e.length/12>>0;for(var r=0;r<n;r++){this.drawImageTri(t,e[i++],e[i++],e[i++],e[i++],e[i++],e[i++],e[i++],e[i++],e[i++],e[i++],e[i++],e[i++])}};CanvasRenderingContext2DWebGL.prototype.drawImageTri=function(t,e,i,n,r,a,o,s,l,h,u,c,p){var f=this.state.m;var m=mat2d.transformPointInt(f,n,r,0);var d=mat2d.transformPointInt(f,s,l,1);var y=mat2d.transformPointInt(f,c,p,2);var v=(d.x-m.x)*(y.y-d.y)-(d.y-m.y)*(y.x-d.x)>=0;if(v){this.doDrawImageTri(t,e,i,m.x,m.y,a,o,d.x,d.y,h,u,y.x,y.y)}else{this.doDrawImageTri(t,e,i,m.x,m.y,h,u,y.x,y.y,a,o,d.x,d.y)}};CanvasRenderingContext2DWebGL.prototype.doDrawImageTri=function(t,e,i,n,r,a,o,s,l,h,u,c,p){this.drawImageCount++;if(t.complete){var f=t.ox;var m=t.oy;var d=this.state;var y=this.drawImageQueue;var v=WebGLProgramDrawImage.get(d.globalImageFilter);this.prepareDrawImage(t,v);y.dataBuffer=v.addTriangle(y.dataBuffer,d.globalAlpha*256>>0,d.globalTint*256>>0,e+f,i+m,n,r,a+f,o+m,s,l,h+f,u+m,c,p)}};CanvasRenderingContext2DWebGL.prototype.drawImage=function(t,e,i,n,r,a,o,s,l){var h,u,c,p,f,m,d,y;if(!t.width){return}if(l){h=e;u=i;c=n;p=r;f=a;m=o;d=s;y=l}else if(n){h=0;u=0;c=t.width;p=t.height;f=e;m=i;d=n;y=r}else{h=0;u=0;c=t.width;p=t.height;f=e;m=i;d=c;y=p}var v=this.state;var g=WebGLProgramDrawImage.get(v.globalImageFilter);this.prepareDrawImage(t,g);var _=v.m;var I=_[0];var x=_[1];var w=_[2];var S=_[3];var b=_[4];var C=_[5];var T=m;var D=f;var U=f+d;var A=m+y;var E=(I*D+w*T+b)*10>>0;var M=(x*D+S*T+C)*10>>0;var P=(I*U+w*T+b)*10>>0;var B=(x*U+S*T+C)*10>>0;var L=(I*U+w*A+b)*10>>0;var R=(x*U+S*A+C)*10>>0;var O=(I*D+w*A+b)*10>>0;var V=(x*D+S*A+C)*10>>0;var F=this.canvasWidth10;var k=this.canvasHeight10;if(E<0&&P<0&&L<0&&O<0||M<0&&B<0&&R<0&&V<0||E>F&&P>F&&L>F&&O>F||M>k&&B>k&&R>k&&V>k){this.drawImageCount++;return}this.drawImageEx(t,h+t.ox,u+t.oy,c,p,E,M,P,B,L,R,O,V)};CanvasRenderingContext2DWebGL.prototype.prepareDrawImage=function(t,e){var i=this.drawImageQueue;if(i.image){if(i.image.texture!==t.texture||i.program!==e||i.globalCompositeOperation!==this.state.globalCompositeOperation){this.commitDrawImage();i.image=t;i.program=e;if(!t.cannotPack&&!t.packed){this.autoPacker.packImage(t);this.loadTextureWithImage(t)}}}else{if(!t.cannotPack&&!t.packed){this.autoPacker.packImage(t);this.loadTextureWithImage(t)}i.image=t;i.program=e}};CanvasRenderingContext2DWebGL.prototype.drawImageEx=function(t,e,i,n,r,a,o,s,l,h,u,c,p){this.drawImageCount++;var f=this.drawImageQueue.dataBuffer;var m=f.getWriteBuffer(100);var d=f.size;var y=this.state.globalTint*256>>0;var v=this.state.globalAlpha*256>>0;m[d++]=e;m[d++]=i;m[d++]=v;m[d++]=y;m[d++]=a;m[d++]=o;m[d++]=e+n;m[d++]=i;m[d++]=v;m[d++]=y;m[d++]=s;m[d++]=l;m[d++]=e+n;m[d++]=i+r;m[d++]=v;m[d++]=y;m[d++]=h;m[d++]=u;m[d++]=e+n;m[d++]=i+r;m[d++]=v;m[d++]=y;m[d++]=h;m[d++]=u;m[d++]=e;m[d++]=i+r;m[d++]=v;m[d++]=y;m[d++]=c;m[d++]=p;m[d++]=e;m[d++]=i;m[d++]=v;m[d++]=y;m[d++]=a;m[d++]=o;f.size=d;return};CanvasRenderingContext2DWebGL.prototype.commitDrawImage=function(){var t=this.drawImageQueue;var e=t.dataBuffer.getReadBuffer();if(e.size<1||!t.image){return}this.drawImageBatch(t.image,t.program,e);t.dataBuffer.reset();t.image=null;t.program=null;t.globalCompositeOperation=this.globalCompositeOperation;return};Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"lineWidth",{get:function(){return this.state.lineWidth},set:function(t){this.state.lineWidth=t},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"lineCap",{get:function(){return this.state.lineCap},set:function(t){this.state.lineCap=t},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"lineJoin",{get:function(){return this.state.lineJoin},set:function(t){this.state.lineJoin=t},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"miterLimit",{get:function(){return this.state.miterLimit},set:function(t){this.state.miterLimit=t},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"font",{get:function(){return this.state.font},set:function(t){this.state.font=t},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"textAlign",{get:function(){return this.state.textAlign},set:function(t){this.state.textAlign=t},enumerable:false,configurable:true});Object.defineProperty(CanvasRenderingContext2DWebGL.prototype,"textBaseline",{get:function(){return this.state.textBaseline},set:function(t){this.state.textBaseline=t},enumerable:false,configurable:true});CanvasRenderingContext2DWebGL.prototype.beginPath=function(){this.drawPrimitiveQueue.dataBuffer.reset();this.drawPrimitiveQueue.paths.reset()};CanvasRenderingContext2DWebGL.prototype.closePath=function(){this.addPoint(this.firstX,this.firstY,false)};CanvasRenderingContext2DWebGL.prototype.savePrimitiveQueueForClip=function(){var t=this.drawPrimitiveQueue;if(t.dataBuffer.size<6){return}this.state.clipPaths={id:this.currentID++,paths:t.paths.dup(),dataBuffer:t.dataBuffer.dup()}};CanvasRenderingContext2DWebGL.prototype.hasPoint=function(){return this.drawPrimitiveQueue.dataBuffer.size>0};CanvasRenderingContext2DWebGL.prototype.addPoint=function(t,e,i){var n=this.drawPrimitiveQueue;var r=n.dataBuffer;if(i){this.firstX=t;this.firstY=e;n.paths.push1(r.size)}this.lastX=t;this.lastY=e;n.dataBuffer=r.pushX(t,e);return};CanvasRenderingContext2DWebGL.prototype.moveTo=function(t,e){var i=this.state.m;var n=mat2d.transformPointInt(i,t,e);this.addPoint(n.x,n.y,true)};CanvasRenderingContext2DWebGL.prototype.lineTo=function(t,e){var i=this.state.m;var n=mat2d.transformPointInt(i,t,e);this.addPoint(n.x,n.y,false)};CanvasRenderingContext2DWebGL.prototype.getWidth=function(){return this.canvas.w||this.canvas.width};CanvasRenderingContext2DWebGL.prototype.getHeight=function(){return this.canvas.h||this.canvas.height};CanvasRenderingContext2DWebGL.prototype.bigRect=function(t,e,i,n){var r=this.canvasWidth10;var a=this.canvasHeight10;var o=Math.polygonclip([[t.x,t.y],[e.x,e.y],[i.x,i.y],[n.x,n.y]],[-10,-10,r+20,a+20]);if(o){var s=o.length;for(var l=0;l<s;l++){var h=o[l];if(!l){this.addPoint(h[0],h[1],true)}else{this.addPoint(h[0],h[1],false)}}}};CanvasRenderingContext2DWebGL.prototype.rect=function(t,e,i,n){var r=this.state.m;var a=mat2d.transformPointInt(r,t,e,0);var o=mat2d.transformPointInt(r,t+i,e,1);var s=mat2d.transformPointInt(r,t+i,e+n,2);var l=mat2d.transformPointInt(r,t,e+n,3);var h=this.canvasWidth;var u=this.canvasHeight;var c=this.canvasWidth10;var p=this.canvasHeight10;if(a.x<0&&o.x<0&&s.x<0&&l.x<0||a.y<0&&o.y<0&&s.y<0&&l.y<0||a.x>c&&o.x>c&&s.x>c&&l.x>c||a.y>p&&o.y>p&&s.y>p&&l.y>p){return}if(i>h+1||n>u+1){this.bigRect(a,o,s,l)}else{this.addPoint(a.x,a.y,true);this.addPoint(o.x,o.y,false);this.addPoint(s.x,s.y,false);this.addPoint(l.x,l.y,false);this.addPoint(a.x,a.y,false)}};CanvasRenderingContext2DWebGL.prototype.tesselateBezier=function(t,e,i,n,r,a,o,s,l,h){var u,c,p,f,m,d,y,v,g,_,I,x;var w,S,b,C;if(l>10)return;u=(t+i)*.5;c=(e+n)*.5;p=(i+r)*.5;f=(n+a)*.5;m=(r+o)*.5;d=(a+s)*.5;y=(u+p)*.5;v=(c+f)*.5;w=o-t;S=s-e;b=Math.abs((i-o)*S-(n-s)*w);C=Math.abs((r-o)*S-(a-s)*w);if((b+C)*(b+C)<this.tessTol*(w*w+S*S)){this.addPoint(o,s,h);return}g=(p+m)*.5;_=(f+d)*.5;I=(y+g)*.5;x=(v+_)*.5;this.tesselateBezier(t,e,u,c,y,v,I,x,l+1,0);this.tesselateBezier(I,x,g,_,m,d,o,s,l+1,h)};CanvasRenderingContext2DWebGL.prototype.doArcTo=function(t,e,i,n,r){var a={x:0,y:0};var o=this.lastX;var s=this.lastY;var l,h,u,c,p,f,m,d,y,v;var g=false;if(!this.hasPoint()){return}if(Math.ptEquals(o,s,t,e,this.distTol)||Math.ptEquals(t,e,i,n,this.distTol)||Math.distPtSeg(t,e,o,s,i,n)<this.distTol*this.distTol||r<this.distTol){this.addPoint(t,e,false);return}l=o-t;h=s-e;u=i-t;c=n-e;Math.normalize(l,h,a);l=a.x;h=a.y;Math.normalize(u,c,a);u=a.x;c=a.y;p=Math.acos(l*u+h*c);f=r/Math.tan(p/2);if(f>1e4){this.addPoint(t,e,false);return}if(Math.cross(l,h,u,c)>0){m=t+l*f+h*r;d=e+h*f+-l*r;y=Math.atan2(l,-h);v=Math.atan2(-u,c);g=false}else{m=t+l*f+-h*r;d=e+h*f+l*r;y=Math.atan2(-l,h);v=Math.atan2(u,-c);g=true}this.doArc(m,d,r,y,v,g)};CanvasRenderingContext2DWebGL.prototype.doArc=function(t,e,i,n,r,a){var o=0,s=0,l=0,h=0;var u=0,c=0,p=0,f=0,m=0,d=0;var y=0,v=0,g=0,_=0;var I=new Array(3+5*7+100);var x,w,S;var b=!this.hasPoint();s=r-n;if(!a){if(Math.abs(s)>=Math.PI*2){s=Math.PI*2}else{while(s<0)s+=Math.PI*2}}else{if(Math.abs(s)>=Math.PI*2){s=-Math.PI*2}else{while(s>0)s-=Math.PI*2}}w=Math.floor(Math.max(1,Math.min(Math.abs(s)/(Math.PI*.5)+.5,5)));l=s/w/2;h=Math.abs(4/3*(1-Math.cos(l))/Math.sin(l));if(a){h=-h}S=0;for(x=0;x<=w;x++){o=n+s*(x/w);u=Math.cos(o);c=Math.sin(o);p=t+u*i;f=e+c*i;m=-c*i*h;d=u*i*h;if(x==0){this.addPoint(p,f,b)}else{this.bezierTo(y+g,v+_,p-m,f-d,p,f)}y=p;v=f;g=m;_=d}return};CanvasRenderingContext2DWebGL.prototype.quadTo=function(t,e,i,n){var r=this.lastX;var a=this.lastY;var o=r+2/3*(t-r);var s=a+2/3*(e-a);var l=i+2/3*(t-i);var h=n+2/3*(e-n);this.bezierTo(o,s,l,h,i,n)};CanvasRenderingContext2DWebGL.prototype.bezierTo=function(t,e,i,n,r,a){this.tesselateBezier(this.lastX,this.lastY,t,e,i,n,r,a,0,0)};CanvasRenderingContext2DWebGL.prototype.quadraticCurveTo=function(t,e,i,n){var r=this.state.m;var a=mat2d.transformPointInt(r,t,e,0);var o=mat2d.transformPointInt(r,i,n,1);this.quadTo(a.x,a.y,o.x,o.y)};CanvasRenderingContext2DWebGL.prototype.bezierCurveTo=function(t,e,i,n,r,a){var o=this.state.m;var s=mat2d.transformPointInt(o,t,e,0);var l=mat2d.transformPointInt(o,i,n,1);var h=mat2d.transformPointInt(o,r,a,2);this.bezierTo(s.x,s.y,l.x,l.y,h.x,h.y)};CanvasRenderingContext2DWebGL.prototype.arcTo=function(t,e,i,n,r){var a=this.state.m;var o=r*10>>0;var s=mat2d.transformPointInt(a,t,e,0);var l=mat2d.transformPointInt(a,i,n,1);this.doArcTo(s.x,s.y,l.x,l.y,o)};CanvasRenderingContext2DWebGL.prototype.arc=function(t,e,i,n,r,a){var o=i*10>>0;var s=this.state.m;var l=mat2d.transformPointInt(s,t,e);var h=this.canvasWidth10;var u=this.canvasHeight10;if(l.x-o>h||l.x+o<0||l.y-o>u||l.y+o<0){return}this.doArc(l.x,l.y,o,n,r,a)};CanvasRenderingContext2DWebGL.getWebGLContext=function(t,e){var i=null;var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"];var r=e||CanvasRenderingContext2DWebGL.webglOptions;for(var a=0;a<n.length;a++){try{i=t.getContext(n[a],r)}catch(o){}if(i){break}}return i};CanvasRenderingContext2DWebGL.prototype.initGL=function(t){var e=CanvasRenderingContext2DWebGL.getWebGLContext(t,this.webglOptions);e.w=t.width;e.h=t.height;e.enable(e.BLEND);e.enable(e.STENCIL_TEST);e.disable(e.DEPTH_TEST);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);this.gl=e;this.canvas=t;this.buffer=e.createBuffer();WebGLProgramDrawImage.init(e,this.buffer);this.drawPrimitivesProgram=new WebGLProgramDrawPrimitives(e,this.buffer);return e};CanvasRenderingContext2DWebGL.prototype.isPOT=function(t){return t>0&&(t&t-1)===0};CanvasRenderingContext2DWebGL.prototype.loadTextureWithImage=function(t){if(t.texture||!t.width){return t}var e=this.gl;var i=e.createTexture();e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,true);t.texture=i;t.ox=0;t.oy=0;i.w=t.width;i.h=t.height;i.src=t.src;e.bindTexture(e.TEXTURE_2D,i);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);if(this.isPOT(t.width)&&this.isPOT(t.height)){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)}else{e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}e.bindTexture(e.TEXTURE_2D,null);return t};CanvasRenderingContext2DWebGL.prototype.drawImageBatch=function(t,e,i){this.drawCalls++;this.drawImageCalls++;e.draw(t,i)};CanvasRenderingContext2DWebGL.prototype.beginFrame=function(){var t=this.gl;var e=this.getWidth();var i=this.getHeight();var n=this.canvas;this.drawCalls=0;this.drawImageCalls=0;this.drawImageCount=0;this.fillCount=0;this.strokeCount=0;this.clipLevel=0;this.canvasWidth=e;this.canvasHeight=i;this.canvasWidth10=e*10;this.canvasHeight10=i*10;if(t.w!==e||t.h!==i){t.w=e;t.h=i;t.clearColor(1,1,1,1);t.viewport(0,0,n.width,n.height)}if(this.showFPS){this.renderTimes++;this.startTime=Date.now();this.thisSeconds=this.startTime/1e3>>0;if(this.thisSeconds!==this.lastSeconds){this.fps=this.renderTimes;this.lastSeconds=this.thisSeconds;this.renderTimes=0}}if(this.webglOptions.preserveDrawingBuffer){t.clear(t.STENCIL_BUFFER_BIT)}else{t.clear(t.STENCIL_BUFFER_BIT|t.COLOR_BUFFER_BIT)}this.lastX=0;this.lastY=0;this.firstX=0;this.firstY=0;this.lineWidth=1;this.globalAlpha=1;this.globalTint=1;this.textAlign="left";mat2d.identity(this.state.m);this.textBaseline="middle";this.globalImageFilter="normal";this.state.fillStyle=CanvasRenderingContext2DWebGL.fillStyle;this.state.strokeStyle=CanvasRenderingContext2DWebGL.strokeStyle;this.stencilColor=CanvasRenderingContext2DWebGL.stencilColor;this.globalCompositeOperation="source-over";this.beginPath();if(this.autoPacker.isOverflow()){this.autoPacker.reset()}};CanvasRenderingContext2DWebGL.prototype.drawStat=function(t){this.save();this.fillStyle=this.statusBgColor;this.fillRect(0,0,280,35);var e=t+" images("+this.drawImageCount+"/"+this.drawImageCalls+") calls:"+this.drawCalls;this.font=this.statusFont;this.fillStyle=this.statusFontColor;this.textBaseline="top";this.textAlign="left";this.fillText(e,5,5);this.restore();return};CanvasRenderingContext2DWebGL.prototype.onEndFrame=function(){if(this.showFPS){var t=this.fps;this.drawStat(t)}};CanvasRenderingContext2DWebGL.prototype.endFrame=function(){var t=this.stack.length;if(t>0){for(var e=0;e<t;e++){this.restore()}console.log("restore times < save times.")}mat2d.identity(this.state.m);this.globalAlpha=1;this.globalTint=1;this.globalCompositeOperationApply("source-over");this.onEndFrame();this.commitDrawImage()};CanvasRenderingContext2DWebGL.colors={};CanvasRenderingContext2DWebGL.parseColor=function(t){var e=CanvasRenderingContext2DWebGL.colors[t];if(e){return e}var i=t||"white";var n=cs.get(i.toLowerCase());if(!n){n=cs.get("white")}var r=n.value;var a={r:r[0]/255,g:r[1]/255,b:r[2]/255,a:r[3],str:t};CanvasRenderingContext2DWebGL.colors[t]=a;return a};CanvasRenderingContext2DWebGL.State=function(){this.font="16px sans";this.lineWidth=1;this.globalAlpha=1;this.globalTint=1;this.m=mat2d.create();this.clipRect=null;this.clipPaths=null;this.textAlign="left";this.textBaseline="middle";this.globalImageFilter="normal";this.globalCompositeOperation="source-over";this.fillStyle=CanvasRenderingContext2DWebGL.fillStyle;this.strokeStyle=CanvasRenderingContext2DWebGL.strokeStyle};CanvasRenderingContext2DWebGL.createState=function(){if(CanvasRenderingContext2DWebGL.stateCache.length){return CanvasRenderingContext2DWebGL.stateCache.pop()}else{return new CanvasRenderingContext2DWebGL.State}};CanvasRenderingContext2DWebGL.stateCache=[];CanvasRenderingContext2DWebGL.destroyState=function(t){if(t.clipRect){t.clipRect=null}if(t.clipPaths){t.clipPaths=null}CanvasRenderingContext2DWebGL.stateCache.push(t)};CanvasRenderingContext2DWebGL.State.prototype.clone=function(){var t=CanvasRenderingContext2DWebGL.createState();if(this.clipRect){t.clipRect=this.clipRect}if(this.clipPaths){t.clipPaths=this.clipPaths}mat2d.copy(t.m,this.m);t.font=this.font;t.lineWidth=this.lineWidth;t.textAlign=this.textAlign;t.fillStyle=this.fillStyle;t.strokeStyle=this.strokeStyle;t.textBaseline=this.textBaseline;t.globalTint=this.globalTint;t.globalAlpha=this.globalAlpha;t.globalImageFilter=this.globalImageFilter;t.globalCompositeOperation=this.globalCompositeOperation;return t};CanvasRenderingContext2DWebGL.prototype.init=function(t){this.stack=[];this.state=CanvasRenderingContext2DWebGL.createState();this.initGL(t);this.lastUpdateTime=Date.now();var e=WebGLProgramDrawImage.get();this.drawImageQueue={};this.drawImageQueue.globalAlpha=256;this.drawImageQueue.globalCompositeOperation=0;this.drawImageQueue.dataBuffer=e.createDataBuffer(20*1024);this.drawPrimitiveQueue={};this.drawPrimitiveQueue.paths=Int16Array.create(1024);this.drawPrimitiveQueue.dataBuffer=this.drawPrimitivesProgram.createDataBuffer(20*1024);this.autoPacker=new AutoPacker;this.autoPacker.init(this.gl);this.statusFont="20px sans";this.statusFontColor="Green";this.statusBgColor="rgba(0,0,0,1)";return this};CanvasRenderingContext2DWebGL.prototype.ensureCtx2d=function(){if(this.ctx2d){return}this.canvas2d=document.createElement("canvas");this.ctx2d=this.canvas2d.getContext("2d")};CanvasRenderingContext2DWebGL.prototype.measureText=function(t){this.ensureCtx2d();this.ctx2d.font=this.font;return this.ctx2d.measureText(t)};CanvasRenderingContext2DWebGL.prototype.setShowFPS=function(t){this.showFPS=t};CanvasRenderingContext2DWebGL.create=function(t,e){var i=new CanvasRenderingContext2DWebGL(e);CanvasRenderingContext2DWebGL.fillStyle=CanvasRenderingContext2DWebGL.parseColor("white");CanvasRenderingContext2DWebGL.strokeStyle=CanvasRenderingContext2DWebGL.parseColor("black");CanvasRenderingContext2DWebGL.stencilColor=CanvasRenderingContext2DWebGL.parseColor("white");return i.init(t)};HTMLCanvasElement.prototype.getContextOrg=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(t,e){if(this.webglCtx){return this.webglCtx}if(t==="2d-webgl"){if(!this.webglCtx){this.webglCtx=CanvasRenderingContext2DWebGL.create(this,e)}return this.webglCtx}else{return HTMLCanvasElement.prototype.getContextOrg.call(this,t,e)}};var gCantkBuildDate="2016 06 30  18:16:48 CST";console.log("cantk build date: "+gCantkBuildDate);if(!window.CanTK){window.CanTK={}}window.CanTK.config={logoImageSrc:null,progressBarBgSrc:null,progressBarFgSrc:null};function Shape(){return}Shape.MODE_EDITING=0;Shape.MODE_RUNNING=1;Shape.MODE_PREVIEW=2;Shape.HIT_TEST_NONE=0;Shape.HIT_TEST_TL=1;Shape.HIT_TEST_TM=2;Shape.HIT_TEST_TR=3;Shape.HIT_TEST_ML=4;Shape.HIT_TEST_MR=5;Shape.HIT_TEST_BL=6;Shape.HIT_TEST_BM=7;Shape.HIT_TEST_BR=8;Shape.HIT_TEST_HANDLE=9;Shape.HIT_TEST_WORKAREA=10;Shape.HIT_TEST_ROTATION=11;Shape.HIT_TEST_MOVE=12;Shape.HIT_TEST_MAX=13;Shape.HIT_TEST_MM=-1;Shape.ALIGN_LEFT=1;Shape.ALIGN_RIGHT=2;Shape.ALIGN_TOP=3;Shape.ALIGN_BOTTOM=4;Shape.ALIGN_CENTER=5;Shape.ALIGN_MIDDLE=6;Shape.ALIGN_TO_SAME_WIDTH=7;Shape.ALIGN_TO_SAME_HEIGHT=8;Shape.ALIGN_DIST_VER=9;Shape.ALIGN_DIST_HOR=10;Shape.STAT_CREATING_0=0;Shape.STAT_CREATING_1=1;Shape.STAT_CREATING_2=2;Shape.STAT_NORMAL=3;Shape.TEXT_NONE=0;Shape.TEXT_INPUT=1;Shape.TEXT_TEXTAREA=2;Shape.EVT_POINTER_DOWN=1;Shape.EVT_POINTER_MOVE=0;Shape.EVT_POINTER_UP=-1;Shape.prototype.initPanelShape=function(){return};Shape.prototype.initIconShape=function(){return};Shape.prototype.setNearRange=function(t){this.nearRange=t;return this};Shape.prototype.getNearRange=function(){return this.nearRange?this.nearRange:20};Shape.prototype.findNear=function(t){return null};Shape.prototype.getCreatingShape=function(){return this.view?this.view.getCreatingShape():null};Shape.prototype.getTextCookie=function(t){return 0};Shape.isTransparentColor=function(t){return!t||t==="rgba(0,0,0,0)"};Shape.prototype.isFillColorTransparent=function(){return Shape.isTransparentColor(this.style.fillColor)};Shape.prototype.isStrokeColorTransparent=function(){return Shape.isTransparentColor(this.style.lineColor)};Shape.prototype.isTextColorTransparent=function(){return Shape.isTransparentColor(this.style.textColor)};Shape.prototype.setParent=function(t){this.parentShape=t;return this};Shape.prototype.getParent=function(t){if(t){for(var e=this.parentShape;e!=null;e=e.parentShape){if(e.name===t||e.type===t){return e}}}return t?null:this.parentShape};Shape.prototype.textEditable=function(t){return true};Shape.prototype.setInputType=function(t){this.inputType=t;return this};Shape.prototype.editText=function(t){return};Shape.prototype.exec=function(t){if(this.app){this.app.exec(t)}else{t.doit();delete t}return};Shape.prototype.setTextTitle=function(t){this.textTitle=t;return this};Shape.prototype.initShape=function(t,e,i,n,r){this.w=i;this.h=n;this._x=t;this._y=e;this._left=t;this._top=e;this.type=r;this.text="";this.app=null;this.view=null;this.rotation=0;this.scaleX=1;this.scaleY=1;this.selected=false;this.parentShape=null;this.pointerDown=false;this.userMovable=true;this.userResizable=true;this.state=Shape.STAT_NORMAL;this.lastPosition={x:0,y:0};this.selectMarkPoint={x:0,y:0};this.textType=Shape.TEXT_INPUT;this.setDefaultStyle();this.setTextAlignV("middle");this.setTextAlignH("center");this.hitTestResult=Shape.HIT_TEST_NONE;return};Shape.prototype.setDefaultStyle=function(){this.style=new ShapeStyle;this.setStyle(Shape.getDefaultStyle());return this};Shape.prototype.setState=function(t){this.state=t;return this};Shape.prototype.setTextType=function(t){this.textType=t;return this};Shape.prototype.isSelected=function(){return this.selected};Shape.prototype.userRemovable=function(){return true};Shape.prototype.intersectWithRect=function(t){var e=false;var i=this.getX();var n=this.getY();var r=this.getWidth();var a=this.getHeight();var o={x:i,y:n};var s={x:i+r,y:n+a};var l={x:i+r,y:n};var h={x:i,y:n+a};return isPointInRect(o,t)||isPointInRect(s,t)||isPointInRect(l,t)||isPointInRect(h,t)};Shape.prototype.isThisInRect=function(t){var e=false;var i=this.getX();var n=this.getY();var r=this.getWidth();var a=this.getHeight();if(i>=t.x&&i<t.x+t.w&&(n>=t.y&&n<t.y+t.h)){e=true}return e};Shape.prototype.isClicked=function(){if(this.view){return this.view.isClicked()}return false};Shape.prototype.isAltDown=function(){if(this.view){return this.view.isAltDown()}return false};Shape.prototype.isCtrlDown=function(){if(this.view){return this.view.isCtrlDown()}return false};Shape.prototype.onMoving=function(){};Shape.prototype.onMoved=function(){};Shape.prototype.onSized=function(){};Shape.prototype.onUserMoved=function(t,e){};Shape.prototype.onUserResized=function(){};Shape.prototype.fixChildPosition=function(t){var e=this.w;var i=this.h;var n=t.left>=0?t.left:0;var r=t.top>=0?t.top:0;if(n+t.w>e){n=e-t.w}if(r+t.h>i){r=i-t.h}t.left=n;t.top=r;return};Shape.prototype.fixPosition=function(){if(!this.parentShape){return}this.parentShape.fixChildPosition(this);return};Shape.prototype.move=function(t,e){
if(this.left!==t||this.top!==e){this.setLeftTop(t,e);if(!this.isIcon){this.fixPosition();this.onMoved()}}return this};Shape.prototype.moveDelta=function(t,e){return this.move(this.left+t,this.top+e)};Shape.prototype.getWidth=function(){return this.w};Shape.prototype.getHeight=function(){return this.h};Shape.prototype.getPositionInScreen=function(){var t={x:0,y:0};var e=this.getRealScale();var i=this.getPositionInView();if(this.view){t=this.view.getAbsPosition()}i.x=t.x+i.x*e;i.y=t.y+i.y*e;return i};Shape.prototype.getRealScale=function(){return this.view?this.view.getScale():1};Shape.prototype.getAbsPosition=function(){var t=this.getPositionInView();if(this.view){var e=this.view.getAbsPosition();t.x=t.x+e.x;t.y=t.y+e.y}return t};Shape.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.parentShape;while(n!=null){t+=n.left;e+=n.top;n=n.parentShape}i.x=t;i.y=e;return i};Shape.prototype.getXinView=function(){var t=this.getPositionInView().x;return t};Shape.prototype.getYinView=function(){var t=this.getPositionInView().y;return t};Shape.prototype.getX=function(){return this.x};Shape.prototype.getY=function(){return this.y};Shape.prototype.setX=function(t){this.x=t;return this};Shape.prototype.setY=function(t){this.y=t;return this};Shape.prototype.align=function(t,e){return};Shape.prototype.setRotatable=function(t){this.rotatable=t;return this};Shape.prototype.setScaleX=function(t){this.scaleX=t;return this};Shape.prototype.setScaleY=function(t){this.scaleY=t;return this};Shape.prototype.getScale=Shape.prototype.getScaleX=function(){return this.scaleX!==undefined?this.scaleX:this.scale};Shape.prototype.getScaleY=function(){return this.scaleY!==undefined?this.scaleY:this.scale};Shape.prototype.setScale=function(t,e){this.scaleX=t;this.scaleY=e!==undefined?e:t;return this};Shape.prototype.getRotation=function(){return this.rotation};Shape.prototype.setRotation=function(t){this.rotation=t;return this};Shape.prototype.getOpacity=function(){return this.opacity};Shape.prototype.setOpacity=function(t){this.opacity=Math.max(0,t);this.opacity=Math.min(1,this.opacity);return this};Shape.prototype.setStyle=function(t){this.style.copy(t);this.textNeedRelayout=true;return this};Shape.prototype.getStyle=function(){return this.style};Shape.prototype.setName=function(t){this.name=t;return this};Shape.prototype.getName=function(){return this.name};Shape.prototype.getLocaleText=function(t){return t};Shape.prototype.getLocaleInputTips=function(t){return dappGetText(t)};Shape.prototype.setNeedRelayoutText=function(){this.textNeedRelayout=true;return this};Shape.prototype.setTextAlignH=function(t){this.hTextAlign=t;return this};Shape.prototype.setTextAlignV=function(t){this.vTextAlign=t;return this};Shape.prototype.getTextAlignH=function(){var t=this.hTextAlign?this.hTextAlign:"left";return t};Shape.prototype.getTextAlignV=function(){var t=this.vTextAlign?this.vTextAlign:"top";return t};Shape.prototype.toText=function(t){if(t!==null&&t!=undefined){return t+""}else{return""}};Shape.prototype.setText=function(t){this.text=this.toText(t);this.textNeedRelayout=true;return this};Shape.prototype.setText2=function(t){this.text2=t;return this};Shape.prototype.setText3=function(t){this.text3=t;return this};Shape.prototype.getText=function(){return this.text};Shape.prototype.getApp=function(){return this.app};Shape.prototype.getView=function(){return this.view};Shape.prototype.setApp=function(t){this.app=t;return this};Shape.prototype.setView=function(t){this.view=t;return this};Shape.prototype.redrawSelf=function(){if(this.view){var t=this.getRealScale();var e=this.getPositionInView();var i={x:e.x*t,y:e.y*t,w:this.w*t,h:this.h*t};this.view.redraw(i)}return};Shape.prototype.postRedraw=function(t){if(this.view){this.view.postRedraw(t)}return};Shape.prototype.beforePropertyChanged=function(){return};Shape.prototype.afterPropertyChanged=function(){return};Shape.prototype.showProperty=function(){return};Shape.prototype.setSelectedMarkSize=function(t){this.selectedMarkSize=t;return};Shape.prototype.paint=function(t){this.paintSelf(t);if(this.near){var e=this.near.point;var i=this.getNearRange();t.beginPath();t.arc(e.x,e.y,4,0,Math.PI*2);t.fillStyle="Red";t.fill();t.beginPath();t.lineWidth=2;t.arc(e.x,e.y,i,0,Math.PI*2);t.strokeStyle="Black";t.stroke()}return};Shape.prototype.paintSelf=function(t){return};Shape.prototype.setSelected=function(t){if(t){this.selectedTime=Date.now()}if(this.selected===t){return}this.selected=t;if(this.view&&this.view.onShapeSelected){this.view.onShapeSelected(this)}return};Shape.prototype.isVisible=function(){return true};Shape.prototype.findNearPoint=function(t){var e=null;for(var i=0;i<100;i++){e=this.getNearPoint(i);if(!e){break}if(isPointInRect(e,t)){var n={shape:this};n.nearPointIndex=i;n.point={x:e.x,y:e.y};return n}}return null};Shape.prototype.dup=function(){var t=ShapeFactoryGet().createShape(this.type,C_CREATE_FOR_PROGRAM);t.fromJson(this.toJson());t.state=Shape.STAT_NORMAL;return t};Shape.prototype.hitTest=function(t){return Shape.HIT_TEST_NONE};Shape.prototype.showProperty=function(){return};Shape.prototype.onLongPress=function(t){return};Shape.prototype.onGesture=function(t){};Shape.prototype.onDoubleClick=function(t){return true};Shape.prototype.onPointerDown=function(t){this.pointerDown=true;this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.handlePointerEvent(t,Shape.EVT_POINTER_DOWN);return true};Shape.prototype.handlePointerEvent=function(t,e){return false};Shape.prototype.onPointerMove=function(t){if(this.hitTestResult){this.handlePointerEvent(t,Shape.EVT_POINTER_MOVE);return true}return false};Shape.prototype.onPointerUp=function(t){if(this.hitTestResult){this.handlePointerEvent(t,Shape.EVT_POINTER_UP);this.hitTestResult=Shape.HIT_TEST_NONE;return true}this.pointerDown=false;return false};Shape.prototype.onKeyDown=function(t){console.log("onKeyUp Widget: code="+t);return};Shape.prototype.onKeyUp=function(t){console.log("onKeyUp Widget: code="+t);return};Shape.prototype.canBeComponent=function(){return false};Shape.prototype.shouldShowContextMenu=function(){return true};Shape.prototype.toJson=function(){return null};Shape.prototype.fromJson=function(t){return this};Shape.prototype.afterApplyFormat=function(){return};Shape.prototype.applyFormat=function(t){if(!t){return}for(var e in t){var i=t[e];var n=typeof i;if(n==="function"||n==="object"||n==="undefined"){continue}if(e=="type"){continue}if(n==="number"||n==="string"||n==="boolean"){this[e]=i}}if(t.images){for(var e in t.images){var i=t.images[e];if(e==="display"){this.images[e]=i}else{var r=i.getImageSrc();this.setImage(e,r)}}}if(t.style){this.style.fromJson(t.style)}if(t.animations){this.animations=JSON.parse(t.animations);this.defaultAnimationName=t.defaultAnimationName}this.afterApplyFormat();this.textNeedRelayout=true;return};Shape.prototype.setUserMovable=function(t){this.userMovable=t;return this};Shape.prototype.setUserResizable=function(t){this.userResizable=t;return this};Shape.prototype.isUserMovable=function(){return this.userMovable&&!this.isLocked()};Shape.prototype.isUserResizable=function(){return this.userResizable};function splitText(t){t=t.replaceAll("\r\n","\n");t=t.replaceAll("\r","\n");return t.split("\n--\n")}Shape.onRestacked=function(t,e){};function restackShapeInArray(t,e){var i=0;var n=0;var r=null;var a=0;var o=null;for(var s=0;s<t.length;s++){r=t[s];if(r.selected){i++;if(!o){o=r;n=s}}}if(i>1||!o){return}a=n+e;if(a<0||a>=t.length){return}t[n]=t[a];t[a]=o;Shape.onRestacked(t,o);return}function getParentShapeOfShape(t,e){var i=t.parentShape?t.parentShape:t.container;if(!i){i=e}return i}function getParentShapeOfShapes(t){if(!t||t.length===0){return null}var e=t[0];var i=e.parentShape;for(var n=0;n<t.length;n++){var r=t[n];if(r.parentShape!=i){return null}}return i?i:e.view}Shape.prototype.getTextColor=function(t){return this.style.textColor};Shape.prototype.getBgColor=function(t){return this.style.fillColor};Shape.prototype.getLineColor=function(t){return this.style.lineColor};Shape.prototype.defaultDrawText=function(t){var e=this.getWidth(true);var i=this.getLocaleText(this.text);if(!i||this.editing){return}t.save();t.beginPath();t.lineWidth=1;t.font=this.style.getFont();t.fillStyle=this.getTextColor();t.strokeStyle=this.getLineColor();var n=i.split(/\n/);if(n.length<2){if(this.singleLineMode||t.measureText(i).width<1.2*e){this.draw1LText(t)}else{this.drawMLText(t)}}else{this.drawMLText(t)}t.restore();return};Shape.prototype.draw1LText=function(t,e){var i=this.getLocaleText(this.text);if(!i||this.editing){return}if(!this.lines){this.layoutText(t)}if(!this.lines){return}i=this.lines[0];var n=0;var r=0;var a=this.hMargin;var o=this.getWidth(true);var s=this.getTextAlignH();var l=this.getTextAlignV();var h=this.style.textU;var u=this.style.fontSize;var c=t.measureText(i).width;var p=0;var f=0;var m=Math.min(c,o);switch(l){case"middle":{r=this.h>>1;t.textBaseline="middle";if(h){f=Math.floor(r+u*.8)}break}case"bottom":{r=this.h-this.vMargin;t.textBaseline="bottom";if(h){f=r}break}default:{r=this.vMargin;t.textBaseline="top";if(h){f=Math.floor(r+u*1.5)}break}}switch(s){case"center":{n=this.w>>1;t.textAlign="center";if(h){p=Math.max(this.w-c>>1,0)}break}case"right":{n=this.w-this.hMargin;t.textAlign="right";if(h){p=Math.max(this.w-c-a,0)}break}default:{n=this.hMargin;t.textAlign="left";if(h){p=n}break}}if(h){t.moveTo(p,f);t.lineTo(p+m,f);t.stroke()}t.fillText(i,n,r,o);return c};Shape.prototype.drawMLText=function(t,e){if(!this.lines){this.layoutText(t)}if(!this.lines){return}var i=0;var n=0;var r=0;var a=0;var o=0;var s=this.vMargin;var l=this.hMargin;var h=this.getWidth(true);var u=this.getTextAlignH();var c=this.getTextAlignV();var p=this.style.textU;var f=this.style.fontSize;var m=this.getTextLineHeight();var d=this.getTextHeight();t.textBaseline="top";switch(c){case"middle":{n=this.h-d>>1;break}case"bottom":{n=this.h-d-s;break}default:{n=s;break}}n=n<0?0:n;for(var y=0;y<this.lines.length;y++){var v=this.lines[y];if(!v||v==" "){n+=f;continue}if(n+m>=this.h&&!e){break}var g=t.measureText(v).width;o=Math.min(g,h);a=Math.floor(n+(f+m)/2);switch(u){case"center":{i=this.w>>1;t.textAlign="center";if(p){r=Math.max(this.w-g>>1,0)}break}case"right":{i=this.w-l;t.textAlign="right";if(p){r=Math.max(this.w-g-l,0)}break}default:{i=l;t.textAlign="left";if(p){r=i}break}}if(p){t.moveTo(r,a);t.lineTo(r+o,a);t.stroke()}t.fillText(v,i,n,h);n+=m}return};Shape.prototype.getTextHeight=function(){var t=0;var e=this.style.fontSize;var i=this.getTextLineHeight();if(!this.text||!this.lines){return i}for(var n=0;n<this.lines.length;n++){var r=this.lines[n];if(!r||r==" "){t+=e}else{t+=i}}return t};Shape.prototype.getTextLineHeight=function(){return Math.floor(this.style.fontSize*1.5)};Shape.prototype.setTextShadow=function(t){this.textShadow=t;return this};Shape.prototype.isValid=function(){return!this.isInvalid};Shape.prototype.canCopy=function(){return true};Shape.prototype.onDestroy=function(){};Shape.prototype.onRemoved=function(t){};Shape.prototype.detachFromParent=function(){};Shape.prototype.destroy=function(){this.detachFromParent();if(this.container){this.container=null}this.app=null;this.view=null;if(this.children){this.children.clear(true);this.children=null}if(this.images){this.images=null}if(this.events){this.events=null}if(this.style){this.style=null}this.onDestroy();this.isInvalid=true;this.jsonData=null;return};Shape.prototype.isInDesignMode=function(){return false};Shape.iconShapeStyle=null;Shape.getIconShapeStyle=function(){if(!Shape.iconShapeStyle){Shape.iconShapeStyle=ShapeStyle.create();Shape.iconShapeStyle.setLineWidth(1);Shape.iconShapeStyle.setFontSize(8);Shape.iconShapeStyle.setLineColor("Black");Shape.iconShapeStyle.setFillColor("White");Shape.iconShapeStyle.setTextColor("Black")}return Shape.iconShapeStyle};Shape.defaultStyle=null;Shape.getDefaultStyle=function(){if(!Shape.defaultStyle){Shape.defaultStyle=ShapeStyle.create()}return Shape.defaultStyle};function ShapeStyle(){}ShapeStyle.prototype.getFont=function(){var t="";if(this.textI){t="italic  "}if(this.textB){t=t+"bold "}t=t+this.fontSize+'pt "'+this.fontFamily+'"';return t};ShapeStyle.prototype.setLineWidth=function(t){this.lineWidth=t>0?t:1;return};ShapeStyle.prototype.setLineColor=function(t){this.lineColor=t;return};ShapeStyle.prototype.setFillColor=function(t){this.fillColor=t;return};ShapeStyle.prototype.setTextColor=function(t){this.textColor=t;return};ShapeStyle.prototype.setFontSize=function(t){var e=Math.max(t,6);this.fontSize=e;return};ShapeStyle.prototype.setFontFamily=function(t){this.fontFamily=t?t:"serif";return};ShapeStyle.prototype.setTextB=function(t){this.textB=t;return};ShapeStyle.prototype.setTextU=function(t){this.textU=t;return};ShapeStyle.prototype.setTextI=function(t){this.textI=t;return};ShapeStyle.prototype.getStrokeStyle=function(t){return this.strokeColor};ShapeStyle.prototype.copy=function(t){var e=t.toJson();this.fromJson(e);return};ShapeStyle.prototype.toJson=function(){var t={};for(var e in this){var i=this[e];if(typeof i==="string"||typeof i==="number"||typeof i==="boolean"){t[e]=i}}return t};ShapeStyle.prototype.fromJson=function(t){for(var e in t){var i=t[e];if(e.length<4)continue;if(typeof i==="string"||typeof i==="number"||typeof i==="boolean"){this[e]=i}}return};ShapeStyle.prototype.dup=function(){var t=new ShapeStyle;t.copy(this);return t};ShapeStyle.prototype.equalTo=function(t){var e=JSON.stringify(this.toJson());var i=JSON.stringify(t.toJson());return e===i};ShapeStyle.createFromJson=function(t){var e=new ShapeStyle;e.fromJson(t);return e};ShapeStyle.create=function(){return new ShapeStyle};function RShape(){return}RShape.prototype=new Shape;RShape.prototype.MIN_SIZE=10;RShape.prototype.isRect=true;RShape.prototype.getX=function(){if(this.anchor){return this._x}else{return this._left}};RShape.prototype.getY=function(){if(this.anchor){return this._y}else{return this._top}};RShape.prototype.setX=function(t){return this.setPosition(t,this.y)};RShape.prototype.setY=function(t){return this.setPosition(this.x,t)};RShape.prototype.getLeft=function(){return this._left};RShape.prototype.getTop=function(){return this._top};RShape.prototype.setLeft=function(t){this._left=t;return this};RShape.prototype.setTop=function(t){this._top=t;return this};RShape.prototype.setLeftTop=function(t,e){this._left=t;this._top=e;return this};RShape.prototype.setPivot=function(t,e){this.pivotX=t;this.pivotY=e;return this};RShape.prototype.getPivot=function(){return{x:this.pivotX,y:this.pivotY}};RShape.prototype.onPositionChanged=function(){};RShape.prototype.getAnchorX=function(){return this.getAnchor().x};RShape.prototype.getAnchorY=function(){return this.getAnchor().y};RShape.prototype.setAnchorX=function(t){return this.setAnchor(t,this.getAnchorY())};RShape.prototype.setAnchorY=function(t){return this.setAnchor(this.getAnchorX(),t)};RShape.prototype.setAnchor=function(t,e){var i=this.getAnchor();i.x=t;i.y=e;this.pivotX=t;this.pivotY=e;this._x=this._left+this.w*t;this._y=this._top+this.h*e;return this};RShape.prototype.getAnchor=function(){if(!this.anchor){this.anchor={x:0,y:0};this._x=this._left;this._y=this._top}return this.anchor};RShape.prototype.getPosition=function(){var t={};if(!this.anchor){t.x=this._left;t.y=this._top}else{t.x=this._x;t.y=this._y}return t};RShape.prototype.setPosition=function(t,e){var i=this._x!==t||this._y!==e;this._x=t;this._y=e;if(this.anchor){var n=this._x-this.w*this.anchor.x;var r=this._y-this.h*this.anchor.y;this.setLeftTop(n,r)}else{this.setLeftTop(this._x,this._y)}if(i){this.onPositionChanged()}return this};RShape.prototype.realResize=RShape.prototype.setSize=function(t,e){if(this.w!==t||this.h!==e){var i=Math.max(Math.round(t),4);var n=Math.max(Math.round(e),4);if(this.anchor){this._left=this._x-i*this.anchor.x;this._top=this._y-n*this.anchor.y}this.w=i;this.h=n;this.textNeedRelayout=true}return this};RShape.prototype.initRShape=function(t,e,i,n,r){this.initShape(t,e,i,n,r);this.w=i;this.h=i;this.opacity=1;this.hMargin=0;this.vMargin=0;this.rotation=0;this.defWidth=i;this.defHeight=i;this.enable=true;this.visible=true;this.events={};this.pivotX=.5;this.pivotY=.5;this.text="";this.pointerDown=false;this.lastPosition={x:0,y:0};this.pointerDownPosition={x:0,y:0};this.setScale(1,1);if(i===0||n===0){this.w=this.MIN_SIZE;this.h=this.MIN_SIZE;this.setState(Shape.STAT_CREATING_0)}return};RShape.prototype.onPointerDown=function(t){if(!this.enable&&!this.isInDesignMode()){console.log(this.name+" is disable, ignore pointer events.");return}this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y;this.postRedraw();return this.onPointerDownNormal(t)};RShape.prototype.onPointerMove=function(t){if(!this.enable&&!this.isInDesignMode()){console.log("Ignore pointer event because this.enable is false.");return}if(this.isLocked()){return false}return this.onPointerMoveNormal(t)};RShape.prototype.onPointerUp=function(t){if(!this.enable&&!this.isInDesignMode()){console.log("Ignore pointer event because this.enable is false.");return}var e=this.onPointerUpNormal(t);this.pointerDown=false;this.postRedraw();return e};RShape.prototype.onPointerDownNormal=function(t){this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){return false}this.pointerDown=true;this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.handlePointerEvent(t,1);return true};RShape.prototype.onPointerMoveNormal=function(t){if(this.hitTestResult){this.handlePointerEvent(t,0);return true}return false};RShape.prototype.onPointerUpNormal=function(t){if(this.hitTestResult){this.handlePointerEvent(t,-1);this.hitTestResult=Shape.HIT_TEST_NONE;return true}return false};RShape.prototype.fixSize=function(){if(this.w<this.MIN_SIZE){this.w=this.MIN_SIZE}if(this.h<this.MIN_SIZE){this.h=this.MIN_SIZE}if(this.wMin&&this.w<this.wMin){this.w=this.wMin}if(this.wMax&&this.w>this.wMax){this.w=this.wMax}if(this.hMax&&this.h>this.hMax){this.h=this.hMax}if(this.hMin&&this.h<this.hMin){this.h=this.hMin}if(this.whRadio){if(this.whRadio>1){this.h=Math.floor(this.w/this.whRadio)}else{this.w=Math.floor(this.h*this.whRadio)}}if(this.parentShape){this.parentShape.fixChildSize(this)}return};RShape.prototype.fixChildSize=function(t){var e=this.w;var i=this.h;if(t.x+t.w>e){t.w=e-t.x}if(t.y+t.h>i){t.h=i-t.y}return};RShape.prototype.setDefSize=function(t,e){this.defWidth=t;this.defHeight=e;this.w=t;this.h=e;return this};RShape.prototype.setSizeLimit=function(t,e,i,n,r){this.wMin=t;this.wMax=i;this.hMin=e;this.hMax=n;this.whRadio=r;return this};RShape.prototype.resizeDelta=function(t,e){this.resize(this.w+t,this.h+e);return};RShape.prototype.resize=function(t,e){if(this.w!==t||this.h!==e){this.setSize(t,e);if(!this.isIcon){this.onSized();this.fixSize()}}return this};RShape.prototype.translate=function(t){t.translate(this._left,this._top);return};RShape.prototype.setClipRect=function(t,e,i,n){if(arguments.length>3){var r={};r.x=t;r.y=e;r.w=i;r.h=n;this.clipInfo=r}else{this.clipInfo=null}return this};RShape.prototype.setClipCircle=function(t,e,i){if(arguments.length>2){circle={};circle.x=t;circle.y=e;circle.r=i;this.clipInfo=circle}else{this.clipInfo=null}return this};RShape.prototype.onClip=function(t){if(this.clipInfo){var e=this.clipInfo;t.beginPath();if(e.r){t.arc(e.x,e.y,e.r,0,Math.PI*2)}else{t.rect(e.x,e.y,e.w,e.h)}t.clip();t.beginPath()}};RShape.prototype.applyScale=function(t){var e=this.getScaleX();var i=this.getScaleY();var n=this.w*this.pivotX;var r=this.h*this.pivotY;t.translate(n,r);t.scale(e,i);t.translate(-n,-r)};RShape.prototype.applyRotation=function(t){if(Math.abs(this.rotation)>1e-4){var e=this.w*this.pivotX;var i=this.h*this.pivotY;t.translate(e,i);t.rotate(this.rotation);t.translate(-e,-i)}};RShape.prototype.applyTransform=function(t){t.globalAlpha*=this.opacity;if(this.offsetX){t.translate(this.offsetX,0)}if(this.offsetY){t.translate(0,this.offsetY)}this.applyRotation(t);this.applyScale(t);return};RShape.prototype.isPointIn=function(t,e){return isPointInRect(e,this)};RShape.prototype.drawImage=function(t){return};RShape.prototype.paintShape=function(t){t.rect(0,0,this.w,this.h);return};RShape.prototype.setTextNeedRelayout=function(t){this.textNeedRelayout=t;return this};RShape.prototype.layoutText=function(t){if(!this.textNeedRelayout||this.textType===Shape.TEXT_NONE){return}t.font=this.style.getFont();var e=this.vMargin?this.vMargin:10;var i=this.w-2*e;if(i>0){this.lines=layoutText(t,this.style.fontSize,this.getLocaleText(this.text),i)}else{this.lines=[]}this.textNeedRelayout=false;return};RShape.prototype.drawTextUnderLine=function(t,e,i,n){var r=0;var a=0;var o=0;var s=0;if(!this.style.textU){return}s=t.measureText(n).width;if(this.textBaseline==="middle"){o=this.style.fontSize/2;if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}else if(this.textBaseline==="top"){o=this.style.fontSize;if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}else{if(this.textAlign==="center"){r=e-s/2}else if(this.textAlign==="left"){r=e}else{r=e-s}}a=i+o;t.moveTo(r,a);t.lineTo(r+s,a);t.lineWidth=1;t.stroke();return};RShape.prototype.needDrawTextTips=function(){return true};RShape.prototype.setInputTips=function(t){this.inputTips=t;return this};RShape.prototype.getTextTipsPosition=function(){var t={};t.x=this.getWidth()>>1;t.y=this.getHeight()>>1;t.textAlign="center";t.textBaseline="middle";return t};RShape.prototype.drawTextTips=function(t){if(this.text||this.isIcon||this.w<120||this.h<20||this.editing){return}var e=this.getTextTipsPosition();var i=e.x;var n=e.y;t.textAlign=e.textAlign;t.textBaseline=e.textBaseline;t.font=this.style.getFont();t.fillStyle="#E0E0E0";if(this.inputTips){t.fillText(this.getLocaleInputTips(this.inputTips),i,n,this.getWidth())}return};RShape.prototype.getOneLineText=function(t,e){var i="";var n=this.getWidth(true);if(t.measureText(e).width<=n){return e}for(var r=0;r<e.length;r++){var a=e[r];n=n-t.measureText(a).width;if(n<0){break}i=i+a}return i};RShape.prototype.setMargin=function(t,e){this.vMargin=Math.floor(Math.min(t,.5*this.w));this.hMargin=Math.floor(Math.min(e,.5*this.h));return this};RShape.prototype.getVMargin=function(){return this.vMargin?this.vMargin:0};RShape.prototype.getHMargin=function(){return this.hMargin?this.hMargin:0};RShape.prototype.setWidth=function(t){return this.setSize(t,this.h)};RShape.prototype.setHeight=function(t){return this.setSize(this.w,t)};RShape.prototype.getWidth=function(t){if(t){return this.w-2*this.getHMargin()}else{return this.w}};RShape.prototype.getHeight=function(t){if(t){return this.h-2*this.getVMargin()}else{return this.h}};RShape.prototype.drawText=function(t){this.defaultDrawText(t);return};RShape.prototype.prepareStyle=function(t){var e=this.style;t.lineWidth=e.lineWidth;t.strokeStyle=e.lineColor;t.fillStyle=e.fillColor;return};RShape.prototype.resetStyle=function(t){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=0;t.fillStyle="White";t.beginPath();return};RShape.prototype.strokeFill=function(t){if(this.style.enableShadow||isOldIE()){if(t.lineWidth>=1){if(!this.isStrokeColorTransparent()){t.stroke()}}if(!this.isFillColorTransparent()){t.fill()}}else{if(!this.isFillColorTransparent()){t.fill()}if(t.lineWidth>=1){if(!this.isStrokeColorTransparent()){t.stroke()}}}return};RShape.prototype.paintSelf=function(t){return};RShape.prototype.getCanvasContext2D=function(){return this.view.getCanvas2D()};RShape.prototype.getHitTestCanavs=function(){var t=this.view.getCanvas2D();if(CantkRT.isCantkRTCordova()){return t.getCanvasRenderingContext2D("2d")}else{return t}};RShape.prototype.hitTest=function(t){var e=Shape.HIT_TEST_NONE;if(!this.enable&&!this.isInDesignMode()){return e}var i=this;var n=this.getHitTestCanavs();function r(t){i.translate(t);i.applyTransform(t)}if(this.isPointInMatrix({x:0,y:0,w:this.w,h:this.h},t,r)){e=Shape.HIT_TEST_MM}return e};RShape.prototype.isLocked=function(){return false};RShape.prototype.lock=function(){this.locked=true;return this};RShape.prototype.unlock=function(){this.locked=false;return this};RShape.prototype.execMoveResize=function(t,e,i,n){if(window.MoveResizeCommand){this.exec(new MoveResizeCommand(this,t,e,i,n))}else{if(t||t===0){this.setLeft(t)}if(e||e===0){this.setTop(e)}if(i||i===0){this.w=i}if(n||n===0){this.h=n}}return};RShape.prototype.onUserMoving=function(){};RShape.prototype.onUserResizing=function(){};RShape.prototype.onUserRotating=function(){};RShape.prototype.handlePointerEvent=function(t,e){if(e===Shape.EVT_POINTER_DOWN){this.saveLeft=this.getLeft();this.saveTop=this.getTop();this.saveW=this.w;this.saveH=this.h;this.saveRotation=this.rotation;return}var i=this.saveW;var n=this.saveH;var r=t.x-this.pointerDownPosition.x;var a=t.y-this.pointerDownPosition.y;var o=0;var s=0;var l=i;var h=n;switch(this.hitTestResult){case Shape.HIT_TEST_TL:{o=r;s=a;l=i-r;h=n-a;break}case Shape.HIT_TEST_TM:{s=a;h=n-a;break}case Shape.HIT_TEST_TR:{o=0;s=a;l=i+r;h=n-a;break}case Shape.HIT_TEST_ML:{o=r;l=i-r;break}case Shape.HIT_TEST_MR:{l=i+r;break}case Shape.HIT_TEST_BL:{o=r;l=i-r;h=n+a;break}case Shape.HIT_TEST_BM:{h=n+a;break}case Shape.HIT_TEST_BR:{l=i+r;h=n+a;break}case Shape.HIT_TEST_MOVE:case Shape.HIT_TEST_MM:{o=r;s=a;break}case Shape.HIT_TEST_ROTATION:{var u=(this.w>>1)+this.getLeft();var c=(this.h>>1)+this.getTop();var p=Math.lineAngle({x:u,y:c},t)+Math.PI*.5;if(p>Math.PI*2){p=p-Math.PI*2}this.setRotation(p);this.onUserRotating();if(e===Shape.EVT_POINTER_UP){var f=this.rotation;this.rotation=this.saveRotation;this.exec(AttributeCommand.create(this,"rotation",null,f))}break}default:break}if(e===Shape.EVT_POINTER_UP){if(!this.isUserMovable()){this.setLeftTop(this.saveLeft,this.saveTop)}if(!this.isUserResizable()){this.w=i;this.h=n}var m=this.w;var d=this.h;var y=this.getLeft();var v=this.getTop();if(y!==this.saveLeft||v!==this.saveTop||m!==i||d!==n){this.w=i;this.h=n;this.setLeftTop(this.saveLeft,this.saveTop);y=y===this.saveLeft?null:Math.round(y);v=v===this.saveTop?null:Math.round(v);m=m===i?null:Math.round(m);d=d===n?null:Math.round(d);this.execMoveResize(y,v,m,d);this.onUserMoved();this.onUserResized()}}else{if(o||s){if(this.isUserMovable()){this.setLeftTop(Math.round(this.saveLeft+o),Math.round(this.saveTop+s));this.onUserMoving()}}if(i!==l||n!==h){if(this.isUserResizable()){this.w=Math.max(Math.round(l),this.MIN_SIZE);this.h=Math.max(Math.round(h),this.MIN_SIZE);this.onUserResizing()}}}if(this.hitTestResult===Shape.HIT_TEST_HANDLE){r=t.x-this.lastPosition.x;a=t.y-this.lastPosition.y;this.moveHandle(r,a)}this.postRedraw();this.lastPosition.x=t.x;this.lastPosition.y=t.y;return true};RShape.prototype.onKeyDown=function(t){return};RShape.prototype.onKeyUp=function(t){return};RShape.prototype.toJson=function(){var t={};return this.doToJson(t)};RShape.saveProps=["type","name","uid","z","w","h","pivotX","pivotY","rotation","opacity","hMargin","vMargin","scaleX","scaleY","spacer","roundRadius","runtimeVisible","enable","visible","text","iconVMargin","iconHMargin","locked"];RShape.prototype.propsToJson=function(t,e){var i=e.length;for(var n=0;n<i;n++){var r=e[n];var a=this[r];if(a!==undefined){t[r]=a}}return this};RShape.prototype.propsFromJson=function(t,e){var i=e.length;for(var n=0;n<i;n++){var r=e[n];var a=t[r];if(a!==undefined){this[r]=a}}return this};RShape.prototype.doToJson=function(t){this.propsToJson(t,RShape.saveProps);t.x=this.left;t.y=this.top;t.style=this.style.toJson();return t};RShape.prototype.onFromJsonDone=function(t){};RShape.prototype.fromJson=function(t){this.isUnpacking=true;this.doFromJson(t);this.onFromJsonDone(t);this.isUnpacking=false;return this};RShape.prototype.doFromJson=function(t){this.textNeedRelayout=true;this.state=Shape.STAT_NORMAL;this.propsFromJson(t,RShape.saveProps);if(t.x!==undefined){this.left=t.x}if(t.y!==undefined){this.top=t.y}if(t.docURL!==undefined&&t.docURL.length>0){this.docURL=t.docURL}this.setText(t.text);this.setEnable(t.enable);this.setVisible(t.visible!==false);this.style.fromJson(t.style);return};RShape.prototype.setImage=function(t){if(t===this.imageUrl){return}this.imageUrl=t;this.image=new WImage(t);return this};RShape.prototype.asIcon=function(){this.setSize(36,36);if(!this.isIcon){this.setStyle(Shape.getIconShapeStyle())}this.isIcon=true;return};RShape.prototype.showProperty=function(){var t=this.getApp();if(t){t.showRShapePropertyDialog(this)}return};RShape.prototype.getMoveDeltaX=function(){return this.view?this.view.getMoveDeltaX():0};RShape.prototype.getMoveDeltaY=function(){return this.view?this.view.getMoveDeltaY():0};RShape.prototype.getMoveAbsDeltaX=function(){return this.view?this.view.getMoveAbsDeltaX():0};RShape.prototype.getMoveAbsDeltaY=function(){return this.view?this.view.getMoveAbsDeltaY():0};RShape.prototype.setRoundRadius=function(t){this.roundRadius=t;return this};RShape.prototype.setFillColor=function(t){this.style.setFillColor(t);return this};RShape.prototype.setLineColor=function(t){this.style.setLineColor(t);return this};RShape.prototype.setTextColor=function(t){this.style.setTextColor(t);return this};RShape.prototype.getFillColor=function(){return this.style.fillColor};RShape.prototype.getLineColor=function(){return this.style.lineColor};RShape.prototype.getTextColor=function(){return this.style.textColor};Object.defineProperty(RShape.prototype,"x",{get:function(){return this.getX()},set:function(t){this.setX(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"y",{get:function(){return this.getY()},set:function(t){this.setY(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"left",{get:function(){return this.getLeft()},set:function(t){this.setLeft(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"top",{get:function(){return this.getTop()},set:function(t){this.setTop(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"width",{get:function(){return this.getWidth()},set:function(t){this.setWidth(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"height",{get:function(){return this.getHeight()},set:function(t){this.setHeight(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"anchorX",{get:function(){return this.getAnchorX()},set:function(t){this.setAnchorX(t)},enumerable:true,configurable:true});Object.defineProperty(RShape.prototype,"anchorY",{get:function(){return this.getAnchorY()},set:function(t){this.setAnchorY(t)},enumerable:true,configurable:true});function RShapeInit(t,e){t.initRShape(0,0,40,40,e);return t}var C_CREATE_FOR_USER=0;var C_CREATE_FOR_ICON=1;var C_CREATE_FOR_PROGRAM=2;function ShapeCreator(t,e,i,n){this.type=t;this.icon=i;this.name=e;this.visible=n;this.isVisibleToUser=function(){return this.visible};this.getID=function(){return this.type};this.getIcon=function(){return this.icon};this.getName=function(){return this.name};this.createIconShape=function(){if(!this.iconShape){this.iconShape=this.createShape(C_CREATE_FOR_ICON);this.iconShape.initIconShape()}return this.iconShape};this.createShape=function(t){return null};return}function ShapeFactory(){this.defaultCategory=null;this.recentUsed=[];this.creators=[];this.categories={};this.categoryNames=[];this.diagramTypes=[];this.listeners=[];ShapeFactory.CATEGORY_RECENT_USED="Recent Used";ShapeFactory.CATEGORY_USER_COMPONENTS="User Component";ShapeFactory.CATEGORY_USER="User";ShapeFactory.CATEGORY_GAME="Game";ShapeFactory.CATEGORY_ORGANIZATION="Organization";this.setDefaultCategory=function(t){this.defaultCategory=t;return};this.getDiagramTypes=function(){return this.diagramTypes};this.addDiagramType=function(t,e){var i={name:t,defaultCategory:e};this.diagramTypes.push(i);return};this.removeCategoryName=function(t){this.categoryNames.remove(t);return};this.removeShapeCreator=function(t,e){var i=this.find(t);var n=this.categories[e];
if(i){this.creators.remove(i);if(n){n.remove(i);this.notifyChanged("remove",e,i)}}return};this.isPlacehodler=function(t){return t==="---"};this.isUserComponents=function(t){return t===ShapeFactory.CATEGORY_USER_COMPONENTS};this.addPlaceholder=function(){this.categoryNames.push("---");return};this.loadRecentUsedShapeCreators=function(){var t=WebStorage.get("recentUsed");var e=t?JSON.parse(t):[];for(var i=0;i<e.length;i++){var n=e[i];var r=this.find(n);if(r){this.addShapeCreator(r,ShapeFactory.CATEGORY_RECENT_USED);this.recentUsed.push(n)}}return};this.addRecentUsedShapeCreator=function(t){var e=this.find(t);if(e){this.recentUsed.remove(t);this.recentUsed.push(t);if(this.recentUsed.length>10){this.recentUsed.shift()}WebStorage.set("recentUsed",JSON.stringify(this.recentUsed));this.addShapeCreator(e,ShapeFactory.CATEGORY_RECENT_USED)}};this.addShapeCreator=function(t,e){this.notifyChanged("add",e,t);if(e!=ShapeFactory.CATEGORY_RECENT_USED){this.creators.push(t)}if(e){if(!this.defaultCategory){this.setDefaultCategory(e)}if(!this.categories[e]){this.categories[e]=[];if(e==ShapeFactory.CATEGORY_RECENT_USED){this.categoryNames.unshift(e)}else{this.categoryNames.push(e)}}this.categories[e].remove(t);if(e==ShapeFactory.CATEGORY_RECENT_USED){this.categories[e].unshift(t)}else{this.categories[e].push(t)}}return};this.getCategoryNames=function(){return this.categoryNames};this.getDefaultCategory=function(){return this.categories[this.defaultCategory]};this.getByCategory=function(t){return this.categories[t]};this.find=function(t){for(var e=0;e<this.creators.length;e++){var i=this.creators[e];if(i.getID()===t){return i}}return null};this.createShapeByUser=function(t,e){return this.createShape(t,C_CREATE_FOR_USER,e)};this.createShapeByProgram=function(t,e){return this.createShape(t,C_CREATE_FOR_PROGRAM,e)};this.createShape=function(t,e,i){if(!t){return null}var n=this.find(t);if(n){var r=n.createShape(e);if(e===C_CREATE_FOR_USER){r.initPanelShape()}return r}console.log("not found type "+t+", create ui-unkown instead.");if(!i){n=this.find("ui-unkown");if(n){return n.createShape(e)}return null}};this.addListener=function(t){this.listeners.push(t);return this};this.removeListener=function(t){this.listeners.remove(t);return this};this.notifyChanged=function(t,e,i){var n=this.listeners;for(var r=0;r<n.length;r++){var a=n[r];if(a){a(t,e,i)}}return};return}ShapeFactory.instance=null;ShapeFactory.getInstance=function(){if(!ShapeFactory.instance){ShapeFactory.instance=new ShapeFactory;setTimeout(function(){ShapeFactory.instance.loadRecentUsedShapeCreators()},2e3)}return ShapeFactory.instance};function ShapeFactoryGet(){return ShapeFactory.getInstance()}function dappSetDefaultCategory(t){return ShapeFactory.getInstance().setDefaultCategory(t)}function cantkRegShapeCreator(t,e){return ShapeFactory.getInstance().addShapeCreator(t,e)}function TView(){}TView.prototype=new WWidget;TView.prototype.init=function(t,e,i,n,r){WWidget.prototype.init.call(this,t,e,i,n,r);this.scale=1;this.wmRect={};this.lastPointerPosition={x:0,y:0};this.pointerDownPosition={x:0,y:0};return this};TView.prototype.setDoc=function(t){this.doc=t;return this};TView.prototype.loadJson=function(t){return this.doc.loadJson(t)};TView.prototype.loadString=function(t){return this.doc.loadString(t)};TView.prototype.loadURL=function(t){return this.doc.loadURL(t)};TView.prototype.getDeviceConfig=function(){return this.doc.getDeviceConfig()};TView.prototype.getWindowManager=function(){return this.doc.getWindowManager()};TView.prototype.getCurrentWindow=function(){return this.doc.getCurrentWindow()};TView.prototype.getMetaInfo=TView.prototype.getMeta=function(){return this.doc.getMeta()};TView.prototype.getMoveDeltaX=function(){return this.moveDeltaX};TView.prototype.getMoveDeltaY=function(){return this.moveDeltaY};TView.prototype.getMoveAbsDeltaX=function(){return this.moveAbsDeltaX};TView.prototype.getMoveAbsDeltaY=function(){return this.moveAbsDeltaY};TView.prototype.updateLastPointerPoint=function(t,e){if(e){this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y}this.moveDeltaX=t.x-this.lastPointerPosition.x;this.moveDeltaY=t.y-this.lastPointerPosition.y;this.moveAbsDeltaX=t.x-this.pointerDownPosition.x;this.moveAbsDeltaY=t.y-this.pointerDownPosition.y;this.lastPointerPosition.x=t.x;this.lastPointerPosition.y=t.y;return};TView.prototype.autoScale=function(){var t=this.getWindowManager();if(!t)return;var e=1;var i=this.getWidth();var n=this.getHeight();if(t.w<t.h){e=n/(t.h+100)}else{e=i/(t.w+100)}if(e>1){e=1}this.zoomTo(e);return};TView.prototype.getScale=function(){return this.scale};TView.prototype.onScaled=function(t){return};TView.prototype.zoomTo=TView.prototype.setScale=function(t){this.scale=Math.min(2,Math.max(.5,Math.round(t*10)/10));this.onScaled(this.scale);return this};TView.prototype.zoomIn=function(){return this.zoomTo(this.scale*1.2)};TView.prototype.zoomOut=function(){return this.zoomTo(this.scale*.8)};TView.prototype.getWmRect=function(){var t=this.wmRect;var e=this.getWindowManager();if(e){var i=this.getWidth();var n=this.getHeight();t.w=e.w*this.scale;t.h=e.h*this.scale;t.x=i-t.w>>1;t.y=n-t.h>>1}else{t.x=0;t.y=0;t.w=0;t.h=0}return t};TView.prototype.paintSelf=function(t){var e=this.getWidth();var i=this.getHeight();t.save();t.beginPath();t.rect(0,0,e,i);t.clip();t.beginPath();var n=this.getWindowManager();if(n){var r=this.getWmRect();t.translate(r.x,r.y);t.scale(this.scale,this.scale);n.setLeftTop(0,0);n.paintSelf(t)}t.restore();return};TView.prototype.translatePointToWm=function(t){var e=this.getWmRect();var i=this.translatePoint(t);var n={x:i.x-e.x,y:i.y-e.y};n.x=n.x/this.scale;n.y=n.y/this.scale;return n};TView.prototype.translatePointToView=function(t){var e={x:t.x,y:t.y};var i=this.getWindowManager();e.x+=i.getX();e.y+=i.getY();return e};TView.prototype.onDoubleClick=function(t){this.updateLastPointerPoint(t,true);WWidget.prototype.onDoubleClick.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){var i=this.translatePointToWm(t);e.onDoubleClick(i)}}return};TView.prototype.onPointerDown=function(t){this.updateLastPointerPoint(t,true);WWidget.prototype.onPointerDown.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){var i=this.translatePointToWm(t);e.onPointerDown(i)}}return};TView.prototype.onPointerMove=function(t){this.updateLastPointerPoint(t);WWidget.prototype.onPointerMove.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){var i=this.translatePointToWm(t);e.onPointerMove(i)}}return};TView.prototype.onPointerUp=function(t){WWidget.prototype.onPointerUp.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){var i=this.translatePointToWm(t);e.onPointerUp(i)}}return};TView.prototype.onKeyDown=function(t){WWidget.prototype.onKeyDown.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){e.onKeyDown(t)}}return};TView.prototype.onKeyUp=function(t){WWidget.prototype.onKeyUp.call(this,t);if(!this.target){var e=this.getWindowManager();if(e){e.onKeyUp(t)}}return};TView.prototype.detectDeviceConfig=function(){return this.doc.detectDeviceConfig()};function TDocument(){}TDocument.magic="cantk";TDocument.prototype.loadURL=function(t){httpGetJSON(t,this.loadJson.bind(this));return this};TDocument.prototype.loadString=function(t){try{var e=JSON.parse(t);this.loadJson(e)}catch(i){console.log("loadString:"+i.message)}return this};TDocument.prototype.getEmptyDoc=function(){var t={};t.version=2;t.magic=TDocument.magic;return t};TDocument.prototype.getLocales=function(){if(!this.doc.locales){this.doc.locales={"default":{},en:{},zh:{}}}return this.doc.locales};TDocument.prototype.getAssetsConfig=function(){var t=this.getMeta();return t.assetsConfig||TDocument.getDefaultAssetsConfig()};TDocument.prototype.getAssetsConfigStr=function(){var t=this.getAssetsConfig();return JSON.stringify(t,null,"	")};TDocument.prototype.setAssetsConfigStr=function(t){try{var e=JSON.parse(t);this.setAssetsConfig(e)}catch(i){console.log("setAssetsConfigStr:"+i.message)}return this};TDocument.prototype.setAssetsConfig=function(t){var e=this.getMeta();e.assetsConfig=t;return this};TDocument.getDefaultAssetsConfig=function(){if(!TDocument.defaultAssetsConfig){var t={};t.assets={};t.assets.sizes=["1280x800","480x800"];t.assets.densities=["hdpi","xhdpi"];t.assets.languages=["en","zh"];t.design={};t.design.size="480x800";t.design.density="hdpi";t.design.language="en";t.map={};t.map.size={"1280x720":"480x800","480x800":"480x800"};t.map.density={ldpi:"hdpi",mdpi:"hdpi",xhdpi:"hdpi",xxhdpi:"hdpi"};t.map.language={en:"en",zh:"en"};TDocument.defaultAssetsConfig=t}return TDocument.defaultAssetsConfig};TDocument.prototype.setLocales=function(t){this.doc.locales=t;return this};TDocument.prototype.getMetaInfo=TDocument.prototype.getMeta=function(){return this.doc.meta};TDocument.prototype.getDocID=function(){return this.doc.docid};TDocument.prototype.getDeviceConfig=function(){return this.wm.deviceConfig};TDocument.prototype.loadV1=function(t){if(!t.pages||!t.pages[0].shapes||!t.pages[0].shapes[0].children){return this}var e=this.getEmptyDoc();e.meta=t.meta;e.docid=t.docid;var i=t.pages[0].shapes[0];function n(t){if(t.type==="ui-window-manager"){e.wm=t;return}if(t.children){var i=t.children.length;for(var r=0;r<i;r++){var a=t.children[r];n(a)}}}n(i);e.deviceConfig=i.config;this.loadV2(e);return};TDocument.prototype.createWindowManager=function(t){var e=ShapeFactory.getInstance();var i=e.createShapeByProgram(t.wm.type);i.fromJson(t.wm);i.deviceConfig=t.deviceConfig;return i};TDocument.prototype.onBeforeLoad=function(t){};TDocument.prototype.loadV2=function(t){this.doc=t;this.onBeforeLoad(t);this.wm=this.createWindowManager(t);var e=this.getMeta();if(e&&e.general){document.title=e.general.appname}if(e&&e.extfonts){ResLoader.loadFonts(e.extfonts)}var i=["soundMusicAutoPlay","soundMusicLoop","soundMusicVolume","soundMusicURLs","soundEffectsEnalbe","soundEffectVolume","soundEffectURLs"];i.forEach(function(e){if(e in t.wm){this.wm[e]=t.wm[e]}},this);var n=this.wm;if(e&&e.soundConfig){var i=["soundMusicAutoPlay","soundMusicLoop","soundMusicVolume","soundMusicURLs","soundEffectsEnalbe","soundEffectVolume","soundEffectURLs"];i.forEach(function(t){n[t]=e.soundConfig[t]});n.setSoundMusicVolume(n.soundMusicVolume);n.setSoundEffectVolume(n.soundEffectVolume)}this.onLoad();return};TDocument.prototype.loadJson=function(t){if(!t)return this;if(t.magic==="drawapps"){this.loadV1(t)}else if(t.magic===TDocument.magic){this.loadV2(t)}else if(t.code===302){window.location.href=t.data}else{console.log("invalid json")}return this};TDocument.prototype.getWindowManager=function(){return this.wm};TDocument.prototype.getCurrentWindow=function(){return this.wm?this.wm.getCurrentWindow():null};TDocument.prototype.detectDeviceConfig=function(){if(this.detectedDeviceConfig){return this.detectedDeviceConfig}var t={version:4};if(isAndroid()){t.platform="android"}else if(isIPhone()||isIPad()){t.platform="iphone"}else if(isFirefoxOS()){t.platform="firefox"}else if(isWinPhone()){t.platform="winphone"}else if(isTizen()){t.platform="tizen"}else{t.platform="android"}if(window.devicePixelRatio>2.2){t.lcdDensity="xxhdpi"}else if(window.devicePixelRatio>1.5){t.lcdDensity="xhdpi"}else if(window.devicePixelRatio>1.1){t.lcdDensity="hdpi"}else if(window.devicePixelRatio>.8){t.lcdDensity="mdpi"}else if(!window.devicePixelRatio){var e=Math.min(window.orgViewPort.width,window.orgViewPort.height);if(e>600){t.lcdDensity="xhdpi"}else{t.lcdDensity="hdpi"}}else{t.lcdDensity="ldpi"}if(isFirefoxOS()){t.lcdDensity="mdpi"}if(!isMobile()){t.lcdDensity="hdpi"}this.detectedDeviceConfig=t;return t};function TRuntimeView(){}TRuntimeView.prototype=new TView;TRuntimeView.prototype.init=function(t,e,i,n,r,a){this.app=a;this.type="app-view";TView.prototype.init.call(this,t,e,i,n,r);this.preview=a.preview;this.setDoc(new TRuntimeDocument);this.doc.onLoad=this.onLoad.bind(this);WWindowManager.onMultiTouch=this.onMultiTouch.bind(this);WWindowManager.instance.drawWindows=this.paintSelf.bind(this);return this};TRuntimeView.prototype.onMultiTouch=function(t,e,i){var n=this.getWindowManager();if(n){n.onMultiTouch(t,e,i)}};TRuntimeView.prototype.resizeForFixWidth=function(t){var e=cantkGetViewPort();var i=t.w/e.width;var n=t.w;var r=e.height*i;var a=e.width;var o=e.height;this.app.resizeWin(n,r);this.app.resizeCanvas(n,r,0,0,a,o);WWindowManager.setInputScale(i,i);t.setSize(n,r);t.relayout()};TRuntimeView.prototype.resizeForFixHeight=function(t){var e=cantkGetViewPort();var i=t.h/e.height;var n=t.h;var r=e.width*i;var a=e.width;var o=e.height;this.app.resizeWin(r,n);this.app.resizeCanvas(r,n,0,0,a,o);WWindowManager.setInputScale(i,i);t.setSize(r,n);t.relayout()};TRuntimeView.prototype.resizeForFixResolution=function(t){var e=cantkGetViewPort();var i=t.w/e.width;var n=t.h/e.height;var r=Math.max(i,n);var a=r*e.width;var o=r*e.height;var s=e.width;var l=e.height;var h=a-t.w>>1;var u=o-t.h>>1;t.setLeftTop(h,u);this.app.resizeWin(a,o);this.app.resizeCanvas(a,o,0,0,s,l);WWindowManager.setInputScale(r,r);t.relayout()};TRuntimeView.prototype.translatePointToWm=function(t){return t};TRuntimeView.prototype.resizeForAuto=function(t){var e=cantkGetViewPort();t.setSize(e.width,e.height);t.relayout()};TRuntimeView.prototype.adjustWMSizePositionPreview=function(t){var e=cantkGetViewPort();var i=t.w;var n=t.h;var r=Math.min(1,Math.min(e.width/i,e.height/n));var a=i*r;var o=n*r;var s=e.width-a>>1;var l=e.height-o>>1;t.setLeftTop(0,0);this.app.resizeWin(i,n);this.app.resizeCanvas(i,n,s,l,a,o);WWindowManager.setInputOffset(s,l);WWindowManager.setInputScale(1/r,1/r);t.relayout()};TRuntimeView.prototype.adjustWMSizePositionRun=function(t){var e=this.getMeta();var i=e.general;var n=i.orientation;t.forcePortrait=false;t.forceLandscape=false;var r=this.designWidth;var a=this.designHeight;if(n==="landscape"&&r>a){t.forceLandscape=true}else if(n==="portrait"&&a>r){t.forcePortrait=true}t.screenScaleMode=i.screenscale;t.setLeftTop(0,0);switch(t.screenScaleMode){case"fix-width":{this.resizeForFixWidth(t);break}case"fix-height":{this.resizeForFixHeight(t);break}case"fix-resolution":{this.resizeForFixResolution(t);break}default:{this.resizeForAuto(t);break}}return};TRuntimeView.prototype.adjustWMSizePosition=function(){var t=this.getWindowManager();if(this.preview){return this.adjustWMSizePositionPreview(t)}else{return this.adjustWMSizePositionRun(t)}};TRuntimeView.prototype.onLoad=function(){var t=this.getWindowManager();var e=this.getMeta();if(e.general.useWebGL){WWindowManager.setCanvasContextName("2d-webgl")}if(window.cantkInitWindow!==undefined){t.setInitWindow(window.cantkInitWindow);console.log("window.cantkInitWindow:"+window.cantkInitWindow)}t.setView(this);t.setApp(this.app);t.setMode(Shape.MODE_RUNNING,true);this.designWidth=t.w;this.designHeight=t.h;this.adjustWMSizePosition();this.run()};TRuntimeView.prototype.paintLoading=function(t){};TRuntimeView.prototype.getViewScale=function(){return 1};TRuntimeView.prototype.paintSelf=function(t){var e=this.getWindowManager();if(!e){this.paintLoading(t);return}t.save();e.paint(t);t.restore();var i=e.x;var n=e.y;var r=e.w;var a=e.h;var o=this.rect.w;var s=this.rect.h;t.beginPath();if(n>0){t.rect(0,0,o,n)}if(i>0){t.rect(0,0,i,s)}var l=i+r;var h=o-l;if(h>0){t.rect(l,0,h,s)}var u=n+a;var c=s-u;if(c>0){t.rect(0,u,o,c)}if(n>0||i>0||h>0||c>0){t.fillStyle=e.style.fillColor;t.fill()}return};TRuntimeView.prototype.onGesture=function(t){var e=wm.getCurrentWindow();e.onGesture(t);return};TRuntimeView.prototype.getAppInfo=function(){var t=this.getMetaInfo();return t.general};TRuntimeView.prototype.onLoadUserScriptsDone=function(){var t=this.getAppInfo();HolaSDK.init(t.appid,false);console.log("TRuntimeView.prototype.onLoadUserScriptsDone.")};TRuntimeView.prototype.loadUserScripts=function(t){if(t){var e=t.extlibs;var i=window.location.href.indexOf("appid=preview")>0;if(!e){e=[]}if(e.length>0){var n=[];var r=[];e.forEach(function(e){if(e.indexOf("read.php?")>0&&e.indexOf("/libs/")>0){var i=t.docSavedTime?t.docSavedTime:Date.now();n.push(e+"&timestamp="+i)}else{r.push(e)}});n.sort();e=r.concat(n)}if(e){var a=[];for(var o=0;o<e.length;o++){var s=e[o];if(s.indexOf("res.wx.qq.com")>=0&&!isWeiXin()){console.log("not weixin browser skip weixin jssdk");continue}a.push(s)}if(a.length){ResLoader.loadScriptsSync(a,this.onLoadUserScriptsDone.bind(this))}}}return};TRuntimeView.prototype.paintBackground=function(t){};TRuntimeView.prototype.startRedrawTimer=function(t){var t=t||60;var e=1e3/t;var i=WWindowManager.getInstance();setInterval(i.postRedraw.bind(i),e);return};TRuntimeView.prototype.run=function(){var t=this.getMeta();var e=this.getWindowManager();var i=this.detectDeviceConfig();if(this.preview){i.lcdDensity=e.deviceConfig.lcdDensity}e.setDeviceConfig(i);this.modifyTitle(t);this.loadUserScripts(t);this.startRedrawTimer(t.general.fps);e.systemInit();e.postRedraw();return};TRuntimeView.prototype.modifyTitle=function(t){if(t&&t.general){var e=t.general.appname;document.title=e;if(isIPhone()||isIPad()){var i=document.getElementsByTagName("title");if(i&&i.length){var n=i[0];n.innerHTML=e}}}};TRuntimeView.create=function(t,e,i,n,r,a){var o=new TRuntimeView;return o.init(t,e,i,n,r,a)};function dappGetText(t){return t}function dappIsEditorApp(){return false}function TRuntimeDocument(){}TRuntimeDocument.prototype=new TDocument;TRuntimeDocument.prototype.updateAssetsMapRule=function(t){var e=null;var i=t.mapped;var n=t.runtime;var r=t.design;var a=t.map.language;for(e in a){if(n.language.indexOf(e)>=0){i.language=a[e];break}}if(!i.language){i.language=r.language}var o=t.map.size;for(e in o){if(e===n.size){i.size=o[e]}}if(!i.size){i.size=r.size}var s=t.map.density;for(e in s){if(e===n.density){i.density=s[e]}}if(!i.density){i.density=r.density}return this};TRuntimeDocument.prototype.fixAssetsConfig=function(t){var e={};var i=cantkGetViewPort();var n=this.detectDeviceConfig();e.width=i.width;e.height=i.height;e.density=n.lcdDensity;e.language=Locales.getLang();e.size=e.width+"x"+e.height;t.mapped={};t.runtime=e;this.updateAssetsMapRule(t);return this};TRuntimeDocument.prototype.createWindowManager=function(t){var e=this.getAssetsConfig();if(e){this.fixAssetsConfig(e);ResLoader.setAssetsConfig(e);ResLoader.mapImageURL=this.mapAssetURL.bind(this)}return TDocument.prototype.createWindowManager.call(this,t)};TRuntimeDocument.prototype.applyLocales=function(t){var e=null;var i=t.locales;var n=Locales.getLang();if(!i)return;for(var r in i){var a=r.toLowerCase().split(";");for(var o=0;o<a.length;o++){var s=a[o];if(s===n||n.startWith(s)){e=i[r];console.log("Matched locale:"+n+" ==> "+r);break}}if(e)break}if(!e){e=i["default"];if(e){console.log("Matched locale:"+n+" ==> default")}}if(e){webappSetLocaleStrings(e)}return};TRuntimeDocument.prototype.onBeforeLoad=function(t){this.applyLocales(t)};TRuntimeDocument.prototype.mapAssetURL=function(t,e){if(!e||!t||t.length>1024){return t}var i=e.design;var n=e.mapped;if(i.language!==n.language&&t.indexOf(i.language)>=0){t=t.replace(new RegExp(i.language,"g"),n.language)}if(i.density!==n.density&&t.indexOf(i.density)>=0){t=t.replace(new RegExp(i.density,"g"),n.density)}if(i.size!==n.size&&t.indexOf(i.size)>=0){t=t.replace(new RegExp(i.size,"g"),n.size)}return t};function TWebApp(t){document.body.style.overflow="hidden";this.viewPort=cantkGetViewPort();this.preview=!!t;this.init(t);return this}TWebApp.prototype.prepareCanvas=function(){this.canvas=CantkRT.getMainCanvas();var t=this.canvas;var e=cantkGetViewPort();var i=e.width;var n=e.height;CantkRT.resizeMainCanvas(i,n,i,i);this.manager=WWindowManager.create(this,this.canvas,this.canvas);return};TWebApp.prototype.init=function(){this.prepareCanvas();var t=this.canvas.width;var e=this.canvas.height;var i=this;this.win=WWindow.create(this.manager,0,0,t,e);this.view=TRuntimeView.create(this.win,0,0,t,e,this);var n=this.view;this.win.paintBackground=function(t){};this.win.onGesture=function(t){return n.onGesture(t)};window.onresize=function(){setTimeout(i.onSizeChanged.bind(i),50)};return};TWebApp.prototype.resizeWin=function(t,e){this.win.resize(t,e);this.view.resize(t,e)};TWebApp.prototype.resizeCanvas=function(t,e,i,n,r,a){var o=this.canvas;CantkRT.moveMainCanvas(i,n);CantkRT.resizeMainCanvas(t,e,r,a);return};TWebApp.prototype.onSizeChanged=function(){var t=cantkGetViewPort();if(EditorElement.imeOpen){console.log("EditorElement.imeOpen is true.");return}if(t.width===this.viewPort.width&&t.height===this.viewPort.height){console.log("onSizeChanged: size is not changed.");return}var e=t.width;var i=t.height;this.viewPort=t;this.manager.resize(e,i);this.view.adjustWMSizePosition();UIElement.getMainCanvasScale(true)};TWebApp.prototype.exitApp=function(){if(isTizen()){tizen.application.getCurrentApplication().exit()}else if(navigator.app){navigator.app.exitApp()}console.log("exitApp");return};TWebApp.prototype.runWithURL=function(t){this.view.loadURL(t);return this};TWebApp.prototype.runWithData=function(t){if(typeof t==="string"){this.view.loadString(t)}else{this.view.loadJson(t)}return this};window.webappRunWithURL=function(t){var e=new TWebApp;return e.runWithURL(t)};window.webappRunWithData=function(t){var e=new TWebApp;return e.runWithData(t)};window.webappPreviewWithURL=function(t){var e=new TWebApp(true);return e.runWithURL(t)};window.webappPreviewWithData=function(t){var e=new TWebApp(true);return e.runWithData(t)};window.webappGetText=webappGetText;window.webappSetLocaleStrings=webappSetLocaleStrings;window.webappSnapshot=function(){var t=CantkRT.getMainCanvas();var e=t.toDataURL();var i={};i.src=e;i.width=t.width;i.height=t.height;return i};function dupDeviceConfig(t){var e={};e.name=t.name;e.bg=t.bg;e.platform=t.platform;e.version=t.version;e.lcdDensity=t.lcdDensity;e.width=t.width;e.height=t.height;e.screenX=t.screenX;e.screenY=t.screenY;e.screenW=t.screenW;e.screenH=t.screenH;e.hasMenuBar=t.hasMenuBar;return e}function cantkDetectDeviceConfig(){var t={version:4};if(isAndroid()){t.platform="android"}else if(isIPhone()||isIPad()){t.platform="iphone"}else if(isFirefoxOS()){t.platform="firefox"}else if(isWinPhone()){t.platform="winphone"}else if(isTizen()){t.platform="tizen"}else{t.platform="android"}if(window.devicePixelRatio>2.2){t.lcdDensity="xxhdpi"}else if(window.devicePixelRatio>1.5){t.lcdDensity="xhdpi"}else if(window.devicePixelRatio>1.1){t.lcdDensity="hdpi"}else if(window.devicePixelRatio>.8){t.lcdDensity="mdpi"}else if(!window.devicePixelRatio){var e=Math.min(window.orgViewPort.width,window.orgViewPort.height);if(e>600){t.lcdDensity="xhdpi"}else{t.lcdDensity="hdpi"}}else{t.lcdDensity="ldpi"}if(isFirefoxOS()){t.lcdDensity="mdpi"}if(!isMobile()){t.lcdDensity="hdpi"}console.log("deviceConfig.lcdDensity:"+t.lcdDensity);console.log("deviceConfig.platform:"+t.platform);return t}function isDeviceConfigEqual(t,e){var i=JSON.stringify(t);var n=JSON.stringify(e);return i===n}function cantkPreloadImage(t){var e=new WImage(t);return e}var gTempCanvas=null;function cantkGetTempCanvas(t,e){if(!gTempCanvas){gTempCanvas=document.createElement("canvas");gTempCanvas.type="backend_canvas";gTempCanvas.width=t;gTempCanvas.height=e}if(gTempCanvas){if(gTempCanvas.width!=t){gTempCanvas.width=t}if(gTempCanvas.height!=e){gTempCanvas.height=e}}return gTempCanvas}var gApp8LocaleStrings={"Loading...":"..."};function webappGetText(t){var e=null;if(!t){return""}if(gApp8LocaleStrings){e=gApp8LocaleStrings[t]}if(!e){e=t}return e}function webappSetLocaleStrings(t){gApp8LocaleStrings=t;return}VelocityTracker.prototype.HISTORY_SIZE=20;VelocityTracker.prototype.HORIZON=200*1e6;VelocityTracker.prototype.MIN_DURATION=10*1e6;function Movement(){this.eventTime=0;this.point=new Point(0,0);this.getPoint=function(){return this.point};return this}function VelocityTracker(){this.clear();return this}VelocityTracker.prototype.clear=function(){this.index=0;var t=this.HISTORY_SIZE;if(!this.movements){this.movements=new Array;for(var e=0;e<t;e++){this.movements.push(new Movement)}}for(var e=0;e<t;e++){var i=this.movements[e];i.eventTime=0;i.point={x:0,y:0}}return};VelocityTracker.prototype.addMovement=function(t,e){if(++this.index==this.HISTORY_SIZE){this.index=0}this.movements[this.index].eventTime=t;this.movements[this.index].point=e;return};VelocityTracker.prototype.getVelocity=function(){var t={x:0,y:0};this.estimate();t.x=this.xVelocity;t.y=this.yVelocity;return t};VelocityTracker.prototype.estimate=function(){var t=this.HORIZON;var e=this.MIN_DURATION;var i=this.HISTORY_SIZE;var n=this.movements[this.index];var r=n.eventTime-t;var a=this.index;var o=1;do{var s=(a==0?i:a)-1;var l=this.movements[s];if(l.eventTime<r){break}a=s}while(++o<i);var h=0;var u=0;var c=a;var p=0;var f=this.movements[a];var m=f.getPoint();var d=0;while(o-->1){if(++c==i){c=0}var y=this.movements[c];var v=y.eventTime-f.eventTime;if(v>=e){var g=y.getPoint();var _=1e9/v;var I=(g.x-m.x)*_;var x=(g.y-m.y)*_;h=(h*d+I*v)/(v+d);u=(u*d+x*v)/(v+d);d=v;p+=1}}if(p){this.xVelocity=h;this.yVelocity=u}else{this.xVelocity=0;this.yVelocity=0}return true};function testVelocityTracker(){var t=null;var e=new VelocityTracker;function i(t){return t*1e6}for(var n=0;n<20;n++){e.addMovement(i(10*n),{x:10*n,y:10*n*n/2})}t=e.getVelocity();console.log("xv: "+t.x+" yv: "+t.y);return}function Interpolator(){this.get=function(t){return 0};return this}function LinearInterpolator(){this.get=function(t){return t};return this}Interpolator.create=function(t,e){return AnimationFactory.createInterpolator(t,e)};function BounceInterpolator(){function t(t){return 8*t*t}this.get=function(e){e*=1.1226;if(e<.3535)return t(e);else if(e<.7408)return t(e-.54719)+.7;else if(e<.9644)return t(e-.8526)+.9;else return t(e-1.0435)+.95};return this}function AccelerateInterpolator(){this.get=function(t){return t*t};return this}function AccDecelerateInterpolator(){this.get=function(t){return Math.cos((t+1)*Math.PI)/2+.5};return this}function DecelerateInterpolator(t){this.factor=t?t:2;this.get=function(t){if(this.factor===1){return 1-(1-t)*(1-t)}else{return 1-Math.pow(1-t,2*this.factor)}};return this}function SineAccelerateInterpolator(){this.get=function(t){return-Math.cos(t*(Math.PI/2))+1};return this}function SineAccDecelerateInterpolator(){this.get=function(t){return-.5*(Math.cos(Math.PI*t)-1)};return this}function SineDecelerateInterpolator(){this.get=function(t){return Math.sin(t*(Math.PI/2))};return this}function AnimationFactory(){this.createAnimation=function(t,e){UIElement.getMainCanvasScale(true);var i=isIPhone()?400:600;e=e?e:i;switch(t){case"anim-forward":{var n=new DecelerateInterpolator;animation=new AnimationHTranslate(true);animation.toLeft();animation.init(e,n);break}case"anim-backward":{var n=new DecelerateInterpolator;animation=new AnimationHTranslate(false);animation.toRight();animation.init(e,n);break}case"anim-upward":{var n=new DecelerateInterpolator;animation=new AnimationVTranslate(true);animation.init(e,n);break}case"anim-downward":{var n=new DecelerateInterpolator;animation=new AnimationVTranslate(false);animation.init(e,n);break}case"anim-scale-show-win":{var n=new DecelerateInterpolator;animation=new AnimationScale(true);animation.setRange(.9,1);animation.init(e,n);break}case"anim-scale-hide-win":{var n=new AccelerateInterpolator;animation=new AnimationScale(false);animation.setRange(1,.9);animation.init(e,n);break}case"anim-scale-show-dialog":{e=e?e:300;var n=new DecelerateInterpolator;animation=new AnimationScale(true);animation.setRange(.9,1);animation.init(e,n);break}case"anim-scale-hide-dialog":{e=e?e:300;var n=new AccelerateInterpolator;animation=new AnimationScale(false);animation.setRange(1,.9);animation.init(e,n);break}case"anim-fade-in":{var n=new AccelerateInterpolator;animation=new AnimationAlpha(true);animation.setRange(.1,1);animation.init(800,n);break}case"anim-fade-out":{var n=new AccelerateInterpolator;animation=new AnimationAlpha(false);animation.setRange(1,.1);animation.init(300,n);break}case"anim-move-up":{var n=new DecelerateInterpolator;animation=new AnimationMove(true);animation.init(e,n);break}case"anim-move-down":{var n=new AccelerateInterpolator;animation=new AnimationMove(false);animation.init(e,n);break}}return animation};return this}AnimationFactory.createInterpolator=function(t,e){switch(t){case"l":case"linear":{return new LinearInterpolator}case"b":case"bounce":{return new BounceInterpolator}case"a":case"accelerate":{return new AccelerateInterpolator}case"ad":case"accelerate-decelerate":{return new AccDecelerateInterpolator}case"sa":case"sine-accelerate":{return new SineAccelerateInterpolator}case"sd":case"sine-decelerate":{return new SineDecelerateInterpolator}case"sad":case"sine-accelerate-decelerate":{return new SineAccDecelerateInterpolator}default:{return new DecelerateInterpolator}}};AnimationFactory.create=function(t,e){if(!AnimationFactory.instance){AnimationFactory.instance=new AnimationFactory}return AnimationFactory.instance.createAnimation(t,e)};Animation.getCanvas=function(){return UIElement.getMainCanvas()};function Animation(t){this.scale=1;this.visible=false;this.showWin=t;this.init=function(t,e){this.duration=t?t:500;this.interpolator=e;return};this.setWins=function(t,e){this.oldWin=t;this.newWin=e;this.wm=t.getWindowManager()};this.setRectOfFront=function(t,e,i,n){this.frontX=t;this.frontY=e;this.frontW=i;this.frontH=n;return};this.setScale=function(t){this.scale=t;return};this.prepare=function(t,e,i,n,r){this.x=Math.round(t);this.y=Math.round(e);this.w=Math.round(i);this.h=Math.round(n);this.onFinish=r;this.setRectOfFront(0,0,i,n);this.show();return true};this.show=function(){var t=this.w*this.scale;var e=this.h*this.scale;this.visible=true;this.canvasElement=Animation.getCanvas();return true};this.hide=function(){this.visible=false;if(this.canvasElement&&this.canvasElement.parentNode){this.canvasElement=null}return true};this.getTimePercent=function(){var t=new Date;var e=t.getTime()-this.startTime;return e/this.duration};this.getPercent=function(t){return this.interpolator.get(t)};this.step=function(t){return true};this.beforeRun=function(){return true};this.afterRun=function(){return true};this.drawBackground=function(t){return};this.doStep=function(t){this.canvas.save();this.canvas.scale(this.scale,this.scale);this.step(t);this.canvas.restore();return};this.run=function(){var t=new Date;var e=this;this.startTime=t.getTime();e.isFirstStep=true;this.beforeRun();WWindowManager.getInstance().setPaintEnable(false);this.wm.setEnable(false);function i(){var t=0;var n=e.getTimePercent();if(n<1){t=e.getPercent(n);e.doStep(t);requestAnimationFrame(i)}else{e.cleanup();e.afterRun();WWindowManager.getInstance().setPaintEnable(true);console.log("Animation done.")}e.isFirstStep=false}i();return};this.cleanup=function(){var t=this;var e=this.onFinish;setTimeout(function(){t.hide();t.wm.setEnable(true)},100);if(e){e()}};this.hide();return this}function setElementPosition(t,e,i){var n=UIElement.getMainCanvasScale();e=e/n.x;i=i/n.y;t.style.position="absolute";t.style.left=Math.round(e)+"px";t.style.top=Math.round(i)+"px";t.style["opacity"]=1;return}function moveElement(t,e,i){setElementPosition(t,e,i);return}function alphaElement(t,e){t.style["opacity"]=e;return}function showElement(t){t.style["opacity"]=1}function hideElement(t){t.style["opacity"]=0}function scaleElement(t,e,i,n,r){var a=n&&r?n+" "+r:"50% 50%";var o=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var s=0;s<o.length;s++){var l=o[s];t.style[l+"-origin"]=a;t.style[l]="scale("+e+")"}t.style["opacity"]=i;return}function rotateElement(t,e){var i="50% 50%";var n=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var r=0;r<n.length;r++){var a=n[r];t.style[a+"-origin"]=i;t.style[a]="rotate("+e+"deg)"}return}function AnimationVTranslate(t){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");
return true};this.step=function(t){var e=this.frontX;var i=this.frontY;var n=this.frontW;var r=this.range*t;var a=this.showWin?r:this.range-r;var o=this.showWin?this.frontY+this.range-r:this.frontY+r;var s=this.canvas;s.save();var l=this.oldWin.getWindowManager();s.translate(l.x,l.y);if(this.showWin){s.translate(0,o-this.h);s.save();s.clipRect(0,0,this.w,this.h);this.oldWin.paintSelf(s);s.restore();s.translate(0,this.h);s.save();s.clipRect(0,0,this.w,this.h);this.newWin.paintSelf(s);s.restore()}else{s.translate(0,o-this.h);s.save();s.clipRect(0,0,this.w,this.h);this.newWin.paintSelf(s);s.restore();s.translate(0,this.h);s.save();s.clipRect(0,0,this.w,this.h);this.oldWin.paintSelf(s);s.restore()}s.restore();return true}}function AnimationHTranslate(){Animation.apply(this,arguments);this.leftToRight=true;this.beforeRun=function(){var t=this.newWin.w;this.range=t;this.start=t-this.range;this.canvas=this.canvasElement.getContext("2d")};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(t){var e=0;if(this.leftToRight){e=this.start+this.range*t}else{e=this.w-this.range*t-this.start}if(this.lastOffset===e){return true}var i=this.canvas;i.save();var n=this.oldWin.getWindowManager();i.translate(n.x,n.y);if(this.leftToRight){i.translate(-e,0);i.save();i.clipRect(0,0,this.w,this.h);this.oldWin.paintSelf(i);i.restore();i.translate(this.w,0);i.save();i.clipRect(0,0,this.w,this.h);this.newWin.paintSelf(i);i.restore()}else{i.translate(-e,0);i.save();i.clipRect(0,0,this.w,this.h);this.newWin.paintSelf(i);i.restore();i.translate(this.w,0);i.save();i.clipRect(0,0,this.w,this.h);this.oldWin.paintSelf(i);i.restore()}i.restore();this.lastOffset=e;return true}}function AnimationScale(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(t,e){this.to=e;this.from=t;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=this.to>this.from?t:1-t;var n=this.canvas;var r=this.w>>1;var a=this.h>>1;n.save();var o=this.oldWin.getWindowManager();n.translate(o.x,o.y);n.clipRect(0,0,this.w,this.h);if(this.to>this.from){this.oldWin.paintSelf(n);n.globalAlpha=i;n.translate(r,a);n.scale(e,e);n.translate(-r,-a);this.newWin.paintSelf(n)}else{this.newWin.paintSelf(n);n.globalAlpha=i;n.translate(r,a);n.scale(e,e);n.translate(-r,-a);this.oldWin.paintSelf(n)}n.restore();return true}}function AnimationAlpha(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(t,e){this.to=e;this.from=t;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(t){var e=this.from+t*(this.to-this.from);var i=this.canvas;i.save();var n=this.oldWin.getWindowManager();i.translate(n.x,n.y);i.clipRect(0,0,this.w,this.h);if(this.to>this.from){this.oldWin.paintSelf(i);i.globalAlpha=e;this.newWin.paintSelf(i)}else{this.newWin.paintSelf(i);i.globalAlpha=e;this.oldWin.paintSelf(i)}i.restore();return true}}function AnimationMove(t){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(e){var i=this.frontX;var n=this.frontY;var r=this.frontW;var a=this.range*e;var o=this.showWin?a:this.range-a;var s=this.showWin?this.frontY+this.range-a:this.frontY+a;var l=this.canvas;l.save();var h=this.oldWin.getWindowManager();l.translate(h.x,h.y);l.clipRect(0,0,this.w,this.h);if(t){this.oldWin.paintSelf(l);l.translate(0,s);this.newWin.paintSelf(l)}else{this.newWin.paintSelf(l);l.translate(0,s);this.oldWin.paintSelf(l)}l.restore();return true}}function UIElement(){return}UIElement.IMAGE_DISPLAY_CENTER=WImage.DISPLAY_CENTER;UIElement.IMAGE_DISPLAY_TILE=WImage.DISPLAY_TILE;UIElement.IMAGE_DISPLAY_9PATCH=WImage.DISPLAY_9PATCH;UIElement.IMAGE_DISPLAY_SCALE=WImage.DISPLAY_SCALE;UIElement.IMAGE_DISPLAY_AUTO=WImage.DISPLAY_AUTO;UIElement.IMAGE_DISPLAY_DEFAULT=WImage.DISPLAY_DEFAULT;UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO=WImage.DISPLAY_SCALE_KEEP_RATIO;UIElement.IMAGE_DISPLAY_TILE_V=WImage.DISPLAY_TILE_V;UIElement.IMAGE_DISPLAY_TILE_H=WImage.DISPLAY_TILE_H;UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN=WImage.DISPLAY_AUTO_SIZE_DOWN;UIElement.IMAGE_DISPLAY_FIT_WIDTH=WImage.DISPLAY_FIT_WIDTH;UIElement.IMAGE_DISPLAY_FIT_HEIGHT=WImage.DISPLAY_FIT_HEIGHT;UIElement.IMAGE_DISPLAY_3PATCH_V=WImage.DISPLAY_3PATCH_V;UIElement.IMAGE_DISPLAY_3PATCH_H=WImage.DISPLAY_3PATCH_H;UIElement.HTEXT_ALIGNS=["left","center","right"];UIElement.VTEXT_ALIGNS=["top","middle","bottom"];UIElement.IMAGE_DISPLAY_NAMES=["incenter","tile","9patch","scale","auto","default","scale(keep ratio)","vtile","htile","auto-size-down","fit-width","fit-height"];UIElement.X_FIX_LEFT=0;UIElement.X_FIX_RIGHT=1;UIElement.X_SCALE=2;UIElement.X_CENTER_IN_PARENT=3;UIElement.X_LEFT_IN_PARENT=4;UIElement.X_RIGHT_IN_PARENT=5;UIElement.X_AFTER_PREV=6;UIElement.X_LAYOUT_NAMES=["fix_left","fix_right","scale","center_in_parent","left_in_parent","right_in_parent"];UIElement.Y_FIX_TOP=0;UIElement.Y_FIX_BOTTOM=1;UIElement.Y_SCALE=2;UIElement.Y_MIDDLE_IN_PARENT=3;UIElement.Y_TOP_IN_PARENT=4;UIElement.Y_BOTTOM_IN_PARENT=5;UIElement.Y_AFTER_PREV=6;UIElement.Y_LAYOUT_NAMES=["fix_top","fix_bottom","scale","middle_in_parent","top_in_parent","bottom_in_parent"];UIElement.WIDTH_FIX=0;UIElement.WIDTH_SCALE=1;UIElement.WIDTH_FILL_PARENT=2;UIElement.WIDTH_FILL_AVAILABLE=3;UIElement.WIDTH_FILL_TO_PARENT_RIGHT=4;UIElement.HEIGHT_FIX=0;UIElement.HEIGHT_SCALE=1;UIElement.HEIGHT_FILL_PARENT=2;UIElement.HEIGHT_FILL_AVAILABLE=3;UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH=4;UIElement.HEIGHT_FILL_TO_PARENT_BOTTOM=5;UIElement.WIDTH_LAYOUT_NAMES=["fix","scale","fill_parent"];UIElement.HEIGHT_LAYOUT_NAMES=["fix","scale","fill_parent"];UIElement.IMAGE_DEFAULT="default_bg";UIElement.IMAGE_MASK="mask_fg";UIElement.IMAGE_NORMAL="normal_bg";UIElement.IMAGE_NORMAL_BG="normal_bg";UIElement.IMAGE_FOCUSED="focused_bg";UIElement.IMAGE_ACTIVE="active_bg";UIElement.IMAGE_POINTER_OVER="pointer_over_bg";UIElement.IMAGE_DISABLE="disable_bg";UIElement.IMAGE_DISABLE_FG="disable_fg";UIElement.IMAGE_NORMAL_FG="normal_fg";UIElement.IMAGE_ACTIVE_FG="active_fg";UIElement.IMAGE_CURRENT_PAGE_BG="current_page_bg";UIElement.IMAGE_CURRENT_PAGE_FG="current_page_fg";UIElement.IMAGE_NOT_CURRENT_PAGE_BG="not_current_page_bg";UIElement.IMAGE_NOT_CURRENT_PAGE_FG="not_current_page_fg";UIElement.IMAGE_ON_FG="on_fg";UIElement.IMAGE_OFF_FG="off_fg";UIElement.IMAGE_ON_BG="on_bg";UIElement.IMAGE_OFF_BG="off_bg";UIElement.IMAGE_CHECKED_BG="checked_bg";UIElement.IMAGE_UNCHECK_BG="unchecked_bg";UIElement.IMAGE_CHECKED_FG="checked_fg";UIElement.IMAGE_UNCHECK_FG="unchecked_fg";UIElement.IMAGE_ON_FOCUSED="focused_on_bg";UIElement.IMAGE_ON_ACTIVE="active_on_bg";UIElement.IMAGE_OFF_FOCUSED="focused_off_bg";UIElement.IMAGE_OFF_ACTIVE="active_off_bg";UIElement.IMAGE_NORMAL_DRAG="normal_drag";UIElement.IMAGE_DELETE_ITEM="delete_item_icon";UIElement.IMAGE_CHECKED_ITEM="checked_item_icon";UIElement.IMAGE_POINT="point_img";UIElement.IMAGE_POINT1="point1_img";UIElement.IMAGE_POINT2="point2_img";UIElement.IMAGE_POINT3="point3_img";UIElement.IMAGE_POINT4="point4_img";UIElement.IMAGE_TIPS1="tips_img_1";UIElement.IMAGE_TIPS2="tips_img_2";UIElement.IMAGE_TIPS3="tips_img_3";UIElement.IMAGE_TIPS4="tips_img_4";UIElement.IMAGE_TIPS5="tips_img_5";UIElement.IMAGE_V_SCROLL_BAR_BG="v-scroll-bar-bg";UIElement.IMAGE_V_SCROLL_BAR_FG="v-scroll-bar-fg";UIElement.IMAGE_H_SCROLL_BAR_BG="h-scroll-bar-bg";UIElement.IMAGE_H_SCROLL_BAR_FG="h-scroll-bar-fg";UIElement.ITEM_BG_NORMAL="item_bg_normal";UIElement.ITEM_BG_ACTIVE="item_bg_active";UIElement.ITEM_BG_CURRENT_NORMAL="item_bg_current_normal";UIElement.ITEM_BG_CURRENT_ACTIVE="item_bg_current_active";UIElement.TEXT_ALIGN_CENTER=0;UIElement.TEXT_ALIGN_LEFT=0;UIElement.TEXT_ALIGN_RIGHT=0;UIElement.TEXT_ALIGN_NAMES=["center","left","right"];UIElement.ORIGIN_UP=1;UIElement.ORIGIN_DOWN=2;UIElement.ORIGIN_LEFT=3;UIElement.ORIGIN_RIGHT=4;UIElement.ORIGIN_UP_LEFT=5;UIElement.ORIGIN_UP_RIGHT=6;UIElement.ORIGIN_DOWN_LEFT=7;UIElement.ORIGIN_DOWN_RIGHT=8;UIElement.ORIGIN_MIDDLE_CENTER=9;UIElement.STATE_STOP=1;UIElement.STATE_RUNNING=2;UIElement.STATE_PAUSED=3;UIElement.prototype=new RShape;TEventTarget.apply(UIElement.prototype);UIElement.Style=function(){this.lineWidth=2;this.lineColor="Orange";this.fillColor="White";this.textColor="Blue";this.fontSize=24;return};UIElement.Style.prototype=new ShapeStyle;UIElement.prototype.isUIElement=true;UIElement.prototype.hasChildren=true;UIElement.prototype.isContainer=true;UIElement.disableGetRelativePathOfURL=false;UIElement.prototype.addResource=function(t){if(!this.resources){this.resources=[]}if(this.resources.indexOf(t)<0){this.resources.push(t)}return};UIElement.prototype.setDefaultStyle=function(){this.style=new UIElement.Style;return};UIElement.prototype.clone=function(){var t=null;UIElement.disableGetRelativePathOfURL=true;t=this.dup();UIElement.disableGetRelativePathOfURL=false;t.setVisible(true);t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FIX;t.uid=UIElement.uidStart++;if(this.anchor){t.setAnchor(this.anchor.x,this.anchor.y)}return t};UIElement.prototype.getRelativePathOfURL=function(t){if(UIElement.disableGetRelativePathOfURL||!t){return t}return t.toRelativeURL()};UIElement.prototype.setFreePosition=function(t){this.freePosition=t;return};UIElement.prototype.fixChildPosition=function(t){return};UIElement.prototype.setFreeSize=function(t){this.freeSize=t;return};UIElement.prototype.fixChildSize=function(t){return};UIElement.prototype.onInit=function(){this.callOnInitHandler();if(this.dataSourceUrl&&this.dataSourceUrl.length>5){this.bindDataUrl(this.dataSourceUrl)}return};UIElement.prototype.onDeinit=function(){if(this.animatingInfo){this.stopAnimation(true)}return};UIElement.prototype.onWindowOpen=function(){if(this.animations&&this.defaultAnimationName){var t=this.animations[this.defaultAnimationName];if(t){this.animate(t)}}return};UIElement.prototype.initChildren=function(){var t=this.children;var e=this.children.length;for(var i=0;i<e;i++){var n=t[i];n.init()}return};UIElement.prototype.init=function(){try{this.onInit()}catch(t){console.log("onInit Failed:"+t.message+"\n"+t.stack)}this.initChildren();return};UIElement.prototype.deinit=function(){var t=0;var e=null;var i=this.children;var n=this.children.length;for(t=0;t<n;t++){e=i[t];e.deinit()}this.onDeinit();return};UIElement.prototype.onModeChanged=function(){return};UIElement.prototype.userRemovable=function(){return this.isInDesignMode()};UIElement.prototype.postRedraw=function(){if(this.view){this.view.postRedrawAll()}return this};UIElement.prototype.requestRedraw=UIElement.prototype.postRedraw;UIElement.prototype.setMode=function(t,e){this.mode=t;if(this.type!=="ui-menu-bar"){if(this.isInDesignMode()){this.setVisible(true)}}if(e){for(var i=0;i<this.children.length;i++){var n=this.children[i];if(n.isContainer){n.setMode(t,true)}}}this.onModeChanged();return this};UIElement.prototype.calcChildrenRange=function(){return this.calcShapesRange(this.children)};UIElement.prototype.calcShapesRange=function(t){var e=0;var i=0;var n=0;var r=0;var a=0;var o=0;var s=1e4;var l=1e4;var h={};if(t.length>0){for(var u=0;u<t.length;u++){var c=t[u];e=c.getX();i=c.getY();n=c.getWidth();r=c.getHeight();if(e<l)l=e;if(i<s)s=i;if(e+n>a)a=e+n;if(i+r>o)o=i+r}h.l=l;h.r=a;h.t=s;h.b=o}else{h.l=0;h.r=0;h.t=0;h.b=0}return h};UIElement.prototype.relayoutChildren=function(){};UIElement.prototype.onSized=function(){this.updateLayoutParams();return};UIElement.prototype.findSelectedShapes=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i.selected){t.push(i);continue}if(i.isContainer){i.findSelectedShapes(t)}}return};UIElement.onSelected=function(t){};UIElement.prototype.onSelectChanged=function(){if(this.selected){UIElement.onSelected(this)}return};UIElement.prototype.setSelected=function(t){if(!t){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setSelected(false)}}if(t){this.selectedTime=Date.now()}if(this.selected===t){return}this.targetShape=null;this.selected=t;this.onSelectChanged();return};UIElement.prototype.setPointerEventTarget=function(t){this.pointerEventTarget=t;return};UIElement.prototype.getPointerEventTarget=function(){return this.pointerEventTarget?this.pointerEventTarget:this.targetShape};UIElement.prototype.foreachImage=function(t){for(var e in this.images){if(e!=="display"){var i=this.getImageSrcByType(e);t(e,i)}}return};UIElement.prototype.forEach=function(t){if(t(this)){return true}for(var e=0;e<this.children.length;e++){var i=this.children[e];i.forEach(t)}return false};UIElement.prototype.getAllTabStopElements=function(){var t=[];var e=this.getWindow();if(e){e.forEach(function(e){if(e.isUIButton||e.isUIEdit){t.push(e)}})}return t};UIElement.prototype.findNextTabStop=function(){var t=this.getAllTabStopElements();if(!t.length){return}var e=t.indexOf(this);if(e>=0&&e+1<t.length){return t[e+1]}else{return t[0]}};UIElement.prototype.moveToNextStop=function(){var t=this.findNextTabStop();return};UIElement.prototype.isPointerOverShape=function(){return this.parentShape&&this.parentShape.pointerOverShape===this};UIElement.prototype.setPointerOverShape=function(t){if(this.pointerOverShape!==t){if(this.pointerOverShape){this.pointerOverShape.setPointerOverShape(null)}this.pointerOverShape=t;this.postRedraw()}return};UIElement.prototype.setTarget=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i!==t){i.setSelected(false)}}this.targetShape=t;this.selected=!t;this.onSelectChanged();return this};UIElement.prototype.getTarget=function(){return this.targetShape};UIElement.prototype.initContainerShape=function(t){this.children=new Array;RShapeInit(this,t);this.mode=Shape.MODE_EDITING;this.rectSelectable=true;return this};UIElement.prototype.defaultDispatchPointerDownToChildren=function(t){var e=this.targetShape;if(e&&e.isInDesignMode()){var i=this.hitTest(t);if(i!=Shape.HIT_TEST_MM&&i!=Shape.HIT_TEST_NONE){if(this.selected){this.setTarget(null);return true}if(this.targetShape.onPointerDown(t)){return true}}}var n=this.children;var r=n.length;for(var a=r;a>0;a--){var o=n[a-1];if(o.visible&&o.onPointerDown(t)){this.setTarget(o);if(!o.shouldPropagatePointerEvent()){return true}}}return false};UIElement.prototype.dispatchPointerDownToChildren=function(t){return this.defaultDispatchPointerDownToChildren(t)};UIElement.prototype.onPointerDownEditing=function(t,e){return};UIElement.prototype.onPointerDownRunning=function(t,e){if(!this.pointerDown){return}return this.callOnPointerDownHandler(t,e)};UIElement.prototype.onPointerMoveEditing=function(t,e){return};UIElement.prototype.onPointerMoveRunning=function(t,e){return this.callOnPointerMoveHandler(t,e)};UIElement.prototype.onPointerUpEditing=function(t,e){return};UIElement.prototype.onPointerUpRunning=function(t,e){if(!this.pointerDown){return}return this.callOnPointerUpHandler(t,e)};UIElement.prototype.onDoubleClick=function(t){if(this.targetShape){var e=this.translatePoint(t);return this.targetShape.onDoubleClick(e)}else{return this.callOnDoubleClickHandler(t)}};UIElement.prototype.onGesture=function(t){if(this.popupWindow){return}if(this.targetShape){return this.targetShape.onGesture(t)}return};UIElement.prototype.onLongPress=function(t){if(!this.pointerDown){return}this.longPressed=true;this.callOnLongPressHandler(t);if(this.targetShape){var e=this.translatePoint(t);return this.targetShape.onLongPress(e)}return};UIElement.prototype.onClick=function(t,e){if(e||!this.pointerDown){return}return this.callOnClickHandler(t)};UIElement.prototype.translatePoint=function(t){var e={x:t.x-this.left,y:t.y-this.top};return e};UIElement.prototype.setCanRectSelectable=function(t,e){this.rectSelectable=t;for(var i=0;i<this.children.length;i++){var n=this.children[i];n.setCanRectSelectable(t,e)}return};UIElement.prototype.canRectSelectable=function(){return this.isUIWindow||this.isUIPage};UIElement.prototype.setDraggable=function(t){if(this.draggable===t){return}this.draggable=t;if(t){this.addEventNames(["onDragStart","onDragging","onDragEnd"])}else{this.removeEventNames(["onDragStart","onDragging","onDragEnd"])}return};UIElement.prototype.onDragStart=function(){console.log("Drag Start");this.callOnDragStartHandler();return};UIElement.prototype.onDragging=function(){console.log("Dragging");this.callOnDragingHandler();return};UIElement.prototype.onDragEnd=function(){console.log("Drag End");this.callOnDragEndHandler();return};UIElement.prototype.dragMove=function(t,e,i){this.left=this.left+t;this.top=this.top+e;this.onDragging(i);return};UIElement.prototype.handleDragMove=function(t){var e=this.getMoveDeltaX();var i=this.getMoveDeltaY();if(!this.dragging){var n=this.getMoveAbsDeltaX();var r=this.getMoveAbsDeltaY();if(Math.abs(n)>5||Math.abs(r)>5){this.dragging=true;this.onDragStart();e=n;i=r}}if(this.dragging){this.dragMove(e,i,t);if(this.parentShape){this.parentShape.onChildDragging(this,t)}}return};UIElement.prototype.onChildDragging=function(t,e){return};UIElement.prototype.onChildDragged=function(t,e){this.sortChildren();this.relayoutChildren("default");return};UIElement.prototype.handleDragUp=function(t){this.onDragEnd();delete this.dragging;if(this.parentShape){this.parentShape.onChildDragged(this,t)}return};UIElement.prototype.animMove=function(t,e){if(!this.dragging){this.animate({x:t,y:e})}return};UIElement.getIntFromConfig=function(t,e,i){var n=t[e];if(!n&&n!==0){return i}if(typeof n==="string"){if(n[1]==="+"||n[1]==="-"){n=i+parseInt(n.substr(1))}else{n=parseInt(n)}}return n};UIElement.prototype.stopAnimation=function(t){if(!this.animatingInfo){return this}if(t){this.stepAnimation({needRedraw:0},Date.now()+1e8)}this.animatingInfo=null;return this};UIElement.prototype.animate=function(t,e,i,n){var r=this;var a=Deferred();var i=i||t.onStep;var e=e||t.onDone;this.doAnimate(t,function(){if(typeof e==="function"){e.apply(r,arguments)}a.resolve()},function(){if(typeof i==="function"){return i.apply(r,arguments)}return true},n);return a.promise};UIElement.prototype.doAnimate=function(t,e,i,n){if(typeof t==="string"){t=this.animations[t]}if(!this.parentShape){UIElement.logWarning("animate error - parentShape is null.");return false}if(this.dragging){UIElement.logWarning("animate error - busy.");return false}var r=this.animatingInfo;if(r){var a=n||t.actionWhenBusy||"replace";if(a==="replace"){this.callOnAnimateDone(r)}else if(a==="append"){var o=0;for(var s=r;s;s=s.next){if(s===t){UIElement.logWarning("animate error - already appended.");return false}if(!s.next||o>30){s.next=t;break}o++}UIElement.logNotice("busy action - append animation.");return true}else{UIElement.logWarning("animate error - busy.");return false}}if(!t){UIElement.logWarning("animate error - config is null.");return false}var l=this.getX();var h=this.getY();var u=this.w;var c=this.h;var p=t.duration||800;var f=UIElement.getIntFromConfig(t,"xStart",l);var m=UIElement.getIntFromConfig(t,"xEnd",l);var d=UIElement.getIntFromConfig(t,"yStart",h);var y=UIElement.getIntFromConfig(t,"yEnd",h);var v=UIElement.getIntFromConfig(t,"wStart",u);var g=UIElement.getIntFromConfig(t,"wEnd",u);var _=UIElement.getIntFromConfig(t,"hStart",c);var I=UIElement.getIntFromConfig(t,"hEnd",c);var x=t.valueStart||0;var w=t.valueEnd||0;var S=t.opacityStart||t.opacityStart===0?t.opacityStart:this.opacity;var b=t.opacityEnd||t.opacityEnd===0?t.opacityEnd:this.opacity;var C=t.rotationStart||t.rotationStart===0?t.rotationStart:this.rotation;var T=t.rotationEnd||t.rotationEnd===0?t.rotationEnd:this.rotation;var D=t.scaleXStart||t.scaleXStart===0?t.scaleXStart:this.getScaleX();var U=t.scaleXEnd||t.scaleXEnd===0?t.scaleXEnd:this.getScaleX();var A=t.scaleYStart||t.scaleYStart===0?t.scaleYStart:this.getScaleY();var E=t.scaleYEnd||t.scaleYEnd===0?t.scaleYEnd:this.getScaleY();if(t.scaleEnd!==undefined){U=t.scaleEnd;E=t.scaleEnd}if(t.scaleStart!==undefined){D=t.scaleStart;A=t.scaleStart}if(t.scale!==undefined){U=t.scale;E=t.scale}if(t.scaleX!==undefined){U=t.scaleX}if(t.scaleY!==undefined){E=t.scaleY}if(t.x!==undefined){m=t.x}if(t.y!==undefined){y=t.y}if(t.opacity!==undefined){b=t.opacity}if(t.rotation!==undefined){T=t.rotation}var M=e||t.onDone;var P=i||t.onStep;var B=m-f;var L=y-d;var R=U-D;var O=E-A;var V=b-S;var F=T-C;var k=w-x;var N=null;if(typeof t.interpolator==="string"){N=AnimationFactory.createInterpolator(t.interpolator)}else{N=t.interpolator?t.interpolator:new DecelerateInterpolator}if(!B){this.setX(f);m=f}if(!L){this.setY(d);y=d}if(!R){this.setScaleX(D);U=D}if(!O){this.setScaleY(A);E=A}if(!V&&S){this.setOpacity(S);b=S}if(!F){this.setRotation(C);T=C}var o={};o.xRange=B;o.yRange=L;o.scaleXRange=R;o.scaleYRange=O;o.opacityRange=V;o.rotationRange=F;o.valueRange=k;o.wStart=v;o.hStart=_;o.xStart=f;o.yStart=d;o.scaleXStart=D;o.scaleYStart=A;o.opacityStart=S;o.rotationStart=C;o.valueStart=x;o.startTime=Date.now();o.duration=p;o.onDone=M;o.onStep=P;o.interpolator=N;o.next=t.next;o.name=t.name;o.now=o.startTime;if(t.delay){o.startTime+=t.delay}this.animatingInfo=o;this.postRedraw();return true};UIElement.prototype.callOnAnimateDone=function(t){this.animating=false;this.animatingInfo=null;var e=t.onDone;if(e){e.call(this,t.name)}if(!this.parentShape)return false;this.callOnAnimateDoneHandler(t.name);if(!this.parentShape)return false;var i=t.next;if(i){if(typeof i==="string"){if(!this.animations[i]){return false}}this.animate(i);return true}return false};UIElement.prototype.isAnimating=function(){return this.animatingInfo&&this.parentShape};UIElement.prototype.stepAnimation=function(t,e){var i=this.animatingInfo;if(!i||!this.parentShape)return;i.now+=t.timeStep;if(!e){e=i.now}t.needRedraw++;if(i.startTime>e){return}if(!this.visible){this.visible=true}var n=i.xRange;var r=i.yRange;var a=i.valueRange;var o=i.scaleXRange;var s=i.scaleYRange;var l=i.opacityRange;var h=i.rotationRange;var u=i.wStart;var c=i.hStart;var p=i.xStart;var f=i.yStart;var m=i.scaleXStart;var d=i.scaleYStart;var y=i.opacityStart;var v=i.rotationStart;var g=i.valueStart;var _=i.onStep;var I=i.duration;var x=i.startTime;var w=i.interpolator;var S=(e-x)/I;var b=w.get(S);if(a){i.value=g+b*a}if(S>=1){b=1}if(n||r){var C=Math.floor(p+b*n);var T=Math.floor(f+b*r);this.setPosition(C,T)}if(l){this.opacity=y+b*l}if(h){this.setRotation(v+b*h)}if(o){this.setScaleX(m+b*o)}if(s){this.setScaleY(d+b*s)}if(_&&!_(this,S,i)){this.callOnAnimateDone(i);return}if(b<1){this.animating=true}else{this.callOnAnimateDone(i)}return};UIElement.prototype.isHitWorkArea=function(){return this.hitTestResult===Shape.HIT_TEST_MM&&this.children.length>1&&this.canRectSelectable()};UIElement.prototype.setPropagatePointerEvent=function(t){this.propagatePointerEvent=t;return this};UIElement.prototype.getPropagatePointerEvent=function(){return this.propagatePointerEvent};UIElement.prototype.shouldPropagatePointerEvent=function(){return this.propagatePointerEvent&&!this.isInDesignMode()&&(!this.targetShape||this.targetShape.shouldPropagatePointerEvent())};UIElement.prototype.onPointerDownNormal=function(t){var e=this.translatePoint(t);this.hitTestResult=this.hitTest(t);if(!this.hitTestResult){if(this.isUIScrollView&&!this.isInDesignMode()){return false}if(this.dispatchPointerDownToChildren(e)){this.setPointerEventTarget(this.targetShape);return true}return false}this.pointerDown=true;this.pointerDownTime=Date.now();this.childrenRange=this.calcChildrenRange();if(this.isInDesignMode()){this.onPointerDownEditing(t,true)}else if(this.enable){this.onPointerDownRunning(e,true)}this.setPointerEventTarget(null);if(this.hitTestResult===Shape.HIT_TEST_MM||!this.selected){if(this.dispatchPointerDownToChildren(e)){if(this.isInDesignMode()){this.onPointerDownEditing(t,false)}else if(this.enable){this.onPointerDownRunning(e,false)}this.lastPosition.x=t.x;this.lastPosition.y=t.y;this.setPointerEventTarget(this.targetShape);return true}}if(this.isHitWorkArea()){this.hitTestResult=Shape.HIT_TEST_WORKAREA}this.setTarget(null);this.setSelected(true);this.lastPosition.x=t.x;this.lastPosition.y=t.y;if(this.isInDesignMode()){this.handlePointerEvent(t,1)}if(this.isInDesignMode()){this.onPointerDownEditing(t,false)}else if(this.enable){this.onPointerDownRunning(e,false)}this.postRedraw();return true};UIElement.prototype.getPointerPosition=function(){var t=this.getWindow();return t.lastPosition};UIElement.prototype.onPointerMoveNormal=function(t){if(!this.isInDesignMode()&&!this.isUIWindowManager&&!this.isUIWindow){if(!this.win.pointerDown){return}}var e=this.translatePoint(t);if(this.draggable&&this.pointerDown){if(!this.isInDesignMode()){this.handleDragMove(t);return}else{delete this.dragging}}if(this.hitTestResult){if(this.isInDesignMode()){this.onPointerMoveEditing(t,true)}else if(this.enable){this.onPointerMoveRunning(e,true)}var i=this.getPointerEventTarget();if(i){i.onPointerMove(e);if(this.isInDesignMode()){this.onPointerMoveEditing(t,false)}else if(this.enable){this.onPointerMoveRunning(e,false)}}else{if(this.isInDesignMode()){this.onPointerMoveEditing(t,false);if(this.hitTestResult===Shape.HIT_TEST_WORKAREA&&this.isUIWindow){var e={x:0,y:0};var n=t.x-this.pointerDownPosition.x;var r=t.y-this.pointerDownPosition.y;var a=this.pointerDownPosition.x-this.left;var o=this.pointerDownPosition.y-this.top;var s={x:a,y:o,w:n,h:r};if(Math.abs(n)>5&&Math.abs(r)>5){s=fixRect(s);this.setSelected(false);for(var l=this.children.length-1;l>=0;l--){var h=this.children[l];e.x=h.left+h.w/2;e.y=h.top+h.h/2;h.setSelected(isPointInRect(e,s))}}}else{this.handlePointerEvent(t,0)}}else if(this.enable){this.onPointerMoveRunning(e,false)}}this.lastPosition.x=t.x;this.lastPosition.y=t.y;return true}else{var i=this.getPointerEventTarget();if(i){i.onPointerMove(e)}if(i||this.isUIWindow){if(this.isInDesignMode()){this.onPointerMoveEditing(t,false)}else if(this.enable){this.onPointerMoveRunning(e,true);this.onPointerMoveRunning(e,false)}}}this.lastPosition.x=t.x;this.lastPosition.y=t.y;return false};UIElement.prototype.onPointerUpNormal=function(t){if(this.hitTestResult){var e=this.translatePoint(t);var i=this.isClicked();if(this.isInDesignMode()){this.onPointerUpEditing(t,true)}else if(this.enable){this.onPointerUpRunning(e,true)}if(i&&this.enable){this.onClick(e,true)}var n=this.getPointerEventTarget();if(n){n.onPointerUp(e)}else{if(this.isInDesignMode()){this.handlePointerEvent(t,-1)}}if(this.isInDesignMode()){this.onPointerUpEditing(t,false)}else{if(this.dragging){this.handleDragUp(t)}else if(this.enable){this.onPointerUpRunning(e,false)}}if(i&&this.enable){this.onClick(e,false)}this.hitTestResult=Shape.HIT_TEST_NONE;if(this.longPressed){this.longPressed=false}if(this.isUIWindow){UIElement.hScrollHandledBy=null;UIElement.vScrollHandledBy=null}return true}else{this.targetShape=null;if(!this.isInDesignMode()&&this.enable){this.onPointerUpRunning(e,false);if(i){this.onClick(e,false)}}if(this.longPressed){this.longPressed=false}var n=this.getPointerEventTarget();if(n){var e=this.translatePoint(t);n.onPointerUp(e)}if(this.isUIWindow){UIElement.hScrollHandledBy=null;UIElement.vScrollHandledBy=null}}return false};UIElement.prototype.needDrawTextTips=function(t){return this.isInDesignMode()&&!this.children.length};UIElement.prototype.textEditable=function(t){return this.isInDesignMode()};UIElement.prototype.isClicked=function(){if(!this.view){return false}if(this.longPressed&&this.events["onLongPress"]){console.log("Long Pressed, Ignore Click Event.");return false}return this.view.isClicked()};UIElement.prototype.onKeyDownRunning=function(code){if(!this.handleKeyDown||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onKeyDown"];if(sourceCode){sourceCode="this.handleKeyDown = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyDown){try{this.handleKeyDown(code)}catch(e){console.log("this.handleKeyDown:"+e.message)}}return true};UIElement.prototype.onKeyDownEditing=function(t){};UIElement.prototype.onKeyDown=function(t){if(this.targetShape){this.targetShape.onKeyDown(t)}if(this.isInDesignMode()){this.onKeyDownEditing(t)}else{this.onKeyDownRunning(t)}return};UIElement.prototype.onKeyUpRunning=function(code){if(!this.handleKeyUp||this.mode===Shape.MODE_PREVIEW){var sourceCode=this.events["onKeyUp"];if(sourceCode){sourceCode="this.handleKeyUp = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyUp){try{this.handleKeyUp(code)}catch(e){console.log("this.handleKeyUp:"+e.message)}}else if(this.isUIWindow&&code==KeyEvent.DOM_VK_BACK_BUTTON&&!cantkIsEditorActive()){console.log("Back Key Pressed On: "+this.name);if(this.isMainWindow()){var app=this.getApp();var wm=this.getWindowManager();if(this.mode===Shape.MODE_RUNNING){wm.systemExit();app.exitApp();console.log("Back Key Pressed, Exit App.")}}else{this.closeWindow(0);console.log("Back Key Pressed, Close Current Window.")}}return true};UIElement.prototype.onKeyUpEditing=function(t){};UIElement.prototype.onKeyUp=function(t){if(t===KeyEvent.DOM_VK_BACK&&this.isUIWindow){this.closeWindow(0);return}if(this.targetShape){this.targetShape.onKeyUp(t)}if(this.isInDesignMode()){this.onKeyUpEditing(t)}else{this.onKeyUpRunning(t)}return};UIElement.prototype.afterSetView=function(){return true};UIElement.prototype.setView=function(t){this.view=t;for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setView(t)}this.afterSetView(t);return};UIElement.prototype.setApp=function(t){this.app=t;for(var e=0;e<this.children.length;e++){var i=this.children[e];i.setApp(t)}return};UIElement.prototype.shapeCanBeChild=function(t){return true};UIElement.prototype.onAppendedInParent=function(){if(this._win){delete this._win}};UIElement.prototype.setParent=function(t){if(!t){this.detachNameFromParent()}this.parentShape=t;return this};Object.defineProperty(UIElement.prototype,"name",{set:function(t){this.detachNameFromParent();this._name=t;this.attachNameToParent()},get:function(){return this._name}});UIElement.prototype.setName=function(t){if(this.name!==t){this.name=t}return this};UIElement.prototype.detachFromParent=function(){var t=this.getParent();if(t){if(t.targetShape===this){t.targetShape=null}if(t.pointerEventTarget===this){t.pointerEventTarget=null}this.detachNameFromParent()}this.parentShape=null};UIElement.prototype.attachNameToParent=function(){var t=this.getParent();if(t){if(!this.isInDesignMode()){var e=this.name;if(t[e]===undefined){t[e]=this}else{UIElement.logWarning("skip duplicated name:"+e)}}}return this};UIElement.prototype.detachNameFromParent=function(){var t=this.getParent();if(t){if(!this.isInDesignMode()){var e=this.name;var i=t[e];if(i===this){delete t[e]}}}return this};UIElement.prototype.afterChildAppended=function(t){if(this.isUILayout){this.relayoutChildren()}return true};UIElement.prototype.beforeAddShapeIntoChildren=function(t){return true};UIElement.prototype.addShapeIntoChildren=function(t,e){var i={x:0,y:0,w:0,h:0};for(var n=this.children.length-1;n>=0;n--){var r=this.children[n];if(r===t)continue;if(r.isContainer&&r.visible){i.x=r.left;i.y=r.top;i.w=r.w;i.h=r.h;if(isPointInRect(e,i)){return r.addShape(t,true,e)}}}return false};UIElement.prototype.addChildWithJson=function(t,e){var i=t.type?t.type:t.id;var n=ShapeFactoryGet().createShape(i,C_CREATE_FOR_USER);if(n){n.fromJson(t);this.addShape(n,false,null,e||n.z);n.setVisible(true);n.attachNameToParent()}return n};UIElement.prototype.setAlwaysOnTop=function(t){this.alwaysOnTop=t;return};UIElement.onAddShape=function(t,e){};UIElement.prototype.fixName=function(){var t=this;var e=this.getParent();if(!t.name){t.name=t.type}var i=t.name;if(!this.isInDesignMode()){
t.name=t.name+"_"+Date.now()+"_"+Math.round(Math.random()*1e4);return}i=i.replaceAll("-","_");var n=i;var r=i.lastIndexOf("_");var a=i.substring(r+1);var o=Math.abs(parseInt(a));var s;if(!isNaN(o)){n=i.slice(0,r);s=o}else{s=1}for(var o=s;o<1e3;o++){if(e.find(i)){if(n[n.length-1]==="_"){i=n+o}else{i=n+"_"+o}}else{break}}t.name=i;return this};UIElement.prototype.addShape=function(t,e,i,n){if(!t.isUIElement){return false}if(t.parentShape){UIElement.logWarning("child has a parent, cannot call addChild again.");return false}if(e){t.moveDelta(-this.left,-this.top)}if(this.beforeAddShapeIntoChildren(t)&&i){var r=this.translatePoint(i);if(this.addShapeIntoChildren(t,r)){return true}t.setLeftTop(r.x,r.y)}if(!this.shapeCanBeChild(t)){return false}t.setParent(this);t.setView(this.view);t.setApp(this.app);var a=this.children;var o=a.length;if(n===undefined){if(o){n=this.children[o-1].z+1}else{n=0}}a.push(t);t.setZIndex(n);o=a.length;if(t.isUIElement){t.setMode(this.mode,true);if(!this.isInDesignMode()){t.init()}}for(var s=0;s<a.length;s++){var l=a[s];if(l.alwaysOnTop){a.remove(l);a.push(l);break}}if(t.isCreatingElement()){t.callOnBirthedHandler(true)}t.onAppendedInParent();this.afterChildAppended(t);UIElement.onAddShape(t,e);return true};UIElement.prototype.appendChild=function(t){var e=this.children;var i=e.length;if(t.z===undefined){t.z=i}if(!i){e.push(t);return}for(var n=i-1;n>=0;n--){var r=e[n];if(r.z<=t.z){e.splice(n+1,0,t);return}}e.splice(0,0,t);return};UIElement.prototype.addShapeDirectly=function(t){if(!this.shapeCanBeChild(t)){return false}this.setDisableRelayout(true);t.setDisableRelayout(true);t.setParent(this);t.setView(this.view);t.setApp(this.app);this.appendChild(t);if(t.isUIElement){t.mode=this.mode}this.afterChildAppended(t);t.onAppendedInParent();this.setDisableRelayout(false);t.setDisableRelayout(false);return true};UIElement.prototype.addChild=function(t,e){if(this.addShape(t,false,null,e||t.z)){t.attachNameToParent();return t}else{return null}};UIElement.prototype.shapeCanBeRemove=function(t){return true};UIElement.prototype.afterChildRemoved=function(t){return true};UIElement.prototype.remove=function(t,e){var i=this.getParent();if(i){i.removeChild(this,t,e)}return this};UIElement.prototype.removeAll=function(){var t=this.children.length;for(var e=0;e<t;e++){var i=this.children[0];this.removeShape(i)}return};UIElement.prototype.removeChildren=function(t){this.targetShape=null;this.pointerEventTarget=null;var e=this.children.length;for(var i=0;i<e;i++){var n=this.children[i];if(n.getParent()===this){n.onRemoved(this);n.setParent(null);n.setView(null);n.setApp(null)}}if(t){this.children.clear()}else{this.children.length=0}return this};UIElement.prototype.removeChild=function(t,e,i){var n=this;if(t.animatingInfo){UIElement.logWarning("removing animating element.")}if(i){this.removeShape(t,e)}else{t.removed=true;setTimeout(function(){n.removeShape(t,e);t=null;n=null},0)}if(this.targetShape===t){this.targetShape=null}if(this.pointerEventTarget===t){this.pointerEventTarget=null}return this};UIElement.onRemoveShape=function(t,e){};UIElement.prototype.removeShape=function(t,e){if(!this.shapeCanBeRemove(t)||!t.parentShape){return false}if(t.animatingInfo){UIElement.logWarning("removing animating element.")}this.children.remove(t);t.callOnRemovedHandler();this.afterChildRemoved(t);if(t.getParent()===this){t.setParent(null);t.setView(null);t.setApp(null)}if(this.isUILayout){this.relayoutChildren()}UIElement.onRemoveShape(this,t);t.onRemoved(this);if(e){t.destroy()}return};UIElement.prototype.reparent=function(t,e){var i=this.getParent();if(t===i){return}if(!t||!i){return}if(e){var n=i.getPositionInWindow();var r=t.getPositionInWindow();var a=n.x-r.x;var o=n.y-r.y;this.left+=a;this.top+=o}i.children.remove(this);t.addShapeDirectly(this);return};UIElement.prototype.afterPropertyChanged=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.getIndexOfChild=function(t){return this.children.indexOf(t)};UIElement.prototype.getIndex=function(){if(this.parentShape){return this.parentShape.getIndexOfChild(this)}else{return-1}};UIElement.prototype.getZIndex=function(){return this.z};UIElement.prototype.onRestack=function(){};UIElement.prototype.setZIndex=function(t){this.z=t;var e=this.parentShape;if(e){var i=e.children;var n=i.length;for(var r=0;r<n;r++){var a=i[r];if(a.z===undefined){a.z=r}}i.stableSort(function(t,e){return t.z-e.z})}this.onRestack();return this};UIElement.prototype.findChildByType=function(t,e){var i=0;var n=null;var r=null;var a=this.children.length;for(i=0;i<a;i++){r=this.children[i];if(r.type===t){return r}}if(e){for(i=0;i<a;i++){r=this.children[i];n=r.findChildByType(t,e);if(n){return n}}}return null};UIElement.prototype.findChildByPath=function(t){var e=t.shift();var i=this.findChildByName(e);if(t.length){return i.findChildByPath(t)}return i};UIElement.prototype.findChildByName=function(t,e){var i=0;var n=null;var r=null;var a=this.children.length;for(i=0;i<a;i++){r=this.children[i];if(r.name===t){return r}}if(e){for(i=0;i<a;i++){r=this.children[i];n=r.findChildByName(t,e);if(n){return n}}}return null};UIElement.prototype.find=function(t,e){if(!t){return this}if(t.indexOf("/")>=0){var i=t.split("/");i.remove("");return this.findChildByPath(i)}else{return this.findChildByName(t,e)}};UIElement.prototype.setValueOf=function(t,e){var i=this.findChildByName(t,true);return i?i.setValue(e):null};UIElement.prototype.getValueOf=function(t){var e=this.findChildByName(t,true);return e?e.getValue():null};UIElement.prototype.beforePaintChild=function(t,e){return};UIElement.prototype.afterPaintChild=function(t,e){return};UIElement.prototype.paintTargetShape=function(t){var e=this.targetShape;if(e&&(this.isUIList&&this.isInDesignMode()||this.isUIGrid)){shape=e;this.beforePaintChild(shape,t);shape.paintSelf(t);this.afterPaintChild(shape,t)}return};UIElement.prototype.defaultPaintChildren=function(t){t.save();t.beginPath();var e=null;var i=this.children.length;for(var n=0;n<i;n++){e=this.children[n];if(!e){continue}if(e.visible){this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}else if(e.isAnimating()){e.stepAnimation(t)}}this.paintTargetShape(t);t.restore();return};UIElement.prototype.beforePaintChildren=function(t){if(!this.rotateChildren&&this.rotation){var e=this.w>>1;var i=this.h>>1;t.translate(e,i);t.rotate(-this.rotation);t.translate(-e,-i)}return};UIElement.prototype.afterPaintChildren=function(t){return};UIElement.prototype.paintChildren=function(t){this.defaultPaintChildren(t);return};UIElement.prototype.paintSelfOnly=function(t){return};UIElement.prototype.drawImageAtCenter=function(t,e,i,n,r,a,o){if(e&&e.width>0){var s=e.width;var l=e.height;if(o){var h=Math.min(1,Math.min(a/l,r/s));var u=s*h;var c=l*h;var p=(r-u>>1)+i;var f=(a-c>>1)+n;p=Math.max(p,i);f=Math.max(f,n)}else{p=i;f=n;u=r;c=a}t.drawImage(e,0,0,s,l,p,f,u,c)}return};UIElement.prototype.drawImage=function(t){this.drawFgImage(t);return};UIElement.prototype.drawFgImage=function(t){return};UIElement.prototype.getBgHtmlImage=function(){var t=this.getBgImage();return t?t.getImage():null};UIElement.prototype.getBgImage=function(){var t=null;if(this.enable){if(this.pointerDown&&!this.isClicked()){t=this.images.normal_bg}else{if(this.pointerDown){t=this.images.active_bg}else{if(this.isPointerOverShape()&&this.getHtmlImageByType(UIElement.IMAGE_POINTER_OVER)){t=this.images.pointer_over_bg}else if(this.isFocused()){t=this.images.focused_bg}else{t=this.images.normal_bg}}}}else{t=this.images.disable_bg}if(!t||!t.getImage()){t=this.images.default_bg}if(!t||!t.getImage()){t=this.images.normal_bg}if(!t||!t.getImage()){return}return t};UIElement.prototype.drawImageAt=function(t,e,i,n,r,a,o,s){UIElement.drawImageAt(t,e,i,n,r,a,o,s)};UIElement.drawImageAt=function(t,e,i,n,r,a,o,s){return WImage.draw(t,e,i,n,r,a,o,s)};UIElement.drawImageLine=function(t,e,i,n,r,a){var o=Math.lineAngle(n,r);var s=Math.round(Math.distanceBetween(n,r));t.save();t.translate(n.x,n.y);t.rotate(o);t.translate(0,-e.height>>1);UIElement.drawImageAt(t,e,i,0,0,s,e.height,a);t.restore();return};UIElement.prototype.setImageScale=function(t,e){this.imageScaleX=t;this.imageScaleY=e;this.images.display=UIElement.IMAGE_DISPLAY_SCALE;return this};UIElement.prototype.drawBgImageScale=function(t,e,i,n,r){var a=this._w;var o=this._h;var s=a>>1;var l=o>>1;t.save();t.translate(s,l);t.scale(n,r);t.translate(-s,-l);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,a,o,i);t.restore()};UIElement.prototype.drawBgImage=function(t){var e=this.getBgImage();if(e){var i=e.image;var n=e.rect;var r=this.images.display;var a=this.imageScaleX;var o=this.imageScaleY;if(a===1&&o===1||!a&&!o||r!==UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,i,r,0,0,this.w,this.h,n)}else{this.drawBgImageScale(t,i,n,a,o)}}return};UIElement.prototype.beforeDrawIcon=function(t){return false};UIElement.prototype.afterDrawIcon=function(t){return false};UIElement.prototype.prepareStyle=function(t){var e=this.style;t.beginPath();if(t.lineWidth!==e.lineWidth){t.lineWidth=e.lineWidth}if(t.strokeStyle!=e.lineColor){t.strokeStyle=e.lineColor}if(t.fillStyle!=e.fillColor){t.fillStyle=e.fillColor}return};UIElement.prototype.updateTransform=function(t){if(this.events["onUpdateTransform"]||this.hasEventListener("updatetransform")){if(!this.isInDesignMode()){this.callOnUpdateTransformHandler(t)}}return};UIElement.prototype.saveTransform=function(){this.savedTransform={};this.savedTransform.opacity=this.opacity;this.savedTransform.scale=this.scale;this.savedTransform.scaleX=this.scaleX;this.savedTransform.scaleY=this.scaleY;this.savedTransform.rotation=this.rotation;this.savedTransform.offsetX=this.offsetX;this.savedTransform.offsetY=this.offsetY;return};UIElement.prototype.restoreTransform=function(){if(this.savedTransform){this.opacity=this.savedTransform.opacity;this.scale=this.savedTransform.scale;this.scaleX=this.savedTransform.scaleX;this.scaleY=this.savedTransform.scaleY;this.rotation=this.savedTransform.rotation;this.offsetX=this.savedTransform.offsetX;this.offsetY=this.savedTransform.offsetY}return};UIElement.prototype.setHighlightConfig=function(t){if(t){var e=JSON.parse(JSON.stringify(t));e.startTime=0;this.saveTransform();this.removeHighlightConfig=false;this.highlightConfig=e;if(e.rotationFrom!==undefined&&e.rotationTo!==undefined){e.rotationRange=e.rotationTo-e.rotationFrom;e.rotationMiddle=(e.rotationTo+e.rotationFrom)/2}else{e.rotationRange=0}if(e.opacityFrom!==undefined&&e.opacityTo!==undefined){e.opacityRange=e.opacityTo-e.opacityFrom;e.opacityMiddle=(e.opacityTo+e.opacityFrom)/2}else{e.opacityRange=0}if(e.scaleFrom!==undefined&&e.scaleTo!==undefined){e.scaleRange=e.scaleTo-e.scaleFrom;e.scaleMiddle=(e.scaleTo+e.scaleFrom)/2}else{e.scaleRange=0}if(e.scaleXFrom!==undefined&&e.scaleXTo!==undefined){e.scaleXRange=e.scaleXTo-e.scaleXFrom;e.scaleXMiddle=(e.scaleXTo+e.scaleXFrom)/2}else{e.scaleXRange=0}if(e.scaleYFrom!==undefined&&e.scaleYTo!==undefined){e.scaleYRange=e.scaleYTo-e.scaleYFrom;e.scaleYMiddle=(e.scaleYTo+e.scaleYFrom)/2}else{e.scaleYRange=0}if(e.offsetXFrom!==undefined&&e.offsetXTo!==undefined){e.offsetXRange=e.offsetXTo-e.offsetXFrom;e.offsetXMiddle=(e.offsetXTo+e.offsetXFrom)/2}else{e.offsetXRange=0}if(e.offsetYFrom!==undefined&&e.offsetYTo!==undefined){e.offsetYRange=e.offsetYTo-e.offsetYFrom;e.offsetYMiddle=(e.offsetYTo+e.offsetYFrom)/2}else{e.offsetYRange=0}}else{this.removeHighlightConfig=true}return};UIElement.prototype.updateHighlightTransform=function(t){var e=this.timeScaleIsZero()||this.isInDesignMode()&&this.disablePreview;if(this.highlightConfig&&!e){var i=this.highlightConfig;if(i.paused)return;var n=this;var r=0;var a=i.random?i.random/1e3:0;var o=i.frequency?i.frequency:4;if(i.startTime){r=(t.now-i.startTime)/1e3}else{i.startTime=Date.now()}r+=1/(o*4)+a;var s=o*Math.PI*2;var l=this.scaleTime(Math.cos(s*r)*.5);if(this.removeHighlightConfig&&Math.abs(l)<.1){this.removeHighlightConfig=false;this.highlightConfig=null;this.restoreTransform();return}if(i.rotationRange){this.rotation=i.rotationMiddle+i.rotationRange*l}if(i.opacityRange){this.opacity=i.opacityMiddle+i.opacityRange*l}if(i.scaleRange){var h=i.scaleMiddle+i.scaleRange*l;this.scaleX=h;this.scaleY=h}if(i.scaleXRange){this.scaleX=i.scaleXMiddle+i.scaleXRange*l}if(i.scaleYRange){this.scaleY=i.scaleYMiddle+i.scaleYRange*l}if(i.offsetXRange){this.offsetX=i.offsetXMiddle+i.offsetXRange*l}if(i.offsetYRange){this.offsetY=i.offsetYMiddle+i.offsetYRange*l}t.needRedraw++}return};UIElement.prototype.paintSelf=function(t){this.stepAnimation(t);if(!this.visible)return;var e=this.animating;t.save();this.translate(t);if(!e){this.updateTransform(t)}if(this.highlightConfig){this.updateHighlightTransform(t)}this.applyTransform(t);this.onClip(t);t.save();var i=this.flipX?-1:1;var n=this.flipY?-1:1;if(i<0||n<0){t.save();var r=this.w>>1;var a=this.h>>1;t.translate(r,a);t.scale(i,n);t.translate(-r,-a)}if(this.beforePaint){this.beforePaint(t)}this.drawBgImage(t);this.paintSelfOnly(t);this.drawImage(t);if(i<0||n<0){t.restore()}t.restore();if(this.children.length||this.isInDesignMode()){t.save();if(e){t.animating++}this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);if(e){t.animating--}t.restore()}if(this.drawText&&this.textType!==Shape.TEXT_NONE){this.drawText(t);this.drawTextTips(t)}if(this.afterPaint){this.afterPaint(t)}t.restore();return};UIElement.prototype.saveProps=[];UIElement.prototype.urlProps=["dataURL"];UIElement.saveProps=["xAttr","yAttr","widthAttr","heightAttr","xParam","yParam","widthParam","heightParam","sticky","flipX","flipY","rotateChildren","defaultAnimationName","dataURL","disablePreview","dataSourceUrl","imageScaleX","imageScaleY","propagatePointerEvent"];UIElement.prototype.doToJsonCustom=function(t){t.propertySheetDesc=this.propertySheetDesc;for(var e in t.propertySheetDesc){var i=this[e];if(i!==undefined){t[e]=i}}return this};UIElement.prototype.doToJson=function(t){this.updateLayoutParams();RShape.prototype.doToJson.call(this,t);t.runtimeVisible=this.runtimeVisible;if(this.isUILoadingWindow){t.isUILoadingWindow=true}if(this.value!==undefined){t.value=this.value}this.propsToJson(t,this.saveProps);this.propsToJson(t,UIElement.saveProps);if(this.urlProps){for(var e=0;e<this.urlProps.length;e++){var i=this.urlProps[e];var n=t[i];if(n){t[i]=this.getRelativePathOfURL(n)}}}this.imagesToJson(t);t.events=this.events;if(this.animations){t.animations=JSON.parse(JSON.stringify(this.animations))}if(this.handle){t.handle={};t.handle.x=this.handle.x;t.handle.y=this.handle.y}if(this.settings){t.settings=this.settings}if(this.propertySheetDesc){this.doToJsonCustom(t)}this.childrenToJson(t);return t};UIElement.prototype.childToJson=function(t){return t.toJson()};UIElement.prototype.childrenToJson=function(t){var e=this.children.length;var i=this.children;t.children=[];for(var n=0;n<e;n++){var r=i[n];t.children.push(this.childToJson(r))}return this};UIElement.prototype.childrenFromJson=function(t){if(t.children){var e=t.children.length;var i=ShapeFactoryGet();this.children.clear(true);for(var n=0;n<e;n++){var r=t.children[n];if(!r){console.log("Warning: child is null.");continue}var a=r.type?r.type:r.id;var o=i.createShape(a,C_CREATE_FOR_USER);if(o){if(r.z===undefined){r.z=n}o.z=r.z;if(this.addShapeDirectly(o)){o.fromJson(r)}}}}this.targetShape=null;this.pointerEventTarget=null;return};UIElement.prototype.doFromJsonCustom=function(t){this.propertySheetDesc=t.propertySheetDesc;for(var e in t.propertySheetDesc){var i=t[e];if(i!==undefined){this[e]=i}}};UIElement.prototype.doFromJson=function(t){RShape.prototype.doFromJson.call(this,t);if(t.runtimeVisible===undefined){this.runtimeVisible=true}else{this.runtimeVisible=t.runtimeVisible}if(t.isUILoadingWindow){this.isUILoadingWindow=true}this.propsFromJson(t,UIElement.saveProps);this.propsFromJson(t,this.saveProps);Object.keys(t.events).forEach(function(e){this.events[e]=t.events[e]},this);this.imagesFromJson(t);if(t.animations){this.animations=t.animations}else if(this.animations){delete this.animations}if(t.handle){this.handle={};this.handle.x=t.handle.x;this.handle.y=t.handle.y}if(t.settings){this.settings=t.settings}if(t.propertySheetDesc){this.doFromJsonCustom(t)}if(t.value!==undefined){this.value=t.value;this.setValue(this.getValue())}this.childrenFromJson(t);return this};UIElement.prototype.afterApplyFormat=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.findChildByPoint=function(t,e,i){var n=t;var r=this.children.length;for(var a=r;a>0;a--){var o=this.children[a-1];if(!o.visible)continue;if(o.hitTest(n)){if(i&&!i(o)){continue}if(e){var s={};s.x=n.x-o.left+(o.xOffset||0);s.y=n.y-o.top+(o.yOffset||0);return o.findChildByPoint(s,e,i)}else{return o}}else{if(e){var s={};s.x=n.x-o.left+(o.xOffset||0);s.y=n.y-o.top+(o.yOffset||0);var l=o.findChildByPoint(s,e,i);if(l!==o){return l}}}}return this};UIElement.prototype.findShapeByPoint=UIElement.prototype.findChildByPoint;UIElement.prototype.getChildren=function(){return this.children};UIElement.prototype.getChildrenNr=function(){return this.children.length};UIElement.prototype.getChild=function(t){return t<this.children.length&&t>=0?this.children[t]:null};UIElement.prototype.canBindingData=function(){return!this.isUIDevice&&!this.isUIScreen&&!this.isUIWindowManager&&this.children.length>0};UIElement.prototype.onDataBindingTemplate=function(t){if(this.isUIImage){var e=this.getImageByType(UIElement.IMAGE_DEFAULT);var i=e?e.getImageSrc():"";i=this.getRelativePathOfURL(i);t.image=i}else{if(this.value!==undefined){t.value=this.value}}if(this.text||this.isUILabel){t.text=this.text}return t};UIElement.prototype.getDataBindingTemplate=function(){var t=0;var e=null;var i={};var n=this.children;var r=this.children.length;this.onDataBindingTemplate(i);if(r>0){i.children=[];for(t=0;t<r;t++){e=n[t];if(!this.childIsBuiltin(e)){i.children.push(e.getDataBindingTemplate())}}}return i};UIElement.prototype.setUserData=function(t){this.userData=t;return};UIElement.prototype.getUserData=function(){return this.userData};UIElement.prototype.onBindData=function(t){var e=t.text;var i=t.image;var n=t.value;if(e!==undefined){this.setText(e)}if(i!==undefined){this.setImage(UIElement.IMAGE_DEFAULT,i)}if(n!==undefined){this.setValue(n)}if(t.enable!==undefined){this.setEnable(t.enable)}if(t.visible!==undefined){this.setVisible(t.visible)}if(t.textColor){this.style.setTextColor(t.textColor)}if(t.fillColor){this.style.setFillColor(t.fillColor)}if(t.lineColor){this.style.setLineColor(t.lineColor)}if(t.fontSize){this.style.setFontSize(t.fontSize)}this.setUserData(t.userData);if(t.height){this.h=t.height}if(t.width){this.w=t.width}if(this.offset){this.offset=0}var r=["children","text","value","image","visible","enable","textColor","fillColor","lineColor","fontSize","userData"];for(var a in t){if(r.indexOf(a)>=0)continue;var n=t[a];var o=this.find(a,true);if(!o)continue;if(typeof n==="object"){o.doBindData(n)}else{o.setValue(n)}}return};UIElement.prototype.moveMustBeLastItemToLast=function(){var t=null;var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=e[n];if(r.name==="ui-last"){t=r;e[n]=e[i-1];e[i-1]=t;break}}return};UIElement.prototype.childIsBuiltin=function(t){return false};UIElement.makeImageURLToAbsOfJson=function(t){if(!t){return}var e=t.images;var i=window.location.protocol+"//"+window.location.host+"/";for(var n in e){var r=e[n];if(n!=="display"){if(r.indexOf("http://")<0&&r.indexOf("https://")<0){r=i+r;e[n]=r}}}if(!t.children){return}for(var a=0;a<t.children.length;a++){var o=t.children[a];UIElement.makeImageURLToAbsOfJson(o)}return};UIElement.prototype.getTemplateChildJson=function(){if(!this.templateChildJson){var t=this.getTemplateChild();this.templateChildJson=t?t.toJson():null;UIElement.makeImageURLToAbsOfJson(this.templateChildJson);if(this.templateChildJson){delete this.templateChildJson.isTemplate}else{console.log("No Template Child.")}}return this.templateChildJson};UIElement.prototype.getTemplateChild=function(){if(!this.templateChild){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isTemplate){this.children.remove(e);this.templateChild=e;break}}if(!this.templateChild){this.templateChild=this.getLastUserChild()}}return this.templateChild};UIElement.prototype.dupTemplateChild=function(){var t=this.getTemplateChild().clone();delete t.isTemplate;return t};UIElement.prototype.dupChild=function(t,e){var i=this.findChildByName(t);if(i){var n=i.clone();if(isNaN(e)){e=i.z+1}this.addShape(n,false,null,e);n.fixName();return n}else{return null}};UIElement.prototype.getLastUserChild=function(){var t=this.children;var e=this.children.length;if(e>0){for(var i=e-1;i>=0;i--){var n=t[i];if(!this.childIsBuiltin(n)){return n}}}return null};UIElement.prototype.countUserChildren=function(){var t=0;var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(!this.childIsBuiltin(r)){t=t+1}}return t};UIElement.prototype.setDisableRelayout=function(t){this.disableRelayout=t;return this};UIElement.prototype.bindData=function(t,e,i){var n=this;n.setDisableRelayout(true);n.doBindData(t,i);n.setDisableRelayout(false);n.relayoutChildren(e);console.log("bindData: done");n.postRedraw();return this};UIElement.prototype.doBindData=function(t,e){var i=0;var n=0;var r=null;var a=this.isUIList||this.isUIGrid?this.getTemplateChildJson():null;this.onBindData(t);var o=this.children;var s=this.countUserChildren();if(s<1&&!a||!t.children){return}var l=t.children.length;if(this.isUIList||this.isUIGrid){if(l>s){a.y=0;a.visible=true;for(i=s;i<l;i++){this.addChildWithJson(a)}}else if(l<s&&e){var h=[];n=s-l;for(i=this.children.length-1;i>=0;i--){var r=this.children[i];if(!this.childIsBuiltin(r)&&!r.isTemplate){h.push(r)}}for(var i=0;i<h.length;i++){var r=h[i];if(i===n){break}this.children.remove(r);r.setParent(null);r.setApp(null);r.setView(null)}}s=this.children.length}else{s=this.children.length}for(i=0,n=0;n<s&i<l;n++){r=o[n];if(!this.childIsBuiltin(r)){r.doBindData(t.children[i]);i=i+1}}return};UIElement.prototype.bindDataUrl=function(t,e,i){var n={};var r=this;httpGetJSON(t,function(t){if(e){t=e(t)}if(t){r.bindData(t,"default",true)}if(i){i(t)}});return};function UIElementCreator(t){t=t?t:"ui-element";var e=[t,"UI-Element",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIElement;return e.initUIElement(this.type)};return}UIElement.prototype.sortChildren=function(){return};UIElement.prototype.shouldShowContextMenu=function(){return this.isInDesignMode()};UIElement.prototype.setText=function(t,e){if(this.text!=t){this.text=this.toText(t);if(e){this.callOnChangedHandler(t)}this.textNeedRelayout=true}this.postRedraw();return this};UIElement.prototype.getValue=function(){return this.getText()};UIElement.prototype.setValue=function(t,e,i){var n=this;var r=this.getText()||0;t=String(t);if(t==String(r))return this;if(!!i&&!isNaN(+t)&&!isNaN(+r)){var a=t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0;this.animate({duration:300,valueEnd:+t,valueStart:+r,onStep:function(t,e,i){n.setText(i.value.toFixed(a));return true},onDone:function(e,i){n.setText(t);console.debug("element setValue onDone")}})}else{this.setText(t)}return this};UIElement.prototype.addValue=function(t,e,i){var n=this.getValue();var r=String(n).indexOf(":");if(r==-1){n=+n;var a=(isNaN(n)?0:n)+(isNaN(+t)?0:+t);var o=u(String(n));var s=u(String(t));var l=u(String(a));var h=o>s?o:s;h=h>l?l:h;function u(t){return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}return this.setValue(a.toFixed(h),e,i)}else{var c=+n.substr(0,r);var p=+n.substr(r+1,2);var f=(isNaN(c)?0:c*60)+(isNaN(p)?0:p);var m=f+t>>0;if(isNaN(+t)||m<0){return this}else{var c=Math.floor(m/60);var p=m%60;c=c<10?"0"+c:c;p=p<10?"0"+p:p;return this.setValue(c+":"+p)}}};UIElement.prototype.getPositionInView=function(){var t=this.getX();var e=this.getY();var i={x:0,y:0};var n=this.parentShape;while(n!=null){t+=n.getX();e+=n.getY();if(n.isUIVScrollView){e=e-n.offset}else if(n.isUIHScrollView){t=t-n.offset}else if(n.isUIScene||n.isUIScrollViewX){t=t-n.xOffset;e=e-n.yOffset}n=n.parentShape}i.x=t;i.y=e;return i};UIElement.prototype.getLocaleText=function(t){var e=webappGetText(t);if(!e){return t}if(!this.locale){this.locale={text:e};this.needRelayout=true}return e};UIElement.prototype.getLocaleInputTips=function(t){var e=webappGetText(t);return e?e:t};UIElement.prototype.setBgImage=function(t){return this.setImage(UIElement.IMAGE_DEFAULT,t)};UIElement.prototype.onImageLoad=function(){this.postRedraw()};UIElement.prototype.getDefaultImageType=function(){return UIElement.IMAGE_DEFAULT};UIElement.prototype.setImage=function(t,e){var i=this;var n=arguments.length;if(n<2){e=t;t=this.getDefaultImageType()}else{t=t?t:this.getDefaultImageType()}var r=null;if(e===null||e===undefined){r=WImage.create(null)}else if(typeof e==="object"){if(e.image){r=e}else{r=WImage.createWithImage(e)}}else if(typeof e==="number"||e.length<4){r=this.images["option_image_"+e]}else{r=WImage.create(e,this.onImageLoad.bind(this))}this.images[t]=r;return this};UIElement.prototype.getHtmlImageByType=function(t){if(typeof t==="number"){t="option_image_"+t}var e=this.images[t];return e?e.getImage():null};UIElement.prototype.getImageByType=function(t){if(typeof t==="number"){t="option_image_"+t}return this.images[t]};UIElement.prototype.getImageSrcByType=function(t){if(typeof t==="number"){t="option_image_"+t}var e=this.images[t];return e?e.getImageSrc():""};UIElement.prototype.getImageTypes=function(){var t=[];for(var e in this.images){var i=this.images[e];if(e!="display"){t.push(e)}}return t};UIElement.prototype.addEventNames=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];if(!this.events[i]){this.events[i]=null}}}return this};UIElement.prototype.removeEventNames=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];delete this.events[i]}}return this};UIElement.prototype.getEventNames=function(){var t=[];for(var e in this.events){t.push(e)}return t};UIElement.uidStart=1e4+Math.floor(Math.random()*1e4);UIElement.prototype.initUIElement=function(t){this.initContainerShape(t);this.enable=true;this.visible=true;this.opacity=1;this.vMargin=0;this.hMargin=0;this.xAttr=UIElement.X_FIX_LEFT;this.yAttr=UIElement.Y_FIX_TOP;this.widthAttr=UIElement.WIDTH_FIX;this.heightAttr=UIElement.HEIGHT_FIX;this.name=t;this.events={};this.uid=UIElement.uidStart++;this.runtimeVisible=true;this.images={};this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.addEventNames(["onClick"]);return this};UIElement.prototype.updateLayoutParams=function(){var t=this.parentShape;if(!t){return}this.xParam=1;this.yParam=1;this.widthParam=1;this.heightParam=1;var e=t.getRelayoutWidth();var i=t.getRelayoutHeight();if(this.xAttr===UIElement.X_SCALE){this.xParam=this.left/e}else if(this.xAttr===UIElement.X_FIX_RIGHT){this.xParam=e-(this.left+this.w)}if(this.yAttr===UIElement.Y_SCALE){this.yParam=this.top/i}else if(this.yAttr===UIElement.Y_FIX_BOTTOM){this.yParam=i-(this.top+this.h)}if(this.widthAttr===UIElement.WIDTH_SCALE){this.widthParam=this.w/e;this.widthScaleMin=this.w>>1;this.widthScaleMax=this.w<<1}if(this.heightAttr===UIElement.HEIGHT_SCALE){this.heightParam=this.h/i;this.heightScaleMin=this.h>>1;this.heightScaleMax=this.h<<1}if(this.heightAttr===UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH){this.heightParam=this.h/this.w}return this};UIElement.prototype.imagesToJson=function(t){t.images={};for(var e in this.images){var i=this.images[e];if(e==="display"){t.images[e]=i}else{var n=i.getImageSrc();n=this.getRelativePathOfURL(n);if(n){t.images[e]=n;var r=n.indexOf("#");if(r>0){var a=i.getRealImageSrc();a=this.getRelativePathOfURL(a);var o=n.substr(0,r);if(a&&a.indexOf(n)<0){t.images["real-image-"+o]=decodeURI(a)}}}}}return t};UIElement.prototype.imagesFromJson=function(t){if(t.images){for(var e in t.images){var i=t.images[e];if(e==="display"){this.images[e]=i}else if(e.indexOf("real-image")!==0){this.setImage(e,i)}}}return};UIElement.prototype.getEnable=function(){return this.enable};UIElement.prototype.setEnable=function(t){this.enable=t;return this};UIElement.prototype.isEnable=function(){var t=this;if(!this.isValid()){return false}while(t!=null){if(!t.enable){return false}t=t.parentShape}return true};UIElement.prototype.getVisible=function(t){return this.visible};UIElement.prototype.setVisible=function(t){this.visible=t;if(!t){if(this.animatingInfo){UIElement.logWarning("hide animating element invisble.")}}return this};UIElement.prototype.isVisible=function(){var t=this;if(!this.isValid()){return false}while(t!=null){if(!t.visible){return false}t=t.parentShape}return true};UIElement.prototype.isFocused=function(){return this.parentShape&&this.parentShape.targetShape==this};UIElement.prototype.onShowHTML=function(){return};UIElement.prototype.onHideHTML=function(){return};UIElement.prototype.showHTML=function(){var t=0;var e=this.children.length;for(t=0;t<e;t++){var i=this.children[t];i.showHTML()}this.onShowHTML();return};UIElement.prototype.hideHTML=function(){var t=0;var e=this.children.length;for(t=0;t<e;t++){var i=this.children[t];i.hideHTML()}this.onHideHTML();return};UIElement.prototype.show=function(){return this.setVisible(true)};UIElement.prototype.hide=function(){return this.setVisible(false)};UIElement.prototype.beforeRelayout=function(){};UIElement.prototype.afterRelayout=function(){};UIElement.prototype.getPrevSibling=function(){if(!this.parentShape||this.parentShape.children.length<2){return null}var t=0;for(t=0;t<this.parentShape.children.length;t++){if(this.parentShape.children[t]===this){break}}return t>0?this.parentShape.children[t-1]:null};UIElement.prototype.setAutoScaleFontSize=function(t){this.enableAutoScaleFontSize=t;return this};UIElement.prototype.autoScaleFontSize=function(t){if(this.enableAutoScaleFontSize){var e=Math.round(this.style.fontSize*t);e=Math.min(e,36);e=Math.max(e,12);this.style.setFontSize(e)}return};UIElement.prototype.getRelayoutWidth=function(){return this.getWidth()};UIElement.prototype.getRelayoutHeight=function(){return this.getHeight()};UIElement.prototype.relayout=function(){if(this.disableRelayout){return}var t=getParentShapeOfShape(this);if(!t||!t.isUIElement){if(this.isInDesignMode()){this.setUserMovable(true);this.setUserResizable(true)}}if(this.isUIDevice){this.setUserResizable(false)}if(!t){this.relayoutChildren();return}var e=0;var i=0;var n=0;var r=0;var a=this.xAttr;var o=this.yAttr;var s=t.getRelayoutWidth();var l=t.getRelayoutHeight();var h=t.getHMargin();var u=t.getVMargin();var c=s-h-h;var p=l-u-u;var f=this.top+this.h;var m=this.left+this.w;this.beforeRelayout();switch(this.widthAttr){case UIElement.WIDTH_SCALE:{e=s*this.widthParam;if(this.widthScaleMin&&e<this.widthScaleMin){if(this.pointerDown){this.widthScaleMin=e}else{e=this.widthScaleMin}}if(this.widthScaleMax&&e>this.widthScaleMax){if(this.pointerDown){this.widthScaleMax=e}else{e=this.widthScaleMax}}break}case UIElement.WIDTH_FILL_PARENT:{e=c;this.left=h;a=UIElement.X_FIX_LEFT;break}default:{e=this.w;break}}switch(this.heightAttr){case UIElement.HEIGHT_SCALE:{i=l*this.heightParam;if(this.heightScaleMin&&i<this.heightScaleMin){if(this.pointerDown){this.heightScaleMin=i}else{i=this.heightScaleMin}}if(this.heightScaleMax&&i>this.heightScaleMax){if(this.pointerDown){this.heightScaleMax=i}else{i=this.heightScaleMax}}break}case UIElement.HEIGHT_FILL_PARENT:{i=p;this.top=u;o=UIElement.Y_FIX_TOP;break}default:{i=this.h;break}}switch(a){case UIElement.X_SCALE:{n=s*this.xParam;break}case UIElement.X_FIX_RIGHT:{n=s-this.xParam-this.w;break}case UIElement.X_CENTER_IN_PARENT:{n=s-e>>1;break}case UIElement.X_LEFT_IN_PARENT:{n=h;break}case UIElement.X_RIGHT_IN_PARENT:{n=s-e-h;break}default:{n=this.left;break}}switch(o){case UIElement.Y_SCALE:{r=l*this.yParam;break}case UIElement.Y_FIX_BOTTOM:{r=l-this.yParam-this.h;break}case UIElement.Y_MIDDLE_IN_PARENT:{r=l-i>>1;break}case UIElement.Y_TOP_IN_PARENT:
{r=u;break}case UIElement.Y_BOTTOM_IN_PARENT:{r=l-i-u;break}default:{r=this.top;break}}if(this.widthAttr===UIElement.WIDTH_FILL_TO_PARENT_RIGHT){e=s-n-h}if(this.heightAttr===UIElement.HEIGHT_FILL_TO_PARENT_BOTTOM){i=l-r-u}if(this.heightAttr===UIElement.HEIGHT_KEEP_RATIO_WITH_WIDTH){i=e*this.heightParam}var d=this.w;this.w=Math.round(e);this.h=Math.round(i);this.setLeftTop(n,r);if(t.isUIElement){if(this.isInDesignMode()){var y=this.getWindow();if(y&&!y.isUIScene&&!y.isUIDialog){t.fixChildSize(this)}}t.fixChildPosition(this)}this.setSize(this.w,this.h);this.autoScaleFontSize(e/d);this.relayoutChildren();this.afterRelayout();this.setTextNeedRelayout(true);return};UIElement.prototype.beforeRelayoutChild=function(t){return true};UIElement.prototype.afterRelayoutChild=function(t){return true};UIElement.prototype.relayoutChildren=function(){if(this.disableRelayout||!this.children){return}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||e.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){continue}if(this.beforeRelayoutChild(e)){e.relayout()}this.afterRelayoutChild(e)}for(var t=0;t<this.children.length;t++){var e=this.children[t];if(!(e.widthAttr===UIElement.WIDTH_FILL_AVAILABLE||e.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE)){continue}if(this.beforeRelayoutChild(e)){e.relayout()}this.afterRelayoutChild(e)}return};UIElement.prototype.getWindowManager=function(){return UIWindowManager.getInstance()};UIElement.prototype.getDevice=function(){var t=this;while(t!=null&&!t.isUIDevice){t=t.parentShape}return t};UIElement.prototype.getDeviceConfig=function(){var t=this.getWindowManager();if(t){return t.getDeviceConfig()}return null};UIElement.prototype.getTopWindow=function(){var t=this.getWindowManager();return t.getCurrentWindow()};UIElement.prototype.setAssetsLoadingWindow=function(t){var e=this.getWindowManager();if(e){e.setAssetsLoadingWindow(t)}return this};UIElement.prototype.isTopWindow=function(){var t=this.getWindow();return t===this.getTopWindow()};UIElement.prototype.getWindow=function(){var t=this;while(t!=null&&!t.isUIWindow){t=t.parentShape}return t};UIElement.prototype.getPositionInWindow=function(){var t=this.getAbsLeftTop();var e=this.anchor;if(e){t.x+=e.x*this.w;t.y+=e.y*this.h}return t};UIElement.prototype.getAbsLeftTop=function(){var t=this;var e=t.left;var i=t.top;while(t!=null&&!t.isUIWindow){t=t.parentShape;if(t.isUIWindow){break}e=e+t.left;i=i+t.top}return{x:e,y:i}};UIElement.prototype.localToGlobal=function(t){var e=this.getAbsLeftTop();e.x+=t.x;e.y+=t.y;return e};UIElement.prototype.globalToLocal=function(t){var e=this.getAbsLeftTop();e.x=t.x-e.x;e.y=t.y-e.y;return e};UIElement.prototype.getWindowNames=function(){var t=this.getWindowManager();if(t){return t.getWindowNames()}return[]};UIElement.prototype.openScene=function(t,e){var i=this.getWindowManager();setTimeout(function(){i.openWindow(t,null,true,e)},0)};UIElement.prototype.isWindowOpen=function(t){var e=this.getWindowManager();var i=e.find(t);return i&&i.isOpen()};UIElement.prototype.openWindow=function(t,e,i,n,r){var a=this.getWindowManager();if(a){return a.openWindow(t,e,i,n,r)}return false};UIElement.prototype.closeAllWindows=function(){var t=this.getWindowManager();if(t){t.closeAll()}return};UIElement.prototype.backToHomeWin=function(){var t=this.getWindowManager();if(t){t.backToHomeWin()}return};UIElement.prototype.closeWindow=function(t,e){var i=this.getWindow();var n=this.getWindowManager();if(n&&i){if(i.isOpen()){return n.closeWindow(i,t,e)}else{console.log("Current Window Is Not Open.")}}return false};UIElement.prototype.canBeComponent=function(){return true};UIElement.prototype.isCreatingElement=function(){if(this.view&&this.view.creatingShape===this){return true}return false};UIElement.prototype.onScaleForDensityDone=function(t,e){};UIElement.prototype.setNotScaleForDensity=function(t){this.notScaleForDensity=t;return};UIElement.prototype.scaleForDensity=function(t,e,i){if(!t||t===1||this.notScaleForDensity){return}if(this.widthAttr===UIElement.WIDTH_FIX){this.w=Math.floor(this.w*t)}if(this.heightAttr===UIElement.HEIGHT_FIX){this.h=this.h*t;if(this.h<36&&(this.isUIButton||this.isUIProgressBar||this.isUIColorTile||this.isUIColorButton||this.isUIEdit||this.isUIRadioBox||this.isUICheckBox||this.isUIWaitBar||this.isUISwitch)){this.h=40}if(this.h<50&&(this.isUIToolBar||this.isUIButtonGroup)){this.h=50}if(this.hMin>this.h){this.hMin=this.h}}var n=this.isCreatingElement();if(!n&&this.yAttr===UIElement.Y_FIX_TOP){this.top=Math.floor(this.top*t)}if(!n&&this.xAttr===UIElement.X_FIX_LEFT){this.left=Math.floor(this.left*t)}this.style.setFontSize(Math.floor(this.style.fontSize*t));if(this.itemHeight>20){this.itemHeight=Math.floor(this.itemHeight*t)}if(this.roundRadius){this.roundRadius=Math.floor(this.roundRadius*t)}this.vMargin=Math.floor(this.vMargin*t);this.hMargin=Math.floor(this.hMargin*t);if(this.buttonHeight>40){this.buttonHeight=Math.floor(this.buttonHeight*t)}this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.w=Math.round(this.w);this.h=Math.round(this.h);if(i){for(var r=0;r<this.children.length;r++){var a=this.children[r];a.scaleForDensity(t,e,true)}}if(this.isUIProgressBar){var o=this.getValue();this.setValue(0);this.setValue(o)}this.onScaleForDensityDone(t,e);return};UIElement.prototype.onDeviceConfigChanged=function(t,e){return};UIElement.prototype.fixImagePath=function(t,e){var i=t.version;var n=t.platform;var r=t.lcdDensity;var a=e.version;var o=e.platform;var s=e.lcdDensity;for(var l in this.images){var h=this.images[l];if(l==="display"){continue}var u=h.getImageSrc();if(u){u=u.replaceAll("/"+r+"/","/"+s+"/");h.setImageSrc(u)}}return};UIElement.prototype.scaleForCurrentDensity=function(t){var e=this.getDeviceConfig();var i=this.getDensitySizeByName(e?e.lcdDensity:"hdpi");return t*(i/160)};UIElement.prototype.getDensitySizeByName=function(t){switch(t){case"ldpi":{return 80}case"mdpi":{return 160}case"hdpi":{return 240}case"xhdpi":{return 350}case"xxhdpi":{return 450}default:{console.log("not supported density: "+t)}}return 160};UIElement.prototype.getSizeScale=function(t,e){var i=this.getDensitySizeByName(t);var n=this.getDensitySizeByName(e);var r=n/i;return r};UIElement.prototype.notifyDeviceConfigChanged=function(t,e){for(var i=0;i<this.children.length;i++){var n=this.children[i];n.notifyDeviceConfigChanged(t,e)}this.fixImagePath(t,e);this.onDeviceConfigChanged(t,e);return};UIElement.prototype.addMovementForVelocityTracker=function(){if(this.velocityTracker){var t={};t.x=this.getMoveAbsDeltaX();t.y=this.getMoveAbsDeltaY();var e=Date.now()*1e6;this.velocityTracker.addMovement(e,t);delete date}return};UIElement.prototype.isUserMovable=function(){return this.userMovable&&!this.isLocked()};UIElement.prototype.isUserResizable=function(){return this.userResizable};UIElement.prototype.getEditorRect=function(){var t={};t.x=this.left;t.y=this.top;t.w=this.w;t.h=this.h;return t};UIElement.funcs=[];UIElement.setAnimTimer=function(t,e){return UIElement.setTimeout(t,e)};UIElement.setTimeout=function(t,e){e=e?Math.max(e,16):16;t.deltaTime=e;t.time=Date.now()+e;UIElement.funcs.push(t);function i(){var t=UIElement.funcs;var e=Date.now();var n=t.length;UIElement.funcs=[];for(var r=0;r<n;r++){var a=t[r];if(a.time<=e){if(a()){a.time=e+a.deltaTime;UIElement.funcs.push(a)}}else{UIElement.funcs.push(a)}}t=null;if(UIElement.funcs.length){UIElement.animTimerID=requestAnimFrame(i)}else{UIElement.animTimerID=0}}if(!UIElement.animTimerID){UIElement.animTimerID=requestAnimFrame(i,16)}return};UIElement.getMainCanvas=function(){return CantkRT.getMainCanvas()};UIElement.getMainCanvasScale=function(t){return CantkRT.getMainCanvasScale()};UIElement.prototype.isFullscreenMode=function(){return cantkIsFullscreen()};UIElement.prototype.setFlipX=function(t){this.flipX=t;return this};UIElement.prototype.setFlipY=function(t){this.flipY=t;return this};UIElement.prototype.getFlipX=function(){return this.flipX};UIElement.prototype.getFlipY=function(){return this.flipY};UIElement.prototype.requestFullscreen=function(t){if(!isMobile()){if(t){t(false)}console.log("UIElement.requestFullScreen Rejected(not mobile)")}else{if(!cantkRequestFullscreen(t)){t(false)}console.log("UIElement.requestFullScreen")}return};UIElement.prototype.pickFiles=function(t,e){return showFileDialog(t,true,false,e)};UIElement.prototype.pickFile=function(t,e){if(!window.FileReader){return false}showFileDialog(t,false,true,function(t){var i=t[0];if(i){var n=new FileReader;n.readAsDataURL(i);n.onloadend=function(){if(e){e(i,n.result)}n=null}}});return true};UIElement.prototype.pickAudio=function(t){return this.pickFile("audio/*",t)};UIElement.prototype.pickImage=function(t){return this.pickFile("image/*",t)};UIElement.fixArtTextStyle=function(t){t.fontSize=t.fontSize?t.fontSize:16;t.imageBorder=t.imageBorder?t.imageBorder:10;t.textAlignH=t.textAlignH?t.textAlignH:"left";t.startColor=t.startColor?t.startColor:"Green";t.endColor=t.endColor?t.endColor:"Green";t.lineWidth=t.lineWidth?t.lineWidth:0;t.lineColor=t.lineColor?t.lineColor:"Black";t.shadowColor=t.shadowColor?t.shadowColor:"Black";t.shadowBlur=t.shadowBlur?t.shadowBlur:0;t.shadowOffsetX=t.shadowOffsetX?t.shadowOffsetX:0;t.shadowOffsetY=t.shadowOffsetY?t.shadowOffsetY:0;return t};UIElement.createArtTextImage=function(t,e,i){UIElement.fixArtTextStyle(e);if(!t){return null}var n=300;var r=80;var a=e.imageBorder;var o=e.fontSize;var s=e.fontFamily;var l=e.textAlignH;var h=e.monospace;var u=cantkGetTempCanvas(n,r);var c=u.getContext("2d");c.clearRect(0,0,n,r);var p=n>>1;var f=r>>1;var m="";var d=t.length;if(e.textB){m+="Bold "}if(e.textI){m+="Italic "}m+=o+"pt '"+s+"'";c.font=m;c.textBaseline="middle";c.textAlign="center";switch(l){case"left":{p=a;c.textAlign="left";break}case"right":{p=n-a;c.textAlign="right";break}default:break}if(h){var y=0;for(var v=0;v<d;v++){var g=t[v];var _=c.measureText(g).width;if(_>y){y=_}}y=y+4;n=d*y}else{var I=c.measureText(t).width;n=I+a*2}r=e.fontSize+2*(Math.abs(e.shadowOffsetY)+e.shadowOffsetY+a);u.width=n;u.height=r;if(i){c.fillStyle=i;c.fillRect(0,0,n,r)}c.font=m;c.textBaseline="middle";c.textAlign="center";if(e.useTexture&&e.texture){var x=WImage.create(e.texture);var w=x.getImage();if(w){var S=c.createPattern(w,"repeat");c.fillStyle=S}}else{if(e.startColor!=e.endColor){var b=c.createLinearGradient(0,0,0,r);if(e.horizonalGradient){b=c.createLinearGradient(0,0,n,0)}b.addColorStop(0,e.startColor);b.addColorStop(1,e.endColor);c.fillStyle=b}else{c.fillStyle=e.startColor}}if(e.shadowBlur){c.shadowOffsetX=e.shadowOffsetX;c.shadowOffsetY=e.shadowOffsetY;c.shadowBlur=e.shadowBlur;c.shadowColor=e.shadowColor}p=n>>1;f=r>>1;c.lineWidth=e.lineWidth;c.strokeStyle=e.lineColor;if(h){p=0;var C=y>>1;var d=t.length;c.textAlign="center";for(var v=0;v<d;v++){p=v*y+C;var g=t[v];c.fillText(g,p,f);c.strokeText(g,p,f)}}else{c.fillText(t,p,f);if(c.lineWidth){c.strokeText(t,p,f)}}var T=u.toDataURL();return T};ShapeFactoryGet().addShapeCreator(new UIGroupCreator(200,200,null));UIElement.prototype.timeScaleIsZero=function(){return Math.abs(this.getTimeScale())<1e-5};UIElement.prototype.getTimeScale=function(){return this.win.getTimeScale()};UIElement.prototype.scaleTime=function(t){return this.win.getTimeScale()*t};UIElement.prototype.setTimeScale=function(t){this.win.setTimeScale(t);return this};UIElement.prototype.getAppInfo=function(){var t=this.view.getMetaInfo();return t.general};UIElement.logNotice=function(t){console.log("%cNotice: "+t,"color: green; font-weight: bold")};UIElement.logWarning=function(t){console.log("%cWarning: "+t,"color: red; font-weight: bold")};UIElement.logError=function(t,e){console.log("%cWarning: "+t+"("+e.message+")\n"+e.stack,"color: red; font-weight: bold")};UIElement.prototype.isPointIn=function(t,e){var i=false;if(t){t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();i=t.isPointInPath(e.x,e.y)}else{i=isPointInRect(e,this)}return i};UIElement.prototype.pInPolygon=function(t,e,i){var n=false;for(var r=0,a=t.length-1;r<t.length;a=r++){if(t[r].y>i!=t[a].y>i&&e<(t[a].x-t[r].x)*(i-t[r].y)/(t[a].y-t[r].y)+t[r].x)n=!n}return n};UIElement.prototype.isPointInMatrix=function(t,e,i){var n=t.x,r=t.y,a=t.w,o=t.h,s={x:n,y:r},l={x:n+a,y:r},h={x:n+a,y:r+o},u={x:n,y:r+o},c=Matrix2D.identity;c.beginPath=function(){};c.clip=function(){};c.rect=function(){};c.arc=function(){};try{i.call(this,c)}catch(p){console.debug("applyTransform catch err",err)}var f=c.transformPoint(s.x,s.y),m=c.transformPoint(l.x,l.y),d=c.transformPoint(h.x,h.y),y=c.transformPoint(u.x,u.y),v=[f,m,d,y];c.identity();return this.pInPolygon(v,e.x,e.y)};UIElement.prototype.setImageDisplay=function(t){this.images.display=t;return this};UIElement.prototype.getPointerDeviceType=function(){return WEventsManager.getInstance().getPointerDeviceType()};function UIElementCreator(t){var e=[t,"ui-element",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIElement;return e.initUIElement(this.type)};return}UIElement.prototype.clearAssetsCache=function(t){this.getWindowManager().clearAssetsCache(t);return this};UIElement.prototype.loadAssets=function(t,e,i){ResLoader.reset();this.getWindowManager().loadAssets(t,e,i);return this};UIElement.prototype.createElement=function(t){return ShapeFactoryGet().createShape(t,C_CREATE_FOR_PROGRAM)};ShapeFactoryGet().addShapeCreator(new UIElementCreator("ui-element"));UIElement.audioAssets=["soundURL"];UIElement.imagesAssets=["textureURL"];UIElement.jsonAssets=["textureJsonURL","skeletonJsonURL","soundURL","dataURL"];UIElement.assets=UIElement.audioAssets.concat(UIElement.jsonAssets,UIElement.imagesAssets);Object.defineProperty(UIElement.prototype,"win",{get:function(){if(!this._win){this._win=this.getWindow()}return this._win},set:function(t){console.log("Warning: can not set window.")},enumerable:false,configurable:true});function UIGroup(){return}UIGroup.prototype=new UIElement;UIGroup.prototype.isUIGroup=true;UIGroup.prototype.initUIGroup=function(t,e,i,n){this.initUIElement(t);this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);this.style.lineColor="rgba(0,0,0,0)";this.style.fillColor="rgba(0,0,0,0)";this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UIGroup.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIListItem){return false}return true};UIGroup.prototype.onPointerUpEditing=function(t,e){return};UIGroup.prototype.fixChildPosition=function(t){};UIGroup.prototype.fixChildSize=function(t){};UIGroup.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();drawRoundRect(t,this.w,this.h,this.roundRadius);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke()}}return};UIGroup.prototype.onPositionChanged=function(){var t=this.children;var e=t.length;for(var i=0;i<e;i++){var n=t[i];if(n.isUIBody||n.isUIGroup||n.isUIEdge){n.onPositionChanged()}}return};function UIGroupCreator(t,e,i){var n=["ui-group","ui-group",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIGroup;return r.initUIGroup(this.type,t,e,i)};return}UIGroup.create=function(){var t=new UIGroup;t.initUIGroup("ui-group",200,200,null);t.state=Shape.STAT_NORMAL;return t};function UIWindow(){return}UIWindow.serialNo=0;UIWindow.prototype=new UIElement;UIWindow.prototype.isUIWindow=true;UIWindow.prototype.saveProps=["openAnimationDuration","closeAnimationDuration","animHint","windowType","closeWhenPointerUpOutside","refLinesV","refLinesH","windowNameToBeOpen","preloadWindows","isUILoadingWindowV2","isUILoadingWindow","sceneId"];UIWindow.prototype.fromJson=function(t){this.jsonData=t;this.name=t.name;if(t.isUILoadingWindow){RShape.prototype.fromJson.call(this,t)}else{Object.keys(t.events).forEach(function(e){this.events[e]=t.events[e]},this)}return this};UIWindow.prototype.fromJsonNow=function(t){RShape.prototype.fromJson.call(this,t);this.relayout();return this};UIWindow.prototype.onGesture=function(t){if(!this.isInDesignMode()){this.callOnGestureHandler(t)}return};UIWindow.prototype.onMultiTouch=function(t,e,i){this.callOnMultiTouchHandler(t,e,i)};UIWindow.prototype.isMainWindow=function(){var t=this.getWindowManager();var e=t.history[0];var i=t.children[e];return i===this};UIWindow.prototype.getTimeScale=function(){return this.timeScale};UIWindow.prototype.setTimeScale=function(t){this.timeScale=t;return this};UIWindow.prototype.initUIWindow=function(t,e,i,n,r,a){this.initUIElement(t);this.timeScale=1;this.setLeftTop(e,i);this.settings={};this.setDefSize(n,r);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,a);this.setName("window-"+UIWindow.serialNo++);if(!a){this.style.setFillColor("White")}this.addEventNames(["onSystemInit","onLoad","onOpen","onBeforeOpen","onClose","onSwitchToBack","onSwitchToFront","onGesture","onKeyDown","onKeyUp"]);this.setAnimHint("htranslate");this.oldHitTest=this.hitTest;this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.intervals=[];this.timeouts=[];return this};UIWindow.prototype.setAnimHint=function(t){this.animHint=t;return true};UIWindow.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow){return false}return true};UIWindow.prototype.onModeChanged=function(){if(this.isInDesignMode()){this.popupWindow=null}return};UIWindow.prototype.removePopupWindow=function(t){if(this.popupWindow){if(this.popupWindow===t){this.popupWindow=t.popupWindow;if(this.popupWindow){this.popupWindow.parentWindow=this}t.parentWindow=null;t.popupWindow=null;return true}return this.popupWindow.removePopupWindow(t)}return false};UIWindow.prototype.setPopupWindow=function(t){if(this===t){return false}if(this.popupWindow){return this.popupWindow.setPopupWindow(t)}else{this.popupWindow=t;if(t){t.parentWindow=this}}return true};UIWindow.prototype.getPopupWindow=function(){if(this.popupWindow){return this.popupWindow.getPopupWindow()}return this.isUIPopupWindow?this:null};UIWindow.prototype.isGrabElement=function(t){return this.grabElement===t};UIWindow.prototype.grab=function(t){this.grabElement=t;return};UIWindow.prototype.ungrab=function(t){this.grabElement=null;return};UIWindow.prototype.dispatchPointerDownToChildren=function(t){if(this.grabElement){this.grabElement.onPointerDown(t);this.setTarget(this.grabElement);return true}return this.defaultDispatchPointerDownToChildren(t)};UIWindow.prototype.onPointerDownNormal=function(t){this.pointerDownPosition.x=t.x;this.pointerDownPosition.y=t.y;if(this.popupWindow){this.popupWindow.onPointerDownNormal(t);this.setTarget(this.popupWindow);this.pointerDown=false;if(!this.popupWindow||!this.popupWindow.shouldPropagatePointerEvent()){return true}}return UIElement.prototype.onPointerDownNormal.call(this,t)};UIWindow.prototype.onDoubleClick=function(t){if(this.popupWindow){this.popupWindow.onDoubleClick(t);if(!this.popupWindow||!this.popupWindow.shouldPropagatePointerEvent()){return true}}return UIElement.prototype.onDoubleClick.call(this,t)};UIWindow.prototype.onPointerMoveNormal=function(t){if(this.popupWindow){this.popupWindow.onPointerMoveNormal(t);if(!this.popupWindow||!this.popupWindow.shouldPropagatePointerEvent()){return true}}return UIElement.prototype.onPointerMoveNormal.call(this,t)};UIWindow.prototype.onPointerUpNormal=function(t){if(this.popupWindow){this.popupWindow.onPointerUpNormal(t);if(!this.popupWindow||!this.popupWindow.shouldPropagatePointerEvent()){return true}}if(!this.pointerDown){return true}if(!this.isInDesignMode()&&this.enable){var e=this.lastPosition.x-this.pointerDownPosition.x;var i=this.lastPosition.y-this.pointerDownPosition.y;var n=Math.abs(e);var r=Math.abs(i);var a=this.lastPosition;var o=this.pointerDownPosition;if(n>20||r>20){if(n>>1>r){if(e<0){this.callOnSwipeLeftHandler(o,a)}else{this.callOnSwipeRightHandler(o,a)}}if(r>>1>n){if(i<0){this.callOnSwipeUpHandler(o,a)}else{this.callOnSwipeDownHandler(o,a)}}}}return UIElement.prototype.onPointerUpNormal.call(this,t)};UIWindow.prototype.paintSelfOnly=function(t){var e=this.opacity;if(e!==1){t.globalAlpha*=e}this.clearBackground(t);this.drawBgImage(t);return};UIWindow.prototype.beforePaintChildren=function(t){t.globalAlpha=1};UIWindow.prototype.paintSelf=function(t){var e=t.timeStep;t.timeStep=this.scaleTime(e);if(this.isInDesignMode()){UIElement.prototype.paintSelf.call(this,t)}else{t.save();this.translate(t);this.updateTransform(t);this.paintSelfOnly(t);this.beforePaintChildren(t);this.paintChildren(t);this.afterPaintChildren(t);t.restore()}if(this.popupWindow&&!this.popupWindow.closePending){t.timeStep=this.popupWindow.scaleTime(e);this.popupWindow.paintSelf(t)}t.timeStep=e;return};UIWindow.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIWindow.prototype.hide=function(){this.setVisible(false);this.hideHTML();cantkHideAllInput();return};UIWindow.prototype.setCloseWhenPointerUpOutside=function(t){if(t){this.hitTest=function(t){var e=this.oldHitTest(t);if(!e){if(!this.isInDesignMode()){e=Shape.HIT_TEST_MM}}return e}}else{this.hitTest=this.oldHitTest}this.closeWhenPointerUpOutside=t;return};UIWindow.prototype.isAnimationEnabled=function(){return this.animHint&&this.animHint!=="none"};UIWindow.prototype.getAnimationDuration=function(t){return t?this.openAnimationDuration:this.closeAnimationDuration};UIWindow.prototype.getAnimationName=function(t){var e="";switch(this.animHint){case"fade":{e=t?"anim-fade-in":"anim-fade-out";break}case"scale":{if(this.isUIDialog){e=t?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{e=t?"anim-scale-show-win":"anim-scale-hide-win"}break}case"popup":{e=t?"anim-move-up":"anim-move-down";break}case"htranslate":{e=t?"anim-forward":"anim-backward";break}case"vtranslate":{e=t?"anim-upward":"anim-downward";break}default:{if(this.isUIDialog){e=t?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{if(isAndroid()||isFirefoxMobile()){e=t?"anim-scale-show-win":"anim-scale-hide-win"}else{e=t?"anim-forward":"anim-backward"}}break}}return e};UIWindow.prototype.isSplashWindow=function(){return this.isUINormalWindow&&this.windowType==="splash"};UIWindow.prototype.getSupportedAnimations=function(){var t=["none","default","scale","fade","popup"];if(!this.isUIDialog){t=t.concat(["htranslate","vtranslate"])}return t};UIWindow.prototype.clearBackground=function(t){var e=this.images.display;var i=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(i){switch(e){case UIElement.IMAGE_DISPLAY_TILE:case UIElement.IMAGE_DISPLAY_TILE_V:case UIElement.IMAGE_DISPLAY_TILE_H:case UIElement.IMAGE_DISPLAY_SCALE:case UIElement.IMAGE_DISPLAY_9PATCH:case UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO:return;default:break}if(i.width>=this.w&&i.height>=this.h){return}}if(!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};UIWindow.prototype.defaultChildrenFromJson=UIElement.prototype.childrenFromJson;UIWindow.prototype.loadChildren=function(){if(this.childrenJson){this.defaultChildrenFromJson(this.childrenJson);delete this.childrenJson;delete this.pendingLoadChildren;console.log("Now To Load Children Of "+this.name);if(this.scaleInfo){this.scaleForDensity(this.scaleInfo.sizeScale,this.scaleInfo.lcdDensity,true)}var t=this.getWindowManager();var e=t.oldConfig;var i=t.deviceConfig;if(e&&i){this.notifyDeviceConfigChanged(e,i)}}return};UIWindow.prototype.childrenFromJson=function(t){if(t.lazyLoad&&!dappIsEditorApp()){this.childrenJson=t;this.pendingLoadChildren=true;console.log("Delay To Load Children Of "+this.name)}else{delete this.pendingLoadChildren;this.defaultChildrenFromJson(t)}return};UIWindow.prototype.initStageOne=function(){this.callOnInitHandler();this.clearAllTimeouts();this.clearAllIntervals();this.enablePhysics=false;var t=this;this.forEach(function(e){if(e.offset){e.offset=0}e.visible=e.runtimeVisible;if(e.animatingInfo){e.animatingInfo=null;e.animating=false}if(e.animations&&e.animations[e.defaultAnimationName]){console.log(e.name+" has default animation, set it invisible initially.");e.visible=false}if(e.isUIBody||e.isUIEdge){t.enablePhysics=true}});return};UIWindow.prototype.onInit=function(){this.initStageOne();return};UIWindow.prototype.prepareForOpen=function(){if((!this.isUILoadingWindow||this.children.length<1)&&this.jsonData){this.fromJsonNow(this.jsonData)}this.setMode(Shape.MODE_RUNNING,true);this.relayout();return this};UIWindow.prototype.callOnBeforeOpen=function(t){this._open=true;var e=this.getParent();if(e&&e.hasEventListener("windowopen")){var i=e.createEvent("windowopen");i.win=this;e.dispatchEvent(i)}this.show();this.init();return this.callOnBeforeOpenHandler(t)};UIWindow.prototype.callOnOpen=function(t){delete this.openPending;this.getParent().pointerEventTarget=this;if(this.onOpen){try{this.onOpen(t)}catch(e){console.log("onOpen"+e.message)}}this.callOnOpenHandler(t);if(this.isSplashWindow()){var i=this;var n=i.duration?i.duration:3e3;if(window.splashWinTimeID){clearTimeout(window.splashWinTimeID);delete window.splashWinTimeID}window.splashWinTimeID=setTimeout(function(){if(i.visible){i.openWindow(null,null,true)}},n)}this.forEach(function(t){t.onWindowOpen()});return true};UIWindow.prototype.callOnClose=function(t){this._open=false;delete this.closePending;var e=this.getParent();if(e&&e.hasEventListener("windowclose")){var i=e.createEvent("windowclose");i.win=this;e.dispatchEvent(i)}if(this.onClose){try{this.onClose(t)}catch(n){console.log("onClose: "+n.message)}}this.callOnCloseHandler(t);this.deinit();this.hide();if(this.destroyWhenClose){this.getWindowManager().removeChild(this,true)}this.resetEvents();this.clearAllTimeouts();this.clearAllIntervals();var r=this.children;for(var a=0;a<r.length;a++){var o=r[a];o.detachNameFromParent()}this.children=[];if(this.parentWindow){this.parentWindow.popupWindow=this.popupWindow}if(this.popupWindow){this.popupWindow.parentWindow=this.parentWindow}this.popupWindow=null;this.parentWindow=null;setTimeout(function(){r.clear(true)},100);return true};UIWindow.prototype.callOnSwitchToBack=function(t){this.callOnSwitchToBackHandler();if(!t){this.hide()}return true};UIWindow.prototype.callOnSwitchToFront=function(t){if(this.isUINormalWindow&&(this.w!=this.parentShape.w||this.h!=this.parentShape.h)){this.relayout();console.log("WindowManager Size Changed, Relayout Current Window.")}this.show();this.callOnSwitchToFrontHandler();return true};UIWindow.prototype.isOpen=function(){return!!this._open};UIWindow.prototype.setTimeout=function(t,e){if(this.isInDesignMode()){console.log("Can not UIWindow.prototype.setTimeout in edit mode.");return}if(typeof t!=="function"){console.log("invalid func for UIWindow.prototype.setTimeout");return}function i(){this.timeouts.remove(n);t()}var n=window.setTimeout(i.bind(this),e);this.timeouts.push(n);return n};UIWindow.prototype.clearTimeout=function(t){window.clearTimeout(t);this.timeouts.remove(t)};UIWindow.prototype.setInterval=function(t,e){if(this.isInDesignMode()){console.log("Can not UIWindow.prototype.setInterval in edit mode.");return}if(typeof t!=="function"){console.log("invalid func for UIWindow.prototype.setInterval");return}function i(){t()}var n=window.setInterval(i.bind(this),e);this.intervals.push(n);return n};UIWindow.prototype.clearInterval=function(t){window.clearInterval(t);this.intervals.remove(t)};UIWindow.prototype.clearAllIntervals=function(){var t=this.intervals;for(var e=0;e<t.length;e++){var i=t[e];window.clearInterval(i)}this.intervals.length=0};UIWindow.prototype.clearAllTimeouts=function(){var t=this.timeouts;for(var e=0;e<t.length;e++){var i=t[e];window.clearTimeout(i)}this.timeouts.length=0};UIWindow.prototype.loadInitAssets=function(t,e,i){var n=this;function r(a){if(a.percent>99.9){n.doLoadInitAssets(t,e,i);ResLoader.off(ResLoader.EVENT_ASSETS_LOAD_PROGRESS,r)}}if(ResLoader.isLoadCompleted()){n.doLoadInitAssets(t,e,i)}else{ResLoader.on(ResLoader.EVENT_ASSETS_LOAD_PROGRESS,r)}};UIWindow.prototype.doLoadInitAssets=function(t,e,i){var n=this;var r=n.getParent();if(!t){t=n.findChildByType("ui-progressbar")}if(!i){i=n.findChildByType("ui-label")}if(!e){e=n.preloadWindows}function a(e,a,o){if(i){i.setText("Loading...")}if(t){t.setPercent(e,true)}var s=r.getInitWindow();if(a>=o&&s!=n){r.showInitWindow(n.windowNameToBeOpen)}n.postRedraw()}function o(e,n,a){if(i){if(e>=100){i.setText("Loading...")}else{i.setText("Downloading...")}}if(t){if(e>=100){if(AssetsDownloader.isAvailable()){r.loadAudios();r.loadFonts()}t.setPercent(0,true)}else{t.setPercent(e,true)}}}var s=e?e.split(","):r.getWindowNames(this);if(AssetsDownloader.isAvailable()){s.push("__audios__");s.push("__fonts__")}else{r.loadAudios();r.loadFonts()}r.loadAssets(s,a,o);this.loadInitAssets=function(){};return this};UIWindow.prototype.relayout=function(){if(!this.getWindowManager().isDeviceDirectionOK()){console.log("UIWindow.prototype.relayout Reject Relayout");return}UIElement.prototype.relayout.call(this);return this};ShapeFactoryGet().addShapeCreator(new UINormalWindowCreator(null));function UINormalWindow(){return}UINormalWindow.prototype=new UIWindow;UINormalWindow.prototype.isUINormalWindow=true;function UINormalWindowCreator(t){var e=["ui-window","ui-window",null,1];ShapeCreator.apply(this,e);this.createShape=function(e){var i=new UINormalWindow;i.initUIWindow(this.type,0,0,100,100,t);i.widthAttr=UIElement.WIDTH_FILL_PARENT;i.heightAttr=UIElement.HEIGHT_FILL_PARENT;i.addEventNames(["onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown"]);return i};return}function UIDialog(){return}UIDialog.prototype=new UIWindow;UIDialog.prototype.isUIDialog=true;UIDialog.prototype.isUIPopupWindow=true;UIDialog.prototype.fixChildSize=function(t){return};UIDialog.prototype.fixChildPosition=function(t){return};function UIDialogCreator(t,e,i){var n=["ui-dialog","ui-dialog",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIDialog;r.initUIWindow(this.type,0,0,t,e,i);r.setMargin(8,8);r.xAttr=UIElement.X_CENTER_IN_PARENT;r.yAttr=UIElement.Y_MIDDLE_IN_PARENT;r.images.display=UIElement.IMAGE_DISPLAY_SCALE;r.setAnimHint("scale");return r};return}ShapeFactoryGet().addShapeCreator(new UIDialogCreator(600,400,null));function UIEdit(){return}UIEdit.prototype=new UIElement;UIEdit.prototype.isUIEdit=true;UIEdit.prototype.saveProps=["leftMargin","rightMargin","inputType","inputTips","maxLength"];UIEdit.prototype.initUIEdit=function(t,e,i,n,r,a,o,s){this.initUIElement(t);this.setDefSize(e,i);this.setText(a);this.leftMargin=n;this.rightMargin=r;this.setSizeLimit(60,30,1e3,80);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,o);this.setImage(UIElement.IMAGE_FOCUSED,s);this.setMargin(5,5);this.setInputType("text");this.addEventNames(["onChanged","onChanging","onFocusIn","onFocusOut"]);this.setTextAlignV("middle");this.setTextAlignH("left");this.maxLength=1024;return this};UIEdit.prototype.shapeCanBeChild=function(t){if(t.isUIButton){return true}return false};UIEdit.prototype.textEditable=function(t){return true};UIEdit.prototype.getLocaleText=function(t){if(t===" "){return t}if(this.inputType==="password"&&t&&t===this.text){var e="";var i=t.length;for(var n=0;n<i;n++){e=e+"*"}return e}else{return t}};UIEdit.prototype.drawText=function(t){var e=this.h>>1;var i=this.leftMargin;
var n=this.getLocaleText(this.text);var r=this.w-i-this.rightMargin;var a=this.inputTips;if(!n&&!a||this.editing){return}t.save();t.font=this.style.getFont();if(n){t.fillStyle=this.style.textColor}else{n=a;t.fillStyle="#E0E0E0"}t.beginPath();t.rect(0,0,this.w-this.rightMargin,this.h);t.clip();t.textAlign="left";t.textBaseline="middle";t.fillText(n,i,e);t.restore();return};UIEdit.prototype.isFocused=function(){return this.editing};UIEdit.prototype.paintSelfOnly=function(t){var e=this.getBgImage();if(e){return}t.beginPath();drawRoundRect(t,this.w,this.h,8);t.fillStyle=this.style.fillColor;t.fill();t.strokeStyle=this.style.lineColor;t.lineWidth=this.isFocused()?4:2;t.stroke();return};UIEdit.prototype.onClick=function(t,e){if(e){return}if(!this.isInDesignMode()){this.editText()}return this.callOnClickHandler(t)};UIEdit.prototype.getWidth=function(t){var e=this.w;if(t){e=e-this.leftMargin-this.rightMargin}return e};UIEdit.prototype.getEditorRect=function(){var t=this.leftMargin||0;var e=this.getPositionInView();var i=CantkRT.getMainCanvasPosition();var n=this.view.getAbsPosition();var r=this.view.getViewScale();var a=UIElement.getMainCanvasScale();var o=(n.x+(e.x+t)*r)/a.x+i.x;var s=(n.y+e.y*r)/a.y+i.y;var l=this.getWidth(true)*r/a.x;var h=this.getHeight()*r/a.y;var u={x:o,y:s,w:l,h:h};if(this.isInDesignMode()){var c=window.devicePixelRatio||1;u.x*=c;u.y*=c;u.w*=c;u.h*=c}return u};UIEdit.prototype.editText=function(t){var e=this;if(this.textEditable(t)){var i=this;var n=this.getText();var r=this.getEditorRect();var a=this.getRealScale()/UIElement.getMainCanvasScale().y;var o=this.inputType?this.inputType:"text";var s=this.style.fontSize*a;var l=cantkShowInput(o,s,n,r.x,r.y,r.w,r.h);i.editing=true;l.setTextColor(this.style.textColor);l.showBorder(this.isInDesignMode());l.show();function h(t){if(t!==i.text){i.setText(t,true);i.postRedraw()}else{i.text=t}l.setOnChangedHandler(null);l.setOnChangeHandler(null);l.hide();delete i.editing;i.callOnFocusOutHandler();return}function u(t){i.callOnChangingHandler(t)}l.setMaxLength(e.maxLength||1024);l.setOnChangedHandler(h);l.setOnChangeHandler(u);this.callOnFocusInHandler()}return};UIEdit.prototype.drawTextTips=function(t){};function UIEditCreator(t,e,i,n,r,a){var o=["ui-edit","ui-edit",null,1];ShapeCreator.apply(this,o);this.createShape=function(o){var s=new UIEdit;return s.initUIEdit(this.type,t,e,i,n,dappGetText("Edit"),r,a)};return}ShapeFactoryGet().addShapeCreator(new UIEditCreator(120,50,12,12,null,null));function UIGauge(){return}UIGauge.prototype=new UIElement;UIGauge.prototype.isUIGauge=true;UIGauge.IMAGE_POINTER="pointer-image";UIGauge.prototype.initUIGauge=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onInit"]);return this};UIGauge.prototype.shapeCanBeChild=function(t){return t.isUILedDigits||t.isUILabel||t.isUIGaugePointer};UIGauge.prototype.afterChildAppended=function(t){var e=20;var i=0;if(t.isUIGaugePointer){t.xAttr=UIElement.X_CENTER_IN_PARENT;t.yAttr=UIElement.Y_MIDDLE_IN_PARENT}for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.isUIGaugePointer){continue}switch(i){case 0:{e=100;break}case 1:{e=70;break}case 2:{e=40;break}}i=i+1;r.setSizeLimit(e,e,e,e,1);r.setSize(e,e)}this.setSizeLimit(100,100,1e3,1e3,1);return};UIGauge.prototype.paintSelfOnly=function(t){return};function UIGaugeCreator(){var t=["ui-gauge","ui-gauge",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGauge;return e.initUIGauge(this.type,200,200)};return}function UIGaugePointer(){return}UIGaugePointer.prototype=new UIElement;UIGaugePointer.prototype.isUIGaugePointer=true;UIGaugePointer.prototype.saveProps=["minAngle","maxAngle","minValue","maxValue"];UIGaugePointer.prototype.initUIGaugePointer=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIGauge.IMAGE_POINTER,null);this.value=0;this.minAngle=0;this.maxAngle=360;this.minValue=0;this.maxValue=60;return this};UIGaugePointer.prototype.shapeCanBeChild=function(t){return false};UIGaugePointer.prototype.setText=function(t){t=this.toText(t?t:0);try{this.setValue(parseInt(t))}catch(e){console.log("UIGaugePointer.prototype.setText:"+e.message)}return this};UIGaugePointer.prototype.getText=function(){return this.getValue()+""};UIGaugePointer.prototype.setValue=function(t){if(t>=this.minValue&&t<=this.maxValue){this.value=t}else{console.log("UIGaugePointer.prototype.setValue: Out Of Range.")}return this};UIGaugePointer.prototype.getValue=function(){return this.value};UIGaugePointer.prototype.animSetValue=function(t,e){return this.animSetValue(t,e)};UIGaugePointer.prototype.animateSetValue=function(t,e){if(t<this.minValue){t=this.minValue}if(t>this.maxValue){t=this.maxValue}var i=this;var n=t;var r=this.getValue();var a=t-r;var o=Math.abs(a*(this.maxAngle-this.minAngle)/(this.maxValue-this.minValue));if(o<5){this.setValue(t);return}var s=(new Date).getTime();var l=e&&e=="slow"?1e3:500;function h(){var t=new Date;var e=(t.getTime()-s)/l;if(e<1){var o=r+a*e;i.setValue(o);setTimeout(h,10)}else{delete s;i.setValue(n)}delete t;i.postRedraw()}h();return};UIGaugePointer.prototype.getAngle=function(t){var e=this.maxAngle-this.minAngle;var i=this.maxValue-this.minValue;var n=this.value/i*e+this.minAngle;n=Math.PI*(n/180);return n};UIGaugePointer.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=this.w;var r=this.h;var a=this.getAngle();var o=this.getHtmlImageByType(UIGauge.IMAGE_POINTER);if(o&&o.width){var s=o.width;var l=o.height;t.translate(n/2,r/2);t.rotate(a);t.translate(-n/2,-r/2);e=(n-s)/2;i=(r-l)/2;t.drawImage(o,e,i)}else{t.fillRect(0,0,this.w,this.h)}return};function UIGaugePointerCreator(){var t=["ui-gauge-pointer","ui-gauge-pointer",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGaugePointer;return e.initUIGaugePointer(this.type,20,200)};return}ShapeFactoryGet().addShapeCreator(new UIGaugePointerCreator);ShapeFactoryGet().addShapeCreator(new UIGaugeCreator);function UIHtml(){return}UIHtml.prototype=new UIElement;UIHtml.prototype.isUIHtml=true;UIHtml.prototype.saveProps=["htmlContent"];UIHtml.prototype.initUIHtml=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);return this};UIHtml.prototype.shapeCanBeChild=function(t){return false};UIHtml.prototype.drawBgImage=function(t){if(this.isInDesignMode()||this.isIcon){var e=this.getBgImage();if(e){var i=e.getImage();var n=e.getImageRect();this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,n)}else{t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}}return};UIHtml.prototype.scaleElement=function(t,e,i,n,r){var a=n&&r?n+" "+r:"50% 50%";var o=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var s=0;s<o.length;s++){var l=o[s];t.style[l+"-origin"]=a;t.style[l]="scale("+e+","+i+")"}return};UIHtml.prototype.rotateElement=function(t,e){var i="50% 50%";var n=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];t.style["transform-style"]="preserve-3d";for(var r=0;r<n.length;r++){var a=n[r];t.style[a+"-origin"]=i;t.style[a]="rotate("+e+"deg)"}return};UIHtml.prototype.setRotation=function(t){this.rotation=t;if(this.element){this.rotateElement(this.element,t*180/Math.PI)}return this};UIHtml.prototype.setOpacity=function(t){this.opacity=t;if(this.element){this.element.style["opacity"]=t}return this};UIHtml.prototype.setScale=function(t,e){this.scaleX=t;this.scaleY=e;if(this.element){this.scaleElement(this.element,t,e)}return this};UIHtml.prototype.setScaleX=function(t){this.setScale(t,this.scaleY);return this};UIHtml.prototype.setScaleY=function(t){this.setScale(this.scaleX,t);return this};UIHtml.prototype.setVisible=function(t){if(this.element){this.element.style.display=t?"block":"none"}return this};UIHtml.prototype.setPosition=function(t,e){if(this.element){this.element.style.left=t+"px";this.element.style.top=e+"px"}return this};UIHtml.prototype.showHTMLElement=function(){var t=this.element;if(t){var e=this.getPositionInView();var i=CantkRT.getMainCanvasPosition();var n=this.view.getAbsPosition();var r=this.view.getViewScale();var a=UIElement.getMainCanvasScale();var o=(n.x+e.x*r)/a.x+i.x;var s=(n.y+e.y*r)/a.y+i.y;var l=this.getWidth()*r/a.x;var h=this.getHeight()*r/a.y;t.style.position="absolute";t.style.left=o+"px";t.style.top=s+"px";t.style.width=l+"px";t.style.height=h+"px";t.style.visibility="visible";this.htmlVisible=true}return};UIHtml.prototype.createHTMLElement=function(t){var e=null;if(!this.element){e=document.createElement(t);e.id=this.type+this.name;document.body.appendChild(e);this.element=e}return this.element};UIHtml.prototype.beforeShowHTML=function(){};UIHtml.prototype.setScrollable=function(t){this.scrollable=t;return};UIHtml.prototype.onSetElementStyle=function(){var t=Math.floor(this.scaleForCurrentDensity(14));this.element.style.fontSize=t+"px";this.element.style.marginLeft="0px";this.element.style.marginTop="0px";this.element.style.marginBottom="0px";this.element.style.marginRight="0px";return};UIHtml.prototype.onShowHTML=function(){this.reload()};UIHtml.prototype.reload=function(){if(!this.isInDesignMode()){this.createHTMLElement("div");this.element.innerHTML=this.getHtmlContent();this.element.style.overflow=this.scrollable?"scroll":"hidden";this.element.style.zIndex=5;this.element.style["-ms-touch-action"]="auto";this.onSetElementStyle();this.beforeShowHTML();this.showHTMLElement()}return};UIHtml.prototype.beforeHideHTML=function(){};UIHtml.prototype.onHideHTML=function(){this.htmlVisible=false;if(this.element){this.beforeHideHTML();this.element.style.visibility="hidden"}return};UIHtml.prototype.getValue=function(){return this.value};UIHtml.prototype.setValue=function(t){this.value=t;return this};UIHtml.prototype.setHtmlContent=function(t){this.htmlContent=t;if(this.element){this.element.innerHTML=t}return this};UIHtml.prototype.getHtmlContent=function(){return this.htmlContent};Object.defineProperty(UIElement.prototype,"innerHTML",{get:function(){return this.getHtmlContent()},set:function(t){this.setHtmlContent(t);this.reload()},enumerable:false,configurable:true});function UIHtmlCreator(t,e){var i=["ui-html","ui-html",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIHtml;return n.initUIHtml(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlCreator);function UIVideo(){return}UIVideo.prototype=new UIHtml;UIVideo.prototype.isUIVideo=true;UIVideo.prototype.getHtmlContent=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.value?this.value:"";var n=this.loop?'loop="loop" ':"";var r=this.autoPlay?'autoplay="true" ':"";var a=this.showControls?'controls="controls" ':"";var o='<video width="'+t+'" height="'+e+'" preload="true" '+a+n+r+'src="'+i+'"></video>';return o};UIVideo.prototype.beforeHideHTML=function(){video=this.getVideoElement();if(video.src&&!video.puased){video.pause()}return};UIVideo.prototype.getVideoElement=function(){if(this.element){var t=this.element.getElementsByTagName("video");return t.length?t[0]:null}return null};UIVideo.prototype.setShowControls=function(t){this.showControls=t;return};UIVideo.prototype.isShowControls=function(){return this.showControls};UIVideo.prototype.setLoop=function(t){this.loop=t;return};UIVideo.prototype.isLoop=function(){return this.loop};UIVideo.prototype.setAutoPlay=function(t){this.autoPlay=t;return};UIVideo.prototype.isAutoPlay=function(){return this.autoPlay};UIVideo.prototype.initUIVideo=function(t){this.initUIHtml(t,400,300);this.setValue("http://www.w3school.com.cn/i/movie.ogg");this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIVideoCreator(){var t=["ui-video","ui-video",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVideo;return e.initUIVideo(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIVideoCreator);function UIFlash(){return}UIFlash.prototype=new UIHtml;UIFlash.prototype.isUIFlash=true;UIFlash.prototype.getHtmlContent=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.value?this.value:"";var n='<object type="application/x-shockwave-flash" width="'+t+'" height="'+e+'"> <param name="movie" value="'+i+'" /> <param name="quality" value="high" /></object>';return n};UIFlash.prototype.initUIFlash=function(t){this.initUIHtml(t,400,300);this.setValue("test/5.swf");this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIFlashCreator(){var t=["ui-flash","ui-flash",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFlash;return e.initUIFlash(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIFlashCreator);function UIHtmlImage(){return}UIHtmlImage.prototype=new UIHtml;UIHtmlImage.prototype.isUIHtmlImage=true;UIHtmlImage.prototype.getHtmlContent=function(){var t=this.getRealScale();var e=Math.round(t*this.w);var i=Math.round(t*this.h);var n=this.getImageSrcByType(UIElement.IMAGE_DEFAULT);var r='<img src="'+n+'" width='+e+" height="+i+">";return r};UIHtmlImage.prototype.initUIHtmlImage=function(t){this.initUIHtml(t,400,300);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};function UIHtmlImageCreator(){var t=["ui-html-image","ui-html-image",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIHtmlImage;return e.initUIHtmlImage(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlImageCreator);function UIImageView(){return}UIImageView.prototype=new UIElement;UIImageView.prototype.isUIImageView=true;UIImageView.cachedImages={};UIImageView.IMAGE_STATE_PENDING=0;UIImageView.IMAGE_STATE_ERROR=1;UIImageView.IMAGE_STATE_DONE=2;imageViewInitCustomProp=function(t){};imageThumbViewInitCustomProp=function(t){};imageAnimationInitCustomProp=function(t){};imageSlideViewInitCustomProp=function(t){};UIImageView.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.userImages=this.getImages();return t};UIImageView.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.cacheInvalid=true;if(t.userImages){this.userImages=[];var e=t.userImages.split("\n");var i=e.length;for(var n=0;n<i;n++){var r="image_"+(n+1);var a=this.getImageSrcByType(r);if(a&&a.length>4){this.userImages.push(a)}}}return};UIImageView.prototype.initUIImageView=function(t,e){this.setDefSize(t,e);this.userImages=[];this.onSized=UIImageView.prototype.onSized;this.afterRelayout=UIImageView.prototype.afterRelayout;this.setImages=UIImageView.prototype.setImages;this.getImages=UIImageView.prototype.getImages;this.setValue=UIImageView.prototype.setValue;this.getValue=UIImageView.prototype.getValue;this.ensureImages=UIImageView.prototype.ensureImages;this.addUserImage=UIImageView.prototype.addUserImage;this.doToJson=UIImageView.prototype.doToJson;this.doFromJson=UIImageView.prototype.doFromJson;this.onScaleForDensityDone=UIImageView.prototype.onScaleForDensityDone;imageViewInitCustomProp(this);return this};UIImageView.createImage=function(t,e){var i=UIImageView.cachedImages[t];if(!i){i=new Image;i.src=t;i.onLoadDoneListeners=[];function n(t,e){if(!t||!t.onLoadDoneListeners){return}for(var i=0;i<t.onLoadDoneListeners.length;i++){var n=t.onLoadDoneListeners[i];n(t,e)}t.onLoadDoneListeners.clear();return}i.onload=function(t){n(this,true);this.loaded=true};i.onabort=function(t){n(this,false);this.failed=true;console.log("load "+this.src+" failed.")};i.onerror=function(t){n(this,false);this.failed=true;console.log("load "+this.src+" failed.")}}else{console.log("Create Image From Cache: "+t)}if(e){if(i.loaded){e(i,true)}else if(i.failed){e(i,false)}else{i.onLoadDoneListeners.push(e)}}return i};UIImageView.drawImageAtCenter=function(t,e,i,n,r,a,o,s){if(s){t.fillStyle=s;t.fillRect(i,n,r,a)}else{t.clearRect(i,n,r,a)}if(e&&e.width>0){var l=r;var h=a;var u=e.width;var c=e.height;var p=e.width;var f=e.height;if(o){var m=l/p;var d=h/f;if(m<d){u=Math.min(p,l/d)}else{c=Math.min(f,h/m)}}t.drawImage(e,0,0,u,c,i,n,l,h)}return};UIImageView.prototype.ensureImages=function(){if(!this.cacheInvalid){return}var t=this;function e(e,i){t.postRedraw();return}this.cachedImages=[];for(var i=0;i<this.userImages.length;i++){var n=this.userImages[i];var r=UIImageView.createImage(n,e);this.cachedImages.push(r)}delete this.cacheInvalid;return};UIImageView.prototype.afterRelayout=function(){this.cacheInvalid=true;return};UIImageView.prototype.onSized=function(){this.cacheInvalid=true;return};UIImageView.prototype.onScaleForDensityDone=function(){this.cacheInvalid=true;return};UIImageView.prototype.addUserImage=function(t){this.cacheInvalid=true;this.userImages.push(t);var e="image_"+this.userImages.length;this.setImage(e,t);return};UIImageView.prototype.getCurrentImage=function(){return this.curentImage};UIImageView.prototype.getValue=function(){var t=this.getCurrentImage();return t?t.src:null};UIImageView.prototype.setValue=function(t){return this};UIImageView.prototype.setImages=function(t){var e=this.images.display;var i=t.split("\n");this.userImages=[];this.images={};this.images.display=e;for(var n=0;n<i.length;n++){var r=i[n];if(r){this.addUserImage(r)}}return};UIImageView.prototype.getImages=function(){var t="";var e=location.protocol+"//"+location.host+"/";for(var i=0;i<this.userImages.length;i++){var n=this.userImages[i];n=n.replace(e,"");t=t+n+"\n"}return t};function UIScrollView(){return this}UIScrollView.prototype=new UIElement;UIScrollView.prototype.isUIScrollView=true;UIScrollView.prototype.afterChildAppended=function(t){t.setCanRectSelectable(false,true);return true};UIScrollView.prototype.initUIScrollView=function(t,e,i){this.initUIElement(t);this.offset=0;this.scrollBarOpacity=0;this.setMargin(e,e);this.setSizeLimit(100,100,2e3,2e3);this.setDefSize(300+2*e,300+2*e);this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator(2);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,i);this.setScrollable("always");if(!i){this.style.setFillColor("#f0f0f0")}this.setCanRectSelectable(false,true);return this};UIScrollView.prototype.setScrollable=function(t){this.scrollable=t;return};UIScrollView.prototype.fixChildSize=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.w=this.getWidth(true)}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.h=this.getHeight(true)}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false);t.setUserResizable(false)}return};UIScrollView.prototype.shapeCanBeChild=function(t){if(t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage||t.isUIList||t.isUIGrid||t.isUIProgressBar||t.isUICheckBox||t.isUIRadioBox||t.isUIWaitBar||t.isUIButtonGroup||t.isUITips||t.isUIGroup){return true}return false};UIScrollView.prototype.onModeChanged=function(){this.offset=0;return};UIScrollView.prototype.scrollToEnd=function(){var t=this.getScrollRange();this.offset=t-this.h;return this};UIScrollView.prototype.scrollTo=function(t){this.offset=Math.round(t);return};UIScrollView.prototype.scrollDelta=function(t){var e=this.offset+t;this.scrollTo(e);return};UIScrollView.prototype.scrollToPageDelta=function(t){var e=Math.floor(this.offset/this.w)+t;this.scrollToPage(e);return};UIScrollView.prototype.scrollToPage=function(t){if(t<0){t=0}var e=this.w*t;var i=this.offset-e;this.animScrollTo(i,300);return};UIScrollView.prototype.onPointerDownRunning=function(t,e){if(e){return}this.velocityTracker.clear();return};UIScrollView.prototype.onDrag=function(t){return};UIScrollView.prototype.isScrollable=function(){if(this.scrollable==="always"){return true}else if(this.scrollable==="never"){return false}else{var t=this.getScrollRange();var e=this.getPageSize();return t>e}};UIScrollView.prototype.onPointerMoveRunning=function(t,e){if(e||!this.isScrollable()){return}this.scrollBarOpacity=0;var i=this.getScrollDelta(t);if(this.pointerDown&&this.needScroll(t)){this.scrollBarOpacity=1;this.scrollDelta(-i)}this.addMovementForVelocityTracker();this.onDrag(this.offset);return};UIScrollView.prototype.animScrollTo=function(t,e){var i=this;var n=new Date;var r=n.getTime();var a=this.offset;var o=a-t;var s=this.getScrollRange();var l=this.getPageSize();e=e<400?400:e;if(o<0){e=600;t=a}if(!this.isInDesignMode()){if(o>s-l){t=a-(s-l)}}if(s<=l){o=0;t=a}function h(){var n=new Date;var o=n.getTime();var s=(o-r)/e;var l=i.interpolator.get(s);var u=a-t*Math.min(l,1);if(s<1&&!i.pointerDown){setTimeout(h,5);i.scrollTo(u);i.scrollBarOpacity=1-l}else{var u=a-t;i.scrollBarOpacity=0;i.scrollTo(u)}i.postRedraw();return}setTimeout(h,5);return};UIScrollView.prototype.whenScrollOutOfRange=function(t){return};UIScrollView.prototype.onPointerUpRunning=function(t,e){if(e||!this.isScrollable()){return}var i=this.getScrolledSize();if(!this.needScroll(t)){this.scrollBarOpacity=0;return}var n=0;var r=0;var a=this.getVelocity();var o=this.getPageSize();var s=a/o;var l=.5*o*s*s;r=Math.abs(l);n=2*r/a;r=i<0?-r:r;n=Math.abs(n);if(n>3){n=3}var h=this.offset;var u=h-r;var c=this.offset;var p=c+this.h;var f=this.getScrollRange();if(c<0){this.whenScrollOutOfRange(c)}else if(p>f){this.whenScrollOutOfRange(p-f)}this.animScrollTo(r,n*1e3);return true};UIScrollView.prototype.paintSelfOnly=function(t){return};function UIHScrollView(){return}UIHScrollView.prototype=new UIScrollView;UIHScrollView.prototype.isUIHScrollView=true;UIHScrollView.prototype.initUIHScrollView=function(t,e,i){this.initUIScrollView(t,e,i);this.setSizeLimit(100,40,2e3,2e3);return this};UIHScrollView.prototype.needScroll=function(t){var e=Math.abs(this.getMoveAbsDeltaX());var i=Math.abs(this.getMoveAbsDeltaY());return e>20&&e>i||e>20&&!this.isInDesignMode()};UIHScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaX())};UIHScrollView.prototype.getScrollDelta=function(t){return Math.floor(this.getMoveDeltaX())};UIHScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIHScrollView.prototype.getPageSize=function(){return this.w};UIHScrollView.prototype.onPointerUpRunning=function(t,e){if(e){return}if(this.isEventHandledByChild()){return}this.setEventHandled();var i=0;var n=this.getVelocity();var r=this.getScrolledSize();var a=Math.abs(r);if(a>this.w/4||n>this.w){if(r<0){i=1}else{i=-1}}this.scrollToPageDelta(i);return true};UIHScrollView.prototype.translatePoint=function(t){var e={x:t.x-this.left+this.offset,y:t.y-this.top};return e};UIHScrollView.prototype.getScrollRange=function(){var t=0;var e=this.calcChildrenRange();t=e.r-e.l;if(t<this.w){t=this.w}t=Math.ceil(t/this.w)*this.w;return t};UIHScrollView.prototype.fixChildPosition=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=this.offset+this.hMargin;t.widthAttr=UIElement.WIDTH_SCALE}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=this.vMargin}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false)}return};UIHScrollView.prototype.paintChildren=function(t){var e=null;var i=this.offset;var n=this.offset+this.w;t.save();t.beginPath();t.rect(0,0,this.w,this.h);t.closePath();t.clip();t.beginPath();t.translate(-this.offset,0);for(var r=0;r<this.children.length;r++){e=this.children[r];if(!e.visible){continue}if(e.left+e.w<i||e.left>n){continue}this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}this.paintTargetShape(t);t.restore();return};function UIHScrollViewCreator(t,e){var i=["ui-h-scroll-view","ui-h-scroll-view",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIHScrollView;return n.initUIHScrollView(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIHScrollViewCreator(0,null));function UIVScrollView(){return}UIVScrollView.prototype=new UIScrollView;UIVScrollView.prototype.isUIVScrollView=true;UIVScrollView.prototype.initUIVScrollView=function(t,e,i,n){this.initUIScrollView(t,e,i);this.setSizeLimit(40,100,2e3,2e3);this.setImage("scrollBarImg",n);this.rectSelectable=false;return this};UIVScrollView.prototype.needScroll=function(t){var e=Math.abs(this.getMoveAbsDeltaX());var i=Math.abs(this.getMoveAbsDeltaY());return i>50&&i>e||i>50&&!this.isInDesignMode()};UIVScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaY())};UIVScrollView.prototype.getScrollDelta=function(t){return Math.floor(this.getMoveDeltaY())};UIVScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().y};UIVScrollView.prototype.getPageSize=function(){return this.h};UIVScrollView.prototype.translatePoint=function(t){var e={x:t.x-this.left,y:t.y-this.top+this.offset};return e};UIVScrollView.prototype.getScrollRange=function(){var t=0;var e=this.calcChildrenRange();t=e.b;if(t<this.h){t=this.h}var i=this.isInDesignMode()?this.h:10;t=Math.ceil(t/i)*i;return t};UIVScrollView.prototype.fixChildPosition=function(t){if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=this.hMargin}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=this.offset+this.vMargin;t.heightAttr=UIElement.HEIGHT_SCALE}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT&&t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.setUserMovable(false)}return};UIVScrollView.prototype.paintChildren=function(t){var e=null;var i=this.offset;var n=this.offset+this.h;t.save();t.beginPath();t.rect(this.getHMargin(),this.getVMargin(),this.getWidth(true),this.getHeight(true));t.closePath();t.clip();t.beginPath();t.translate(0,-this.offset);for(var r=0;r<this.children.length;r++){e=this.children[r];if(!e.visible){continue}if(e.top+e.h<i||e.top>n){continue}this.beforePaintChild(e,t);e.paintSelf(t);this.afterPaintChild(e,t)}this.paintTargetShape(t);t.restore();return};UIVScrollView.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);return};UIVScrollView.prototype.drawScrollBar=function(t){var e=this.getHtmlImageByType("scrollBarImg");if(!this.scrollBarOpacity||!e){return}var i=this.getScrollRange();var n=this.w-e.width-2;var r=e.width;var a=this.h*this.h/i;var o=this.offset/i*this.h;if(o+a>this.h){a=this.h-o;o=this.h-a}if(o<0){a=a+o;o=0}t.save();t.globalAlpha=this.scrollBarOpacity;drawNinePatchEx(t,e,0,0,e.width,e.height,n,o,r,a);t.restore();return};function UIVScrollViewCreator(t,e,i){var n=["ui-v-scroll-view","ui-v-scroll-view",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIVScrollView;return r.initUIVScrollView(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIVScrollViewCreator(0,null,null));function UIVScrollViewGeneral(){return}UIVScrollViewGeneral.prototype=new UIVScrollView;UIVScrollViewGeneral.prototype.isUIList=true;UIVScrollViewGeneral.prototype.isUILayout=true;UIVScrollViewGeneral.prototype.isUIVScrollViewGeneral=true;UIVScrollViewGeneral.prototype.sortChildren=UIList.prototype.sortChildren;UIVScrollViewGeneral.prototype.initUIVScrollViewGeneral=function(t){this.initUIVScrollView(t,0,null,null);this.setTextType(Shape.TEXT_NONE);return this};UIVScrollViewGeneral.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getVMargin();var i=this.children.length;var n=e;for(var r=0;r<i;r++){var a=this.children[r];if(!a.visible){continue}a.yAttr=UIElement.Y_FIX_TOP;a.heightAttr=UIElement.HEIGHT_FIX;a.relayout();a.top=n;n+=a.h}return};UIVScrollViewGeneral.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.isInDesignMode()){this.drawPageDownUp(t)}return};function UIVScrollViewGeneralCreator(){var t=["ui-g-scroll-view","ui-g-scroll-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVScrollViewGeneral;return e.initUIVScrollViewGeneral(this.type)};return}function UIScrollViewX(){return}UIScrollViewX.prototype=new UIElement;UIScrollViewX.prototype.isUIScrollViewX=true;UIScrollViewX.prototype.isUIScrollView=true;UIScrollViewX.prototype.saveProps=["virtualWidth","virtualHeight","showOutside","maxAnimationDuration","scrollBgImage"];UIScrollViewX.prototype.initUIScrollViewX=function(t){this.initUIElement(t);this.ox=0;this.oy=0;this.xDragLimit=.3;this.yDragLimit=.3;this.scrollBarOpacity=0;this.maxAnimationDuration=1e4;this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator(2);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_V_SCROLL_BAR_BG,null);this.setImage(UIElement.IMAGE_V_SCROLL_BAR_FG,null);this.setImage(UIElement.IMAGE_H_SCROLL_BAR_BG,null);this.setImage(UIElement.IMAGE_H_SCROLL_BAR_FG,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.addEventNames(["onScrolling","onScrollDone"]);return this};UIScrollViewX.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIScrollViewX.prototype.setVirtualWidth=function(t){this.vw=t;return this};UIScrollViewX.prototype.setVirtualHeight=function(t){this.vh=t;return this};UIScrollViewX.prototype.getVirtualWidth=function(){return Math.max(this.vw,this.w)};UIScrollViewX.prototype.getVirtualHeight=function(){return Math.max(this.vh,this.h)};UIScrollViewX.prototype.getXOffset=function(){return this.ox};UIScrollViewX.prototype.getYOffset=function(){return this.oy};UIScrollViewX.prototype.fixXOffset=function(t){return Math.min(Math.max(0,t),this.getVirtualWidth()-this.w)>>0};UIScrollViewX.prototype.fixYOffset=function(t){return Math.min(Math.max(0,t),this.getVirtualHeight()-this.h)>>0};UIScrollViewX.prototype.setXOffset=function(t){this.ox=this.fixXOffset(t);return this};UIScrollViewX.prototype.setYOffset=function(t){this.oy=this.fixYOffset(t);return this};UIScrollViewX.prototype.setDragLimit=function(t,e){this.xDragLimit=t;this.yDragLimit=e;return this};UIScrollViewX.prototype.setOffset=function(t,e,i){if(i){var n=0;var r=t>>0;var a=e>>0;var o=this.xDragLimit>1?this.xDragLimit:this.xDragLimit*this.w;var s=this.yDragLimit>1?this.yDragLimit:this.yDragLimit*this.h;if(r<-o){r=-o}else if(this.vw-r<this.w-o){r=Math.max(0,this.vw-(this.w-o))}if(a<-s){a=-s}else if(this.vh-a<this.h-s){a=Math.max(0,this.vh-(this.h-s))}this.ox=r;this.oy=a}else{this.setXOffset(t);this.setYOffset(e)}this.callOnScrollingHandler(this.ox,this.oy);return this};Object.defineProperty(UIScrollViewX.prototype,"xOffset",{get:UIScrollViewX.prototype.getXOffset,set:UIScrollViewX.prototype.setXOffset});Object.defineProperty(UIScrollViewX.prototype,"yOffset",{get:UIScrollViewX.prototype.getYOffset,set:UIScrollViewX.prototype.setYOffset});Object.defineProperty(UIScrollViewX.prototype,"virtualWidth",{get:UIScrollViewX.prototype.getVirtualWidth,set:UIScrollViewX.prototype.setVirtualWidth});Object.defineProperty(UIScrollViewX.prototype,"virtualHeight",{get:UIScrollViewX.prototype.getVirtualHeight,set:UIScrollViewX.prototype.setVirtualHeight});UIScrollViewX.prototype.dragStart=function(){this.saveOX=this.ox;this.saveOY=this.oy;this.velocityTracker.clear()};UIScrollViewX.prototype.drag=function(){this.addMovementForVelocityTracker();var t=this.saveOX-this.getMoveAbsDeltaX();var e=this.saveOY-this.getMoveAbsDeltaY();if(this.getVirtualWidth()<=this.w){t=0}else if(!UIElement.hScrollHandledBy){UIElement.hScrollHandledBy=this}if(UIElement.hScrollHandledBy!==this){t=0}if(this.getVirtualHeight()<=this.h){e=0}else if(!UIElement.vScrollHandledBy){UIElement.vScrollHandledBy=this}if(UIElement.vScrollHandledBy!==this){e=0}if(t||e){this.setOffset(t,e,true)}return};UIScrollViewX.prototype.getScrollDuration=function(t){var e=Math.max(Math.abs(t.x),Math.abs(t.y))*2/2;return Math.min(e,this.maxAnimationDuration)};UIScrollViewX.prototype.dragEnd=function(){var t=this.velocityTracker.getVelocity();var e=this.getScrollDuration(t);if(!e||e<10){return}var i=e/1e3;var n=t.x;var r=t.y;if(UIElement.hScrollHandledBy&&UIElement.hScrollHandledBy!==this){n=0}if(UIElement.hScrollHandledBy&&UIElement.vScrollHandledBy!==this){r=0}var a=.5*n*i;var o=.5*r*i;var s=this.ox;var l=this.oy;var h=Math.min(Math.max(0,s-a),this.virtualWidth-this.w);
var u=Math.min(Math.max(0,l-o),this.virtualHeight-this.h);var c=this.ox<0||this.oy<0||this.ox+this.w>this.virtualWidth||this.oy+this.h>this.virtualHeight;if(!c&&Math.abs(a)<10&&Math.abs(o)<10){this.callOnScrollDoneHandler(this.ox,this.oy);return}this.scrollTo(h,u,e);return};UIScrollViewX.prototype.scrollToPercent=function(t,e,i){var n=(this.virtualWidth-this.w)*(t/100);var r=(this.virtualHeight-this.h)*(e/100);return this.scrollTo(n,r,i)};UIScrollViewX.prototype.scrollTo=function(t,e,i){var n=this.ox;var r=this.oy;var a=this.fixXOffset(t);var o=this.fixYOffset(e);var s=a-n;var l=o-r;if(!i||!s&&!l){this.setOffset(t,e);this.callOnScrollDoneHandler(this.ox,this.oy);return this}var h=Date.now();function u(t){var e=(t-h)/i;if(e>=1){e=1;this.setStepScroll(null)}if(this.pointerDown){this.setStepScroll(null)}var a=this.interpolator.get(e);var o=n+s*a;var u=r+l*a;this.setOffset(o,u,true);this.scrollBarOpacity=1-a;if(e>=1){this.callOnScrollDoneHandler(this.ox,this.oy)}}this.setStepScroll(u);return this};UIScrollViewX.prototype.setStepScroll=function(t){this.stepScroll=t;return this};UIScrollViewX.prototype.stepAnimation=function(t,e){UIElement.prototype.stepAnimation.call(this,t,e);if(this.stepScroll){this.stepScroll(e||t.now||Date.now());this.postRedraw()}return this};UIScrollViewX.prototype.isDraggable=function(){if(this.isInDesignMode()){if(this.hitTestResult!==UIElement.HIT_TEST_MM){return false}return!this.getTarget()||this.view.isAltDown()}else{return true}};UIScrollViewX.prototype.onPointerDownRunning=UIScrollViewX.prototype.onPointerDownEditing=function(t,e){this.scrollBarOpacity=1;if(!e&&this.isDraggable()){this.dragStart();return true}return false};UIScrollViewX.prototype.onPointerMoveRunning=UIScrollViewX.prototype.onPointerMoveEditing=function(t,e){if(!e&&this.pointerDown&&this.isDraggable()){this.drag();return true}return false};UIScrollViewX.prototype.onPointerUpRunning=UIScrollViewX.prototype.onPointerUpEditing=function(t,e){if(!e&&this.pointerDown&&this.isDraggable()){this.dragEnd();return true}this.scrollBarOpacity=0;return false};UIScrollViewX.prototype.translatePoint=function(t){var e={x:t.x-this.left+this.xOffset,y:t.y-this.top+this.yOffset};return e};UIScrollViewX.prototype.onClip=function(t){if(this.showOutside&&this.isInDesignMode()){return this}t.clipRect(0,0,this.w,this.h);return this};UIScrollViewX.prototype.isChildVisibleRecursive=function(t){if(t.children&&t.children.length){return true}return false};UIScrollViewX.prototype.isChildVisible=function(t,e){var i=this.ox;var n=i+this.w;var r=this.oy;var a=r+this.h;if(!e.visible){return false}if(this.showOutside&&this.isInDesignMode()){return true}if(this.isChildVisibleRecursive(e)){return true}if(e.top+e.h<r||e.top>a||e.left+e.w<i||e.left>n){return false}return true};UIScrollViewX.prototype.paintChildren=function(t){var e=this.ox;var i=this.oy;var n=this.children;var r=n.length;t.save();t.translate(-e,-i);for(var a=0;a<r;a++){var o=this.children[a];if(this.isChildVisible(t,o)){this.beforePaintChild(o,t);o.paintSelf(t);this.afterPaintChild(o,t)}}t.restore();this.drawScrollBar(t);return};UIScrollViewX.prototype.dispatchPointerDownToChildren=function(t){if(!this.hitTestResult&&!this.showOutside){return false}if(this.isInDesignMode()&&this.view.isAltDown()){return false}return this.defaultDispatchPointerDownToChildren(t)};function UIScrollViewXCreator(){var t=["ui-scroll-view-x","ui-scroll-view-x",null,true];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIScrollViewX;return e.initUIScrollViewX(this.type)};return}UIScrollViewX.prototype.drawBgImageScroll=function(t,e,i,n){switch(e){case WImage.DISPLAY_SCALE:{var r=n.w/this.virtualWidth;var a=n.h/this.virtualHeight;var o=this.xOffset*r;var s=this.yOffset*a;var l=this.w*r;var h=this.h*a;t.drawImage(i,o,s,l,h,0,0,this.w,this.h);break}case WImage.DISPLAY_TILE:{var u=Math.floor(this.xOffset/n.w)*n.w-this.xOffset;var c=Math.floor(this.yOffset/n.h)*n.h-this.yOffset;var p=Math.ceil((this.w-u)/n.w)*n.w;var f=Math.ceil((this.h-c)/n.h)*n.h;t.save();t.clipRect(0,0,this.w,this.h);WImage.draw(t,i,e,u,c,p,f,n);t.restore();break}default:break}return this};UIScrollViewX.prototype.afterChildAppended=function(t){t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FIX;if(this.isUILayout){this.relayoutChildren()}return true};UIScrollViewX.prototype.drawBgImage=function(t){if(this.scrollBgImage){var e=this.getBgImage();if(e){var i=e.getImage();var n=e.getImageRect();if(i&&n){this.drawBgImageScroll(t,this.images.display,i,n)}}}else{UIElement.prototype.drawBgImage.call(this,t)}};UIScrollViewX.prototype.drawVScrollBar=function(t){var e=0;var i=0;var n=0;var r=0;var a=null;var o=null;var s=this.getImageByType(UIElement.IMAGE_V_SCROLL_BAR_BG);var o=s?s.getImage():null;if(o){a=s.getImageRect();n=a.rw||a.w;e=this.w-n;i=0;r=this.h;this.drawImageAt(t,o,UIElement.IMAGE_DISPLAY_3PATCH_V,e,i,n,r)}var l=this.getImageByType(UIElement.IMAGE_V_SCROLL_BAR_FG);var o=l?l.getImage():null;if(o){a=l.getImageRect();n=a.rw||a.w;e=this.w-n;i=this.h*(this.yOffset/this.virtualHeight);r=this.h*(this.h/this.virtualHeight);if(i<0){r=Math.max(10,r+i);i=0}if(i+r>this.h){r=Math.max(10,this.h-i);i=this.h-r}this.drawImageAt(t,o,UIElement.IMAGE_DISPLAY_3PATCH_V,e,i,n,r)}return};UIScrollViewX.prototype.drawHScrollBar=function(t){var e=0;var i=0;var n=0;var r=0;var a=null;var o=null;var s=this.getImageByType(UIElement.IMAGE_H_SCROLL_BAR_BG);var o=s?s.getImage():null;if(o){a=s.getImageRect();e=0;n=this.w;r=a.rh||a.h;i=this.h-r;this.drawImageAt(t,o,UIElement.IMAGE_DISPLAY_3PATCH_H,e,i,n,r)}var l=this.getImageByType(UIElement.IMAGE_H_SCROLL_BAR_FG);var o=l?l.getImage():null;if(o){a=l.getImageRect();r=a.rh||a.h;i=this.h-r;e=this.w*(this.xOffset/this.virtualWidth);n=this.w*(this.w/this.virtualWidth);if(e<0){n=Math.max(10,n+e);e=0}if(e+n>this.w){n=Math.max(10,this.w-e);e=this.w-n}this.drawImageAt(t,o,UIElement.IMAGE_DISPLAY_3PATCH_H,e,i,n,r)}};UIScrollViewX.prototype.drawScrollBar=function(t){if(this.scrollBarOpacity<1e-4){return this}t.save();t.globalAlpha=this.scrollBarOpacity;if(this.w<this.virtualWidth){this.drawHScrollBar(t)}if(this.h<this.virtualHeight){this.drawVScrollBar(t)}t.restore();return this};ShapeFactoryGet().addShapeCreator(new UIScrollViewXCreator);function UIGridViewX(){return}UIGridViewX.prototype=new UIScrollViewX;UIGridViewX.prototype.isUILayout=true;UIGridViewX.prototype.isUIGridViewX=true;UIGridViewX.prototype.saveProps=UIScrollViewX.prototype.saveProps.concat(["cols","rows","isVertical"]);UIGridViewX.prototype.initUIGridViewX=function(t){this.initUIScrollViewX(t);this.rows=3;this.cols=3;this.setMargin(0,0);this.setDefSize(200,200);return this};UIGridViewX.prototype.setVertical=function(t){this.isVertical=t;this.relayoutChildren();return this};UIGridViewX.prototype.getVertical=function(){return this.isVertical};UIGridViewX.prototype.setRows=function(t){this.rows=t;this.relayoutChildren();return this};UIGridViewX.prototype.getRows=function(){return this.rows};UIGridViewX.prototype.setCols=function(t){this.cols=t;this.relayoutChildren();return this};UIGridViewX.prototype.getCols=function(){return this.cols};UIGridViewX.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIGridViewX.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.cols;var i=this.rows;var n=this.w/e;var r=this.h/i;var a=0;var o=0;var s=this.children;var l=s.length;var h=this.spacer;var u=n+h;var c=r+h;var p=0;for(var f=0;f<l;f++){var m=s[f];if(!m.visible){continue}if(this.isVertical){o=p%e;a=Math.floor(p/e)}else{a=p%i;o=Math.floor(p/i)}m.left=o*u;m.top=a*c;m.w=n;m.h=r;m.setUserMovable(false);m.setUserResizable(false);p++}if(this.isVertical){this.vw=this.w;this.vh=Math.ceil(l/this.cols)*c;if(this.isInDesignMode()){this.vh+=c}}else{this.vh=this.h;this.vw=Math.ceil(l/this.rows)*u;if(this.isInDesignMode()){this.vw+=u}}if(this.xOffset+this.w>this.vw){this.xOffset=this.vw-this.w}if(this.yOffset+this.h>this.vh){this.yOffset=this.vh-this.h}return};UIGridViewX.prototype.isChildVisibleRecursive=function(t){return false};UIGridViewX.prototype.isDraggable=function(){if(this.isInDesignMode()){if(this.hitTestResult!==Shape.HIT_TEST_MM){return false}var t=this.getTarget();return!t||!t.getTarget()||this.view.isAltDown()}else{return true}};function UIGridViewXCreator(t){var e=["ui-grid-view-x","ui-grid-view-x",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIGridViewX;return e.initUIGridViewX(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridViewXCreator);function UIListViewX(){return}UIListViewX.prototype=new UIScrollViewX;UIListViewX.prototype.isUILayout=true;UIListViewX.prototype.isUIListViewX=true;UIListViewX.prototype.saveProps=UIScrollViewX.prototype.saveProps.concat(["cols","rows","isVertical","itemSize"]);UIListViewX.prototype.initUIListViewX=function(t){this.initUIScrollViewX(t);this.itemSize=100;this.setMargin(0,0);this.setDefSize(200,200);return this};UIListViewX.prototype.setVertical=function(t){this.isVertical=t;this.relayoutChildren();return this};UIListViewX.prototype.getVertical=function(){return this.isVertical};UIListViewX.prototype.setItemSize=function(t){this.itemSize=t;this.relayoutChildren();return this};UIListViewX.prototype.getItemSize=function(){return this.itemSize};UIListViewX.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIListViewX.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.children;var i=e.length;var n=this.spacer||0;var r=this.itemSize;var a=0;var o=0;var s=this.w;var l=this.h;for(var h=0;h<i;h++){var u=e[h];if(!u.visible){continue}if(this.isVertical){u.left=0;u.w=s;u.h=r||u.h;u.y=o;o+=u.h+n}else{u.top=0;u.h=l;u.w=r||u.w;u.x=a;a+=u.w+n}u.setUserMovable(false);u.setUserResizable(false)}if(this.isVertical){this.vw=this.w;this.vh=o;if(this.isInDesignMode()){this.vh+=r||80}}else{this.vh=this.h;this.vw=a;if(this.isInDesignMode()){this.vw+=r||80}}this.xOffset=0;this.yOffset=0;return};UIListViewX.prototype.isChildVisibleRecursive=function(t){return false};UIListViewX.prototype.isDraggable=function(){if(this.isInDesignMode()){if(this.hitTestResult!==Shape.HIT_TEST_MM){return false}var t=this.getTarget();return!t||!t.getTarget()||this.view.isAltDown()}else{return true}};function UIListViewXCreator(t){var e=["ui-list-view-x","ui-list-view-x",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIListViewX;return e.initUIListViewX(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIListViewXCreator);function UIShortcut(){return}UIShortcut.prototype=new UIElement;UIShortcut.prototype.isUIShortcut=true;UIShortcut.prototype.initUIShortcut=function(t){this.initUIElement(t);this.setText("#ABCDEFGHIJKLMNOPQRSTUVYWXYZ");this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onChanged"]);return this};UIShortcut.prototype.shapeCanBeChild=function(t){return false};UIShortcut.prototype.drawText=function(t){var e=this.text;var i=e.length;if(!i){return}t.textBaseline="middle";t.textAlign="center";t.font=this.style.getFont();var n=this.w>>1;var r=this.vMargin;var a=this.getWidth(true);var o=this.getHeight(true)/i;var s=o>>1;t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;for(var l=0;l<e.length;l++){var h=e[l];if(this.currentItem===l){t.rect(0,r,this.w,o);if(this.pointerDown){t.fillStyle=this.style.fillColor;t.fill()}t.stroke()}t.fillStyle=this.style.textColor;t.fillText(h,n,r+s);r+=o}return};UIShortcut.prototype.findItemByPoint=function(t){var e=this.text;var i=this.vMargin;var n=this.getHeight(true);var r=Math.floor(e.length*(t.y-i)/n);return r};UIShortcut.prototype.changeItemByPoint=function(t){var e=this.text;var i=this.findItemByPoint(t);if(i>=0&&i<e.length){var n=e[i];if(this.currentItem!=i){this.callOnChangedHandler(n);this.currentItem=i}}return};UIShortcut.prototype.setValue=function(t){var e=this.text.indexOf(t);if(e>=0){if(this.currentItem!=e){this.currentItem=e;this.callOnChangedHandler(t)}}return};UIShortcut.prototype.getValue=function(){if(this.text&&this.currentItem>=0&&this.currentItem<this.text.length){return this.text[this.currentItem]}else{return""}};UIShortcut.prototype.onPointerDownRunning=function(t,e){if(e||!this.text){return}this.changeItemByPoint(t);return};UIShortcut.prototype.onPointerMoveRunning=function(t,e){if(e||!this.text){return}if(this.pointerDown){this.changeItemByPoint(t)}return};function UIShortcutCreator(){var t=["ui-shortcut","ui-shortcut",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIShortcut;return e.initUIShortcut(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIShortcutCreator);function UIScrollText(){return}UIScrollText.prototype=new UIElement;UIScrollText.prototype.isUIScrollText=true;UIScrollText.prototype.initUIScrollText=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onScrollDone"]);return this};UIScrollText.prototype.onModeChanged=function(){this.offsetX=0;this.offsetY=0;return};UIScrollText.prototype.shapeCanBeChild=function(t){return false};UIScrollText.prototype.getAnimationDuration=function(){return this.animationDuration?this.animationDuration:1e3};UIScrollText.prototype.setAnimationDuration=function(t){this.animationDuration=t;return};UIScrollText.prototype.getPauseDuration=function(){return this.pauseDuration?this.pauseDuration:0};UIScrollText.prototype.setPauseDuration=function(t){this.pauseDuration=t;return};UIScrollText.prototype.startVScroll=function(){var t=this;var e=this.getTextHeight();var i=this.getLineHeight(true);if(e<=this.h){return}this.offsetX=0;this.offsetY=0;var n=0;var r=0;var a=this.getAnimationDuration();var o=this.getPauseDuration();this.h=Math.floor(this.h/i)*i;var s=-this.h;var l=true;var h=new DecelerateInterpolator;function u(){if(l){l=false;n=(new Date).getTime()}if(!t.isVisible()){return}var i=new Date;var c=(i.getTime()-n)/a;var p=o>0?h.get(c):c;delete i;if(c<1){t.offsetY=r+s*p;setTimeout(u,10)}else{t.offsetY=r+s;if(Math.abs(t.offsetY)<e-t.h){l=true;r=t.offsetY;setTimeout(u,o)}else{delete h;t.callOnScrollDoneHandler()}delete n}delete i;t.postRedraw()}setTimeout(u,o);return};UIScrollText.prototype.startHScroll=function(){var t=this;var e=this.textWidth;if(e<=this.w){return}this.offsetX=0;this.offsetY=0;var i=0;var n=0;var r=this.getAnimationDuration();var a=this.getPauseDuration();var o=-this.w;var s=true;var l=new DecelerateInterpolator;function h(){if(s){s=false;i=(new Date).getTime()}if(!t.isVisible()){return}var u=new Date;var c=(u.getTime()-i)/r;var p=a>0?l.get(c):c;if(c<1){t.offsetX=n+o*p;setTimeout(h,10)}else{t.offsetX=n+o;if(Math.abs(t.offsetX)<e-t.w){s=true;n=t.offsetX;setTimeout(h,a)}else{delete i;t.callOnScrollDoneHandler()}}delete u;t.postRedraw()}setTimeout(h,a);return};UIScrollText.prototype.startScroll=function(){if(!this.isVisible()){return}if(this.type==="ui-vscroll-text"){this.startVScroll()}else{this.startHScroll()}return};UIScrollText.prototype.onInit=function(){this.offsetX=0;this.offsetY=0;var t=this;setTimeout(function(){t.startScroll()},1e3);return};UIScrollText.prototype.drawText=function(t){var e=this.offsetX?this.offsetX:0;var i=this.offsetY?this.offsetY:0;t.save();t.rect(0,0,this.w,this.h);t.clip();t.translate(e,i);t.beginPath();t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.strokeStyle=this.style.lineColor;t.lineWidth=1;if(this.type==="ui-vscroll-text"){this.drawMLText(t,false,true)}else{this.textWidth=this.draw1LText(t,true)}t.restore();return};function UIScrollTextCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIScrollText;return n.initUIScrollText(this.type,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIScrollTextCreator("ui-vscroll-text",200,200));ShapeFactoryGet().addShapeCreator(new UIScrollTextCreator("ui-hscroll-text",200,50));function UIList(){return}UIList.prototype=new UIElement;UIList.prototype.isUIList=true;UIList.prototype.isUILayout=true;UIList.prototype.saveProps=["spacer","itemHeightVariable","itemDraggable","itemHeight"];UIList.prototype.initUIList=function(t,e,i,n){this.initUIElement(t);this.setMargin(e,e);this.setSizeLimit(100,100,1e3,1e3);this.setDefSize(400,i*3+2*e);this.spacer=0;this.itemHeight=i;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,n);this.rectSelectable=false;this.itemHeightVariable=false;this.addEventNames(["onInit"]);if(!n){this.style.setFillColor("White")}return this};UIList.prototype.getItemHeight=function(){return this.itemHeight};UIList.prototype.setItemHeight=function(t){this.itemHeight=t;return};UIList.prototype.shapeCanBeChild=function(t){if(!t.isUIListItem){return false}return true};UIList.prototype.childIsBuiltin=function(t){return t.name==="ui-list-item-update-status"||t.name==="ui-list-item-update-tips"||t.name==="ui-last"||t.name.indexOf("prebuild")>=0||t.name.indexOf("builtin")>=0};UIList.FIRST_ITEM=-1;UIList.LAST_ITEM=1;UIList.MIDDLE_ITEM=0;UIList.SINGLE_ITEM=2;UIList.prototype.fixListItemImage=function(t,e){var i=t.images;for(var n in i){var r=i[n];if(n!="display"){var a=r.getImageSrc();if(!a){continue}switch(e){case UIList.FIRST_ITEM:{a=a.replace(/\.single\./,".first.");a=a.replace(/\.middle\./,".first.");a=a.replace(/\.last\./,".first.");break}case UIList.MIDDLE_ITEM:{a=a.replace(/\.single\./,".middle.");a=a.replace(/\.first\./,".middle.");a=a.replace(/\.last\./,".middle.");break}case UIList.LAST_ITEM:{a=a.replace(/\.single\./,".last.");a=a.replace(/\.first\./,".last.");a=a.replace(/\.middle\./,".last.");break}case UIList.SINGLE_ITEM:{a=a.replace(/\.first\./,".single.");a=a.replace(/\.middle\./,".single.");a=a.replace(/\.last\./,".single.");break}}r.setImageSrc(a)}}return};UIList.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var a=this.getWidth(true);var o=this.getItemHeight();var s=o;var l=this.itemHeightVariable;var h=0;var u=this.spacer;var c=this.children.length;var p=this.children;for(var f=0;f<c;f++){var m=p[f];var d={};var y=false;if(m.removed||!m.visible)continue;if(l||m.isHeightVariable()){s=m.measureHeight(o)}else{s=o}if(c===1){this.fixListItemImage(m,UIList.SINGLE_ITEM)}else if(h===0){this.fixListItemImage(m,UIList.FIRST_ITEM)}else if(h===c-1){this.fixListItemImage(m,UIList.LAST_ITEM)}else{this.fixListItemImage(m,UIList.MIDDLE_ITEM)}if(this.h<=r+i+s){this.h=r+i+s}y=r<this.h&&(t||this.isInDesignMode());if(y){m.setSize(a,s);d.xStart=m.left;d.yStart=m.top;d.wStart=m.w;d.hStart=m.h;d.xEnd=n;d.yEnd=r;d.wEnd=a;d.hEnd=s;d.delay=10;d.duration=500;d.element=m;d.onDone=function(t){this.relayoutChildren()};m.animate(d)}else{m.move(n,r);m.setSize(a,s);m.relayoutChildren()}m.setUserMovable(true);m.widthAttr=UIElement.WIDTH_FILL_PARENT;if(m.heightAttr===UIElement.HEIGHT_FILL_PARENT){m.heightAttr=UIElement.HEIGHT_FIX}m.setUserResizable(l||m.isHeightVariable());if(!this.isUIScrollView){m.setDraggable(this.itemDraggable)}r+=s+u;h++}return};UIList.prototype.beforePaintChildren=function(t){t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();return};UIList.prototype.afterPaintChildren=function(t){return};UIList.prototype.afterChildAppended=function(t){if(t.view&&this.isInDesignMode()&&t.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();t.setUserMovable(true);t.setUserResizable(false);t.setCanRectSelectable(false,true);t.autoAdjustHeight=this.itemHeightVariable;t.setDraggable(this.itemDraggable);this.relayoutChildren();return true};UIList.prototype.sortChildren=function(){};UIList.prototype.onKeyUpRunning=function(t){var e=0;if(!this.children.length){return}switch(t){case KeyEvent.DOM_VK_UP:{e=this.children.indexOf(this.targetShape)-1;break}case KeyEvent.DOM_VK_DOWN:{e=this.children.indexOf(this.targetShape)+1;break}default:{return}}var i=this.children.length;e=(e+this.children.length)%i;var n=this.children[e];this.setTarget(n);this.postRedraw();if(this.isUIListView){if(this.offset>n.top){this.offset=n.top}if(this.offset+this.h<n.top+n.h){this.offset=n.top-(this.h-n.h)}}return};UIList.prototype.onKeyDownRunning=function(t){};UIList.prototype.getValue=function(){var t=null;var e=this.children.length;if(e<1)return t;for(var i=0;i<e;i++){var n=this.children[i];if(!n.isUIListCheckableItem||!n.value)continue;if(n.isRadio){return i}else{if(!t)t=[];t.push(i)}}return t};UIList.prototype.setValue=function(t){var e=null;if(typeof t==="array"){e=t}else if(typeof t==="number"){e=[t]}else{e=[]}var i=this.children.length;for(var n=0;n<i;n++){var r=this.children[n];if(r.isUIListCheckableItem){r.setValue(false)}}for(var n=0;n<e.length;n++){var a=e[n];if(a>=0&&a<i){var r=this.children[a];if(r.isUIListCheckableItem){r.setChecked(true)}}}return this};function UIListCreator(t,e,i){var n=["ui-list","ui-list",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIList;return r.initUIList(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIListCreator(5,114,null));function UIListView(){return}UIListView.prototype=new UIVScrollView;UIListView.prototype.isUIList=true;UIListView.prototype.isUILayout=true;UIListView.prototype.isUIListView=true;UIListView.prototype.setItemHeight=UIList.prototype.setItemHeight;UIListView.prototype.sortChildren=UIList.prototype.sortChildren;UIListView.prototype.initUIList=UIList.prototype.initUIList;UIListView.prototype.shapeCanBeChild=UIList.prototype.shapeCanBeChild;UIListView.prototype.paintSelfOnly=UIList.prototype.paintSelfOnly;UIListView.prototype.fixListItemImage=function(t,e){};UIListView.prototype.afterChildAppended=UIList.prototype.afterChildAppended;UIListView.prototype.childIsBuiltin=UIList.prototype.childIsBuiltin;UIListView.prototype.onKeyUpRunning=UIList.prototype.onKeyUpRunning;UIListView.prototype.onKeyDownRunning=UIList.prototype.onKeyDownRunning;UIListView.prototype.getValue=UIList.prototype.getValue;UIListView.prototype.setValue=UIList.prototype.setValue;UIListView.UPDATE_STATUS_NONE=0;UIListView.UPDATE_STATUS_TIPS=1;UIListView.UPDATE_STATUS_SYNC=2;UIListView.prototype.saveProps=UIList.prototype.saveProps;UIListView.prototype.beginUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_SYNC;var t=this.findChildByName("ui-list-item-update-status");if(t){var e=t.findChildByName("ui-wait-box");if(e){e.show()}var i=t.findChildByName("ui-label-loading");if(i){i.setText(dappGetText("Loading..."))}}return};UIListView.prototype.drawBgImage=function(t){t.beginPath();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();UIElement.prototype.drawBgImage.call(this,t);return this};UIListView.prototype.endUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_NONE;var t=this.findChildByName("ui-list-item-update-status");if(t){this.setLastUpdateTime(new Date)}this.relayoutChildren(true);return};UIListView.prototype.initUIListView=function(t,e,i,n){this.spacer=0;this.initUIList(t,e,i,n);this.initUIVScrollView(t,0,n,null);this.updateStatus=UIListView.UPDATE_STATUS_NONE;this.addEventNames(["onUpdateData","onScrollOutOfRange"]);this.setTextType(Shape.TEXT_INPUT);return this};UIListView.prototype.onModeChanged=function(){this.offset=0;this.updateStatus=UIListView.UPDATE_STATUS_NONE;return};UIListView.prototype.updateDone=function(){var t=this;t.endUpdate();setTimeout(function(){if(t.parentShape){t.relayoutChildren();t.postRedraw()}},1e3);return};UIListView.prototype.callOnUpdateData=function(){this.callOnUpdateDataHandler();this.beginUpdate();var t=this;setTimeout(function(){if(t.parentShape){t.updateDone()}},1e4);return true};UIListView.prototype.setLastUpdateTime=function(t){var e=this.findChildByName("ui-list-item-update-tips");if(e&&t){var i="";var n=new Date;if(n.getFullYear()===t.getFullYear()&&n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()){i=dappGetText("Today")}else{i=t.getMonth()+"-"+t.getDate()}i=i+" "+t.getHours()+":"+t.getMinutes();var r=e.findChildByName("ui-label-update-time");if(r){r.setText(i)}var r=e.findChildByName("ui-label-update-time");if(r){r.setText(i)}var a=e.findChildByName("ui-label-update-time-tips");if(a){a.setText(dappGetText("Last Update:"))}}return};UIListView.prototype.onDrag=function(t){var e=this.findChildByName("ui-list-item-update-tips");if(e){var i=e.findChildByName("ui-image");var n=e.findChildByName("ui-label-tips");if(i){if(t<-115){if(i.rotation===0){function r(){var t=i.rotation+.2*Math.PI;if(t>Math.PI){t=Math.PI}i.setRotation(t);if(t<Math.PI){setTimeout(r,50)}i.postRedraw();return}r();if(n){n.setText(dappGetText("Release To Update."))}}}else{i.setRotation(0);if(n){n.setText(dappGetText("Pull To Update."))}}}}return};UIListView.prototype.whenScrollOutOfRange=function(t){if(t<-115){this.callOnUpdateData();this.relayoutChildren()}this.callOnScrollOutOfRangeHandler(t);return};UIListView.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var a=this.getWidth(true);var o=this.itemHeight;var s=this.itemHeightVariable;var l=this.getScrollRange();var h=this.getPageSize();var u=true;var c=0;var p=this.spacer||0;var f=this.children.length;var m=this.children;for(var d=0;d<f;d++){var y=m[d];var v={};var g=false;if(y.removed||!y.visible)continue;if(s||y.isHeightVariable()){o=y.measureHeight(this.itemHeight)}else{o=this.itemHeight}if(y.name==="ui-list-item-update-tips"){if(!this.isInDesignMode()){y.move(n,-o);y.left=n;y.top=-o;y.w=a;y.h=o;y.setUserMovable(false);y.setUserResizable(false);y.setVisible(this.updateStatus!==UIListView.UPDATE_STATUS_TIPS);continue}else{y.setVisible(true)}g=true}else if(y.name==="ui-list-item-update-status"){if(!this.isInDesignMode()){if(this.updateStatus!==UIListView.UPDATE_STATUS_SYNC){y.setVisible(false)}else{y.setVisible(true)}}else{y.setVisible(true)}g=true}if(!y.visible){continue}animatable=y.isVisible()&&!g&&r<this.h&&(t||this.isInDesignMode());if(animatable&&(n!=y.left||r!=y.top||a!=y.w||o!=y.h)){y.setSize(a,o);v.xStart=y.left;v.yStart=y.top;v.wStart=y.w;v.hStart=y.h;v.xEnd=n;v.yEnd=r;v.wEnd=a;v.hEnd=o;v.delay=10;v.duration=1e3;v.element=y;v.onDone=function(t){this.relayoutChildren()};y.animate(v)}else{y.move(n,r);y.setSize(a,o);y.relayoutChildren()}y.widthAttr=UIElement.WIDTH_FILL_PARENT;if(y.heightAttr===UIElement.HEIGHT_FILL_PARENT){y.heightAttr=UIElement.HEIGHT_FIX}y.setUserMovable(u);y.setUserResizable(s||y.isHeightVariable());r+=o+p;c++}return};UIListView.prototype.drawText=UIList.prototype.drawText;UIListView.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.isInDesignMode()){this.drawPageDownUp(t)}return};function UIListViewCreator(t,e,i){var n=["ui-list-view","ui-list-view",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIListView;return r.initUIListView(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIListViewCreator(5,114,null));function UIListItem(){return}UIListItem.prototype=new UIElement;UIListItem.prototype.isUIListItem=true;UIListItem.prototype.saveProps=["heightVariable","slideToRemove","isTemplate","roundRadius"];UIListItem.prototype.initUIListItem=function(t){this.initUIElement(t);this.roundRadius=5;this.setDefSize(200,120);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setImage(UIElement.IMAGE_FOCUSED,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.setImage(UIElement.IMAGE_POINTER_OVER,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.addEventNames(["onLongPress","onRemoved"]);return this};UIListItem.prototype.dragMove=function(t,e){this.top=this.top+e;this.onDragging();return};UIListItem.prototype.getDeleteItemIcon=function(){var t=this.getHtmlImageByType(UIElement.IMAGE_DELETE_ITEM);return t};UIListItem.prototype.shapeCanBeChild=function(t){if(t.isUIMenu||t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPageManager||t.isUIPage||t.isUIListItem){return false}return true};UIListItem.prototype.onUserResized=function(){var t=this.parentShape;if(t){t.relayoutChildren()}return};UIListItem.prototype.setSlideToRemove=function(t){this.slideToRemove=t;return this};UIListItem.prototype.setHeightVariable=function(t){this.heightVariable=t;return this};UIListItem.prototype.isHeightVariable=function(){return this.heightVariable};UIListItem.prototype.measureHeight=function(t){return this.h};UIListItem.prototype.ANIM_DRAW_LINE=1;UIListItem.prototype.onPointerUpRunning=function(t,e){if(e||!this.slideToRemove){return}var i=this.getMoveAbsDeltaX();var n=this.getMoveAbsDeltaY();if(Math.abs(i)<this.w/2||Math.abs(n)>this.h){return}var r=this;var a=300;var o=(new Date).getTime();r.animateState=this.ANIM_DRAW_LINE;for(var s=0;s<this.children.length;s++){var l=this.children[s];l.style.setTextColor("#C0C0C0")}function h(){var t=new Date;var e=(t.getTime()-o)/a;if(e<1){r.animatePercent=e;setTimeout(h,10)}else{r.animatePercent=1;setTimeout(function(){delete o;delete r.animatePercent;delete r.animateState;var t=r.parentShape;t.removeChild(r);t.relayoutChildren("default");t.postRedraw()},300)}delete t;r.postRedraw()}h();return};UIListItem.prototype.getFillColor=function(t){var e;if(this.pointerDown){var i=Math.abs(this.getMoveAbsDeltaY());if(i<5){var n=Date.now()-this.pointerDownTime;if(n<50&&this.getParent().isUIListView){e=this.style.fillColor;this.postRedraw()}else{e=this.style.textColor}}else{e=this.style.fillColor}}else if(this.isPointerOverShape()){e=this.style.overFillColor?this.style.overFillColor:this.style.fillColor}else if(this.isFocused()){e=this.style.focusedFillColor?this.style.focusedFillColor:this.style.fillColor}else{e=this.style.fillColor}return e};UIListItem.prototype.paintSelfOnly=function(t){if(this.getBgHtmlImage()){return}var e=this.parentShape;var i=this.getFillColor();var n=this.style.lineColor;var r=this.style.lineWidth;t.beginPath();if(!e||e.isUIListView||e.isUIMenu){if(!Shape.isTransparentColor(i)){t.fillStyle=i;t.fillRect(0,0,this.w,this.h)}if(!Shape.isTransparentColor(n)){t.moveTo(0,this.h);t.lineTo(this.w,this.h);t.lineWidth=r;t.strokeStyle=n;t.stroke()}return}var a=this.roundRadius;var o=this===e.children[0];var s=this===e.children[e.children.length-1];if(o&&s){drawRoundRect(t,this.w,this.h,a)}else if(o){drawRoundRect(t,this.w,this.h,a,RoundRect.TL|RoundRect.TR)}else if(s){drawRoundRect(t,this.w,this.h,a,RoundRect.BL|RoundRect.BR)}else{t.rect(0,0,this.w,this.h)}if(!Shape.isTransparentColor(i)){t.fillStyle=i;t.fill()}if(!Shape.isTransparentColor(n)){t.lineWidth=r;t.strokeStyle=n;t.stroke()}return};UIListItem.prototype.afterPaintChildren=function(t){if(!this.animateState){return}var e=this.getDeleteItemIcon();if(this.animateState===this.ANIM_DRAW_LINE&&e&&e.width>0){var i=20;var n=this.animatePercent;var r=(this.w-i)*n-e.width;if(r>i){t.lineWidth=1;t.strokeStyle="#D0D0D0";t.moveTo(i,this.h/2);t.lineTo(r,this.h/2);t.stroke();if(n>.9){var a=(this.h-e.height)/2;var o=this.w-e.width-i;t.drawImage(e,o,a)}}}return};UIListItem.prototype.afterChildAppended=function(t){if(t.isUIButton||t.isUICheckBox){this.setImage(UIElement.IMAGE_ACTIVE,this.getImageByType(UIElement.IMAGE_NORMAL).getImageSrc());this.setImage(UIElement.IMAGE_FOCUSED,this.getImageByType(UIElement.IMAGE_NORMAL).getImageSrc())}return true};function UIListItemCreator(){var t=["ui-list-item","ui-list-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListItem;e.initUIListItem(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIListItemCreator(null,null,null,null));function UIListCheckableItem(){return}UIListCheckableItem.prototype=new UIListItem;UIListCheckableItem.prototype.isUIListCheckableItem=true;UIListCheckableItem.prototype.initUIListCheckableItem=function(t){
this.initUIListItem(t);this.isUIListRadioBoxItem=t==="ui-list-radiobox-item";this.isUIListCheckBoxItem=t==="ui-list-checkbox-item";this.setImage(UIElement.IMAGE_CHECKED_FG,null);this.setImage(UIElement.IMAGE_UNCHECK_FG,null);this.addEventNames(["onChanged"]);return this};UIListCheckableItem.prototype.getValue=function(){return this.value};UIListCheckableItem.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value)}return};UIListCheckableItem.prototype.setChecked=function(){var t=this.parentShape;if(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIListCheckableItem){i.setValue(false)}}}this.setValue(true);return};UIListCheckableItem.prototype.setParent=function(t){this.parentShape=t;if(this.value){this.setChecked()}return};UIListCheckableItem.prototype.onClick=function(t,e){if(e){return}if(this.isUIListRadioBoxItem){this.setChecked()}else{this.setValue(!this.value)}return};UIListCheckableItem.prototype.drawFgImage=function(t){var e=this.getHtmlImageByType(this.value?UIElement.IMAGE_CHECKED_FG:UIElement.IMAGE_UNCHECK_FG);if(e){var i=this.w-e.width-20;var n=(this.h-e.height)/2;t.drawImage(e,0,0,e.width,e.height,i,n,e.width,e.height)}return};function UIListCheckBoxItemCreator(){var t=["ui-list-checkbox-item","ui-list-checkbox-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListCheckableItem;e.initUIListCheckableItem(this.type);return e};return}function UIListRadioBoxItemCreator(){var t=["ui-list-radiobox-item","ui-list-radiobox-item",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIListCheckableItem;e.initUIListCheckableItem(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIListCheckBoxItemCreator);ShapeFactoryGet().addShapeCreator(new UIListRadioBoxItemCreator);function UISelect(){return}UISelect.prototype=new UIElement;UISelect.prototype.isUISelect=true;UISelect.prototype.saveProps=["visibleItems","isVertical"];UISelect.prototype.initUISelect=function(t,e,i){this.initUIElement(t);this.offset=0;this.options=[];this.visibleItems=5;this.setDefSize(e,i);this.isVertical=true;this.addEventNames(["onChanged"]);this.setTextType(UIElement.TEXT_TEXTAREA);this.setCanRectSelectable(false,true);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UISelect.prototype.getItemSize=function(){var t=this.isVertical?this.h:this.w;return Math.round(t/this.visibleItems)};UISelect.prototype.getVisibleItems=function(){return this.visibleItems};UISelect.prototype.setVisibleItems=function(t){if(t<=3){this.visibleItems=3}else{this.visibleItems=5}};UISelect.prototype.scrollTo=function(t){var e=this.getItemSize();t=Math.round(t/e)*e;var i=this;var n=500;var r=this.offset;var a=t-r;var o=(new Date).getTime();var s=new DecelerateInterpolator;this.animating=true;function l(){var t=new Date;var e=(t.getTime()-o)/n;var h=s.get(e);if(e<1){i.setOffset(Math.floor(r+h*a));setTimeout(l,10)}else{i.setOffset(r+a,true);delete o;delete s;delete i.animating}delete t}setTimeout(function(){l()},10);return};UISelect.prototype.setOffset=function(t,e){this.offset=t;this.postRedraw();if(e){var i=this.getValue();this.callOnChangedHandler(i)}return};UISelect.prototype.onPointerDownRunning=function(t,e){if(e||this.animating){return}if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();this.saveOffset=this.offset;return true};UISelect.prototype.onPointerMoveRunning=function(t,e){if(e||this.animating){return}this.addMovementForVelocityTracker();var i=this.isVertical?this.getMoveAbsDeltaY():this.getMoveAbsDeltaX();this.setOffset(this.saveOffset+i);return};UISelect.prototype.getMaxOffset=function(){var t=Math.floor(.5*this.visibleItems);return t*this.getItemSize()};UISelect.prototype.getMinOffset=function(){var t=this.getItemSize();var e=Math.round(.5*this.visibleItems);if(this.options.length<=e){return 0}else{return-(this.options.length-e)*t}};UISelect.prototype.handleClicked=function(t){var e=this.getItemSize();var i=this.isVertical?this.h:this.w;var n=Math.floor((i/2-this.offset)/e);var r=Math.floor(((this.isVertical?t.y:t.x)-this.offset)/e);var a=(r-n)*e;var o=this.offset-a;var s=this.getMinOffset();var l=this.getMaxOffset();if(o<s){o=s}if(o>l){o=l}this.scrollTo(o);return};UISelect.prototype.onPointerUpRunning=function(t,e){if(e||this.animating){return}var i=this.velocityTracker.getVelocity();var n=this.isVertical?i.y:i.x;var r=this.isVertical?this.getMoveAbsDeltaY():this.getMoveAbsDeltaX();if(Date.now()-this.pointerDownTime>400){n=0}var a=r+n/2;if(Math.abs(a)<10){this.setOffset(this.saveOffset);this.handleClicked(t);return}var o=this.getMinOffset();var s=this.getMaxOffset();var l=this.saveOffset+r+n;if(l<o){l=o}if(l>s){l=s}this.scrollTo(l);return};UISelect.prototype.shapeCanBeChild=function(t){return false};UISelect.prototype.createOptionsFromText=function(t){if(t){this.options=t.split("\n");this.options.remove("")}else{this.options=[]}};UISelect.prototype.setText=function(t){t=this.toText(t);this.createOptionsFromText(t);this._text=t;return this};UISelect.prototype.setOptions=function(t){this.options=t||[];this.text=this.options.join("\n");return this};UISelect.prototype.getOptions=function(){return this.options};UISelect.prototype.drawText=function(t){return};UISelect.prototype.drawImage=function(t){var e=this.w;var i=this.h;var n=this.getItemSize();t.clipRect(0,0,e,i);this.drawBgImage(t);var r=this.options.length;this.style.setTextB(false);var a=this.style.getFont();var o=this.style.textColor;this.style.setTextB(true);var s=this.style.getFont();var l=this.style.textColorHighlight;t.textAlign="center";t.textBaseline="middle";var h=0;var u=0;var c=this.offset;var p=this.isVertical;var f=p?0:i>>1;var m=p?e>>1:0;var d=p?c:0;var y=p?0:c;t.translate(y,d);if(p){h=Math.floor((.5*i-d)/n)}else{h=Math.floor((.5*e-y)/n)}var v=0;var g=0;for(var _=0;_<r;_++){var I=this.options[_];if(p){f=_*n;v=f+n;u=-c;if(v<u&&f<u){continue}u=-(c-i);if(v>u&&f>u){continue}f=f+(n>>1)}else{m=_*n;g=m+n;u=-c;if(g<u&&m<u){continue}u=-(c-e);if(g>u&&m>u){continue}m=m+(n>>1)}if(h==_){t.font=s;t.fillStyle=l}else{t.font=a;t.fillStyle=o}t.fillText(I,m,f,e)}return};UISelect.prototype.getValue=function(){var t=this.offset;var e=this.getItemSize();var i=this.isVertical?this.h:this.w;var n=Math.floor((.5*i-t)/e);var r=n<this.options.length?this.options[n]:"";return r};UISelect.prototype.setValueByIndex=function(t,e){var i=t;var n=this.getItemSize();if(i>=0){var r=-(i-(this.getVisibleItems()>>1))*n;if(e){this.scrollTo(r)}else{this.setOffset(r,true)}}return this};UISelect.prototype.setValue=function(t,e,i){var n=this.options.indexOf(t.toString());this.setValueByIndex(n,i);if(e){this.callOnChangedHandler(this.getValue())}return this};Object.defineProperty(UISelect.prototype,"text",{set:function(t){t=this.toText(t);this.createOptionsFromText(t);this._text=t},get:function(){return this._text}});function UISelectCreator(t,e){var i=["ui-select","ui-select",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UISelect;return n.initUISelect(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UISelectCreator("ui-select",300,50));function UIImage(){return}UIImage.prototype=new UIElement;UIImage.prototype.isUIImage=true;UIImage.prototype.saveProps=["keepSizeWithImage"];UIImage.prototype.initUIImage=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.setCanRectSelectable(false,true);this.addEventNames(["onUpdateTransform"]);this.scaleX=1;this.scaleY=1;this.drawText=null;this.beforePaint=null;this.afterPaint=null;this.highlightConfig=null;return this};UIImage.prototype.setValue=function(t){this.v=t;return this.setImageSrc(t)};UIImage.prototype.getValue=function(){return this.v!==undefined?this.v:-1};UIImage.prototype.setImageSrc=function(t){this.setImage(UIElement.IMAGE_DEFAULT,t);return this};UIImage.prototype.getImageSrc=function(t){return this.getImageSrcByType(t?t:UIElement.IMAGE_DEFAULT)};UIImage.prototype.getHtmlImage=function(t){return this.getHtmlImageByType(t?t:UIElement.IMAGE_DEFAULT)};UIImage.prototype.getImageSrcRect=function(){var t=this.getImageByType(UIElement.IMAGE_DEFAULT);if(this.srcRect){return this.srcRect}else if(t){return t.getImageRect()}else{return null}};UIImage.prototype.setImageSrcRect=function(t,e,i,n){this.srcRect={};this.srcRect.x=t;this.srcRect.y=e;this.srcRect.w=i;this.srcRect.h=n;return};UIImage.prototype.fitToImage=function(){var t=this.getImageSrcRect();if(t&&t.w&&t.h){this.w=t.rw||t.w;this.h=t.rh||t.h}return};UIImage.prototype.fixChildSize=function(){return};UIImage.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;function UIImageCreator(t){var e=[t,"ui-image",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIImage;return e.initUIImage(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIImageCreator("ui-image"));ShapeFactoryGet().addShapeCreator(new UIImageCreator("ui-icon"));UIImage.prototype.setBorderStyle=function(t,e){return};UIImage.prototype.setClickedStyle=function(t,e){return};UIImage.prototype.getBgImage=function(){return this.images.default_bg};UIImage.prototype.drawTextTips=function(t){};UIImage.prototype.paintSelfFast=function(t){var e=this.opacity;var i=this.w*this.pivotX;var n=this.h*this.pivotY;t.save();if(e!==1){t.globalAlpha*=e}t.translate(this._left,this._top);t.translate(i,n);t.scale(this.scaleX,this.scaleY);t.rotate(this.rotation);t.translate(-i,-n);this.drawBgImage(t);t.restore()};function UILabel(){return}UILabel.prototype=new UIElement;UILabel.prototype.isUILabel=true;UILabel.prototype.saveProps=["hTextAlign","vTextAlign","singleLineMode"];UILabel.prototype.initUILabel=function(t){this.initUIElement(t);this.setText("");this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onChanged","onUpdateTransform"]);return this};UILabel.prototype.setTextAlign=function(t){this.hTextAlign=t;return this};UILabel.prototype.setTextBaseline=function(t){this.vTextAlign=t;return this};UILabel.prototype.getTextAlign=function(){return this.hTextAlign};UILabel.prototype.getTextBaseline=function(){return this.vTextAlign};UILabel.prototype.shapeCanBeChild=function(t){return t.isUILabel||t.isUIImage};UILabel.prototype.setText=function(t){this.text=this.toText(t);this.textNeedRelayout=true;this.callOnChangedHandler(t);this.postRedraw();return this};UILabel.prototype.drawText=function(t){this.layoutText(t);this.defaultDrawText(t);return};UILabel.prototype.layoutText=function(t){RShape.prototype.layoutText.call(this,t);if(this.singleLineMode&&this.lines.length>1){this.lines.length=1}return this};UILabel.prototype.setSingleLineMode=function(t){this.singleLineMode=t;this.setTextNeedRelayout(true);return this};UILabel.prototype.getSingleLineMode=function(){return this.singleLineMode};UILabel.prototype.fitToTextContent=function(){if(!this.text){this.w=30;this.h=30;return}var t=this.getCanvasContext2D();this.layoutText(t);var e=this.lines.length;var i=this.w;var n=this.getTextHeight()+this.vMargin*2;if(e===1){var r=this.lines[0];i=t.measureText(r).width+2*this.hMargin}this.w=i;this.h=n;return this};function UILabelCreator(){var t=["ui-label","ui-label",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UILabel;return e.initUILabel(this.type)};return}ShapeFactoryGet().addShapeCreator(new UILabelCreator);function UITips(){return}UITips.prototype=new UILabel;UITips.prototype.isUITips=true;UITips.prototype.saveProps=["clickable","triangleSize","hTextAlign","vTextAlign"];UITips.prototype.initUITips=function(t){this.initUILabel(t);this.roundRadius=8;this.triangleSize=16;this.setMargin(20,20);this.setClickable(true);this.setDefSize(200,200);this.setSizeLimit(40,40);this.handle={x:-20,y:-20};return this};UITips.prototype.getMoreSelectMark=function(t,e){if(t===Shape.HIT_TEST_HANDLE){e.x=this.handle.x;e.y=this.handle.y;return true}return false};UITips.prototype.getPointer=function(){return this.handle};UITips.prototype.moveHandle=function(t,e){return this.setPointer(this.handle.x+t,this.handle.y+e)};UITips.prototype.setPointer=function(t,e){this.handle.x=t;this.handle.y=e;return this};UITips.prototype.setClickable=function(t){this.clickable=t;return this};UITips.prototype.fitToTextContent=function(){UILabel.prototype.fitToTextContent.call(this);var t=this.roundRadius;var e=this.triangleSize;var i=t+t+e;this.w=Math.max(this.w,i);this.h=Math.max(this.h,i);return this};UITips.prototype.drawPath=function(t){var e=0;var i=0;var n=this.roundRadius;var r=this.triangleSize;var a=this.handle.x;var o=this.handle.y;var s=this.hMargin;var l=this.vMargin;var h=n+n+r;this.w=Math.max(this.w,h);this.h=Math.max(this.h,h);var u=this.w;var c=this.h;var p=r>>1;t.beginPath();function f(){t.lineTo(u-n,0);t.arc(u-n,n,n,1.5*Math.PI,2*Math.PI,false)}function m(){t.lineTo(u,c-n);t.arc(u-n,c-n,n,0,.5*Math.PI,false)}function d(){t.lineTo(n,c);t.arc(n,c-n,n,.5*Math.PI,Math.PI,false)}function y(){t.lineTo(0,n);t.arc(n,n,n,Math.PI,1.5*Math.PI,false)}function v(){t.arc(n,n,n,Math.PI,1.5*Math.PI,false)}function g(){t.arc(u-n,n,n,1.5*Math.PI,2*Math.PI,false)}function _(){t.arc(n,c-n,n,.5*Math.PI,Math.PI,false)}function I(){t.arc(u-n,c-n,n,0,.5*Math.PI,false)}t.moveTo(a,o);if(a<n){if(o<n+p){t.lineTo(n,0);f();m();d();t.lineTo(0,n)}else if(o>c-n-p){t.lineTo(0,c-n);y();f();m();t.lineTo(n,c)}else{t.lineTo(0,o-p);y();f();m();d();t.lineTo(0,o+p)}}else if(a<u-n){if(o<n){t.lineTo(a+p,0);f();m();d();y();t.lineTo(a-p,0)}else{t.lineTo(a-p,c);d();y();f();m();t.lineTo(a+p,c)}}else{if(o<n+p){t.lineTo(u,n);m();d();y();t.lineTo(u-n,0)}else if(o>c-n-p){t.lineTo(u-n,c);d();y();f();t.lineTo(u,c-n)}else{t.lineTo(u,o+p);m();d();y();f();t.lineTo(u,o-p)}}t.closePath();return};UITips.prototype.paintSelfOnlyByColor=function(t){this.drawPath(t);if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}if(!this.isStrokeColorTransparent()){t.strokeStyle=this.style.lineColor;t.lineWidth=this.pointerDown&&this.clickable?4:2;t.stroke()}return};UITips.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){this.paintSelfOnlyByColor(t)}return};UITips.prototype.shapeCanBeChild=function(t){return t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage};function UITipsCreator(){var t=["ui-tips","ui-tips",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITips;return e.initUITips(this.type)};return}ShapeFactoryGet().addShapeCreator(new UITipsCreator);function UIMenu(){return}UIMenu.FREE_LAYOUT=0;UIMenu.ARC_LAYOUT=1;UIMenu.VLINEAR_LAYOUT=2;UIMenu.HLINEAR_LAYOUT=3;UIMenu.prototype=new UIElement;UIMenu.prototype.isUIMenu=true;UIMenu.prototype.saveProps=["autoHideWhenClicked","childrenAnimation","enableShowAnimation","enableHideAnimation","spacer","menuItemNr","animDuration","layoutType","originPoint"];UIMenu.prototype.initUIMenu=function(t){this.initUIElement(t,null);this.spacer=2;this.menuItemNr=2;this.animDuration=600;this.setTextType(Shape.TEXT_NONE);this.layoutType=UIMenu.FREE_LAYOUT;this.originPoint=UIElement.ORIGIN_RIGHT;this.setCanRectSelectable(false,false);this.enableHideAnimation=true;this.enableShowAnimation=true;return this};UIMenu.prototype.relayoutChildrenHLL=function(){var t=this.children.length;var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var a=this.spacer;var o=this.getWidth(true);var s=this.getHeight(true);var l=this.originPoint;var h=Math.max(t,this.menuItemNr);var u=Math.round((o-a*(h-1))/h);for(var c=0;c<t;c++){var p=this.children[c];p.h=s;p.w=u;p.left=n;p.top=r;n+=u+a;p.relayoutChildren()}return this};UIMenu.prototype.relayoutChildrenVLL=function(){var t=this.children.length;var e=this.getHMargin();var i=this.getVMargin();var n=e;var r=i;var a=this.spacer;var o=this.getWidth(true);var s=this.getHeight(true);var l=this.originPoint;var h=Math.max(t,this.menuItemNr);var u=Math.round((s-a*(h-1))/h);for(var c=0;c<t;c++){var p=this.children[c];p.w=o;p.h=u;p.left=n;p.top=r;r+=u+a;p.relayoutChildren()}return this};UIMenu.prototype.getChildPositionOfArc=function(t,e,i,n){var r={};var a=t.angleRange>Math.PI*1.9?n:n-1;var o=t.angleStart+t.angleRange*i/a;r.x=t.x+e*Math.cos(o);r.y=t.y+e*Math.sin(o);return r};UIMenu.prototype.relayoutChildrenARC=function(){var t=this.children.length;var e=this.getOrigin();var i=e.r;var n=this.w;var r=this.h;for(var a=0;a<t;a++){var o=this.children[a];var s=this.getChildPositionOfArc(e,i,a,t);o.left=s.x-(o.w>>1);o.top=s.y-(o.h>>1);o.relayoutChildren()}return};UIMenu.prototype.relayoutChildren=function(){var t=this.children.length;if(this.disableRelayout||!t){return}switch(this.layoutType){case UIMenu.HLINEAR_LAYOUT:{this.relayoutChildrenHLL();break}case UIMenu.VLINEAR_LAYOUT:{this.relayoutChildrenVLL();break}case UIMenu.ARC_LAYOUT:{this.relayoutChildrenARC();break}default:{for(var e=0;e<t;e++){this.children[e].relayout()}break}}return};UIMenu.prototype.prepareShowChildAnimation=function(t,e){var i={};i.duration=this.animDuration;i.interpolator="d";i.xStart=e.x-(t.w>>1);i.xEnd=t.left;i.yStart=e.y-(t.h>>1);i.yEnd=t.top;i.scaleXStart=0;i.scaleXEnd=1;i.scaleYStart=0;i.scaleYEnd=1;i.opacityStart=0;i.opacityEnd=1;i.rotationStart=0;i.rotationEnd=2*Math.PI;return i};UIMenu.prototype.prepareHideChildAnimation=function(t,e){var i={};i.duration=this.animDuration;i.interpolator="d";i.xStart=t.left;i.xEnd=e.x-(t.w>>1);i.yStart=t.top;i.yEnd=e.y-(t.h>>1);i.opacityStart=1;i.opacityEnd=0;i.scaleXStart=1;i.scaleXEnd=0;i.scaleYStart=1;i.scaleYEnd=0;i.rotationStart=Math.PI*2;i.rotationEnd=0;return i};UIMenu.prototype.animateShowChildren=function(){var t=this;var e=this.children.length;var i=this.getOrigin();this.busy=e;this.visible=true;for(var n=0;n<e;n++){var r=null;var a=this.children[n];if(a.animations){r=a.animations["show"]}if(!r){r=this.prepareShowChildAnimation(a,i)}else{console.log("Use child show animation.")}a.animate(r,function(){t.busy--})}return this};UIMenu.prototype.animateHideChild=function(t,e){var i=this;var n=t.left;var r=t.top;var a=t.w;var o=t.h;t.animate(e,function(){t.left=n;t.top=r;t.w=a;t.h=o;t.opacity=1;t.visible=false;i.busy--;if(!i.busy){i.visible=false}});return};UIMenu.prototype.animateHideChildren=function(){var t=this;var e=this.children.length;var i=this.getOrigin();this.busy=e;this.visible=true;for(var n=0;n<e;n++){var r=null;var a=this.children[n];if(a.animations){r=a.animations["hide"]}if(!r){r=this.prepareHideChildAnimation(a,i)}else{console.log("Use child hide animation.")}this.animateHideChild(a,r)}return this};UIMenu.prototype.prepareShowAnimation=function(){var t={};t.duration=this.animDuration;t.interpolator="d";t.scaleXStart=.5;t.scaleXEnd=1;t.scaleYStart=.5;t.scaleYEnd=1;t.opacityStart=0;t.opacityEnd=1;return t};UIMenu.prototype.prepareHideAnimation=function(){var t={};t.duration=this.animDuration;t.interpolator="a";t.scaleXStart=1;t.scaleXEnd=.5;t.scaleYStart=1;t.scaleYEnd=.5;t.opacityStart=1;t.opacityEnd=0;return t};UIMenu.prototype.animateShowSelf=function(){var t=this;t.busy=true;var e=null;if(this.animations){e=this.animations["show"]}if(!e){e=this.prepareShowAnimation()}this.animate(e,function(){t.visible=true;t.busy=false})};UIMenu.prototype.animateHideSelf=function(){var t=this;t.busy=true;this.visible=true;var e=null;if(this.animations){e=this.animations["hide"]}if(!e){e=this.prepareHideAnimation()}this.animate(e,function(){t.visible=false;t.busy=false});return this};UIMenu.prototype.show=function(){if(this.busy)return;if(this.autoHideWhenClicked){this.getWindow().grab(this)}if(!this.enableShowAnimation){this.visible=true;return}if(this.childrenAnimation){this.animateShowChildren()}else{this.animateShowSelf()}};UIMenu.prototype.hide=function(){if(this.busy)return;if(this.autoHideWhenClicked){this.getWindow().ungrab(this)}if(!this.enableHideAnimation){this.visible=false;return}if(this.childrenAnimation){return this.animateHideChildren()}else{return this.animateHideSelf()}};UIMenu.prototype.onPointerUpRunning=function(t,e){if(e){return}if(this.autoHideWhenClicked){this.hide()}return};UIMenu.prototype.setVisible=function(t){if(this.visible===t||this.busy){return this}return t?this.show():this.hide()};UIMenu.prototype.getOrigin=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=this.hMargin;var n=this.vMargin;var r={x:i,y:n};switch(this.originPoint){case UIElement.ORIGIN_UP:{r.x=this.w>>1;r.angleRange=Math.PI;r.angleStart=0;r.r=t>>1;break}case UIElement.ORIGIN_DOWN:{r.x=this.w>>1;r.y=this.h-n;r.angleRange=Math.PI;r.angleStart=Math.PI;r.r=t>>1;break}case UIElement.ORIGIN_LEFT:{r.x=i;r.y=this.h>>1;r.angleRange=Math.PI;r.angleStart=-Math.PI*.5;r.r=e>>1;break}case UIElement.ORIGIN_RIGHT:{r.x=this.w-i;r.y=this.h>>1;r.angleRange=Math.PI;r.angleStart=Math.PI*.5;r.r=e>>1;break}case UIElement.ORIGIN_UP_LEFT:{r.angleRange=Math.PI*.5;r.angleStart=0;r.r=Math.min(t,e);break}case UIElement.ORIGIN_UP_RIGHT:{r.x=this.w-i;r.angleStart=.5*Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_DOWN_LEFT:{r.x=i;r.y=this.h-n;r.angleStart=-.5*Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_DOWN_RIGHT:{r.x=this.w-i;r.y=this.h-n;r.angleStart=Math.PI;r.angleRange=Math.PI*.5;r.r=Math.min(t,e);break}case UIElement.ORIGIN_MIDDLE_CENTER:{r.x=this.w>>1;r.y=this.h>>1;r.angleStart=-.5*Math.PI;r.angleRange=Math.PI*2;r.r=Math.min(t,e)>>1;break}default:break}return r};UIMenu.prototype.applyTransform=function(t){if(this.isInDesignMode())return;var e=this.getOrigin();if(t.globalAlpha!=this.opacity){t.globalAlpha=this.opacity}if(this.offsetX){t.translate(this.offsetX,0)}if(this.offsetY){t.translate(0,this.offsetY)}var i=this.getScaleX();var n=this.getScaleY();if(this.rotation||i&&i!==1||n&&n!==1){var r=e.x;var a=e.y;t.translate(r,a);if(i&&n){t.scale(i,n)}if(this.rotation){t.rotate(this.rotation)}t.translate(-r,-a)}return};UIMenu.prototype.shapeCanBeChild=function(t){return t.isUIListItem||t.isUIButton||t.isUIImage};function UIMenuCreator(){var t=["ui-menu","ui-menu",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMenu;return e.initUIMenu(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIMenuCreator);function UIPage(){return}UIPage.prototype=new UIElement;UIPage.prototype.isUIPage=true;UIPage.prototype.initUIPage=function(t,e){this.initUIElement(t);this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,e);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;if(!e){this.style.setFillColor("Gold")}return this};UIPage.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIPage.prototype.hide=function(){this.setVisible(false);this.hideHTML();cantkHideAllInput();return};UIPage.prototype.shapeCanBeChild=function(t){if(t.isUIDevice||t.isUIScreen||t.isUIStatusBar||t.isUIWindow||t.isUIPage){return false}if(t.isUIPageIndicator&&!this.isUIPageExt){return false}return true};UIPage.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};function UIPageCreator(t){var e=["ui-page","ui-page",null,1];ShapeCreator.apply(this,e);this.createShape=function(e){var i=new UIPage;return i.initUIPage(this.type,t)};return}ShapeFactoryGet().addShapeCreator(new UIPageCreator(null));function UICircleLayout(){return}UICircleLayout.prototype=new UIElement;UICircleLayout.prototype.isUILayout=true;UICircleLayout.prototype.isUICircleLayout=true;UICircleLayout.O_CENTER="c";UICircleLayout.O_TOP_LEFT="tl";UICircleLayout.O_TOP_MIDDLE="tm";UICircleLayout.O_TOP_RIGHT="tr";UICircleLayout.O_LEFT_MIDDLE="lm";UICircleLayout.O_RIGHT_MIDDLE="rm";UICircleLayout.O_BOTTOM_LEFT="bl";UICircleLayout.O_BOTTOM_MIDDLE="bm";UICircleLayout.O_BOTTOM_RIGHT="br";UICircleLayout.prototype.initUICircleLayout=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);this.origin=UICircleLayout.O_CENTER;this.setSizeLimit(120,120,1e3,1e3,1);return this};UICircleLayout.prototype.shapeCanBeChild=function(t){if(t.isUIImage||t.isUIButton){return true}return false};UICircleLayout.prototype.paintSelfOnly=function(t){if(this.isInDesignMode()){t.lineWidth=this.style.lineWidth;switch(this.origin){case UICircleLayout.O_CENTER:{var e=this.w>>1;var i=this.h>>1;var n=(this.w>>1)-30;var r=this.children.length?this.children.length:6;var a=r>1?2*Math.PI/(r-1):0;t.beginPath();t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;t.arc(e,i,n,0,Math.PI*2);t.stroke();var o=-.5*Math.PI;for(var s=0;s<r;s++){t.beginPath();if(s==0){t.arc(e,i,10,0,Math.PI*2);t.stroke()}else{var l=a*(s-1)+o;var h=e+n*Math.cos(l);var u=i+n*Math.sin(l);t.arc(h,u,10,0,Math.PI*2);t.stroke()}}t.stroke();break}default:break}}return};UICircleLayout.prototype.moveShapeToCenter=function(t,e,i){e=e-(t.w>>1);i=i-(t.h>>1);t.move(e,i);return};UICircleLayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}switch(this.origin){case UICircleLayout.O_CENTER:{var t=this.w>>1;var e=this.h>>1;var i=(this.w>>1)-30;var n=this.children.length-1;var r=n>0?2*Math.PI/n:0;var a=-.5*Math.PI;for(var o=0;o<this.children.length;o++){var s=this.children[o];if(o==0){this.moveShapeToCenter(s,t,e)}else{var l=r*(o-1)+a;var h=t+i*Math.cos(l);var u=e+i*Math.sin(l);this.moveShapeToCenter(s,h,u)}}break}default:break}return};UICircleLayout.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_FIX_TOP;t.xAttr=UIElement.X_FIX_LEFT;t.widthAttr=UIElement.WIDTH_SCALE;t.heightAttr=UIElement.HEIGHT_SCALE;t.setUserMovable(true);t.setUserResizable(true);t.setCanRectSelectable(false,true);this.relayoutChildren();return true};function UICircleLayoutCreator(t,e,i){var n=["ui-circle-layout","ui-circle-layout",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UICircleLayout;return r.initUICircleLayout(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UICircleLayoutCreator(400,400));function UIGrid(){return}UIGrid.prototype=new UIElement;UIGrid.prototype.isUIGrid=true;UIGrid.prototype.isUILayout=true;UIGrid.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.cols=this.cols;t.rows=this.rows;t.spacer=this.spacer;t.scrollDirection=this.scrollDirection;return t};UIGrid.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.cols=t.cols;this.rows=t.rows;this.spacer=t.spacer;this.scrollDirection=t.scrollDirection;return t};UIGrid.prototype.initUIGrid=function(t){this.initUIElement(t);this.spacer=0;this.offset=0;this.setMargin(0,0);this.setDefSize(200,200);this.rows=3;this.cols=3;this.checkable=false;this.rectSelectable=false;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.setImage(UIElement.IMAGE_CHECKED_ITEM,null);this.addEventNames(["onChildDragged","onChildDragging","onInit"]);return this};UIGrid.prototype.setRows=function(t){this.rows=t;return this};UIGrid.prototype.getRows=function(){return this.rows};UIGrid.prototype.setCols=function(t){this.cols=t;return this};UIGrid.prototype.getCols=function(){return this.cols};UIGrid.prototype.isCheckable=function(t){return this.checkable};UIGrid.prototype.setCheckable=function(t){this.checkable=t;return this};UIGrid.prototype.setChildChecked=function(t,e){if(t>=0&&t<this.children.length){this.children[t].checked=e}return this};UIGrid.prototype.isChildChecked=function(t){if(t<this.children.length){return this.children[t].checked}return false};UIGrid.prototype.getChildByRowCol=function(t,e){var i=this.getCols();var n=t*i+e;if(n<this.children.length){return this.children[n]}else{return null}};UIGrid.prototype.getChildRow=function(t){var e=this.getCols();var i=this.children.indexOf(t);return Math.floor(i/e)};UIGrid.prototype.getChildCol=function(t){var e=this.getCols();var i=this.children.indexOf(t);return i%e};UIGrid.prototype.exchangeTwoChildren=function(t,e,i){var n=this.children.length;if(t<0||t>=n||e<0||e>=n){return this}var r=this.children[t];this.children[t]=this.children[e];this.children[e]=r;this.relayoutChildren(i);return this};UIGrid.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIGrid.prototype.childIsBuiltin=function(t){return t.name==="ui-last"};UIGrid.prototype.calcItemSize=function(){var t=this.getWidth(true);var e=this.getHeight(true);var i=Math.floor(t/this.cols);var n=Math.floor(e/this.rows);return{w:i,h:n,cols:this.cols,rows:this.rows}};UIGrid.prototype.sortChildren=function(){};UIGrid.prototype.getChildIndexByPoint=function(t){var e=this.getHMargin();var i=this.calcItemSize();var n=this.spacer;var r=this.getWidth(true);var a=this.getHeight(true);var o=i.w+n;var s=i.h+n;var l=Math.floor(r/o);var h=Math.floor(a/s);var u=Math.floor((t.y-e)/i.h);var c=Math.floor((t.x-e)/i.w);var p=u*l+c;return p};UIGrid.prototype.onChildDragging=function(t,e){var i=this.getChildIndexByPoint(e);var n=this.getIndexOfChild(t);this.callOnChildDraggingHandler(n,i);return};UIGrid.prototype.onChildDragged=function(t,e){var i=this.getChildIndexByPoint(e);var n=this.getIndexOfChild(t);this.callOnChildDraggedHandler(n,i);this.relayoutChildren("default");return};UIGrid.prototype.relayoutChildren=function(t){if(this.disableRelayout){return}var e=0;var i=0;var n=0;var r=0;var a=this.cols;var o=this.rows;var s=this.spacer;var l=this.getWidth(true);var h=this.getHeight(true);var u=Math.floor((l-(a-1)*s)/a);var c=Math.floor((h-(o-1)*s)/o);var p=u+s;var f=c+s;var m=this.h-o*f>>1;var d=this.w-a*p>>1;var y=0;var v=this.children.length;var g=this.children;for(var _=0;_<v;_++){var I=g[_];I.z=_;if(I.removed||!I.visible)continue;e=Math.floor(y/a);i=Math.floor(y%a);n=d+i*p;r=m+e*f;I.setSize(u,c);if(t||this.isInDesignMode()){I.animMove(n,r,t)}else{I.move(n,r)}I.xAttr=UIElement.X_FIX_LEFT;I.yAttr=UIElement.Y_FIX_TOP;I.widthAttr=UIElement.WIDTH_FIX;I.heightAttr=UIElement.HEIGHT_FIX;I.setUserMovable(true);I.setUserResizable(false);I.relayoutChildren();if(!this.isUIScrollView){I.setDraggable(this.itemDraggable)}y++}return};UIGrid.prototype.afterChildAppended=function(t){if(this.isInDesignMode()&&!this.disableRelayout){this.sortChildren()}this.moveMustBeLastItemToLast();t.setUserMovable(true);t.setUserResizable(false);t.setCanRectSelectable(false,true);t.setDraggable(this.itemDraggable);t.xAttr=UIElement.X_FIX_LEFT;t.yAttr=UIElement.Y_FIX_TOP;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FIX;if(this.isInDesignMode()&&!this.disableRelayout){this.relayoutChildren()}return true};UIGrid.prototype.triggerDeleteMode=function(){if(this.isInDesignMode()){return}this.deleteMode=!this.deleteMode;var t=this;function e(){t.postRedraw();if(t.deleteMode){setTimeout(e,20)}}e();return};UIGrid.prototype.isInDeleteMode=function(){return this.deleteMode&&!this.isInDesignMode()};UIGrid.prototype.beforePaintChild=function(t,e){if(this.isInDeleteMode()){e.save();var i=t.left+t.w/2;var n=t.top+t.h/2;var r=e.now/1e3;var a=.03*Math.cos(20*r);e.translate(i,n);e.rotate(a);e.translate(-i,-n)}return;
};UIGrid.prototype.afterPaintChild=function(t,e){if(this.isInDeleteMode()){var i=this.getImageByType(UIElement.IMAGE_DELETE_ITEM);if(WImage.isValid(i)){var n=i.getImage();var r=i.getImageRect();var a=t.top+t.vMargin;var o=t.left+t.w-r.w-t.hMargin;e.drawImage(n,o,a);WImage.draw(e,n,WImage.DISPLAY_CENTER,o,a,r.w,r.h,r)}e.restore();return}if(this.checkable){if(t.checked){var i=this.getImageByType(UIElement.IMAGE_CHECKED_ITEM);if(WImage.isValid(i)){var n=i.getImage();var r=i.getImageRect();WImage.draw(e,n,WImage.DISPLAY_AUTO_SIZE_DOWN,t.left,t.top,t.w,t.h,r)}}}return};function UIGridCreator(t){var e=["ui-grid","ui-grid",null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIGrid;return e.initUIGrid(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridCreator);function UIGridView(){return}UIGridView.prototype=new UIVScrollView;UIGridView.prototype.isUIGrid=true;UIGridView.prototype.isUILayout=true;UIGridView.prototype.isUIGridView=true;UIGridView.prototype.doToJson=UIGrid.prototype.doToJson;UIGridView.prototype.doFromJson=UIGrid.prototype.doFromJson;UIGridView.prototype.sortChildren=UIGrid.prototype.sortChildren;UIGridView.prototype.initUIGrid=UIGrid.prototype.initUIGrid;UIGridView.prototype.shapeCanBeChild=UIGrid.prototype.shapeCanBeChild;UIGridView.prototype.childIsBuiltin=UIGrid.prototype.childIsBuiltin;UIGridView.prototype.paintSelfOnly=UIGrid.prototype.paintSelfOnly;UIGridView.prototype.calcItemSize=UIGrid.prototype.calcItemSize;UIGridView.prototype.relayoutChildren=UIGrid.prototype.relayoutChildren;UIGridView.prototype.afterChildAppended=UIGrid.prototype.afterChildAppended;UIGridView.prototype.isInDeleteMode=UIGrid.prototype.isInDeleteMode;UIGridView.prototype.beforePaintChild=UIGrid.prototype.beforePaintChild;UIGridView.prototype.afterPaintChild=UIGrid.prototype.afterPaintChild;UIGridView.prototype.triggerDeleteMode=UIGrid.prototype.triggerDeleteMode;UIGridView.prototype.setCheckable=UIGrid.prototype.setCheckable;UIGridView.prototype.setChildChecked=UIGrid.prototype.setChildChecked;UIGridView.prototype.isChildChecked=UIGrid.prototype.isChildChecked;UIGridView.prototype.initUIGridView=function(t){this.initUIGrid(t);this.initUIVScrollView(t,0,null,null);this.setImage(UIElement.IMAGE_DELETE_ITEM,null);this.setImage(UIElement.IMAGE_CHECKED_ITEM,null);return this};UIGridView.prototype.onModeChanged=function(){this.offset=0;return};function UIGridViewCreator(){var t=["ui-grid-view","ui-grid-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGridView;return e.initUIGridView(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIGridViewCreator);function UIImageValue(){return}UIImageValue.prototype=new UIImage;UIImageValue.prototype.isUIImageValue=true;UIImageValue.prototype.initUIImageValue=function(t,e,i){this.initUIImage(t,e,i,null);this.value=0;return this};UIImageValue.prototype.getImageSrcByValue=function(t){var e="option_image_"+t;return this.getImageSrcByType(e)};UIImageValue.prototype.getValue=function(){return this.value};UIImageValue.prototype.setValue=function(t){var e=this.getImageSrcByValue(t);if(e){this.value=t;this.setImage(UIElement.IMAGE_DEFAULT,e)}return this.value};UIImageValue.prototype.inc=function(){var t=this.value+1;return this.setValue(t)};UIImageValue.prototype.dec=function(){var t=this.value-1;return this.setValue(t)};UIImageValue.prototype.getImages=function(){var t="";for(var e in this.images){var i=this.images[e];if(e.indexOf("option_image_")>=0&&i&&i.src){t+=i.src+"\n"}}return t};UIImageValue.prototype.setImages=function(t){var e=this.images.display;this.images={};this.images.display=e;if(t){var i=0;var n=0;var r=t.split("\n");for(var i=0;i<r.length;i++){var a=r[i];if(!a)continue;if(a.indexOf("/")===0){a=a.substr(1)}var o="option_image_"+n++;this.setImage(o,a)}this.setValue(this.value)}return this};UIImageValue.prototype.shapeCanBeChild=function(t){return false};function UIImageValueCreator(t,e,i){var n=["ui-image-value","ui-image-value",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIImageValue;return r.initUIImageValue(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIImageValueCreator(200,200,null));function UIImageThumbView(){return}UIImageThumbView.prototype=new UIImageView;UIImageThumbView.prototype.isUIImageThumbView=true;UIImageThumbView.prototype.saveProps=["keepRatio","itemSize"];UIImageThumbView.prototype.initUIImageThumbView=function(t,e){this.userImages=[];this.imageProxies=[];this.itemSize=0;this.setDefSize(t,e);this.initUIImageView(t,e);this.setItemSize=UIImageThumbView.prototype.setItemSize;this.getCacheCanvas=UIImageThumbView.prototype.getCacheCanvas;this.getCacheCanvasContext=UIImageThumbView.prototype.getCacheCanvasContext;this.setValue=UIImageThumbView.prototype.setValue;this.getCurrentImage=UIImageThumbView.prototype.getCurrentImage;this.getCurrentImageSrc=UIImageThumbView.prototype.getCurrentImageSrc;imageThumbViewInitCustomProp(this);this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);this.addEventNames(["onChanged"]);return this};UIImageThumbView.prototype.setItemSize=function(t){this.itemSize=t?t:100;if(t){this.setSizeLimit(100,t+10,2e3,2e3)}return};UIImageThumbView.prototype.setKeepRatio=function(t){if(this.keepRatio!=t){this.cacheInvalid=true}this.keepRatio=t;return};UIImageThumbView.prototype.getCacheCanvasContext=function(t,e){if(!this.cacheImagesCanvas){canvas=document.createElement("canvas");canvas.width=t;canvas.height=e;this.cacheImagesCanvas=canvas}if(canvas.width!=t){canvas.width=t}if(canvas.height!=e){canvas.height=e}var i=canvas.getContext("2d");i.clearRect(0,0,t,e);return i};UIImageThumbView.prototype.getCurrentImageSrc=function(){return this.currentImageProxy?this.currentImageProxy.src:null};UIImageThumbView.prototype.getCurrentImage=function(){return this.currentImageProxy?this.currentImageProxy.image:null};UIImageThumbView.prototype.setValue=function(t){for(var e=0;e<this.imageProxies.length;e++){var i=this.imageProxies[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){this.currentImageProxy=i;return this}}return this};UIImageThumbView.createImageProxy=function(t,e,i,n,r,a,o,s,l){var h={};h.x=a;h.y=o;h.w=s;h.h=l;h.src=e;h.imageState=UIImageView.IMAGE_STATE_PENDING;function u(e,i){var a=t.keepRatio;if(i){h.imageState=UIImageView.IMAGE_STATE_DONE;UIImageView.drawImageAtCenter(r,e,h.x,h.y,h.w,h.h,a)}else{h.imageState=UIImageView.IMAGE_STATE_ERROR;UIImageView.drawImageAtCenter(r,n,h.x,h.y,h.w,h.h,a)}console.log("onLoadDone: "+e.src);t.postRedraw()}h.image=UIImageView.createImage(e,u);if(h.imageState===UIImageView.IMAGE_STATE_PENDING){var c=t.keepRatio;UIImageView.drawImageAtCenter(r,i,h.x,h.y,h.w,h.h,c)}return h};UIImageThumbView.prototype.createCacheCanvas=function(){};UIImageThumbView.prototype.getCacheCanvas=function(){if(this.cacheInvalid||!this.cacheImagesCanvas){this.createCacheCanvas()}return this.cacheImagesCanvas};function UIImageThumbViewTape(){return}UIImageThumbViewTape.prototype=new UIHScrollView;UIImageThumbViewTape.prototype.isUIImageView=true;UIImageThumbViewTape.prototype.isUIImageThumbView=true;UIImageThumbViewTape.prototype.isUIImageThumbViewTape=true;UIImageThumbViewTape.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewTape.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewTape.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewTape.prototype.initUIImageThumbViewTape=function(t,e,i){this.initUIHScrollView(t,10,null);this.initUIImageThumbView(e,i);this.heightAttr=UIElement.HEIGHT_FIX;return this};UIImageThumbViewTape.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewTape.prototype.createCacheCanvas=function(){var t=this.getSpaceBetweenImages();var e=this.w;var i=this.h;var n=this.itemSize>0&&this.itemSize<i?this.itemSize:i;var r=this.cacheImagesCanvas;var a=this.userImages.length;delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;if(!a){return}e=a*(n+t);var o=0;var s=Math.floor((i-n)/2);var l=this.errorImage;var h=this.loadingImage;var u=this.getCacheCanvasContext(e,i);for(var c=0;c<this.userImages.length;c++){var p=this.userImages[c];var f=UIImageThumbView.createImageProxy(this,p,h,l,u,o,s,n,n);this.imageProxies.push(f);o=o+n+t}return};UIImageThumbViewTape.prototype.getScrollRange=function(){var t=this.h;var e=this.getSpaceBetweenImages();var i=this.userImages.length*(t+e)+e;return i};UIImageThumbViewTape.prototype.paintChildren=function(t){return};UIImageThumbViewTape.prototype.getCacheCanvasOffset=function(){var t=Math.max(0,(this.w-this.cacheImagesCanvas.width)/2);return t};UIImageThumbViewTape.prototype.onClick=function(t,e){if(!this.imageProxies||!this.imageProxies.length||e){return}this.currentImageProxy=null;var i=t.x-this.getCacheCanvasOffset();for(var n=0;n<this.imageProxies.length;n++){var r=this.imageProxies[n];if(i>=r.x&&i<r.x+r.w){this.currentImageProxy=r}}this.callOnClickHandler(t);this.callOnChangedHandler(this.getCurrentImageSrc());return};UIImageThumbViewTape.prototype.paintSelfOnly=function(t){if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){t.rect(0,0,this.w,this.h);t.stroke();return}var e=0;var i=0;var n=this.h;var r=this.w;var a=this.getCacheCanvas();var o=this.getCacheCanvasOffset();var s=o;t.rect(0,0,this.w,this.h);t.clip();t.beginPath();if(this.offset>=0){if(s>this.offset){s=s-this.offset;var e=a.width;t.drawImage(this.cacheImagesCanvas,0,0,e,n,s,i,e,n);o=s}else{var l=this.offset-s;var e=Math.min(r,a.width-l);t.drawImage(this.cacheImagesCanvas,l,0,e,n,0,i,e,n);o=-l}}else{s=s-this.offset;var e=Math.min(r+this.offset,a.width);t.drawImage(this.cacheImagesCanvas,0,0,e,n,s,i,e,n);o=s}if(this.currentImageProxy){s=o+this.currentImageProxy.x;i=this.currentImageProxy.y;t.lineWidth=3;t.rect(s,i,this.currentImageProxy.w,this.currentImageProxy.h);t.stroke()}return};function UIImageThumbViewTapeCreator(){var t=["ui-image-thumb-view-tape","ui-image-thumb-view-tape",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageThumbViewTape;return e.initUIImageThumbViewTape(this.type,300,100)};return}function UIImageThumbViewGrid(){return}UIImageThumbViewGrid.prototype=new UIHScrollView;UIImageThumbViewGrid.prototype.isUIImageView=true;UIImageThumbViewGrid.prototype.isUIImageThumbView=true;UIImageThumbViewGrid.prototype.isUIImageThumbViewGrid=true;UIImageThumbViewGrid.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewGrid.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewGrid.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewGrid.prototype.initUIImageThumbViewGrid=function(t,e,i){this.initUIHScrollView(t,10,null);this.initUIImageThumbView(e,i);this.setSizeLimit(100,40,2e3,2e3);this.rows=4;this.cols=3;this.pageNr=1;this.itemSize=100;return this};UIImageThumbViewGrid.prototype.calcSize=function(){if(!this.userImages){return}if(this.isIcon){this.cols=3;this.rows=4;this.pageNr=1;return}var t=this.userImages.length;var e=this.getDeviceConfig();var i=e?e.lcdDensity:"hdpi";var n=this.getDensitySizeByName(i)/160;var r=this.w/n;var a=this.h/n;var o=Math.round(r/this.itemSize);var s=Math.round(a/this.itemSize);this.cols=o;this.rows=s;this.pageNr=Math.ceil(t/(s*o));return};UIImageThumbViewGrid.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewGrid.prototype.createCacheCanvas=function(){var t=this.userImages.length;var e=this.getSpaceBetweenImages();delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;this.calcSize();if(!t){return}var i=0;var n=0;var r=0;var a=this.h;var o=this.pageNr*this.w;var s=this.getCacheCanvasContext(o,a);var l=Math.floor((this.w-e)/this.cols)-e;var h=Math.floor((this.h-e)/this.rows)-e;var u=this.errorImage;var c=this.loadingImage;for(var p=0;p<this.pageNr;p++){n=e;for(var f=0;f<this.rows;f++){i=p*this.w+e;for(var m=0;m<this.cols;m++,r++){if(r>=t){break}var d=this.userImages[r];var y=UIImageThumbView.createImageProxy(this,d,c,u,s,i,n,l,h);this.imageProxies.push(y);i=i+l+e}n=n+h+e}}return};UIImageThumbViewGrid.prototype.getScrollRange=function(){var t=this.pageNr*this.w;return t};UIImageThumbViewGrid.prototype.paintChildren=function(t){return};UIImageThumbViewGrid.prototype.getCacheCanvasOffset=function(){return this.getSpaceBetweenImages()};UIImageThumbViewGrid.prototype.onClick=function(t,e){if(!this.imageProxies||!this.imageProxies.length||e){return}var i=t.x;var n=t.y;var r=this.imageProxies.length;var a=Math.floor(i/this.w);var o=Math.floor(n*this.rows/this.h);var s=Math.floor(i%this.w*this.cols/this.w);var l=a*this.rows*this.cols+o*this.cols+s;if(l<r){this.currentImageProxy=this.imageProxies[l]}this.callOnClickHandler(t);this.callOnChangedHandler(this.getCurrentImageSrc());return this.callOnClickHandler(t)};UIImageThumbViewGrid.prototype.paintSelfOnly=function(t){var e=this.getSpaceBetweenImages();if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){t.rect(0,0,this.w,this.h);t.stroke();return}var i=0;var n=this.w;var r=this.offset;var a=this.getCacheCanvas();var o=a.height;var s=a.width;if(r>=0){var i=Math.min(n,s-r);t.drawImage(this.cacheImagesCanvas,r,0,i,o,0,0,i,o)}else{var i=Math.min(s+r,n);t.drawImage(this.cacheImagesCanvas,0,0,i,o,-r,0,i,o)}if(this.currentImageProxy){y=this.currentImageProxy.y;x=this.currentImageProxy.x-r;t.rect(x,y,this.currentImageProxy.w,this.currentImageProxy.h);t.lineWidth=3;t.strokeStyle=this.style.lineColor;t.stroke()}return};UIImageThumbViewGrid.prototype.saveProps=UIImageThumbView.prototype.saveProps;UIImageThumbViewTape.prototype.saveProps=UIImageThumbView.prototype.saveProps;function UIImageThumbViewGridCreator(){var t=["ui-image-thumb-view-grid","ui-image-thumb-view-grid",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageThumbViewGrid;return e.initUIImageThumbViewGrid(this.type,300,100)};return}ShapeFactoryGet().addShapeCreator(new UIImageThumbViewTapeCreator);ShapeFactoryGet().addShapeCreator(new UIImageThumbViewGridCreator);function UILayout(){return}UILayout.prototype=new UIElement;UILayout.prototype.isUILayout=true;UILayout.prototype.initUILayout=function(t,e,i){this.initUIElement(t);this.spacer=10;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);this.vLayout=this.type==="ui-v-layout";this.addEventNames(["onInit"]);return this};UILayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var t=this.w;var e=this.h;var i=this.hMargin;var n=this.vMargin;var r=this.vLayout;var a=this.spacer?this.spacer:0;var o=this.children.length;var s=this.children;for(var l=0;l<o;l++){var h=s[l];if(!h.isVisible()){continue}if(r){h.top=n;h.left=t-h.w>>1;if(h.heightAttr===UIElement.HEIGHT_SCALE){h.h=h.heightParam*e}n+=h.h+a}else{h.left=i;h.top=e-h.h>>1;if(h.widthAttr===UIElement.WIDTH_SCALE){h.w=h.widthParam*t}i+=h.w+a}h.relayoutChildren()}return};function UILayoutCreator(t){var e=[t,t,null,true];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UILayout;return e.initUILayout(this.type,100,100)};return}UILayout.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;ShapeFactoryGet().addShapeCreator(new UILayoutCreator("ui-v-layout"));ShapeFactoryGet().addShapeCreator(new UILayoutCreator("ui-h-layout"));function UIFrames(){return}UIFrames.prototype=new UIElement;UIFrames.prototype.isUIFrames=true;UIFrames.prototype.saveProps=["current"];UIFrames.prototype.initUIFrames=function(t){this.initUIElement(t);this.current=0;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.addEventNames(["onChanged"]);return this};UIFrames.preparseBackendCanvas=function(t,e){var i=t.w;var n=t.h;var r=Animation.getBackendCanvas(2*i,n);var a=r.getContext("2d");a.now=Date.now();a.timeStep=0;a.clearRect(0,0,2*i,n);a.save();t.paint(a);a.translate(i,0);e.paint(a);a.restore();return r};UIFrames.prototype.getStatusString=function(){var t="";var e=this.current+1;var i=this.children.length;var n=this.getCurrentFrame();e=e<=i?e:i;if(n&&n.name){t=n.name+"("+e+"/"+i+")"}else{t=e+"/"+i}return t};UIFrames.prototype.getCurrent=function(){return this.current};UIFrames.prototype.setCurrent=function(t){if(this.current!==t){this.current=t;if(!this.isInDesignMode()){this.callOnChangedHandler(t)}}return this};UIFrames.prototype.getCurrentFrame=function(){if(this.children.length<1){return null}if(this.current<0||!this.current){this.current=0}if(this.current>=this.children.length){this.current=this.children.length-1}return this.children[this.current]};UIFrames.prototype.fixChildSize=function(t){return};UIFrames.prototype.fixChildPosition=function(t){var e=t.left;var i=t.top;var n=t.h;var r=t.w;if(t.freePosition){return}if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){e=this.getHMargin();r=this.getWidth(true)}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){i=this.getVMargin();n=this.getHeight(true)}t.left=e;t.top=i;t.h=n;t.w=r;return};UIFrames.prototype.setTarget=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(!t){i.setSelected(false);continue}if(i!=t&&i!=t.popupWindow){i.setSelected(false)}}this.targetShape=t;this.selected=!t;return};UIFrames.prototype.dispatchPointerDownToChildren=function(t){var e=null;if(this.children.length<1){return false}e=this.getCurrentFrame();if(e.onPointerDown(t)){this.setTarget(e);return true}return false};UIFrames.prototype.addShapeIntoChildren=function(t,e){var i=null;if(this.children.length<1){return false}i=this.getCurrentFrame();return i.addShape(t,true,e)};UIFrames.prototype.paintChildren=function(t){var e=this.getCurrentFrame();if(e){t.save();t.beginPath();e.paintSelf(t);t.restore()}return};UIFrames.prototype.showNextFrame=function(){this.showFrame(this.current+1);this.relayoutChildren();return};UIFrames.prototype.getFrame=function(t){if(t<0||t>=this.children.length){return null}return this.children[t]};UIFrames.prototype.getFrameIndex=function(t){return this.getIndexOfChild(t)};UIFrames.prototype.getFrames=function(){return this.children.length};UIFrames.prototype.showPrevFrame=function(){this.showFrame(this.current-1);this.relayoutChildren();return};UIFrames.prototype.showFrame=function(t){var e=(t+this.children.length)%this.children.length;this.setCurrent(e);var i=this.children[this.current];if(i){i.show(true)}return};UIFrames.prototype.shapeCanBeChild=function(t){return true};UIFrames.prototype.relayoutChildren=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.left=0;e.top=0;e.w=this.w;e.h=this.h;e.widthAttr=UIElement.WIDTH_FILL_PARENT;e.heightAttr=UIElement.HEIGHT_FILL_PARENT;e.relayoutChildren()}return};UIFrames.prototype.afterChildAppended=function(t){this.current=this.children.length-1;return};UIFrames.prototype.onChildRemoved=function(t){return};UIFrames.prototype.afterChildRemoved=function(t){if(this.children.length===0){this.current=0}else if(this.current>=this.children.length){this.current--}this.onChildRemoved(t);return};UIFrames.prototype.findChildByPoint=function(t,e){var i=t;var n=this.getCurrentFrame();if(n){var r=n.findChildByPoint(i,e);if(r===n&&!n.hitTest(i)){return this}return r}return this};function UIFramesCreator(){var t=["ui-frames","ui-frames",null,0];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFrames;return e.initUIFrames(this.type)};return}function UICheckBox(){return}UICheckBox.prototype=new UIElement;UICheckBox.prototype.isUICheckBox=true;UICheckBox.prototype.initUICheckBox=function(t){this.initUIElement(t);this.setDefSize(100,100);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.setImage(UIElement.IMAGE_CHECKED_FG,null);this.setImage(UIElement.IMAGE_UNCHECK_FG,null);this.addEventNames(["onChanged","onUpdateTransform"]);this.value=false;return this};UICheckBox.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUILabel};UICheckBox.prototype.getValue=function(){return this.value};UICheckBox.prototype.setValue=function(t,e){if(this.value!=t){this.value=t;if(e){this.callOnChangedHandler(this.value)}}return this};UICheckBox.prototype.getBgImage=function(){return this.getImageByType(this.getValue()?UIElement.IMAGE_CHECKED_FG:UIElement.IMAGE_UNCHECK_FG)};UICheckBox.prototype.getTextColor=function(t){return this.getValue()?this.style.textColorOn:this.style.textColor};UICheckBox.prototype.onClick=function(t,e){if(e){return}this.setValue(!this.getValue(),true);this.callOnClickHandler(t);return};function UICheckBoxCreator(){var t=["ui-checkbox","ui-checkbox",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UICheckBox;return e.initUICheckBox(this.type)};return}ShapeFactoryGet().addShapeCreator(new UICheckBoxCreator);function UISwitch(){return}UISwitch.prototype=new UICheckBox;UISwitch.prototype.isUISwitch=true;UISwitch.prototype.initUISwitch=function(t,e,i,n,r){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,r);this.value=true;this.imageWidth=412;this.maskWidth=n;this.offsetImage=n;this.addEventNames(["onChanged"]);this.interpolator=new DecelerateInterpolator(2);return this};UISwitch.prototype.updateImageSize=function(t){this.imageWidth=t;this.maskWidth=Math.floor(t*.373786);if(!this.animating){this.offsetImage=this.value?this.maskWidth:this.imageWidth-this.maskWidth}return};UISwitch.prototype.animateChange=function(){var t=this;var e=new Date;var i=e.getTime();var n=this.offsetImage;var r=this.value?this.maskWidth:this.imageWidth-this.maskWidth;var a=r-n;this.animating=true;var o=500;function s(){var e=new Date;var l=e.getTime();var h=(l-i)/o;var u=t.interpolator.get(h);var c=n+a*u;if(h<1){t.offsetImage=c;setTimeout(s,10)}else{t.offsetImage=r;delete this.animating}t.postRedraw();delete e;return}setTimeout(s,30);return};UISwitch.prototype.onClick=function(t,e){if(e||!this.isInDesignMode()){return}this.setValue(!this.value);return};UISwitch.prototype.onPointerDownRunning=function(t,e){if(e){return}this.pointerDownPosition=t;return};UISwitch.prototype.onPointerUpRunning=function(t,e){if(e){return}var i=t.x-this.pointerDownPosition.x;if(Math.abs(i)<5){this.setValue(!this.value)}else{this.setValue(i>0)}return};UISwitch.prototype.setValue=function(t){if(this.value!=t){this.value=t;this.callOnChangedHandler(this.value);this.animateChange()}return this};UISwitch.prototype.drawBgImage=function(t){return};UISwitch.prototype.drawFgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(e){this.updateImageSize(e.width);var i=e.height;var n=this.maskWidth;var r=(this.w-n)/2;var a=(this.h-i)/2;this.imageWidth=e.width;t.drawImage(e,this.offsetImage,0,n,i,r,a,n,i);t.drawImage(e,0,0,n,i,r,a,n,i)}return};function UISwitchCreator(t,e,i,n){var r=["ui-switch","ui-switch",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var a=new UISwitch;return a.initUISwitch(this.type,t,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UISwitchCreator(154,54,154,null));function UISimpleHTML(){return}UISimpleHTML.prototype=new UIVScrollView;UISimpleHTML.prototype.isUISimpleHTML=true;UISimpleHTML.prototype.saveProps=["scrollable"];UISimpleHTML.prototype.initUISimpleHTML=function(t,e,i){this.initUIVScrollView(t,10,i,null);this.setText(e);this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,i);return this};UISimpleHTML.prototype.extractHtmlElements=function(t,e){var i=0;var n=null;var r=this;var a=t.localName;var o=t.childNodes.length;var s=t.childNodes;function l(t){var e={x:0,y:0};e.type=t;return e}if(a==="b"){this.bold=this.bold+1}else if(a==="i"){this.italic=this.italic+1}else if(a==="u"){this.underline=this.underline+1}else if(a==="a"){this.anchor=this.anchor+1}else if(a==="ol"||a==="ul"){if(e>0){n=l("newline")}}else if(a==="li"){n=l("text");if(t.parentNode.localName==="ol"){n.value="    "+(e+1)+". "}else{n.value="    o. "}n.bold=true;n.color="gray";n.fontStyle="bold "}var h=null;if(t.style&&t.style.color){h=t.style.color}if(!h&&t.getAttribute){h=t.getAttribute("color")}if(!h&&this.colors.length){h=this.colors[this.colors.length-1]}this.colors.push(h||"black");if(n){n.tag=a;this.elements.push(n);n=null}for(var i=0;i<o;i++){var u=s[i];this.extractHtmlElements(u,i)}if(a==="img"&&t.src){var c=t.src;var p=new Image;p.onload=function(t){n.imageLoaded=true;r.textNeedRelayout=true;return};p.onerror=function(t){n.imageLoaded=false;if(c){console.log("load "+c+" failed.")}};p.onabort=function(t){n.imageLoaded=false;if(c){console.log("load "+c+" failed(abort).")}};p.src=c;n=l("img");n.value=p;n.displayWidth=t.width;n.displayHeight=t.height}else if(!o&&t.textContent){var f=t.textContent.replace(/(\t|\n|\r)+/g,"");var m=f.replace(/ +/g," ");if(m){n=l("text");n.value=m;n.bold=this.bold;n.italic=this.italic;n.underline=this.underline;n.anchor=this.anchor;n.fontStyle="";if(this.colors.length){n.color=this.colors[this.colors.length-1]}if(n.bold){n.fontStyle=n.fontStyle+"bold "}if(n.italic){n.fontStyle=n.fontStyle+"italic "}}}if(a==="b"){this.bold=this.bold-1}if(a==="i"){this.italic=this.italic-1}if(a==="u"){this.underline=this.underline-1}if(a==="a"){n=l("a");n.href=t.href;this.anchor=this.anchor-1}if(a==="p"||t.style!=null&&t.style.display==="block"){n=l("newblock")}else if(a==="li"||a==="br"||a==="hr"||a==="dd"){n=l("newline")}this.colors.pop();if(n){n.tag=a;this.elements.push(n)}return};UISimpleHTML.prototype.getNodeByPoint=function(t){var e=0;var i=t.x;var n=t.y;var r=null;var a=null;var o={};var s=this.elements.length;var l=this.elements;for(e=0;e<s;e++){r=l[e];a=e+1<s?l[e+1]:null;if(n<r.y){continue}if(a&&(n>a.y&&r.y<a.y)){continue}if(r.type==="text"){var h=0;var u=r.lines.length;o.h=r.lineHeight;for(h=0;h<u;h++){o.x=0;o.y=r.y+h*r.lineHeight;if(h===0){o.x=r.x;o.w=r.firstLineWidth}else if(h+1===u){o.w=r.lastLineWidth}else{o.w=this.w}if(isPointInRect(t,o)){return r}}}else if(r.type==="img"){o.x=r.x;o.y=r.y;o.w=r.w;o.h=r.h;if(isPointInRect(t,o)){return r}}}return r};UISimpleHTML.prototype.layoutHtmlElements=function(t){var e=0;var i=0;var n=0;var r=null;var a=0;var o=null;var s=this.elements.length;var l=this.elements;var h=this.getWidth(true);var u=this.style.fontSize;var c=new TextLayout(t);var p=u+"pt "+this.style.fontFamily;var f=u*2;t.font=p;for(e=0;e<s;e++){r=l[e];if(r.type==="text"){r.lines=[];r.x=i;r.y=n;r.firstLineWidth=0;t.font=r.fontStyle+p;r.lineHeight=f;c.setText(r.value);while(true){a=h-i;if(c.hasNext()){o=c.nextLine(a,u);r.lines.push(o.text);if(r.lines.length===1){r.firstLineWidth=o.width}if(c.hasNext()){i=0;n=n+f}else{i=i+o.width;r.lastLineWidth=o.width;break}}else{break}}}else if(r.type==="newline"){r.x=i;r.y=n;i=0;n=n+f}else if(r.type==="newblock"){r.x=i;r.y=n;i=0;n=n+f*1.5}else if(r.type==="img"){if(r.imageLoaded){var m=r.value;var d=m.height/m.width;var y=r.displayWidth?r.displayWidth:m.width;var v=r.displayHeight?r.displayHeight:m.height;r.y=n+f*.5;if(y<h){r.w=y;r.x=Math.floor((h-y)/2);r.h=Math.floor(r.w*d)}else{r.x=0;r.w=h;r.h=Math.floor(r.w*d)}n=r.y+r.h;n=n+.5*f}else{n=n+f}i=0}this.scrollRange=n}return};UISimpleHTML.prototype.getScrollRange=function(){return this.scrollRange?this.scrollRange:this.h};UISimpleHTML.prototype.loadUrl=function(t,e){var i={};var n=this;i.method="GET";i.url=t;i.headers={"Cache-Control":"no-cache",Pragma:"no-cache"};i.onDone=function(t,i,r){var a=i.status===200;if(i.status===200){var o=r;try{n.setText(o);console.log("loadUrl: done")}catch(s){a=false;console.log("loadUrl: failed"+s.message)}}if(e){e(a)}return};httpDoRequest(i);return};UISimpleHTML.prototype.setText=function(t){this.text=this.toText(t);this.elements=[];var e=document.createElement("div");e.innerHTML=this.text;this.bold=0;this.anchor=0;this.italic=0;this.underline=0;this.strong=0;this.colors=[];this.extractHtmlElements(e,0);delete this.colors;delete this.anchor;delete this.bold;delete this.italic;delete this.underline;delete this.strong;this.textNeedRelayout=true;return};UISimpleHTML.prototype.layoutHtml=function(t){if(!this.textNeedRelayout){return}if(!this.text){return}this.layoutHtmlElements(t);this.textNeedRelayout=false;return};UISimpleHTML.prototype.shapeCanBeChild=function(t){return false};UISimpleHTML.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=0;var r=0;var a=this.h;var o=this.w;var s=null;var l=this.hMargin;var h=this.getWidth(true);var u=this.style.fontSize;var c=2*u;var p=this.hMargin;var f=-this.offset+this.vMargin;var m=u+"pt "+this.style.fontFamily;this.layoutHtml(t);t.save();t.rect(0,0,o,a);t.clip();if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fill()}t.beginPath();t.font=m;t.textAlign="left";t.textBaseline="top";t.fillStyle=this.style.textColor;var d=this.elements.length;var y=this.elements;for(e=0;e<d;e++){s=y[e];if(s.type==="text"&&s.lines&&s.lines.length){var v=s.lines.length;t.font=s.fontStyle+m;if(s.color){t.fillStyle=s.color}else if(s.anchor){t.fillStyle="Blue"}else{t.fillStyle=this.style.textColor}for(k=0;k<v;k++){if(k===0){i=s.x;n=s.y}else{i=0;n=s.y+k*c}i=i+p;n=n+f;r=n+u;if(n<a&&r>=0){h=o-i-l;t.fillText(s.lines[k],i,n,h)}}}else if(s.type==="img"&&s.imageLoaded){var g=s.value;var _=g.width;var I=g.height;i=s.x+p;n=s.y+f;r=n+s.h;if(n<a&&r>=0){t.drawImage(g,0,0,_,I,i,n,s.w,s.h)}}}t.restore();return};function UISimpleHTMLCreator(){var t=["ui-simple-html","ui-simple-html",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISimpleHTML;var i="Simpe HTML";return e.initUISimpleHTML(this.type,i,null)};return}ShapeFactoryGet().addShapeCreator(new UISimpleHTMLCreator);function UIHtmlView(){return}UIHtmlView.prototype=new UIHtml;UIHtmlView.prototype.isUIHtmlView=true;UIHtmlView.prototype.getHtmlContent=function(){var t="<p>hello html view";var e=this.getWidth(true);var i=this.getHeight(true);var n=this.getUrl();var r=this.getValue();if(n){t='<iframe seamless="seamless" scrolling="yes" width="'+e+'" height="'+i+'" src="'+n+'"></iframe>'}else if(r){t=r}return t};UIHtmlView.prototype.setText=function(t){this.text=t;return};UIHtmlView.prototype.getValue=function(){return this.text?this.text:""};UIHtmlView.prototype.setValue=function(t){this.text=t;return};UIHtmlView.prototype.getUrl=function(){return this.url?this.url:""};UIHtmlView.prototype.setUrl=function(t){this.url=t;return};UIHtmlView.prototype.paintSelfOnly=function(t){if(!this.htmlVisible){var e=this.w>>1;var i=this.h>>1;var n=dappGetText("HtmlView");t.textBaseline="middle";t.textAlign="center";t.font=this.style.getFont();t.fillStyle=this.style.textColor;t.fillText(n,e,i)}return};UIHtmlView.prototype.initUIHtmlView=function(t){this.initUIHtml(t,400,300);this.setValue("<p>hello html view");this.setImage(UIElement.IMAGE_DEFAULT,null);this.setScrollable(true);return this};function UIHtmlViewCreator(){var t=["ui-html-view","ui-html-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIHtmlView;return e.initUIHtmlView(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIHtmlViewCreator);function UIButtonGroup(){return}UIButtonGroup.prototype=new UIElement;UIButtonGroup.prototype.isUIButtonGroup=true;UIButtonGroup.prototype.initUIButtonGroup=function(t,e,i,n){this.initUIElement(t);this.setMargin(e,e);this.setDefSize(300,60);this.setSizeLimit(100,40,1e3,120);this.buttonMaxWidth=i;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.rectSelectable=false;this.addEventNames(["onInit"]);if(!n){this.style.setFillColor("White")}return this};UIButtonGroup.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton||t.isUIGroup||t.isUIRadioBox||t.isUICheckBox){
return true}return false};UIButtonGroup.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};UIButtonGroup.prototype.relayoutChildren=function(){var t=this.getHMargin();var e=this.getVMargin();var i=this.children.length;if(i===0||this.disableRelayout){return}var n=t;var r=e;var a=this.h-2*e;var o=this.buttonMaxWidth;var s=Math.floor((this.w-2*t)/i);var l=Math.min(s,o);for(var h=0;h<i;h++){var u=this.children[h];n=h*s+(s-l)/2+t;u.setLeftTop(n,r);u.setSize(l,a);u.setUserMovable(false);u.setUserResizable(false);u.relayoutChildren()}this.w=s*i+2*t;return};UIButtonGroup.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return true};function UIButtonGroupCreator(t,e,i){var n=["ui-button-group","ui-button-group",null,1];ShapeCreator.apply(this,n);this.createShape=function(n){var r=new UIButtonGroup;return r.initUIButtonGroup(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIButtonGroupCreator(5,200,null));function UIColorBar(){return}UIColorBar.prototype=new UIElement;UIColorBar.prototype.isUIButton=false;UIColorBar.prototype.isUIColorBar=true;UIColorBar.prototype.saveProps=["barPosition"];UIColorBar.prototype.initUIColorBar=function(t,e,i){this.initUIElement(t);this.setBarPosition(0);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);this.barDierction=0;return this};UIColorBar.prototype.setBarDirection=function(t){this.barDirection=t;return this};UIColorBar.prototype.getBarDirection=function(){return this.barDirection};UIColorBar.prototype.setBarPosition=function(t){this.barPosition=t;return this};UIColorBar.prototype.getBarPosition=function(){return this.barPosition};UIColorBar.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUIColorTile||t.isUILabel};UIColorBar.prototype.paintSelfOnly=function(t){var e=0;var i=0;var n=this.barDirection;var r=this.style.lineWidth;t.beginPath();switch(this.barPosition){case-1:{break}case 1:{if(n){e=this.w-r}else{i=this.h-r}break}default:{if(n){e=Math.floor(this.w-r>>1)}else{i=Math.floor(this.h-r>>1)}}}if(n){t.moveTo(e,0);t.lineTo(e,this.h)}else{t.moveTo(0,i);t.lineTo(this.w,i)}t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke();return};function UIColorBarCreator(t,e){var i=["ui-color-bar","ui-color-bar",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorBar;return n.initUIColorBar(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIColorBarCreator(100,10));function UIImageAnimation(){return}UIImageAnimation.prototype=new UIImageView;UIImageAnimation.prototype.isUIImageAnimation=true;UIImageAnimation.prototype.saveProps=["frameRate"];UIImageAnimation.prototype.initUIImageAnimation=function(t,e,i){this.initUIElement(t);this.initUIImageView(e,i);this.addEventNames(["onChanged"]);this.setTextType(Shape.TEXT_NONE);imageAnimationInitCustomProp(this);return this};UIImageAnimation.prototype.setCurrent=function(t){if(this.userImages.length){t=t%this.userImages.length}if(this.currFrame!=t){this.callOnChangedHandler(t)}this.currFrame=t;return this};UIImageAnimation.prototype.setValue=function(t){for(var e=0;e<this.cachedImages.length;e++){var i=this.cachedImages[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){return this.setCurrent(e)}}return this};UIImageAnimation.prototype.getCurrentImage=function(){var t=this.cachedImages[this.currFrame];return t};UIImageAnimation.prototype.onInit=function(){var t=this;this.currFrame=0;function e(){if(t.isVisible()){var i=1e3/t.getFrameRate();t.postRedraw();setTimeout(e,i);t.setCurrent(t.currFrame+1)}}var i=1e3/this.getFrameRate();setTimeout(e,i);return};UIImageAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIImageAnimation.prototype.setFrameRate=function(t){this.frameRate=Math.max(1,Math.min(t,30));return};UIImageAnimation.prototype.drawImage=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=(this.currFrame?this.currFrame:0)%this.userImages.length;var i=this.cachedImages[e];if(i&&i.width>0){this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h)}return};UIImageAnimation.prototype.shapeCanBeChild=function(t){return false};function UIImageAnimationCreator(){var t=["ui-image-animation","ui-image-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageAnimation;return e.initUIImageAnimation(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageAnimationCreator);UIElement.eventsStoped={};UIElement.prototype.callOnUpdateTransformHandler=function(canvas){if(this.isInDesignMode()||!this.events)return true;if(!this.handleOnUpdateTransform){var sourceCode=this.events["onUpdateTransform"];if(sourceCode){sourceCode="this.handleOnUpdateTransform = function(canvas) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUpdateTransform eval",e)}}}if(this.hasEventListener("updatetransform")){var event=this.createEvent("updatetransform");event.canvas=canvas;this.dispatchEvent(event)}if(this.handleOnUpdateTransform){try{this.handleOnUpdateTransform(canvas)}catch(e){UIElement.logError("this.handleOnUpdateTransform",e)}}return};UIElement.prototype.callOnPointerDownHandler=function(point,beforeChild){if(this.isUIWindow){UIElement.eventsStoped.click=false;UIElement.eventsStoped.pointerDown=false}if(!this.enable||!this.events||UIElement.eventsStoped.pointerDown){return false}if(this.hasEventListener("pointerdown")){var event=this.createEvent("pointerdown");event.point=point;event.beforeChild=beforeChild;if(this.dispatchEvent(event)){UIElement.eventsStoped.pointerDown=true;return true}}if(!this.handlePointerDown){var sourceCode=this.events["onPointerDown"];if(sourceCode){sourceCode="this.handlePointerDown = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerDown eval",e)}}}if(this.handlePointerDown){try{if(this.handlePointerDown(point,beforeChild)){UIElement.eventsStoped.pointerDown=true}}catch(e){UIElement.logError("this.handlePointerDown",e)}}return true};UIElement.prototype.callOnPointerMoveHandler=function(point,beforeChild){if(this.isUIWindow){UIElement.eventsStoped.pointerMove=false}if(!this.enable||!this.events||UIElement.eventsStoped.pointerMove){return false}if(this.hasEventListener("pointermove")){var event=this.createEvent("pointermove");event.point=point;event.beforeChild=beforeChild;if(this.dispatchEvent(event)){UIElement.eventsStoped.pointerMove=true;return true}}if(!this.handlePointerMove){var sourceCode=this.events["onPointerMove"];if(sourceCode){sourceCode="this.handlePointerMove = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerMove eval",e)}}}if(this.handlePointerMove){try{if(this.handlePointerMove(point,beforeChild)){UIElement.eventsStoped.pointerMove=true}}catch(e){UIElement.logError("this.handlePointerMove",e)}}return true};UIElement.prototype.callOnPointerUpHandler=function(point,beforeChild){if(this.isUIWindow){UIElement.eventsStoped.pointerUp=false}if(!this.enable||!this.events||UIElement.eventsStoped.pointerUp){return false}if(this.hasEventListener("pointerup")){var event=this.createEvent("pointerup");event.point=point;event.beforeChild=beforeChild;if(this.dispatchEvent(event)){UIElement.eventsStoped.pointerUp=true;return true}}if(!this.handlePointerUp){var sourceCode=this.events["onPointerUp"];if(sourceCode){sourceCode="this.handlePointerUp = function(point, beforeChild) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePointerUp eval",e)}}}if(this.handlePointerUp){try{if(this.handlePointerUp(point,beforeChild)){UIElement.eventsStoped.pointerUp=true}}catch(e){UIElement.logError("this.handlePointerUp",e)}}return true};UIElement.prototype.callOnClickHandler=function(point){if(!this.enable||!this.events||this.isInDesignMode()){return false}if(UIElement.eventsStoped.click){return true}if(this.hasEventListener("click")){var event=this.createEvent("click");event.point=point;if(this.dispatchEvent(event)){UIElement.eventsStoped.click=true;return true}}if(!this.handleClick){var sourceCode=this.events["onClick"];if(sourceCode){sourceCode="this.handleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleClick eval",e)}}}if(this.handleClick){try{if(this.handleClick(point)){UIElement.eventsStoped.click=true}}catch(e){UIElement.logError("this.handleClick",e)}}return true};UIElement.prototype.callOnDoubleClickHandler=function(point){if(this.isUIWindow){UIElement.eventsStoped.doubleClick=false}if(!this.enable||!this.events||this.isInDesignMode()){return false}if(UIElement.eventsStoped.doubleClick){return false}if(this.hasEventListener("doubleclick")){var event=this.createEvent("doubleclick");event.point=point;if(this.dispatchEvent(event)){UIElement.eventsStoped.doubleClick=true;return true}}if(!this.handleDoubleClick){var sourceCode=this.events["onDoubleClick"];if(sourceCode){sourceCode="this.handleDoubleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDoubleClick eval",e)}}}if(this.handleDoubleClick){try{if(this.handleDoubleClick(point)){UIElement.eventsStoped.doubleClick=true}}catch(e){UIElement.logError("this.handleDoubleClick",e)}}this.hitTestResult=0;return true};UIElement.prototype.callOnLongPressHandler=function(point){if(!this.enable||!this.events){return false}if(!this.handleLongPress){var sourceCode=this.events["onLongPress"];if(sourceCode){sourceCode="this.handleLongPress = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleLongPress eval",e)}}}if(this.hasEventListener("longpress")){var event=this.createEvent("longpress");event.point=point;this.dispatchEvent(event)}if(this.handleLongPress){try{this.handleLongPress(point)}catch(e){UIElement.logError("this.handleLongPress",e)}}return true};UIElement.prototype.callOnPaintHandler=function(canvas2dCtx){if(this.isInDesignMode()){return true}if(!this.enable||!this.events){return false}if(!this.handlePaint){var sourceCode=this.events["onPaint"];if(sourceCode){sourceCode="this.handlePaint = function(canvas2dCtx) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handlePaint eval",e)}}}if(this.hasEventListener("paint")){var event=this.createEvent("paint");event.canvas2dCtx=canvas2dCtx;this.dispatchEvent(event)}if(this.handlePaint){try{this.handlePaint(canvas2dCtx)}catch(e){UIElement.logError("this.handlePaint",e)}}return true};UIElement.prototype.callOnScrollDoneHandler=function(xOffset,yOffset){if(!this.enable||!this.events){return false}if(this.hasEventListener("scrolldone")){var event=this.createEvent("scrolldone");event.xOffset=xOffset;event.yOffset=yOffset;if(this.dispatchEvent(event)){return true}}if(!this.handleOnScrollDone){var sourceCode=this.events["onScrollDone"];if(sourceCode){sourceCode="this.handleOnScrollDone = function(xOffset, yOffset) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnScrollDone eval",e)}}}if(this.handleOnScrollDone){try{this.handleOnScrollDone(xOffset,yOffset)}catch(e){UIElement.logError("this.handleOnScrollDone",e)}}return true};UIElement.prototype.callOnScrollingHandler=function(xOffset,yOffset){if(!this.enable||!this.events||this.isInDesignMode()){return false}if(this.hasEventListener("scrolling")){var event=this.createEvent("scrolling");event.xOffset=xOffset;event.yOffset=yOffset;if(this.dispatchEvent(event)){return true}}if(!this.handleOnScrolling){var sourceCode=this.events["onScrolling"];if(sourceCode){sourceCode="this.handleOnScrolling = function(xOffset, yOffset) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnScrolling eval",e)}}}if(this.handleOnScrolling){try{this.handleOnScrolling(xOffset,yOffset)}catch(e){UIElement.logError("this.handleOnScrolling",e)}}return true};UIElement.prototype.callOnRemovedHandler=function(){if(!this.enable||!this.events||this.isInDesignMode()){return false}if(!this.handleOnRemoved){var sourceCode=this.events["onRemoved"];if(sourceCode){sourceCode="this.handleOnRemoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode);UIElement.logError("this.handleOnRemoved eval",e)}}}if(this.hasEventListener("removed")){var event=this.createEvent("removed");this.dispatchEvent(event)}if(this.handleOnRemoved){try{this.handleOnRemoved()}catch(e){UIElement.logError("this.handleOnRemoved",e)}}return true};UIElement.prototype.callOnChildDraggingHandler=function(sourceChildIndex,targetChildIndex){if(!this.enable||!this.events){return false}if(!this.handleOnChildDragging){var sourceCode=this.events["onChildDragging"];if(sourceCode){sourceCode="this.handleOnChildDragging = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChildDragging eval",e)}}}if(this.hasEventListener("childdragging")){var event=this.createEvent("childdragging");event.sourceChildIndex=sourceChildIndex;event.targetChildIndex=targetChildIndex;this.dispatchEvent(event)}if(this.handleOnChildDragging){try{this.handleOnChildDragging(sourceChildIndex,targetChildIndex)}catch(e){UIElement.logError("this.handleOnChildDragging",e)}}return true};UIElement.prototype.callOnChildDraggedHandler=function(sourceChildIndex,targetChildIndex){if(!this.enable||!this.events){return false}if(!this.handleOnChildDragged){var sourceCode=this.events["onChildDragged"];if(sourceCode){sourceCode="this.handleOnChildDragged = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChildDragged eval",e)}}}if(this.hasEventListener("childdragged")){var event=this.createEvent("childdragged");event.sourceChildIndex=sourceChildIndex;event.targetChildIndex=targetChildIndex;this.dispatchEvent(event)}if(this.handleOnChildDragged){try{this.handleOnChildDragged(sourceChildIndex,targetChildIndex)}catch(e){UIElement.logError("this.handleOnChildDragged",e)}}return true};UIElement.prototype.callOnChangingHandler=function(value){if(!this.enable||this.isInDesignMode()||!this.events){return false}if(this.hasEventListener("changing")){var event=this.createEvent("changing");event.value=value;this.dispatchEvent(event)}if(!this.handleOnChanging){var sourceCode=this.events["onChanging"];if(sourceCode){sourceCode="this.handleOnChanging = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChanging eval",e)}}}if(this.handleOnChanging){try{this.handleOnChanging(value)}catch(e){UIElement.logError("this.handleOnChanging",e)}}return true};UIElement.prototype.callOnChangedHandler=function(value){if(!this.enable||this.isInDesignMode()||!this.events){return false}if(this.hasEventListener("change")){var event=this.createEvent("change");event.value=value;this.dispatchEvent(event)}if(this.hasEventListener("changed")){var event=this.createEvent("changed");event.value=value;this.dispatchEvent(event)}if(!this.handleOnChanged){var sourceCode=this.events["onChanged"];if(sourceCode){sourceCode="this.handleOnChanged = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnChanged eval",e)}}}if(this.handleOnChanged){try{this.handleOnChanged(value)}catch(e){UIElement.logError("this.handleOnChanged",e)}}return true};UIElement.prototype.callOnInitHandler=function(){if(!this.events)return;if(!this.handleOnInit){var sourceCode=this.events["onInit"];if(sourceCode){sourceCode="this.handleOnInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnInit eval",e)}}}if(this.hasEventListener("init")){var event=this.createEvent("init");this.dispatchEvent(event)}if(this.handleOnInit){try{this.handleOnInit()}catch(e){UIElement.logError("this.handleOnInit",e)}}return true};UIElement.prototype.callOnFocusInHandler=function(){if(this.onFocusIn){try{this.onFocusIn()}catch(e){console.log("onFocusIn:"+e.message)}}if(!this.events)return;if(!this.handleOnFocusIn){var sourceCode=this.events["onFocusIn"];if(sourceCode){sourceCode="this.handleOnFocusIn = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnFocusIn eval",e)}}}if(this.hasEventListener("focusin")){var event=this.createEvent("focusin");this.dispatchEvent(event)}if(this.handleOnFocusIn){try{this.handleOnFocusIn()}catch(e){UIElement.logError("this.handleOnFocusIn",e)}}return true};UIElement.prototype.callOnFocusOutHandler=function(){if(this.onFocusOut){try{this.onFocusOut()}catch(e){UIElement.logError("this.onFocusOut ",e)}}if(!this.events)return;if(!this.handleOnFocusOut){var sourceCode=this.events["onFocusOut"];if(sourceCode){sourceCode="this.handleOnFocusOut = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.onFocusOut eval",e)}}}if(this.hasEventListener("focusout")){var event=this.createEvent("focusout");this.dispatchEvent(event)}if(this.handleOnFocusOut){try{this.handleOnFocusOut()}catch(e){UIElement.logError("this.onFocusOut",e)}}return true};UIElement.prototype.callOnUpdateDataHandler=function(){if(!this.events)return;if(!this.handleOnUpdateData){var sourceCode=this.events["onUpdateData"];if(sourceCode){sourceCode="this.handleOnUpdateData = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUpdateData eval",e)}}}if(this.hasEventListener("updatedata")){var event=this.createEvent("updatedata");this.dispatchEvent(event)}if(this.handleOnUpdateData){try{this.handleOnUpdateData()}catch(e){UIElement.logError("this.handleOnUpdateData",e)}}return true};UIElement.prototype.callOnGestureHandler=function(gesture){if(!this.enable||!this.events){return false}if(!this.handleOnGesture){var sourceCode=this.events["onGesture"];if(sourceCode){sourceCode="this.handleOnGesture = function(gesture) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnGesture eval",e)}}}if(this.hasEventListener("gesture")){var event=this.createEvent("gesture");event.gesture=gesture;this.dispatchEvent(event)}if(this.handleOnGesture){try{this.handleOnGesture(gesture)}catch(e){UIElement.logError("this.handleOnGesture",e)}}console.log("callOnGestureHandler: scale="+gesture.scale+" rotation="+gesture.rotation);return true};UIElement.prototype.callOnBeforeOpenHandler=function(initData){if(!this.events)return;if(!this.handleOnBeforeOpen){var sourceCode=this.events["onBeforeOpen"];if(sourceCode){sourceCode="this.handleOnBeforeOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBeforeOpen eval",e)}}}if(this.hasEventListener("beforeopen")){var event=this.createEvent("beforeopen");event.initData=initData;this.dispatchEvent(event)}if(this.handleOnBeforeOpen){try{this.handleOnBeforeOpen(initData)}catch(e){UIElement.logError("this.handleOnBeforeOpen",e)}}return true};UIElement.prototype.callOnOpenHandler=function(initData){if(!this.events)return;if(!this.handleOnOpen){var sourceCode=this.events["onOpen"];if(sourceCode){sourceCode="this.handleOnOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnOpen eval",e)}}}if(this.hasEventListener("open")){var event=this.createEvent("open");event.initData=initData;this.dispatchEvent(event)}if(this.handleOnOpen){try{this.handleOnOpen(initData)}catch(e){UIElement.logError("this.handleOnOpen",e)}}return true};UIElement.prototype.callOnCloseHandler=function(retInfo){if(!this.events)return;if(!this.handleOnClose){var sourceCode=this.events["onClose"];if(sourceCode){sourceCode="this.handleOnClose = function(retInfo) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnClose eval",e)}}}if(this.hasEventListener("close")){var event=this.createEvent("close");event.retInfo=retInfo;this.dispatchEvent(event)}if(this.handleOnClose){try{this.handleOnClose(retInfo)}catch(e){UIElement.logError("this.handleOnClose",e)}}return true};UIElement.prototype.callOnSwitchToBackHandler=function(){if(!this.events)return;if(!this.handleOnSwitchToBack){var sourceCode=this.events["onSwitchToBack"];if(sourceCode){sourceCode="this.handleOnSwitchToBack = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwitchToBack eval",e)}}}if(this.hasEventListener("switchtoback")){var event=this.createEvent("switchtoback");this.dispatchEvent(event)}if(this.handleOnSwitchToBack){try{this.handleOnSwitchToBack()}catch(e){UIElement.logError("this.handleOnSwitchToBack",e)}}return true};UIElement.prototype.callOnSwitchToFrontHandler=function(){if(!this.events)return;if(!this.handleOnSwitchToFront){var sourceCode=this.events["onSwitchToFront"];if(sourceCode){sourceCode="this.handleOnSwitchToFront = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwitchToFront eval",e)}}}if(this.hasEventListener("switchtofront")){var event=this.createEvent("switchtofront");this.dispatchEvent(event)}if(this.handleOnSwitchToFront){try{this.handleOnSwitchToFront()}catch(e){UIElement.logError("this.handleOnSwitchToFront",e)}}return true};UIElement.prototype.callOnLoadHandler=function(){if(!this.events)return;if(!this.handleOnLoad){var sourceCode=this.events["onLoad"];if(sourceCode){sourceCode="this.handleOnLoad = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnLoad eval",e)}}}if(this.hasEventListener("load")){var event=this.createEvent("load");this.dispatchEvent(event)}if(this.handleOnLoad){try{this.handleOnLoad()}catch(e){UIElement.logError("this.handleOnLoad",e)}}return true};UIElement.prototype.callOnUnloadHandler=function(){if(!this.events)return;if(!this.handleOnUnload){var sourceCode=this.events["onUnload"];if(sourceCode){sourceCode="this.handleOnUnload = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnUnload eval",e)}}}if(this.hasEventListener("unload")){var event=this.createEvent("unload");this.dispatchEvent(event)}if(this.handleOnUnload){try{this.handleOnUnload()}catch(e){UIElement.logError("this.handleOnUnload",e)}}return true};UIElement.prototype.callOnMovedHandler=function(){if(this.cameraFollowMe){this.getWindow().cameraFollow(this)}if(this.hasEventListener("moved")){var event=this.createEvent("moved");this.dispatchEvent(event)}if(!this.events)return;if(!this.handleOnMoved){var sourceCode=this.events["onMoved"];if(sourceCode){sourceCode="this.handleOnMoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnMoved eval",e)}}}if(this.handleOnMoved){try{this.handleOnMoved()}catch(e){UIElement.logError("this.handleOnMoved",e)}}return true};UIElement.prototype.callOnPreSolveHandler=function(body,contact,oldManifold){if(!this.events)return;if(!this.handleOnPreSolve){var sourceCode=this.events["onPreSolve"];if(sourceCode){sourceCode="this.handleOnPreSolve = function(body, contact, oldManifold) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnPreSolve eval",e)}}}if(this.hasEventListener("presolve")){var event=this.createEvent("presolve");event.body=body;event.contact=contact;event.oldManifold=oldManifold;this.dispatchEvent(event)}if(this.handleOnPreSolve){try{this.handleOnPreSolve(body,contact,oldManifold)}catch(e){UIElement.logError("this.handleOnPreSolve",e)}}return true};UIElement.prototype.callOnPostSolveHandler=function(body,contact,impulse){if(!this.events)return;if(!this.handleOnPostSolve){var sourceCode=this.events["onPostSolve"];if(sourceCode){sourceCode="this.handleOnPostSolve = function(body, contact, impulse) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnPostSolve eval",e)}}}if(this.hasEventListener("postsolve")){var event=this.createEvent("postsolve");event.body=body;event.contact=contact;event.impulse=impulse;this.dispatchEvent(event)}if(this.handleOnPostSolve){try{this.handleOnPostSolve(body,contact,impulse)}catch(e){UIElement.logError("this.handleOnPostSolve",e)}}return true};UIElement.prototype.callOnBeginContactHandler=function(body,contact){if(!this.events)return;if(this.hasEventListener("begincontact")){var event=this.createEvent("begincontact");event.body=body;event.contact=contact;this.dispatchEvent(event)}if(!this.handleOnBeginContact){var sourceCode=this.events["onBeginContact"];if(sourceCode){sourceCode="this.handleOnBeginContact = function(body, contact) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBeginContact eval",e)}}}if(this.handleOnBeginContact){try{this.handleOnBeginContact(body,contact)}catch(e){UIElement.logError("this.handleOnBeginContact",e)}}return true};UIElement.prototype.callOnEndContactHandler=function(body,contact){if(!this.events)return;if(this.hasEventListener("endcontact")){var event=this.createEvent("endcontact");event.body=body;event.contact=contact;this.dispatchEvent(event)}if(!this.handleOnEndContact){var sourceCode=this.events["onEndContact"];if(sourceCode){sourceCode="this.handleOnEndContact = function(body, contact) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnEndContact eval",e)}}}if(this.handleOnEndContact){try{this.handleOnEndContact(body,contact)}catch(e){UIElement.logError("this.handleOnEndContact",e)}}return true};UIElement.prototype.callOnAnimateDoneHandler=function(name){if(!this.events)return;if(!this.handleOnAnimateDone){var sourceCode=this.events["onAnimateDone"];if(sourceCode){sourceCode="this.handleOnAnimateDone = function(name) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnAnimateDone eval",e)}}}if(this.hasEventListener("animatedone")){var event=this.createEvent("animatedone");event.name=name;this.dispatchEvent(event)}if(this.handleOnAnimateDone){try{this.handleOnAnimateDone(name)}catch(e){UIElement.logError("this.handleOnAnimateDone",e)}}return true};UIElement.prototype.callOnSwipeLeftHandler=function(start,end){if(!this.events)return;if(!this.handleOnSwipeLeft){var sourceCode=this.events["onSwipeLeft"];if(sourceCode){sourceCode="this.handleOnSwipeLeft = function(start, end) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeLeft eval",e)}}}if(this.hasEventListener("swipeleft")){var event=this.createEvent("swipeleft");event.start=start;event.end=end;this.dispatchEvent(event)}if(this.handleOnSwipeLeft){try{this.handleOnSwipeLeft(start,end)}catch(e){UIElement.logError("this.handleOnSwipeLeft",e)}}return true};UIElement.prototype.callOnSwipeRightHandler=function(start,end){if(!this.events)return;if(!this.handleOnSwipeRight){var sourceCode=this.events["onSwipeRight"];if(sourceCode){sourceCode="this.handleOnSwipeRight = function(start, end) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeRight eval",e)}}}if(this.hasEventListener("swiperight")){var event=this.createEvent("swiperight");event.start=start;event.end=end;this.dispatchEvent(event)}if(this.handleOnSwipeRight){try{this.handleOnSwipeRight(start,end)}catch(e){UIElement.logError("this.handleOnSwipeRight",e)}}return true};UIElement.prototype.callOnSwipeUpHandler=function(start,end){if(!this.events)return;if(!this.handleOnSwipeUp){var sourceCode=this.events["onSwipeUp"];if(sourceCode){sourceCode="this.handleOnSwipeUp = function(start, end) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeUp eval",e)}}}if(this.hasEventListener("swipeup")){var event=this.createEvent("swipeup");event.start=start;event.end=end;this.dispatchEvent(event)}if(this.handleOnSwipeUp){try{this.handleOnSwipeUp(start,end)}catch(e){UIElement.logError("this.handleOnSwipeUp",e)}}return true};UIElement.prototype.callOnSwipeDownHandler=function(start,end){if(!this.events)return;if(!this.handleOnSwipeDown){var sourceCode=this.events["onSwipeDown"];if(sourceCode){sourceCode="this.handleOnSwipeDown = function(start, end) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSwipeDown eval",e)}}}if(this.hasEventListener("swipedown")){var event=this.createEvent("swipedown");event.start=start;event.end=end;this.dispatchEvent(event)}if(this.handleOnSwipeDown){try{this.handleOnSwipeDown(start,end)}catch(e){UIElement.logError("this.handleOnSwipeDown",e)}}return true};UIElement.prototype.callOnBecomeZeroHandler=function(){if(!this.events)return;if(!this.handleOnBecomeZero){var sourceCode=this.events["onBecomeZero"];if(sourceCode){sourceCode="this.handleOnBecomeZero = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBecomeZero eval",e)}}}if(this.hasEventListener("becomezero")){var event=this.createEvent("becomezero");this.dispatchEvent(event)}if(this.handleOnBecomeZero){try{this.handleOnBecomeZero()}catch(e){UIElement.logError("this.handleOnBecomeZero",e)}}return true};UIElement.prototype.callOnBecomeFullHandler=function(){if(!this.events)return;if(!this.handleOnBecomeFull){var sourceCode=this.events["onBecomeFull"];if(sourceCode){sourceCode="this.handleOnBecomeFull = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBecomeFull eval",e)}}}if(this.hasEventListener("becomefull")){var event=this.createEvent("becomefull");this.dispatchEvent(event)}if(this.handleOnBecomeFull){try{this.handleOnBecomeFull()}catch(e){UIElement.logError("this.handleOnBecomeFull",e)}}return true};UIElement.prototype.callOnTimeoutHandler=function(){if(!this.events)return;if(!this.handleOnTimeout){var sourceCode=this.events["onTimeout"];if(sourceCode){sourceCode="this.handleOnTimeout = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnTimeout eval",e)}}}if(this.hasEventListener("timer")){var event=this.createEvent("timer");this.dispatchEvent(event)}if(this.hasEventListener("timeout")){var event=this.createEvent("timeout");this.dispatchEvent(event)}if(this.handleOnTimeout){try{this.handleOnTimeout()}catch(e){UIElement.logError("this.handleOnTimeout",e)}}return true};UIElement.prototype.callOnSystemInitHandler=function(){if(!this.events)return;if(!this.handleOnSystemInit){var sourceCode=this.events["onSystemInit"];if(sourceCode){sourceCode="this.handleOnSystemInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnSystemInit eval",e)}}}if(this.hasEventListener("systeminit")){var event=this.createEvent("systeminit");this.dispatchEvent(event)}if(this.handleOnSystemInit){try{this.handleOnSystemInit()}catch(e){UIElement.logError("this.handleOnSystemInit",e)}}return true};UIElement.prototype.callOnScrollOutOfRangeHandler=function(offset){if(!this.enable||!this.events){return false}if(this.onScrollOutOfRange){this.onScrollOutOfRange(offset);return}if(!this.handleOnScrollOutOfRange){var sourceCode=this.events["onScrollOutOfRange"];if(sourceCode){sourceCode="this.handleOnScrollOutOfRange = function(offset) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnScrollOutOfRange eval",e)}}}if(this.hasEventListener("scrolloutofrange")){var event=this.createEvent("scrolloutofrange");event.offset=offset;this.dispatchEvent(event)}if(this.handleOnScrollOutOfRange){try{this.handleOnScrollOutOfRange(offset)}catch(e){UIElement.logError("this.handleOnScrollOutOfRange",e)}}return true};UIElement.prototype.callOnBirthedHandler=function(){if(this.onBirthed){this.onBirthed()}if(!this.events)return;if(!this.handleOnBirthed){var sourceCode=this.events["onBirthed"];
if(sourceCode){sourceCode="this.handleOnBirthed = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnBirthed eval",e)}}}if(this.hasEventListener("birthed")){var event=this.createEvent("birthed");this.dispatchEvent(event)}if(this.handleOnBirthed){try{this.handleOnBirthed()}catch(e){UIElement.logError("this.handleOnBirthed",e)}}return true};UIElement.prototype.callOnDeviceOrientation=function(x,y,z,evt){if(!this.events)return;if(!this.handleOnDeviceOrientation){var sourceCode=this.events["onDeviceOrientation"];if(sourceCode){sourceCode="this.handleOnDeviceOrientation = function(x, y, z, event) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleOnDeviceOrientation eval",e)}}}if(this.hasEventListener("deviceorientation")){var event=this.createEvent("deviceorientation");event.x=x;event.y=y;event.z=z;event.event=evt;this.dispatchEvent(event)}if(this.handleOnDeviceOrientation){try{this.handleOnDeviceOrientation(x,y,z,evt)}catch(e){UIElement.logError("this.handleOnDeviceOrientation",e)}}return true};UIElement.prototype.dispatchCustomEvent=function(eventName,args){if(!this.events)return;if(!this.customEventHandler){this.customEventHandler={}}var handleCustomEvent=this.customEventHandler[eventName];if(!handleCustomEvent){var sourceCode=this.events[eventName];if(sourceCode){sourceCode="this.handleCustomEvent = function(args) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleCustomEvent eval",e)}}if(this.handleCustomEvent){handleCustomEvent=this.handleCustomEvent;this.customEventHandler[eventName]=handleCustomEvent;this.handleCustomEvent=null}}if(handleCustomEvent){try{handleCustomEvent.call(this,args)}catch(e){UIElement.logError("this.handleCustomEvent",e)}}return true};UIWindow.prototype.callOnMultiTouchHandler=function(action,points,evt){if(!this.enable||!this.events){return false}if(this.isInDesignMode()){return false}if(!this.handleMultiTouch){var sourceCode=this.events["onMultiTouch"];if(sourceCode){sourceCode="this.handleMultiTouch = function(action, points, event) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleMultiTouch eval",e)}}}if(this.hasEventListener("multitouch")){var event=this.createEvent("multitouch");event.action=action;event.points=points;event.event=evt;this.dispatchEvent(event)}if(this.handleMultiTouch){try{this.handleMultiTouch(action,points,evt)}catch(e){UIElement.logError("this.handleMultiTouch",e)}}return};UIElement.prototype.callOnDragStartHandler=function(){if(!this.enable||!this.events){return false}if(!this.handleDragStart){var sourceCode=this.events["onDragStart"];if(sourceCode){sourceCode="this.handleDragStart = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDragStart eval",e)}}}if(this.hasEventListener("dragstart")){var event=this.createEvent("dragstart");this.dispatchEvent(event)}if(this.handleDragStart){try{this.handleDragStart()}catch(e){UIElement.logError("this.handleDragStart",e)}}return};UIElement.prototype.callOnDragEndHandler=function(){if(!this.enable||!this.events){return false}if(!this.handleDragEnd){var sourceCode=this.events["onDragEnd"];if(sourceCode){sourceCode="this.handleDragEnd = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDragEnd eval",e)}}}if(this.hasEventListener("dragend")){var event=this.createEvent("dragend");this.dispatchEvent(event)}if(this.handleDragEnd){try{this.handleDragEnd()}catch(e){UIElement.logError("this.handleDragEnd",e)}}return};UIElement.prototype.callOnDraggingHandler=function(){if(!this.enable||!this.events){return false}if(!this.handleDragging){var sourceCode=this.events["onDragging"];if(sourceCode){sourceCode="this.handleDragging = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){UIElement.logError("this.handleDragging eval",e)}}}if(this.hasEventListener("dragging")){var event=this.createEvent("dragging");this.dispatchEvent(event)}if(this.handleDragging){try{this.handleDragging()}catch(e){UIElement.logError("this.handleDragging",e)}}return};function UIVScrollImage(){return}UIVScrollImage.prototype=new UIVScrollView;UIVScrollImage.prototype.initUIVScrollImage=function(t){this.initUIVScrollView(t,0,null,null);this.setImage(UIElement.IMAGE_DEFAULT,null);this.widthAttr=UIElement.WIDTH_SCALE;this.heightAttr=UIElement.HEIGHT_SCALE;this.setSize(200,200);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UIVScrollImage.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e||!e.height){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);return}var i=this.w/e.width;var n=e.height*i;var r=0;var a=this.offset/i;var o=e.width;var s=Math.min(this.h/i,e.height-a);var l=0;var h=0;var u=this.w;var c=s*i;t.drawImage(e,r,a,o,s,l,h,u,c);return};UIVScrollImage.prototype.getScrollRange=function(){var t=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(t&&t.height&&t.width){var e=this.w/t.width;return e*t.height+60}else{return this.h}};UIVScrollImage.prototype.afterPaintChildren=function(t){this.drawScrollBar(t);if(this.isInDesignMode()){this.drawPageDownUp(t)}return};function UIVScrollImageCreator(){var t=["ui-v-scroll-image","ui-v-scroll-image",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIVScrollImage;return e.initUIVScrollImage(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIVScrollImageCreator);function UIPageManager(){}UIPageManager.prototype=new UIFrames;UIPageManager.prototype.isUIPageManager=true;UIPageManager.prototype.initUIPageManager=function(t){return this.initUIFrames(t)};UIPageManager.prototype.beforeAddShapeIntoChildren=function(t){return!t.isUIPage};UIPageManager.prototype.shapeCanBeChild=function(t){return t.isUIPage};UIPageManager.prototype.relayoutChildren=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.left=0;e.top=0;e.w=this.w;e.h=this.h;e.relayoutChildren();e.setUserMovable(false);e.setUserResizable(false)}return};UIPageManager.prototype.showHTML=function(){var t=this.getCurrentFrame();if(t){t.showHTML()}return};UIPageManager.prototype.hideHTML=function(){var t=this.getCurrentFrame();if(t){t.hideHTML()}return};UIPageManager.prototype.switchTo=function(t){var e=this;var i=this.getCurrentFrame();var n=this.getFrame(t);var r=this.current;if(i){i.hideHTML()}if(r<0||r===t||!i||!n){this.showFrame(t);if(n){n.showHTML()}return}function a(){e.showFrame(t);e.postRedraw();return}if(!this.isTopWindow()){a();return}var o=null;var s=null;var l=this.getPositionInScreen();if(t<r){o=AnimationFactory.create("anim-backward");s=UIFrames.preparseBackendCanvas(n,i)}else{o=AnimationFactory.create("anim-forward");s=UIFrames.preparseBackendCanvas(i,n)}o.setScale(this.getRealScale());o.prepare(l.x,l.y,this.w,this.h,s,a);o.run();return};function UIPageManagerCreator(){var t=["ui-page-manager","ui-page-manager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageManager;e.initUIPageManager(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIPageManagerCreator);function UIWaitBar(){return}UIWaitBar.TILES=8;UIWaitBar.prototype=new UIElement;UIWaitBar.prototype.initUIWaitBar=function(t,e,i){this.initUIElement(t);this.offset=0;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);return this};UIWaitBar.prototype.shapeCanBeChild=function(t){return false};UIWaitBar.prototype.step=function(){if(this.isVisible()&&this.getParent()){this.offset++;if(this.isUIWaitBar){this.offset=this.offset%UIWaitBar.TILES}this.postRedraw()}return this};UIWaitBar.prototype.drawBgImage=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){return}if(this.isUIWaitBar){this.drawBgImageBar(t,e)}else{this.drawBgImageBox(t,e)}return};UIWaitBar.prototype.drawBgImageBox=function(t,e){var i=.05*Math.PI*this.offset;this.setRotation(i);UIElement.prototype.drawBgImage.call(this,t);return};UIWaitBar.prototype.onInit=function(){UIElement.prototype.onInit.call(this);var t=this;function e(){t.step();if(t.getParent()){setTimeout(e,50)}}e();return};UIWaitBar.prototype.drawBgImageBar=function(t,e){var i=e.width;var n=e.height;var r=Math.round(n/UIWaitBar.TILES);var a=this.offset*r;var o={x:0,y:a,w:i,h:r};UIElement.drawImageAt(t,e,this.images.display,0,0,this.w,this.h,o);return};function UIWaitBarCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIWaitBar;n.isUIWaitBar=true;return n.initUIWaitBar(this.type,e,i)};return}function UIWaitBoxCreator(t,e,i){var n=[t,t,null,1];ShapeCreator.apply(this,n);this.createShape=function(t){var n=new UIWaitBar;n.isUIWaitBox=true;return n.initUIWaitBar(this.type,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIWaitBarCreator("ui-wait-bar",200,24));ShapeFactoryGet().addShapeCreator(new UIWaitBoxCreator("ui-wait-box",60,60));function UIStaticMap(){return}UIStaticMap.prototype=new UIImage;UIStaticMap.prototype.isUIStaticMap=true;UIStaticMap.prototype.initUIStaticMap=function(t){this.initUIImage(t,200,200,null);return this};UIStaticMap.prototype.setMapProvider=function(t){this.mapProvider=t;return};UIStaticMap.prototype.setMapType=function(t){this.mapType=t;return};UIStaticMap.prototype.setMapZoom=function(t){this.mapZoom=t;return};UIStaticMap.prototype.setMapCenter=function(t){this.mapCenter=t;return};UIStaticMap.prototype.setMapWidth=function(t){this.mapWidth=t;return};UIStaticMap.prototype.setMapHeight=function(t){this.mapHeight=t;return};UIStaticMap.prototype.setMapExtraParams=function(t){this.mapEtraParams=t;return};UIStaticMap.prototype.getMapType=function(){return this.mapType?this.mapType:""};UIStaticMap.prototype.getMapProvider=function(){return this.mapProvider?this.mapProvider:"google"};UIStaticMap.prototype.getMapZoom=function(){return this.mapZoom?this.mapZoom:10};UIStaticMap.prototype.getMapWidth=function(){return this.mapWidth?this.mapWidth:600};UIStaticMap.prototype.getMapHeight=function(){return this.mapHeight?this.mapHeight:600};UIStaticMap.prototype.getMapCenter=function(){if(!this.mapCenter&&this.currentLocation){return this.currentLocation}else{return this.mapCenter?this.mapCenter:"China"}};UIStaticMap.prototype.getMapExtraParams=function(){return this.mapEtraParams?this.mapEtraParams:""};UIStaticMap.prototype.getMapURL=function(){var t="";if(this.mapProvider==="baidu"){t="http://api.map.baidu.com/staticimage?center="+this.getMapCenter()+"&width="+this.getMapWidth()+"&height="+this.getMapHeight()+"&zoom="+this.getMapZoom()+this.getMapExtraParams()}else if(this.mapProvider==="google"){t="http://maps.googleapis.com/maps/api/staticmap?center="+this.getMapCenter()+"&size="+this.getMapWidth()+"x"+this.getMapHeight()+"&zoom="+this.getMapZoom()+"&maptype="+this.getMapType()+"&sensor=true"+this.getMapExtraParams()}console.log("Map URL:"+t);return t};UIStaticMap.prototype.updateMap=function(){var t=this.getMapURL();this.setImageSrc(t);return};UIStaticMap.prototype.onInit=function(){var t=this;function e(e){t.currentLocation=e.coords.latitude+","+e.coords.longitude;t.updateMap();return}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e)}this.updateMap();return};UIStaticMap.prototype.drawImage=function(t){this.drawBgImage(t);return};function UIStaticMapCreator(){var t=["ui-static-map","ui-static-map",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIStaticMap;return e.initUIStaticMap(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIStaticMapCreator);function UIStatusBar(){return}UIStatusBar.prototype=new UIElement;UIStatusBar.prototype.isUIStatusBar=true;UIStatusBar.prototype.initUIStatusBar=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.widthAttr=UIElement.WIDTH_FILL_PARENT;return this};UIStatusBar.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton){return true}return false};UIStatusBar.prototype.afterChildAppended=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;if(this.type==="ui-menu-bar"){t.hideSelectMark=true;t.textType=Shape.TEXT_NONE;this.hideSelectMark=true}return true};UIStatusBar.prototype.beforeRelayoutChild=function(t){t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return true};function UIStatusBarCreator(t,e,i,n){var r=[t,"ui-status-bar",null,true];ShapeCreator.apply(this,r);this.createShape=function(t){var r=new UIStatusBar;return r.initUIStatusBar(this.type,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UIStatusBarCreator("ui-status-bar",640,40,null));ShapeFactoryGet().addShapeCreator(new UIStatusBarCreator("ui-menu-bar",640,96,null));function UIUnkown(){return}UIUnkown.prototype=new UIElement;UIUnkown.prototype.isUIUnkown=true;UIUnkown.prototype.initUIUnkown=function(t){this.initUIElement(t);return this};function UIUnkownCreator(){var t=["ui-unkown","ui-unkown",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIUnkown;return e.initUIUnkown(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIUnkownCreator);function SuggestionProvider(){this.query=function(t,e){};this.init=function(t){};return}function StaticSuggestionProvider(){this.init=function(t){if(typeof t=="string"){t=t.split("\n")}this.options=t;if(this.options){this.options.sort()}return};this.query=function(t,e){if(!t||!this.options){e([]);return}function i(t,e){if(t.indexOf(e)==0){return 0}if(t<e){return-1}else{return 1}}var n=[];var r=this.options.binarySearch(t,i);if(r>=0){var a=this.options.length;for(;r>=0;r--){var o=this.options[r];if(o.indexOf(t)!==0){r=r+1;break}}for(var s=r;s<a;s++){var o=this.options[s];if(o.indexOf(t)===0){n.push(o)}else{break}}}e(n);return};return}function createSuggestionProvider(t,e){var i=null;if(t==="static"){i=new StaticSuggestionProvider}if(i){i.init(e)}return i}function UISuggestion(){return}UISuggestion.prototype=new UIListView;UISuggestion.prototype.isUISuggestion=true;UISuggestion.prototype.initUISuggestion=function(t){this.initUIListView(t,5,100,null);this.maxSuggestionItems=10;this.suggestionProviderParams="";this.suggestionProviderName="static";return this};UISuggestion.prototype.onInit=function(){this.suggestionProvider=createSuggestionProvider(this.suggestionProviderName,this.suggestionProviderParams);return};UISuggestion.prototype.setSuggestionProvider=function(t){this.suggestionProvider=t;return};UISuggestion.prototype.getSuggestionProvider=function(){return this.suggestionProvider};UISuggestion.prototype.onSuggestionSelected=function(t){};UISuggestion.prototype.showSuggestion=function(t){var e={children:[]};if(t.length>this.maxSuggestionItems){t.length=this.maxSuggestionItems}for(var i=0;i<t.length;i++){var n={children:[]};var r=t[i];n.children.push({text:r});e.children.push(n)}this.bindData(e,null,true);return};UISuggestion.prototype.onSuggestionShow=function(){};UISuggestion.prototype.query=function(t){var e=this;this.suggestionProvider.query(t,function(t){e.showSuggestion(t);e.onSuggestionShow()})};function UISuggestionCreator(){var t=["ui-suggestion","ui-suggestion",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISuggestion;return e.initUISuggestion(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISuggestionCreator);function UIButton(){return}UIButton.prototype=new UIElement;UIButton.prototype.isUIButton=true;UIButton.prototype.initUIButton=function(t,e,i){this.initUIElement(t);this.setMargin(5,5);this.setDefSize(e,i);this.setSizeLimit(20,20);this.setAutoScaleFontSize(true);this.setTextType(Shape.TEXT_INPUT);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);this.addEventNames(["onUpdateTransform"]);return this};UIButton.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIButton.prototype.paintSelfOnly=function(t){if(this.pointerDown){var e=this.getHtmlImageByType(UIElement.IMAGE_ACTIVE);if(!e){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}}return};function UIButtonCreator(t,e){var i=["ui-button","ui-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIButton;return n.initUIButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIButtonCreator(120,60));function UIMLEdit(){return}UIMLEdit.prototype=new UIElement;UIMLEdit.prototype.isUIMLEdit=true;UIMLEdit.prototype.saveProps=["inputTips"];UIMLEdit.prototype.initUIMLEdit=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setText("");this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_FOCUSED,null);this.setMargin(12,12);this.addEventNames(["onChanged","onFocusIn","onFocusOut"]);this.setTextAlignV("top");this.setTextAlignH("left");return this};UIMLEdit.prototype.drawText=function(t){if(!this.text||this.editing){return}if(this.textNeedRelayout){this.layoutText(t)}return this.defaultDrawText(t)};UIMLEdit.prototype.shapeCanBeChild=function(t){return false};UIMLEdit.prototype.textEditable=function(t){return true};UIMLEdit.prototype.onClick=function(t,e){if(e){return}if(!this.isInDesignMode()){this.editText()}return this.callOnClickHandler(t)};UIMLEdit.prototype.isFocused=function(){return this.editing};UIMLEdit.prototype.getEditorRect=function(){var t=this.getPositionInView();var e=CantkRT.getMainCanvasPosition();var i=this.view.getAbsPosition();var n=this.view.getViewScale();var r=UIElement.getMainCanvasScale();var a=(i.x+t.x*n)/r.x+e.x;var o=(i.y+t.y*n)/r.y+e.y;var s=this.getWidth()*n/r.x;var l=this.getHeight()*n/r.y;var h={x:a,y:o,w:s,h:l};if(this.isInDesignMode()){var u=window.devicePixelRatio||1;h.x*=u;h.y*=u;h.w*=u;h.h*=u}return h};UIMLEdit.prototype.editText=function(t){if(this.textEditable(t)){var e=this;var i=this.getEditorRect();var n=this.getRealScale()/UIElement.getMainCanvasScale().y;var r=this.inputType?this.inputType:"text";var a=this.style.fontSize*n;var o=cantkShowTextArea(this.getText(),a,i.x,i.y,i.w,i.h);e.editing=true;o.setTextColor(this.style.textColor);o.showBorder(this.isInDesignMode());o.show();function s(t){if(t!==e.text){e.setText(t,true);e.postRedraw()}else{e.text=t}o.setOnChangedHandler(null);o.setOnChangeHandler(null);o.hide();delete e.editing;e.callOnFocusOutHandler();return}function l(t){e.callOnChangingHandler(t)}o.setOnChangedHandler(s);o.setOnChangeHandler(l);this.callOnFocusInHandler()}return};UIMLEdit.prototype.getTextTipsPosition=function(){var t={};t.x=this.hMargin;t.y=this.vMargin;t.textAlign="left";t.textBaseline="top";return t};function UIMLEditCreator(t,e){var i=["ui-mledit","ui-mledit",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIMLEdit;return n.initUIMLEdit(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIMLEditCreator(300,300));function UIToolBar(){return}UIToolBar.prototype=new UIElement;UIToolBar.prototype.isUIToolBar=true;UIToolBar.prototype.initUIToolBar=function(t,e,i,n){this.initUIElement(t);this.xAttr=UIElement.X_LEFT_IN_PARENT;this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.yAttr=e?UIElement.Y_TOP_IN_PARENT:UIElement.Y_BOTTOM_IN_PARENT;this.setDefSize(200,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,n);this.setSizeLimit(100,50,2e3,200);return this};UIToolBar.prototype.shapeCanBeChild=function(t){if(t.isUILabel||t.isUIImage||t.isUIButton||t.isUIGroup||t.isUIButtonGroup||t.isUIEdit||t.isUIImageButton||t.isUICheckBox||t.isUIRadioBox||t.isUIProgressBar||t.isUISwitch||t.isUILedDigits||t.isUIGroup||t.isUILayout||t.isUIWaitBar||t.isUIColorBar){return true}return false};UIToolBar.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}return};function UIToolBarCreator(t,e,i,n){var r=[t,"ui-toolbar",null,1];ShapeCreator.apply(this,r);this.createShape=function(r){var a=new UIToolBar;return a.initUIToolBar(t,e,i,n)};return}ShapeFactoryGet().addShapeCreator(new UIToolBarCreator("ui-toolbar",true,85,null));function UIPlaceholder(){return}UIPlaceholder.prototype=new UIElement;UIPlaceholder.prototype.isUIPlaceholder=true;UIPlaceholder.prototype.initUIPlaceholder=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,false);return this};UIPlaceholder.prototype.shapeCanBeChild=function(t){return false};UIPlaceholder.prototype.paintSelfOnly=function(t){if(this.isInDesignMode()){var e=this.vMargin;var i=this.hMargin;var n=this.getWidth(true);var r=this.getHeight(true);t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;drawDashedRect(t,e,i,n,r);t.stroke()}return};function UIVPlaceholderCreator(t,e){var i=["ui-v-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIPlaceholder;n.initUIPlaceholder(this.type,t,e);n.widthAttr=UIElement.WIDTH_FILL_PARENT;n.MIN_SIZE=4;n.setSizeLimit(20,4);return n};return}function UIHPlaceholderCreator(t,e){var i=["ui-h-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIPlaceholder;n.initUIPlaceholder(this.type,t,e);n.heightAttr=UIElement.HEIGHT_FILL_PARENT;n.MIN_SIZE=4;n.setSizeLimit(4,20);return n};return}ShapeFactoryGet().addShapeCreator(new UIVPlaceholderCreator(100,20));ShapeFactoryGet().addShapeCreator(new UIHPlaceholderCreator(20,100));function UIRadioBox(){return}UIRadioBox.prototype=new UICheckBox;UIRadioBox.prototype.isUIRadioBox=true;UIRadioBox.prototype.initUIRadioBox=function(t){return this.initUICheckBox(t)};UIRadioBox.prototype.setParent=function(t){UIElement.prototype.setParent.call(this,t);if(this.value){this.setChecked()}return this};UIRadioBox.prototype.onFromJsonDone=function(){if(this.value){this.setChecked()}return this};UIRadioBox.prototype.setChecked=function(){var t=this.getParent();if(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.isUIRadioBox){i.setValue(false)}}}this.setValue(true);return this};UIRadioBox.prototype.onClick=function(t,e){if(e){return}this.setChecked();return this.callOnClickHandler(t)};function UIRadioBoxCreator(t,e){var i=["ui-radiobox","ui-radiobox",null,1];ShapeCreator.apply(this,i);this.createShape=function(t){var e=new UIRadioBox;e.initUIRadioBox(this.type);return e};return}ShapeFactoryGet().addShapeCreator(new UIRadioBoxCreator(50,50,null,null,null,null,null,null));function UILedDigits(){return}UILedDigits.prototype=new UIElement;UILedDigits.prototype.isUILedDigits=true;UILedDigits.prototype.initUILedDigits=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);return this};UILedDigits.prototype.shapeCanBeChild=function(t){return false};UILedDigits.prototype.setText=function(t){this.text="";t=this.toText(t);for(var e=0;e<t.length;e++){var i=t[e];switch(i){case".":case":":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"F":case"F":{this.text=this.text+i}default:break}}return};UILedDigits.prototype.drawBarVL=function(t,e,i){t.beginPath();t.moveTo(0,0);t.lineTo(0,i);t.lineTo(e,i-e);t.lineTo(e,e);t.lineTo(0,0);return};UILedDigits.prototype.drawBarVR=function(t,e,i){t.beginPath();t.moveTo(e,0);t.lineTo(e,i);t.lineTo(0,i-e);t.lineTo(0,e);t.lineTo(e,0);return};UILedDigits.prototype.drawBarHT=function(t,e,i){t.beginPath();t.moveTo(0,0);t.lineTo(e,0);t.lineTo(e-i,i);t.lineTo(i,i);t.lineTo(0,0);return};UILedDigits.prototype.drawBarHM=function(t,e,i){t.beginPath();var n=Math.round(i/3);e=e-2*n;t.translate(n,0);t.moveTo(0,i/2);t.lineTo(i/2,0);t.lineTo(e-i/2,0);t.lineTo(e,i/2);t.lineTo(e-i/2,i);t.lineTo(i/2,i);t.lineTo(0,i/2);t.translate(-n,0);return};UILedDigits.prototype.drawBarHB=function(t,e,i){t.beginPath();t.moveTo(0,i);t.lineTo(e,i);t.lineTo(e-i,0);t.lineTo(i,0);t.lineTo(0,i);return};UILedDigits.prototype.drawBar=function(t,e,i){if(e<i){this.drawBarV(t,e,i)}else{this.drawBarH(t,e,i)}return};UILedDigits.prototype.drawDot=function(t,e,i,n){var r=(e/4+i/8)/2;if(n==="."){t.fillRect((e-r)/2,.75*i-r/2,r,r)}else if(n=":"){t.fillRect((e-r)/2,.25*i-r/2,r,r);t.fillRect((e-r)/2,.75*i-r/2,r,r)}return};UILedDigits.prototype.map={0:125,1:96,2:55,3:103,4:106,5:79,6:95,7:97,8:127,9:111,E:31,F:27,H:122};UILedDigits.prototype.fillBar=function(t,e){if(e){t.fillStyle=this.style.textColor;t.fill()}else{t.lineWidth=1;t.strokeStyle=this.style.lineColor;t.stroke()}return};UILedDigits.prototype.drawDigit=function(t,e,i,n){var r=Math.max(3,Math.round(i/10));var a=Math.max(3,Math.round(e/10));var o=Math.round((a+r)/2);var s=1;var l=e-2*s;var h=Math.floor(i/2-2*s);var u=this.map[n];t.translate(s,0);this.drawBarHT(t,l,o);t.translate(-s,0);this.fillBar(t,u&1);var c=Math.floor((i-r)/2);t.translate(s,c);this.drawBarHM(t,l,o);t.translate(-s,-c);this.fillBar(t,u>>1&1);var c=i-r;t.translate(s,c);this.drawBarHB(t,l,o);t.translate(-s,-c);this.fillBar(t,u>>2&1);t.translate(0,s);this.drawBarVL(t,o,h);t.translate(0,-s);this.fillBar(t,u>>3&1);var c=Math.round(2*s+(i-r)/2)+s;t.translate(0,c);this.drawBarVL(t,o,h);t.translate(0,-c);this.fillBar(t,u>>4&1);t.translate(e-o,s);this.drawBarVR(t,o,h);t.translate(-(e-o),-s);this.fillBar(t,u>>5&1);t.translate(e-o,c);this.drawBarVR(t,o,h);t.translate(-(e-o),-c);this.fillBar(t,u>>6&1);return};UILedDigits.prototype.drawDigits=function(t){var e=0;var i=this.text;var n=i.length;if(!n){return}for(var r=0;r<n;r++){var a=i[r];if(a==="."||a===":"){e=e+1}}var o=this.w/n*.2;var s=this.w/n-o;var l=this.h;t.save();t.translate(s/4*e,0);for(var r=0;r<n;r++){var a=i[r];if(a==="."||a===":"){this.drawDot(t,s/2,l,i[r]);t.translate(s/2+o,0)}else{this.drawDigit(t,s,l,i[r]);t.translate(s+o,0)}}t.restore();return};UILedDigits.prototype.paintSelfOnly=function(t){if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}t.fillStyle=this.style.lineColor;this.drawDigits(t);return};function UILedDigitsCreator(t,e){var i=["ui-led-digits","ui-led-digits",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UILedDigits;return n.initUILedDigits(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UILedDigitsCreator(100,100));function UICanvas(){return}UICanvas.prototype=new UIElement;UICanvas.prototype.isUICanvas=true;UICanvas.prototype.initUICanvas=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.addEventNames(["onPaint","onPointerDown","onPointerMove","onPointerUp","onKeyDown","onKeyUp"]);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.setImage("option_image_11",null);this.setImage("option_image_12",null);this.setImage("option_image_13",null);this.setImage("option_image_14",null);return this};UICanvas.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUIButton||t.isUIGroup||t.isUILabel};UICanvas.prototype.paintSelfOnly=function(t){var e=this.getHtmlImageByType(UIElement.IMAGE_DEFAULT);if(!e&&!this.isFillColorTransparent()){t.beginPath();t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h)}t.beginPath();this.callOnPaintHandler(t);return};function UICanvasCreator(t,e){var i=["ui-canvas","ui-canvas",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UICanvas;return n.initUICanvas(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UICanvasCreator(200,200));function UIColorButton(){return}UIColorButton.prototype=new UIElement;UIColorButton.prototype.isUIButton=true;UIColorButton.prototype.isUIColorButton=true;UIColorButton.prototype.initUIColorTile=function(t,e,i){this.initUIColorButton(t,e,i);this.isUIButton=false;this.isUIColorButton=false;this.isUIColorTile=true;this.setAutoScaleFontSize(true);this.addEventNames(["onUpdateTransform"]);this.style.roundStyle="a";return this};UIColorButton.prototype.initUIColorButton=function(t,e,i){this.initUIElement(t);this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_INPUT);this.setCanRectSelectable(false,false);this.setMargin(0,0);this.addEventNames(["onUpdateTransform"]);return this};UIColorButton.prototype.shapeCanBeChild=UIGroup.prototype.shapeCanBeChild;UIColorButton.prototype.setRoundStyle=function(t){this.style.roundStyle=t;return this};UIColorButton.prototype.getRoundStyle=function(){return this.style.roundStyle};UIColorButton.prototype.setActiveFillColor=function(t){this.style.activeFillColor=t;return this};UIColorButton.prototype.getRoundStyleValue=function(){var t=this.style.roundStyle;if(t==="t"){return RoundRect.TL|RoundRect.TR}else if(t==="l"){return RoundRect.TL|RoundRect.BL}else if(t==="r"){return RoundRect.TR|RoundRect.BR}else if(t==="b"){return RoundRect.BL|RoundRect.BR}else{return RoundRect.TL|RoundRect.TR|RoundRect.BL|RoundRect.BR}};UIColorButton.prototype.paintSelfOnly=function(t){var e=this.getRoundStyleValue();var i=this.style.fillColor;var n=this.style.lineColor;if(this.pointerDown&&this.style.activeFillColor){i=this.style.activeFillColor}var r=!Shape.isTransparentColor(i);var a=!Shape.isTransparentColor(n);if(!r&&!a){return}t.save();t.beginPath();t.translate(this.hMargin,this.vMargin);drawRoundRect(t,this.w-2*this.hMargin,this.h-2*this.vMargin,this.roundRadius,e);if(r){t.fillStyle=i;t.fill()}if(a){if(this.isUIColorButton&&this.pointerDown){t.lineWidth=this.style.lineWidth+1}else{t.lineWidth=this.style.lineWidth}t.strokeStyle=n;t.stroke()}t.restore();return};function UIColorTileCreator(t,e){var i=["ui-color-tile","ui-color-tile",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorButton;return n.initUIColorTile(this.type,t,e)};return}function UIColorButtonCreator(t,e){var i=["ui-color-button","ui-color-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIColorButton;return n.initUIColorButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIColorTileCreator(80,80));ShapeFactoryGet().addShapeCreator(new UIColorButtonCreator(80,80));function UIViewPager(){return}UIViewPager.prototype=new UIPageManager;UIViewPager.prototype.isUIViewPager=true;UIViewPager.prototype.saveProps=["slideToChange"];UIViewPager.prototype.initUIViewPager=function(t){this.initUIPageManager(t);this.current=0;this.setDefSize(200,200);this.setTextType(UIElement.TEXT_NONE);this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator(2);this.animateQueue=[];return this;
};UIViewPager.prototype.getPrevFrame=function(){var t=this.children.length;var e=(this.current-1+t)%t;return this.children[e]};UIViewPager.prototype.getNextFrame=function(){var t=this.children.length;var e=(this.current+1)%t;return this.children[e]};UIViewPager.prototype.animScrollTo=function(t,e){var i=1e3;var n=this;var r=this.offset;var a=Date.now();var o=this.interpolator;if(n.animating){return}n.animating=true;function s(){var l=Date.now();var h=(l-a)/i;var u=o.get(h);if(h<1&&!n.halt){n.offset=r+t*u;setTimeout(s,16)}else{n.offset=0;n.setCurrent(e);n.setAnimatingFrames(null,null);delete a;delete o;delete n.animating;delete n.halt;n.queueAnimation()}n.postRedraw()}s();return};UIViewPager.prototype.onPointerDownRunning=function(t,e){if(e||this.animating||!this.slideToChange){return}if(this.isEventHandledByChild()){return}this.setEventHandled();this.velocityTracker.clear();return true};UIViewPager.prototype.isEventHandledByChild=function(){if(UIElement.hScrollHandledBy&&UIElement.hScrollHandledBy!==this){return true}else{return false}};UIViewPager.prototype.setEventHandled=function(){UIElement.hScrollHandledBy=this;return this};UIViewPager.prototype.onPointerMoveRunning=function(t,e){if(!this.slideToChange||e||!this.pointerDown){return}if(this.animating){this.setEventHandled();return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.current;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var r=Math.abs(this.getMoveAbsDeltaX());var a=Math.abs(this.getMoveAbsDeltaY());if(r>a&&r>10){this.offset=this.getMoveAbsDeltaX();this.setAnimatingFrames(this.getPrevFrame(),this.getNextFrame())}else{this.offset=0;this.setAnimatingFrames(null,null)}this.addMovementForVelocityTracker();return};UIViewPager.prototype.onPointerUpRunning=function(t,e){if(!this.slideToChange||e||!this.pointerDown){return}if(this.animating){this.setEventHandled();return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.current;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var a=0;var o=this.offset;var s=this.current;var l=Math.abs(this.getMoveAbsDeltaY());var h=this.velocityTracker.getVelocity().x;if(Math.abs(o)<5||l>60){this.offset=0;return}var u=this.children.length;var c=o+h;if(Math.abs(c)>this.w/3){if(o>0){a=this.w-o;s=(this.current-1+u)%u}else{a=-this.w-o;s=(this.current+1)%u}}else{a=-o}this.animScrollTo(a,s);return};UIViewPager.prototype.setAnimatingFrames=function(t,e){this.leftFrame=t;this.rightFrame=e;return this};UIViewPager.prototype.switchTo=function(t){var e=this.children;var i=e.length;this.offset=0;if(t<0||t>i-1){return}if(this.animateQueue===undefined){this.animateQueue=[]}this.animateQueue.push(t);if(this.animating){console.log("busy...");this.halt=true;return}this.queueAnimation();return this};UIViewPager.prototype.queueAnimation=function(){if(this.animateQueue.length<1){return}var t=this.children;var e=this.animateQueue.pop();this.animateQueue=[];var i=t[e];if(e<this.current){this.animScrollTo(this.w,e);this.setAnimatingFrames(i,null)}else{this.animScrollTo(-this.w,e);this.setAnimatingFrames(null,i)}};UIViewPager.prototype.paintChildrenAnimating=function(t){var e=this.getCurrentFrame();var i=this.leftFrame;var n=this.rightFrame;t.save();t.clipRect(0,0,this.w,this.h);if(this.offset>0){var r=this.w-this.offset;i.x=-r;i.paintSelf(t);r=this.offset;e.x=r;e.paintSelf(t)}else{e.x=this.offset;e.paintSelf(t);n.x=this.w+this.offset;n.paintSelf(t)}if(e){e.x=0}if(n){n.x=0}if(i){i.x=0}t.restore();return};UIViewPager.prototype.paintChildrenNormal=function(t){var e=this.getCurrentFrame();if(e){t.save();t.beginPath();e.paintSelf(t);t.restore()}return};UIViewPager.prototype.paintChildren=function(t){if(this.offset&&this.children.length>1&&(this.leftFrame||this.rightFrame)){this.paintChildrenAnimating(t)}else{this.paintChildrenNormal(t)}return};UIViewPager.prototype.setSlideToChange=function(t){this.slideToChange=t;return};function UIViewPagerCreator(){var t=["ui-view-pager","ui-view-pager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIViewPager;return e.initUIViewPager(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIViewPagerCreator);function UIProgressBar(){return}UIProgressBar.prototype=new UIElement;UIProgressBar.prototype.isUIProgressBar=true;UIProgressBar.prototype.saveProps=["stepSize","minValue","maxValue"];UIProgressBar.prototype.initUIProgressBar=function(t,e,i,n){this.initUIElement(t);this.setRange(0,100);this.setPercent(50);this.setDefSize(e,i);this.setStepSize(0);this.roundRadius=0;this.setInteractive(n);this.setTextType(Shape.TEXT_INPUT);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_NORMAL_FG,null);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;if(n){this.addEventNames(["onChanged"]);this.addEventNames(["onChanging"])}return this};UIProgressBar.prototype.shapeCanBeChild=function(t){if(this.dragger){return false}return t.isUIImage||t.isUILabel||t.isUIColorTile};UIProgressBar.prototype.updateDraggerParams=function(){var t=this.dragger;if(!t)return;if(this.w<this.h){t.yAttr=UIElement.Y_FIX_TOP;t.xAttr=UIElement.X_CENTER_IN_PARENT;t.widthAttr=UIElement.WIDTH_FILL_PARENT;t.heightAttr=UIElement.HEIGHT_FIX}else{t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;t.xAttr=UIElement.X_FIX_LEFT;t.widthAttr=UIElement.WIDTH_FIX;t.heightAttr=UIElement.HEIGHT_FILL_PARENT}};UIProgressBar.prototype.relayoutChildren=function(){if(!this.dragger){return}if(this.w>this.h){var t=this.value*(this.w-this.dragger.w);var e=this.w-this.dragger.w;this.dragger.setLeft(Math.max(0,Math.min(e,t)))}else{var i=(1-this.value)*(this.h-this.dragger.h);var n=this.h-this.dragger.h;this.dragger.setTop(Math.max(0,Math.min(n,i)))}UIElement.prototype.relayoutChildren.call(this);return};UIProgressBar.prototype.resizeDragger=function(){if(this.dragger){var t=this.dragger.w;var e=this.dragger.h;if(this.w>this.h){e=this.h;t=Math.min(this.h,t)}else{t=this.w;e=Math.min(this.w,e)}this.dragger.setSize(t,e)}return this};UIProgressBar.prototype.setStepSize=function(t){var e=this.maxValue-this.minValue;this.stepSize=Math.max(0,Math.min(t,e));return this};UIProgressBar.prototype.setRange=function(t,e){this.minValue=Math.max(0,Math.min(t,e));this.maxValue=Math.max(0,Math.max(t,e));if(this.minValue===this.maxValue){this.minValue=0;this.maxValue=100}return this};UIProgressBar.prototype.getStepSize=function(){return this.stepSize||0};UIProgressBar.prototype.getMinValue=function(){return this.minValue};UIProgressBar.prototype.getMaxValue=function(){return this.maxValue};UIProgressBar.prototype.afterChildRemoved=function(t){if(t===this.dragger){this.dragger=null}};UIProgressBar.prototype.afterChildAppended=function(t){var e=this;this.dragger=t;this.updateDraggerParams();this.setTextType(Shape.TEXT_NONE);e.onPointerDownRunning=e.onPointerMoveRunning=function(t,e){if(e){return}var i=this.dragger.w>>1;var n=this.dragger.h>>1;if(this.pointerDown&&this.dragger){var r=t.x-i;var a=t.y-n;r=Math.min(Math.max(-2,r),this.w-i+2);a=Math.min(Math.max(-2,a),this.h-n+2);this.dragger.move(r,a)}return};e.onPointerUpRunning=function(t,e){if(e){return}if(this.changed){this.changed=false;this.callOnChangedHandler(this.getValue())}return};e.onSized=function(){var t=Math.min(this.w,this.h);this.updateLayoutParams();this.setPercent(this.getPercent());this.resizeDragger();this.updateDraggerParams();return};t.onSized=function(){e.resizeDragger()};t.onMoved=function(){var t=0;if(e.w>e.h){var i=this.left/(e.w-this.w);t=i*100;if(this.left<=0){t=0}if(this.left+this.w>=e.w){t=100}}else{var i=(e.h-this.h-this.top)/(e.h-this.h);t=i*100;if(this.top<=0){t=100}if(this.top+this.h>=e.h){t=0}}e.changed=true;e.setPercentOnly(t);e.callOnChangingHandler(e.getValue());return};return};UIProgressBar.prototype.setInteractive=function(t){this.interactive=t;return this};UIProgressBar.prototype.fixPercent=function(t,e){var i=t;if(e&&t<100){var n=this.maxValue-this.minValue;var r=Math.round(t/100*n/e)*e;i=r/n*100}return Math.min(i,100)/100};UIProgressBar.prototype.setPercentOnly=function(t,e,i){var n=this.stepSize;var r=this.fixPercent(t,this.stepSize);if(!i){this.value=r;this.relayoutChildren()}if(this.isInDesignMode()||!this.isVisible()){return this}if(!i){if(e){this.callOnChangedHandler(this.getValue())}}else{if(this.value==r)return this;this.setupAnimation({notify:e,valueStart:this.value,valueEnd:r})}return this};UIProgressBar.prototype.setupAnimation=function(t){var e=this;var i={duration:300,actionWhenBusy:"replace",onStep:function(t,i,n){e.value=n.value;e.relayoutChildren();return true},onDone:function(i,n){e.value=t.valueEnd;if(t.notify){e.callOnChangedHandler(e.getValue())}}};if(!t){t=i}else{var n=Object.keys(i);for(var r=0,a=n.length;r<a;r++){var o=n[r];if(!t[o]){t[o]=i[o]}}}this.animate(t);return this};UIProgressBar.prototype.setPercent=function(t,e,i){t=Math.max(0,Math.min(t,100));this.setPercentOnly(t,e,i);this.relayoutChildren();return this};UIProgressBar.prototype.getPercent=function(){return this.value*100};UIProgressBar.prototype.getValue=function(){var t=this.maxValue-this.minValue;var e=this.minValue+this.value*t;var i=this.stepSize;if(i){var n=Math.floor(e/i)*i;e=Math.max(e,n)}return Math.min(this.maxValue,Math.round(e))};UIProgressBar.prototype.setValue=function(t,e,i){var n=this.maxValue-this.minValue;var r=100*((t-this.minValue)/n);this.setPercent(r,e,i);return this};UIProgressBar.prototype.drawText=function(t){var e=Math.round(this.getPercent())+"%";if(!this.isTextColorTransparent()){t.font=this.style.getFont();t.fillStyle=this.getTextColor();t.textBaseline="middle";t.textAlign="center";t.fillText(e,this.w>>1,this.h>>1)}return};UIProgressBar.prototype.paintSelfOnly=function(t){};UIProgressBar.prototype.drawBgImageV=function(t){var e=null;var i=this.w>>1;var n=this.w-i>>1;var r=this.style.lineColor;var a=this.style.fillColor;var o=this.roundRadius?this.roundRadius:0;var s=this.getImageByType(UIElement.IMAGE_DEFAULT);if(s&&s.getImage()){var l=s.getImageRect();e=s.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,l)}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,n,0,i,this.h,l)}}else if(!Shape.isTransparentColor(a)){t.beginPath();t.translate(n,0);drawRoundRect(t,i,this.h,o);t.translate(-n,0);t.fillStyle=this.style.fillColor;t.fill()}s=this.getImageByType(UIElement.IMAGE_NORMAL_FG);var h=Math.round(this.h*this.value);var u=this.h-h;if(s&&s.getImage()){var l=s.getImageRect();e=s.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){var c=l.h;var p=l.y;var f=l.rh;var m=Math.round(c*this.value);l.h=m;l.y=l.y+c-m;l.h=m;l.rh=Math.round(f*this.value);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,u,this.w,h,l);l.y=p;l.h=c;l.rh=f}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,n,u,i,h,l)}}else if(!Shape.isTransparentColor(r)){if(h>2*o){t.beginPath();t.translate(n,u);drawRoundRect(t,i,h,o);t.fillStyle=this.style.lineColor;t.fill()}}return};UIProgressBar.prototype.drawBgImageH=function(t){var e=null;var i=this.h>>1;var n=this.h-i>>1;var r=this.style.lineColor;var a=this.style.fillColor;var o=this.roundRadius?this.roundRadius:0;var s=this.getImageByType(UIElement.IMAGE_DEFAULT);if(s&&s.getImage()){var l=s.getImageRect();e=s.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,l)}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,0,n,this.w,i,l)}}else if(!Shape.isTransparentColor(a)){t.beginPath();t.translate(0,n);drawRoundRect(t,this.w,i,o);t.translate(0,-n);t.fillStyle=this.style.fillColor;t.fill()}var h=Math.round(this.w*this.value);var s=this.getImageByType(UIElement.IMAGE_NORMAL_FG);if(s&&s.getImage()){var l=s.getImageRect();e=s.getImage();if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){var u=l.w;var c=l.rw;l.w=Math.round(l.w*this.value);l.rw=Math.round(l.rw*this.value);WImage.draw(t,e,UIElement.IMAGE_DISPLAY_SCALE,0,0,h,this.h,l);l.w=u;l.rw=c}else{WImage.draw(t,e,UIElement.IMAGE_DISPLAY_9PATCH,0,n,h,i,l)}}else if(!Shape.isTransparentColor(r)){if(h>2*o){t.beginPath();t.translate(0,n);drawRoundRect(t,h,i,o);t.fillStyle=this.style.lineColor;t.fill()}}return};UIProgressBar.prototype.drawCircle=function(t){var e=this.w>>1;var i=this.h>>1;var n=Math.min(e,i);var r=Math.PI*2*this.value-.5*Math.PI;var a=Math.min(n,Math.max(this.style.lineWidth,5));var o=this.getImageByType(UIElement.IMAGE_NORMAL_FG);var s=this.getImageByType(UIElement.IMAGE_DEFAULT);if(s&&s.getImage()){var l=s.getImage();var h=s.getImageRect();WImage.draw(t,l,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,h)}else if(!this.isFillColorTransparent()){t.beginPath();t.arc(e,i,n,0,Math.PI*2);t.fillStyle=this.style.fillColor;t.fill()}if(o&&o.getImage()){t.beginPath();t.moveTo(n,n);t.lineTo(n,0);t.arc(e,i,n,-Math.PI*.5,r);t.lineTo(n,n);t.clip();var l=o.getImage();var h=o.getImageRect();WImage.draw(t,l,UIElement.IMAGE_DISPLAY_SCALE,0,0,this.w,this.h,h)}else if(!this.isStrokeColorTransparent()){n=n-(a>>1);t.beginPath();t.lineCap="round";t.lineWidth=a;t.arc(e,i,n,-Math.PI*.5,r);t.strokeStyle=this.style.lineColor;t.stroke()}return};UIProgressBar.prototype.drawBgImage=function(t){t.save();if(Math.abs(this.w-this.h)<10){this.drawCircle(t)}else if(this.w>this.h){this.drawBgImageH(t)}else{this.drawBgImageV(t)}t.restore()};UIProgressBar.prototype.onFromJsonDone=function(){this.setPercent(this.getPercent());return};function UIProgressBarCreator(t,e,i){var n=i?"ui-slider":"ui-progressbar";var r=[n,"ui-progressbar",null,1];ShapeCreator.apply(this,r);this.createShape=function(n){var r=new UIProgressBar;return r.initUIProgressBar(this.type,t,e,i)};return}ShapeFactoryGet().addShapeCreator(new UIProgressBarCreator(200,45,false));ShapeFactoryGet().addShapeCreator(new UIProgressBarCreator(200,45,true));function UIWindowManager(){}UIWindowManager.prototype=new UIFrames;UIWindowManager.prototype.isUIWindowManager=true;UIWindowManager.prototype.saveProps=["current","sceneIdIndex"];UIWindowManager.prototype.initUIWindowManager=function(t){this.settings={};this.initUIFrames(t);this.history=new Array;this.showLoadingProgress=true;this.setImage("force-landscape-tips",null);this.setImage("force-portrait-tips",null);this.soundMusicAutoPlay=true;this.setSoundEffectsEnable(true);this.loadedAssets={};UIWindowManager.instance=this;return this};UIWindowManager.getInstance=function(){return UIWindowManager.instance};UIWindowManager.prototype.fromJson=function(t){this.jsonData=t;return RShape.prototype.fromJson.call(this,t)};UIWindowManager.prototype.onImageLoadDone=function(t,e){if(!t){return}};UIWindowManager.prototype.onImageLoadErr=function(t){console.log("onImageLoadErr:"+t)};UIWindowManager.prototype.onJsonLoadDone=function(t,e){};UIWindowManager.prototype.onJsonLoadErr=function(t){console.log("onJsonLoadErr:"+t)};UIWindowManager.prototype.loadElementAssets=function(t){if(t.images){for(var e in t.images){var i=t.images[e];if(typeof i==="string"){WImage.create(i,this.onImageLoadDone.bind(this))}}}var n=UIElement.jsonAssets;for(var r=0;r<n.length;r++){var e=n[r];var i=t[e];if(i){if(i.endWith(".json")){ResLoader.loadJson(i,this.onJsonLoadDone.bind(this),this.onJsonLoadErr.bind(this))}else{ResLoader.loadData(i,this.onJsonLoadDone.bind(this),this.onJsonLoadErr.bind(this))}}}var a=UIElement.imagesAssets;for(var r=0;r<a.length;r++){var e=a[r];var i=t[e];if(i){WImage.create(i,this.onImageLoadDone.bind(this))}}var o=t.children;for(var r=0;r<o.length;r++){var s=o[r];this.loadElementAssets(s)}return this};UIWindowManager.prototype.clearAssetsCache=function(t){WImage.clearCache(t);ResLoader.clearCache(t);return this};UIWindowManager.prototype.loadAssets=function(t,e,i){var n=this;t=t||this.getWindowNames();if(AssetsDownloader.isAvailable()){AssetsDownloader.downloadMulti(t,i,function(){n.doLoadAssets(t,e)})}else{n.doLoadAssets(t,e)}return this};UIWindowManager.prototype.shouldShowAssetsLoadingProgress=function(t){return!this.isAssetsLoaded(t)&&this.assetsLoadingWin};UIWindowManager.prototype.isAssetsLoaded=function(t){return this.loadedAssets[t]};UIWindowManager.prototype.doLoadAssets=function(t,e){var i=[];var n=this;function r(t){if(e){e(t.percent,t.finished,t.total)}if(t.finished>=t.total){ResLoader.off(ResLoader.EVENT_ASSETS_LOAD_PROGRESS,r);for(var a=0;a<i.length;a++){var o=i[a];n.loadedAssets[o]=true}i=null}}var a=this.jsonData.children;for(var o=0;o<a.length;o++){var s=a[o];if(!t||t.indexOf(s.name)>=0){i.push(s.name);this.loadElementAssets(s)}}if(ResLoader.isLoadCompleted()){setTimeout(function(){r({percent:100,finished:100,total:100})},10)}else{ResLoader.on(ResLoader.EVENT_ASSETS_LOAD_PROGRESS,r)}return this};UIWindowManager.prototype.onFromJsonDone=function(){this.designWidth=this.w;this.designHeight=this.h;this.forcePortrait=false;this.forceLandscape=false;return};UIWindowManager.prototype.beforeAddShapeIntoChildren=function(t){return!t.isUIWindow};UIWindowManager.prototype.getMainWindow=function(){var t=this.children;var e=t.length;for(var i=0;i<e;i++){var n=t[i];if(n.isUILoadingWindow)continue;if(n.isUINormalWindow&&n.windowType==="main"){return n}}for(var i=0;i<e;i++){var n=t[i];if(n.isUILoadingWindow)continue;if(n.isUINormalWindow){return n}}return null};UIWindowManager.prototype.getWindowNames=function(t){var e=[];var i=this.children;var n=i.length;for(var r=0;r<n;r++){var a=i[r];if(a!==t){e.push(a.name)}}return e};UIWindowManager.prototype.setInitWindow=function(t){if(t===null||t===undefined){this.initWindowIndex=null}else{this.initWindowIndex=Math.max(0,Math.min(t,this.children.length-1))}return this};UIWindowManager.prototype.getInitWindow=function(){var t=null;if(this.initWindowIndex||this.initWindowIndex===0){t=this.children[this.initWindowIndex]}if(!t){var e=cantkGetQueryParam("initwin");if(e){t=this.find(e)}}if(!t){var e=this.preferInitWindow;if(e){t=this.find(e)}}if(!t){t=this.getMainWindow()}if(!t||t.isUILoadingWindow){return null}return t};UIWindowManager.prototype.waitDeviceRotate=function(){var t=this;if(this.isDeviceDirectionOK()){this.doShowInitWindow()}else{setTimeout(function(){t.waitDeviceRotate()},100)}};UIWindowManager.prototype.showInitWindow=function(t){this.preferInitWindow=t;this.waitDeviceRotate()};UIWindowManager.prototype.doShowInitWindow=function(){this.history.clear();var t=this.getInitWindow();if(t){this.targetShape=t;t.prepareForOpen();index=this.getFrameIndex(t);this.showFrame(index);t.callOnBeforeOpen();t.callOnOpen();this.history.push(index);this.postRedraw();console.log("showInitWindow: set targetShape:"+this.targetShape.name)}else{console.log("Not Found Init Window.")}return true};UIWindowManager.prototype.callOnLoad=function(){this.resLoadDone=true;for(var t=0;t<this.children.length;t++){var e=this.children[t];try{e.callOnLoadHandler()}catch(i){console.log("Call onLoad fail:"+i.message)}}return true};UIWindowManager.prototype.callOnUnload=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnUnloadHandler()}return true};UIWindowManager.prototype.onResLoadDone=function(){this.callOnLoad();this.showInitWindow();return};UIWindowManager.prototype.getStartLoadingWindow=function(){var t=this.children;var e=t.length;for(var i=0;i<e;i++){var n=t[i];if(n.isUINormalWindow&&(n.isUILoadingWindow||n.name==="win-loading")){n.isUILoadingWindow=true;return n}}return null};UIWindowManager.prototype.loadAudios=function(){this.loadSoundEffects();this.loadSoundMusic();return this};UIWindowManager.prototype.loadFonts=function(){var t=this.view.getMeta();if(t&&t.extfonts){ResLoader.loadFonts(t.extfonts)}return this};UIWindowManager.prototype.setAssetsLoadingWindow=function(t){this.assetsLoadingWin=this.find(t);return this};UIWindowManager.prototype.getAssetsLoadingWindow=function(){return this.assetsLoadingWin};UIWindowManager.prototype.showStartLoadingWindow=function(){this.resLoadDone=false;var t=this.getStartLoadingWindow();if(t){if(!t.isUILoadingWindowV2){this.loadAssets(null,null);this.loadAudios();this.loadFonts();console.log("old version, load all assets.")}this.openWindow(t.name)}else{this.loadAssets(null,null);this.showInitWindow();console.log("no loading window, load all assets.")}return};UIWindowManager.prototype.systemInit=function(){UIWindowManager.soundEffects={};UIWindowManager.soundMusic={};UIElement.animTimerID=null;this.callOnSystemInitHandler();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.callOnSystemInitHandler()}var i=this;this.showStartLoadingWindow();ResLoader.setOnLoadFinishListener(function(){i.callOnLoad()});return};UIWindowManager.prototype.systemExit=function(){console.log("systemExit: ");var t=this.history.length;for(var e=0;e<t;e++){this.closeCurrentWindow(0,true)}this.history.length=0;this.stopSoundMusic();this.callOnUnload();return};UIWindowManager.prototype.hasOpenPendingWindow=function(){var t=this.children;var e=t.length;for(var i=0;i<e;i++){var n=t[i];if(n.openPending){return true}}return false};UIWindowManager.prototype.openWindow=function(t,e,i,n,r){var a=null;if(t){a=this.find(t)}else{a=this.getMainWindow()}if(!a||!a.isUIWindow){alert("Can not find window: "+t);return}if(a.openPending){console.log("This window is already open:"+t);return}if(i){this.closeCurrentWindow(0,true)}if(a.pendingLoadChildren){a.loadChildren()}if(a.isOpen()){r=r||{closeOldIfOpened:true};if(r.closeOldIfOpened){a.callOnClose({});this.history.remove(a.getIndex())}else if(r.openNewIfOpened){var a=this.dupChild(a.name);a.destroyWhenClose=true}else{console.log(a.name+" is open already.");return false}}if(!a.isUILoadingWindow&&!a.isUILoadingWindowV2&&this.shouldShowAssetsLoadingProgress(a.name)){this.downloadAssetsAndOpenWindow(a,n,e)}else{this.doOpenWindow(a,n,e)}};UIWindowManager.prototype.doOpenWindow=function(t,e,i){t.prepareForOpen();t.openPending=true;t.initData=e;t.onClose=i;t.callOnBeforeOpen(e);this.targetShape=t;this.setPointerEventTarget(t);if(t.isUINormalWindow){return this.openNormalWindow(t)}else{return this.openPopupWindow(t)}};UIWindowManager.prototype.downloadAssetsAndOpenWindow=function(t,e,i){var n=this.getAssetsLoadingWindow();if(n===t){console.log("UIWindowManager.prototype.downloadAssetsAndOpenWindow failed.");return}this.doOpenWindow(n);var r=this;var a=n.findChildByType("ui-progressbar");var o=n.findChildByType("ui-label");if(a){a.setPercent(0)}if(o){o.setText("Downloading...")}function s(n,s,l){if(o){o.setText("Loading...")}if(a){a.setPercent(n,true)}if(s>=l){r.closeCurrentWindow(0,true);r.doOpenWindow(t,e,i)}}function l(t,e,i){if(o){if(t>=100){o.setText("Loading...")}else{o.setText("Downloading...")}}if(a){if(t>=100){a.setPercent(0,true)}else{a.setPercent(t,true)}}}this.loadAssets([t.name],s,l)};UIWindowManager.prototype.openPopupWindow=function(t){var e=this;var i=this.getCurrentFrame();function n(){if(!t.app){console.log("may be exited preview mode");return}var n=e.getFrameIndex(i);if(e.history.indexOf(n)<0){return}t.show();i.setPopupWindow(t);e.postRedraw();t.callOnOpen(t.initData)}if(i){i.callOnSwitchToBack(true);if(t.isAnimationEnabled()){var r=this.getPositionInScreen();var a=AnimationFactory.create(t.getAnimationName(true),t.getAnimationDuration(true));a.setWins(i,t);a.setScale(this.getRealScale());a.prepare(r.x,r.y,this.w,this.h,n);a.setRectOfFront(t.x,t.y,t.w,t.h);a.run()}else{n()}}return true};UIWindowManager.prototype.openNormalWindow=function(t){var e=this;var i=0;var n=this.getCurrentFrame();function r(){if(!t.app){console.log("may be exited preview mode");return}i=e.getFrameIndex(t);e.showFrame(i);e.history.push(i);n=e.getCurrentFrame();e.postRedraw();t.callOnOpen(t.initData);return}if(n){n.callOnSwitchToBack();if(t.isAnimationEnabled()){var a=this.getPositionInScreen();var o=AnimationFactory.create(t.getAnimationName(true),t.getAnimationDuration(true));o.setWins(n,t);o.setScale(this.getRealScale());o.prepare(a.x,a.y,this.w,this.h,r);o.run()}else{r()}}else{r()}return true};UIWindowManager.prototype.getCurrentWindow=function(){var t=this.getCurrentFrame();if(!t){return null}var e=t.getPopupWindow();return e?e:t};UIWindowManager.prototype.backToHomeWin=function(){var t=this.history;var e=t.length-1;var i=this.getCurrentWindow();if(!e){if(i.isUIPopupWindow){this.closeCurrentWindow(0)}return}if(e===1){if(i.isUIPopupWindow){this.closeCurrentWindow(0,true);this.closeCurrentWindow(0)}else{this.closeCurrentWindow(0)}return}var n=t[0];var r=this.getFrame(n);if(i.isAnimationEnabled()){var a=this.getPositionInScreen();var o=AnimationFactory.create(i.getAnimationName(false),i.getAnimationDuration(false));o.setWins(i,r);o.setScale(this.getRealScale());o.prepare(a.x,a.y,this.w,this.h,function(){});o.run()}for(var s=0;s<e;s++){this.closeCurrentWindow(0,true)}return};UIWindowManager.prototype.closeCurrentWindow=function(t,e){var i=this.getCurrentWindow();if(!i||i.isInDesignMode()){return false}return this.closeWindow(i,t,e)};UIWindowManager.prototype.closeWindow=function(t,e,i){t.closePending=true;if(t.isUINormalWindow){return this.closeNormalWindow(t,e,i)}else{return this.closePopupWindow(t,e,i)}};UIWindowManager.prototype.closePopupWindow=function(t,e,i){var n=this;var r=this.getCurrentFrame();if(r){function a(){if(!t.app){console.log("may be exited preview mode");return}r.removePopupWindow(t);r.callOnSwitchToFront(true);n.postRedraw();t.callOnClose(e)}if(!t.isTopWindow()){console.log("close background dialog");if(t.parentWindow){t.parentWindow.removePopupWindow(t)}t.callOnClose(e);return}if(r===t){i=true}if(t.isAnimationEnabled()&&!i&&!n.hasOpenPendingWindow()){var o=this.getPositionInScreen();var s=AnimationFactory.create(t.getAnimationName(false),t.getAnimationDuration(false));r.removePopupWindow(t);s.setWins(t,r);r.setPopupWindow(t);s.setScale(this.getRealScale());s.prepare(o.x,o.y,this.w,this.h,a);s.setRectOfFront(t.x,t.y,t.w,t.h);s.run()}else{a()}}return true};UIWindowManager.prototype.closeAll=function(){var t=[];for(var e=0;e<this.history.length;e++){var i=this.history[e];var n=this.getFrame(i);for(var r=n;r;r=r.popupWindow){t.push(r)}}for(var e=t.length-1;e>=0;e--){var n=t[e];n.callOnClose({});n.targetShape=null}this.history=[];return};UIWindowManager.prototype.closeNormalWindow=function(t,e,i){var n=this;var r=null;if(this.history.length<2){if(i||this.history.length){n.history.remove(n.current);t.callOnClose(e)}return false}if(!t.isTopWindow()){var a=n.getFrameIndex(t);console.log("closing background window "+t.name);n.history.remove(a);t.callOnClose();if(a===n.current&&n.history.length>0){n.showFrame(n.history[n.history.length-1])}return}lastWinIndex=this.history[this.history.length-2];r=this.getFrame(lastWinIndex);function o(){if(!r.app){console.log("may be exited preview mode");return}if(lastWinIndex!=n.history[n.history.length-1]||n.hasOpenPendingWindow()){return}n.showFrame(lastWinIndex);r.callOnSwitchToFront();n.postRedraw();t.callOnClose(e);return}n.history.remove(n.current);if(i){o()}else if(t.isAnimationEnabled()&&!n.hasOpenPendingWindow()){var s=this.getPositionInScreen();var l=AnimationFactory.create(t.getAnimationName(false),t.getAnimationDuration(false));l.setWins(t,r);l.setScale(this.getRealScale());l.prepare(s.x,s.y,this.w,this.h,o);l.run()}else{setTimeout(o,10)}return};UIWindowManager.prototype.isWindowOpen=function(t){return t&&t.isOpen()};UIWindowManager.prototype.onChildrenChanged=function(){};UIWindowManager.prototype.afterChildAppended=function(t){if(this.mode!==Shape.MODE_RUNNING&&!this.isUnpacking){var e=this.getFrameIndex(t);this.showFrame(e)}this.onChildrenChanged();return};UIWindowManager.prototype.onChildRemoved=function(t){this.onChildrenChanged();return};UIWindowManager.prototype.scaleForDensity=function(t,e,i){if(!t||t===1){return}for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.lcddensity||r.lcddensity==="all"){if(r.pendingLoadChildren){r.scaleInfo={};r.scaleInfo.sizeScale=t;r.scaleInfo.lcdDensity=e}else{r.scaleForDensity(t,e,i)}}}return};UIWindowManager.prototype.resize=function(t,e){var i=0;var n=0;var r=this.screenScaleMode==="fix-width";var a=this.screenScaleMode==="fix-height";var o=this.screenScaleMode==="fix-resolution";var s=this.parentShape!=null;if(this.mode===Shape.MODE_RUNNING&&(r||a||o)&&!s){var l=this.view.getCanvas();var h=l.width;var u=l.height;var c=this.designWidth;var p=this.designHeight;var f=true;var m=h>u&&c>p||h<u&&c<p;l.style.width=h+"px";l.style.height=u+"px";if(f&&m){if(r){var d=c/h;l.width=c;l.height=u*d;t=l.width;e=l.height}else if(a){var d=p/u;l.height=p;l.width=h*d;t=l.width;e=l.height}else{var y=c/h;var v=p/u;var d=Math.max(y,v);if(Math.abs(y-v)<.1){l.width=c;l.height=p;i=0;n=0;t=l.width;e=l.height}else{l.width=h*d;l.height=u*d;i=l.width-c>>1;n=l.height-p>>1;t=c;e=p}}var g=l.width/h;var _=l.height/u;WWindowManager.setInputScale(g,_)}else{l.width=h;l.height=u;WWindowManager.setInputScale(1,1);t=l.width;e=l.height}var I=cantkGetViewPort();this.app.onCanvasSized(l.width,l.height);console.log("Canvas Size: w ="+l.width+" h="+l.height);console.log("ViewPort Size: w ="+I.width+" h="+I.height);console.log("Canvas Style Size: w ="+l.style.width+" h="+l.style.height)}this.lastWin=null;this.setLeftTop(i,n);this.setSizeLimit(t,e,t,e);UIElement.prototype.resize.call(this,t,e);return};UIWindowManager.prototype.setDeviceConfig=function(t){var e=this.screenScaleMode;if(e==="fix-resolution"||e==="fix-width"||e==="fix-height"){this.oldConfig=this.deviceConfig;return}var i=this.deviceConfig;this.oldConfig=this.deviceConfig;this.deviceConfig=t;if(i&&t){if(i.lcdDensity!=t.lcdDensity){var n=this.getSizeScale(i.lcdDensity,t.lcdDensity);this.scaleForDensity(n,t.lcdDensity,true)}this.notifyDeviceConfigChanged(i,t)}return};UIWindowManager.prototype.getDeviceConfig=function(){if(this.deviceConfig){return this.deviceConfig}else{var t=this.getDevice();if(t){return t.config}}return null};UIWindowManager.prototype.paintChildren=function(t){if(!this.isInDesignMode()){if(this.forcePortrait&&this.w>this.h){var e=this.getHtmlImageByType("force-portrait-tips");t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,this.w,this.h);return}else if(this.forceLandscape&&this.w<this.h){var e=this.getHtmlImageByType("force-landscape-tips");t.fillStyle=this.style.fillColor;t.fillRect(0,0,this.w,this.h);this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_CENTER,0,0,this.w,this.h);return}}var i=this.getCurrentFrame();if(i.closePending){return}if(!this.isInDesignMode()&&this.history.length===0){UIElement.logWarning("All Windows Are Closed!")}else{if(i.isUIDialog){t.fillStyle="white";t.fillRect(0,0,this.w,this.h)}t.save();t.beginPath();i.paintSelf(t);t.restore()}return};UIWindowManager.prototype.paintSelf=function(t){var e=this.x;var i=this.y;var n=e||i;if(n){t.save();t.translate(e,i)}this.paintChildren(t);if(n){t.restore()}};UIWindowManager.prototype.isDeviceDirectionOK=function(){if(this.isInDesignMode()){return true}if(this.forcePortrait&&this.w>this.h||this.forceLandscape&&this.w<this.h){console.log("Device Direction Incorrect.");return false}return true};UIWindowManager.prototype.relayout=function(){if(this.isDeviceDirectionOK()){UIElement.prototype.relayout.call(this)}else{console.log("isDeviceDirectionNotOK ignore relayout")}return this};UIWindowManager.prototype.relayoutChildren=function(){if(!this.isDeviceDirectionOK()){console.log("isDeviceDirectionNotOK ignore relayout");return}var t=this.getCurrentFrame();if(this.isInDesignMode()){for(var e=0;e<this.children.length;e++){var i=this.children[e];i.relayout()}}else{if(t){t.relayout();var n=t.getPopupWindow();if(n){n.relayout()}}}return};UIWindowManager.prototype.onKeyDown=function(t){var e=this.getCurrentWindow();return e&&e.onKeyDown(t)};UIWindowManager.prototype.onKeyUp=function(t){var e=this.getCurrentWindow();return e&&e.onKeyUp(t)};UIWindowManager.prototype.setSoundEffectURLs=function(t){this.soundEffectURLs=t;return this};UIWindowManager.prototype.getSoundEffectURLs=function(){return this.soundEffectURLs};UIWindowManager.prototype.getSoundEffectNames=function(){
if(!this.soundEffectURLs){return[]}var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){t[e]=decodeURI(basename(t[e]))}return t};UIWindowManager.prototype.getSoundEnable=function(){return this.soundMusicsEnalbe||this.soundEffectsEnalbe};UIWindowManager.prototype.setSoundEnable=function(t){this.setSoundEffectsEnable(t);this.setSoundMusicsEnable(t);return this};UIWindowManager.prototype.setSoundEffectsEnable=function(t){this.soundEffectsEnalbe=t;return this};UIWindowManager.prototype.setSoundMusicsEnable=function(t){if(this.soundMusicsEnalbe!==t){this.soundMusicsEnalbe=t;if(t){this.playSoundMusic()}else{this.stopSoundMusic()}}return this};UIWindowManager.prototype.loadSoundEffects=function(){if(!this.soundEffectURLs){return}if(CantkRT.isCantkRTCordova()){console.log("Native Audio supported: load native Audio");this.loadSoundEffectsNative()}else if(isWebAudioSupported()){console.log("WebAudio supported: load Web Audio");this.loadSoundEffectsWebAudio()}else{console.log("WebAudio not supported: load HTML5 Audio");this.loadSoundEffectsHtml5Audio()}return this};UIWindowManager.prototype.loadSoundEffectsHtml5Audio=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];ResLoader.loadAudio(i,function(t){var e={audio:t};UIWindowManager.setVolumeOfAudio(e.audio,UIWindowManager.soundEffectVolume);var i=decodeURI(basename(t.src));UIWindowManager.soundEffects[i]=e})}return this};UIWindowManager.prototype.loadSoundEffectsNative=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];CantkRT.createSoundEffect(i,function(t){var e={audio:t};UIWindowManager.setVolumeOfAudio(e.audio,UIWindowManager.soundEffectVolume);var i=decodeURI(basename(t.src));UIWindowManager.soundEffects[i]=e;console.log("loadSoundEffectsNative success.")},function(){console.log("loadSoundEffectsNative fail.")})}return this};UIWindowManager.prototype.loadSoundEffectsWebAudio=function(){var t=this.soundEffectURLs.split("\n");for(var e=0;e<t.length;e++){var i=t[e];var n={src:[i],autoplay:false,loop:false,volume:.8};var r=decodeURI(basename(i));var a={audio:new Howl(n),playing:false};UIWindowManager.setVolumeOfAudio(a.audio,UIWindowManager.soundEffectVolume);UIWindowManager.soundEffects[r]=a}return this};UIWindowManager.prototype.stopSoundEffect=function(t){for(var e in UIWindowManager.soundEffects){if(t===e||!t){var i=UIWindowManager.soundEffects[e];if(i&&i.audio){if(i.audio.stop){i.audio.stop()}else{i.audio.pause()}i.playing=false}}}return this};UIWindowManager.prototype.stopAllSound=function(){try{this.stopSoundMusic().stopSoundEffect()}catch(t){console.log(t.message)}return this};UIWindowManager.soundMusicVolume=.8;UIWindowManager.soundEffectVolume=.8;UIWindowManager.prototype.setSoundEffectVolume=function(t){UIWindowManager.soundEffectVolume=t;return this};UIWindowManager.prototype.setSoundMusicVolume=function(t){UIWindowManager.soundMusicVolume=t;var e=this.lastAudioInfo;if(e&&e.audio){UIWindowManager.setVolumeOfAudio(e.audio,UIWindowManager.soundMusicVolume)}return this};UIWindowManager.setVolumeOfAudio=function(t,e){if(typeof t.volume==="function"){t.volume(e)}else{t.volume=e}};UIWindowManager.prototype.playSoundEffect=function(t,e){if(!this.soundEffectsEnalbe){console.log("this.soundEffectsEnalbe is disable ");return this}var i=UIWindowManager.soundEffects[t];if(!i||!i.audio){console.log("not found: "+t);return this}if(e){if(i.audio.once){i.audio.once("end",e)}else{i.audio.addEventListener("ended",function(t){e()})}}UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundEffectVolume);i.audio.play();console.log("playSoundEffect:"+t);return this};UIWindowManager.prototype.onMultiTouch=function(t,e,i){var n=this.getCurrentWindow();if(n){var r=this.left+n.left;var a=this.top+n.top;for(var o=0;o<e.length;o++){var s=e[o];s.x-=r;s.y-=a}n.onMultiTouch(t,e,i)}};UIWindowManager.prototype.onPointerDownRunning=function(t,e){if(this.autoPlayPending){this.playSoundMusic();this.autoPlayPending=false}if(!e||this.popupWindow||!this.pointerDown){return}return this.callOnPointerDownHandler(t)};UIWindowManager.prototype.setSoundMusicURLs=function(t){this.soundMusicURLs=t;return this};UIWindowManager.prototype.getSoundMusicURLs=function(){return this.soundMusicURLs};UIWindowManager.prototype.loadSoundMusicHTML5=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var a=n[r];ResLoader.loadAudio(a,function(n){var r={audio:n};var a=decodeURI(basename(n.src));UIWindowManager.setVolumeOfAudio(r.audio,UIWindowManager.soundMusicVolume);if(e){n.loop="loop"}if(i){n.play();i=false}t.autoPlayPending=true;UIWindowManager.soundMusic[a]=r})}return};UIWindowManager.prototype.loadSoundMusicWebAudio=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var a=n[r];var o={src:[a],autoplay:i,loop:e,volume:.8};var s=decodeURI(basename(a));var l={audio:new Howl(o),playing:i};UIWindowManager.setVolumeOfAudio(l.audio,UIWindowManager.soundMusicVolume);if(i){this.lastAudioInfo=l}i=false;UIWindowManager.soundMusic[s]=l}return};UIWindowManager.prototype.loadSoundMusicNative=function(){var t=this;var e=this.soundMusicLoop;var i=this.soundMusicAutoPlay;var n=this.soundMusicURLs.split("\n");for(var r=0;r<n.length;r++){var a=n[r];CantkRT.createSoundMusic(a,function(t){var n={audio:t};var r=decodeURI(basename(t.src));UIWindowManager.setVolumeOfAudio(n.audio,UIWindowManager.soundMusicVolume);if(e){t.loop="loop"}if(i){t.play();this.lastAudioInfo=n;i=false}UIWindowManager.soundMusic[r]=n})}return};UIWindowManager.prototype.loadSoundMusic=function(){if(!this.soundMusicURLs){return}this.soundMusicsEnalbe=true;if(CantkRT.isCantkRTCordova()){console.log("Native Audio supported: load native Audio");this.loadSoundMusicNative()}else if(isWebAudioSupported()){console.log("WebAudio supported: load Web Audio");this.loadSoundMusicWebAudio()}else{this.loadSoundMusicHTML5()}this.soundMusicsPlaying=this.soundMusicAutoPlay;return this};UIWindowManager.prototype.isSoundMusicPlaying=function(t){var e=false;for(var i in UIWindowManager.soundMusic){if(t===i||!t){var n=UIWindowManager.soundMusic[i];if(n&&n.audio){if(n.playing){e=true;break}}}}return e};UIWindowManager.prototype.stopSoundMusic=function(t){for(var e in UIWindowManager.soundMusic){if(t===e||!t){var i=UIWindowManager.soundMusic[e];if(i&&i.audio){i.audio.pause();i.playing=false;this.soundMusicsPlaying=false}}}return this};UIWindowManager.prototype.playSoundMusic=function(t,e){if(this.soundMusicsPlaying){this.stopSoundMusic()}if(!this.soundMusicsEnalbe){if(t){this.lastAudioInfo=UIWindowManager.soundMusic[t]}console.log("this.soundMusicsEnalbe is disable ");return this}if(!t&&this.lastAudioInfo&&this.lastAudioInfo.audio){var i=this.lastAudioInfo;UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundMusicVolume);i.audio.play();i.playing=true;this.soundMusicsPlaying=true;return this}for(var n in UIWindowManager.soundMusic){if(t===n||!t){var i=UIWindowManager.soundMusic[n];if(i&&i.audio){if(e){if(i.audio.once){i.audio.once("end",e)}else{i.audio.addEventListener("ended",function(t){e()})}}UIWindowManager.setVolumeOfAudio(i.audio,UIWindowManager.soundMusicVolume);i.audio.play();i.playing=true;this.lastAudioInfo=i;this.soundMusicsPlaying=true;console.log("UIWindowManager.prototype.playSoundMusic");break}}}console.log("playSoundMusic:"+t);return this};UIWindowManager.prototype.getSoundMusicNames=function(){if(!this.soundMusicURLs){return[]}var t=this.soundMusicURLs.split("\n");for(var e=0;e<t.length;e++){t[e]=basename(t[e])}return t};UIWindowManager.prototype.shapeCanBeChild=function(t){return t.isUIWindow};function UIWindowManagerCreator(){var t=["ui-window-manager","ui-window-manager",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWindowManager;return e.initUIWindowManager(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIWindowManagerCreator);function UIImageButton(){return}UIImageButton.prototype=new UIElement;UIImageButton.prototype.isUIImageButton=true;UIImageButton.prototype.initUIImageButton=function(t,e,i){this.initUIElement(t,e,i);this.setImage(UIElement.IMAGE_NORMAL,null);this.setImage(UIElement.IMAGE_ACTIVE,null);this.setImage(UIElement.IMAGE_DISABLE,null);this.addEventNames(["onUpdateTransform"]);return this};UIImageButton.prototype.shapeCanBeChild=function(t){return false};function UIImageButtonCreator(t,e){var i=["ui-image-button","ui-image-button",null,1];ShapeCreator.apply(this,i);this.createShape=function(i){var n=new UIImageButton;return n.initUIImageButton(this.type,t,e)};return}ShapeFactoryGet().addShapeCreator(new UIImageButtonCreator(120,90));function UIImageNormalView(){return}UIImageNormalView.prototype=new UIImageView;UIImageNormalView.prototype.isUIImageNormalView=true;UIImageNormalView.prototype.initUIImageNormalView=function(t,e,i){this.userImages=[];this.cachedImages=[];this.initUIElement(t);this.initUIImageView(e,i);this.setTextType(Shape.TEXT_NONE);this.current=0;this.offsetX=0;this.offsetY=0;this.imageScale=1;this.velocityTracker=new VelocityTracker;this.interpolator=new DecelerateInterpolator;this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);return this};UIImageNormalView.prototype.onPointerDownRunning=function(t,e){if(e){return}this.velocityTracker.clear();return};UIImageNormalView.prototype.onPointerMoveRunning=function(t,e){if(e){return}this.offsetX=this.offsetX+this.getMoveDeltaX();this.offsetY=this.offsetY+this.getMoveDeltaY();this.addMovementForVelocityTracker();return};UIImageNormalView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIImageNormalView.prototype.onPointerUpRunning=function(t,e){if(e){return}var i=this.velocityTracker.getVelocity();var n=this.w;var r=this.h;var a=i.x/n;var o=i.y/r;var s=Math.max(a,o);var l=.5*n*a*a;var h=.5*r*o*o;l=i.x>0?l:-l;h=i.y>0?h:-h;this.scrollTo(l,h,s*1e3);return true};UIImageNormalView.prototype.scrollTo=function(t,e,i){var n=this;var r=Math.max(500,Math.min(i,1e3));var a=(new Date).getTime();var o=this.offsetX;var s=this.offsetY;var l=this.cachedImages[this.current];var h=Math.min(l.width/2,t);var u=Math.min(l.height/2,e);function c(){var t=new Date;var e=(t.getTime()-a)/r;if(e<1){n.offsetX=o+e*h;n.offsetY=s+e*u;setTimeout(c,10)}else{delete a;n.offsetX=o+h;n.offsetY=s+u}delete t;n.postRedraw()}c();return};UIImageNormalView.prototype.switchTo=function(t){var e=this.current;var i=this.userImages.length;if(t>0){if(this.current+t<i){e=this.current+t}}else{if(this.current+t>0){e=this.current+t}}};UIImageNormalView.prototype.calcImageDefaultOffset=function(){var t=this.current;if(t<0||t>=this.cachedImages.length){return}var e=this.cachedImages[t];if(!e||!e.width){return}this.imageScale=Math.min(this.w/e.width,this.h/e.height);var i=this.imageScale*e.width;var n=this.imageScale*e.height;this.offsetX=(this.w-i)/2;this.offsetY=(this.h-n)/2;return};UIImageNormalView.prototype.setCurrentImage=function(t){if(t<0||t>=this.userImages.length){return}this.current=t;this.calcImageDefaultOffset();return};UIImageNormalView.prototype.onDoubleClick=function(t,e){this.calcImageDefaultOffset();return this.callOnDoubleClickHandler(t)};UIImageNormalView.prototype.paintSelfOnly=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=this.cachedImages[this.current];if(!e||!e.width){return}this.imageScale=1;t.save();t.rect(0,0,this.w,this.h);t.clip();t.translate(this.offsetX,this.offsetY);t.scale(this.imageScale,this.imageScale);t.drawImage(e,0,0);t.restore();return};function UIUIImageNormalViewCreator(){var t=["ui-image-normal-view","ui-image-normal-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageNormalView;return e.initUIImageNormalView(this.type,300,300)};return}ShapeFactoryGet().addShapeCreator(new UIUIImageNormalViewCreator);function UIImageSlideView(){return}UIImageSlideView.prototype=new UIImageView;UIImageSlideView.prototype.isUIImageSlideView=true;UIImageSlideView.prototype.saveProps=["showIndicator","frameDuration"];UIImageSlideView.prototype.initUIImageSlideView=function(t,e,i){this.initUIElement(t);this.initUIImageView(e,i);this.offset=0;this.addEventNames(["onChanged"]);this.setTextType(Shape.TEXT_NONE);imageSlideViewInitCustomProp(this);return this};UIImageSlideView.prototype.onInit=function(){var t=this;this.currFrame=0;function e(){if(!t.isInDesignMode()&&t.isVisible()){var i=t.getFrameDuration();t.postRedraw();setTimeout(e,i);var n=t.currFrame+1;t.animScrollTo(-t.w,n)}}var i=this.getFrameDuration();setTimeout(e,i);return};UIImageSlideView.prototype.getFrameDuration=function(){return this.frameDuration?this.frameDuration:5e3};UIImageSlideView.prototype.setFrameDuration=function(t){this.frameDuration=Math.max(1e3,Math.min(t,3e5));return};UIImageSlideView.prototype.setShowIndicator=function(t){this.showIndicator=t;return};UIImageSlideView.prototype.getFrameIndicatorParams=function(){var t=this.userImages.length;var e=Math.min(.5*this.w/t,40);var i=e*t;var n=(this.w-i)/2;var r=.8*this.h;return{offsetX:n,offsetY:r,itemSize:e,n:t}};UIImageSlideView.prototype.getCurrent=function(){return this.currFrame};UIImageSlideView.prototype.getCurrentImage=function(){var t=this.cachedImages[this.currFrame];return t};UIImageSlideView.prototype.setValue=function(t){for(var e=0;e<this.cachedImages.length;e++){var i=this.cachedImages[e];if(i.src.indexOf(t)>=0||t.indexOf(i.src)>=0){return this.setCurrent(e)}}return this};UIImageSlideView.prototype.setCurrent=function(t){this.setCurrentFrame(t);return this};UIImageSlideView.prototype.setCurrentFrame=function(t){this.offset=0;this.currFrame=(t+this.userImages.length)%this.userImages.length;this.postRedraw();this.callOnChangedHandler(this.currFrame);return this};UIImageSlideView.prototype.animScrollTo=function(t,e){var i=1e3;var n=this;var r=this.offset;var a=(new Date).getTime();var o=new DecelerateInterpolator(2);if(n.animating){return}n.animating=true;function s(){var l=new Date;var h=(l.getTime()-a)/i;var u=o.get(h);if(h<1){n.offset=r+t*u;setTimeout(s,10)}else{n.offset=0;n.setCurrentFrame(e);delete a;delete o;delete n.animating}delete l;n.postRedraw()}s();return};UIImageSlideView.prototype.onPointerDownRunning=function(t,e){if(this.isEventHandledByChild()){return}this.setEventHandled();if(!this.velocityTracker){this.velocityTracker=new VelocityTracker}this.velocityTracker.clear();return true};UIImageSlideView.prototype.isEventHandledByChild=function(){var t=UIElement.lastEvent.status;return t&UIElement.EVENT_HSCROLL_HANDLED};UIImageSlideView.prototype.setEventHandled=function(){this.setLastEventStatus(UIElement.EVENT_HSCROLL_HANDLED);return this};UIImageSlideView.prototype.onPointerMoveRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.currFrame;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}this.offset=r;this.addMovementForVelocityTracker();return};UIImageSlideView.prototype.onPointerUpRunning=function(t,e){if(this.animating){this.setEventHandled();return}if(e){return}if(this.isEventHandledByChild()){return}var i=this.getFrames();var n=this.currFrame;var r=this.getMoveAbsDeltaX();if(n>0&&r>0||n+1<i&&r<0){this.setEventHandled()}else{return}var a=0;var o=this.offset;var s=this.currFrame;var l=this.velocityTracker.getVelocity().x;var h=o+l;if(Math.abs(o)<10){this.offset=0;return}if(Math.abs(h)>this.w/3){if(o>0){a=this.w-o;s=this.currFrame-1}else{a=-this.w-o;s=this.currFrame+1}}else{a=-o}this.animScrollTo(a,s);return};UIImageSlideView.prototype.onClick=function(t,e){if(e||this.animating){return}var i=this.getFrameIndicatorParams();var n=i.offsetX;var r=i.offsetY;var a=i.itemSize;var o=i.n;var s=t.x;var l=t.y;if(l<r||l>r+a||s<n||s>n+o*a){return}for(var h=0;h<o;h++){if(s>n&&s<n+a){this.setCurrentFrame(h);break}n+=a}return};UIImageSlideView.prototype.drawFrameIndicator=function(t,e){var i=this.getFrameIndicatorParams();var n=i.offsetX;var r=i.offsetY;var a=i.itemSize;var o=i.n;n+=a/2;r+=a/2;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;for(var s=0;s<o;s++){t.beginPath();t.arc(n,r,10,0,Math.PI*2);n+=a;if(s===e){t.save();t.shadowColor=this.style.lineColor;t.shadowBlur=5;t.shadowOffsetX=0;t.shadowOffsetY=0;t.fill();t.stroke();t.restore()}else{t.fill()}}return};UIImageSlideView.prototype.getPrevFrame=function(){var t=(this.currFrame-1+this.userImages.length)%this.userImages.length;return this.cachedImages[t]};UIImageSlideView.prototype.getFrames=function(){return this.userImages.length};UIImageSlideView.prototype.getNextFrame=function(){var t=(this.currFrame+1)%this.userImages.length;return this.cachedImages[t]};UIImageSlideView.prototype.drawOneImage=function(t,e){var i=this.style.fillColor;if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE){t.drawImage(e,0,0,e.width,e.height,0,0,this.w,this.h)}else if(this.images.display===UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO){var n={x:0,y:0};n.w=e.width;n.h=e.height;this.drawImageAt(t,e,UIElement.IMAGE_DISPLAY_SCALE_KEEP_RATIO,0,0,this.w,this.h,n)}else{UIImageView.drawImageAtCenter(t,e,0,0,this.w,this.h,true,i)}return};UIImageSlideView.prototype.drawImage=function(t){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var e=(this.currFrame?this.currFrame:0)%this.userImages.length;var i=this.cachedImages[e];if(i&&i.width>0){t.save();t.rect(0,0,this.w,this.h);t.clip();t.beginPath();t.translate(this.offset,0);this.drawOneImage(t,i);var n=Math.abs(this.offset);if(this.offset<0){i=this.getNextFrame();if(i&&i.width>0){t.translate(this.w,0);this.drawOneImage(t,i)}}else if(n>0){i=this.getPrevFrame();if(i&&i.width>0){t.translate(-this.w,0);this.drawOneImage(t,i)}}t.restore();if(this.showIndicator){this.drawFrameIndicator(t,e)}}return};UIImageSlideView.prototype.shapeCanBeChild=function(t){return t.isUIButton||t.isUIGroup||t.isUILabel||t.isUIImage};function UIImageSlideViewCreator(){var t=["ui-image-slide-view","ui-image-slide-view",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIImageSlideView;return e.initUIImageSlideView(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIImageSlideViewCreator);function UIPageIndicator(){return}UIPageIndicator.prototype=new UIHScrollView;UIPageIndicator.prototype.isUIPageIndicator=true;UIPageIndicator.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIPageIndicator.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicator.prototype.setVisibleTabs=function(t){this.visibleTabs=t;return};UIPageIndicator.prototype.getVisibleTabs=function(){return this.visibleTabs?this.visibleTabs:6};UIPageIndicator.prototype.getTabWidth=function(){var t=this.getPages();var e=this.getVisibleTabs();if(t<e){return this.w/t}else{return this.w/e}};UIPageIndicator.prototype.getScrollRange=function(){var t=this.getVisibleTabs();if(t<6){return this.w}else{var e=this.getPages();return this.getTabWidth()*e}};UIPageIndicator.prototype.initUIPageIndicator=function(t,e,i){this.initUIHScrollView(t,10,null);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.setCanRectSelectable(false,false);this.images.display=UIElement.IMAGE_DISPLAY_9PATCH;return this};UIPageIndicator.prototype.getViewPager=function(){if(!this.getParent()){return}if(this.viewPager&&!this.viewPager.parentShape){this.viewPager=null}if(!this.viewPager){this.viewPager=this.getParent().findChildByType("ui-view-pager",true);if(!this.viewPager&&this.isUIPageIndicatorSimple){this.viewPager=this.getWindow().findChildByType("ui-view-pager",true)}}return this.viewPager};UIPageIndicator.prototype.getViewPagerOffset=function(){var t=this.getViewPager();return t?t.offset/t.w:0};UIPageIndicator.prototype.getPages=function(){var t=this.getViewPager();if(t){t.pageIndicator=this}return t?t.getFrames():3};UIPageIndicator.prototype.getCurrent=function(){var t=this.getViewPager();return t?t.getCurrent():0};UIPageIndicator.prototype.paintOneIndicator=function(t,e,i,n,r,a,o){t.beginPath();t.arc(n+a/2,r+o/2,10,0,2*Math.PI);t.fill();if(e){t.stroke()}return};UIPageIndicator.prototype.shapeCanBeChild=function(t){return false};UIPageIndicator.prototype.paintOneIndicatorCircle=function(t,e,i,n,r,a,o){var s=Math.floor(Math.max(5,o/4));t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.style.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.style.lineColorOfCurrent:this.style.lineColor;t.beginPath();t.arc(n+a/2,r+o/2,s,0,2*Math.PI);t.fill();t.stroke();return};UIPageIndicator.prototype.paintOneIndicatorNumber=function(t,e,i,n,r,a,o){var s=Math.floor(Math.max(5,o/4));var l=Math.floor(n+a/2);var h=Math.floor(r+o/2);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.style.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.style.lineColorOfCurrent:this.style.lineColor;t.beginPath();t.arc(l,h,s,0,2*Math.PI);t.fill();t.stroke();t.font=s<20?"16px sans":"22px sans";t.textAlign="center";t.textBaseline="middle";t.fillStyle=this.style.textColor;t.fillText(i+1,l,h);return};UIPageIndicator.prototype.paintOneIndicatorRect=function(t,e,i,n,r,a,o){var s=10;if(a>o){s=Math.max(20,o/4)}else{s=Math.max(20,a/4)}s=Math.floor(s);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.style.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.style.lineColorOfCurrent:this.style.lineColor;var l=(a-s)/2;var h=(o-s)/2;t.beginPath();t.rect(n+l,r+h,s,s);t.fill();t.stroke();return};UIPageIndicator.prototype.paintOneIndicatorLine=function(t,e,i,n,r,a,o){var s=4;if(a>o){s=Math.max(4,o/4)}else{s=Math.max(4,a/4)}s=Math.floor(s);t.lineWidth=this.style.lineWidth;t.fillStyle=e?this.style.fillColorOfCurrent:this.style.fillColor;t.strokeStyle=e?this.style.lineColorOfCurrent:this.style.lineColor;var l=(a-s)/2;var h=(o-s)/2;t.beginPath();if(a>o){t.rect(n,r+h,a,s)}else{t.rect(n+l,r,s,o)}t.fill();t.stroke();return};UIPageIndicator.prototype.onClickItem=function(t){var e=this.getViewPager();if(e){e.setCurrent(t)}return};UIPageIndicator.prototype.findItemByPoint=function(t){var e=this.getPages();if(this.w>this.h){var i=this.getTabWidth();for(var n=0;n<e;n++){if(t.x>n*i&&t.x<(n+1)*i){return n}}}else{var r=this.h/e;for(var n=0;n<e;n++){if(t.y>n*r&&t.y<(n+1)*r){return n}}}return-1};UIPageIndicator.prototype.onClick=function(t,e){if(e){return}var i=this.findItemByPoint(t);if(i>=0){this.onClickItem(i)}this.callOnClickHandler(t);return};UIPageIndicator.prototype.paintBackground=function(t){var e=this.getPages();if(!e){t.lineWidth=1;t.strokeStyle="Red";t.rect(0,0,this.w,this.h);t.stroke()}};UIPageIndicator.prototype.paintSelfOnly=function(t){var e=this.getPages();var i=this.getCurrent();var n={};n.x=this.lastPosition.x-this.left;n.y=this.lastPosition.y-this.top;this.pointerOnItem=this.findItemByPoint(n);this.paintBackground(t);t.translate(-this.offset,0);if(this.w>this.h){var r=this.h;var a=this.getTabWidth();var o=Math.floor(this.getViewPagerOffset()*a);for(var s=0;s<e;s++){var l=s*a;this.paintOneIndicator(t,s===i,s,l,0,a,r)}}else{var a=this.w;var r=this.h/e;for(var s=0;s<e;s++){var h=s*r;this.paintOneIndicator(t,s===i,s,0,h,a,r)}}t.translate(this.offset,0);delete this.pointerOnItem;return};function UIPageIndicatorCreator(){var t=["ui-page-indicator","ui-page-indicator",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicator;return e.initUIPageIndicator(this.type,200,60)};return}function UIPageIndicatorSimple(){return}UIPageIndicatorSimple.prototype.isScrollable=function(){return this.getPages()>this.getVisibleTabs()};UIPageIndicatorSimple.prototype=new UIPageIndicator;UIPageIndicatorSimple.prototype.isUIPageIndicatorSimple=true;UIPageIndicatorSimple.prototype.saveProps=["indicatorStyle"];UIPageIndicatorSimple.prototype.initUIPageIndicatorSimple=function(t,e,i,n){this.initUIPageIndicator(t,e,i);this.style.fillColorOfCurrent="Gray";this.style.lineColorOfCurrent="Black";this.setAlwaysOnTop(true);this.setVisibleTabs(12);this.setIndicatorStyle(n);return this};UIPageIndicatorSimple.prototype.setLineColorOfCurrent=function(t){this.style.lineColorOfCurrent=t;return};UIPageIndicatorSimple.prototype.setFillStyleOfCurrent=function(t){this.style.fillColorOfCurrent=t;return};UIPageIndicatorSimple.prototype.setIndicatorStyle=function(t){this.indicatorStyle=t;return this};UIPageIndicatorSimple.prototype.paintOneIndicator=function(t,e,i,n,r,a,o){switch(this.indicatorStyle){case"circle":{this.paintOneIndicatorCircle(t,e,i,n,r,a,o);break}case"rect":{this.paintOneIndicatorRect(t,e,i,n,r,a,o);break}case"line":{this.paintOneIndicatorLine(t,e,i,n,r,a,o);break}default:{this.paintOneIndicatorNumber(t,e,i,n,r,a,o);break}}};function UIPageIndicatorCircleCreator(){var t=["ui-page-indicator-circle","ui-page-indicator-circle",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"circle")};return}function UIPageIndicatorNumberCreator(){var t=["ui-page-indicator-number","ui-page-indicator-number",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"number")};return}function UIPageIndicatorRectCreator(){var t=["ui-page-indicator-rect","ui-page-indicator-rect",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"rect")};return}function UIPageIndicatorLineCreator(){var t=["ui-page-indicator-line","ui-page-indicator-line",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"line")};return}function UIPageIndicatorSimpleCreator(){var t=["ui-page-indicator-simple","ui-page-indicator-simple",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorSimple;return e.initUIPageIndicatorSimple(this.type,200,60,"line")};return}function UIPageIndicatorNormal(){return}UIPageIndicatorNormal.prototype=new UIPageIndicator;UIPageIndicatorNormal.prototype.isUIPageIndicatorNormal=true;UIPageIndicatorNormal.prototype.saveProps=["enableAnimatePage","strItemImages","strItemTexts","strItemImagesOfCurrent"];UIPageIndicatorNormal.prototype.initUIPageIndicatorNormal=function(t,e,i){this.initUIPageIndicator(t,e,i);this.itemTexts=[];this.itemImages=[];this.imagePosition="left";this.itemImagesOfCurrent=[];this.setMargin(5,5);this.setAlwaysOnTop(false);this.setImage(UIElement.ITEM_BG_NOTMAL,null);this.setImage(UIElement.ITEM_BG_ACTIVE,null);this.setImage(UIElement.ITEM_BG_CURRENT_NOTMAL,null);this.setImage(UIElement.ITEM_BG_CURRENT_ACTIVE,null);return this};UIPageIndicatorNormal.prototype.onInit=function(){this.syncImages()};UIPageIndicatorNormal.prototype.syncImages=function(){this.itemImages=[];this.itemImagesOfCurrent=[];for(var t in this.images){if(t==="display")continue;var e=this.images[t];if(t.indexOf("current-item-images-")===0){this.itemImagesOfCurrent.push(e)}else if(t.indexOf("item-images-")===0){this.itemImages.push(e)}}return};UIPageIndicatorNormal.prototype.setEnableAnimatePage=function(t){this.enableAnimatePage=t;return};UIPageIndicatorNormal.prototype.setItemImagesByStr=function(t){var e=t.split("\n");var i="item-images-";var n=this.itemImages.length;for(var r=0;r<n;r++){this.setImage(i+r,null)}for(var r=0;r<e.length;r++){var a=e[r];if(a){this.setImage(i+r,a)}}this.syncImages();this.strItemImages=t;return};UIPageIndicatorNormal.prototype.setItemImagesOfCurrentByStr=function(t){var e=t.split("\n");var i="current-item-images-";var n=this.itemImagesOfCurrent.length;for(var r=0;r<n;r++){this.setImage(i+r,null)}for(var r=0;r<e.length;r++){var a=e[r];if(a){this.setImage(i+r,a)}}this.syncImages();this.strItemImagesOfCurrent=t;return};UIPageIndicatorNormal.prototype.setItemTextsByStr=function(t){this.strItemTexts=t;this.itemTexts=t.split("\n");return};UIPageIndicatorNormal.prototype.setImagePosition=function(t){this.imagePosition=t;return};UIPageIndicatorNormal.prototype.getItemImagesStr=function(){return this.strItemImages?this.strItemImages:""};UIPageIndicatorNormal.prototype.getItemImagesStrOfCurrent=function(){return this.strItemImagesOfCurrent?this.strItemImagesOfCurrent:""};UIPageIndicatorNormal.prototype.getItemImages=function(){if(!this.itemImages.length){this.syncImages()}return this.itemImages};UIPageIndicatorNormal.prototype.getItemImagesOfCurrent=function(){if(!this.itemImagesOfCurrent.length){this.syncImages()}return this.itemImagesOfCurrent};UIPageIndicatorNormal.prototype.getItemTextsStr=function(){return this.strItemTexts?this.strItemTexts:""};UIPageIndicatorNormal.prototype.getItemTexts=function(){if(!this.itemTexts.length&&this.strItemTexts){this.setItemTextsByStr(this.strItemTexts)}return this.itemTexts};UIPageIndicatorNormal.prototype.getItemImage=function(t,e){var i=e?this.getItemImagesOfCurrent():this.getItemImages();if(i&&t<i.length){return i[t]}return null};UIPageIndicatorNormal.prototype.getBackgroundImage=function(t,e){var i="";var n=this.pointerDown&&this.pointerOnItem===t;if(e){i=n?UIElement.ITEM_BG_CURRENT_ACTIVE:UIElement.ITEM_BG_CURRENT_NOTMAL}else{i=n?UIElement.ITEM_BG_ACTIVE:UIElement.ITEM_BG_NOTMAL}return this.getImageByType(i)};UIPageIndicatorNormal.prototype.paintOneIndicatorBackground=function(t,e,i,n,r,a,o){var s=this.getBackgroundImage(i,e);if(!s||!s.getImage()){return}var l=s.getImage();var h=s.getImageRect();this.drawImageAt(t,l,this.images.display,n,r,a,o,h);return};UIPageIndicatorNormal.prototype.setItemTextColorOfCurrent=function(t){this.style.textColorOfCurrent=t;return};UIPageIndicatorNormal.prototype.getItemTextColorOfCurrent=function(){return this.style.textColorOfCurrent?this.style.textColorOfCurrent:"green"};UIPageIndicatorNormal.prototype.paintBackground=function(t){return};UIPageIndicatorNormal.prototype.getItemLocaleText=function(t){var e=null;var i=this.getItemTexts();if(i&&t<i.length){e=webappGetText(i[t]);if(!e){e=i[t]}}return e};UIPageIndicatorNormal.prototype.paintOneIndicator=function(t,e,i,n,r,a,o){var s=this.getItemImage(i,e);this.paintOneIndicatorBackground(t,e,i,n,r,a,o);var l=8;var h=this.style.fontSize;var u=this.getItemLocaleText(i);t.font=this.style.getFont();t.fillStyle=e?this.getItemTextColorOfCurrent():this.style.textColor;if(s&&s.getImage()){var c=s.getImage();var p=s.getImageRect();var f=this.hMargin;var m=this.vMargin;if(u){var h=this.style.fontSize;var d=n+f;var y=r+m;var v=a-2*f;var g=o-h-2*m-l;this.drawImageAt(t,c,UIElement.IMAGE_DISPLAY_AUTO,d,y,v,g,p);d=n+(a>>1);y=r+o-m;t.textAlign="center";t.textBaseline="bottom";t.fillText(u,d,y)}else{var d=n+f;var y=r+m;var v=a-2*f;var g=o-2*m;this.drawImageAt(t,c,UIElement.IMAGE_DISPLAY_AUTO,d,y,v,g,p)}}else{if(u){t.textAlign="center";t.textBaseline="middle";t.fillText(u,Math.floor(n+a/2),Math.floor(r+o/2))}}return};UIPageIndicator.prototype.onClickItem=function(t){var e=this.getViewPager();if(e){if(this.enableAnimatePage){e.switchTo(t)}else{e.setCurrent(t)}}return};function UIPageIndicatorNormalCreator(){var t=["ui-page-indicator-normal","ui-page-indicator-normal",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorNormal;return e.initUIPageIndicatorNormal(this.type,200,60)};return}function UIPageIndicatorNormalX(){return}UIPageIndicatorNormalX.prototype=new UIPageIndicator;UIPageIndicatorNormalX.prototype.isUIPageIndicatorNormalX=true;UIPageIndicatorNormalX.prototype.initUIPageIndicatorNormalX=function(t,e,i){this.initUIPageIndicator(t,e,i);return this};UIPageIndicatorNormalX.prototype.relayoutChildren=function(){var t=this.children;var e=this.getPages()||3;for(var i=t.length;i<e;i++){var n=this.addChild(this.createElement("ui-page-indicator-button"));
n.setText(i)}t.length=e;var r=e;var a=this.h;var o=this.w/r;for(var i=0;i<r;i++){var s=t[i];s.h=a;s.w=o;s.y=0;s.x=i*o;s.xAttr=UIElement.X_FIX_LEFT;s.yAttr=UIElement.Y_FIX_TOP;s.widthAttr=UIElement.WIDTH_FIX;s.heightAttr=UIElement.HEIGHT_FIX}return this};UIPageIndicatorNormalX.prototype.paintOneIndicator=function(t,e,i,n,r,a,o){};UIPageIndicatorNormalX.prototype.shapeCanBeChild=function(t){return t.isUIPageIndicatorButton};function UIPageIndicatorNormalXCreator(){var t=["ui-page-indicator-normal-x","ui-page-indicator-normal-x",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorNormalX;return e.initUIPageIndicatorNormalX(this.type,200,60)};return}function UIPageIndicatorButton(){return}UIPageIndicatorButton.prototype=new UIRadioBox;UIPageIndicatorButton.prototype.isUIPageIndicatorButton=true;UIPageIndicatorButton.prototype.initUIPageIndicatorButton=function(t){this.initUIRadioBox(t);this.userMovable=false;this.userResizable=false;this.images={display:UIElement.IMAGE_DISPLAY_9PATCH};this.setImage(UIElement.IMAGE_CURRENT_PAGE_BG,null);this.setImage(UIElement.IMAGE_CURRENT_PAGE_FG,null);this.setImage(UIElement.IMAGE_NOT_CURRENT_PAGE_BG,null);this.setImage(UIElement.IMAGE_NOT_CURRENT_PAGE_FG,null);return this};UIPageIndicatorButton.prototype.getValue=function(){var t=this.parentShape;if(t){return t.getCurrent()===t.children.indexOf(this)}else{return this.value}};UIPageIndicatorButton.prototype.drawText=function(t){};UIPageIndicatorButton.prototype.drawImage=function(t){var e=null;var i=null;var n=this.getValue();var r=this.getImageByType(n?UIElement.IMAGE_CURRENT_PAGE_BG:UIElement.IMAGE_NOT_CURRENT_PAGE_BG);var a=this.getImageByType(n?UIElement.IMAGE_CURRENT_PAGE_FG:UIElement.IMAGE_NOT_CURRENT_PAGE_FG);i=r.getImage();e=r.getImageRect();if(i){this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,e)}i=a.getImage();e=a.getImageRect();var o=this.text;if(o){t.textAlign="center";t.font=this.style.getFont();t.fillStyle=n?this.style.textColorHighlight:this.style.textColor}if(i){if(o){var s=this.style.fontSize+10;this.drawImageAt(t,i,UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN,0,0,this.w,this.h-s,e);t.textBaseline="bottom";t.fillText(o,this.w>>1,this.h-3)}else{this.drawImageAt(t,i,UIElement.IMAGE_DISPLAY_AUTO_SIZE_DOWN,0,0,this.w,this.h,e)}}else if(o){t.textBaseline="middle";t.fillText(o,this.w>>1,this.h>>1)}return};UIPageIndicatorButton.prototype.shapeCanBeChild=function(t){return t.isUIImage||t.isUILabel};function UIPageIndicatorButtonCreator(){var t=["ui-page-indicator-button","ui-page-indicator-button",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPageIndicatorButton;return e.initUIPageIndicatorButton(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIPageIndicatorButtonCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNormalXCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNormalCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorCircleCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorNumberCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorRectCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorLineCreator);ShapeFactoryGet().addShapeCreator(new UIPageIndicatorSimpleCreator);function UIPath(){return}UIPath.prototype=new UIElement;UIPath.prototype.isUIPath=true;UIPath.prototype.saveProps=["showPath"];UIPath.prototype.initUIPath=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onInit"]);return this};UIPath.prototype.shapeCanBeChild=function(t){return false};UIPath.prototype.onInit=function(){this.shapesInfo=[];this.elapsedTime=0;this.pathAnimation=new PathAnimation;this.animationState=UIElement.STATE_RUNNING;this.callOnInitHandler();return};UIPath.prototype.restart=function(){this.elapsedTime=0;this.animationState=UIElement.STATE_RUNNING;var t=this.shapesInfo;var e=this.shapesInfo.length;for(var i=0;i<e;i++){var n=t[i];n.done=false;n.startTime=n.delayTime}return this};UIPath.prototype.pause=function(){this.animationState=UIElement.STATE_PAUSED;return this};UIPath.prototype.resume=function(){this.animationState=UIElement.STATE_RUNNING;return this};UIPath.prototype.hasObj=function(t){var e=this.shapesInfo;var i=this.shapesInfo.length;for(var n=0;n<i;n++){var r=e[n];if(r.shape===t){return true}}return false};UIPath.prototype.addObj=function(t,e,i,n,r){if(this.hasObj(t)){console.log("obj exist in path.");return this}var a={shape:t,onStep:e,onDone:i,noRotation:r,delayTime:n?n:0,startTime:Date.now()};a.startTime=a.delayTime+this.elapsedTime;this.shapesInfo.push(a);return this};UIPath.prototype.removeObj=function(t){var e=this.shapesInfo;var i=this.shapesInfo.length;for(var n=0;n<i;n++){var r=e[n];if(r.shape===t){e.splice(n,1);break}}return this};UIPath.prototype.resetObjs=function(){this.shapesInfo=[];return this};UIPath.prototype.resetPath=function(){this.pathAnimation.reset();return this};UIPath.prototype.getStartPoint=function(){return this.pathAnimation.startPoint};UIPath.prototype.getEndPoint=function(){return this.endPoint};UIPath.prototype.addPath=function(t){this.pathAnimation.addPath(t);return this};UIPath.prototype.addLine=function(t,e,i,n){return this.addPath(LinePath.create(t,e,i.x,i.y,n.x,n.y))};UIPath.prototype.addArc=function(t,e,i,n,r,a){return this.addPath(ArcPath.create(t,e,i.x,i.y,n,r,a))};UIPath.prototype.addPara=function(t,e,i,n,r){return this.addPath(ParaPath.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};UIPath.prototype.addSin=function(t,e,i,n,r,a,o){return this.addPath(SinPath.create(t,e,i.x,i.y,n,r,a,o))};UIPath.prototype.addBezier=function(t,e,i,n,r,a){return this.addPath(Bezier3Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y,a.x,a.y))};UIPath.prototype.addQuad=function(t,e,i,n,r){return this.addPath(Bezier2Path.create(t,e,i.x,i.y,n.x,n.y,r.x,r.y))};UIPath.prototype.getDuration=function(){return this.pathAnimation.duration};UIPath.prototype.getPosition=function(t){return this.pathAnimation.getPosition(t)};UIPath.prototype.getDirection=function(t){return this.pathAnimation.getDirection(t)};UIPath.prototype.updateObjs=function(t){this.elapsedTime+=t.timeStep;var e=this.elapsedTime;var i=this.shapesInfo.slice();var n=this.shapesInfo.length;var r=this.pathAnimation;var a=r.getDuration();for(var o=0;o<n;o++){var s=i[o];var l=s.shape;if(!l||!l.parentShape)continue;var h=e-s.startTime;if(h>0&&!s.done){var u=r.getDirection(h);var c=r.getPosition(h);if(!l.visible){l.setVisible(true)}if(l.anchor){l.setPosition(c.x,c.y)}else{l.setPosition(c.x-(l.w>>1),c.y-(l.h>>1))}if(!s.noRotation){l.setRotation(u)}if(s.onStep){var p=s.onStep;p(l,h,c,u)}if(h>a){s.done=true;if(s.onDone){var f=s.onDone;f(l)}}}}};UIPath.prototype.paintSelf=function(t){if(this.isIcon||this.isInDesignMode()){UIElement.prototype.paintSelf.call(this,t);return}if(this.showPath&&!this.isStrokeColorTransparent()){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;this.pathAnimation.draw(t)}if(this.animationState===UIElement.STATE_RUNNING){this.updateObjs(t);t.needRedraw++}return};function UIPathCreator(){var t=["ui-path","ui-path",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPath;return e.initUIPath(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIPathCreator);this.Matrix2D=function(){"use strict";function t(t,e,i,n,r,a){this.setValues(t,e,i,n,r,a)}var e=t.prototype;t.DEG_TO_RAD=Math.PI/180;t.identity=null;e.setValues=function(t,e,i,n,r,a){this.a=t==null?1:t;this.b=e||0;this.c=i||0;this.d=n==null?1:n;this.tx=r||0;this.ty=a||0;return this};e.append=function(t,e,i,n,r,a){var o=this.a;var s=this.b;var l=this.c;var h=this.d;if(t!=1||e!=0||i!=0||n!=1){this.a=o*t+l*e;this.b=s*t+h*e;this.c=o*i+l*n;this.d=s*i+h*n}this.tx=o*r+l*a+this.tx;this.ty=s*r+h*a+this.ty;return this};e.prepend=function(t,e,i,n,r,a){var o=this.a;var s=this.c;var l=this.tx;this.a=t*o+i*this.b;this.b=e*o+n*this.b;this.c=t*s+i*this.d;this.d=e*s+n*this.d;this.tx=t*l+i*this.ty+r;this.ty=e*l+n*this.ty+a;return this};e.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.appendTransform=function(e,i,n,r,a,o,s,l,h){if(a%360){var u=a*t.DEG_TO_RAD;var c=Math.cos(u);var p=Math.sin(u)}else{c=1;p=0}if(o||s){o*=t.DEG_TO_RAD;s*=t.DEG_TO_RAD;this.append(Math.cos(s),Math.sin(s),-Math.sin(o),Math.cos(o),e,i);this.append(c*n,p*n,-p*r,c*r,0,0)}else{this.append(c*n,p*n,-p*r,c*r,e,i)}if(l||h){this.tx-=l*this.a+h*this.c;this.ty-=l*this.b+h*this.d}return this};e.prependTransform=function(e,i,n,r,a,o,s,l,h){if(a%360){var u=a*t.DEG_TO_RAD;var c=Math.cos(u);var p=Math.sin(u)}else{c=1;p=0}if(l||h){this.tx-=l;this.ty-=h}if(o||s){o*=t.DEG_TO_RAD;s*=t.DEG_TO_RAD;this.prepend(c*n,p*n,-p*r,c*r,0,0);this.prepend(Math.cos(s),Math.sin(s),-Math.sin(o),Math.cos(o),e,i)}else{this.prepend(c*n,p*n,-p*r,c*r,e,i)}return this};e.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;var r=this.b;this.a=n*e+this.c*i;this.b=r*e+this.d*i;this.c=-n*i+this.c*e;this.d=-r*i+this.d*e;return this};e.skew=function(e,i){e=e*t.DEG_TO_RAD;i=i*t.DEG_TO_RAD;this.append(Math.cos(i),Math.sin(i),-Math.sin(e),Math.cos(e),0,0);return this};e.scale=function(t,e){this.a*=t;this.b*=t;this.c*=e;this.d*=e;return this};e.translate=function(t,e){this.tx+=this.a*t+this.c*e;this.ty+=this.b*t+this.d*e;return this};e.identity=function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this};e.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var a=t*n-e*i;this.a=n/a;this.b=-e/a;this.c=-i/a;this.d=t/a;this.tx=(i*this.ty-n*r)/a;this.ty=-(t*this.ty-e*r)/a;return this};e.isIdentity=function(){return this.tx===0&&this.ty===0&&this.a===1&&this.b===0&&this.c===0&&this.d===1};e.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d};e.transformPoint=function(t,e,i){i=i||{};i.x=t*this.a+e*this.c+this.tx;i.y=t*this.b+e*this.d+this.ty;return i};e.decompose=function(e){if(e==null){e={}}e.x=this.tx;e.y=this.ty;e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b);e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d);var n=Math.atan2(this.b,this.a);var r=Math.abs(1-i/n);if(r<1e-5){e.rotation=n/t.DEG_TO_RAD;if(this.a<0&&this.d>=0){e.rotation+=e.rotation<=0?180:-180}e.skewX=e.skewY=0}else{e.skewX=i/t.DEG_TO_RAD;e.skewY=n/t.DEG_TO_RAD}return e};e.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)};e.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"};t.identity=new t;return t}();function loadDragonBoneArmature(t,e,i,n){var r=new Image;r.onload=function(){httpGetJSON(t,function(i){var a=i;if(!i){console.log("Get Json Failed:"+t);return}httpGetJSON(e,function(t){if(!t){console.log("Get Json Failed:"+e);return}var i=t;var o=new dragonBones.factorys.GeneralFactory;o.addSkeletonData(dragonBones.objects.DataParser.parseSkeletonData(i));o.addTextureAtlas(new dragonBones.textures.GeneralTextureAtlas(r,a));for(var s=0;s<i.armature.length;s++){var l=i.armature[s].name;var h=o.buildArmature(l);if(s===0){n(h)}}})})};r.src=i;return}function onArmatureCreated(t){var e=document.getElementById("canvas");var i=e.getContext("2d");t.setPosition(300,300);function n(){i.clearRect(0,0,e.width,e.height);dragonBones.animation.WorldClock.clock.advanceTime(1/60);t.draw(i);setTimeout(n,16)}function r(){do{var e=Math.floor(Math.random()*t.animation.animationNameList.length);var i=t.animation.animationNameList[e]}while(i==t.animation.getLastAnimationName());t.animation.gotoAndPlay(i)}e.onclick=r;dragonBones.animation.WorldClock.clock.add(t);r();n();return}function UIScene(){return}UIScene.prototype=new UINormalWindow;UIScene.prototype.isUIScene=true;UIScene.prototype.saveProps=["enablePhysics","showFPS","maxFPSMode","fps","gravityX","gravityY","pixelsPerMeter","virtualWidth","virtualHeight","xOffset","yOffset","openAnimationDuration","closeAnimationDuration","animHint","windowType","refLinesV","refLinesH","sceneId"];UIScene.prototype.canRectSelectable=function(){return this.virtualHeight<=this.h&&this.virtualWidth<=this.w};UIScene.prototype.initUIScene=function(t,e,i,n){this.initUIWindow(t,0,0,e,i,n);this.widthAttr=UIElement.WIDTH_FILL_PARENT;this.heightAttr=UIElement.HEIGHT_FILL_PARENT;this.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.xOffset=0;this.yOffset=0;this.virtualWidth=0;this.virtualHeight=0;this.autoClearForce=true;this.setAnimHint("none");this.setCanRectSelectable(false,true);this.addEventNames(["onPointerDown","onPointerMove","onPointerUp","onDoubleClick","onMultiTouch"]);this.addEventNames(["onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown"]);this.setImage(UIElement.IMAGE_TIPS1,null);this.setImage(UIElement.IMAGE_TIPS2,null);this.setImage(UIElement.IMAGE_TIPS3,null);this.setImage(UIElement.IMAGE_TIPS4,null);this.setImage(UIElement.IMAGE_TIPS5,null);this.setCameraFollowParams(.5,.5,.5,.5);this.velocityTracker=new VelocityTracker;return this};UIScene.prototype.resetGame=function(){UIElement.logWarning("This API is removed, don't call it anymore! call win.replay() instead. (don't call it in open/beforeopen event.)");return};UIScene.prototype.addStickyChild=function(t){if(t.parentShape!==this||t.left>=this.w||t.top>=this.h){console.log("%cWarning: invalid params to addStickyChild.","color: red; font-weight: bold");return this}t.orgX=t.left;t.orgY=t.top;this.stickyChildren.push(t);return this};UIScene.prototype.removeStickyChild=function(t){this.stickyChildren.remove(t);return this};UIScene.prototype.updateStickyChildren=function(){this.stickyChildren=[];var t=this.children;for(var e=0;e<t.length;e++){var i=t[e];if(i.sticky){if(i.orgX===undefined){i.orgX=i.left}if(i.orgY===undefined){i.orgY=i.top}this.stickyChildren.push(i)}}return this};UIScene.prototype.setEnablePhysics=function(t){this.enablePhysics=t;return this};UIScene.prototype.startPhysics=function(){if(this.enablePhysics){Physics.createWorld(this);if(this.world){if(this.map){this.map.createBodies(this.world)}}else{console.log("create world failed.")}}return this};UIScene.prototype.doInit=function(){this.xOffset=0;this.yOffset=0;this.setTimeScale(1);this.startPhysics();if(this.gameName){document.title=this.gameName}return};UIScene.prototype.onOpen=function(t){this.doInit();this.play();return};UIScene.prototype.onInit=function(){var t=this;this.initStageOne();this.updateStickyChildren();return};UIScene.prototype.onDeinit=function(){if(this.world){var t=this.world;Physics.destroyWorld(t);this.world=null}this.stop();return};UIScene.prototype.getVirtualWidth=function(){if(this.virtualWidth<this.w){return this.w}return this.virtualWidth};UIScene.prototype.getVirtualHeight=function(){if(this.virtualHeight<this.h){return this.h}return this.virtualHeight};UIScene.prototype.onScrolled=function(){var t=this.stickyChildren;if(t&&t.length){var e=this.xOffset;var i=this.yOffset;for(var n=0;n<t.length;n++){var r=t[n];var a=r.orgX+e;var o=r.orgY+i;r.setLeftTop(a,o);if(r.isUIBody){r.onPositionChanged()}}}return};UIScene.prototype.setOffsetDelta=function(t,e){return this.setOffset(this.xOffset+t,this.yOffset+e)};UIScene.prototype.setOffset=function(t,e){if(t||t===0){var i=this.getVirtualWidth()-this.w;var n=Math.max(0,t);if(n>i){n=i}this.xOffset=n>>0}if(e||e===0){var i=this.getVirtualHeight()-this.h;var r=Math.max(0,e);if(r>i){r=i}this.yOffset=r>>0}this.onScrolled();return this};UIScene.prototype.setOffsetPercent=function(t,e){var i=(this.virtualWidth-this.w)*(t/100);var n=(this.virtualHeight-this.h)*(e/100);return this.setOffset(i,n)};UIScene.prototype.getRelayoutWidth=function(){return this.getWidth()};UIScene.prototype.getRelayoutHeight=function(){return this.getHeight()};UIScene.prototype.defaultPaintChildren=function(t){var e=this.children;var i=this.children.length;for(var n=0;n<i;n++){var r=e[n];r.paintSelf(t)}return};UIScene.prototype.setMap=function(t){this.map=t;if(t){var e=t.getMapWidth();var i=t.getMapHeight();if(e>this.w){this.virtualWidth=e}if(i>this.h){this.virtualHeight=i}this.setOffset(0,0)}return this};UIScene.prototype.getMap=function(){return this.map};UIScene.prototype.drawBgImageTile=function(t,e,i){var n=i.w;var r=i.h;var a=0;var o=0;var s=this.w;var l=this.h;var h=s;var u=l;var c=i.x+this.xOffset%i.w;var p=i.y+this.yOffset%i.h;var f=c;var m=p;var d=i.x+i.w-c;var y=i.y+i.h-p;while(o<u){f=c;d=i.w-c;y=Math.min(y,Math.min(u-o,r));while(a<h){d=Math.min(d,Math.min(h-a,n));t.drawImage(e,f,m,d,y,a,o,d,y);a+=d;f=i.x;d=i.w}a=0;o+=y;y=i.h;m=i.y}};UIScene.prototype.drawBgImage=function(t){if(this.map){var e=this.xOffset;var i=this.yOffset;var n={x:e,y:i,w:this.w,h:this.h};t.translate(-e,-i);this.map.draw(t,n);t.translate(e,i);return}var r=this.getBgImage();if(r&&r.getImage()){var a=r.getImage();var o=r.getImageRect();var s=this.images.display;if(s===UIElement.IMAGE_DISPLAY_TILE_V){this.drawBgImageVTile(t,a,o)}else if(s===UIElement.IMAGE_DISPLAY_TILE_H){this.drawBgImageHTile(t,a,o)}else if(s===UIElement.IMAGE_DISPLAY_TILE){this.drawBgImageTile(t,a,o)}else{this.drawImageAt(t,a,s,0,0,this.w,this.h,o)}return}};UIScene.prototype.drawBgImageVTile=function(t,e,i){var n=this.w;var r=this.h;var a=i.w;var o=i.h;var s=n/a;var l=0;var h=i.x;var u=i.y+this.yOffset%o;var c=Math.min(i.y+o-u,r/s);for(var l=0;l<r;){var p=c*s;t.drawImage(e,h,u,a,c,0,l,n,p);l+=p;c=Math.min(o,(r-l)/s);u=i.y}};UIScene.prototype.drawBgImageHTile=function(t,e,i){var n=this.w;var r=this.h;var a=i.w;var o=i.h;var s=r/o;var l=0;var h=i.y;var u=i.x+this.xOffset%a;var c=Math.min(a-u,n/s);for(var l=0;l<n;){var p=c*s;t.drawImage(e,u,h,c,o,l,0,p,r);l+=p;c=Math.min(a,(n-l)/s);u=i.x}return};UIScene.prototype.afterPaintChildren=function(t){if(!this.isInDesignMode()){this.drawTipsImage(t)}if(!this.selected||!this.isInDesignMode()){return}var e=10;var i=this.w;var n=this.h;var r="";var a=i>>1;var o=this.getVirtualWidth();var s=this.getVirtualHeight();if(this.xOffset){r="XOffset:"+this.xOffset}if(this.yOffset){r+=" YOffset:"+this.yOffset}if(r){t.font="16pt Sans";t.textBaseline="top";t.textAlign="center";t.fillStyle="#202020";t.fillText(r,a,e)}if(!this.pointerDown){return}if(o===i&&s===n){return}var l=20;var h=t.globalAlpha;t.fillStyle=this.style.lineColor;if(o>i){var e=n-l;var u=i*(i/o);var a=i*(this.xOffset/o);t.globalAlpha=.2;t.fillRect(0,e,i,l);t.globalAlpha=.5;t.fillRect(a,e,u,l)}if(s>n){var a=i-l;var c=n*(n/s);var e=n*(this.yOffset/s);t.globalAlpha=.2;t.fillRect(a,0,l,n);t.globalAlpha=.5;t.fillRect(a,e,l,c)}t.globalAlpha=h;return};UIScene.prototype.paintFPS=function(t){var e=Math.floor(Date.now()/1e3);if(!this.lastSeconds){this.fps=0;this.drawCount=0;this.lastSeconds=e}this.drawCount++;if(e>this.lastSeconds){this.fps=this.drawCount;this.drawCount=0;this.lastSeconds=e}var i=30;var n=60;var r=this.fps;t.save();t.beginPath();t.rect(0,0,n,i);t.fillStyle="Black";t.fill();t.textAlign="center";t.textBaseline="middle";t.font="20px Sans";t.fillStyle="White";t.fillText(r,n>>1,i>>1);t.restore()};UIScene.prototype.paintSelf=function(t){this.stepAnimation(t);UIWindow.prototype.paintSelf.call(this,t);if(this.world&&this.debugBox2d){this.world.DrawDebugData()}if(t.setShowFPS){t.setShowFPS(this.showFPS)}else if(this.showFPS&&!this.isInDesignMode()){this.paintFPS(t)}return};UIScene.prototype.paintChildren=function(t){var e=this.xOffset;var i=this.yOffset;if(!e&&!i){this.defaultPaintChildren(t)}else{t.save();t.translate(-e,-i);this.defaultPaintChildren(t);t.restore()}return};UIScene.prototype.setTipsImage=function(t,e){this.tipsImageIndex=t;this.tipsImageDisplay=e;return this};UIScene.prototype.drawTipsImage=function(t){if(!this.tipsImageIndex){return}var e="tips_img_"+this.tipsImageIndex;var i=this.images[e];if(i){var n=i.getImage();if(n){var r=i.getImageRect();var a=this.tipsImageDisplay;if(!a&&a!==0){a=this.w<this.h?UIElement.IMAGE_DISPLAY_FIT_WIDTH:UIElement.IMAGE_DISPLAY_FIT_HEIGHT}this.drawImageAt(t,n,a,0,0,this.w,this.h,r)}}return};UIScene.prototype.stepAnimation=function(t){var e=this.animatingInfo;if(!e){return}var i=this.xOffset;var n=this.yOffset;var r=Math.min((t.now-e.startTime)/e.duration,1);var a=e.interpolator.get(r);console.log("stepAnimation:"+r+" "+a);if(e.xRange){i=e.xStart+a*e.xRange}if(e.yRange){n=e.yStart+a*e.yRange}if(r>=1){this.animatingInfo=null}this.setOffset(i,n);t.needRedraw++};UIScene.prototype.onPointerMoveEditing=function(t,e){if(!this.pointerDown||e||this.targetShape){return}return this.onPointerMoveCommon(t)};UIScene.prototype.onPointerMoveCommon=function(t){var e=this.getVirtualWidth();var i=this.getVirtualHeight();if(e===this.w&&i===this.h){return}var n=this.getMoveDeltaX();var r=this.getMoveDeltaY();if(e===this.w){n=0}if(i===this.h){r=0}this.setOffsetDelta(-n,-r);return};UIScene.prototype.fixChildSize=function(t){return};UIScene.prototype.fixChildPosition=function(t){return};UIScene.prototype.afterRelayoutChild=function(t){var e=this.getVirtualWidth();var i=this.getVirtualHeight();if(t.widthAttr===UIElement.WIDTH_FILL_PARENT){t.left=0;t.w=e}else if(t.widthAttr===UIElement.WIDTH_FILL_AVAILABLE){t.w=e-t.left}if(t.heightAttr===UIElement.HEIGHT_FILL_PARENT){t.top=0;t.h=i}else if(t.heightAttr===UIElement.HEIGHT_FILL_AVAILABLE){t.h=i-t.top}return};UIScene.prototype.getWorld=function(){return this.world};UIScene.prototype.createBodyForElement=function(t){Physics.createBodyForElement(this.world,this,t)};UIScene.prototype.afterChildAppended=function(t){if(this.isInDesignMode()||!this.world){return}if(this.world.IsLocked()){console.log("world IsLocked, so create body async");setTimeout(this.createBodyForElement.bind(this,t),0)}else{this.createBodyForElement(t)}};UIScene.prototype.afterChildRemoved=function(t){if(this.map===t){this.map=null}if(this.isInDesignMode()||!this.world){return}Physics.destroyBodyForElement(this.world,t);this.postRedraw();return};UIScene.prototype.translatePoint=function(t){var e={x:t.x-this.left+this.xOffset,y:t.y-this.top+this.yOffset};return e};UIScene.prototype.isPlaying=function(){return this.playing&&!this.isInDesignMode()};UIScene.prototype.replay=function(){this.openScene(this.name,this.initData);this.play();return this};UIScene.prototype.pause=function(){this.playing=false;this.setTimeScale(0);return this};UIScene.prototype.resume=function(){this.playing=true;this.setTimeScale(1);return this};UIScene.prototype.play=function(){this.playing=true;return};UIScene.prototype.stop=function(){this.playing=false;return};UIScene.prototype.toMeter=function(t){var e=this.pixelsPerMeter?this.pixelsPerMeter:10;return t/e};UIScene.prototype.toPixel=function(t){var e=this.pixelsPerMeter?this.pixelsPerMeter:10;return t*e};UIScene.prototype.getFPS=function(){return this.fps?this.fps:30};UIScene.prototype.setFPS=function(t){this.fps=Math.max(5,Math.min(50,t));return this};UIScene.prototype.setVelocityIterations=function(t){this.velocityIterations=t;return this};UIScene.prototype.setPositionIterations=function(t){this.positionIterations=t;return this};UIScene.prototype.setAutoClearForce=function(t){this.autoClearForce=t;return this};UIScene.prototype.setCameraFollowParams=function(t,e,i,n){this.cameraFollowParams={};this.cameraFollowParams.xMin=t;this.cameraFollowParams.xMax=e;this.cameraFollowParams.yMin=i;this.cameraFollowParams.yMax=n;return this};UIScene.prototype.cameraFollow=function(t){var e=this.w;var i=this.h;var n=t.left;var r=t.top;var a=n-this.xOffset;var o=r-this.yOffset;var s=this.cameraFollowParams;var l=this.xOffset;if(a>s.xMax*e){l=Math.round(n-s.xMax*e)+(t.w>>1)}else if(a<s.xMin*e){l=Math.round(n-s.xMin*e)+(t.w>>1)}var h=this.yOffset;if(o>s.yMax*i){h=Math.round(r-s.yMax*i)+(t.h>>1)}else if(o<s.yMin*i){h=Math.round(r-s.yMin*i)+(t.h>>1)}this.setOffset(l,h);return};UIScene.prototype.prepareForOpen=function(){if(this.world){var t=this.world;Physics.destroyWorld(t);this.world=null}UIWindow.prototype.prepareForOpen.call(this)};UIScene.prototype.isCurrent=function(){var t=this.getParent();return t&&t.getCurrentFrame()===this};UIScene.prototype.onCreateRUBEBody=function(t){if(t){return Physics.createUIRubeBody(t,this.world,this)}return null};UIScene.prototype.onRUBEJointCreated=function(t){if(t){return Physics.createElementForJoint(t,this.world,this)}return null};function UISceneCreator(){var t=["ui-scene","ui-scene",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIScene;return e.initUIScene(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UISceneCreator);function UISoundMusic(){return}UISoundMusic.prototype=new UICheckBox;UISoundMusic.prototype.isUISoundMusic=true;UISoundMusic.prototype.initUISoundMusic=function(t){this.initUICheckBox(t);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISoundMusic.prototype.shapeCanBeChild=function(t){if(t.isUISoundEffects||t.isUISoundMusic){return false}return UIGroup.prototype.shapeCanBeChild.call(this,t)};UISoundMusic.prototype.setValue=function(t){if(this.isInDesignMode()){return this}this.setSoundMusicEnable(t);return this};UISoundMusic.prototype.getValue=function(t){if(this.isInDesignMode()){return true}return this.getSoundMusicEnable()};UISoundMusic.prototype.isPlaying=UISoundMusic.prototype.getValue;function UISoundMusicCreator(){var t=["ui-sound-music","ui-sound-music",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISoundMusic;return e.initUISoundMusic(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISoundMusicCreator);function UISoundEffects(){return}UISoundEffects.prototype=new UICheckBox;UISoundEffects.prototype.isUISoundEffects=true;UISoundEffects.prototype.initUISoundEffects=function(t){this.initUICheckBox(t);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UISoundEffects.prototype.shapeCanBeChild=function(t){if(t.isUISoundEffects||t.isUISoundMusic){return false}return UIGroup.prototype.shapeCanBeChild.call(this,t)};UISoundEffects.prototype.setValue=function(t){if(this.isInDesignMode()){return this}this.setSoundEffectEnable(t);return this};UISoundEffects.prototype.getValue=function(t){if(this.isInDesignMode()){return true}return this.getSoundEffectEnable(t)};UISoundEffects.prototype.isPlaying=UISoundEffects.prototype.getValue;function UISoundEffectsCreator(){var t=["ui-sound-effects","ui-sound-effects",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISoundEffects;return e.initUISoundEffects(this.type)};return}ShapeFactoryGet().addShapeCreator(new UISoundEffectsCreator);function UIStatus(){return}UIStatus.prototype=new UIElement;UIStatus.prototype.isUIStatus=true;UIStatus.prototype.saveProps=["horizonal","realValue"];UIStatus.prototype.initUIStatus=function(t,e,i){this.initUIElement(t);this.realValue=.5;this.roundRadius=5;this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.addEventNames(["onBecomeZero","onBecomeFull","onChanged","onUpdateTransform"]);return this};UIStatus.prototype.shapeCanBeChild=function(t){return this.children.length===0&&t.isUILabel};UIStatus.prototype.setValue=function(t){this.realValue=Math.max(0,Math.min(100,t))/100;if(this.realValue===0){this.callOnBecomeZeroHandler()}else if(this.realValue===1){this.callOnBecomeFullHandler()}this.callOnChangedHandler(this.getValue());return this.getValue()};UIStatus.prototype.getValue=function(){return Math.round(this.realValue*100)};UIStatus.prototype.paintSelfOnly=function(t){var e=this.realValue;var i=this.roundRadius;var n=Math.round(e*this.h);var r=Math.round((1-e)*this.h);var a=Math.round(e*this.w);var o=Math.round((1-e)*this.w);t.save();t.beginPath();drawRoundRect(t,this.w,this.h,i);t.clip();if(!this.isFillColorTransparent()){t.fillStyle=this.style.fillColor;t.beginPath();if(this.horizonal){t.translate(a,0);t.rect(0,0,o,this.h);t.translate(-a,0)}else{t.rect(0,0,this.w,r)}t.fill()}if(!this.isTextColorTransparent()){t.fillStyle=this.style.textColor;t.beginPath();if(this.horizonal){t.rect(0,0,a,this.h)}else{t.translate(0,r);t.rect(0,0,this.w,n);t.translate(0,-r)}t.fill()}t.restore();if(!this.isStrokeColorTransparent()&&this.style.lineWidth){t.beginPath();t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;drawRoundRect(t,this.w,this.h,i,RoundRect.BL|RoundRect.BR|RoundRect.TL|RoundRect.TR);t.stroke()}t.beginPath();return};function UIStatusCreator(){var t=["ui-status","ui-status",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIStatus;return e.initUIStatus(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIStatusCreator);function UITimer(){return}UITimer.prototype=new UIElement;UITimer.prototype.isUITimer=true;UITimer.prototype.saveProps=["times","delayStart","durationType","duration","durationMin","durationMax"];UITimer.prototype.initUITimer=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_AUTO;this.addEventNames(["onTimeout"]);return this};UITimer.prototype.shapeCanBeChild=function(t){return false};UITimer.prototype.onInit=function(){var t=this;var e=this.win;function i(){t.start();e.off("open",i)}if(this.enable){e.on("open",i);console.log("start timer.")}else{console.log("not start disable timer.")}return};UITimer.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}this.enable=t;if(t){this.start()}else{this.stop()}return};UITimer.prototype.getDuration=function(){if(this.durationType==="random"){var t=this.durationMin+Math.random()*(this.durationMax-this.durationMin);return t}else{return this.duration}};UITimer.prototype.start=function(){if(!this.enable){console.log("can not start disabled timer, please call setEnable first.")}if(this.timerID){console.log("Timer is alread started:"+this.timerID);return}var t=this;this.paused=false;this.startTime=Date.now();function e(){if(!t.enable||!t.timerID||!t.parentShape||!t.win){t.timerID=null;return}if(t.paused){t.timerID=setTimeout(e,t.getDuration());return}if(t.timeScaleIsZero()){t.timerID=setTimeout(e,t.getDuration());return}if(t.win.isVisible()){t.callOnTimeoutHandler();t.times--}if(t.times<=0){t.timerID=null;console.log("timer stop "+t.name)}else{t.timerID=setTimeout(e,t.getDuration())}}if(this.delayStart){this.timerID=setTimeout(function(){t.timerID=setTimeout(e,t.getDuration())},this.delayStart)}else{this.timerID=setTimeout(e,t.getDuration())}return this};UITimer.prototype.stop=function(){if(this.timerID){clearTimeout(this.timerID);this.timerID=null}return this};UITimer.prototype.pause=function(){this.paused=true;return this};UITimer.prototype.resume=function(){this.paused=false;return this};UITimer.prototype.getElapsedTime=function(){return Date.now()-this.startTime};function UITimerCreator(){var t=["ui-timer","ui-timer",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITimer;return e.initUITimer(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UITimerCreator);function UIDragger(){return}UIDragger.prototype=new UIElement;UIDragger.prototype.isUIDragger=true;UIDragger.prototype.saveProps=["enableVer","enableHor"];UIDragger.prototype.initUIDragger=function(t,e,i){this.initUIElement(t,e,i);this.enableVer=true;this.enableHor=true;this.addEventNames(["onDragStart","onDragging","onDragEnd"]);return this};UIDragger.prototype.onInit=function(){var t=this.getParent();var e=this.enableHor;var i=this.enableVer;var n=this;if(t.isUIPhysicsShape||t.isUIImage||t.isUISkeletonAnimation||t.isUIFrameAnimation||t.isUIScene){t.handlePointerDown=function(e,i){if(!i)return;n.callOnDragStartHandler();return UIDragger.handleSpritePointerDown(t,e)};t.handlePointerMove=function(r,a){if(!a)return;if(t.pointerDown){n.callOnDraggingHandler()}return UIDragger.handleSpritePointerMove(t,r,i,e);
};t.handlePointerUp=function(e,i){if(!i)return;n.callOnDragEndHandler();return UIDragger.handleSpritePointerUp(t,e)}}};UIDragger.handleSpritePointerDown=function(t,e){if(t.isUIScene){t.saveXOffset=t.xOffset;t.saveYOffset=t.yOffset}else{t.saveX=t.left;t.saveY=t.top}return};UIDragger.handleSpritePointerUp=function(t,e){};UIDragger.handleSpritePointerMove=function(t,e,i,n){if(t.pointerDown){var r=t.getMoveAbsDeltaX();var a=t.getMoveAbsDeltaY();if(t.isUIScene){var o=n?t.saveXOffset-r:t.saveXOffset;var s=i?t.saveYOffset-a:t.saveYOffset;t.setOffset(o,s)}else{var o=n?t.saveX+r:t.saveX;var s=i?t.saveY+a:t.saveY;t.setLeftTop(o,s);t.onPositionChanged()}}return};function UIDraggerCreator(){var t=["ui-dragger","ui-dragger",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIDragger;return e.initUIDragger(this.type,20,20,null)};return}ShapeFactoryGet().addShapeCreator(new UIDraggerCreator);function UISprite(){return}UISprite.prototype=new UIImage;UISprite.prototype.isUISprite=true;UISprite.prototype.initUISprite=function(t,e,i,n){this.initUIImage(t,e,i,n);return this};function UISpriteCreator(){var t=["ui-sprite","ui-sprite",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISprite;return e.initUISprite(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UISpriteCreator);function UITransformAnimation(){return}UITransformAnimation.prototype=new UIImage;UITransformAnimation.prototype.isUITransformAnimation=true;UITransformAnimation.prototype.initUITransformAnimation=function(t,e,i,n){this.initUIImage(t,e,i,n);this.animationConfig={};this.animationConfig.opacityFrom=1;this.animationConfig.opacityTo=1;this.animationConfig.scaleXFrom=1;this.animationConfig.scaleXTo=1;this.animationConfig.scaleYFrom=1;this.animationConfig.scaleYTo=1;this.animationConfig.rotationFrom=0;this.animationConfig.rotationTo=0;this.animationConfig.offsetXFrom=0;this.animationConfig.offsetXTo=0;this.animationConfig.offsetYFrom=0;this.animationConfig.offsetYTo=0;this.animationConfig.frequency=2;this.animationConfig.random=1e3*Math.random();return this};UITransformAnimation.prototype.pause=function(){if(this.highlightConfig){this.highlightConfig.paused=true}return this};UITransformAnimation.prototype.resume=function(){if(this.highlightConfig){this.highlightConfig.paused=false}return this};UITransformAnimation.prototype.play=function(){this.setHighlightConfig(this.animationConfig);return this};UITransformAnimation.prototype.stop=function(){this.setHighlightConfig(null);return this};UITransformAnimation.prototype.getScaleXFrom=function(){return this.animationConfig.scaleXFrom};UITransformAnimation.prototype.setScaleXFrom=function(t){this.animationConfig.scaleXFrom=t;this.play();return this};UITransformAnimation.prototype.getScaleXTo=function(){return this.animationConfig.scaleXTo};UITransformAnimation.prototype.setScaleXTo=function(t){this.animationConfig.scaleXTo=t;this.play();return this};UITransformAnimation.prototype.getScaleYFrom=function(){return this.animationConfig.scaleYFrom};UITransformAnimation.prototype.setScaleYFrom=function(t){this.animationConfig.scaleYFrom=t;this.play();return this};UITransformAnimation.prototype.getScaleYTo=function(){return this.animationConfig.scaleYTo};UITransformAnimation.prototype.setScaleYTo=function(t){this.animationConfig.scaleYTo=t;this.play();return this};UITransformAnimation.RADIAN_TO_ANGLE=180/Math.PI;UITransformAnimation.prototype.getRotationFrom=function(){return this.animationConfig.rotationFrom*UITransformAnimation.RADIAN_TO_ANGLE};UITransformAnimation.prototype.setRotationFrom=function(t){this.animationConfig.rotationFrom=t/UITransformAnimation.RADIAN_TO_ANGLE;this.play();return this};UITransformAnimation.prototype.getRotationTo=function(){return this.animationConfig.rotationTo*UITransformAnimation.RADIAN_TO_ANGLE};UITransformAnimation.prototype.setRotationTo=function(t){this.animationConfig.rotationTo=t/UITransformAnimation.RADIAN_TO_ANGLE;this.play();return this};UITransformAnimation.prototype.getOpacityFrom=function(){return this.animationConfig.opacityFrom};UITransformAnimation.prototype.setOpacityFrom=function(t){this.animationConfig.opacityFrom=t;this.play();return this};UITransformAnimation.prototype.getOpacityTo=function(){return this.animationConfig.opacityTo};UITransformAnimation.prototype.setOpacityTo=function(t){this.animationConfig.opacityTo=t;this.play();return this};UITransformAnimation.prototype.getXFrom=function(){return this.animationConfig.offsetXFrom};UITransformAnimation.prototype.setXFrom=function(t){this.animationConfig.offsetXFrom=t;this.play();return this};UITransformAnimation.prototype.getXTo=function(){return this.animationConfig.offsetXTo};UITransformAnimation.prototype.setXTo=function(t){this.animationConfig.offsetXTo=t;this.play();return this};UITransformAnimation.prototype.getYFrom=function(){return this.animationConfig.offsetYFrom};UITransformAnimation.prototype.setYFrom=function(t){this.animationConfig.offsetYFrom=t;this.play();return this};UITransformAnimation.prototype.getYTo=function(){return this.animationConfig.offsetYTo};UITransformAnimation.prototype.setYTo=function(t){this.animationConfig.offsetYTo=t;this.play();return this};UITransformAnimation.prototype.getFrequency=function(){return this.animationConfig.frequency};UITransformAnimation.prototype.setFrequency=function(t){this.animationConfig.frequency=t;this.play();return this};UITransformAnimation.prototype.getRandom=function(){return this.animationConfig.random};UITransformAnimation.prototype.setRandom=function(t){this.animationConfig.random=t%1e3;this.play();return this};UITransformAnimation.prototype.doFromJson=function(t){UISprite.prototype.doFromJson.call(this,t);if(t.animationConfig){this.animationConfig=JSON.parse(JSON.stringify(t.animationConfig));this.play()}return};UITransformAnimation.prototype.doToJson=function(t){UISprite.prototype.doToJson.call(this,t);t.animationConfig=JSON.parse(JSON.stringify(this.animationConfig));return t};UITransformAnimation.prototype.beforePaintChildren=function(t){return this};UITransformAnimation.prototype.onInit=function(){this.play();return};function UITransformAnimationCreator(){var t=["ui-transform-animation","ui-transform-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITransformAnimation;return e.initUITransformAnimation(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UITransformAnimationCreator);function UISkeletonAnimation(){return}UISkeletonAnimation.prototype=new UIElement;UISkeletonAnimation.prototype.isUISkeletonAnimation=true;UISkeletonAnimation.prototype.saveProps=["enableCache","animationName","skinName","animationScaleX","animationScaleY","textureJsonURL","skeletonJsonURL","textureURL"];UISkeletonAnimation.prototype.urlProps=["textureJsonURL","skeletonJsonURL","textureURL"];UISkeletonAnimation.prototype.initUISkeletonAnimation=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setSizeLimit(50,50);this.setTextType(Shape.TEXT_NONE);this.setCanRectSelectable(false,true);this.addEventNames(["onDoubleClick","onUpdateTransform","onLoadDone"]);this.animTimeScale=1;this.animationScaleX=1;this.animationScaleY=1;this.animationNames=[];return this};UISkeletonAnimation.prototype.play=function(t,e,i,n,r,a){var o=this;if(o.loadDataDone!==true){this.initPlayArgs=[].slice.call(arguments);return}var s=Deferred();this.resume();this.doPlay(t,e,function(){if(typeof i==="function"){i.call(o)}s.resolve()},function(){if(typeof n==="function"){n.call(o)}},r,a);return s.promise};UISkeletonAnimation.prototype.setSkeletonJsonURL=function(t){this.skeletonJsonURL=t;return this};UISkeletonAnimation.prototype.getSkeletonJsonURL=function(){return this.skeletonJsonURL?this.skeletonJsonURL:""};UISkeletonAnimation.prototype.setTextureJsonURL=function(t){this.textureJsonURL=t;return this};UISkeletonAnimation.prototype.getTextureJsonURL=function(){return this.textureJsonURL?this.textureJsonURL:""};UISkeletonAnimation.prototype.setTextureURL=function(t){this.textureURL=t;return this};UISkeletonAnimation.prototype.getTextureURL=function(){return this.textureURL?this.textureURL:""};UISkeletonAnimation.prototype.loadSheletonData=function(t,e,i,n){var r=this;ResLoader.loadImage(i,function(i){var r=ResLoader.loadJson;if(t.indexOf(".atlas")>0){r=ResLoader.loadData}r(t,function(r){var a=r;if(!r){console.log("Get Json Failed:"+t);return}ResLoader.loadJson(e,function(t){if(!t){console.log("Get Json Failed:"+e);return}var r=t;n(i,a,r)})})});return};UISkeletonAnimation.prototype.createSkelentonAnimation=function(t){var e=this;this.destroyArmature();function i(i,n,r){e.createArmature(i,n,r);var a=e.getAnimationName();if(e.skinName){e.setSkin(e.skinName)}e.loadDataDone=true;if(e.initPlayArgs){e.play.apply(e,e.initPlayArgs);e.initPlayArgs=null}else{e.play(a)}e.callOnLoadDoneHandler();if(t){t()}}e.loadDataDone=false;this.loadSheletonData(this.textureJsonURL,this.skeletonJsonURL,this.textureURL,i);return};UISkeletonAnimation.prototype.onFromJsonDone=function(t){if(this.textureURL&&this.textureJsonURL&&this.skeletonJsonURL){function e(t,e,i){console.log("skeleton preload data done.")}this.loadSheletonData(this.textureJsonURL,this.skeletonJsonURL,this.textureURL,e)}if(t&&t.animationScale){if(!t.animationScaleX){this.animationScaleX=t.animationScale}if(!t.animationScaleY){this.animationScaleY=t.animationScale}delete this.animationScale}return};UISkeletonAnimation.prototype.onInit=function(){this.reload();return};UISkeletonAnimation.prototype.reload=function(t){if(this.textureURL&&this.textureJsonURL&&this.skeletonJsonURL){this.createSkelentonAnimation(t)}return this};UISkeletonAnimation.prototype.destroy=function(){this.destroyArmature();Shape.prototype.destroy.call(this);return};UISkeletonAnimation.prototype.callOnLoadDoneHandler=function(){if(this.isInDesignMode()){return}if(!this.handleOnLoadDone){var sourceCode=this.events["onLoadDone"];if(sourceCode){sourceCode="this.handleOnLoadDone = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnLoadDone){try{this.handleOnLoadDone()}catch(e){console.log("this.handleOnLoadDone:"+e.message)}}return true};UISkeletonAnimation.prototype.destroyArmature=function(){};UISkeletonAnimation.prototype.pause=function(){return this};UISkeletonAnimation.prototype.resume=function(){return this};UISkeletonAnimation.prototype.getAnimationDuration=function(t){};UISkeletonAnimation.prototype.getAnimationNames=function(){return this.animationNames};UISkeletonAnimation.prototype.setAnimationName=function(t){this.animationName=t;return this};UISkeletonAnimation.prototype.getAnimationName=function(){if(this.animationName)return this.animationName;var t=this.getAnimationNames();return t?t[0]:""};UISkeletonAnimation.prototype.setScale=function(t){this.animationScaleX=t;this.animationScaleY=t;return this};UISkeletonAnimation.prototype.getScale=function(){return this.animationScaleX};UISkeletonAnimation.prototype.setScaleX=function(t){this.animationScaleX=t;return this};UISkeletonAnimation.prototype.setScaleY=function(t){this.animationScaleY=t;return this};UISkeletonAnimation.prototype.getScaleX=function(t){return this.animationScaleX};UISkeletonAnimation.prototype.getScaleY=function(t){return this.animationScaleY};UISkeletonAnimation.prototype.applyScale=function(t){};UISkeletonAnimation.prototype.setTimeScale=function(t){this.animTimeScale=t;return this};UISkeletonAnimation.prototype.setDuration=function(t){};UISkeletonAnimation.prototype.preprocessTextureAtlas=function(t){return t};UISkeletonAnimation.prototype.setSkin=function(t){this.skinName=t;return this};UISkeletonAnimation.prototype.getSkin=function(){return this.skinName};UISkeletonAnimation.prototype.getSkins=function(){return["default"]};UISkeletonAnimation.prototype.isPaused=function(){return this.timeScaleIsZero()};UISkeletonAnimation.prototype.shapeCanBeChild=UISprite.prototype.shapeCanBeChild;function UIBitmapFontText(){return}UIBitmapFontText.prototype=new UIElement;UIBitmapFontText.prototype.isUIBitmapFontText=true;UIBitmapFontText.prototype.saveProps=["allText","textAlignment","imageRows","imageColumns"];UIBitmapFontText.prototype.initUIBitmapFontText=function(t,e,i){this.initUIElement(t);this.text="";this.textAlignment="center";this.setMargin(5,5);this.setDefSize(e,i);this.setSizeLimit(10,10);this.setTextType(Shape.TEXT_NONE);this.addEventNames(["onUpdateTransform"]);this.setImage(UIElement.IMAGE_NORMAL_FG,null);this.setImage("option_image_0",null);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);return this};UIBitmapFontText.prototype.getDefaultImageType=function(){return UIElement.IMAGE_NORMAL_FG};UIBitmapFontText.prototype.shapeCanBeChild=function(t){return false};UIBitmapFontText.prototype.setImageWithRowCols=function(t,e,i){this.imageRows=e;this.imageColumns=i;this.setImage(UIElement.IMAGE_NORMAL_FG,t);return};UIBitmapFontText.prototype.getRectOfChar=function(t,e,i){if(this.allText){var n=this.allText.length;var r=this.allText.indexOf(i);if(r>=0){var a=e.trimmed?e.rw:e.w;var o=e.trimmed?e.rh:e.h;var s=this.imageRows?this.imageRows:o>a?n:1;var l=this.imageColumns?this.imageColumns:a>o?n:1;var h=Math.round(a/l);var u=Math.round(o/s);var c=Math.floor(r/l);var i=r%l;var p={};p.w=h;p.h=u;p.x=h*i+e.x;p.y=u*c+e.y;if(r===0){p.w=p.w-(e.ox||0);p.h=p.h-(e.oy||0)}else{p.x=p.x-(e.ox||0);p.y=p.y-(e.oy||0)}return p}}return null};UIBitmapFontText.prototype.setAllText=function(t){this.allText=t;return this};UIBitmapFontText.prototype.getAllText=function(){return this.allText};UIBitmapFontText.prototype.getBgImage=function(){var t=null;if(this.pointerDown&&!this.isClicked()){t=this.images.active_bg}else{t=this.images.normal_bg}if(!t||!t.getImage()){t=this.images.default_bg}if(!t||!t.getImage()){return}return t};UIBitmapFontText.prototype.drawFgImage=function(t){var e=this.text;var i=this.getImageByType(UIElement.IMAGE_NORMAL_FG);if(!e||!i){return}var n=i.getImage();var r=i.getImageRect();if(!n){return}var a=0;var o=this.h;var s=15;for(var l=0;l<e.length;l++){var h=e[l];var u=this.getRectOfChar(n,r,h);if(u){a+=u.w;if(u.h>s){s=u.h}}}var c=0;var p=0;var f=0;var m=this.h>>1;var d=Math.min(this.h/s,this.w/a);switch(this.textAlignment){case"right":{p=this.w-this.hMargin-a;f=p+a;break}case"center":{p=this.w-a>>1;f=this.w>>1;break}default:{p=this.hMargin;f=p;break}}if(d!=1){t.translate(f,m);t.scale(d,d);t.translate(-f,-m)}for(var l=0;l<e.length;l++){var h=e[l];var u=this.getRectOfChar(n,r,h);if(u){c=o-u.h>>1;t.drawImage(n,u.x,u.y,u.w,u.h,p,c,u.w,u.h);p+=u.w}}return};function UIBitmapFontTextCreator(){var t=["ui-bitmap-font-text","ui-bitmap-font-text",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBitmapFontText;return e.initUIBitmapFontText(this.type,400,100)};return}ShapeFactoryGet().addShapeCreator(new UIBitmapFontTextCreator);function UIBitmapFontTextX(){return}UIBitmapFontTextX.prototype=new UIElement;UIBitmapFontTextX.prototype.isUIBitmapFontTextX=true;UIBitmapFontTextX.prototype.saveProps=["spacer"];UIBitmapFontTextX.prototype.initUIBitmapFontTextX=function(t){this.spacer=0;this.initUIElement(t);this.textAlignment="center";this.addEventNames(["onUpdateTransform"]);return this};UIBitmapFontTextX.prototype.getCharDesc=function(t){if(this.bitmapFont){return this.bitmapFont.getCharDesc(t)}else{if(!this.charsDesc){this.charsDesc={}}var e=this.charsDesc[t];var i=this.getImageByType(t);if(!e&&i){var n=i.getImageRect();if(n&&n.w){this.charsDesc[t]={};e=this.charsDesc[t];e.x=n.x;e.y=n.y;e.w=n.w;e.h=n.h;e.image=i}}return e}};UIBitmapFontTextX.prototype.parseFont=function(t,e){var i=e.dirname();this.bitmapFont=new BitmapFont;this.bitmapFont.parse(t);var n=this.bitmapFont.getPagesDesc();for(var r in n){var a=n[r];var o=i+"/"+a.file;this.setImage("page"+a.id,o)}var s=this.bitmapFont.getCharsDesc();for(var l in s){var h=s[l];h.image=this.getImageByType("page"+h.page)}return};UIBitmapFontTextX.prototype.parseJson=function(t,e){var i=t.frames;var n=e.dirname()+"/"+t.meta.image;for(var r in i){var a=r.replace(".png","");if(a.length===1){this.setImage(a,e+"#"+r)}}return};UIBitmapFontTextX.prototype.setDataURL=function(t){this.images={};this.images.display=0;this.dataURL=t;if(t){if(t.endWith(".fnt")){ResLoader.loadData(t,function(e){this.parseFont(e,t)}.bind(this))}else if(t.endWith(".json")){ResLoader.loadJson(t,function(e){this.parseJson(e,t)}.bind(this))}else{console.log("not supported:"+t)}}return this};UIBitmapFontTextX.prototype.setSpacer=function(t){this.spacer=t;return this};UIBitmapFontTextX.prototype.getDataURL=function(){return this.dataURL};UIBitmapFontTextX.prototype.measureText=function(){var t=0;var e=10;var i=this.text;var n=this.spacer;for(var r=0;r<i.length;r++){var a=this.getCharDesc(i[r]);if(a){var o=a.rw||a.w;var s=a.rh||a.h+(a.oy||0);t+=o;if(e<s){e=s}if(r){t+=n}}}return{w:t,h:e}};UIBitmapFontTextX.prototype.onFromJsonDone=function(){this.setDataURL(this.dataURL)};UIBitmapFontTextX.prototype.drawText=function(t){var e=this.text;if(!e){return}var i=0;var n=0;var r=0;var a=this.h;var o=this.w;var s=a>>1;var l=this.spacer;var h=this.hMargin;var u=this.measureText();if(u.w<1||u.h<1){return}var c=Math.min(a/u.h,o/u.w);switch(this.textAlignment){case"right":{n=o-h-u.w;r=n+u.w;break}case"center":{n=o-u.w>>1;r=o>>1;break}default:{n=h;r=n;break}}t.save();if(c!==1){t.translate(r,s);t.scale(c,c);t.translate(-r,-s)}var p=0;var f=0;var m=a-u.h>>1;for(var d=0;d<e.length;d++){var y=e[d];var v=this.getCharDesc(y);if(v&&v.image){var g=v;var _=v.image.getImage();if(_){p=n+(g.ox||0);f=m+(g.oy||0);t.drawImage(_,g.x,g.y,g.w,g.h,p,f,g.w,g.h);n+=g.rw||g.w;n+=l}}}t.restore();return};function UIBitmapFontTextXCreator(){var t=["ui-bitmap-font-text-x","ui-bitmap-font-text-x",null,true];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBitmapFontTextX;return e.initUIBitmapFontTextX(this.type,400,100)};return}ShapeFactoryGet().addShapeCreator(new UIBitmapFontTextXCreator);function UIFrameAnimation(){return}UIFrameAnimation.prototype=new UIElement;UIFrameAnimation.prototype.isUIFrameAnimation=true;UIFrameAnimation.prototype.saveProps=["autoPlay","frameRate","autoPlayDelay","defaultGroupName"];UIFrameAnimation.prototype.initUIFrameAnimation=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.current=0;this.frameRate=10;this.playing=false;this.autoPlay=true;this.repeatTimes=4294967295;this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.frames=[];this.addEventNames(["onDoubleClick","onUpdateTransform"]);return this};UIFrameAnimation.prototype.syncImageFrames=function(){this.frames=[];for(var t in this.images){var e=this.images[t];if(t.indexOf("option_image_")>=0&&e){this.frames.push(e)}}return};UIFrameAnimation.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);if(this.groups){t.groups=JSON.parse(JSON.stringify(this.groups))}return t};UIFrameAnimation.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.playing=false;this.syncImageFrames();if(t.groups){this.groups=t.groups}else if(t.groupsData){this.groups=this.parseGroupsData(t.groupsData);this.groupsData=null}return t};UIFrameAnimation.prototype.afterChildAppended=function(t){t.xAttr=UIElement.X_CENTER_IN_PARENT;t.yAttr=UIElement.Y_MIDDLE_IN_PARENT;return};UIFrameAnimation.prototype.setAutoPlay=function(t){this.autoPlay=t;return this};UIFrameAnimation.prototype.resume=function(){this.playing=true;return this};UIFrameAnimation.prototype.pause=function(){this.playing=false;return this};UIFrameAnimation.prototype.stop=function(){this.playing=false;return this};UIFrameAnimation.prototype.playSequence=function(t,e,i,n){this.deferred=Deferred();var r=this.frames.length;if(!r||!t||!t.length){return}this.current=0;this.playing=true;this.onDone=i;this.onOneCycle=n;this.runningSequence=t;this.nextUpdateTime=Date.now()+this.getDuration();this.repeatTimes=e?e:4294967295;return this.deferred.promise};UIFrameAnimation.prototype.playRange=function(t,e,i,n,r){var a=this.frames.length;if(t>e){var o=t;t=e;e=o}var s=[];for(var l=t;l<=e;l++){s.push(l)}return this.playSequence(s,i,n,r)};UIFrameAnimation.prototype.gotoAndPlayByName=function(t,e,i,n){var r=this.getGroupRange(t);if(r.start!==undefined&&r.end!==undefined){return this.gotoAndPlay(r.start,r.end,e,i,n)}else if(r&&r.length){return this.playSequence(r,e,i,n)}else if(this.animations&&t){return this.animate(t)}};UIFrameAnimation.prototype.play=UIFrameAnimation.prototype.gotoAndPlayByName;UIFrameAnimation.prototype.gotoAndPlay=UIFrameAnimation.prototype.playRange;UIFrameAnimation.prototype.nextFrame=function(){if(!this.frames||!this.frames.length||!this.runningSequence||!this.runningSequence.length){return}var t=this.current+1;var e=this.runningSequence.length;if(t===e){if(this.onOneCycle){try{this.onOneCycle(this)}catch(i){console.log("onOneCycle: "+i.message)}}this.repeatTimes--;if(this.repeatTimes<=0){this.playing=false;if(this.onDone){try{this.onDone(this)}catch(i){console.log("onDone: "+i.message)}}if(this.deferred){this.deferred.resolve()}return}}this.current=t%e;return};UIFrameAnimation.prototype.getCurrentImage=function(){if(!this.frames||!this.frames.length){return null}if(!this.runningSequence||!this.runningSequence.length){return this.frames[0]}if(this.current>=this.runningSequence.length){this.current=0}var t=this.runningSequence[this.current];return this.frames[t]};UIFrameAnimation.prototype.getGroupRange=function(t){var e=null;if(this.groups&&t){e=this.groups[t]}if(!e){e={start:0,end:this.frames.length-1}}return e};UIFrameAnimation.prototype.getImages=function(){var t="";for(var e in this.images){var i=this.images[e];if(e.indexOf("option_image_")>=0&&i&&i.src){t+=i.src.toRelativeURL()+"\n"}}return t};UIFrameAnimation.prototype.setImages=function(t){var e=this.images.display;this.images={};this.images.display=e;if(t){var i=0;var n=0;var r=t.split("\n");for(var i=0;i<r.length;i++){var a=r[i];if(!a)continue;if(a.indexOf("/")===0){a=a.substr(1)}var o="option_image_"+n++;this.setImage(o,a)}}this.syncImageFrames();return this};UIFrameAnimation.prototype.getValue=function(){return this.current};UIFrameAnimation.prototype.setValue=function(t){this.current=Math.min(t,this.frames.length);return this};UIFrameAnimation.prototype.startAutoPlay=function(){if(this.defaultGroupName){this.play(this.defaultGroupName,268435455)}else{this.gotoAndPlay(0,this.frames.length-1,268435455)}return};UIFrameAnimation.prototype.onInit=function(){this.syncImageFrames();if(this.autoPlay&&this.frames&&this.frames.length){this.startAutoPlay();if(this.autoPlayDelay){this.nextUpdateTime+=this.autoPlayDelay}}return};UIFrameAnimation.prototype.paintSelf=function(t){if(this.playing&&this.isVisible()){var e=this.getDuration();var i=t.now+e;if(t.now>this.nextUpdateTime){this.nextFrame();this.nextUpdateTime=i}else{this.nextUpdateTime=Math.min(this.nextUpdateTime,i)}t.needRedraw++}return UIElement.prototype.paintSelf.call(this,t)};UIFrameAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIFrameAnimation.prototype.setFrameRate=function(t){this.frameRate=Math.max(1,Math.min(t,30));return this};UIFrameAnimation.prototype.getDuration=function(){if(this.isInDesignMode()&&this.disablePreview){return 16777215}if(this.timeScaleIsZero()){return 16777215}else{return 1e3/this.frameRate/this.getTimeScale()}};UIFrameAnimation.prototype.shapeCanBeChild=UISprite.prototype.shapeCanBeChild;UIFrameAnimation.prototype.drawImage=function(t){var e=this.getCurrentImage();if(e){var i=e.getImageRect();var n=e.getImage();if(n){this.drawImageAt(t,n,this.images.display,0,0,this.w,this.h,i)}}return};function UIFrameAnimationCreator(){var t=["ui-frame-animation","ui-frame-animation",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFrameAnimation;return e.initUIFrameAnimation(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIFrameAnimationCreator);function UIShaker(){return}UIShaker.prototype=new UIImage;UIShaker.prototype.isUIShaker=true;UIShaker.prototype.saveProps=["amplitudeX","amplitudeY","times","duration","amplitudeModifier"];UIShaker.prototype.initUIShaker=function(t,e,i){this.initUIImage(t,e,i);return this};UIShaker.prototype.setAmplitudeX=function(t){this.amplitudeX=t;return this};UIShaker.prototype.setAmplitudeY=function(t){this.amplitudeY=t;return this};UIShaker.prototype.setDuration=function(t){this.duration=t;return this};UIShaker.prototype.setTimes=function(t){this.times=t;return this};UIShaker.prototype.setAmplitudeModifier=function(t){this.amplitudeModifier=t;return this};UIShaker.prototype.getAmplitudeX=function(){return this.amplitudeX};UIShaker.prototype.getAmplitudeY=function(){return this.amplitudeY};UIShaker.prototype.getDuration=function(){return this.duration};UIShaker.prototype.getTimes=function(){return this.times};UIShaker.prototype.getAmplitudeModifier=function(){return this.amplitudeModifier};UIShaker.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}if(!t){this.enable=t;return this}var i=this;var n=this.amplitudeX?this.amplitudeX:0;var r=this.amplitudeY?this.amplitudeY:0;var a=this.times?this.times:1;var o=this.duration?this.duration:200;var s=Date.now();var l=e.paintSelf;var h=a*2*Math.PI;var u=this.amplitudeModifier;e.paintSelf=function(t){var a=Date.now()-s;if(a<o){var c=1;var p=a/o;var f=h*p;var m=n*Math.cos(f);var d=r*Math.sin(f);if(u==="i"){c=p}else if(u==="d"){c=1-p}else if(u==="i->d"){c=2*(p<.5?p:1-p)}m*=c;d*=c;t.translate(m,d)}else{e.paintSelf=l;i.enable=false}l.call(e,t)};return this};function UIShakerCreator(){var t=["ui-shaker","ui-shaker",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIShaker;return e.initUIShaker(this.type,80,80)};return}ShapeFactoryGet().addShapeCreator(new UIShakerCreator);function UISettings(){return}UISettings.prototype=new UIElement;UISettings.prototype.isUISettings=true;UISettings.prototype.initUISettings=function(t,e,i){this.initUIElement(t);this.setSize(e,i);this.settingsDef={};return this};UISettings.prototype.getSettingObj=function(t){var e=this.settingsDef[t];if(e&&e.isGlobal){return this.getWindowManager()}else{return this.getWindow()}};UISettings.prototype.getSetting=function(t){var e=this.getSettingObj(t);var i=e.settings[t];if(i===undefined){var n=this.settingsDef[t];if(n){i=n.defVal}}return i};UISettings.prototype.setSetting=function(t,e){var i=this.getSettingObj(t);i.settings[t]=e;return this};UISettings.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.settingsDef=t.settingsDef;return this};UISettings.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.settingsDef=this.settingsDef;return t};function UISettingsCreator(){var t=["ui-settings","ui-settings",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISettings;return e.initUISettings(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISettingsCreator);function UIAssets(){return}UIAssets.prototype=new UIElement;UIAssets.prototype.isUIAssets=true;UIAssets.prototype.initUIAssets=function(t,e,i){this.initUIElement(t);this.setSize(e,i);this.assets={};return this};UIAssets.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.assets=t.assets;return this};UIAssets.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.assets=JSON.parse(JSON.stringify(this.assets||{}));return t};UIAssets.prototype.getAssetInfo=function(t){var e=this.assets[t];if(!e){console.log("not found asset:"+t)}return e};UIAssets.prototype.getAssetURL=function(t){var e=this.getAssetInfo(t);return e?e.url:null};UIAssets.prototype.loadJSON=function(t,e){var i=this.getAssetInfo(t);if(!i){return false}if(i.type!=="json"){console.log("asset is not json:"+t);return false}return ResLoader.loadJson(i.url,e,e)};UIAssets.prototype.loadImage=function(t,e){var i=this.getAssetInfo(t);if(!i){return false}if(i.type!=="image"){console.log("asset is not image:"+t);return false}return ResLoader.loadImage(i.url,e,e)};UIAssets.prototype.loadData=function(t,e){var i=this.getAssetInfo(t);if(!i){return false}if(i.type!=="data"){console.log("asset is not data:"+t);return false}return ResLoader.loadData(i.url,e,e)};UIAssets.prototype.loadAll=function(t){var e=0;var i=0;function n(){i++;if(t){t(100*(i/e),i,e)}}var r=this.assets;for(var a in r){e++}for(var a in r){var o=r[a];if(o.type==="json"){ResLoader.loadJson(o.url,n)}else if(o.type==="data"){ResLoader.loadData(o.url,n)}else if(o.type==="image"){ResLoader.loadImage(o.url,n)}}return this};function UIAssetsCreator(){var t=["ui-assets","ui-assets",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIAssets;return e.initUIAssets(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIAssetsCreator);function UITile(){return}UITile.prototype=new UIElement;UITile.prototype.isUITile=true;UITile.prototype.saveProps=["dataURL"];UITile.prototype.initUITile=function(t,e,i){this.initUIElement(t);this.setSize(e,i);return this};UITile.Layer=function(){};UITile.Layer.prototype.init=function(t,e){this.tile=t;this.info=e;return this};UITile.Layer.prototype.drawOrthogonal=function(t,e){var i=this.info;var n=i.x||0;var r=i.y||0;var a=i.data;var o=i.height;var s=i.width;var l=this.tile;var h=l.tileWidth;var u=l.tileHeight;var c=h*s;var p=Math.max(Math.floor(e.y/u),0);var f=Math.max(Math.floor(e.x/h),0);var m=Math.min(Math.ceil((e.x+e.w)/h),s);var d=Math.min(Math.ceil((e.y+e.h)/u),o);var y=f*h+n;var v=p*u+r;var e={x:y,y:v,w:h,h:u};n=y;t.globalAlpha=i.opacity;for(var g=p;g<=d;g++){for(var _=f;_<=m;_++){var I=g*s+_;var x=a[I];if(x){e.x=y;e.y=v;l.drawTile(t,e,x)}y+=h}y=n;v+=u}return};UITile.Layer.prototype.drawIsometric=function(t,e){var i=e.y;var n=e.x;var r=n+e.w;var a=i+e.h;var o=0;var s=this.info;var l=s.x||0;var h=s.y||0;var u=s.data;var c=s.height;var p=s.width;var f=this.tile;var m=f.tileWidth;var d=f.tileHeight;t.globalAlpha=s.opacity;var y=h;var v=l+this.info.width*m/2-m/2;var e={x:l,y:h,w:m,h:d};for(var g=0;g<c;g++){for(var _=0;_<p;_++,o++){var I=u[o];l=(_-g)*d+v;h=(_+g)*m/4+y;if(!I||l>r||h>a||l+m<n||h+d<i){continue}e.x=l;e.y=h;f.drawTile(t,e,I)}}return};UITile.Layer.prototype.drawHexagonal=function(t,e){var i=e.y;var n=e.x;var r=n+e.w;var a=i+e.h;var o=0;var s=this.info;var l=s.x||0;var h=s.y||0;var u=s.data;var c=s.height;var p=s.width;var f=this.tile;var m=f.tileWidth;var d=f.tileHeight;t.globalAlpha=s.opacity;var y=h;var v=l;var e={x:l,y:h,w:m,h:d};for(var g=0;g<c;g++){h=g*d/2+y;for(var _=0;_<p;_++,o++){var I=u[o];if(!I){continue}l=_*m+v;if(g%2>0)l+=m/2;if(l>r||h>a||l+m<n||h+d<i){continue}e.x=l;e.y=h;f.drawTile(t,e,I)}}return};UITile.Layer.prototype.draw=function(t,e){var i=this.info;if(!i.visible)return;switch(this.tile.orientation){case"orthogonal":{this.drawOrthogonal(t,e);break}case"isometric":{this.drawIsometric(t,e);break}case"staggered":case"hexagonal":{this.drawHexagonal(t,e);break}default:{throw new Error("unknow orientation: ",this.tile.orientation)}}return};UITile.Layer.prototype.getTileByPoint=function(t,e){var i=this.tile;var n=i.tileWidth;var r=i.tileHeight;var a=Math.floor(e/r);var o=Math.floor(t/n);var s=a*this.info.width+o;var l=this.info.data[s];return{row:a,col:o,index:s,imageIndex:l}};UITile.TileSet=function(){};UITile.TileSet.prototype.init=function(t,e,i){this.tile=t;this.info=i;this.imageURL=e+"/"+i.image.basename();this.image=WImage.create(this.imageURL);this.tileWidth=i.tilewidth+i.spacing;this.tileHeight=i.tileheight+i.spacing;this.cols=Math.floor((i.imagewidth-2*i.margin)/this.tileWidth);this.rows=Math.floor((i.imageheight-2*i.margin)/this.tileHeight);this.tileNr=this.cols*this.rows;this.startIndex=i.firstgid;return this};UITile.TileSet.prototype.testImageIndex=function(t){
return t>=this.startIndex&&t<this.startIndex+this.tileNr};UITile.TileSet.prototype.drawTile=function(t,e,i,n){var r=this.image.getImage();var a=n-this.startIndex;if(a<0||a>=this.tileNr||!r||!r.width){return}var o=this.info;var s=a%this.cols;var l=Math.floor(a/this.cols);var h=s*this.tileWidth+o.margin;var u=l*this.tileHeight+o.margin;var c=o.tilewidth;var p=o.tileheight;if(this.tileHeight!==this.tile.tileHeight){i=i-(this.tileHeight-this.tile.tileHeight)}t.drawImage(r,h,u,c,p,e,i,c,p);return};UITile.prototype.loadTileSets=function(t,e){this.tilesets=[];var i=e.length;var n=t.dirname();this.images={};for(var r=0;r<i;r++){var a=new UITile.TileSet;a.init(this,n,e[r]);this.setImage("option_image_"+r,a.imageURL);this.tilesets.push(a)}return this};UITile.prototype.loadLayers=function(t){this.layers=[];var e=t.length;for(var i=0;i<e;i++){this.layers.push((new UITile.Layer).init(this,t[i]))}return this};UITile.prototype.getMapWidth=function(){return this.mapWidth};UITile.prototype.getMapHeight=function(){return this.mapHeight};UITile.prototype.getLayerNr=function(){return this.layers?this.layers.length:0};UITile.prototype.getLayerByIndex=function(t){if(this.layers&&t<this.layers.length){return this.layers[t]}return null};UITile.prototype.loadJSON=function(t,e){if(this.isIcon)return;if(!e||!e.width||!e.height){console.log("invalid tiled json");return}this.tileRows=e.height;this.tileCols=e.width;this.tileWidth=e.tilewidth;this.tileHeight=e.tileheight;this.orientation=e.orientation;this.renderorder=e.renderorder;this.properties=e.properties;this.mapWidth=this.tileWidth*this.tileCols;this.mapHeight=this.tileHeight*this.tileRows;this.loadTileSets(t,e.tilesets);this.loadLayers(e.layers);if(this.enable){var i=this.getWindow();if(i&&i.isUIScene){i.setMap(this)}}return};UITile.prototype.loadURL=function(t){var e=this;ResLoader.loadJson(t,function(i){e.loadJSON(t,i)});return};UITile.prototype.load=function(){var t=this.dataURL||this.tiledJsonURL;if(t){this.dataURL=t;this.loadURL(t)}return};UITile.prototype.setClipRegion=function(t){this.clipRegion=t;return this};UITile.prototype.isInClipRegion=function(t){if(!this.clipRegion)return true;var e=this.clipRegion;var i=e.length;for(var n=0;n<i;n++){var r=e[n];if(Rect.hasIntersection(r,t)){return true}}return false};UITile.prototype.drawTile=function(t,e,i){if(!this.isInClipRegion(e)){return}var n=this.tilesets.length;for(var r=0;r<n;r++){var a=this.tilesets[r];if(a.testImageIndex(i)){a.drawTile(t,e.x,e.y,i);break}}return};UITile.prototype.draw=function(t,e){if(!this.layers){return}var i=this.layers;var n=i.length;for(var r=0;r<n;r++){i[r].draw(t,e)}return};UITile.prototype.onAppendedInParent=function(){this.load()};UITile.prototype.createBody=function(t,e,i,n,r,a,o){var s=r>>1;var l=a>>1;var h=i+s;var u=n+l;var c=new b2FixtureDef;c.density=o.density;c.friction=o.friction;c.restitution=o.restitution;if(o.groupIndex){c.filter.groupIndex=o.groupIndex}if(o.isSensor){c.isSensor=true}c.shape=new b2PolygonShape;c.shape.SetAsBox(Physics.toMeter(s),Physics.toMeter(l));var p=new b2BodyDef;p.type=o.density?b2Body.b2_dynamicBody:b2Body.b2_staticBody;p.position.Set(Physics.toMeter(h),Physics.toMeter(u));p.allowSleep=true;body=t.CreateBody(p);body.CreateFixture(c);body.name=e;return};UITile.prototype.createLayerBodies=function(t,e,i){var n=i.data;var r=n.length;var a=i.properties||{};var o=i.height;var s=i.width;var l=this.tileWidth;var h=this.tileHeight;var u=i.x?i.x:0;var c=i.y?i.y:0;a.density=0;a.restitution=a.restitution?parseFloat(a.restitution):.5;a.friction=a.friction?parseFloat(a.friction):.5;for(var p=0;p<r;p++){var f=n[p];if(!f)continue;var m=Math.floor(p/s);var d=p%s;var y=u+d*l;var v=c+m*h;this.createBody(t,e+"-"+p,y,v,l,h,a)}return};UITile.prototype.createBodies=function(t){var e=this.layers;var i=e.length;for(var n=0;n<i;n++){var r=e[n];var a=r.info.properties;if(a&&a.physics){this.createLayerBodies(t,n,r.info)}}return};UITile.prototype.onFromJsonDone=function(t){this.load()};UITile.prototype.setTiledJsonURL=function(t){this.dataURL=t;this.load()};UITile.prototype.getTiledJsonURL=function(){return this.dataURL||this.tiledJsonURL};UITile.prototype.setEnable=function(t){var e=this.getParent();if(!e||this.enable==t){return this}var i=this.getWindow();if(i&&i.isUIScene){if(t){i.setMap(this)}else{if(i.getMap()===this){i.setMap(null)}}}this.enable=t;return};function UITileCreator(){var t=["ui-tile","ui-tile",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITile;return e.initUITile(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UITileCreator);function UIGSensor(){return}UIGSensor.prototype=new UIElement;UIGSensor.prototype.isUIGSensor=true;UIGSensor.prototype.initUIGSensor=function(t,e,i){this.initUIElement(t);this.setSize(e,i);this.addEventNames(["onDeviceOrientation"]);return this};UIGSensor.prototype.onInit=function(){if(this.enable){this.setEnable(true)}};UIGSensor.prototype.setEnable=function(t){var e=this;if(this.isInDesignMode())return this;function i(t){var i=t.accelerationIncludingGravity;if(!i){console.log("accelerationIncludingGravity not available.");return}var n=i.x||0;var r=i.y||0;var a=i.z||-9.8;if(isAndroid()){n=-n}else if(isIPhone()){r=-r}e.callOnDeviceOrientation(n,r,a,t);return}this.enable=t;if(t){window.removeEventListener("devicemotion",i,false);window.addEventListener("devicemotion",i,false)}else{window.removeEventListener("devicemotion",i,false)}return this};function UIGSensorCreator(){var t=["ui-gsensor","ui-gsensor",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIGSensor;return e.initUIGSensor(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIGSensorCreator);function UIMarquee(){return}UIMarquee.prototype=new UILabel;UIMarquee.isUIMarquee=true;UIMarquee.prototype.saveProps=["direction","behavior","scrollamount","scrolldelay","loop","autoPlay"];UIMarquee.DIR_UP="up";UIMarquee.DIR_DOWN="down";UIMarquee.DIR_LEFT="left";UIMarquee.DIR_RIGHT="right";UIMarquee.BEHAVIOR_SCROLL="scroll";UIMarquee.BEHAVIOR_SLIDE="slide";UIMarquee.BEHAVIOR_ALTERNATE="alternate";UIMarquee.LOOP_INFINITE="infinite";UIMarquee.DEFAULT_SCROLL_AMOUNT=1;UIMarquee.DEFAULT_SCROLL_DELAY=20;UIMarquee.prototype.initUIMarquee=function(t,e,i){this.initUIElement(t);this.setText(e);this.setDefSize(200,200);this.setMargin(5,5);this.running=false;this.scrollCounter=0;this.timeScale=1;this.autoPlay=false;this.setTextType(Shape.TEXT_TEXTAREA);this.setImage(UIElement.IMAGE_DEFAULT,i);this.addEventNames(["onChanged","onUpdateTransform","onPlayStepDone","onPlayDone"]);return this};var configLeftResolve={onScroll:function(t,e,i,n,r,a){if(this.done){t.rect(0,0,0,0);t.clip();return}e=e%(r+i);if(e<=i){t.rect(r-i,0,i,a);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=r){t.rect(0,0,i,a);t.clip();this.needStep=true}t.translate(r-e,0)},onSlide:function(t,e,i,n,r,a){if(this.done)return;e%=r;if(e<=i){t.rect(r-i,0,i,a);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(r-e,0)},onAlternate:function(t,e,i,n,r,a){if(this.done){t.translate(r-i,0);return}var o=parseInt(e/(r-i),10)%2>0;var s=parseInt(e%(r-i),10);s=o?r-i-s:s;if(o){this.needStep=true}else if(!o&&this.needStep){this.callOnStep()}t.translate(r-i-s,0)}};var configUpResolve={onScroll:function(t,e,i,n,r,a){if(this.done){t.rect(0,0,0,0);t.clip();return}e=e%(a+n);if(e<=n){t.rect(0,a-n,r,n);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=a){t.rect(0,0,r,a);t.clip();this.needStep=true}t.translate(0,a-e)},onSlide:function(t,e,i,n,r,a){if(this.done){return}e%=a;if(e<=n){t.rect(0,a-n,r,n);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(0,a-e)},onAlternate:function(t,e,i,n,r,a){if(this.done){t.translate(0,a-n);return}var o=parseInt(e/(a-n),10)%2>0;var s=parseInt(e%(a-n),10);s=o?a-n-s:s;if(o){this.needStep=true}else if(!o&&this.needStep){this.callOnStep()}t.translate(0,a-n-s)}};var configRightResolve={onScroll:function(t,e,i,n,r,a){if(this.done){t.rect(0,0,0,0);t.clip();return}e%=r+i;if(e>=r){this.needStep=true;t.rect(r-i,0,i,a);t.clip()}else if(e<=i){t.rect(0,0,i,a);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}t.translate(e-i,0)},onSlide:function(t,e,i,n,r,a){if(this.done){t.translate(r-i,0);return}e%=r;if(e<=i){t.rect(0,0,i,a);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(e-i,0)},onAlternate:function(t,e,i,n,r,a){if(this.done){return}var o=parseInt(e/(r-i),10)%2>0;var s=parseInt(e%(r-i),10);s=o?r-i-s:s;if(o){this.needStep=true}if(!o&&this.needStep){this.callOnStep()}t.translate(s,0)}};var configDownResolve={onScroll:function(t,e,i,n,r,a){if(this.done){t.rect(0,0,0,0);t.clip();return}e%=a+n;if(e<=n){t.rect(0,0,r,n+e);t.clip();if(this.needStep){this.callOnStep()}if(this.done){this.backText=this.text;this.text=""}}else if(e>=a){t.rect(0,a-n,r,n);t.clip();this.needStep=true}t.translate(0,e-n)},onSlide:function(t,e,i,n,r,a){if(this.done){t.translate(0,a-n);return}e%=a;if(e<=n){t.rect(0,0,r,n);t.clip();if(this.needStep){this.callOnStep()}}else{this.needStep=true}t.translate(0,e-n)},onAlternate:function(t,e,i,n,r,a){if(this.done){return}var o=parseInt(e/(a-n),10)%2>0;var s=parseInt(e%(a-n),10);s=o?a-n-s:s;if(o){this.needStep=true}else if(this.needStep&&!o){this.callOnStep()}t.translate(0,s)}};UIMarquee.makeResolve=function(t,e,i){return function(n){var r=this.getWidth(true),a=this.getHeight(true),o=n.timeStep;var s=parseInt(this.scrollCounter*this.scrollamount/this.scrolldelay,10);n.font=this.style.getFont();var l=this.getLocaleText(this.text);var h=n.measureText(l).width;var u=parseInt(n.font);this.hTextAlign=t;this.vTextAlign=e;var c=[n,s,h,u,r,a];switch(this.behavior){case UIMarquee.BEHAVIOR_SCROLL:{i.onScroll.apply(this,c);break}case UIMarquee.BEHAVIOR_SLIDE:{i.onSlide.apply(this,c);break}case UIMarquee.BEHAVIOR_ALTERNATE:{i.onAlternate.apply(this,c);break}default:{throw new Error("unknow behavior")}}}};UIMarquee.prototype.leftResolve=UIMarquee.makeResolve("left","middle",configLeftResolve);UIMarquee.prototype.rightResolve=UIMarquee.makeResolve("left","middle",configRightResolve);UIMarquee.prototype.upResolve=UIMarquee.makeResolve("center","up",configUpResolve);UIMarquee.prototype.downResolve=UIMarquee.makeResolve("center","up",configDownResolve);UIMarquee.prototype.update=function(t){var e=t.timeStep;if(e<this.scrolldelay)e=this.scrolldelay;this.scrollCounter+=this.timeScale*e;switch(this.direction){case UIMarquee.DIR_RIGHT:{this.rightResolve(t);break}case UIMarquee.DIR_LEFT:{this.leftResolve(t);break}case UIMarquee.DIR_UP:{this.upResolve(t);break}case UIMarquee.DIR_DOWN:{this.downResolve(t);break}default:{throw new Error("unknow UIMarquee.direction:"+this.direction)}}};UIMarquee.prototype.onInit=function(){if(this.autoPlay){this.play()}return};UIMarquee.prototype.drawText=function(t){this.layoutText(t);if((this.running||this.done)&&!this.isInDesignMode()){this.update(t);this.defaultDrawText(t)}if(this.isInDesignMode()){this.defaultDrawText(t)}return};UIMarquee.prototype.initOpts=function(t,e,i){if(typeof t==="function"){i=e;e=t;t={}}this.onStep=i||t.onStep;this.onDone=e||t.onDone;this.direction=t.direction||this.direction||UIMarquee.DIR_RIGHT;this.behavior=t.behavior||this.behavior||UIMarquee.BEHAVIOR_SCROLL;this.loop=t.loop>0?t.loop:this.loop?this.loop:UIMarquee.LOOP_INFINITE;this.backloop=this.loop;this.scrolldelay=t.scrolldelay||this.scrolldelay||UIMarquee.DEFAULT_SCROLL_DELAY;this.scrollamount=t.scrollamount||this.scrollamount||UIMarquee.DEFAULT_SCROLL_AMOUNT;return this};UIMarquee.prototype.play=function(t,e,i){t=t||{};this.initOpts(t,e,i);this.reset();this.started=true;this.running=true;this.done=false;this.text=this.backText?this.backText:this.text;return this};UIMarquee.prototype.reset=function(){this.timeScale=1;this.scrollCounter=0;this.needStep=false;this.loop=this.backloop};UIMarquee.prototype.restart=function(){if(!this.started)return;this.running=true;this.done=false;this.text=this.backText?this.backText:this.text;this.reset();return this};UIMarquee.prototype.stop=function(){this.reset();this.running=false;return this};UIMarquee.prototype.pause=function(){if(!this.running)return;this.timeScale=0;return this};UIMarquee.prototype.resume=function(){if(!this.running)return;this.timeScale=1;return this};UIMarquee.prototype.callOnStep=function(){this.needStep=false;if(this.loop!==UIMarquee.LOOP_INFINITE){--this.loop;if(this.loop===0){this.callOnDone();return}}if(typeof this.onStep==="function"){if(!this.onStep()){this.callOnDone();return}}return this};UIMarquee.prototype.callOnDone=function(){if(typeof this.onDone==="function"){this.onDone()}this.done=true;this.stop();return this};function UIMarqueeCreator(){var t=["ui-marquee","ui-marquee",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMarquee;return e.initUIMarquee(this.type,dappGetText("Text"),null)}}ShapeFactoryGet().addShapeCreator(new UIMarqueeCreator);UIElement.prototype.getScence=function(){return this.getWindow()};UIElement.prototype.getFootprints=function(t){var e=0;var i=0;var n=[];var r=this.isUIWindow?this:this.getParent().children;for(var a=0;a<r.length;a++){var o=r[a];if(!o.isUIFootprint){continue}if(t&&t!=o.name){continue}e=o.left+(o.w>>1);i=o.top+(o.h>>1);n.push({x:e,y:i})}return n};UIElement.prototype.moveAlongPath=function(t,e,i,n){var r=this.getFootprints(t);return this.moveAlongPoints(r,e,i,n)};UIElement.prototype.moveAlongPoints=function(t,e,i,n){var r=0;var a=0;var o=0;var s={};var l=[];var h=0;if(!t.length){console.log("no footprint found.")}for(var u=0;u<t.length;u++){var c=t[u];if(u){a=t[u].x-t[u-1].x;o=t[u].y-t[u-1].y;r=Math.sqrt(a*a+o*o);l.push(r);h+=r}}s.onDone=n;s.duration=e;s.distances=l;s.points=t;s.totalDistance=h;s.enableRotation=i;this.startMove(s);return};UIElement.prototype.startMove=function(t){var e=0;var i=0;var n=0;var r=this;var a=this.w>>1;var o=this.h>>1;var s=t.duration;var l=t.distances;var h=t.points;var u=t.totalDistance;var c=t.enableRotation;function p(){if(n+1>=h.length){if(t.onDone){t.onDone()}return}var f=Date.now();var m=h[n+1];var d=h[n];var y=s*(l[n]/u);var v=m.x-d.x;var g=m.y-d.y;var _=Math.asin(Math.abs(g)/Math.sqrt(v*v+g*g));if(g<=0&&v<0){_=Math.PI-_}if(g>0&&v<0){_=Math.PI+_}if(g>0&&v>=0){_=2*Math.PI-_}_=-_;function I(){var t=(Date.now()-f)/y;if(t<1){e=d.x+v*t-a;i=d.y+g*t-o;r.setPosition(e,i);if(c){r.setRotation(_)}r.postRedraw();return true}else{n++;e=m.x-a;i=m.y-o;r.setPosition(e,i);r.postRedraw();p();return false}}UIElement.setAnimTimer(I)}p();return};UIElement.prototype.setPositionWithSticky=function(t,e){this.setPosition(t,e);if(this.sticky){this.orgX=this.x;this.orgY=this.y}return this};UIElement.prototype.setAngle=UIElement.prototype.setRotation;UIElement.prototype.setPositionByBody=function(t,e){if(this.anchor){this._x=t+this.w*this.anchor.x;this._y=e+this.h*this.anchor.y;this.setLeftTop(t,e)}else{this._x=t;this._y=e;this.setLeftTop(this._x,this._y)}this.callOnMovedHandler();return this};UIElement.prototype.setSoundMusicVolume=function(t){this.getWindowManager().setSoundMusicVolume(t);return this};UIElement.prototype.setSoundEffectVolume=function(t){this.getWindowManager().setSoundEffectVolume(t);return this};UIElement.prototype.playSoundEffect=function(t,e){this.getWindowManager().playSoundEffect(t,e);return this};UIElement.prototype.playSoundMusic=function(t,e){this.getWindowManager().playSoundMusic(t,e);return this};UIElement.prototype.stopSoundMusic=function(t){this.getWindowManager().stopSoundMusic(t);return this};UIElement.prototype.stopSoundEffect=function(t){this.getWindowManager().stopSoundEffect(t);return this};UIElement.prototype.setSoundEnable=function(t){var e=this.getWindowManager();e.setSoundEnable(t);return this};UIElement.prototype.isSoundEnable=UIElement.prototype.getSoundEnable=function(){var t=this.getWindowManager();return t.getSoundEnable()};UIElement.prototype.setSoundEffectEnable=function(t){var e=this.getWindowManager();e.setSoundEffectsEnable(t);return this};UIElement.prototype.isSoundEffectEnable=UIElement.prototype.getSoundEffectEnable=function(){var t=this.getWindowManager();return t.soundEffectsEnalbe};UIElement.prototype.setSoundMusicEnable=function(t){var e=this.getWindowManager();e.setSoundMusicsEnable(t);return this};UIElement.prototype.isSoundMusicEnable=UIElement.prototype.getSoundMusicEnable=function(){var t=this.getWindowManager();return t.soundMusicsEnalbe};UIElement.prototype.setVOf=function(t,e,i){var n=this.getWindow().findChildByName(t,true);if(n){n.setV(e,i)}else{console.log("not found "+t)}return this};UIElement.prototype.setV=function(t,e){var i=this.body;if(i){this.setVisible(true);if(!i.IsActive()){i.SetActive(true)}if(!i.IsAwake()){i.SetAwake(true)}var n=i.GetLinearVelocity();if(t!==null&&t!==undefined){n.x=t}if(e!==null&&e!==undefined){n.y=e}i.SetLinearVelocity(n)}return this};UIElement.prototype.onRemoved=function(t){if(!t){return}var e=t.getWindow();if(!e){return}var i=e.world;if(this.body){Physics.destroyBodyForElement(i,this);this.body=null}if(this.joint){Physics.destroyJointForElement(i,this);this.joint=null}return this};function UIWeixin(){return}UIWeixin.prototype=new UIElement;UIWeixin.prototype.isUIWeixin=true;UIWeixin.prototype.saveProps=["configURL","shareTitle","shareDesc","shareLink","shareImage","apiList","debug"];UIWeixin.prototype.initUIWeixin=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);this.setCanRectSelectable(false,true);return this};UIWeixin.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"];UIWeixin.prototype.getConfig=function(t,e,i){if(UIWeixin.config){return}else{UIWeixin.config={}}httpGetJSON(t,function n(t){UIWeixin.config=t;if(UIWeixin.config){UIWeixin.config.jsApiList=e;UIWeixin.config.debug=i;console.log("Fetch UIWeixin.config success:")}else{console.log("Fetch weixin config failed.");return}function n(){try{wx.config(UIWeixin.config);UIWeixin.configDone=true;console.log(JSON.stringify(UIWeixin.config,null,"	"));console.log("Call wx.config done:")}catch(t){console.log("wx script is not load yet, try to config lator:");setTimeout(n,100)}}if(isWeiXin()){console.log("Is WeiXin, try to config it.");n()}else{console.log("It is not weixin browser")}})};UIWeixin.prototype.onFromJsonDone=function(){var t=window.btoa(location.href);var e=null;if(location.href.indexOf("i5r.com.cn")>=0){e=this.configURL?this.configURL:"/weixin/php/json_config.php"}else{e=this.configURL?this.configURL:"/wechat/config"}if(e.indexOf("?")>0){e=e+"&url="+t}else{e=e+"?url="+t}var i=UIWeixin.jsApiList;if(this.apiList){i=this.apiList.split("\n")}this.getConfig(e,i,this.debug);return};UIWeixin.prototype.onInit=function(){var t=this;if(!window.wx){console.log("UIWeixin.prototype.onInit wx not defined.");return}wx.ready(function(){UIWeixin.ready=true;t.updateShareInfo();console.log("wx.ready")});wx.error(function(t){});console.log("UIWeixin.prototype.onInit end");return};UIWeixin.prototype.onDeinit=function(){return};UIWeixin.prototype.shapeCanBeChild=function(t){return false};UIWeixin.prototype.setShareTitle=function(t){this.shareTitle=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareDesc=function(t){this.shareDesc=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareLink=function(t){this.shareLink=t;this.updateShareInfo();return this};UIWeixin.prototype.setShareImage=function(t){this.shareImage=t;this.updateShareInfo();return this};UIWeixin.prototype.updateShareInfo=function(){if(!window.wx){return}var t=this.view;var e=this.shareTitle?this.shareTitle:t.getAppName();var i=this.shareDesc?this.shareDesc:t.getAppDesc();var n=this.shareLink?this.shareLink:location.href;var r=ResLoader.toAbsURL(this.shareImage?this.shareImage:t.getAppIcon());var a={title:e,desc:i,link:n,imgUrl:r,trigger:function(t){console.log("weixin operation trigger:"+JSON.stringify(t))},success:function(t){console.log("weixin operation success:"+JSON.stringify(t))},cancel:function(t){console.log("weixin operation cancel:"+JSON.stringify(t))},fail:function(t){console.log("weixin operation fail:"+JSON.stringify(t))}};wx.onMenuShareAppMessage(a);wx.onMenuShareTimeline(a);wx.onMenuShareQQ(a);wx.onMenuShareWeibo(a);return};function UIWeixinCreator(){var t=["ui-weixin","ui-weixin",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIWeixin;return e.initUIWeixin(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIWeixinCreator);function HolaSDK(){}HolaSDK.exec=function(t,e){if(window.HolaF){window.HolaF(t,e);console.log("HolaSDK.exec:"+t+":"+(e?JSON.stringify(e):"{}"))}else{console.log("HolaSDK.exec(e):"+t+":"+(e?JSON.stringify(e):"{}"))}};HolaSDK.init=function(t,e){if(HolaSDK.initialized){return}var i={};i.app_id=t;i.debug=e;HolaSDK.appID=t;HolaSDK.initialized=true;HolaSDK.startTime=Date.now();HolaSDK.exec("GameJsAdSdk.init",i);console.log("HolaSDK.init done")};HolaSDK.showAd=function(t,e,i,n){var r={};r.placement_id=HolaSDK.appID+"_"+t;r.placement_type=e;r.impression_time=i;r.closable=n;HolaSDK.exec("GameJsAdSdk.showAd",r)};HolaSDK.closeAd=function(){if(!HolaSDK.initialized)return;HolaSDK.exec("GameJsAdSdk.closeAd")};HolaSDK.share=function(t,e,i,n){var r={};r.title=t;r.description=e;HolaSDK.exec("share",r)};HolaSDK.fixTime=function(t){if(t>1e3){t=t/1e3}return t};HolaSDK.sendBarrage=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Barrage.send",n)};HolaSDK.ping=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Barrage.ping",n)};HolaSDK.onPaused=function(){if(HolaSDK.onPausedCallback){HolaSDK.onPausedCallback()}};HolaSDK.whenPaused=function(t){HolaSDK.onPausedCallback=t;HolaSDK.exec("Game.Event.onPause",HolaSDK.onPaused)};HolaSDK.onResumed=function(){if(HolaSDK.onResumedCallback){HolaSDK.onResumedCallback()}};HolaSDK.whenResumed=function(t){HolaSDK.onResumedCallback=t;HolaSDK.exec("Game.Event.onResume",HolaSDK.onResumed)};HolaSDK.onRestarted=function(){if(HolaSDK.onRestartedCallback){HolaSDK.onRestartedCallback()}};HolaSDK.whenRestarted=function(t){HolaSDK.onRestartedCallback=t;HolaSDK.exec("Game.Event.onRestart",HolaSDK.onRestarted)};HolaSDK.gameStarted=function(t){var e={};e.level=t;HolaSDK.exec("Game.Status.start",e)};HolaSDK.gamePaused=function(){HolaSDK.exec("Game.Status.pause")};HolaSDK.gameResumed=function(){HolaSDK.exec("Game.Status.resume")};HolaSDK.gameOver=function(t,e,i){var n={};n.score=t;n.level=e;n.duration=HolaSDK.fixTime(i);HolaSDK.exec("Game.Status.over",n)};HolaSDK.gameRestarted=function(){console.log("HolaSDK.gameRestarted is not supported now!!!")};HolaSDK.gameExited=function(){HolaSDK.exec("Game.Status.exit")};HolaSDK.exit=function(){HolaSDK.exec("Game.exit")};HolaSDK.getSDKURL=function(){return"http://game-ad-sdk.haloapps.com/static/abyhola/sdk/js_ad_sdk_loader.js?v=034"};window.HolaSDK=HolaSDK;if(!window.CanTK){window.CanTK={}}CanTK.isOldIE=isOldIE;CanTK.isTizen=isTizen;CanTK.isMobile=isMobile;CanTK.isAndroid=isAndroid;CanTK.isFirefoxOS=isFirefoxOS;CanTK.initViewPort=cantkInitViewPort;CanTK.restoreViewPort=cantkRestoreViewPort;CanTK.httpGetURL=httpGetURL;CanTK.httpGetJSON=httpGetJSON;CanTK.httpDoRequest=httpDoRequest;CanTK.LinearInterpolator=LinearInterpolator;CanTK.BounceInterpolator=BounceInterpolator;CanTK.AccelerateInterpolator=AccelerateInterpolator;CanTK.AccDecelerateInterpolator=AccDecelerateInterpolator;CanTK.DecelerateInterpolator=DecelerateInterpolator;CanTK.detectDeviceConfig=cantkDetectDeviceConfig;CanTK.regShapeCreator=cantkRegShapeCreator;CanTK.ShapeCreator=ShapeCreator;window.isOldIE=isOldIE;window.isTizen=isTizen;window.isMobile=isMobile;window.isAndroid=isAndroid;window.isFirefoxOS=isFirefoxOS;window.httpGetURL=httpGetURL;window.httpGetJSON=httpGetJSON;window.httpDoRequest=httpDoRequest;window.cantkInitViewPort=cantkInitViewPort;window.cantkRestoreViewPort=cantkRestoreViewPort;window.cantkGetViewPort=cantkGetViewPort;window.Shape=Shape;window.UIElement=UIElement;window.UIWindowManager=UIWindowManager;window.ShapeFactory=ShapeFactory;CanTK.UIImage=UIImage;CanTK.Shape=Shape;CanTK.UIElement=UIElement;CanTK.init=function(){};CanTK.createElement=function(t){return ShapeFactoryGet().createShape(t,C_CREATE_FOR_PROGRAM)};CanTK.createElementWithJson=function(t){var e=t.type;var i=ShapeFactoryGet().createShape(e,C_CREATE_FOR_PROGRAM);if(i){i.fromJson(t);i.setMode(Shape.MODE_RUNNING,true)}return i};CanTK.UIElement.RUNNING=Shape.MODE_RUNNING;CanTK.UIElement.DEFAULT_IMAGE=UIElement.IMAGE_DEFAULT;CanTK.setResRoot=function(t){return ResLoader.setResRoot(t)};function UIBody(){return}UIBody.prototype=new UIElement;UIBody.prototype.isUIBody=true;UIBody.prototype.isUIPhysicsShape=true;UIBody.prototype.saveProps=["density","friction","restitution","isSensor","allowSleep","isBullet","autoDestroyWhenOutside","fixedRotation","groupIndex","noStroke","cameraFollowMe","xInitVelocity","yInitVelocity","linearDamping","angularDamping"];UIBody.prototype.initUIBody=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setCanRectSelectable(false,false);this.density=0;this.friction=0;this.restitution=0;this.allowSleep=true;this.addEventNames(["onBeginContact","onEndContact","onMoved","onPreSolve","onPostSolve"]);return this};UIBody.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UIBody.prototype.setGravityScale=function(t){this.gravity={};this.gravityScale=t;if(this.body){this.body.modifyGravity=this.modifyGravity.bind(this)}return this};UIBody.prototype.modifyGravity=function(t){var e=this.gravity;var i=this.gravityScale;e.x=t.x*i.x;e.y=t.y*i.y;return e};UIBody.prototype.onBodyCreated=function(){if(this.gravity&&this.gravityScale){this.body.modifyGravity=this.modifyGravity.bind(this)}};UIBody.prototype.setSensor=function(t){this.isSensor=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.SetSensor(t)}}return this};UIBody.prototype.getDensity=function(){if(this.body){return this.body.GetFixtureList().GetDensity()}else{return this.density}};UIBody.prototype.setRestitution=function(t){this.restitution=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.SetRestitution(t)}}return this};UIBody.prototype.getRestitution=function(){if(this.body){return this.body.GetFixtureList().GetRestitution()}else{return this.restitution}};UIBody.prototype.setFriction=function(t){this.friction=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.SetFriction(t)}}return this};UIBody.prototype.getFriction=function(){if(this.body){return this.body.GetFixtureList().GetFriction()}else{return this.friction}};UIBody.prototype.setDensity=function(t){this.density=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.SetDensity(t)}if(t>0){this.body.SetType(b2Body.b2_dynamicBody)}else if(t===0){this.body.SetType(b2Body.b2_staticBody)}else{this.body.SetType(b2Body.b2_kinematicBody)}this.body.ResetMassData()}return this};UIBody.prototype.setV=function(t,e){var i=this.body;if(i){this.setVisible(true);if(!i.IsActive()){i.SetActive(true)}if(!i.IsAwake()){i.SetAwake(true)}var n=i.GetLinearVelocity();if(t!==null&&t!==undefined){n.x=t}if(e!==null&&e!==undefined){n.y=e}i.SetLinearVelocity(n)}else{this.xInitVelocity=t;this.yInitVelocity=e}return this};UIBody.prototype.getV=function(){return this.body?this.body.GetLinearVelocity():{x:0,y:0}};UIBody.prototype.addV=function(t,e){var i=this.getV();if(t!==null&&t!==undefined){i.x+=t}if(e!==null&&e!==undefined){i.y+=e}return this.setV(i.x,i.y)};UIBody.prototype.getMass=function(){return this.body?this.body.GetMass():0};UIBody.prototype.applyTorque=function(t){if(this.body){this.body.ApplyTorque(t)}return this};UIBody.prototype.applyForce=function(t,e,i,n){if(this.body){var r={};var a={};i=i===undefined||i===null?this.left+(this.w>>1):i;n=n===undefined||n===null?this.top+(this.h>>1):n;r.x=t;r.y=e;a.x=Physics.toMeter(i);a.y=Physics.toMeter(n);this.body.ApplyForce(r,a)}return this};UIBody.prototype.setEnable=function(t){this.enable=t;if(this.body){this.body.SetActive(t)}return this};UIBody.prototype.setGroupIndex=function(t){this.groupIndex=t;if(this.body){for(var e=this.body.GetFixtureList();e;e=e.m_next){e.m_filter.groupIndex=t}}return this};UIBody.prototype.getGroupIndex=function(){return this.groupIndex};UIBody.prototype.getBody=function(){return this.body};UIBody.prototype.setRotation=function(t){this.rotation=t;if(this.body){this.body.SetAngle(t)}return this};UIBody.prototype.boom=function(t,e,i){var n=this.getPosition();n=new b2Vec2(Physics.toMeter(n.x),Physics.toMeter(n.y));var r=this.getWindow();var a=r.world;t=Physics.toMeter(t);for(var o=0;o<=100;o++){var s=360/100*o;var l=new b2RayCastInput;l.p1=n;l.p2.Set(n.x+t*Math.cos(s),n.y+t*Math.sin(s));l.maxFraction=1;var h=new b2RayCastOutput;for(var u=a.GetBodyList();u;u=u.GetNext()){if(u.element==this){continue}var c=u.GetFixtureList();if(!c){continue}var p=c.RayCast(h,l);if(p){var f=l.p1.Copy();var m=l.p2.Copy();m.Subtract(f);m.Multiply(h.fraction);f.Add(m);var d=f.Copy();d.Subtract(n);u.ApplyForce(new b2Vec2(d.x*(1-h.fraction)*e,d.y*(1-h.fraction)*e),d)}}}i&&this.remove()};UIBody.prototype.needStroke=function(){return!this.noStroke&&!this.isStrokeColorTransparent()||this.isInDesignMode()};UIBody.prototype.setSize=function(t,e){RShape.prototype.setSize.call(this,t,e);var i=this.getWindow();this.updateLayoutParams();if(this.body&&i&&i.isUIScene){this.resizeBody()}return this};UIBody.prototype.onPositionChanged=function(){var t=this.left;var e=this.top;var i=this.body;var n=this.getWindow();if(i&&n&&n.isUIScene){var r={};var a=this.getParent().getPositionInWindow();t+=a.x;e+=a.y;r.x=n.toMeter(t+(this.w>>1));r.y=n.toMeter(e+(this.h>>1));if(i.m_world.IsLocked()){setTimeout(function(){i.SetPosition(r)},0)}else{i.SetPosition(r)}}return this};UIBody.prototype.checkIfOutside=function(){if(!this.autoDestroyWhenOutside){return}var t=this.w;var e=this.h;var i=this.win;var n=this.getAbsLeftTop();var r={x:i.x-t,y:i.y-e,w:i.w+t,h:i.h+e};n.w=t;n.h=e;n.x-=i.xOffset;n.y-=i.yOffset;var a=Rect.hasIntersection(n,r);if(!a){this.remove(true,false);console.log("checkIfOutside remove outside body:"+this.name)}};UIBody.prototype.onInit=function(){if(this.autoDestroyWhenOutside){this.on("moved",this.checkIfOutside.bind(this))}};UIBody.prototype.paintSelfOnly=function(t){var e=this.needStroke();var i=!this.isFillColorTransparent();if(!i&&!e){return}t.beginPath();this.drawShape(t);if(i){t.fillStyle=this.style.fillColor;t.fill()}if(e){if(this.noStroke){t.setLineDash([5,5])}t.lineWidth=this.style.lineWidth;t.strokeStyle=this.style.lineColor;t.stroke()}return};function UIPoint(){return}UIPoint.prototype=new UIElement;UIPoint.prototype.isUIPoint=true;UIPoint.prototype.initUIPoint=function(t,e,i,n){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,n);return this};UIPoint.prototype.paintSelfOnly=function(t){var e=!this.isFillColorTransparent();var i=!this.isStrokeColorTransparent();if(e||i){var n=this.w>>1;var r=this.h>>1;
t.beginPath();t.arc(n,r,10,0,2*Math.PI);if(e){t.fillStyle=this.style.fillColor;t.fill()}if(i){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;t.stroke()}if(this.showIndex){t.font="12px";t.textAlign="center";t.textBaseline="middle";t.fillStyle=this.style.textColor||"Black";t.fillText(this.getIndex(),n,r)}}return};UIPoint.prototype.setShowIndex=function(t){this.showIndex=t;return this};UIPoint.prototype.isUserResizable=function(){return false};UIPoint.prototype.shapeCanBeChild=function(t){return false};function UIPointCreator(){var t=["ui-point","ui-point",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPoint;return e.initUIPoint(this.type,20,20,null)};return}ShapeFactoryGet().addShapeCreator(new UIPointCreator);function UITwoPoints(){return}UITwoPoints.prototype=new UIElement;UITwoPoints.prototype.isUITwoPoints=true;UITwoPoints.prototype.initUITwoPoints=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_DEFAULT,null);this.setImage(UIElement.IMAGE_POINT1,null);this.setImage(UIElement.IMAGE_POINT2,null);this.points=[{x:0,y:0},{x:80,y:80}];this.savedPoints=[{x:0,y:0},{x:80,y:80}];return this};UITwoPoints.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.points=[{x:0,y:0},{x:80,y:80}];t.points[0].x=this.points[0].x;t.points[0].y=this.points[0].y;t.points[1].x=this.points[1].x;t.points[1].y=this.points[1].y;t.x0Param=this.x0Param;t.x1Param=this.x1Param;t.y0Param=this.y0Param;t.y1Param=this.y1Param;return t};UITwoPoints.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);this.points[0].x=t.points[0].x;this.points[0].y=t.points[0].y;this.points[1].x=t.points[1].x;this.points[1].y=t.points[1].y;this.x0Param=t.x0Param;this.x1Param=t.x1Param;this.y0Param=t.y0Param;this.y1Param=t.y1Param;return this};UITwoPoints.prototype.relayout=function(){if(this.disableRelayout||this.isInDesignMode()){return}var t=getParentShapeOfShape(this);var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.points[0].x=e*this.x0Param;this.points[1].x=e*this.x1Param}if(this.yAttr===UIElement.Y_SCALE){this.points[0].y=i*this.y0Param;this.points[1].y=i*this.y1Param}return};UITwoPoints.prototype.updateLayoutParams=function(){this.xParam=1;this.yParam=1;var t=this.parentShape;if(!t){return}var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.x0Param=this.points[0].x/e;this.x1Param=this.points[1].x/e}if(this.yAttr===UIElement.Y_SCALE){this.y0Param=this.points[0].y/i;this.y1Param=this.points[1].y/i}this.w=Math.abs(this.points[0].x-this.points[1].x);this.h=Math.abs(this.points[0].y-this.points[1].y);return};UITwoPoints.prototype.drawSelectMarks=function(t){};UITwoPoints.prototype.moveDelta=function(t,e){this.points[0].x+=t;this.points[0].y+=e;this.points[1].x+=t;this.points[1].y+=e;return this};UITwoPoints.prototype.setPositionByBody=function(t,e){if(this.isUIEdge){var i=t-this.left;var n=e-this.top;this.points[0].x+=i;this.points[0].y+=n;this.points[1].x+=i;this.points[1].y+=n}UIElement.prototype.setPositionByBody.call(this,t,e)};UITwoPoints.prototype.paintSelf=function(t){t.save();t.globalAlpha*=this.opacity;var e=this.points[0];var i=this.points[1];if(this.isIcon){this.translate(t);e={x:e.x+25,y:e.y+25};i={x:i.x-25,y:i.y-25}}var n=null;var r=null;var a=this.getImageByType(UIElement.IMAGE_DEFAULT);var o=this.getImageByType(UIElement.IMAGE_POINT1);var s=this.getImageByType(UIElement.IMAGE_POINT2);var l=this.anchorSize?this.anchorSize:5;t.lineWidth=this.style.lineWidth;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;if(a&&a.getImage()){n=a.getImage();r=a.getImageRect();UIElement.drawImageLine(t,n,this.images.display,e,i,r)}else{t.beginPath();t.moveTo(e.x,e.y);t.lineTo(i.x,i.y);t.stroke()}if(o&&o.getImage()){n=o.getImage();r=o.getImageRect();this.drawImageAt(t,n,WImage.DISPLAY_CENTER,e.x-l,e.y-l,l+l,l+l,r)}else{t.beginPath();t.arc(e.x,e.y,l,0,Math.PI*2);t.fill()}if(s&&s.getImage()){n=s.getImage();r=s.getImageRect();this.drawImageAt(t,n,WImage.DISPLAY_CENTER,i.x-l,i.y-l,l+l,l+l,r)}else{t.beginPath();t.arc(i.x,i.y,l,0,Math.PI*2);t.fill()}t.restore();this.drawSelectMarks(t);return};UITwoPoints.prototype.shapeCanBeChild=function(t){return false};UITwoPoints.prototype.getPoint=function(t){return this.points[t?1:0]};UITwoPoints.prototype.getCenterX=function(){return this.points[0].x+this.points[1].x>>1};UITwoPoints.prototype.getCenterY=function(){return this.points[0].y+this.points[1].y>>1};UITwoPoints.prototype.setPoint=function(t,e,i){var n=this.points[t?1:0];n.x=e;n.y=i;this.updateLayoutParams();return this};UITwoPoints.prototype.getDistance=function(){return Math.round(Math.distanceBetween(this.points[0],this.points[1]))};UITwoPoints.prototype.getAngle=function(){return Math.lineAngle(this.points[0],this.points[1])};function UIPolygon(){return}UIPolygon.prototype=new UIBody;UIPolygon.prototype.isUIPolygon=true;UIPolygon.prototype.initUIPolygon=function(t,e,i){this.initUIBody(t,e,i);return this};UIPolygon.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}if(t.isUIPoint){return true}return!t.isUIPhysicsShape};UIPolygon.prototype.getVerticesArray=function(){var t=0;var e=0;var i=-1;var n=this.w>>1;var r=this.h>>1;var a=this.children.filter(function(t){return t.isUIPoint});var o=a.map(function(t){return new b2Vec2(t.x+(t.w>>1),t.y+(t.h>>1))});var s=false;if(ClockWise(o)===CLOCKWISE){o.reverse()}if(Convex(o)===CONCAVE){s=true}var l=s?process(o):o;return{complex:s,vertices:l}};UIPolygon.prototype.drawShape=function(t){if(!this.verticesInfo||this.isInDesignMode()){this.verticesInfo=this.getVerticesArray()}var e=this.verticesInfo;var i=e.vertices;if(e.complex){var n=[];if(i!=null){for(r=0;r<i.length;r=r+3){t.beginPath();n.push([i[r],i[r+1]]);n.push([i[r],i[r+2]]);n.push([i[r+1],i[r+2]]);t.moveTo(i[r].x,i[r].y);t.lineTo(i[r+1].x,i[r+1].y);t.lineTo(i[r+2].x,i[r+2].y);t.closePath();t.globalAlpha=.4}}t.globalAlpha=1;t.strokeStyle="#ffffff";for(var r=0;r<n.length;r++){var a=n[r];t.moveTo(a[0].x,a[0].y);t.lineTo(a[1].x,a[1].y)}}else{t.beginPath();t.moveTo(i[0].x,i[0].y);for(var r=1;r<i.length;r++){t.lineTo(i[r].x,i[r].y)}t.closePath();t.globalAlpha=.4;t.globalAlpha=1;t.strokeStyle="#ffffff";t.stroke()}};UIPolygon.prototype.afterChildRemoved=function(t){if(t.isUIPoint){delete this.verticesInfo}return true};UIPolygon.prototype.afterChildAppended=function(t){if(t.isUIPoint){t.z=t.getIndex();t.setShowIndex(true).setSize(20,20);delete this.verticesInfo}return};UIPolygon.prototype.resizeBody=function(t,e){var i=[];var n=this.w>>1;var r=this.h>>1;var a=this.children.length;var o=this.body;for(var s=0;s<a;s++){var l=this.children[s];if(!l.isUIPoint){continue}var h=l.w>>1;var u=l.h>>1;var c=(l.left+(h>>1))*t;var f=(l.top+(u>>1))*e;var m=c-h;var d=f-u;l.setLeftTop(m,d);i.push({x:Physics.toMeter(c-n),y:Physics.toMeter(f-r)})}var y=Physics.toMeter(this.left+(this.w>>1));var v=Physics.toMeter(this.top+(this.h>>1));var g=o.GetFixtureList().GetShape();g.SetAsArray(i,i.length);var _=this.rotation;if(o.m_world.IsLocked()){setTimeout(function(){o.SetAwake(true);o.SynchronizeFixtures();o.SetPositionAndAngle({x:y,y:v},_)},0)}else{o.SetPosition(p)}return};UIPolygon.prototype.setSize=function(t,e){if(t===this.w&&e===this.h){console.log("UIPolygon.prototype.setSize: Size not changed.");return}var i=t/this.w;var n=e/this.h;RShape.prototype.setSize.call(this,t,e);var r=this.getWindow();this.updateLayoutParams();if(this.body&&r&&r.isUIScene){this.resizeBody(i,n)}return this};UIPolygon.prototype.onFromJsonDone=function(t){var e=this.children.length;for(var i=0;i<e;i++){var n=this.children[i];if(n.isUIPoint){n.z=n.getIndex();n.setShowIndex(true).setSize(20,20)}}return};function UIPolygonCreator(){var t=["ui-polygon","ui-polygon",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIPolygon;return e.initUIPolygon(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIPolygonCreator);function UIBox(){return}UIBox.prototype=new UIBody;UIBox.prototype.isUIBox=true;UIBox.prototype.initUIBox=function(t,e,i){this.initUIBody(t,e,i);return this};UIBox.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UIBox.prototype.resizeBody=function(){var t=this.left;var e=this.top;var i=this.getWidth(true)>>1;var n=this.getHeight(true)>>1;var r=this.body.GetFixtureList().GetShape();r.SetAsBox(Physics.toMeter(i),Physics.toMeter(n));this.body.SynchronizeFixtures();this.setLeftTop(t,e)};UIBox.prototype.drawShape=function(t){var e=this.getHMargin();var i=this.getVMargin();var n=this.getWidth(true);var r=this.getHeight(true);t.rect(e,i,n,r);return};function UIBoxCreator(){var t=["ui-box","ui-box",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIBox;return e.initUIBox(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIBoxCreator);function UICircle(){return}UICircle.prototype=new UIBody;UICircle.prototype.isUICircle=true;UICircle.prototype.initUICircle=function(t,e,i){this.initUIBody(t,e,i);return this};UICircle.prototype.shapeCanBeChild=function(t){if(!UIGroup.prototype.shapeCanBeChild.call(this,t)||t.isUIJoint&&!t.isUIMouseJoint){return false}return!t.isUIPhysicsShape};UICircle.prototype.resizeBody=function(){var t=this.left;var e=this.top;var i=Physics.toMeter(Math.min(this.getWidth(true)>>1,this.getHeight(true)>>1));var n=this.body.GetFixtureList().GetShape();n.SetRadius(i);this.body.SynchronizeFixtures();this.setLeftTop(t,e)};UICircle.prototype.drawShape=function(t){var e=this.w>>1;var i=this.h>>1;var n=Math.min(this.getWidth(true)>>1,this.getHeight(true)>>1);t.arc(e,i,n,0,Math.PI*2);return};function UICircleCreator(){var t=["ui-circle","ui-circle",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UICircle;return e.initUICircle(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UICircleCreator);function UILineJoint(){return}UILineJoint.prototype=new UITwoJoint;UILineJoint.prototype.isUIJoint=true;UILineJoint.prototype.isUILineJoint=true;UILineJoint.prototype.initUILineJoint=function(t,e,i){this.initUITwoJoint(t,e,i);return this};function UILineJointCreator(){var t=["ui-line-joint","ui-line-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UILineJoint;return e.initUILineJoint(this.type,200,200)};return}function UITwoJoint(){return}UITwoJoint.prototype=new UITwoPoints;UITwoJoint.prototype.isUIJoint=true;UITwoJoint.prototype.isUITwoJoint=true;UITwoJoint.prototype.initUITwoJoint=function(t,e,i){this.initUITwoPoints(t);return this};function UITwoJointCreator(){var t=["ui-two-joint","ui-two-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UITwoJoint;return e.initUITwoJoint(this.type,200,200)};return}function UIOneJoint(){return}UIOneJoint.prototype=new UIElement;UIOneJoint.prototype.isUIJoint=true;UIOneJoint.prototype.isUIOneJoint=true;UIOneJoint.prototype.initUIOneJoint=function(t){this.initUIElement(t);this.setDefSize(20,20);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.setImage(UIElement.IMAGE_POINT,null);return this};UIOneJoint.prototype.isUserResizable=function(){return false};UIOneJoint.prototype.setSize=function(t,e){this.w=20;this.h=20;return this};UIOneJoint.prototype.paintSelfOnly=function(t){var e=this.getImageByType(UIElement.IMAGE_POINT);if(e&&e.getImage()){var i=e.getImage();var n=e.getImageRect();this.drawImageAt(t,i,this.images.display,0,0,this.w,this.h,n)}else{var r=!this.isFillColorTransparent();var a=!this.isStrokeColorTransparent();if(r||a){var o=this.w>>1;var s=this.h>>1;t.beginPath();t.arc(o,s,10,0,2*Math.PI);if(r){t.fillStyle=this.style.fillColor;t.fill()}if(a){t.strokeStyle=this.style.lineColor;t.lineWidth=this.style.lineWidth;t.stroke()}}}return};UIOneJoint.prototype.shapeCanBeChild=function(t){return false};function UIOneJointCreator(){var t=["ui-one-joint","ui-one-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIOneJoint;return e.initUIOneJoint(this.type)};return}function UIFourJoint(){return}UIFourJoint.prototype=new UIElement;UIFourJoint.prototype.isUIJoint=true;UIFourJoint.prototype.isUIFourJoint=true;UIFourJoint.prototype.initUIFourJoint=function(t,e,i){this.initUIElement(t);this.setDefSize(e,i);this.setTextType(Shape.TEXT_NONE);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;this.points=[{x:0,y:80},{x:0,y:0},{x:80,y:0},{x:80,y:80}];return this};UIFourJoint.prototype.doToJson=function(t){UIElement.prototype.doToJson.call(this,t);t.points=[{},{},{},{}];t.points[0].x=this.points[0].x;t.points[0].y=this.points[0].y;t.points[1].x=this.points[1].x;t.points[1].y=this.points[1].y;t.points[2].x=this.points[2].x;t.points[2].y=this.points[2].y;t.points[3].x=this.points[3].x;t.points[3].y=this.points[3].y;return};UIFourJoint.prototype.doFromJson=function(t){UIElement.prototype.doFromJson.call(this,t);if(t.points){this.points=t.points}return};UIFourJoint.prototype.asIcon=function(){if(!this.isIcon){this.isIcon=true;this.points=[{x:0,y:80},{x:20,y:0},{x:60,y:0},{x:80,y:80}]}return};UIFourJoint.prototype.relayout=function(){if(this.disableRelayout||this.isInDesignMode()){return}var t=getParentShapeOfShape(this);var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.points[0].x=e*this.x0Param;this.points[1].x=e*this.x1Param;this.points[2].x=e*this.x2Param;this.points[3].x=e*this.x3Param}if(this.yAttr===UIElement.Y_SCALE){this.points[0].y=i*this.y0Param;this.points[1].y=i*this.y1Param;this.points[2].y=i*this.y2Param;this.points[3].y=i*this.y3Param}return};UIFourJoint.prototype.updateLayoutParams=function(){this.xParam=1;this.yParam=1;var t=this.parentShape;if(!t){return}var e=t.getWidth(true);var i=t.getHeight(true);if(this.xAttr===UIElement.X_SCALE){this.x0Param=this.points[0].x/e;this.x1Param=this.points[1].x/e;this.x2Param=this.points[2].x/e;this.x3Param=this.points[3].x/e}if(this.yAttr===UIElement.Y_SCALE){this.y0Param=this.points[0].y/i;this.y1Param=this.points[1].y/i;this.y2Param=this.points[2].y/i;this.y3Param=this.points[3].y/i}return};UIFourJoint.prototype.hitTest=function(t){if(Math.distanceBetween(t,this.points[0])<20){return 1}if(Math.distanceBetween(t,this.points[1])<20){return 2}if(Math.distanceBetween(t,this.points[2])<20){return 3}if(Math.distanceBetween(t,this.points[3])<20){return 4}return Shape.HIT_TEST_NONE};UIFourJoint.prototype.getSelectMark=function(t,e){var i=this.points.length;if(t<=i){e.x=this.points[t-1].x;e.y=this.points[t-1].y;return true}return false};UIFourJoint.prototype.onAppendedInParent=function(){if(this.isCreatingElement()){var t=this.getParent();var e=t.getPositionInView();this.points[0].x-=e.x;this.points[0].y-=e.y;this.points[1].x-=e.x;this.points[1].y-=e.y;this.points[2].x-=e.x;this.points[2].y-=e.y;this.points[3].x-=e.x;this.points[3].y-=e.y}return};UIFourJoint.prototype.drawSelectMarks=function(t){return UITwoJoint.prototype.drawSelectMarks.call(this,t)};UIFourJoint.prototype.getMinMaxX=function(){var t=this.points[0].x;var e=t;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(n.x>t){t=n.x}if(n.x<e){e=n.x}}return{min:e,max:t}};UIFourJoint.prototype.getMinMaxY=function(){var t=this.points[0].y;var e=t;for(var i=0;i<this.points.length;i++){var n=this.points[i];if(n.y>t){t=n.y}if(n.y<e){e=n.y}}return{min:e,max:t}};UIFourJoint.prototype.getX=function(){return this.getMinMaxX().min};UIFourJoint.prototype.getY=function(){return this.getMinMaxY().min};UIFourJoint.prototype.getWidth=function(){var t=this.getMinMaxX();return t.max-t.min};UIFourJoint.prototype.getHeight=function(){var t=this.getMinMaxY();return t.max-t.min};UIFourJoint.prototype.paintSelf=function(t){t.save();if(this.isIcon){this.translate(t)}var e=this.anchorSize?this.anchorSize:5;t.lineWidth=this.style.lineWidth;t.fillStyle=this.style.fillColor;t.strokeStyle=this.style.lineColor;t.beginPath();t.moveTo(this.points[0].x,this.points[0].y);t.lineTo(this.points[1].x,this.points[1].y);t.lineTo(this.points[2].x,this.points[2].y);t.lineTo(this.points[3].x,this.points[3].y);t.stroke();t.beginPath();t.arc(this.points[0].x,this.points[0].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[1].x,this.points[1].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[2].x,this.points[2].y,e,0,Math.PI*2);t.fill();t.beginPath();t.arc(this.points[3].x,this.points[3].y,e,0,Math.PI*2);t.fill();t.beginPath();t.restore();this.drawSelectMarks(t);return};UIFourJoint.prototype.shapeCanBeChild=function(t){return false};UIFourJoint.prototype.onPointerDownNormal=function(t){this.hitTestResult=this.hitTest(t);this.selected=this.hitTestResult!=Shape.HIT_TEST_NONE;return this.hitTestResult};UIFourJoint.prototype.onPointerMoveNormal=function(t){if(this.isInDesignMode()&&this.hitTestResult>0){var e=this.hitTestResult-1;this.points[e].x=t.x;this.points[e].y=t.y}};UIFourJoint.prototype.onPointerUpNormal=function(t){this.hitTestResult=Shape.HIT_TEST_NONE;return};UIFourJoint.prototype.onPointerDownCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.state=Shape.STAT_NORMAL}default:{return false}}};UIFourJoint.prototype.onPointerMoveCreating=function(t){switch(this.state){case Shape.STAT_CREATING_0:{this.points[0].x=t.x;this.points[0].y=t.y+80;this.points[1].x=t.x+20;this.points[1].y=t.y;this.points[2].x=t.x+60;this.points[2].y=t.y;this.points[3].x=t.x+80;this.points[3].y=t.y+80;return true}default:{return false}}};function UIFourJointCreator(){var t=["ui-four-joint","ui-four-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIFourJoint;return e.initUIFourJoint(this.type,200,200)};return}function UIRevoluteJoint(){return}UIRevoluteJoint.prototype=new UIOneJoint;UIRevoluteJoint.prototype.isUIJoint=true;UIRevoluteJoint.prototype.isUIRevoluteJoint=true;UIRevoluteJoint.prototype.saveProps=["enableMotor","enableLimit","lowerAngle","upperAngle","maxMotorTorque","motorSpeed"];UIRevoluteJoint.prototype.initUIRevoluteJoint=function(t){this.initUIOneJoint(t);return this};UIRevoluteJoint.prototype.setEnable=function(t){if(this.joint){this.joint.EnableMotor(t);this.enableMotor=this.enable=t}return this};UIRevoluteJoint.prototype.isEnable=function(){if(this.joint){return this.joint.IsMotorEnabled()}return enableMotor};UIRevoluteJoint.prototype.setMaxMotorTorque=function(t){if(this.joint){this.joint.SetMaxMotorTorque(t)}return this};UIRevoluteJoint.prototype.getMotorTorque=function(){if(this.joint){return this.joint.GetMotorTorque()}return 0};UIRevoluteJoint.prototype.setLimitEnable=function(t){if(this.joint){this.joint.EnableLimit(t);this.enableLimit=t}return this};UIRevoluteJoint.prototype.getLimitEnable=function(){if(this.joint){return this.joint.IsLimitEnabled()}return this.enableLimit};UIRevoluteJoint.prototype.setLimits=function(t,e){if(this.joint){this.joint.SetLimits(t,e)}return this};UIRevoluteJoint.prototype.getLowerLimit=function(){if(this.joint){return this.joint.GetLowerLimit()}return 0};UIRevoluteJoint.prototype.getUpperLimit=function(){if(this.joint){return this.joint.GetUpperLimit()}return 0};UIRevoluteJoint.prototype.getJointAngle=function(){if(this.joint){return this.joint.GetJointAngle()}return 0};UIRevoluteJoint.prototype.getJointSpeed=function(){if(this.joint){return this.joint.GetJointSpeed()}return 0};UIRevoluteJoint.prototype.setValue=UIRevoluteJoint.prototype.setMotorSpeed=function(t){if(this.joint){this.joint.SetMotorSpeed(t)}return this};UIRevoluteJoint.prototype.getJoint=function(){return this.joint};UIRevoluteJoint.prototype.getValue=UIRevoluteJoint.prototype.getMotorSpeed=function(){if(this.joint){return this.joint.GetMotorSpeed()}return 0};UIRevoluteJoint.prototype.recreateJoint=function(){var t=this.getWindow().world;if(t){Physics.destroyJointForElement(t,this);Physics.createJoint(t,this)}return};function UIRevoluteJointCreator(){var t=["ui-revolute-joint","ui-revolute-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIRevoluteJoint;return e.initUIRevoluteJoint(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIRevoluteJointCreator);function UIDistanceJoint(){return}UIDistanceJoint.prototype=new UITwoJoint;UIDistanceJoint.prototype.isUIJoint=true;UIDistanceJoint.prototype.isUIDistanceJoint=true;UIDistanceJoint.prototype.saveProps=["collideConnected","frequencyHz","dampingRatio","disableBounce"];UIDistanceJoint.prototype.initUIDistanceJoint=function(t,e,i){this.initUITwoJoint(t,e,i);this.frequencyHz=4;this.dampingRatio=.5;this.disableBounce=false;this.collideConnected=true;return this};function UIDistanceJointCreator(){var t=["ui-distance-joint","ui-distance-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIDistanceJoint;return e.initUIDistanceJoint(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIDistanceJointCreator);function UIEdge(){return}UIEdge.prototype=new UITwoPoints;UIEdge.prototype.isUIEdge=true;UIEdge.prototype.isUIPhysicsShape=true;UIEdge.prototype.saveProps=["friction","restitution","density","groupIndex"];UIEdge.prototype.initUIEdge=function(t,e,i){this.initUITwoPoints(t);return this};UIEdge.prototype.setEnable=function(t){this.enable=t;if(this.body){this.body.SetActive(t)}return this};UIEdge.prototype.onPositionChanged=function(){var t=this.win;if(this.body){var e=this.getParent();var i=e.localToGlobal(this.points[0]);var n=e.localToGlobal(this.points[1]);var r=i.x+n.x>>1;var a=i.y+n.y>>1;var o={};o.x=t.toMeter(r);o.y=t.toMeter(a);this.body.SetPosition(o)}return};UIEdge.prototype.onBodyCreated=function(){};function UIEdgeCreator(){var t=["ui-edge","ui-edge",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIEdge;return e.initUIEdge(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UIEdgeCreator);function Physics(){}Physics.pixelsPerMeter=10;Physics.toMeter=function(t){return t/Physics.pixelsPerMeter};Physics.toPixel=function(t){return t*Physics.pixelsPerMeter};Physics.createFixtureDef=function(t,e){var i=e.w>>1;var n=e.h>>1;var r=new b2FixtureDef;var a=e.left+i;var o=e.top+n;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;if(e.categoryBits){r.filter.categoryBits=e.categoryBits}if(e.maskBits){r.filter.maskBits=e.maskBits}if(e.groupIndex){r.filter.groupIndex=e.groupIndex}if(e.isSensor){r.isSensor=true}if(e.isUICircle||e.physicsShape==="circle"){i=e.getWidth(true)>>1;n=e.getHeight(true)>>1;var s=Physics.toMeter(Math.min(i,n));r.shape=new b2CircleShape(s)}else if(e.isUIBox||e.physicsShape==="rectangle"){i=e.getWidth(true)>>1;n=e.getHeight(true)>>1;r.shape=new b2PolygonShape;r.shape.SetAsBox(Physics.toMeter(i),Physics.toMeter(n))}else if(e.isUIPolygon){var l=i;var h=n;var u=[];var c=[];var p=e.children.length;if(p<3){alert("Polygon has no enough points");return null}var f=e.getVerticesArray();var m=f.vertices;if(f.complex){for(var d=0;d<m.length;d=d+3){var u=m.slice(d,d+3);u=u.map(function(t){return new b2Vec2(Physics.toMeter(t.x-l),Physics.toMeter(t.y-h))});r=new b2FixtureDef;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;r.isSensor=e.isSensor;if(e.categoryBits){r.filter.categoryBits=e.categoryBits}if(e.maskBits){r.filter.maskBits=e.maskBits}if(e.groupIndex){r.filter.groupIndex=e.groupIndex}r.shape=new b2PolygonShape;r.shape.SetAsArray(u,u.length);c.push(r)}}else{r=new b2FixtureDef;r.density=e.density;r.friction=e.friction;r.restitution=e.restitution;r.isSensor=e.isSensor;if(e.categoryBits){r.filter.categoryBits=e.categoryBits}if(e.maskBits){r.filter.maskBits=e.maskBits}if(e.groupIndex){r.filter.groupIndex=e.groupIndex}var u=m.map(function(t){return new b2Vec2(Physics.toMeter(t.x-l),Physics.toMeter(t.y-h))});r.shape=b2PolygonShape.AsArray(u,u.length);c.push(r)}return c.length>1?c:c[0]}else if(e.isUIEdge){var y=e.getParent();var v=y.localToGlobal(e.points[0]);var g=y.localToGlobal(e.points[1]);var l=v.x+g.x>>1;var h=v.y+g.y>>1;var _=v.x-l;var I=v.y-h;var x=g.x-l;var w=g.y-h;var S=new b2Vec2(Physics.toMeter(_),Physics.toMeter(I));var b=new b2Vec2(Physics.toMeter(x),Physics.toMeter(w));r.shape=new b2PolygonShape;r.shape.SetAsEdge(S,b)}return r};Physics.createBody=function(t,e){if(e.fixture||e.body){return}var i=null;var n=e.getPositionInWindow();var r=e.getWidth()>>1;var a=e.getHeight()>>1;var o=n.x+r;var s=n.y+a;var l=e.density;var h=new b2BodyDef;var u=Physics.createFixtureDef(t,e);if(l<0){h.type=b2Body.b2_kinematicBody}else{h.type=l?b2Body.b2_dynamicBody:b2Body.b2_staticBody}if(e.isUIEdge){var c=e.getParent();var p=c.localToGlobal(e.points[0]);var f=c.localToGlobal(e.points[1]);o=p.x+f.x>>1;s=p.y+f.y>>1;h.position.Set(Physics.toMeter(o),Physics.toMeter(s))}else{h.position.Set(Physics.toMeter(o),Physics.toMeter(s))}if(e.fixedRotation){h.fixedRotation=true}if(e.isBullet){h.bullet=true}if(e.allowSleep){h.awake=true;h.allowSleep=true}else{h.allowSleep=false}h.linearDamping=e.linearDamping||0;h.angularDamping=e.angularDamping||0;i=t.CreateBody(h);if(u.length){for(var m=0;m<u.length;m++){i.CreateFixture(u[m])}console.log("Create Composite Polygon: n="+u.length)}else{i.CreateFixture(u)}i.GetFixtureList().m_shape.element=e;e.fixture=i.GetFixtureList().m_shape;i.element=e;i.name=e.name;e.body=i;if(e.rotation){i.SetAngle(e.rotation)}if(!e.enable){i.SetActive(false)}if(e.xInitVelocity||e.yInitVelocity){e.setV(e.xInitVelocity,e.yInitVelocity)}e.onBodyCreated();return i};Physics.createEmbedBody=function(t,e,i){var n=null;var r=Physics.createFixtureDef(t,i);if(!n){var a=e.getPositionInWindow();var o=e.w>>1;var s=e.h>>1;var l=a.x+o;var h=a.y+s;n=new b2BodyDef;if(r.density<0){delete r.density;b2BodyDef.type=b2Body.b2_kinematicBody}else{n.type=r.density?b2Body.b2_dynamicBody:b2Body.b2_staticBody}n.position.Set(Physics.toMeter(l),Physics.toMeter(h));if(e.fixedRotation||i.fixedRotation){n.fixedRotation=true}if(e.isBullet||i.isBullet){n.bullet=true}if(e.allowSleep||i.allowSleep){n.awake=true;n.allowSleep=true}else{n.allowSleep=false}if(i.linearDamping!==undefined){n.linearDamping=i.linearDamping}if(i.angularDamping!==undefined){n.angularDamping=i.angularDamping}var u=t.CreateBody(n);u.element=e;e.body=u;if(!e.enable||!i.enable){u.SetActive(false)}}u.CreateFixture(r);return u};Physics.createBodyForElement=function(t,e,i){if(i.physicsShape){Physics.createBody(t,i)}else if(i.isUIPhysicsShape){if(e.isUIWindow){Physics.createBody(t,i)}else if(e.isUISprite||e.isUISkeletonAnimation||e.isUITransformAnimation||e.isUIFrameAnimation){Physics.createEmbedBody(t,e,i)}else{Physics.createBody(t,i)}}else{Physics.createWorldShapes(t,i)}return};Physics.destroyBodyForElement=function(t,e){for(var i=0;i<e.children.length;i++){var n=e.children[i];Physics.destroyBodyForElement(t,n)}if(e.body){var r=e.body;r.SetActive(false);setTimeout(function(){t.DestroyBody(r)},0);r.element=null;e.body=null}return};Physics.destroyJointForElement=function(t,e){if(e.joint){var i=e.joint;e.joint=null;setTimeout(function(){t.DestroyJoint(i);i=null},0)}return};Physics.createWorldShapes=function(t,e){var i=0;var n=0;var r=null;var a=null;for(var o=0;o<e.children.length;o++){var s=e.children[o];Physics.createBodyForElement(t,e,s)}return};Physics.findBodiesAtPoint=function(t,e,i){var n=[];var r=t.children.length;var a=cantkGetTempCanvas(t.w,t.h);var o=a.getContext("2d");for(var s=i;s>=0;s--){var l=t.children[s];if(!l.body){continue}var h={x:l.left,y:l.top,w:l.w,h:l.h};if(l.rotation){o.save();o.beginPath();o.translate(h.x,h.y);if(l.rotation){o.translate(h.w>>1,h.h>>1);o.rotate(l.rotation);o.translate(-(h.w>>1),-(h.h>>1))}o.rect(0,0,h.w,h.h);if(o.isPointInPath(e.x,e.y)){n.push(l.body)}o.restore()}else{if(isPointInRect(e,h)){n.push(l.body)}}}return n};Physics.createJoint=function(t,e,i){var i=e.getWindow();if(!e.isUIJoint||e.isUIMouseJoint){return}if(e.isUIOneJoint){var n={};var r=null;n.x=e.left+(e.w>>1);n.y=e.top+(e.h>>1);var a=e.getIndex();r=Physics.findBodiesAtPoint(i,n,a);if(r.length==1){r=[t.GetGroundBody(),r[0]]}if(r.length>1){var o=null;var s=new b2Vec2(Physics.toMeter(n.x),Physics.toMeter(n.y));if(r[0].GetType()===b2Body.b2_staticBody&&r[1].GetType()===b2Body.b2_staticBody){console.log("%cWarning: it seems no meanings to pin two static body together.","color: red; font-weight: bold")}if(e.isUIRevoluteJoint){o=new b2RevoluteJointDef;o.Initialize(r[0],r[1],s);o.lowerAngle=(e.lowerAngle?e.lowerAngle:0)*Math.PI/180;o.upperAngle=(e.upperAngle?e.upperAngle:0)*Math.PI/180;o.motorSpeed=e.motorSpeed?e.motorSpeed:0;o.maxMotorTorque=e.maxMotorTorque?e.maxMotorTorque:0;o.enableLimit=e.enableLimit?e.enableLimit:false;o.enableMotor=e.enableMotor?e.enableMotor:false}else if(e.isUIWeldJoint){o=new b2WeldJointDef;o.Initialize(r[0],r[1],s)}var l=t.CreateJoint(o);l.element=e;e.joint=l}else{console.log("not found body")}}else if(e.isUITwoJoint){var o=null;var h=e.points[0];var u=e.points[1];var a=e.getIndex();var c=Physics.findBodiesAtPoint(i,h,a);var p=Physics.findBodiesAtPoint(i,u,a);if(c.length&&p.length){var f=new b2Vec2(Physics.toMeter(h.x),Physics.toMeter(h.y));var m=new b2Vec2(Physics.toMeter(u.x),Physics.toMeter(u.y));if(e.disableBounce){var s=new b2Vec2(Physics.toMeter(h.x+u.x>>1),Physics.toMeter(h.y+u.y>>1));o=new b2RevoluteJointDef;o.Initialize(c[0],p[0],s);o.lowerAngle=(e.lowerAngle?e.lowerAngle:0)*Math.PI/180;o.upperAngle=(e.upperAngle?e.upperAngle:0)*Math.PI/180;o.motorSpeed=e.motorSpeed?e.motorSpeed:0;o.maxMotorTorque=e.maxMotorTorque?e.maxMotorTorque:0;o.enableLimit=e.enableLimit?e.enableLimit:false;o.enableMotor=e.enableMotor?e.enableMotor:false;o.collideConnected=e.collideConnected}else if(e.isUIDistanceJoint){o=new b2DistanceJointDef;o.Initialize(c[0],p[0],f,m);o.frequencyHz=e.frequencyHz||0;o.dampingRatio=e.dampingRatio||0;o.collideConnected=e.collideConnected}else if(e.isUILineJoint){var d=m.x-f.x;var y=m.y-f.y;var v={};v.x=d/Math.sqrt(d*d+y*y);v.y=y/Math.sqrt(d*d+y*y);o=new b2LineJointDef;o.Initialize(c[0],c[1],f,v);o.enableLimit=true;o.lowerTranslation=0;o.upperTranslation=10;o.enableMotor=false;o.maxMotorForce=3e5;o.motorSpeed=1}var l=t.CreateJoint(o);l.element=e;e.joint=l}else{console.log("not found body")}}else if(e.isUIPulleyJoint){var o=null;var h=e.points[0];var u=e.points[1];var g=e.points[2];var _=e.points[3];var a=e.getIndex();var c=Physics.findBodiesAtPoint(i,h,a);var p=Physics.findBodiesAtPoint(i,_,a);if(c.length&&p.length){o=new b2PulleyJointDef;var I=1;var f=new b2Vec2(Physics.toMeter(h.x),Physics.toMeter(h.y));var m=new b2Vec2(Physics.toMeter(u.x),Physics.toMeter(u.y));var x=new b2Vec2(Physics.toMeter(g.x),Physics.toMeter(g.y));var w=new b2Vec2(Physics.toMeter(_.x),Physics.toMeter(_.y));o.Initialize(c[0],p[0],m,x,f,w,I);var l=t.CreateJoint(o);l.element=e;e.joint=l}else{console.log("not found body")}}return};Physics.createWorldJoints=function(t,e,i){for(var n=0;n<i.children.length;n++){var r=i.children[n];Physics.createWorldJoints(t,e,r)}Physics.createJoint(t,i,e)};Physics.getBodySize=function(t){var e=t.GetFixtureList();var i=Number.MAX_VALUE,n=Number.MAX_VALUE;var r=Number.MIN_VALUE,a=Number.MIN_VALUE;var o=t.GetPosition();while(e){var s=e.m_shape;if(s instanceof b2CircleShape){if(r<o.x+s.m_p.x+s.m_radius){r=o.x+s.m_p.x+s.m_radius}if(a<o.y+s.m_p.y+s.m_radius){a=o.y+s.m_p.y+s.m_radius}if(i>o.x+s.m_p.x-s.m_radius){i=o.x+s.m_p.x-s.m_radius}if(n>o.y+s.m_p.y-s.m_radius){n=o.y+s.m_p.y-s.m_radius}}else if(s instanceof b2PolygonShape){for(var l=0;l<s.m_vertexCount;l++){var h=s.m_vertices[l];if(i>o.x+h.x){i=o.x+h.x}if(r<o.x+h.x){r=o.x+h.x}if(n>o.y+h.y){n=o.y+h.y}if(a<o.y+h.y){a=o.y+h.y}}}e=e.m_next}return{w:Physics.toPixel(r-i),h:Physics.toPixel(a-n)}};Physics.createUIRubeBody=function(t,e,i){var n=ShapeFactoryGet().createShape("ui-rube-body","from RUBE");n.setBody(t);n.setGravityScale({x:t.gravityScale,
y:t.gravityScale});n.name=t.name;n.setZIndex(0);n.setAnchor(.5,.5);var r=Physics.getBodySize(t);n.resize(r.w,r.h);t.element=n;i.addChild(n);return n};Physics.createElementForJoint=function(t,e,i){var n=t;if(n instanceof b2RevoluteJoint){console.log("create b2RevoluteJoint")}else if(n instanceof b2DistanceJoint){console.log("create b2DistanceJoint")}else if(n instanceof b2PrismaticJoint){console.log("crate b2PrismaticJoint")}else if(n instanceof b2FrictionJoint){console.log("create b2FrictionJoint")}else if(n instanceof b2WeldJoint){console.log("create b2WeldJoint")}else{console.warn("RUBE: unknown joint type")}};Physics.updateBodyElementsPosition=function(t){for(var e=t.m_bodyList;e;e=e.m_next){var i=e.element;if(i&&i.getParent()){var n=e.GetAngle();var r=e.GetPosition();if(r.x!==undefined&&r.y!==undefined){var a=Physics.toPixel(r.x)-(i.getWidth()>>1);var o=Physics.toPixel(r.y)-(i.getHeight()>>1);var s=i.getParent();if(!s.isUIWindow){var l=s.getPositionInWindow();a=a-l.x;o=o-l.y}var h=i.left;var u=i.top;i.setRotation(n);if(h!==a||u!==o){i.setPositionByBody(a,o)}}}}for(var c=t.m_jointList;c;c=c.m_next){var i=c.element;if(!i||!i.getParent())continue;switch(c.m_type){case b2Joint.e_distanceJoint:{var p=c.GetAnchorA();var f=c.GetAnchorB();var i=c.element;i.points[0].x=Physics.toPixel(p.x);i.points[0].y=Physics.toPixel(p.y);i.points[1].x=Physics.toPixel(f.x);i.points[1].y=Physics.toPixel(f.y);break}case b2Joint.e_pulleyJoint:{var p=c.GetAnchorA();var f=c.GetGroundAnchorA();var m=c.GetGroundAnchorB();var d=c.GetAnchorB();var i=c.element;i.points[0].x=Physics.toPixel(p.x);i.points[0].y=Physics.toPixel(p.y);i.points[1].x=Physics.toPixel(f.x);i.points[1].y=Physics.toPixel(f.y);i.points[2].x=Physics.toPixel(m.x);i.points[2].y=Physics.toPixel(m.y);i.points[3].x=Physics.toPixel(d.x);i.points[3].y=Physics.toPixel(d.y);break}default:{var r=c.GetAnchorA();var i=c.element;if(i.isUIDistanceJoint){var p=c.GetAnchorA();var f=c.GetAnchorB();i.points[0].x=Physics.toPixel(p.x);i.points[0].y=Physics.toPixel(p.y);i.points[1].x=Physics.toPixel(f.x);i.points[1].y=Physics.toPixel(f.y)}else{var a=Physics.toPixel(r.x)-(i.w>>1);var o=Physics.toPixel(r.y)-(i.h>>1);i.setPositionByBody(a,o)}break}}}return};Physics.destroyWorld=function(t){var e=t.m_bodyList;do{if(!e)break;var i=e.m_next;if(e.element){e.element.body=null;e.element=null}t.DestroyBody(e);e=i}while(true);var n=t.m_jointList;do{if(!n)break;var i=n.m_next;if(n.element){n.element=null}t.DestroyJoint(n);n=i}while(true);return};Physics.reparentPhysicsToScene=function(t){var e=[];function i(t){var i=t.getParent();if(t.isUISkeletonAnimation||t.isUISprite||t.isUIFrameAnimation||t.isUITransformAnimation){if(!i.isUIWindow){e.push(t)}}else if(t.isUIPhysicsShape){if(!i.isUISkeletonAnimation&&!i.isUISprite&&!i.isUIFrameAnimation&&!i.isUITransformAnimation&&!i.isUIWindow){e.push(t)}}}t.forEach(i);for(var n=0;n<e.length;n++){var r=e[n];r.reparent(t,true)}return};Physics.setEventListeners=function(t){var e=new b2ContactListener;e.BeginContact=function(t){var e=t.GetFixtureA().GetBody();var i=t.GetFixtureB().GetBody();var n=e.element;var r=i.element;if(n&&r){n.callOnBeginContactHandler(i,t);r.callOnBeginContactHandler(e,t)}};e.EndContact=function(t){var e=t.GetFixtureA().GetBody();var i=t.GetFixtureB().GetBody();var n=e.element;var r=i.element;if(n&&r){n.callOnEndContactHandler(i,t);r.callOnEndContactHandler(e,t)}};e.PreSolve=function(t,e){var i=t.GetFixtureA().GetBody();var n=t.GetFixtureB().GetBody();var r=i.element;var a=n.element;if(r&&a){r.callOnPreSolveHandler(n,t,e);a.callOnPreSolveHandler(i,t,e)}};e.PostSolve=function(t,e){var i=t.GetFixtureA().GetBody();var n=t.GetFixtureB().GetBody();var r=i.element;var a=n.element;if(r&&a){r.callOnPostSolveHandler(n,t,e);a.callOnPostSolveHandler(i,t,e)}};t.SetContactListener(e)};Physics.createWorld=function(t){if(t.world||!window.b2World){return}if(!t.pixelsPerMeter){t.pixelsPerMeter=100}var e=t.velocityIterations||8;var i=t.positionIterations||3;var n=new b2Vec2(t.gravityX||0,t.gravityY||0);var r=new b2World(n,t.allowSleep||false);Physics.pixelsPerMeter=t.pixelsPerMeter||100;Physics.createWorldShapes(r,t);Physics.createWorldJoints(r,t,t);Physics.setEventListeners(r);r.SetWarmStarting(t.warmStarting);t.world=r;Physics.startTimer(r,t,e,i)};Physics.startTimer=function(t,e,i,n){var r=1/40;var a=setInterval(o,r*1e3);function o(o){if(e.world!==t){console.log("World is recreated.");clearInterval(a);return false}var s=e.scaleTime(r);if(e.timeScaleIsZero()){s=0}if(e.isCurrent()&&s>0){t.Step(s,i,n);if(e.autoClearForce){t.ClearForces()}Physics.pixelsPerMeter=e.pixelsPerMeter;Physics.updateBodyElementsPosition(t)}}return};function UIMouseJoint(){return}UIMouseJoint.prototype=new UIOneJoint;UIMouseJoint.prototype.isUIMouseJoint=true;UIMouseJoint.prototype.saveProps=["speedScale","enableTop","enableLeft","enableRight","enableBottom"];UIMouseJoint.prototype.initUIMouseJoint=function(t){this.initUIOneJoint(t);this.speedScale=1;this.enableTop=true;this.enableLeft=true;this.enableRight=true;this.enableBottom=true;return this};UIMouseJoint.prototype.onInit=function(){var t=this.getParent();var e=this.speedScale;var i=this.enableLeft;var n=this.enableRight;var r=this.enableTop;var a=this.enableBottom;if(t.physicsShape||t.isUIPhysicsShape){t.handlePointerDown=function(e,i){if(!i){return UIMouseJoint.handleSpritePointerDown(t,e)}return false};t.handlePointerMove=function(e,i){if(!i){return UIMouseJoint.handleSpritePointerMove(t,e)}return false};t.handlePointerUp=function(o,s){if(!s){return UIMouseJoint.handleSpritePointerUp(t,o,e,i,n,r,a)}return false}}};UIMouseJoint.handleSpritePointerDown=function(t,e){t.body.SetLinearVelocity({x:0,y:0});return};UIMouseJoint.handleSpritePointerMove=function(t,e){t.body.SetLinearVelocity({x:0,y:0});return};UIMouseJoint.prototype.setSpeedLimit=function(t,e,i,n){var r=this.getParent();r.xMinV=t;r.yMinV=i;r.xMaxV=e;r.yMaxV=n;return};UIMouseJoint.handleSpritePointerUp=function(t,e,i,n,r,a,o){var s=(Date.now()-t.pointerDownTime)/1e3;var l=t.getMoveAbsDeltaX();var h=t.getMoveAbsDeltaY();var u=i*Physics.toMeter(l)/s;var c=i*Physics.toMeter(h)/s;if(!n&&u<0){u=0}if(!a&&c<0){c=0}if(!r&&u>0){u=0}if(!o&&c>0){c=0}var p=t.xMaxV;if(p&&Math.abs(u)>p){u=u>0?p:-p}var f=t.yMaxV;if(f&&Math.abs(c)>f){c=c>0?f:-f}var m=t.xMinV;if(m&&Math.abs(u)<m){u=u>0?m:-m}var d=t.yMinV;if(d&&Math.abs(c)<d){c=c>0?d:-d}t.body.SetAwake(true);t.body.SetLinearVelocity({x:u,y:c});return};function UIMouseJointCreator(){var t=["ui-mouse-joint","ui-mouse-joint",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIMouseJoint;return e.initUIMouseJoint(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIMouseJointCreator);function UIRubeBody(){return}UIRubeBody.prototype=new UIBody;UIRubeBody.prototype.isUIRubeBody=true;UIRubeBody.prototype.initUIRubeBody=function(t,e,i){this.initUIBody(t,e,i);return this};UIRubeBody.prototype.shapeCanBeChild=function(t){return false};UIRubeBody.prototype.setBody=function(t){this.body=t};UIRubeBody.prototype.drawCircle=function(t,e){var i=e.m_shape;var n=i.m_vertices;var r=e.m_body;var a=r.GetPosition();var o=i.m_p;var s=this.w>>1;var l=this.h>>1;var h=new b2Vec2(s+Physics.toPixel(o.x),l+Physics.toPixel(o.y));var u=Physics.toPixel(i.m_radius);t.beginPath();t.arc(h.x,h.y,u,0,Math.PI*2);t.closePath();t.lineWidth=2;t.strokeStyle="#ffffff";t.stroke()};UIRubeBody.prototype.getConvexHull=function(t,e){var i=0;var n=t[0].x;for(var r=1;r<e;r++){var a=t[r].x;if(a>n||a==n&&t[r].y<t[i].y){i=r;n=a}}var o=[];var s=0;var l=i;while(true){o[s]=l;var h=0;for(var u=1;u<e;u++){if(h==l){h=u;continue}var c=b2Math.SubtractVV(t[h],t[o[s]]);var p=b2Math.SubtractVV(t[u],t[o[s]]);var f=b2Math.CrossVV(c,p);if(f<0){h=u}if(f==0&&p.LengthSquared()>c.LengthSquared()){h=u}}++s;l=h;if(h==i){break}}if(s<3){return[]}if(s<e){console.warn("some vertices have to be abandomed")}e=s;var m=[];var r=0;for(r=0;r<e;r++){m[r]=new b2Vec2;m[r].SetV(t[o[r]])}return m};UIRubeBody.prototype.drawPolygon=function(t,e){var i=e.m_shape;var n=i.m_vertices;var r=e.m_body;var a=this.w>>1;var o=this.h>>1;var s=i.m_centroid;var l=n.map(function(t){return new b2Vec2(a+Physics.toPixel(t.x),o+Physics.toPixel(t.y))});l=this.getConvexHull(l,l.length);var h=l.length;t.save();t.beginPath();t.moveTo(l[0].x,l[0].y);for(var u=1;u<h;u++){t.lineTo(l[u].x,l[u].y)}t.closePath();t.strokeStyle="#ffffff";t.lineWidth=2;t.stroke();t.restore()};UIRubeBody.prototype.paintSelfOnly=function(t){if(!this.body){return}var e=this.body;var i=e.GetFixtureList();if(!i){console.warn("empty fixtureList");return}t.save();var n=i;while(n){var r=n.m_shape;if(r instanceof b2CircleShape){this.drawCircle(t,n)}else if(r instanceof b2PolygonShape){this.drawPolygon(t,n)}else{console.warn("RUBE: unkown shape body type")}n=n.m_next}t.restore()};function UIRubeBodyCreator(){var t=["ui-rube-body","ui-rube-body",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIRubeBody;return e.initUIRubeBody(this.type,200,200,null)};return}ShapeFactoryGet().addShapeCreator(new UIRubeBodyCreator);var CLOCKWISE=1,COUNTERCLOCKWISE=-1,CONCAVE=-1,CONVEX=1;function ClockWise(t){var e,i,n,r,a=0,o=t.length;if(o<3){return 0}for(e=0;e<o;e++){i=(e+1)%o;n=(e+2)%o;r=(t[i].x-t[e].x)*(t[n].y-t[i].y);r-=(t[i].y-t[e].y)*(t[n].x-t[i].x);if(r<0){a--}else if(r>0){a++}}if(a>0){return COUNTERCLOCKWISE}else if(a<0){return CLOCKWISE}else{return 0}}function Convex(t){var e,i,n,r,a=0,o=t.length;if(o<3){return 0}for(var s=1+Math.floor(o/3);s>=1;s--){for(e=0;e<o;e+=s){i=(e+1*s)%o;n=(e+2*s)%o;r=(t[i].x-t[e].x)*(t[n].y-t[i].y);r-=(t[i].y-t[e].y)*(t[n].x-t[i].x);if(r<0){a|=1}else if(r>0){a|=2}if(a===3){return CONCAVE}}}if(a!==0){return CONVEX}else{return 0}}var EPSILON=1e-10;function process(t){var e=[],i=t.length,n=[],r,a=i,o,s=2*a;if(i<3){return null}if(0<area(t)){for(r=0;r<i;r++){n[r]=r}}else{for(r=0;r<i;r++){n[r]=i-1-r}}for(o=0,r=a-1;a>2;){if(0>=s--){return null}var l=r;if(a<=l){l=0}r=l+1;if(a<=r){r=0}var h=r+1;if(a<=h){h=0}if(snip(t,l,r,h,a,n)){var u,c,p,f,m;u=n[l];c=n[r];p=n[h];e.push(t[u]);e.push(t[c]);e.push(t[p]);o++;for(f=r,m=r+1;m<a;f++,m++){n[f]=n[m]}a--;s=2*a}}return e}function area(t){var e=t.length,i=0;for(var n=e-1,r=0;r<e;n=r++){i+=t[n].x*t[r].y-t[r].x*t[n].y}return i*.5}function insideTriangle(t,e,i,n,r,a,o,s){var l,h,u,c,p,f,m,d,y,v,g,_,I,x,w;l=r-i;h=a-n;u=t-r;c=e-a;p=i-t;f=n-e;m=o-t;d=s-e;y=o-i;v=s-n;g=o-r;_=s-a;w=l*v-h*y;I=p*d-f*m;x=u*_-c*g;return w>=0&&x>=0&&I>=0}function snip(t,e,i,n,r,a){var o,s,l,h,u,c,p,f,m;s=t[a[e]].x;l=t[a[e]].y;h=t[a[i]].x;u=t[a[i]].y;c=t[a[n]].x;p=t[a[n]].y;if(EPSILON>(h-s)*(p-l)-(u-l)*(c-s)){return false}for(o=0;o<r;o++){if(o==e||o==i||o==n){continue}f=t[a[o]].x;m=t[a[o]].y;if(insideTriangle(s,l,h,u,c,p,f,m)){return false}}return true}var Box2D={};Box2D.MIN_VALUE=Number.MIN_VALUE;if(Box2D.MIN_VALUE===0){var d=2;while(Box2D.MIN_VALUE===0){Box2D.MIN_VALUE=1/(Number.MAX_VALUE/d);d*=2}}(function(t,e){if(!(Object.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(t,e,i){if(i.get instanceof Function)t.__defineGetter__(e,i.get);if(i.set instanceof Function)t.__defineSetter__(e,i.set)}}function i(){}t.inherit=function(t,e){var n=t;i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=n};t.generateCallback=function n(t,e){return function(){e.apply(t,arguments)}};t.NVector=function r(t){if(t===e)t=0;var i=new Array(t||0);for(var n=0;n<t;++n)i[n]=0;return i};t.is=function a(t,i){if(t===null)return false;if(i instanceof Function&&t instanceof i)return true;if(t.constructor.__implements!=e&&t.constructor.__implements[i])return true;return false};t.parseUInt=function(t){return Math.abs(parseInt(t))}})(Box2D);var Vector=Array;var Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined")Box2D={};if(typeof Box2D.Collision==="undefined")Box2D.Collision={};if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};(function(){Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";function t(){t.b2AABB.apply(this,arguments)}Box2D.Collision.b2AABB=t;function e(){e.b2Bound.apply(this,arguments)}Box2D.Collision.b2Bound=e;function i(){i.b2BoundValues.apply(this,arguments);if(this.constructor===i)this.b2BoundValues.apply(this,arguments)}Box2D.Collision.b2BoundValues=i;function n(){n.b2Collision.apply(this,arguments)}Box2D.Collision.b2Collision=n;function r(){r.b2ContactID.apply(this,arguments);if(this.constructor===r)this.b2ContactID.apply(this,arguments)}Box2D.Collision.b2ContactID=r;function a(){a.b2ContactPoint.apply(this,arguments)}Box2D.Collision.b2ContactPoint=a;function o(){o.b2Distance.apply(this,arguments)}Box2D.Collision.b2Distance=o;function s(){s.b2DistanceInput.apply(this,arguments)}Box2D.Collision.b2DistanceInput=s;function l(){l.b2DistanceOutput.apply(this,arguments)}Box2D.Collision.b2DistanceOutput=l;function h(){h.b2DistanceProxy.apply(this,arguments)}Box2D.Collision.b2DistanceProxy=h;function u(){u.b2DynamicTree.apply(this,arguments);if(this.constructor===u)this.b2DynamicTree.apply(this,arguments)}Box2D.Collision.b2DynamicTree=u;function c(){c.b2DynamicTreeBroadPhase.apply(this,arguments)}Box2D.Collision.b2DynamicTreeBroadPhase=c;function p(){p.b2DynamicTreeNode.apply(this,arguments)}Box2D.Collision.b2DynamicTreeNode=p;function f(){f.b2DynamicTreePair.apply(this,arguments)}Box2D.Collision.b2DynamicTreePair=f;function m(){m.b2Manifold.apply(this,arguments);if(this.constructor===m)this.b2Manifold.apply(this,arguments)}Box2D.Collision.b2Manifold=m;function d(){d.b2ManifoldPoint.apply(this,arguments);if(this.constructor===d)this.b2ManifoldPoint.apply(this,arguments)}Box2D.Collision.b2ManifoldPoint=d;function y(){y.b2Point.apply(this,arguments)}Box2D.Collision.b2Point=y;function v(){v.b2RayCastInput.apply(this,arguments);if(this.constructor===v)this.b2RayCastInput.apply(this,arguments)}Box2D.Collision.b2RayCastInput=v;function g(){g.b2RayCastOutput.apply(this,arguments)}Box2D.Collision.b2RayCastOutput=g;function _(){_.b2Segment.apply(this,arguments)}Box2D.Collision.b2Segment=_;function I(){I.b2SeparationFunction.apply(this,arguments)}Box2D.Collision.b2SeparationFunction=I;function x(){x.b2Simplex.apply(this,arguments);if(this.constructor===x)this.b2Simplex.apply(this,arguments)}Box2D.Collision.b2Simplex=x;function w(){w.b2SimplexCache.apply(this,arguments)}Box2D.Collision.b2SimplexCache=w;function S(){S.b2SimplexVertex.apply(this,arguments)}Box2D.Collision.b2SimplexVertex=S;function b(){b.b2TimeOfImpact.apply(this,arguments)}Box2D.Collision.b2TimeOfImpact=b;function C(){C.b2TOIInput.apply(this,arguments)}Box2D.Collision.b2TOIInput=C;function T(){T.b2WorldManifold.apply(this,arguments);if(this.constructor===T)this.b2WorldManifold.apply(this,arguments)}Box2D.Collision.b2WorldManifold=T;function D(){D.ClipVertex.apply(this,arguments)}Box2D.Collision.ClipVertex=D;function U(){U.Features.apply(this,arguments)}Box2D.Collision.Features=U;function A(){A.b2CircleShape.apply(this,arguments);if(this.constructor===A)this.b2CircleShape.apply(this,arguments)}Box2D.Collision.Shapes.b2CircleShape=A;function E(){E.b2EdgeChainDef.apply(this,arguments);if(this.constructor===E)this.b2EdgeChainDef.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeChainDef=E;function M(){M.b2EdgeShape.apply(this,arguments);if(this.constructor===M)this.b2EdgeShape.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeShape=M;function P(){P.b2MassData.apply(this,arguments)}Box2D.Collision.Shapes.b2MassData=P;function B(){B.b2PolygonShape.apply(this,arguments);if(this.constructor===B)this.b2PolygonShape.apply(this,arguments)}Box2D.Collision.Shapes.b2PolygonShape=B;function L(){L.b2Shape.apply(this,arguments);if(this.constructor===L)this.b2Shape.apply(this,arguments)}Box2D.Collision.Shapes.b2Shape=L;Box2D.Common.b2internal="Box2D.Common.b2internal";function R(){R.b2Color.apply(this,arguments);if(this.constructor===R)this.b2Color.apply(this,arguments)}Box2D.Common.b2Color=R;function O(){O.b2Settings.apply(this,arguments)}Box2D.Common.b2Settings=O;function V(){V.b2Mat22.apply(this,arguments);if(this.constructor===V)this.b2Mat22.apply(this,arguments)}Box2D.Common.Math.b2Mat22=V;function F(){F.b2Mat33.apply(this,arguments);if(this.constructor===F)this.b2Mat33.apply(this,arguments)}Box2D.Common.Math.b2Mat33=F;function k(){k.b2Math.apply(this,arguments)}Box2D.Common.Math.b2Math=k;function N(){N.b2Sweep.apply(this,arguments)}Box2D.Common.Math.b2Sweep=N;function G(){G.b2Transform.apply(this,arguments);if(this.constructor===G)this.b2Transform.apply(this,arguments)}Box2D.Common.Math.b2Transform=G;function W(){W.b2Vec2.apply(this,arguments);if(this.constructor===W)this.b2Vec2.apply(this,arguments)}Box2D.Common.Math.b2Vec2=W;function H(){H.b2Vec3.apply(this,arguments);if(this.constructor===H)this.b2Vec3.apply(this,arguments)}Box2D.Common.Math.b2Vec3=H;function X(){X.b2Body.apply(this,arguments);if(this.constructor===X)this.b2Body.apply(this,arguments)}Box2D.Dynamics.b2Body=X;function J(){J.b2BodyDef.apply(this,arguments);if(this.constructor===J)this.b2BodyDef.apply(this,arguments)}Box2D.Dynamics.b2BodyDef=J;function Y(){Y.b2ContactFilter.apply(this,arguments)}Box2D.Dynamics.b2ContactFilter=Y;function z(){z.b2ContactImpulse.apply(this,arguments)}Box2D.Dynamics.b2ContactImpulse=z;function j(){j.b2ContactListener.apply(this,arguments)}Box2D.Dynamics.b2ContactListener=j;function K(){K.b2ContactManager.apply(this,arguments);if(this.constructor===K)this.b2ContactManager.apply(this,arguments)}Box2D.Dynamics.b2ContactManager=K;function q(){q.b2DebugDraw.apply(this,arguments);if(this.constructor===q)this.b2DebugDraw.apply(this,arguments)}Box2D.Dynamics.b2DebugDraw=q;function Z(){Z.b2DestructionListener.apply(this,arguments)}Box2D.Dynamics.b2DestructionListener=Z;function Q(){Q.b2FilterData.apply(this,arguments)}Box2D.Dynamics.b2FilterData=Q;function $(){$.b2Fixture.apply(this,arguments);if(this.constructor===$)this.b2Fixture.apply(this,arguments)}Box2D.Dynamics.b2Fixture=$;function tt(){tt.b2FixtureDef.apply(this,arguments);if(this.constructor===tt)this.b2FixtureDef.apply(this,arguments)}Box2D.Dynamics.b2FixtureDef=tt;function et(){et.b2Island.apply(this,arguments);if(this.constructor===et)this.b2Island.apply(this,arguments)}Box2D.Dynamics.b2Island=et;function it(){it.b2TimeStep.apply(this,arguments)}Box2D.Dynamics.b2TimeStep=it;function nt(){nt.b2World.apply(this,arguments);if(this.constructor===nt)this.b2World.apply(this,arguments)}Box2D.Dynamics.b2World=nt;function rt(){rt.b2CircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2CircleContact=rt;function at(){at.b2Contact.apply(this,arguments);if(this.constructor===at)this.b2Contact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2Contact=at;function ot(){ot.b2ContactConstraint.apply(this,arguments);if(this.constructor===ot)this.b2ContactConstraint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraint=ot;function st(){st.b2ContactConstraintPoint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraintPoint=st;function lt(){lt.b2ContactEdge.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactEdge=lt;function ht(){ht.b2ContactFactory.apply(this,arguments);if(this.constructor===ht)this.b2ContactFactory.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactFactory=ht;function ut(){ut.b2ContactRegister.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactRegister=ut;function ct(){ct.b2ContactResult.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactResult=ct;function pt(){pt.b2ContactSolver.apply(this,arguments);if(this.constructor===pt)this.b2ContactSolver.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactSolver=pt;function ft(){ft.b2EdgeAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=ft;function mt(){mt.b2NullContact.apply(this,arguments);if(this.constructor===mt)this.b2NullContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2NullContact=mt;function dt(){dt.b2PolyAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndCircleContact=dt;function yt(){yt.b2PolyAndEdgeContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=yt;function vt(){vt.b2PolygonContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolygonContact=vt;function gt(){gt.b2PositionSolverManifold.apply(this,arguments);if(this.constructor===gt)this.b2PositionSolverManifold.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PositionSolverManifold=gt;function _t(){_t.b2BuoyancyController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2BuoyancyController=_t;function It(){It.b2ConstantAccelController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantAccelController=It;function xt(){xt.b2ConstantForceController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantForceController=xt;function wt(){wt.b2Controller.apply(this,arguments)}Box2D.Dynamics.Controllers.b2Controller=wt;function St(){St.b2ControllerEdge.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ControllerEdge=St;function bt(){bt.b2GravityController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2GravityController=bt;function Ct(){Ct.b2TensorDampingController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2TensorDampingController=Ct;function Tt(){Tt.b2DistanceJoint.apply(this,arguments);if(this.constructor===Tt)this.b2DistanceJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJoint=Tt;function Dt(){Dt.b2DistanceJointDef.apply(this,arguments);if(this.constructor===Dt)this.b2DistanceJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJointDef=Dt;function Ut(){Ut.b2FrictionJoint.apply(this,arguments);if(this.constructor===Ut)this.b2FrictionJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJoint=Ut;function At(){At.b2FrictionJointDef.apply(this,arguments);if(this.constructor===At)this.b2FrictionJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJointDef=At;function Et(){Et.b2GearJoint.apply(this,arguments);if(this.constructor===Et)this.b2GearJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJoint=Et;function Mt(){Mt.b2GearJointDef.apply(this,arguments);if(this.constructor===Mt)this.b2GearJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJointDef=Mt;function Pt(){Pt.b2Jacobian.apply(this,arguments)}Box2D.Dynamics.Joints.b2Jacobian=Pt;function Bt(){Bt.b2Joint.apply(this,arguments);if(this.constructor===Bt)this.b2Joint.apply(this,arguments)}Box2D.Dynamics.Joints.b2Joint=Bt;function Lt(){Lt.b2JointDef.apply(this,arguments);if(this.constructor===Lt)this.b2JointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointDef=Lt;function Rt(){Rt.b2JointEdge.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointEdge=Rt;function Ot(){Ot.b2LineJoint.apply(this,arguments);if(this.constructor===Ot)this.b2LineJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJoint=Ot;function Vt(){Vt.b2LineJointDef.apply(this,arguments);if(this.constructor===Vt)this.b2LineJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJointDef=Vt;function Ft(){Ft.b2MouseJoint.apply(this,arguments);if(this.constructor===Ft)this.b2MouseJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJoint=Ft;function kt(){kt.b2MouseJointDef.apply(this,arguments);if(this.constructor===kt)this.b2MouseJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJointDef=kt;function Nt(){Nt.b2PrismaticJoint.apply(this,arguments);if(this.constructor===Nt)this.b2PrismaticJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJoint=Nt;function Gt(){Gt.b2PrismaticJointDef.apply(this,arguments);if(this.constructor===Gt)this.b2PrismaticJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJointDef=Gt;function Wt(){Wt.b2PulleyJoint.apply(this,arguments);if(this.constructor===Wt)this.b2PulleyJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJoint=Wt;function Ht(){Ht.b2PulleyJointDef.apply(this,arguments);if(this.constructor===Ht)this.b2PulleyJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJointDef=Ht;function Xt(){Xt.b2RevoluteJoint.apply(this,arguments);if(this.constructor===Xt)this.b2RevoluteJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJoint=Xt;function Jt(){Jt.b2RevoluteJointDef.apply(this,arguments);if(this.constructor===Jt)this.b2RevoluteJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJointDef=Jt;function Yt(){Yt.b2WeldJoint.apply(this,arguments);if(this.constructor===Yt)this.b2WeldJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJoint=Yt;function zt(){zt.b2WeldJointDef.apply(this,arguments);if(this.constructor===zt)this.b2WeldJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJointDef=zt})();Box2D.postDefs=[];(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,a=Box2D.Collision.Shapes.b2Shape,o=Box2D.Common.b2Color,s=Box2D.Common.b2internal,l=Box2D.Common.b2Settings,h=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,p=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,m=Box2D.Common.Math.b2Vec2,d=Box2D.Common.Math.b2Vec3,y=Box2D.Collision.b2AABB,v=Box2D.Collision.b2Bound,g=Box2D.Collision.b2BoundValues,_=Box2D.Collision.b2Collision,I=Box2D.Collision.b2ContactID,x=Box2D.Collision.b2ContactPoint,w=Box2D.Collision.b2Distance,S=Box2D.Collision.b2DistanceInput,b=Box2D.Collision.b2DistanceOutput,C=Box2D.Collision.b2DistanceProxy,T=Box2D.Collision.b2DynamicTree,D=Box2D.Collision.b2DynamicTreeBroadPhase,U=Box2D.Collision.b2DynamicTreeNode,A=Box2D.Collision.b2DynamicTreePair,E=Box2D.Collision.b2Manifold,M=Box2D.Collision.b2ManifoldPoint,P=Box2D.Collision.b2Point,B=Box2D.Collision.b2RayCastInput,L=Box2D.Collision.b2RayCastOutput,R=Box2D.Collision.b2Segment,O=Box2D.Collision.b2SeparationFunction,V=Box2D.Collision.b2Simplex,F=Box2D.Collision.b2SimplexCache,k=Box2D.Collision.b2SimplexVertex,N=Box2D.Collision.b2TimeOfImpact,G=Box2D.Collision.b2TOIInput,W=Box2D.Collision.b2WorldManifold,H=Box2D.Collision.ClipVertex,X=Box2D.Collision.Features,J=Box2D.Collision.IBroadPhase;y.b2AABB=function(){this.lowerBound=new m;this.upperBound=new m};y.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x;var e=this.upperBound.y-this.lowerBound.y;var i=t>=0&&e>=0;i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return i};y.prototype.GetCenter=function(){return new m((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};y.prototype.GetExtents=function(){return new m((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};y.prototype.Contains=function(t){var e=true;e=e&&this.lowerBound.x<=t.lowerBound.x;e=e&&this.lowerBound.y<=t.lowerBound.y;e=e&&t.upperBound.x<=this.upperBound.x;e=e&&t.upperBound.y<=this.upperBound.y;return e};y.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE;var n=Number.MAX_VALUE;var r=e.p1.x;var a=e.p1.y;var o=e.p2.x-e.p1.x;var s=e.p2.y-e.p1.y;var l=Math.abs(o);var h=Math.abs(s);var u=t.normal;var c=0;var p=0;var f=0;var m=0;var d=0;{if(l<Box2D.MIN_VALUE){if(r<this.lowerBound.x||this.upperBound.x<r)return false}else{c=1/o;p=(this.lowerBound.x-r)*c;f=(this.upperBound.x-r)*c;d=-1;if(p>f){m=p;p=f;f=m;d=1}if(p>i){u.x=d;u.y=0;i=p}n=Math.min(n,f);if(i>n)return false}}{if(h<Box2D.MIN_VALUE){if(a<this.lowerBound.y||this.upperBound.y<a)return false}else{c=1/s;p=(this.lowerBound.y-a)*c;f=(this.upperBound.y-a)*c;d=-1;if(p>f){m=p;p=f;f=m;d=1}if(p>i){u.y=d;u.x=0;i=p}n=Math.min(n,f);if(i>n)return false}}t.fraction=i;return true};y.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x;var i=t.lowerBound.y-this.upperBound.y;var n=this.lowerBound.x-t.upperBound.x;var r=this.lowerBound.y-t.upperBound.y;if(e>0||i>0)return false;if(n>0||r>0)return false;return true};y.Combine=function(t,e){var i=new y;i.Combine(t,e);return i};y.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x);this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y);this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x);this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)};v.b2Bound=function(){};v.prototype.IsLower=function(){return(this.value&1)==0};v.prototype.IsUpper=function(){return(this.value&1)==1};v.prototype.Swap=function(t){var e=this.value;var i=this.proxy;var n=this.stabbingCount;this.value=t.value;this.proxy=t.proxy;this.stabbingCount=t.stabbingCount;t.value=e;t.proxy=i;t.stabbingCount=n};g.b2BoundValues=function(){};g.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};_.b2Collision=function(){};_.ClipSegmentToLine=function(t,e,i,n){if(n===undefined)n=0;var r;var a=0;r=e[0];var o=r.v;r=e[1];var s=r.v;var l=i.x*o.x+i.y*o.y-n;var h=i.x*s.x+i.y*s.y-n;if(l<=0)t[a++].Set(e[0]);if(h<=0)t[a++].Set(e[1]);if(l*h<0){var u=l/(l-h);r=t[a];var c=r.v;c.x=o.x+u*(s.x-o.x);c.y=o.y+u*(s.y-o.y);r=t[a];var p;if(l>0){p=e[0];r.id=p.id}else{p=e[1];r.id=p.id}++a}return a};_.EdgeSeparation=function(t,e,i,n,r){if(i===undefined)i=0;var a=parseInt(t.m_vertexCount);var o=t.m_vertices;var s=t.m_normals;var l=parseInt(n.m_vertexCount);var h=n.m_vertices;var u;var c;u=e.R;c=s[i];var p=u.col1.x*c.x+u.col2.x*c.y;var f=u.col1.y*c.x+u.col2.y*c.y;u=r.R;var m=u.col1.x*p+u.col1.y*f;var d=u.col2.x*p+u.col2.y*f;var y=0;var v=Number.MAX_VALUE;for(var g=0;g<l;++g){c=h[g];var _=c.x*m+c.y*d;if(_<v){v=_;y=g}}c=o[i];u=e.R;var I=e.position.x+(u.col1.x*c.x+u.col2.x*c.y);var x=e.position.y+(u.col1.y*c.x+u.col2.y*c.y);c=h[y];u=r.R;var w=r.position.x+(u.col1.x*c.x+u.col2.x*c.y);var S=r.position.y+(u.col1.y*c.x+u.col2.y*c.y);w-=I;S-=x;var b=w*p+S*f;return b};_.FindMaxSeparation=function(t,e,i,n,r){var a=parseInt(e.m_vertexCount);var o=e.m_normals;var s;var l;l=r.R;s=n.m_centroid;var h=r.position.x+(l.col1.x*s.x+l.col2.x*s.y);var u=r.position.y+(l.col1.y*s.x+l.col2.y*s.y);l=i.R;s=e.m_centroid;h-=i.position.x+(l.col1.x*s.x+l.col2.x*s.y);u-=i.position.y+(l.col1.y*s.x+l.col2.y*s.y);var c=h*i.R.col1.x+u*i.R.col1.y;var p=h*i.R.col2.x+u*i.R.col2.y;var f=0;var m=-Number.MAX_VALUE;for(var d=0;d<a;++d){s=o[d];var y=s.x*c+s.y*p;if(y>m){m=y;f=d}}var v=_.EdgeSeparation(e,i,f,n,r);var g=parseInt(f-1>=0?f-1:a-1);var I=_.EdgeSeparation(e,i,g,n,r);var x=parseInt(f+1<a?f+1:0);var w=_.EdgeSeparation(e,i,x,n,r);var S=0;var b=0;var C=0;if(I>v&&I>w){C=-1;S=g;b=I}else if(w>v){C=1;S=x;b=w}else{t[0]=f;return v}while(true){if(C==-1)f=S-1>=0?S-1:a-1;else f=S+1<a?S+1:0;v=_.EdgeSeparation(e,i,f,n,r);if(v>b){S=f;b=v}else{break}}t[0]=S;return b};_.FindIncidentEdge=function(t,e,i,n,r,a){if(n===undefined)n=0;var o=parseInt(e.m_vertexCount);var s=e.m_normals;var l=parseInt(r.m_vertexCount);var h=r.m_vertices;var u=r.m_normals;var c;var p;c=i.R;p=s[n];var f=c.col1.x*p.x+c.col2.x*p.y;var m=c.col1.y*p.x+c.col2.y*p.y;c=a.R;var d=c.col1.x*f+c.col1.y*m;m=c.col2.x*f+c.col2.y*m;f=d;var y=0;var v=Number.MAX_VALUE;for(var g=0;g<l;++g){p=u[g];var _=f*p.x+m*p.y;if(_<v){v=_;y=g}}var I;var x=parseInt(y);var w=parseInt(x+1<l?x+1:0);I=t[0];p=h[x];c=a.R;I.v.x=a.position.x+(c.col1.x*p.x+c.col2.x*p.y);I.v.y=a.position.y+(c.col1.y*p.x+c.col2.y*p.y);I.id.features.referenceEdge=n;I.id.features.incidentEdge=x;I.id.features.incidentVertex=0;I=t[1];p=h[w];c=a.R;I.v.x=a.position.x+(c.col1.x*p.x+c.col2.x*p.y);I.v.y=a.position.y+(c.col1.y*p.x+c.col2.y*p.y);I.id.features.referenceEdge=n;I.id.features.incidentEdge=w;I.id.features.incidentVertex=1};_.MakeClipPointVector=function(){var t=new Vector(2);
t[0]=new H;t[1]=new H;return t};_.CollidePolygons=function(t,e,i,n,r){var a;t.m_pointCount=0;var o=e.m_radius+n.m_radius;var s=0;_.s_edgeAO[0]=s;var h=_.FindMaxSeparation(_.s_edgeAO,e,i,n,r);s=_.s_edgeAO[0];if(h>o)return;var u=0;_.s_edgeBO[0]=u;var c=_.FindMaxSeparation(_.s_edgeBO,n,r,e,i);u=_.s_edgeBO[0];if(c>o)return;var p;var f;var m;var d;var y=0;var v=0;var g=.98;var I=.001;var x;if(c>g*h+I){p=n;f=e;m=r;d=i;y=u;t.m_type=E.e_faceB;v=1}else{p=e;f=n;m=i;d=r;y=s;t.m_type=E.e_faceA;v=0}var w=_.s_incidentEdge;_.FindIncidentEdge(w,p,m,y,f,d);var S=parseInt(p.m_vertexCount);var b=p.m_vertices;var C=b[y];var T;if(y+1<S){T=b[parseInt(y+1)]}else{T=b[0]}var D=_.s_localTangent;D.Set(T.x-C.x,T.y-C.y);D.Normalize();var U=_.s_localNormal;U.x=D.y;U.y=-D.x;var A=_.s_planePoint;A.Set(.5*(C.x+T.x),.5*(C.y+T.y));var M=_.s_tangent;x=m.R;M.x=x.col1.x*D.x+x.col2.x*D.y;M.y=x.col1.y*D.x+x.col2.y*D.y;var P=_.s_tangent2;P.x=-M.x;P.y=-M.y;var B=_.s_normal;B.x=M.y;B.y=-M.x;var L=_.s_v11;var R=_.s_v12;L.x=m.position.x+(x.col1.x*C.x+x.col2.x*C.y);L.y=m.position.y+(x.col1.y*C.x+x.col2.y*C.y);R.x=m.position.x+(x.col1.x*T.x+x.col2.x*T.y);R.y=m.position.y+(x.col1.y*T.x+x.col2.y*T.y);var O=B.x*L.x+B.y*L.y;var V=-M.x*L.x-M.y*L.y+o;var F=M.x*R.x+M.y*R.y+o;var k=_.s_clipPoints1;var N=_.s_clipPoints2;var G=0;G=_.ClipSegmentToLine(k,w,P,V);if(G<2)return;G=_.ClipSegmentToLine(N,k,M,F);if(G<2)return;t.m_localPlaneNormal.SetV(U);t.m_localPoint.SetV(A);var W=0;for(var H=0;H<l.b2_maxManifoldPoints;++H){a=N[H];var X=B.x*a.v.x+B.y*a.v.y-O;if(X<=o){var J=t.m_points[W];x=d.R;var Y=a.v.x-d.position.x;var z=a.v.y-d.position.y;J.m_localPoint.x=Y*x.col1.x+z*x.col1.y;J.m_localPoint.y=Y*x.col2.x+z*x.col2.y;J.m_id.Set(a.id);J.m_id.features.flip=v;++W}}t.m_pointCount=W};_.CollideCircles=function(t,e,i,n,r){t.m_pointCount=0;var a;var o;a=i.R;o=e.m_p;var s=i.position.x+(a.col1.x*o.x+a.col2.x*o.y);var l=i.position.y+(a.col1.y*o.x+a.col2.y*o.y);a=r.R;o=n.m_p;var h=r.position.x+(a.col1.x*o.x+a.col2.x*o.y);var u=r.position.y+(a.col1.y*o.x+a.col2.y*o.y);var c=h-s;var p=u-l;var f=c*c+p*p;var m=e.m_radius+n.m_radius;if(f>m*m){return}t.m_type=E.e_circles;t.m_localPoint.SetV(e.m_p);t.m_localPlaneNormal.SetZero();t.m_pointCount=1;t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0};_.CollidePolygonAndCircle=function(t,e,i,n,r){t.m_pointCount=0;var a;var o=0;var s=0;var l=0;var h=0;var u;var c;c=r.R;u=n.m_p;var p=r.position.x+(c.col1.x*u.x+c.col2.x*u.y);var f=r.position.y+(c.col1.y*u.x+c.col2.y*u.y);o=p-i.position.x;s=f-i.position.y;c=i.R;var m=o*c.col1.x+s*c.col1.y;var d=o*c.col2.x+s*c.col2.y;var y=0;var v=0;var g=-Number.MAX_VALUE;var _=e.m_radius+n.m_radius;var I=parseInt(e.m_vertexCount);var x=e.m_vertices;var w=e.m_normals;for(var S=0;S<I;++S){u=x[S];o=m-u.x;s=d-u.y;u=w[S];var b=u.x*o+u.y*s;if(b>_){return}if(b>g){g=b;v=S}}var C=parseInt(v);var T=parseInt(C+1<I?C+1:0);var D=x[C];var U=x[T];if(g<Box2D.MIN_VALUE){t.m_pointCount=1;t.m_type=E.e_faceA;t.m_localPlaneNormal.SetV(w[v]);t.m_localPoint.x=.5*(D.x+U.x);t.m_localPoint.y=.5*(D.y+U.y);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0;return}var A=(m-D.x)*(U.x-D.x)+(d-D.y)*(U.y-D.y);var M=(m-U.x)*(D.x-U.x)+(d-U.y)*(D.y-U.y);if(A<=0){if((m-D.x)*(m-D.x)+(d-D.y)*(d-D.y)>_*_)return;t.m_pointCount=1;t.m_type=E.e_faceA;t.m_localPlaneNormal.x=m-D.x;t.m_localPlaneNormal.y=d-D.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(D);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else if(M<=0){if((m-U.x)*(m-U.x)+(d-U.y)*(d-U.y)>_*_)return;t.m_pointCount=1;t.m_type=E.e_faceA;t.m_localPlaneNormal.x=m-U.x;t.m_localPlaneNormal.y=d-U.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(U);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else{var P=.5*(D.x+U.x);var B=.5*(D.y+U.y);g=(m-P)*w[C].x+(d-B)*w[C].y;if(g>_)return;t.m_pointCount=1;t.m_type=E.e_faceA;t.m_localPlaneNormal.x=w[C].x;t.m_localPlaneNormal.y=w[C].y;t.m_localPlaneNormal.Normalize();t.m_localPoint.Set(P,B);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}};_.TestOverlap=function(t,e){var i=e.lowerBound;var n=t.upperBound;var r=i.x-n.x;var a=i.y-n.y;i=t.lowerBound;n=e.upperBound;var o=i.x-n.x;var s=i.y-n.y;if(r>0||a>0)return false;if(o>0||s>0)return false;return true};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=_.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new m;Box2D.Collision.b2Collision.s_localNormal=new m;Box2D.Collision.b2Collision.s_planePoint=new m;Box2D.Collision.b2Collision.s_normal=new m;Box2D.Collision.b2Collision.s_tangent=new m;Box2D.Collision.b2Collision.s_tangent2=new m;Box2D.Collision.b2Collision.s_v11=new m;Box2D.Collision.b2Collision.s_v12=new m;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new m;Box2D.Collision.b2Collision.b2_nullFeature=255});I.b2ContactID=function(){this.features=new X};I.prototype.b2ContactID=function(){this.features._m_id=this};I.prototype.Set=function(t){this.key=t._key};I.prototype.Copy=function(){var t=new I;t.key=this.key;return t};Object.defineProperty(I.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(I.prototype,"key",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._key=t;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});x.b2ContactPoint=function(){this.position=new m;this.velocity=new m;this.normal=new m;this.id=new I};w.b2Distance=function(){};w.Distance=function(t,e,i){++w.b2_gjkCalls;var n=i.proxyA;var r=i.proxyB;var a=i.transformA;var o=i.transformB;var s=w.s_simplex;s.ReadCache(e,n,a,r,o);var h=s.m_vertices;var u=20;var p=w.s_saveA;var f=w.s_saveB;var d=0;var y=s.GetClosestPoint();var v=y.LengthSquared();var g=v;var _=0;var I;var x=0;while(x<u){d=s.m_count;for(_=0;_<d;_++){p[_]=h[_].indexA;f[_]=h[_].indexB}switch(s.m_count){case 1:break;case 2:s.Solve2();break;case 3:s.Solve3();break;default:l.b2Assert(false)}if(s.m_count==3){break}I=s.GetClosestPoint();g=I.LengthSquared();if(g>v){}v=g;var S=s.GetSearchDirection();if(S.LengthSquared()<Box2D.MIN_VALUE*Box2D.MIN_VALUE){break}var b=h[s.m_count];b.indexA=n.GetSupport(c.MulTMV(a.R,S.GetNegative()));b.wA=c.MulX(a,n.GetVertex(b.indexA));b.indexB=r.GetSupport(c.MulTMV(o.R,S));b.wB=c.MulX(o,r.GetVertex(b.indexB));b.w=c.SubtractVV(b.wB,b.wA);++x;++w.b2_gjkIters;var C=false;for(_=0;_<d;_++){if(b.indexA==p[_]&&b.indexB==f[_]){C=true;break}}if(C){break}++s.m_count}w.b2_gjkMaxIters=c.Max(w.b2_gjkMaxIters,x);s.GetWitnessPoints(t.pointA,t.pointB);t.distance=c.SubtractVV(t.pointA,t.pointB).Length();t.iterations=x;s.WriteCache(e);if(i.useRadii){var T=n.m_radius;var D=r.m_radius;if(t.distance>T+D&&t.distance>Box2D.MIN_VALUE){t.distance-=T+D;var U=c.SubtractVV(t.pointB,t.pointA);U.Normalize();t.pointA.x+=T*U.x;t.pointA.y+=T*U.y;t.pointB.x-=D*U.x;t.pointB.y-=D*U.y}else{I=new m;I.x=.5*(t.pointA.x+t.pointB.x);I.y=.5*(t.pointA.y+t.pointB.y);t.pointA.x=t.pointB.x=I.x;t.pointA.y=t.pointB.y=I.y;t.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new V;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});S.b2DistanceInput=function(){};b.b2DistanceOutput=function(){this.pointA=new m;this.pointB=new m};C.b2DistanceProxy=function(){};C.prototype.Set=function(e){switch(e.GetType()){case a.e_circleShape:{var n=e instanceof t?e:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=n.m_p;this.m_count=1;this.m_radius=n.m_radius}break;case a.e_polygonShape:{var o=e instanceof r?e:null;this.m_vertices=o.m_vertices;this.m_count=o.m_vertexCount;this.m_radius=o.m_radius}break;case a.e_edgeShape:{var s=e instanceof i?e:null;this.m_vertices=new Vector(2,true);this.m_vertices[0]=s.m_v1;this.m_vertices[1]=s.m_v2;this.m_count=2;this.m_radius=s.m_radius}break;default:l.b2Assert(false)}};C.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return e};C.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_count;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return this.m_vertices[e]};C.prototype.GetVertexCount=function(){return this.m_count};C.prototype.GetVertex=function(t){if(t===undefined)t=0;l.b2Assert(0<=t&&t<this.m_count);return this.m_vertices[t]};T.b2DynamicTree=function(){};T.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};T.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();var n=l.b2_aabbExtension;var r=l.b2_aabbExtension;i.aabb.lowerBound.x=t.lowerBound.x-n;i.aabb.lowerBound.y=t.lowerBound.y-r;i.aabb.upperBound.x=t.upperBound.x+n;i.aabb.upperBound.y=t.upperBound.y+r;i.userData=e;this.InsertLeaf(i);return i};T.prototype.DestroyProxy=function(t){this.RemoveLeaf(t);this.FreeNode(t)};T.prototype.MoveProxy=function(t,e,i){l.b2Assert(t.IsLeaf());if(t.aabb.Contains(e)){return false}this.RemoveLeaf(t);var n=l.b2_aabbExtension+l.b2_aabbMultiplier*(i.x>0?i.x:-i.x);var r=l.b2_aabbExtension+l.b2_aabbMultiplier*(i.y>0?i.y:-i.y);t.aabb.lowerBound.x=e.lowerBound.x-n;t.aabb.lowerBound.y=e.lowerBound.y-r;t.aabb.upperBound.x=e.upperBound.x+n;t.aabb.upperBound.y=e.upperBound.y+r;this.InsertLeaf(t);return true};T.prototype.Rebalance=function(t){if(t===undefined)t=0;if(this.m_root==null)return;for(var e=0;e<t;e++){var i=this.m_root;var n=0;while(i.IsLeaf()==false){i=this.m_path>>n&1?i.child2:i.child1;n=n+1&31}++this.m_path;this.RemoveLeaf(i);this.InsertLeaf(i)}};T.prototype.GetFatAABB=function(t){return t.aabb};T.prototype.GetUserData=function(t){return t.userData};T.prototype.Query=function(t,e){if(this.m_root==null)return;var i=new Vector;var n=0;i[n++]=this.m_root;while(n>0){var r=i[--n];if(r.aabb.TestOverlap(e)){if(r.IsLeaf()){var a=t(r);if(!a)return}else{i[n++]=r.child1;i[n++]=r.child2}}}};T.prototype.RayCast=function(t,e){if(this.m_root==null)return;var i=e.p1;var n=e.p2;var r=c.SubtractVV(i,n);r.Normalize();var a=c.CrossFV(1,r);var o=c.AbsV(a);var s=e.maxFraction;var l=new y;var h=0;var u=0;{h=i.x+s*(n.x-i.x);u=i.y+s*(n.y-i.y);l.lowerBound.x=Math.min(i.x,h);l.lowerBound.y=Math.min(i.y,u);l.upperBound.x=Math.max(i.x,h);l.upperBound.y=Math.max(i.y,u)}var p=new Vector;var f=0;p[f++]=this.m_root;while(f>0){var m=p[--f];if(m.aabb.TestOverlap(l)==false){continue}var d=m.aabb.GetCenter();var v=m.aabb.GetExtents();var g=Math.abs(a.x*(i.x-d.x)+a.y*(i.y-d.y))-o.x*v.x-o.y*v.y;if(g>0)continue;if(m.IsLeaf()){var _=new B;_.p1=e.p1;_.p2=e.p2;_.maxFraction=e.maxFraction;s=t(_,m);if(s==0)return;if(s>0){h=i.x+s*(n.x-i.x);u=i.y+s*(n.y-i.y);l.lowerBound.x=Math.min(i.x,h);l.lowerBound.y=Math.min(i.y,u);l.upperBound.x=Math.max(i.x,h);l.upperBound.y=Math.max(i.y,u)}}else{p[f++]=m.child1;p[f++]=m.child2}}};T.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;this.m_freeList=t.parent;t.parent=null;t.child1=null;t.child2=null;return t}return new U};T.prototype.FreeNode=function(t){t.parent=this.m_freeList;this.m_freeList=t};T.prototype.InsertLeaf=function(t){++this.m_insertionCount;if(this.m_root==null){this.m_root=t;this.m_root.parent=null;return}var e=t.aabb.GetCenter();var i=this.m_root;if(i.IsLeaf()==false){do{var n=i.child1;var r=i.child2;var a=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y);var o=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-e.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-e.y);if(a<o){i=n}else{i=r}}while(i.IsLeaf()==false)}var s=i.parent;var l=this.AllocateNode();l.parent=s;l.userData=null;l.aabb.Combine(t.aabb,i.aabb);if(s){if(i.parent.child1==i){s.child1=l}else{s.child2=l}l.child1=i;l.child2=t;i.parent=l;t.parent=l;do{if(s.aabb.Contains(l.aabb))break;s.aabb.Combine(s.child1.aabb,s.child2.aabb);l=s;s=s.parent}while(s)}else{l.child1=i;l.child2=t;i.parent=l;t.parent=l;this.m_root=l}};T.prototype.RemoveLeaf=function(t){if(t==this.m_root){this.m_root=null;return}var e=t.parent;var i=e.parent;var n;if(e.child1==t){n=e.child2}else{n=e.child1}if(i){if(i.child1==e){i.child1=n}else{i.child2=n}n.parent=i;this.FreeNode(e);while(i){var r=i.aabb;i.aabb=y.Combine(i.child1.aabb,i.child2.aabb);if(r.Contains(i.aabb))break;i=i.parent}}else{this.m_root=n;n.parent=null;this.FreeNode(e)}};D.b2DynamicTreeBroadPhase=function(){this.m_tree=new T;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};D.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);++this.m_proxyCount;this.BufferMove(i);return i};D.prototype.DestroyProxy=function(t){this.UnBufferMove(t);--this.m_proxyCount;this.m_tree.DestroyProxy(t)};D.prototype.MoveProxy=function(t,e,i){var n=this.m_tree.MoveProxy(t,e,i);if(n){this.BufferMove(t)}};D.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t);var n=this.m_tree.GetFatAABB(e);return i.TestOverlap(n)};D.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)};D.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)};D.prototype.GetProxyCount=function(){return this.m_proxyCount};D.prototype.UpdatePairs=function(t){var e=this;e.m_pairCount=0;var i=0,n;for(i=0;i<e.m_moveBuffer.length;++i){n=e.m_moveBuffer[i];function r(t){if(t==n)return true;if(e.m_pairCount==e.m_pairBuffer.length){e.m_pairBuffer[e.m_pairCount]=new A}var i=e.m_pairBuffer[e.m_pairCount];i.proxyA=t<n?t:n;i.proxyB=t>=n?t:n;++e.m_pairCount;return true}var a=e.m_tree.GetFatAABB(n);e.m_tree.Query(r,a)}e.m_moveBuffer.length=0;for(var i=0;i<e.m_pairCount;){var o=e.m_pairBuffer[i];var s=e.m_tree.GetUserData(o.proxyA);var l=e.m_tree.GetUserData(o.proxyB);t(s,l);++i;while(i<e.m_pairCount){var h=e.m_pairBuffer[i];if(h.proxyA!=o.proxyA||h.proxyB!=o.proxyB){break}++i}}};D.prototype.Query=function(t,e){this.m_tree.Query(t,e)};D.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)};D.prototype.Validate=function(){};D.prototype.Rebalance=function(t){if(t===undefined)t=0;this.m_tree.Rebalance(t)};D.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t};D.prototype.UnBufferMove=function(t){var e=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(e,1)};D.prototype.ComparePairs=function(t,e){return 0};D.__implements={};D.__implements[J]=true;U.b2DynamicTreeNode=function(){this.aabb=new y};U.prototype.IsLeaf=function(){return this.child1==null};A.b2DynamicTreePair=function(){};E.b2Manifold=function(){this.m_pointCount=0};E.prototype.b2Manifold=function(){this.m_points=new Vector(l.b2_maxManifoldPoints);for(var t=0;t<l.b2_maxManifoldPoints;t++){this.m_points[t]=new M}this.m_localPlaneNormal=new m;this.m_localPoint=new m};E.prototype.Reset=function(){for(var t=0;t<l.b2_maxManifoldPoints;t++){(this.m_points[t]instanceof M?this.m_points[t]:null).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};E.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<l.b2_maxManifoldPoints;e++){(this.m_points[e]instanceof M?this.m_points[e]:null).Set(t.m_points[e])}this.m_localPlaneNormal.SetV(t.m_localPlaneNormal);this.m_localPoint.SetV(t.m_localPoint);this.m_type=t.m_type};E.prototype.Copy=function(){var t=new E;t.Set(this);return t};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});M.b2ManifoldPoint=function(){this.m_localPoint=new m;this.m_id=new I};M.prototype.b2ManifoldPoint=function(){this.Reset()};M.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};M.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint);this.m_normalImpulse=t.m_normalImpulse;this.m_tangentImpulse=t.m_tangentImpulse;this.m_id.Set(t.m_id)};P.b2Point=function(){this.p=new m};P.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;return this.p};P.prototype.GetFirstVertex=function(t){return this.p};B.b2RayCastInput=function(){this.p1=new m;this.p2=new m};B.prototype.b2RayCastInput=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=1;if(t)this.p1.SetV(t);if(e)this.p2.SetV(e);this.maxFraction=i};L.b2RayCastOutput=function(){this.normal=new m};R.b2Segment=function(){this.p1=new m;this.p2=new m};R.prototype.TestSegment=function(t,e,i,n){if(n===undefined)n=0;var r=i.p1;var a=i.p2.x-r.x;var o=i.p2.y-r.y;var s=this.p2.x-this.p1.x;var l=this.p2.y-this.p1.y;var h=l;var u=-s;var c=100*Box2D.MIN_VALUE;var p=-(a*h+o*u);if(p>c){var f=r.x-this.p1.x;var m=r.y-this.p1.y;var d=f*h+m*u;if(0<=d&&d<=n*p){var y=-a*m+o*f;if(-c*p<=y&&y<=p*(1+c)){d/=p;var v=Math.sqrt(h*h+u*u);h/=v;u/=v;t[0]=d;e.Set(h,u);return true}}}return false};R.prototype.Extend=function(t){this.ExtendForward(t);this.ExtendBackward(t)};R.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x;var i=this.p2.y-this.p1.y;var n=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:e<0?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:i<0?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*n;this.p2.y=this.p1.y+i*n};R.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x;var i=-this.p2.y+this.p1.y;var n=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:e<0?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:i<0?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*n;this.p1.y=this.p2.y+i*n};O.b2SeparationFunction=function(){this.m_localPoint=new m;this.m_axis=new m};O.prototype.Initialize=function(t,e,i,n,r){this.m_proxyA=e;this.m_proxyB=n;var a=parseInt(t.count);l.b2Assert(0<a&&a<3);var o;var s;var h;var u;var p;var f;var d=0;var y=0;var v=0;var g=0;var _=0;var I=0;var x;var w;var S=0;var b=0;if(a==1){this.m_type=O.e_points;o=this.m_proxyA.GetVertex(t.indexA[0]);u=this.m_proxyB.GetVertex(t.indexB[0]);w=o;x=i.R;d=i.position.x+(x.col1.x*w.x+x.col2.x*w.y);y=i.position.y+(x.col1.y*w.x+x.col2.y*w.y);w=u;x=r.R;v=r.position.x+(x.col1.x*w.x+x.col2.x*w.y);g=r.position.y+(x.col1.y*w.x+x.col2.y*w.y);this.m_axis.x=v-d;this.m_axis.y=g-y;this.m_axis.Normalize()}else if(t.indexB[0]==t.indexB[1]){this.m_type=O.e_faceA;s=this.m_proxyA.GetVertex(t.indexA[0]);h=this.m_proxyA.GetVertex(t.indexA[1]);u=this.m_proxyB.GetVertex(t.indexB[0]);this.m_localPoint.x=.5*(s.x+h.x);this.m_localPoint.y=.5*(s.y+h.y);this.m_axis=c.CrossVF(c.SubtractVV(h,s),1);this.m_axis.Normalize();w=this.m_axis;x=i.R;_=x.col1.x*w.x+x.col2.x*w.y;I=x.col1.y*w.x+x.col2.y*w.y;w=this.m_localPoint;x=i.R;d=i.position.x+(x.col1.x*w.x+x.col2.x*w.y);y=i.position.y+(x.col1.y*w.x+x.col2.y*w.y);w=u;x=r.R;v=r.position.x+(x.col1.x*w.x+x.col2.x*w.y);g=r.position.y+(x.col1.y*w.x+x.col2.y*w.y);S=(v-d)*_+(g-y)*I;if(S<0){this.m_axis.NegativeSelf()}}else if(t.indexA[0]==t.indexA[0]){this.m_type=O.e_faceB;p=this.m_proxyB.GetVertex(t.indexB[0]);f=this.m_proxyB.GetVertex(t.indexB[1]);o=this.m_proxyA.GetVertex(t.indexA[0]);this.m_localPoint.x=.5*(p.x+f.x);this.m_localPoint.y=.5*(p.y+f.y);this.m_axis=c.CrossVF(c.SubtractVV(f,p),1);this.m_axis.Normalize();w=this.m_axis;x=r.R;_=x.col1.x*w.x+x.col2.x*w.y;I=x.col1.y*w.x+x.col2.y*w.y;w=this.m_localPoint;x=r.R;v=r.position.x+(x.col1.x*w.x+x.col2.x*w.y);g=r.position.y+(x.col1.y*w.x+x.col2.y*w.y);w=o;x=i.R;d=i.position.x+(x.col1.x*w.x+x.col2.x*w.y);y=i.position.y+(x.col1.y*w.x+x.col2.y*w.y);S=(d-v)*_+(y-g)*I;if(S<0){this.m_axis.NegativeSelf()}}else{s=this.m_proxyA.GetVertex(t.indexA[0]);h=this.m_proxyA.GetVertex(t.indexA[1]);p=this.m_proxyB.GetVertex(t.indexB[0]);f=this.m_proxyB.GetVertex(t.indexB[1]);var C=c.MulX(i,o);var T=c.MulMV(i.R,c.SubtractVV(h,s));var D=c.MulX(r,u);var U=c.MulMV(r.R,c.SubtractVV(f,p));var A=T.x*T.x+T.y*T.y;var E=U.x*U.x+U.y*U.y;var M=c.SubtractVV(U,T);var P=T.x*M.x+T.y*M.y;var B=U.x*M.x+U.y*M.y;var L=T.x*U.x+T.y*U.y;var R=A*E-L*L;S=0;if(R!=0){S=c.Clamp((L*B-P*E)/R,0,1)}var V=(L*S+B)/E;if(V<0){V=0;S=c.Clamp((L-P)/A,0,1)}o=new m;o.x=s.x+S*(h.x-s.x);o.y=s.y+S*(h.y-s.y);u=new m;u.x=p.x+S*(f.x-p.x);u.y=p.y+S*(f.y-p.y);if(S==0||S==1){this.m_type=O.e_faceB;this.m_axis=c.CrossVF(c.SubtractVV(f,p),1);this.m_axis.Normalize();this.m_localPoint=u;w=this.m_axis;x=r.R;_=x.col1.x*w.x+x.col2.x*w.y;I=x.col1.y*w.x+x.col2.y*w.y;w=this.m_localPoint;x=r.R;v=r.position.x+(x.col1.x*w.x+x.col2.x*w.y);g=r.position.y+(x.col1.y*w.x+x.col2.y*w.y);w=o;x=i.R;d=i.position.x+(x.col1.x*w.x+x.col2.x*w.y);y=i.position.y+(x.col1.y*w.x+x.col2.y*w.y);b=(d-v)*_+(y-g)*I;if(S<0){this.m_axis.NegativeSelf()}}else{this.m_type=O.e_faceA;this.m_axis=c.CrossVF(c.SubtractVV(h,s),1);this.m_localPoint=o;w=this.m_axis;x=i.R;_=x.col1.x*w.x+x.col2.x*w.y;I=x.col1.y*w.x+x.col2.y*w.y;w=this.m_localPoint;x=i.R;d=i.position.x+(x.col1.x*w.x+x.col2.x*w.y);y=i.position.y+(x.col1.y*w.x+x.col2.y*w.y);w=u;x=r.R;v=r.position.x+(x.col1.x*w.x+x.col2.x*w.y);g=r.position.y+(x.col1.y*w.x+x.col2.y*w.y);b=(v-d)*_+(g-y)*I;if(S<0){this.m_axis.NegativeSelf()}}}};O.prototype.Evaluate=function(t,e){var i;var n;var r;var a;var o;var s;var h=0;var u;switch(this.m_type){case O.e_points:{i=c.MulTMV(t.R,this.m_axis);n=c.MulTMV(e.R,this.m_axis.GetNegative());r=this.m_proxyA.GetSupportVertex(i);a=this.m_proxyB.GetSupportVertex(n);o=c.MulX(t,r);s=c.MulX(e,a);h=(s.x-o.x)*this.m_axis.x+(s.y-o.y)*this.m_axis.y;return h}case O.e_faceA:{u=c.MulMV(t.R,this.m_axis);o=c.MulX(t,this.m_localPoint);n=c.MulTMV(e.R,u.GetNegative());a=this.m_proxyB.GetSupportVertex(n);s=c.MulX(e,a);h=(s.x-o.x)*u.x+(s.y-o.y)*u.y;return h}case O.e_faceB:{u=c.MulMV(e.R,this.m_axis);s=c.MulX(e,this.m_localPoint);i=c.MulTMV(t.R,u.GetNegative());r=this.m_proxyA.GetSupportVertex(i);o=c.MulX(t,r);h=(o.x-s.x)*u.x+(o.y-s.y)*u.y;return h}default:l.b2Assert(false);return 0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});V.b2Simplex=function(){this.m_v1=new k;this.m_v2=new k;this.m_v3=new k;this.m_vertices=new Vector(3)};V.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};V.prototype.ReadCache=function(t,e,i,n,r){l.b2Assert(0<=t.count&&t.count<=3);var a;var o;this.m_count=t.count;var s=this.m_vertices;for(var h=0;h<this.m_count;h++){var u=s[h];u.indexA=t.indexA[h];u.indexB=t.indexB[h];a=e.GetVertex(u.indexA);o=n.GetVertex(u.indexB);u.wA=c.MulX(i,a);u.wB=c.MulX(r,o);u.w=c.SubtractVV(u.wB,u.wA);u.a=0}if(this.m_count>1){var p=t.metric;var f=this.GetMetric();if(f<.5*p||2*p<f||f<Box2D.MIN_VALUE){this.m_count=0}}if(this.m_count==0){u=s[0];u.indexA=0;u.indexB=0;a=e.GetVertex(0);o=n.GetVertex(0);u.wA=c.MulX(i,a);u.wB=c.MulX(r,o);u.w=c.SubtractVV(u.wB,u.wA);this.m_count=1}};V.prototype.WriteCache=function(t){t.metric=this.GetMetric();t.count=Box2D.parseUInt(this.m_count);var e=this.m_vertices;for(var i=0;i<this.m_count;i++){t.indexA[i]=Box2D.parseUInt(e[i].indexA);t.indexB[i]=Box2D.parseUInt(e[i].indexB)}};V.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:{var t=c.SubtractVV(this.m_v2.w,this.m_v1.w);var e=c.CrossVV(t,this.m_v1.w.GetNegative());if(e>0){return c.CrossFV(1,t)}else{return c.CrossVF(t,1)}}default:l.b2Assert(false);return new m}};V.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:l.b2Assert(false);return new m;case 1:return this.m_v1.w;case 2:return new m(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:l.b2Assert(false);return new m}};V.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:l.b2Assert(false);break;case 1:t.SetV(this.m_v1.wA);e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:l.b2Assert(false);break}};V.prototype.GetMetric=function(){switch(this.m_count){case 0:l.b2Assert(false);return 0;case 1:return 0;case 2:return c.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return c.CrossVV(c.SubtractVV(this.m_v2.w,this.m_v1.w),c.SubtractVV(this.m_v3.w,this.m_v1.w));default:l.b2Assert(false);return 0}};V.prototype.Solve2=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=c.SubtractVV(e,t);var n=-(t.x*i.x+t.y*i.y);if(n<=0){this.m_v1.a=1;this.m_count=1;return}var r=e.x*i.x+e.y*i.y;if(r<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}var a=1/(r+n);this.m_v1.a=r*a;this.m_v2.a=n*a;this.m_count=2};V.prototype.Solve3=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=this.m_v3.w;var n=c.SubtractVV(e,t);var r=c.Dot(t,n);var a=c.Dot(e,n);var o=a;var s=-r;var l=c.SubtractVV(i,t);var h=c.Dot(t,l);var u=c.Dot(i,l);var p=u;var f=-h;var m=c.SubtractVV(i,e);var d=c.Dot(e,m);var y=c.Dot(i,m);var v=y;var g=-d;var _=c.CrossVV(n,l);var I=_*c.CrossVV(e,i);var x=_*c.CrossVV(i,t);var w=_*c.CrossVV(t,e);if(s<=0&&f<=0){this.m_v1.a=1;this.m_count=1;return}if(o>0&&s>0&&w<=0){var S=1/(o+s);this.m_v1.a=o*S;this.m_v2.a=s*S;this.m_count=2;return}if(p>0&&f>0&&x<=0){var b=1/(p+f);this.m_v1.a=p*b;this.m_v3.a=f*b;this.m_count=2;this.m_v2.Set(this.m_v3);return}if(o<=0&&g<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}if(p<=0&&v<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3);return}if(v>0&&g>0&&I<=0){var C=1/(v+g);this.m_v2.a=v*C;this.m_v3.a=g*C;this.m_count=2;this.m_v1.Set(this.m_v3);return}var T=1/(I+x+w);this.m_v1.a=I*T;this.m_v2.a=x*T;this.m_v3.a=w*T;this.m_count=3};F.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};k.b2SimplexVertex=function(){};k.prototype.Set=function(t){this.wA.SetV(t.wA);this.wB.SetV(t.wB);this.w.SetV(t.w);this.a=t.a;this.indexA=t.indexA;this.indexB=t.indexB};N.b2TimeOfImpact=function(){};N.TimeOfImpact=function(t){++N.b2_toiCalls;var e=t.proxyA;var i=t.proxyB;var n=t.sweepA;var r=t.sweepB;l.b2Assert(n.t0==r.t0);l.b2Assert(1-n.t0>Box2D.MIN_VALUE);var a=e.m_radius+i.m_radius;var o=t.tolerance;var s=0;var h=1e3;var u=0;var p=0;N.s_cache.count=0;N.s_distanceInput.useRadii=false;for(;;){n.GetTransform(N.s_xfA,s);r.GetTransform(N.s_xfB,s);N.s_distanceInput.proxyA=e;N.s_distanceInput.proxyB=i;N.s_distanceInput.transformA=N.s_xfA;N.s_distanceInput.transformB=N.s_xfB;w.Distance(N.s_distanceOutput,N.s_cache,N.s_distanceInput);if(N.s_distanceOutput.distance<=0){s=1;break}N.s_fcn.Initialize(N.s_cache,e,N.s_xfA,i,N.s_xfB);var f=N.s_fcn.Evaluate(N.s_xfA,N.s_xfB);if(f<=0){s=1;break}if(u==0){if(f>a){p=c.Max(a-o,.75*a)}else{p=c.Max(f-o,.02*a)}}if(f-p<.5*o){if(u==0){s=1;break}break}var m=s;{var d=s;var y=1;var v=f;n.GetTransform(N.s_xfA,y);r.GetTransform(N.s_xfB,y);var g=N.s_fcn.Evaluate(N.s_xfA,N.s_xfB);if(g>=p){s=1;break}var _=0;for(;;){var I=0;if(_&1){I=d+(p-v)*(y-d)/(g-v)}else{I=.5*(d+y)}n.GetTransform(N.s_xfA,I);r.GetTransform(N.s_xfB,I);var x=N.s_fcn.Evaluate(N.s_xfA,N.s_xfB);if(c.Abs(x-p)<.025*o){m=I;break}if(x>p){d=I;v=x}else{y=I;g=x}++_;++N.b2_toiRootIters;if(_==50){break}}N.b2_toiMaxRootIters=c.Max(N.b2_toiMaxRootIters,_)}if(m<(1+100*Box2D.MIN_VALUE)*s){break}s=m;u++;++N.b2_toiIters;if(u==h){break}}N.b2_toiMaxIters=c.Max(N.b2_toiMaxIters,u);return s};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new F;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new S;Box2D.Collision.b2TimeOfImpact.s_xfA=new f;Box2D.Collision.b2TimeOfImpact.s_xfB=new f;Box2D.Collision.b2TimeOfImpact.s_fcn=new O;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new b});G.b2TOIInput=function(){this.proxyA=new C;this.proxyB=new C;this.sweepA=new p;this.sweepB=new p};W.b2WorldManifold=function(){this.m_normal=new m};W.prototype.b2WorldManifold=function(){this.m_points=new Vector(l.b2_maxManifoldPoints);for(var t=0;t<l.b2_maxManifoldPoints;t++){this.m_points[t]=new m}};W.prototype.Initialize=function(t,e,i,n,r){if(i===undefined)i=0;if(r===undefined)r=0;if(t.m_pointCount==0){return}var a=0;var o;var s;var l=0;var h=0;var u=0;var c=0;var p=0;var f=0;switch(t.m_type){case E.e_circles:{s=e.R;o=t.m_localPoint;var m=e.position.x+s.col1.x*o.x+s.col2.x*o.y;var d=e.position.y+s.col1.y*o.x+s.col2.y*o.y;s=n.R;o=t.m_points[0].m_localPoint;var y=n.position.x+s.col1.x*o.x+s.col2.x*o.y;var v=n.position.y+s.col1.y*o.x+s.col2.y*o.y;var g=y-m;var _=v-d;var I=g*g+_*_;if(I>Box2D.MIN_VALUE*Box2D.MIN_VALUE){var x=Math.sqrt(I);this.m_normal.x=g/x;this.m_normal.y=_/x}else{this.m_normal.x=1;this.m_normal.y=0}var w=m+i*this.m_normal.x;var S=d+i*this.m_normal.y;var b=y-r*this.m_normal.x;var C=v-r*this.m_normal.y;this.m_points[0].x=.5*(w+b);this.m_points[0].y=.5*(S+C)}break;case E.e_faceA:{s=e.R;o=t.m_localPlaneNormal;l=s.col1.x*o.x+s.col2.x*o.y;h=s.col1.y*o.x+s.col2.y*o.y;s=e.R;o=t.m_localPoint;u=e.position.x+s.col1.x*o.x+s.col2.x*o.y;c=e.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_normal.x=l;this.m_normal.y=h;for(a=0;a<t.m_pointCount;a++){s=n.R;o=t.m_points[a].m_localPoint;p=n.position.x+s.col1.x*o.x+s.col2.x*o.y;f=n.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_points[a].x=p+.5*(i-(p-u)*l-(f-c)*h-r)*l;this.m_points[a].y=f+.5*(i-(p-u)*l-(f-c)*h-r)*h}}break;case E.e_faceB:{s=n.R;o=t.m_localPlaneNormal;l=s.col1.x*o.x+s.col2.x*o.y;h=s.col1.y*o.x+s.col2.y*o.y;s=n.R;o=t.m_localPoint;u=n.position.x+s.col1.x*o.x+s.col2.x*o.y;c=n.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_normal.x=-l;this.m_normal.y=-h;for(a=0;a<t.m_pointCount;a++){s=e.R;o=t.m_points[a].m_localPoint;p=e.position.x+s.col1.x*o.x+s.col2.x*o.y;f=e.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_points[a].x=p+.5*(r-(p-u)*l-(f-c)*h-i)*l;this.m_points[a].y=f+.5*(r-(p-u)*l-(f-c)*h-i)*h}}break}};H.ClipVertex=function(){this.v=new m;this.id=new I};H.prototype.Set=function(t){this.v.SetV(t.v);this.id.Set(t.id)};X.Features=function(){};Object.defineProperty(X.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(X.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._referenceEdge=t;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(X.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(X.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentEdge=t;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(X.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(X.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentVertex=t;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(X.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(X.prototype,"flip",{enumerable:false,
configurable:true,set:function(t){if(t===undefined)t=0;this._flip=t;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Collision.Shapes.b2CircleShape,r=Box2D.Collision.Shapes.b2EdgeChainDef,a=Box2D.Collision.Shapes.b2EdgeShape,o=Box2D.Collision.Shapes.b2MassData,s=Box2D.Collision.Shapes.b2PolygonShape,l=Box2D.Collision.Shapes.b2Shape,h=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,p=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,m=Box2D.Common.Math.b2Vec2,d=Box2D.Common.Math.b2Vec3,y=Box2D.Dynamics.b2Body,v=Box2D.Dynamics.b2BodyDef,g=Box2D.Dynamics.b2ContactFilter,_=Box2D.Dynamics.b2ContactImpulse,I=Box2D.Dynamics.b2ContactListener,x=Box2D.Dynamics.b2ContactManager,w=Box2D.Dynamics.b2DebugDraw,S=Box2D.Dynamics.b2DestructionListener,b=Box2D.Dynamics.b2FilterData,C=Box2D.Dynamics.b2Fixture,T=Box2D.Dynamics.b2FixtureDef,D=Box2D.Dynamics.b2Island,U=Box2D.Dynamics.b2TimeStep,A=Box2D.Dynamics.b2World,E=Box2D.Collision.b2AABB,M=Box2D.Collision.b2Bound,P=Box2D.Collision.b2BoundValues,B=Box2D.Collision.b2Collision,L=Box2D.Collision.b2ContactID,R=Box2D.Collision.b2ContactPoint,O=Box2D.Collision.b2Distance,V=Box2D.Collision.b2DistanceInput,F=Box2D.Collision.b2DistanceOutput,k=Box2D.Collision.b2DistanceProxy,N=Box2D.Collision.b2DynamicTree,G=Box2D.Collision.b2DynamicTreeBroadPhase,W=Box2D.Collision.b2DynamicTreeNode,H=Box2D.Collision.b2DynamicTreePair,X=Box2D.Collision.b2Manifold,J=Box2D.Collision.b2ManifoldPoint,Y=Box2D.Collision.b2Point,z=Box2D.Collision.b2RayCastInput,j=Box2D.Collision.b2RayCastOutput,K=Box2D.Collision.b2Segment,q=Box2D.Collision.b2SeparationFunction,Z=Box2D.Collision.b2Simplex,Q=Box2D.Collision.b2SimplexCache,$=Box2D.Collision.b2SimplexVertex,tt=Box2D.Collision.b2TimeOfImpact,et=Box2D.Collision.b2TOIInput,it=Box2D.Collision.b2WorldManifold,nt=Box2D.Collision.ClipVertex,rt=Box2D.Collision.Features,at=Box2D.Collision.IBroadPhase;Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape);n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;n.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new m};n.prototype.Copy=function(){var t=new n;t.Set(this);return t};n.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,n)){var e=t instanceof n?t:null;this.m_p.SetV(e.m_p)}};n.prototype.TestPoint=function(t,e){var i=t.R;var n=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);n=e.x-n;r=e.y-r;return n*n+r*r<=this.m_radius*this.m_radius};n.prototype.RayCast=function(t,e,i){var n=i.R;var r=i.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);var a=i.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);var o=e.p1.x-r;var s=e.p1.y-a;var l=o*o+s*s-this.m_radius*this.m_radius;var h=e.p2.x-e.p1.x;var u=e.p2.y-e.p1.y;var c=o*h+s*u;var p=h*h+u*u;var f=c*c-p*l;if(f<0||p<Box2D.MIN_VALUE){return false}var m=-(c+Math.sqrt(f));if(0<=m&&m<=e.maxFraction*p){m/=p;t.fraction=m;t.normal.x=o+m*h;t.normal.y=s+m*u;t.normal.Normalize();return true}return false};n.prototype.ComputeAABB=function(t,e){var i=e.R;var n=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(n-this.m_radius,r-this.m_radius);t.upperBound.Set(n+this.m_radius,r+this.m_radius)};n.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=e*i.b2_pi*this.m_radius*this.m_radius;t.center.SetV(this.m_p);t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};n.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=c.MulX(i,this.m_p);var a=-(c.Dot(t,r)-e);if(a<-this.m_radius+Box2D.MIN_VALUE){return 0}if(a>this.m_radius){n.SetV(r);return Math.PI*this.m_radius*this.m_radius}var o=this.m_radius*this.m_radius;var s=a*a;var l=o*(Math.asin(a/this.m_radius)+Math.PI/2)+a*Math.sqrt(o-s);var h=-2/3*Math.pow(o-s,1.5)/l;n.x=r.x+t.x*h;n.y=r.y+t.y*h;return l};n.prototype.GetLocalPosition=function(){return this.m_p};n.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)};n.prototype.GetRadius=function(){return this.m_radius};n.prototype.SetRadius=function(t){if(t===undefined)t=0;this.m_radius=t};n.prototype.b2CircleShape=function(t){if(t===undefined)t=0;this.__super.b2Shape.call(this);this.m_type=l.e_circleShape;this.m_radius=t};r.b2EdgeChainDef=function(){};r.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(a,Box2D.Collision.Shapes.b2Shape);a.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;a.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new m;this.m_v1=new m;this.m_v2=new m;this.m_coreV1=new m;this.m_coreV2=new m;this.m_normal=new m;this.m_direction=new m;this.m_cornerDir1=new m;this.m_cornerDir2=new m};a.prototype.TestPoint=function(t,e){return false};a.prototype.Copy=function(){var t=new a(this.m_v1,this.m_v2);t.Set(this);return t};a.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,a)){var e=t instanceof a?t:null;this.s_supportVec.SetV(e.s_supportVec);this.m_v1.SetV(e.m_v1);this.m_v2.SetV(e.m_v2);this.m_coreV1.SetV(e.m_coreV1);this.m_coreV2.SetV(e.m_coreV2);this.m_normal.SetV(e.m_normal);this.m_direction.SetV(e.m_direction);this.m_cornerDir1.SetV(e.m_cornerDir1);this.m_cornerDir2.SetV(e.m_cornerDir2)}};a.prototype.RayCast=function(t,e,i){var n;var r=e.p2.x-e.p1.x;var a=e.p2.y-e.p1.y;n=i.R;var o=i.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y);var s=i.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y);var l=i.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y)-s;var h=-(i.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y)-o);var u=100*Box2D.MIN_VALUE;var c=-(r*l+a*h);if(c>u){var p=e.p1.x-o;var f=e.p1.y-s;var m=p*l+f*h;if(0<=m&&m<=e.maxFraction*c){var d=-r*f+a*p;if(-u*c<=d&&d<=c*(1+u)){m/=c;t.fraction=m;var y=Math.sqrt(l*l+h*h);t.normal.x=l/y;t.normal.y=h/y;return true}}}return false};a.prototype.ComputeAABB=function(t,e){var i=e.R;var n=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y);var r=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y);var a=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y);var o=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);if(n<a){t.lowerBound.x=n;t.upperBound.x=a}else{t.lowerBound.x=a;t.upperBound.x=n}if(r<o){t.lowerBound.y=r;t.upperBound.y=o}else{t.lowerBound.y=o;t.upperBound.y=r}};a.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=0;t.center.SetV(this.m_v1);t.I=0};a.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=new m(t.x*e,t.y*e);var a=c.MulX(i,this.m_v1);var o=c.MulX(i,this.m_v2);var s=c.Dot(t,a)-e;var l=c.Dot(t,o)-e;if(s>0){if(l>0){return 0}else{a.x=-l/(s-l)*a.x+s/(s-l)*o.x;a.y=-l/(s-l)*a.y+s/(s-l)*o.y}}else{if(l>0){o.x=-l/(s-l)*a.x+s/(s-l)*o.x;o.y=-l/(s-l)*a.y+s/(s-l)*o.y}else{}}n.x=(r.x+a.x+o.x)/3;n.y=(r.y+a.y+o.y)/3;return.5*((a.x-r.x)*(o.y-r.y)-(a.y-r.y)*(o.x-r.x))};a.prototype.GetLength=function(){return this.m_length};a.prototype.GetVertex1=function(){return this.m_v1};a.prototype.GetVertex2=function(){return this.m_v2};a.prototype.GetCoreVertex1=function(){return this.m_coreV1};a.prototype.GetCoreVertex2=function(){return this.m_coreV2};a.prototype.GetNormalVector=function(){return this.m_normal};a.prototype.GetDirectionVector=function(){return this.m_direction};a.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};a.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};a.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};a.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};a.prototype.GetFirstVertex=function(t){var e=t.R;return new m(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))};a.prototype.GetNextEdge=function(){return this.m_nextEdge};a.prototype.GetPrevEdge=function(){return this.m_prevEdge};a.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=t.R;var r=t.position.x+(n.col1.x*this.m_coreV1.x+n.col2.x*this.m_coreV1.y);var a=t.position.y+(n.col1.y*this.m_coreV1.x+n.col2.y*this.m_coreV1.y);var o=t.position.x+(n.col1.x*this.m_coreV2.x+n.col2.x*this.m_coreV2.y);var s=t.position.y+(n.col1.y*this.m_coreV2.x+n.col2.y*this.m_coreV2.y);if(r*e+a*i>o*e+s*i){this.s_supportVec.x=r;this.s_supportVec.y=a}else{this.s_supportVec.x=o;this.s_supportVec.y=s}return this.s_supportVec};a.prototype.b2EdgeShape=function(t,e){this.__super.b2Shape.call(this);this.m_type=l.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=t;this.m_v2=e;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-i.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-i.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-i.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-i.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};a.prototype.SetPrevEdge=function(t,e,i,n){this.m_prevEdge=t;this.m_coreV1=e;this.m_cornerDir1=i;this.m_cornerConvex1=n};a.prototype.SetNextEdge=function(t,e,i,n){this.m_nextEdge=t;this.m_coreV2=e;this.m_cornerDir2=i;this.m_cornerConvex2=n};a.prototype.Copy=function(){var t=new a(this.m_v1,this.m_v2);return t};o.b2MassData=function(){this.mass=0;this.center=new m(0,0);this.I=0};Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape);s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;s.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};s.prototype.Copy=function(){var t=new s;t.Set(this);return t};s.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,s)){var e=t instanceof s?t:null;this.m_centroid.SetV(e.m_centroid);this.m_vertexCount=e.m_vertexCount;this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++){this.m_vertices[i].SetV(e.m_vertices[i]);this.m_normals[i].SetV(e.m_normals[i])}}};s.prototype.SetAsArray=function(t,e){if(e===undefined)e=0;var i=new Vector;var n=0,r;for(n=0;n<t.length;++n){r=t[n];i.push(r)}this.SetAsVector(i,e)};s.AsArray=function(t,e){if(e===undefined)e=0;var i=new s;i.SetAsArray(t,e);return i};s.prototype.SetAsVector=function(t,e){if(e===undefined)e=0;if(e==0)e=t.length;i.b2Assert(2<=e);this.m_vertexCount=e;this.Reserve(e);var n=0;var r=t[0].x;for(var a=1;a<e;a++){var o=t[a].x;if(o>r||o==r&&t[a].y<t[n].y){n=a;r=o}}var l=[];var h=0;var u=n;while(true){l[h]=u;var p=0;for(var f=1;f<e;f++){if(p==u){p=f;continue}var m=c.SubtractVV(t[p],t[l[h]]);var d=c.SubtractVV(t[f],t[l[h]]);var y=c.CrossVV(m,d);if(y<0){p=f}if(y==0&&d.LengthSquared()>m.LengthSquared()){p=f}}++h;u=p;if(p==n){break}}if(h<3){console.error("vertices is less then 3");this.SetAsBox(1,1);return}if(h<this.m_vertexCount){console.error("some vertices have to be abandomed")}this.m_vertexCount=h;var a=0;for(a=0;a<this.m_vertexCount;a++){this.m_vertices[a].SetV(t[l[a]])}for(a=0;a<this.m_vertexCount;++a){var v=parseInt(a);var g=parseInt(a+1<this.m_vertexCount?a+1:0);var _=c.SubtractVV(this.m_vertices[g],this.m_vertices[v]);i.b2Assert(_.LengthSquared()>Box2D.MIN_VALUE);this.m_normals[a].SetV(c.CrossVF(_,1));this.m_normals[a].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)};s.AsVector=function(t,e){if(e===undefined)e=0;var i=new s;i.SetAsVector(t,e);return i};s.prototype.SetAsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};s.AsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=new s;i.SetAsBox(t,e);return i};s.prototype.SetAsOrientedBox=function(t,e,i,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(n===undefined)n=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=i;var r=new f;r.position=i;r.R.Set(n);for(var a=0;a<this.m_vertexCount;++a){this.m_vertices[a]=c.MulX(r,this.m_vertices[a]);this.m_normals[a]=c.MulMV(r.R,this.m_normals[a])}};s.AsOrientedBox=function(t,e,i,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(n===undefined)n=0;var r=new s;r.SetAsOrientedBox(t,e,i,n);return r};s.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(t);this.m_vertices[1].SetV(e);this.m_centroid.x=.5*(t.x+e.x);this.m_centroid.y=.5*(t.y+e.y);this.m_normals[0]=c.CrossVF(c.SubtractVV(e,t),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};s.AsEdge=function(t,e){var i=new s;i.SetAsEdge(t,e);return i};s.prototype.TestPoint=function(t,e){var i;var n=t.R;var r=e.x-t.position.x;var a=e.y-t.position.y;var o=r*n.col1.x+a*n.col1.y;var s=r*n.col2.x+a*n.col2.y;for(var l=0;l<this.m_vertexCount;++l){i=this.m_vertices[l];r=o-i.x;a=s-i.y;i=this.m_normals[l];var h=i.x*r+i.y*a;if(h>0){return false}}return true};s.prototype.RayCast=function(t,e,i){var n=0;var r=e.maxFraction;var a=0;var o=0;var s;var l;a=e.p1.x-i.position.x;o=e.p1.y-i.position.y;s=i.R;var h=a*s.col1.x+o*s.col1.y;var u=a*s.col2.x+o*s.col2.y;a=e.p2.x-i.position.x;o=e.p2.y-i.position.y;s=i.R;var c=a*s.col1.x+o*s.col1.y;var p=a*s.col2.x+o*s.col2.y;var f=c-h;var m=p-u;var d=parseInt(-1);for(var y=0;y<this.m_vertexCount;++y){l=this.m_vertices[y];a=l.x-h;o=l.y-u;l=this.m_normals[y];var v=l.x*a+l.y*o;var g=l.x*f+l.y*m;if(g==0){if(v<0){return false}}else{if(g<0&&v<n*g){n=v/g;d=y}else if(g>0&&v<r*g){r=v/g}}if(r<n-Box2D.MIN_VALUE){return false}}if(d>=0){t.fraction=n;s=i.R;l=this.m_normals[d];t.normal.x=s.col1.x*l.x+s.col2.x*l.y;t.normal.y=s.col1.y*l.x+s.col2.y*l.y;return true}return false};s.prototype.ComputeAABB=function(t,e){var i=e.R;var n=this.m_vertices[0];var r=e.position.x+(i.col1.x*n.x+i.col2.x*n.y);var a=e.position.y+(i.col1.y*n.x+i.col2.y*n.y);var o=r;var s=a;for(var l=1;l<this.m_vertexCount;++l){n=this.m_vertices[l];var h=e.position.x+(i.col1.x*n.x+i.col2.x*n.y);var u=e.position.y+(i.col1.y*n.x+i.col2.y*n.y);r=r<h?r:h;a=a<u?a:u;o=o>h?o:h;s=s>u?s:u}t.lowerBound.x=r-this.m_radius;t.lowerBound.y=a-this.m_radius;t.upperBound.x=o+this.m_radius;t.upperBound.y=s+this.m_radius};s.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;if(this.m_vertexCount==2){t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);t.mass=0;t.I=0;return}var i=0;var n=0;var r=0;var a=0;var o=0;var s=0;var l=1/3;for(var h=0;h<this.m_vertexCount;++h){var u=this.m_vertices[h];var c=h+1<this.m_vertexCount?this.m_vertices[parseInt(h+1)]:this.m_vertices[0];var p=u.x-o;var f=u.y-s;var m=c.x-o;var d=c.y-s;var y=p*d-f*m;var v=.5*y;r+=v;i+=v*l*(o+u.x+c.x);n+=v*l*(s+u.y+c.y);var g=o;var _=s;var I=p;var x=f;var w=m;var S=d;var b=l*(.25*(I*I+w*I+w*w)+(g*I+g*w))+.5*g*g;var C=l*(.25*(x*x+S*x+S*S)+(_*x+_*S))+.5*_*_;a+=y*(b+C)}t.mass=e*r;i*=1/r;n*=1/r;t.center.Set(i,n);t.I=e*a};s.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;var r=c.MulTMV(i.R,t);var a=e-c.Dot(t,i.position);var s=new Vector_a2j_Number;var l=0;var h=parseInt(-1);var u=parseInt(-1);var p=false;var f=0;for(f=0;f<this.m_vertexCount;++f){s[f]=c.Dot(r,this.m_vertices[f])-a;var d=s[f]<-Box2D.MIN_VALUE;if(f>0){if(d){if(!p){h=f-1;l++}}else{if(p){u=f-1;l++}}}p=d}switch(l){case 0:if(p){var y=new o;this.ComputeMass(y,1);n.SetV(c.MulX(i,y.center));return y.mass}else{return 0}break;case 1:if(h==-1){h=this.m_vertexCount-1}else{u=this.m_vertexCount-1}break}var v=parseInt((h+1)%this.m_vertexCount);var g=parseInt((u+1)%this.m_vertexCount);var _=(0-s[h])/(s[v]-s[h]);var I=(0-s[u])/(s[g]-s[u]);var x=new m(this.m_vertices[h].x*(1-_)+this.m_vertices[v].x*_,this.m_vertices[h].y*(1-_)+this.m_vertices[v].y*_);var w=new m(this.m_vertices[u].x*(1-I)+this.m_vertices[g].x*I,this.m_vertices[u].y*(1-I)+this.m_vertices[g].y*I);var S=0;var b=new m;var C=this.m_vertices[v];var T;f=v;while(f!=g){f=(f+1)%this.m_vertexCount;if(f==g)T=w;else T=this.m_vertices[f];var D=.5*((C.x-x.x)*(T.y-x.y)-(C.y-x.y)*(T.x-x.x));S+=D;b.x+=D*(x.x+C.x+T.x)/3;b.y+=D*(x.y+C.y+T.y)/3;C=T}b.Multiply(1/S);n.SetV(c.MulX(i,b));return S};s.prototype.GetVertexCount=function(){return this.m_vertexCount};s.prototype.GetVertices=function(){return this.m_vertices};s.prototype.GetNormals=function(){return this.m_normals};s.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return e};s.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var n=1;n<this.m_vertexCount;++n){var r=this.m_vertices[n].x*t.x+this.m_vertices[n].y*t.y;if(r>i){e=n;i=r}}return this.m_vertices[e]};s.prototype.Validate=function(){return false};s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=l.e_polygonShape;this.m_centroid=new m;this.m_vertices=new Vector;this.m_normals=new Vector};s.prototype.Reserve=function(t){if(t===undefined)t=0;for(var e=parseInt(this.m_vertices.length);e<t;e++){this.m_vertices[e]=new m;this.m_normals[e]=new m}};s.ComputeCentroid=function(t,e){if(e===undefined)e=0;var i=new m;var n=0;var r=0;var a=0;var o=1/3;for(var s=0;s<e;++s){var l=t[s];var h=s+1<e?t[parseInt(s+1)]:t[0];var u=l.x-r;var c=l.y-a;var p=h.x-r;var f=h.y-a;var d=u*f-c*p;var y=.5*d;n+=y;i.x+=y*o*(r+l.x+h.x);i.y+=y*o*(a+l.y+h.y)}i.x*=1/n;i.y*=1/n;return i};s.ComputeOBB=function(t,e,i){if(i===undefined)i=0;var n=0;var r=new Vector(i+1);for(n=0;n<i;++n){r[n]=e[n]}r[i]=r[0];var a=Number.MAX_VALUE;for(n=1;n<=i;++n){var o=r[parseInt(n-1)];var s=r[n].x-o.x;var l=r[n].y-o.y;var h=Math.sqrt(s*s+l*l);s/=h;l/=h;var u=-l;var c=s;var p=Number.MAX_VALUE;var f=Number.MAX_VALUE;var m=-Number.MAX_VALUE;var d=-Number.MAX_VALUE;for(var y=0;y<i;++y){var v=r[y].x-o.x;var g=r[y].y-o.y;var _=s*v+l*g;var I=u*v+c*g;if(_<p)p=_;if(I<f)f=I;if(_>m)m=_;if(I>d)d=I}var x=(m-p)*(d-f);if(x<.95*a){a=x;t.R.col1.x=s;t.R.col1.y=l;t.R.col2.x=u;t.R.col2.y=c;var w=.5*(p+m);var S=.5*(f+d);var b=t.R;t.center.x=o.x+(b.col1.x*w+b.col2.x*S);t.center.y=o.y+(b.col1.y*w+b.col2.y*S);t.extents.x=.5*(m-p);t.extents.y=.5*(d-f)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new h});l.b2Shape=function(){};l.prototype.Copy=function(){return null};l.prototype.Set=function(t){this.m_radius=t.m_radius};l.prototype.GetType=function(){return this.m_type};l.prototype.TestPoint=function(t,e){return false};l.prototype.RayCast=function(t,e,i){return false};l.prototype.ComputeAABB=function(t,e){};l.prototype.ComputeMass=function(t,e){if(e===undefined)e=0};l.prototype.ComputeSubmergedArea=function(t,e,i,n){if(e===undefined)e=0;return 0};l.TestOverlap=function(t,e,i,n){var r=new V;r.proxyA=new k;r.proxyA.Set(t);r.proxyB=new k;r.proxyB.Set(i);r.transformA=e;r.transformB=n;r.useRadii=true;var a=new Q;a.count=0;var o=new F;O.Distance(o,a,r);return o.distance<10*Box2D.MIN_VALUE};l.prototype.b2Shape=function(){this.m_type=l.e_unknownShape;this.m_radius=i.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,a=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,h=Box2D.Common.Math.b2Vec3;t.b2Color=function(){this._r=0;this._g=0;this._b=0};t.prototype.b2Color=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*a.Clamp(t,0,1));this._g=Box2D.parseUInt(255*a.Clamp(e,0,1));this._b=Box2D.parseUInt(255*a.Clamp(i,0,1))};t.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*a.Clamp(t,0,1));this._g=Box2D.parseUInt(255*a.Clamp(e,0,1));this._b=Box2D.parseUInt(255*a.Clamp(i,0,1))};Object.defineProperty(t.prototype,"r",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._r=Box2D.parseUInt(255*a.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"g",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._g=Box2D.parseUInt(255*a.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"b",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._b=Box2D.parseUInt(255*a.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});i.b2Settings=function(){};i.b2MixFriction=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return Math.sqrt(t*e)};i.b2MixRestitution=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};i.b2Assert=function(t){if(!t){throw"Assertion Failed"}};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*i.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi})})();(function(){var t=Box2D.Collision.b2AABB,e=Box2D.Common.b2Color,i=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,a=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,s=Box2D.Common.Math.b2Sweep,l=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,u=Box2D.Common.Math.b2Vec3;r.b2Mat22=function(){this.col1=new h;this.col2=new h};r.prototype.b2Mat22=function(){this.SetIdentity()};r.FromAngle=function(t){if(t===undefined)t=0;var e=new r;e.Set(t);return e};r.FromVV=function(t,e){var i=new r;i.SetVV(t,e);return i};r.prototype.Set=function(t){if(t===undefined)t=0;var e=Math.cos(t);var i=Math.sin(t);this.col1.x=e;this.col2.x=-i;this.col1.y=i;this.col2.y=e};r.prototype.SetVV=function(t,e){this.col1.SetV(t);this.col2.SetV(e)};r.prototype.Copy=function(){var t=new r;t.SetM(this);return t};r.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2)};r.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y};r.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};r.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};r.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};r.prototype.GetInverse=function(t){var e=this.col1.x;var i=this.col2.x;var n=this.col1.y;var r=this.col2.y;var a=e*r-i*n;if(a!=0){a=1/a}t.col1.x=a*r;t.col2.x=-a*i;t.col1.y=-a*n;t.col2.y=a*e;return t};r.prototype.Solve=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=this.col1.x;var r=this.col2.x;var a=this.col1.y;var o=this.col2.y;var s=n*o-r*a;if(s!=0){s=1/s}t.x=s*(o*e-r*i);t.y=s*(n*i-a*e);return t};r.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};a.b2Mat33=function(){this.col1=new u;this.col2=new u;this.col3=new u};a.prototype.b2Mat33=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=null;if(!t&&!e&&!i){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)}};a.prototype.SetVVV=function(t,e,i){this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)};a.prototype.Copy=function(){return new a(this.col1,this.col2,this.col3)};a.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2);this.col3.SetV(t.col3)};a.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col1.z+=t.col1.z;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y;this.col2.z+=t.col2.z;this.col3.x+=t.col3.x;this.col3.y+=t.col3.y;this.col3.z+=t.col3.z};a.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};a.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};a.prototype.Solve22=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var n=this.col1.x;var r=this.col2.x;var a=this.col1.y;var o=this.col2.y;var s=n*o-r*a;if(s!=0){s=1/s}t.x=s*(o*e-r*i);t.y=s*(n*i-a*e);return t};a.prototype.Solve33=function(t,e,i,n){if(e===undefined)e=0;if(i===undefined)i=0;if(n===undefined)n=0;var r=this.col1.x;var a=this.col1.y;var o=this.col1.z;var s=this.col2.x;var l=this.col2.y;var h=this.col2.z;var u=this.col3.x;var c=this.col3.y;var p=this.col3.z;var f=r*(l*p-h*c)+a*(h*u-s*p)+o*(s*c-l*u);if(f!=0){f=1/f}t.x=f*(e*(l*p-h*c)+i*(h*u-s*p)+n*(s*c-l*u));t.y=f*(r*(i*p-n*c)+a*(n*u-e*p)+o*(e*c-i*u));t.z=f*(r*(l*n-h*i)+a*(h*e-s*n)+o*(s*i-l*e));return t};o.b2Math=function(){};o.IsValid=function(t){if(t===undefined)t=0;return isFinite(t)};o.Dot=function(t,e){return t.x*e.x+t.y*e.y};o.CrossVV=function(t,e){return t.x*e.y-t.y*e.x};o.CrossVF=function(t,e){if(e===undefined)e=0;var i=new h(e*t.y,-e*t.x);return i};o.CrossFV=function(t,e){if(t===undefined)t=0;var i=new h(-t*e.y,t*e.x);return i};o.MulMV=function(t,e){var i=new h(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return i};o.MulTMV=function(t,e){var i=new h(o.Dot(e,t.col1),o.Dot(e,t.col2));return i};o.MulX=function(t,e){var i=o.MulMV(t.R,e);i.x+=t.position.x;i.y+=t.position.y;return i};o.MulXT=function(t,e){var i=o.SubtractVV(e,t.position);var n=i.x*t.R.col1.x+i.y*t.R.col1.y;i.y=i.x*t.R.col2.x+i.y*t.R.col2.y;i.x=n;return i};o.AddVV=function(t,e){var i=new h(t.x+e.x,t.y+e.y);return i};o.SubtractVV=function(t,e){var i=new h(t.x-e.x,t.y-e.y);return i};o.Distance=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return Math.sqrt(i*i+n*n)};o.DistanceSquared=function(t,e){var i=t.x-e.x;var n=t.y-e.y;return i*i+n*n};o.MulFV=function(t,e){if(t===undefined)t=0;var i=new h(t*e.x,t*e.y);return i};o.AddMM=function(t,e){var i=r.FromVV(o.AddVV(t.col1,e.col1),o.AddVV(t.col2,e.col2));return i};o.MulMM=function(t,e){var i=r.FromVV(o.MulMV(t,e.col1),o.MulMV(t,e.col2));return i};o.MulTMM=function(t,e){var i=new h(o.Dot(t.col1,e.col1),o.Dot(t.col2,e.col1));var n=new h(o.Dot(t.col1,e.col2),o.Dot(t.col2,e.col2));var a=r.FromVV(i,n);return a};o.Abs=function(t){if(t===undefined)t=0;return t>0?t:-t};o.AbsV=function(t){var e=new h(o.Abs(t.x),o.Abs(t.y));return e};o.AbsM=function(t){var e=r.FromVV(o.AbsV(t.col1),o.AbsV(t.col2));return e};o.Min=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t<e?t:e};o.MinV=function(t,e){var i=new h(o.Min(t.x,e.x),o.Min(t.y,e.y));return i};o.Max=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};o.MaxV=function(t,e){var i=new h(o.Max(t.x,e.x),o.Max(t.y,e.y));return i};o.Clamp=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;return t<e?e:t>i?i:t};o.ClampV=function(t,e,i){return o.MaxV(e,o.MinV(t,i))};o.Swap=function(t,e){var i=t[0];t[0]=e[0];e[0]=i};o.Random=function(){return Math.random()*2-1};o.RandomRange=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=Math.random();i=(e-t)*i+t;return i};o.NextPowerOfTwo=function(t){if(t===undefined)t=0;t|=t>>1&2147483647;t|=t>>2&1073741823;t|=t>>4&268435455;t|=t>>8&16777215;t|=t>>16&65535;return t+1};o.IsPowerOfTwo=function(t){if(t===undefined)t=0;var e=t>0&&(t&t-1)==0;return e};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new h(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=r.FromVV(new h(1,0),new h(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new l(o.b2Vec2_zero,o.b2Mat22_identity)});s.b2Sweep=function(){this.localCenter=new h;this.c0=new h;this.c=new h};s.prototype.Set=function(t){this.localCenter.SetV(t.localCenter);this.c0.SetV(t.c0);this.c.SetV(t.c);this.a0=t.a0;this.a=t.a;this.t0=t.t0};s.prototype.Copy=function(){var t=new s;t.localCenter.SetV(this.localCenter);t.c0.SetV(this.c0);t.c.SetV(this.c);t.a0=this.a0;t.a=this.a;t.t0=this.t0;return t};s.prototype.GetTransform=function(t,e){if(e===undefined)e=0;t.position.x=(1-e)*this.c0.x+e*this.c.x;t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var n=t.R;t.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y;t.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y};s.prototype.Advance=function(t){if(t===undefined)t=0;if(this.t0<t&&1-this.t0>Box2D.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x;this.c0.y=(1-e)*this.c0.y+e*this.c.y;this.a0=(1-e)*this.a0+e*this.a;this.t0=t}};l.b2Transform=function(){this.position=new h;this.R=new r};l.prototype.b2Transform=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;if(t){this.position.SetV(t);this.R.SetM(e)}};l.prototype.Initialize=function(t,e){this.position.SetV(t);this.R.SetM(e)};l.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};l.prototype.Set=function(t){this.position.SetV(t.position);this.R.SetM(t.R)};l.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};h.b2Vec2=function(){};h.prototype.b2Vec2=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};h.prototype.SetZero=function(){this.x=0;this.y=0};h.prototype.Set=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};h.prototype.SetV=function(t){this.x=t.x;this.y=t.y};h.prototype.GetNegative=function(){return new h(-this.x,-this.y)};h.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};h.Make=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return new h(t,e)};h.prototype.Copy=function(){return new h(this.x,this.y)};h.prototype.Add=function(t){this.x+=t.x;this.y+=t.y};h.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y};h.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t};h.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y;this.y=t.col1.y*e+t.col2.y*this.y};h.prototype.MulTM=function(t){var e=o.Dot(this,t.col1);this.y=o.Dot(this,t.col2);this.x=e};h.prototype.CrossVF=function(t){if(t===undefined)t=0;var e=this.x;this.x=t*this.y;this.y=-t*e};
h.prototype.CrossFV=function(t){if(t===undefined)t=0;var e=this.x;this.x=-t*this.y;this.y=t*e};h.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x;this.y=this.y<t.y?this.y:t.y};h.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x;this.y=this.y>t.y?this.y:t.y};h.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};h.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};h.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};h.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Box2D.MIN_VALUE){return 0}var e=1/t;this.x*=e;this.y*=e;return t};h.prototype.IsValid=function(){return o.IsValid(this.x)&&o.IsValid(this.y)};u.b2Vec3=function(){};u.prototype.b2Vec3=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};u.prototype.SetZero=function(){this.x=this.y=this.z=0};u.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};u.prototype.SetV=function(t){this.x=t.x;this.y=t.y;this.z=t.z};u.prototype.GetNegative=function(){return new u(-this.x,-this.y,-this.z)};u.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};u.prototype.Copy=function(){return new u(this.x,this.y,this.z)};u.prototype.Add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z};u.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z};u.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t;this.z*=t}})();(function(){var t=Box2D.Dynamics.Controllers.b2ControllerEdge,e=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,a=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3,l=Box2D.Common.b2Color,h=Box2D.Common.b2internal,u=Box2D.Common.b2Settings,c=Box2D.Collision.b2AABB,p=Box2D.Collision.b2Bound,f=Box2D.Collision.b2BoundValues,m=Box2D.Collision.b2Collision,d=Box2D.Collision.b2ContactID,y=Box2D.Collision.b2ContactPoint,v=Box2D.Collision.b2Distance,g=Box2D.Collision.b2DistanceInput,_=Box2D.Collision.b2DistanceOutput,I=Box2D.Collision.b2DistanceProxy,x=Box2D.Collision.b2DynamicTree,w=Box2D.Collision.b2DynamicTreeBroadPhase,S=Box2D.Collision.b2DynamicTreeNode,b=Box2D.Collision.b2DynamicTreePair,C=Box2D.Collision.b2Manifold,T=Box2D.Collision.b2ManifoldPoint,D=Box2D.Collision.b2Point,U=Box2D.Collision.b2RayCastInput,A=Box2D.Collision.b2RayCastOutput,E=Box2D.Collision.b2Segment,M=Box2D.Collision.b2SeparationFunction,P=Box2D.Collision.b2Simplex,B=Box2D.Collision.b2SimplexCache,L=Box2D.Collision.b2SimplexVertex,R=Box2D.Collision.b2TimeOfImpact,O=Box2D.Collision.b2TOIInput,V=Box2D.Collision.b2WorldManifold,F=Box2D.Collision.ClipVertex,k=Box2D.Collision.Features,N=Box2D.Collision.IBroadPhase,G=Box2D.Collision.Shapes.b2CircleShape,W=Box2D.Collision.Shapes.b2EdgeChainDef,H=Box2D.Collision.Shapes.b2EdgeShape,X=Box2D.Collision.Shapes.b2MassData,J=Box2D.Collision.Shapes.b2PolygonShape,Y=Box2D.Collision.Shapes.b2Shape,z=Box2D.Dynamics.b2Body,j=Box2D.Dynamics.b2BodyDef,K=Box2D.Dynamics.b2ContactFilter,q=Box2D.Dynamics.b2ContactImpulse,Z=Box2D.Dynamics.b2ContactListener,Q=Box2D.Dynamics.b2ContactManager,$=Box2D.Dynamics.b2DebugDraw,tt=Box2D.Dynamics.b2DestructionListener,et=Box2D.Dynamics.b2FilterData,it=Box2D.Dynamics.b2Fixture,nt=Box2D.Dynamics.b2FixtureDef,rt=Box2D.Dynamics.b2Island,at=Box2D.Dynamics.b2TimeStep,ot=Box2D.Dynamics.b2World,st=Box2D.Dynamics.Contacts.b2CircleContact,lt=Box2D.Dynamics.Contacts.b2Contact,ht=Box2D.Dynamics.Contacts.b2ContactConstraint,ut=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,ct=Box2D.Dynamics.Contacts.b2ContactEdge,pt=Box2D.Dynamics.Contacts.b2ContactFactory,ft=Box2D.Dynamics.Contacts.b2ContactRegister,mt=Box2D.Dynamics.Contacts.b2ContactResult,dt=Box2D.Dynamics.Contacts.b2ContactSolver,yt=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,vt=Box2D.Dynamics.Contacts.b2NullContact,gt=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,_t=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,It=Box2D.Dynamics.Contacts.b2PolygonContact,xt=Box2D.Dynamics.Contacts.b2PositionSolverManifold,wt=Box2D.Dynamics.Controllers.b2Controller,St=Box2D.Dynamics.Joints.b2DistanceJoint,bt=Box2D.Dynamics.Joints.b2DistanceJointDef,Ct=Box2D.Dynamics.Joints.b2FrictionJoint,Tt=Box2D.Dynamics.Joints.b2FrictionJointDef,Dt=Box2D.Dynamics.Joints.b2GearJoint,Ut=Box2D.Dynamics.Joints.b2GearJointDef,At=Box2D.Dynamics.Joints.b2Jacobian,Et=Box2D.Dynamics.Joints.b2Joint,Mt=Box2D.Dynamics.Joints.b2JointDef,Pt=Box2D.Dynamics.Joints.b2JointEdge,Bt=Box2D.Dynamics.Joints.b2LineJoint,Lt=Box2D.Dynamics.Joints.b2LineJointDef,Rt=Box2D.Dynamics.Joints.b2MouseJoint,Ot=Box2D.Dynamics.Joints.b2MouseJointDef,Vt=Box2D.Dynamics.Joints.b2PrismaticJoint,Ft=Box2D.Dynamics.Joints.b2PrismaticJointDef,kt=Box2D.Dynamics.Joints.b2PulleyJoint,Nt=Box2D.Dynamics.Joints.b2PulleyJointDef,Gt=Box2D.Dynamics.Joints.b2RevoluteJoint,Wt=Box2D.Dynamics.Joints.b2RevoluteJointDef,Ht=Box2D.Dynamics.Joints.b2WeldJoint,Xt=Box2D.Dynamics.Joints.b2WeldJointDef;z.b2Body=function(){this.m_xf=new a;this.m_sweep=new r;this.m_linearVelocity=new o;this.m_force=new o};z.prototype.modifyGravity=function(t){return t};z.prototype.connectEdges=function(t,e,i){if(i===undefined)i=0;var r=Math.atan2(e.GetDirectionVector().y,e.GetDirectionVector().x);var a=Math.tan((r-i)*.5);var o=n.MulFV(a,e.GetDirectionVector());o=n.SubtractVV(o,e.GetNormalVector());o=n.MulFV(u.b2_toiSlop,o);o=n.AddVV(o,e.GetVertex1());var s=n.AddVV(t.GetDirectionVector(),e.GetDirectionVector());s.Normalize();var l=n.Dot(t.GetDirectionVector(),e.GetNormalVector())>0;t.SetNextEdge(e,o,s,l);e.SetPrevEdge(t,o,s,l);return r};z.prototype.CreateFixture=function(t){if(this.m_world.IsLocked()==true){return null}var e=new it;e.Create(this,this.m_xf,t);if(this.m_flags&z.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}e.m_next=this.m_fixtureList;this.m_fixtureList=e;++this.m_fixtureCount;e.m_body=this;if(e.m_density>0){this.ResetMassData()}this.m_world.m_flags|=ot.e_newFixture;return e};z.prototype.CreateFixture2=function(t,e){if(e===undefined)e=0;var i=new nt;i.shape=t;i.density=e;return this.CreateFixture(i)};z.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked()==true){return}var e=this.m_fixtureList;var i=null;var n=false;while(e!=null){if(e==t){if(i)i.m_next=t.m_next;else this.m_fixtureList=t.m_next;n=true;break}i=e;e=e.m_next}var r=this.m_contactList;while(r){var a=r.contact;r=r.next;var o=a.GetFixtureA();var s=a.GetFixtureB();if(t==o||t==s){this.m_world.m_contactManager.Destroy(a)}}if(this.m_flags&z.e_activeFlag){var l=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(l)}else{}t.Destroy();t.m_body=null;t.m_next=null;--this.m_fixtureCount;this.ResetMassData()};z.prototype.SetPositionAndAngle=function(t,e){if(e===undefined)e=0;var i;if(this.m_world.IsLocked()==true){return}this.m_xf.R.Set(e);this.m_xf.position.SetV(t);var n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y;this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=e;var a=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.Synchronize(a,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()};z.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())};z.prototype.GetTransform=function(){return this.m_xf};z.prototype.GetPosition=function(){return this.m_xf.position};z.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())};z.prototype.GetAngle=function(){return this.m_sweep.a};z.prototype.SetAngle=function(t){if(t===undefined)t=0;this.SetPositionAndAngle(this.GetPosition(),t)};z.prototype.GetWorldCenter=function(){return this.m_sweep.c};z.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};z.prototype.SetLinearVelocity=function(t){if(this.m_type==z.b2_staticBody){alert("Static body not support SetLinearVelocity");return}this.m_linearVelocity.SetV(t)};z.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};z.prototype.SetAngularVelocity=function(t){if(t===undefined)t=0;if(this.m_type==z.b2_staticBody){alert("Static body not support SetAngularVelocity");return}this.m_angularVelocity=t};z.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};z.prototype.GetDefinition=function(){var t=new j;t.type=this.GetType();t.allowSleep=(this.m_flags&z.e_allowSleepFlag)==z.e_allowSleepFlag;t.angle=this.GetAngle();t.angularDamping=this.m_angularDamping;t.angularVelocity=this.m_angularVelocity;t.fixedRotation=(this.m_flags&z.e_fixedRotationFlag)==z.e_fixedRotationFlag;t.bullet=(this.m_flags&z.e_bulletFlag)==z.e_bulletFlag;t.awake=(this.m_flags&z.e_awakeFlag)==z.e_awakeFlag;t.linearDamping=this.m_linearDamping;t.linearVelocity.SetV(this.GetLinearVelocity());t.position=this.GetPosition();t.userData=this.GetUserData();return t};z.prototype.ApplyForce=function(t,e){if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_force.x+=t.x;this.m_force.y+=t.y;this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x};z.prototype.ApplyTorque=function(t){if(t===undefined)t=0;if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_torque+=t};z.prototype.ApplyImpulse=function(t,e){if(this.m_type!=z.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_linearVelocity.x+=this.m_invMass*t.x;this.m_linearVelocity.y+=this.m_invMass*t.y;this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)};z.prototype.Split=function(t){var e=this.GetLinearVelocity().Copy();var i=this.GetAngularVelocity();var r=this.GetWorldCenter();var a=this;var o=this.m_world.CreateBody(this.GetDefinition());var s;for(var l=a.m_fixtureList;l;){if(t(l)){var h=l.m_next;if(s){s.m_next=h}else{a.m_fixtureList=h}a.m_fixtureCount--;l.m_next=o.m_fixtureList;o.m_fixtureList=l;o.m_fixtureCount++;l.m_body=o;l=h}else{s=l;l=l.m_next}}a.ResetMassData();o.ResetMassData();var u=a.GetWorldCenter();var c=o.GetWorldCenter();var p=n.AddVV(e,n.CrossFV(i,n.SubtractVV(u,r)));var f=n.AddVV(e,n.CrossFV(i,n.SubtractVV(c,r)));a.SetLinearVelocity(p);o.SetLinearVelocity(f);a.SetAngularVelocity(i);o.SetAngularVelocity(i);a.SynchronizeFixtures();o.SynchronizeFixtures();return o};z.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--;e.m_next=this.m_fixtureList;this.m_fixtureList=e;this.m_fixtureCount++;e.m_body=r;e=i}n.m_fixtureCount=0;var n=this;var r=t;var a=n.GetWorldCenter();var o=r.GetWorldCenter();var s=n.GetLinearVelocity().Copy();var l=r.GetLinearVelocity().Copy();var h=n.GetAngularVelocity();var u=r.GetAngularVelocity();n.ResetMassData();this.SynchronizeFixtures()};z.prototype.GetMass=function(){return this.m_mass};z.prototype.GetInertia=function(){return this.m_I};z.prototype.GetMassData=function(t){t.mass=this.m_mass;t.I=this.m_I;t.center.SetV(this.m_sweep.localCenter)};z.prototype.SetMassData=function(t){u.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()==true){return}if(this.m_type!=z.b2_dynamicBody){return}this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=t.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(t.I>0&&(this.m_flags&z.e_fixedRotationFlag)==0){this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y);this.m_invI=1/this.m_I}var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center);this.m_sweep.c0.SetV(n.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)};z.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type==z.b2_staticBody||this.m_type==z.b2_kinematicBody){return}var t=o.Make(0,0);for(var e=this.m_fixtureList;e;e=e.m_next){if(e.m_density==0){continue}var i=e.GetMassData();this.m_mass+=i.mass;t.x+=i.center.x*i.mass;t.y+=i.center.y*i.mass;this.m_I+=i.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;t.x*=this.m_invMass;t.y*=this.m_invMass}else{this.m_mass=1;this.m_invMass=1}if(this.m_I>0&&(this.m_flags&z.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y);this.m_I*=this.m_inertiaScale;u.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t);this.m_sweep.c0.SetV(n.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)};z.prototype.GetWorldPoint=function(t){var e=this.m_xf.R;var i=new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return i};z.prototype.GetWorldVector=function(t){return n.MulMV(this.m_xf.R,t)};z.prototype.GetLocalPoint=function(t){return n.MulXT(this.m_xf,t)};z.prototype.GetLocalVector=function(t){return n.MulTMV(this.m_xf.R,t)};z.prototype.GetLinearVelocityFromWorldPoint=function(t){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))};z.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R;var i=new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return new o(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))};z.prototype.GetLinearDamping=function(){return this.m_linearDamping};z.prototype.SetLinearDamping=function(t){if(t===undefined)t=0;this.m_linearDamping=t};z.prototype.GetAngularDamping=function(){return this.m_angularDamping};z.prototype.SetAngularDamping=function(t){if(t===undefined)t=0;this.m_angularDamping=t};z.prototype.SetType=function(t){if(t===undefined)t=0;if(this.m_type==t){return}this.m_type=t;this.ResetMassData();if(this.m_type==z.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(var e=this.m_contactList;e;e=e.next){e.contact.FlagForFiltering()}};z.prototype.GetType=function(){return this.m_type};z.prototype.SetBullet=function(t){if(t){this.m_flags|=z.e_bulletFlag}else{this.m_flags&=~z.e_bulletFlag}};z.prototype.IsBullet=function(){return(this.m_flags&z.e_bulletFlag)==z.e_bulletFlag};z.prototype.SetSleepingAllowed=function(t){if(t){this.m_flags|=z.e_allowSleepFlag}else{this.m_flags&=~z.e_allowSleepFlag;this.SetAwake(true)}};z.prototype.SetAwake=function(t){if(t){this.m_flags|=z.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~z.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};z.prototype.IsAwake=function(){return(this.m_flags&z.e_awakeFlag)==z.e_awakeFlag};z.prototype.SetFixedRotation=function(t){if(t){this.m_flags|=z.e_fixedRotationFlag}else{this.m_flags&=~z.e_fixedRotationFlag}this.ResetMassData()};z.prototype.IsFixedRotation=function(){return(this.m_flags&z.e_fixedRotationFlag)==z.e_fixedRotationFlag};z.prototype.SetActive=function(t){if(t==this.IsActive()){return}var e;var i;if(t){this.m_flags|=z.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.CreateProxy(e,this.m_xf)}}else{this.m_flags&=~z.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.DestroyProxy(e)}var n=this.m_contactList;while(n){var r=n;n=n.next;this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}};z.prototype.IsActive=function(){return(this.m_flags&z.e_activeFlag)==z.e_activeFlag};z.prototype.IsSleepingAllowed=function(){return(this.m_flags&z.e_allowSleepFlag)==z.e_allowSleepFlag};z.prototype.GetFixtureList=function(){return this.m_fixtureList};z.prototype.GetJointList=function(){return this.m_jointList};z.prototype.GetControllerList=function(){return this.m_controllerList};z.prototype.GetContactList=function(){return this.m_contactList};z.prototype.GetNext=function(){return this.m_next};z.prototype.GetUserData=function(){return this.m_userData};z.prototype.SetUserData=function(t){this.m_userData=t};z.prototype.GetWorld=function(){return this.m_world};z.prototype.b2Body=function(t,e){this.m_flags=0;if(t.bullet){this.m_flags|=z.e_bulletFlag}if(t.fixedRotation){this.m_flags|=z.e_fixedRotationFlag}if(t.allowSleep){this.m_flags|=z.e_allowSleepFlag}if(t.awake){this.m_flags|=z.e_awakeFlag}if(t.active){this.m_flags|=z.e_activeFlag}this.m_world=e;this.m_xf.position.SetV(t.position);this.m_xf.R.Set(t.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R;var n=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*n.x+i.col2.x*n.y;this.m_sweep.c.y=i.col1.y*n.x+i.col2.y*n.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(t.linearVelocity);this.m_angularVelocity=t.angularVelocity;this.m_linearDamping=t.linearDamping;this.m_angularDamping=t.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=t.type;if(this.m_type==z.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}else{this.m_mass=0;this.m_invMass=0}this.m_I=0;this.m_invI=0;this.m_inertiaScale=t.inertiaScale;this.m_userData=t.userData;this.m_fixtureList=null;this.m_fixtureCount=0};z.prototype.SynchronizeFixtures=function(){var t=z.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R;var i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y);t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);var n;var r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.Synchronize(r,t,this.m_xf)}};z.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R;var e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y);this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)};z.prototype.ShouldCollide=function(t){if(this.m_type!=z.b2_dynamicBody&&t.m_type!=z.b2_dynamicBody){return false}for(var e=this.m_jointList;e;e=e.next){if(e.other==t)if(e.joint.m_collideConnected==false){return false}}return true};z.prototype.Advance=function(t){if(t===undefined)t=0;this.m_sweep.Advance(t);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new a;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});j.b2BodyDef=function(){this.position=new o;this.linearVelocity=new o};j.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=true;this.awake=true;this.fixedRotation=false;this.bullet=false;this.type=z.b2_staticBody;this.active=true;this.inertiaScale=1};K.b2ContactFilter=function(){};K.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData();var n=e.GetFilterData();if(i.groupIndex==n.groupIndex&&i.groupIndex!=0){return i.groupIndex>0}var r=(i.maskBits&n.categoryBits)!=0&&(i.categoryBits&n.maskBits)!=0;return r};K.prototype.RayCollide=function(t,e){if(!t)return true;return this.ShouldCollide(t instanceof it?t:null,e)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new K});q.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(u.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(u.b2_maxManifoldPoints)};Z.b2ContactListener=function(){};Z.prototype.BeginContact=function(t){};Z.prototype.EndContact=function(t){};Z.prototype.PreSolve=function(t,e){};Z.prototype.PostSolve=function(t,e){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Z});Q.b2ContactManager=function(){};Q.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=K.b2_defaultFilter;this.m_contactListener=Z.b2_defaultListener;this.m_contactFactory=new pt(this.m_allocator);this.m_broadPhase=new w};Q.prototype.AddPair=function(t,e){var i=t instanceof it?t:null;var n=e instanceof it?e:null;var r=i.GetBody();var a=n.GetBody();if(r==a)return;var o=a.GetContactList();while(o){if(o.other==r){var s=o.contact.GetFixtureA();var l=o.contact.GetFixtureB();if(s==i&&l==n)return;if(s==n&&l==i)return}o=o.next}if(a.ShouldCollide(r)==false){return}if(this.m_contactFilter.ShouldCollide(i,n)==false){return}var h=this.m_contactFactory.Create(i,n);i=h.GetFixtureA();n=h.GetFixtureB();r=i.m_body;a=n.m_body;h.m_prev=null;h.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=h}this.m_world.m_contactList=h;h.m_nodeA.contact=h;h.m_nodeA.other=a;h.m_nodeA.prev=null;h.m_nodeA.next=r.m_contactList;if(r.m_contactList!=null){r.m_contactList.prev=h.m_nodeA}r.m_contactList=h.m_nodeA;h.m_nodeB.contact=h;h.m_nodeB.other=r;h.m_nodeB.prev=null;h.m_nodeB.next=a.m_contactList;if(a.m_contactList!=null){a.m_contactList.prev=h.m_nodeB}a.m_contactList=h.m_nodeB;++this.m_world.m_contactCount;return};Q.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};Q.prototype.Destroy=function(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var n=e.GetBody();var r=i.GetBody();if(t.IsTouching()){this.m_contactListener.EndContact(t)}if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_world.m_contactList){this.m_world.m_contactList=t.m_next}if(t.m_nodeA.prev){t.m_nodeA.prev.next=t.m_nodeA.next}if(t.m_nodeA.next){t.m_nodeA.next.prev=t.m_nodeA.prev}if(t.m_nodeA==n.m_contactList){n.m_contactList=t.m_nodeA.next}if(t.m_nodeB.prev){t.m_nodeB.prev.next=t.m_nodeB.next}if(t.m_nodeB.next){t.m_nodeB.next.prev=t.m_nodeB.prev}if(t.m_nodeB==r.m_contactList){r.m_contactList=t.m_nodeB.next}this.m_contactFactory.Destroy(t);--this.m_contactCount};Q.prototype.Collide=function(){var t=this.m_world.m_contactList;while(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var n=e.GetBody();var r=i.GetBody();if(n.IsAwake()==false&&r.IsAwake()==false){t=t.GetNext();continue}if(!n.IsActive()||!r.IsActive()){t=t.GetNext();continue}if(t.m_flags&lt.e_filterFlag){if(r.ShouldCollide(n)==false){var a=t;t=a.GetNext();this.Destroy(a);continue}if(this.m_contactFilter.ShouldCollide(e,i)==false){a=t;t=a.GetNext();this.Destroy(a);continue}t.m_flags&=~lt.e_filterFlag}var o=e.m_proxy;var s=i.m_proxy;var l=this.m_broadPhase.TestOverlap(o,s);if(l==false){a=t;t=a.GetNext();this.Destroy(a);continue}t.Update(this.m_contactListener);t=t.GetNext()}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new y});$.b2DebugDraw=function(){};$.prototype.b2DebugDraw=function(){};$.prototype.SetFlags=function(t){if(t===undefined)t=0};$.prototype.GetFlags=function(){};$.prototype.AppendFlags=function(t){if(t===undefined)t=0};$.prototype.ClearFlags=function(t){if(t===undefined)t=0};$.prototype.SetSprite=function(t){};$.prototype.GetSprite=function(){};$.prototype.SetDrawScale=function(t){if(t===undefined)t=0};$.prototype.GetDrawScale=function(){};$.prototype.SetLineThickness=function(t){if(t===undefined)t=0};$.prototype.GetLineThickness=function(){};$.prototype.SetAlpha=function(t){if(t===undefined)t=0};$.prototype.GetAlpha=function(){};$.prototype.SetFillAlpha=function(t){if(t===undefined)t=0};$.prototype.GetFillAlpha=function(){};$.prototype.SetXFormScale=function(t){if(t===undefined)t=0};$.prototype.GetXFormScale=function(){};$.prototype.DrawPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawCircle=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidCircle=function(t,e,i,n){if(e===undefined)e=0};$.prototype.DrawSegment=function(t,e,i){};$.prototype.DrawTransform=function(t){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});tt.b2DestructionListener=function(){};tt.prototype.SayGoodbyeJoint=function(t){};tt.prototype.SayGoodbyeFixture=function(t){};et.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};et.prototype.Copy=function(){var t=new et;t.categoryBits=this.categoryBits;t.maskBits=this.maskBits;t.groupIndex=this.groupIndex;return t};it.b2Fixture=function(){this.m_filter=new et};it.prototype.GetType=function(){return this.m_shape.GetType()};it.prototype.GetShape=function(){return this.m_shape};it.prototype.SetSensor=function(t){if(this.m_isSensor==t)return;this.m_isSensor=t;if(this.m_body==null)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var n=i.GetFixtureA();var r=i.GetFixtureB();if(n==this||r==this)i.SetSensor(n.IsSensor()||r.IsSensor());e=e.next}};it.prototype.IsSensor=function(){return this.m_isSensor};it.prototype.SetFilterData=function(t){this.m_filter=t.Copy();if(this.m_body)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var n=i.GetFixtureA();var r=i.GetFixtureB();if(n==this||r==this)i.FlagForFiltering();e=e.next}};it.prototype.GetFilterData=function(){return this.m_filter.Copy()};it.prototype.GetBody=function(){return this.m_body};it.prototype.GetNext=function(){return this.m_next};it.prototype.GetUserData=function(){return this.m_userData};it.prototype.SetUserData=function(t){this.m_userData=t};it.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)};it.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())};it.prototype.GetMassData=function(t){if(t===undefined)t=null;if(t==null){t=new X}this.m_shape.ComputeMass(t,this.m_density);return t};it.prototype.SetDensity=function(t){if(t===undefined)t=0;this.m_density=t};it.prototype.GetDensity=function(){return this.m_density};it.prototype.GetFriction=function(){return this.m_friction};it.prototype.SetFriction=function(t){if(t===undefined)t=0;this.m_friction=t};it.prototype.GetRestitution=function(){return this.m_restitution};it.prototype.SetRestitution=function(t){if(t===undefined)t=0;this.m_restitution=t};it.prototype.GetAABB=function(){return this.m_aabb};it.prototype.b2Fixture=function(){this.m_aabb=new c;this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};it.prototype.Create=function(t,e,i){this.m_userData=i.userData;this.m_friction=i.friction;this.m_restitution=i.restitution;this.m_body=t;this.m_next=null;this.m_filter=i.filter.Copy();this.m_isSensor=i.isSensor;this.m_shape=i.shape.Copy();this.m_density=i.density};it.prototype.Destroy=function(){this.m_shape=null};it.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e);this.m_proxy=t.CreateProxy(this.m_aabb,this)};it.prototype.DestroyProxy=function(t){if(this.m_proxy==null){return}t.DestroyProxy(this.m_proxy);this.m_proxy=null};it.prototype.Synchronize=function(t,e,i){if(!this.m_proxy)return;var r=new c;var a=new c;this.m_shape.ComputeAABB(r,e);this.m_shape.ComputeAABB(a,i);this.m_aabb.Combine(r,a);var o=n.SubtractVV(i.position,e.position);t.MoveProxy(this.m_proxy,this.m_aabb,o)};nt.b2FixtureDef=function(){this.filter=new et};nt.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};rt.b2Island=function(){};rt.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};rt.prototype.Initialize=function(t,e,i,n,r,a){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;var o=0;this.m_bodyCapacity=t;this.m_contactCapacity=e;this.m_jointCapacity=i;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=n;this.m_listener=r;this.m_contactSolver=a;for(o=this.m_bodies.length;o<t;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<e;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<i;o++)this.m_joints[o]=null};rt.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};rt.prototype.Solve=function(t,e,i){var r=0;var a=0;var o;var s;for(r=0;r<this.m_bodyCount;++r){o=this.m_bodies[r];if(o.GetType()!=z.b2_dynamicBody)continue;var l=o.modifyGravity(e);o.m_linearVelocity.x+=t.dt*(l.x+o.m_invMass*o.m_force.x);o.m_linearVelocity.y+=t.dt*(l.y+o.m_invMass*o.m_force.y);o.m_angularVelocity+=t.dt*o.m_invI*o.m_torque;o.m_linearVelocity.Multiply(n.Clamp(1-t.dt*o.m_linearDamping,0,1));o.m_angularVelocity*=n.Clamp(1-t.dt*o.m_angularDamping,0,1)}this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var h=this.m_contactSolver;h.InitVelocityConstraints(t);for(r=0;r<this.m_jointCount;++r){s=this.m_joints[r];s.InitVelocityConstraints(t)}for(r=0;r<t.velocityIterations;++r){for(a=0;a<this.m_jointCount;++a){s=this.m_joints[a];s.SolveVelocityConstraints(t)}h.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r){s=this.m_joints[r];s.FinalizeVelocityConstraints()}h.FinalizeVelocityConstraints();for(r=0;r<this.m_bodyCount;++r){o=this.m_bodies[r];if(o.GetType()==z.b2_staticBody)continue;var c=t.dt*o.m_linearVelocity.x;var p=t.dt*o.m_linearVelocity.y;if(c*c+p*p>u.b2_maxTranslationSquared){o.m_linearVelocity.Normalize();o.m_linearVelocity.x*=u.b2_maxTranslation*t.inv_dt;o.m_linearVelocity.y*=u.b2_maxTranslation*t.inv_dt}var f=t.dt*o.m_angularVelocity;if(f*f>u.b2_maxRotationSquared){if(o.m_angularVelocity<0){o.m_angularVelocity=-u.b2_maxRotation*t.inv_dt}else{o.m_angularVelocity=u.b2_maxRotation*t.inv_dt}}o.m_sweep.c0.SetV(o.m_sweep.c);o.m_sweep.a0=o.m_sweep.a;o.m_sweep.c.x+=t.dt*o.m_linearVelocity.x;o.m_sweep.c.y+=t.dt*o.m_linearVelocity.y;o.m_sweep.a+=t.dt*o.m_angularVelocity;o.SynchronizeTransform()}for(r=0;r<t.positionIterations;++r){var m=h.SolvePositionConstraints(u.b2_contactBaumgarte);var d=true;for(a=0;a<this.m_jointCount;++a){s=this.m_joints[a];var y=s.SolvePositionConstraints(u.b2_contactBaumgarte);d=d&&y}if(m&&d){break}}this.Report(h.m_constraints);if(i){var v=Number.MAX_VALUE;var g=u.b2_linearSleepTolerance*u.b2_linearSleepTolerance;var _=u.b2_angularSleepTolerance*u.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r){o=this.m_bodies[r];if(o.GetType()==z.b2_staticBody){continue}if((o.m_flags&z.e_allowSleepFlag)==0){o.m_sleepTime=0;v=0}if((o.m_flags&z.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>_||n.Dot(o.m_linearVelocity,o.m_linearVelocity)>g){o.m_sleepTime=0;v=0}else{o.m_sleepTime+=t.dt;v=n.Min(v,o.m_sleepTime)}}if(v>=u.b2_timeToSleep){for(r=0;r<this.m_bodyCount;++r){o=this.m_bodies[r];o.SetAwake(false)}}}};rt.prototype.SolveTOI=function(t){var e=0;var i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var n=this.m_contactSolver;for(e=0;e<this.m_jointCount;++e){this.m_joints[e].InitVelocityConstraints(t)}for(e=0;e<t.velocityIterations;++e){
n.SolveVelocityConstraints();for(i=0;i<this.m_jointCount;++i){this.m_joints[i].SolveVelocityConstraints(t)}}for(e=0;e<this.m_bodyCount;++e){var r=this.m_bodies[e];if(r.GetType()==z.b2_staticBody)continue;var a=t.dt*r.m_linearVelocity.x;var o=t.dt*r.m_linearVelocity.y;if(a*a+o*o>u.b2_maxTranslationSquared){r.m_linearVelocity.Normalize();r.m_linearVelocity.x*=u.b2_maxTranslation*t.inv_dt;r.m_linearVelocity.y*=u.b2_maxTranslation*t.inv_dt}var s=t.dt*r.m_angularVelocity;if(s*s>u.b2_maxRotationSquared){if(r.m_angularVelocity<0){r.m_angularVelocity=-u.b2_maxRotation*t.inv_dt}else{r.m_angularVelocity=u.b2_maxRotation*t.inv_dt}}r.m_sweep.c0.SetV(r.m_sweep.c);r.m_sweep.a0=r.m_sweep.a;r.m_sweep.c.x+=t.dt*r.m_linearVelocity.x;r.m_sweep.c.y+=t.dt*r.m_linearVelocity.y;r.m_sweep.a+=t.dt*r.m_angularVelocity;r.SynchronizeTransform()}var l=.75;for(e=0;e<t.positionIterations;++e){var h=n.SolvePositionConstraints(l);var c=true;for(i=0;i<this.m_jointCount;++i){var p=this.m_joints[i].SolvePositionConstraints(u.b2_contactBaumgarte);c=c&&p}if(h&&c){break}}this.Report(n.m_constraints)};rt.prototype.Report=function(t){if(this.m_listener==null){return}for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];var n=t[e];for(var r=0;r<n.pointCount;++r){rt.s_impulse.normalImpulses[r]=n.points[r].normalImpulse;rt.s_impulse.tangentImpulses[r]=n.points[r].tangentImpulse}this.m_listener.PostSolve(i,rt.s_impulse)}};rt.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=t};rt.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t};rt.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new q});at.b2TimeStep=function(){};at.prototype.Set=function(t){this.dt=t.dt;this.inv_dt=t.inv_dt;this.positionIterations=t.positionIterations;this.velocityIterations=t.velocityIterations;this.warmStarting=t.warmStarting};ot.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new Q;this.m_contactSolver=new dt;this.m_island=new rt};ot.prototype.b2World=function(t,e){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;ot.m_warmStarting=true;ot.m_continuousPhysics=true;this.m_allowSleep=e;t.y=t.y;this.m_gravity=t;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var i=new j;this.m_groundBody=this.CreateBody(i)};ot.prototype.SetDestructionListener=function(t){this.m_destructionListener=t};ot.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t};ot.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t};ot.prototype.SetDebugDraw=function(t){this.m_debugDraw=t};ot.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next){for(var n=i.m_fixtureList;n;n=n.m_next){n.m_proxy=t.CreateProxy(e.GetFatAABB(n.m_proxy),n)}}};ot.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};ot.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};ot.prototype.CreateBody=function(t){if(this.IsLocked()==true){return null}var e=new z(t,this);e.m_prev=null;e.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=e}this.m_bodyList=e;++this.m_bodyCount;return e};ot.prototype.DestroyBody=function(t){if(this.IsLocked()==true){return}var e=t.m_jointList;while(e){var i=e;e=e.next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeJoint(i.joint)}this.DestroyJoint(i.joint)}var n=t.m_controllerList;while(n){var r=n;n=n.nextController;r.controller.RemoveBody(t)}var a=t.m_contactList;while(a){var o=a;a=a.next;this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;var s=t.m_fixtureList;while(s){var l=s;s=s.m_next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeFixture(l)}l.DestroyProxy(this.m_contactManager.m_broadPhase);l.Destroy()}t.m_fixtureList=null;t.m_fixtureCount=0;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_bodyList){this.m_bodyList=t.m_next}--this.m_bodyCount};ot.prototype.CreateJoint=function(t){var e=Et.Create(t,null);e.m_prev=null;e.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=e}this.m_jointList=e;++this.m_jointCount;e.m_edgeA.joint=e;e.m_edgeA.other=e.m_bodyB;e.m_edgeA.prev=null;e.m_edgeA.next=e.m_bodyA.m_jointList;if(e.m_bodyA.m_jointList)e.m_bodyA.m_jointList.prev=e.m_edgeA;e.m_bodyA.m_jointList=e.m_edgeA;e.m_edgeB.joint=e;e.m_edgeB.other=e.m_bodyA;e.m_edgeB.prev=null;e.m_edgeB.next=e.m_bodyB.m_jointList;if(e.m_bodyB.m_jointList)e.m_bodyB.m_jointList.prev=e.m_edgeB;e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA;var n=t.bodyB;if(t.collideConnected==false){var r=n.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}return e};ot.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_jointList){this.m_jointList=t.m_next}var i=t.m_bodyA;var n=t.m_bodyB;i.SetAwake(true);n.SetAwake(true);if(t.m_edgeA.prev){t.m_edgeA.prev.next=t.m_edgeA.next}if(t.m_edgeA.next){t.m_edgeA.next.prev=t.m_edgeA.prev}if(t.m_edgeA==i.m_jointList){i.m_jointList=t.m_edgeA.next}t.m_edgeA.prev=null;t.m_edgeA.next=null;if(t.m_edgeB.prev){t.m_edgeB.prev.next=t.m_edgeB.next}if(t.m_edgeB.next){t.m_edgeB.next.prev=t.m_edgeB.prev}if(t.m_edgeB==n.m_jointList){n.m_jointList=t.m_edgeB.next}t.m_edgeB.prev=null;t.m_edgeB.next=null;Et.Destroy(t,null);--this.m_jointCount;if(e==false){var r=n.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}};ot.prototype.AddController=function(t){t.m_next=this.m_controllerList;t.m_prev=null;this.m_controllerList=t;t.m_world=this;this.m_controllerCount++;return t};ot.prototype.RemoveController=function(t){if(t.m_prev)t.m_prev.m_next=t.m_next;if(t.m_next)t.m_next.m_prev=t.m_prev;if(this.m_controllerList==t)this.m_controllerList=t.m_next;this.m_controllerCount--};ot.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");t.m_next=this.m_controllerList;t.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=t;this.m_controllerList=t;++this.m_controllerCount;t.m_world=this;return t};ot.prototype.DestroyController=function(t){t.Clear();if(t.m_next)t.m_next.m_prev=t.m_prev;if(t.m_prev)t.m_prev.m_next=t.m_next;if(t==this.m_controllerList)this.m_controllerList=t.m_next;--this.m_controllerCount};ot.prototype.SetWarmStarting=function(t){ot.m_warmStarting=t};ot.prototype.SetContinuousPhysics=function(t){ot.m_continuousPhysics=t};ot.prototype.GetBodyCount=function(){return this.m_bodyCount};ot.prototype.GetJointCount=function(){return this.m_jointCount};ot.prototype.GetContactCount=function(){return this.m_contactCount};ot.prototype.SetGravity=function(t){this.m_gravity=t};ot.prototype.GetGravity=function(){return this.m_gravity};ot.prototype.GetGroundBody=function(){return this.m_groundBody};ot.prototype.Step=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;if(this.m_flags&ot.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~ot.e_newFixture}this.m_flags|=ot.e_locked;var n=ot.s_timestep2;n.dt=t;n.velocityIterations=e;n.positionIterations=i;if(t>0){n.inv_dt=1/t}else{n.inv_dt=0}n.dtRatio=this.m_inv_dt0*t;n.warmStarting=ot.m_warmStarting;this.m_contactManager.Collide();if(n.dt>0){this.Solve(n)}if(ot.m_continuousPhysics&&n.dt>0){this.SolveTOI(n)}if(n.dt>0){this.m_inv_dt0=n.inv_dt}this.m_flags&=~ot.e_locked};ot.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next){t.m_force.SetZero();t.m_torque=0}};ot.prototype.DrawDebugData=function(){if(this.m_debugDraw==null){return}this.m_debugDraw.m_sprite.graphics.clear();var t=this.m_debugDraw.GetFlags();var e=0;var i;var n;var r;var a;var s;var h=new o;var u=new o;var p=new o;var f;var m=new c;var d=new c;var y=[new o,new o,new o,new o];var v=new l(0,0,0);if(t&$.e_shapeBit){for(i=this.m_bodyList;i;i=i.m_next){f=i.m_xf;for(n=i.GetFixtureList();n;n=n.m_next){r=n.GetShape();if(i.IsActive()==false){v.Set(.5,.5,.3);this.DrawShape(r,f,v)}else if(i.GetType()==z.b2_staticBody){v.Set(.5,.9,.5);this.DrawShape(r,f,v)}else if(i.GetType()==z.b2_kinematicBody){v.Set(.5,.5,.9);this.DrawShape(r,f,v)}else if(i.IsAwake()==false){v.Set(.6,.6,.6);this.DrawShape(r,f,v)}else{v.Set(.9,.7,.7);this.DrawShape(r,f,v)}}}}if(t&$.e_jointBit){for(a=this.m_jointList;a;a=a.m_next){this.DrawJoint(a)}}if(t&$.e_controllerBit){for(var g=this.m_controllerList;g;g=g.m_next){g.Draw(this.m_debugDraw)}}if(t&$.e_pairBit){v.Set(.3,.9,.9);for(var _=this.m_contactManager.m_contactList;_;_=_.GetNext()){var I=_.GetFixtureA();var x=_.GetFixtureB();var w=I.GetAABB().GetCenter();var S=x.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(w,S,v)}}if(t&$.e_aabbBit){s=this.m_contactManager.m_broadPhase;y=[new o,new o,new o,new o];for(i=this.m_bodyList;i;i=i.GetNext()){if(i.IsActive()==false){continue}for(n=i.GetFixtureList();n;n=n.GetNext()){var b=s.GetFatAABB(n.m_proxy);y[0].Set(b.lowerBound.x,b.lowerBound.y);y[1].Set(b.upperBound.x,b.lowerBound.y);y[2].Set(b.upperBound.x,b.upperBound.y);y[3].Set(b.lowerBound.x,b.upperBound.y);this.m_debugDraw.DrawPolygon(y,4,v)}}}if(t&$.e_centerOfMassBit){for(i=this.m_bodyList;i;i=i.m_next){f=ot.s_xf;f.R=i.m_xf.R;f.position=i.GetWorldCenter();this.m_debugDraw.DrawTransform(f)}}};ot.prototype.QueryAABB=function(t,e){var i=this;var n=i.m_contactManager.m_broadPhase;function r(e){return t(n.GetUserData(e))}n.Query(r,e)};ot.prototype.QueryShape=function(t,e,i){var n=this;if(i===undefined)i=null;if(i==null){i=new a;i.SetIdentity()}var r=n.m_contactManager.m_broadPhase;function o(n){var a=r.GetUserData(n)instanceof it?r.GetUserData(n):null;if(Y.TestOverlap(e,i,a.GetShape(),a.GetBody().GetTransform()))return t(a);return true}var s=new c;e.ComputeAABB(s,i);r.Query(o,s)};ot.prototype.QueryPoint=function(t,e){var i=this;var n=i.m_contactManager.m_broadPhase;function r(i){var r=n.GetUserData(i)instanceof it?n.GetUserData(i):null;if(r.TestPoint(e))return t(r);return true}var a=new c;a.lowerBound.Set(e.x-u.b2_linearSlop,e.y-u.b2_linearSlop);a.upperBound.Set(e.x+u.b2_linearSlop,e.y+u.b2_linearSlop);n.Query(r,a)};ot.prototype.RayCast=function(t,e,i){var n=this;var r=n.m_contactManager.m_broadPhase;var a=new A;function s(n,s){var l=r.GetUserData(s);var h=l instanceof it?l:null;var u=h.RayCast(a,n);if(u){var c=a.fraction;var p=new o((1-c)*e.x+c*i.x,(1-c)*e.y+c*i.y);return t(h,p,a.normal,c)}return n.maxFraction}var l=new U(e,i);r.RayCast(s,l)};ot.prototype.RayCastOne=function(t,e){var i=this;var n;function r(t,e,i,r){if(r===undefined)r=0;n=t;return r}i.RayCast(r,t,e);return n};ot.prototype.RayCastAll=function(t,e){var i=this;var n=new Vector;function r(t,e,i,r){if(r===undefined)r=0;n[n.length]=t;return 1}i.RayCast(r,t,e);return n};ot.prototype.GetBodyList=function(){return this.m_bodyList};ot.prototype.GetJointList=function(){return this.m_jointList};ot.prototype.GetContactList=function(){return this.m_contactList};ot.prototype.IsLocked=function(){return(this.m_flags&ot.e_locked)>0};ot.prototype.Solve=function(t){var e;for(var i=this.m_controllerList;i;i=i.m_next){i.Step(t)}var n=this.m_island;n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~z.e_islandFlag}for(var r=this.m_contactList;r;r=r.m_next){r.m_flags&=~lt.e_islandFlag}for(var a=this.m_jointList;a;a=a.m_next){a.m_islandFlag=false}var o=parseInt(this.m_bodyCount);var s=this.s_stack;for(var l=this.m_bodyList;l;l=l.m_next){if(l.m_flags&z.e_islandFlag){continue}if(l.IsAwake()==false||l.IsActive()==false){continue}if(l.GetType()==z.b2_staticBody){continue}n.Clear();var h=0;s[h++]=l;l.m_flags|=z.e_islandFlag;while(h>0){e=s[--h];n.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()==z.b2_staticBody){continue}var u;for(var c=e.m_contactList;c;c=c.next){if(c.contact.m_flags&lt.e_islandFlag){continue}if(c.contact.IsSensor()==true||c.contact.IsEnabled()==false||c.contact.IsTouching()==false){continue}n.AddContact(c.contact);c.contact.m_flags|=lt.e_islandFlag;u=c.other;if(u.m_flags&z.e_islandFlag){continue}s[h++]=u;u.m_flags|=z.e_islandFlag}for(var p=e.m_jointList;p;p=p.next){if(p.joint.m_islandFlag==true){continue}u=p.other;if(u.IsActive()==false){continue}n.AddJoint(p.joint);p.joint.m_islandFlag=true;if(u.m_flags&z.e_islandFlag){continue}s[h++]=u;u.m_flags|=z.e_islandFlag}}n.Solve(t,this.m_gravity,this.m_allowSleep);for(var f=0;f<n.m_bodyCount;++f){e=n.m_bodies[f];if(e.GetType()==z.b2_staticBody){e.m_flags&=~z.e_islandFlag}}}for(f=0;f<s.length;++f){if(!s[f])break;s[f]=null}for(e=this.m_bodyList;e;e=e.m_next){if(e.IsAwake()==false||e.IsActive()==false){continue}if(e.GetType()==z.b2_staticBody){continue}e.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};ot.prototype.SolveTOI=function(t){var e;var i;var n;var r;var a;var o;var s;var l=this.m_island;l.Initialize(this.m_bodyCount,u.b2_maxTOIContactsPerIsland,u.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var h=ot.s_queue;for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~z.e_islandFlag;e.m_sweep.t0=0}var c;for(c=this.m_contactList;c;c=c.m_next){c.m_flags&=~(lt.e_toiFlag|lt.e_islandFlag)}for(s=this.m_jointList;s;s=s.m_next){s.m_islandFlag=false}for(;;){var p=null;var f=1;for(c=this.m_contactList;c;c=c.m_next){if(c.IsSensor()==true||c.IsEnabled()==false||c.IsContinuous()==false){continue}var m=1;if(c.m_flags&lt.e_toiFlag){m=c.m_toi}else{i=c.m_fixtureA;n=c.m_fixtureB;r=i.m_body;a=n.m_body;if((r.GetType()!=z.b2_dynamicBody||r.IsAwake()==false)&&(a.GetType()!=z.b2_dynamicBody||a.IsAwake()==false)){continue}var d=r.m_sweep.t0;if(r.m_sweep.t0<a.m_sweep.t0){d=a.m_sweep.t0;r.m_sweep.Advance(d)}else if(a.m_sweep.t0<r.m_sweep.t0){d=r.m_sweep.t0;a.m_sweep.Advance(d)}m=c.ComputeTOI(r.m_sweep,a.m_sweep);u.b2Assert(0<=m&&m<=1);if(m>0&&m<1){m=(1-m)*d+m;if(m>1)m=1}c.m_toi=m;c.m_flags|=lt.e_toiFlag}if(Box2D.MIN_VALUE<m&&m<f){p=c;f=m}}if(p==null||1-100*Box2D.MIN_VALUE<f){break}i=p.m_fixtureA;n=p.m_fixtureB;r=i.m_body;a=n.m_body;ot.s_backupA.Set(r.m_sweep);ot.s_backupB.Set(a.m_sweep);r.Advance(f);a.Advance(f);p.Update(this.m_contactManager.m_contactListener);p.m_flags&=~lt.e_toiFlag;if(p.IsSensor()==true||p.IsEnabled()==false){r.m_sweep.Set(ot.s_backupA);a.m_sweep.Set(ot.s_backupB);r.SynchronizeTransform();a.SynchronizeTransform();continue}if(p.IsTouching()==false){continue}var y=r;if(y.GetType()!=z.b2_dynamicBody){y=a}l.Clear();var v=0;var g=0;h[v+g++]=y;y.m_flags|=z.e_islandFlag;while(g>0){e=h[v++];--g;l.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()!=z.b2_dynamicBody){continue}for(o=e.m_contactList;o;o=o.next){if(l.m_contactCount==l.m_contactCapacity){break}if(o.contact.m_flags&lt.e_islandFlag){continue}if(o.contact.IsSensor()==true||o.contact.IsEnabled()==false||o.contact.IsTouching()==false){continue}l.AddContact(o.contact);o.contact.m_flags|=lt.e_islandFlag;var _=o.other;if(_.m_flags&z.e_islandFlag){continue}if(_.GetType()!=z.b2_staticBody){_.Advance(f);_.SetAwake(true)}h[v+g]=_;++g;_.m_flags|=z.e_islandFlag}for(var I=e.m_jointList;I;I=I.next){if(l.m_jointCount==l.m_jointCapacity)continue;if(I.joint.m_islandFlag==true)continue;_=I.other;if(_.IsActive()==false){continue}l.AddJoint(I.joint);I.joint.m_islandFlag=true;if(_.m_flags&z.e_islandFlag)continue;if(_.GetType()!=z.b2_staticBody){_.Advance(f);_.SetAwake(true)}h[v+g]=_;++g;_.m_flags|=z.e_islandFlag}}var x=ot.s_timestep;x.warmStarting=false;x.dt=(1-f)*t.dt;x.inv_dt=1/x.dt;x.dtRatio=0;x.velocityIterations=t.velocityIterations;x.positionIterations=t.positionIterations;l.SolveTOI(x);var w=0;for(w=0;w<l.m_bodyCount;++w){e=l.m_bodies[w];e.m_flags&=~z.e_islandFlag;if(e.IsAwake()==false){continue}if(e.GetType()!=z.b2_dynamicBody){continue}e.SynchronizeFixtures();for(o=e.m_contactList;o;o=o.next){o.contact.m_flags&=~lt.e_toiFlag}}for(w=0;w<l.m_contactCount;++w){c=l.m_contacts[w];c.m_flags&=~(lt.e_toiFlag|lt.e_islandFlag)}for(w=0;w<l.m_jointCount;++w){s=l.m_joints[w];s.m_islandFlag=false}this.m_contactManager.FindNewContacts()}};ot.prototype.DrawJoint=function(t){var e=t.GetBodyA();var i=t.GetBodyB();var n=e.m_xf;var r=i.m_xf;var a=n.position;var o=r.position;var s=t.GetAnchorA();var l=t.GetAnchorB();var h=ot.s_jointColor;switch(t.m_type){case Et.e_distanceJoint:this.m_debugDraw.DrawSegment(s,l,h);break;case Et.e_pulleyJoint:{var u=t instanceof kt?t:null;var c=u.GetGroundAnchorA();var p=u.GetGroundAnchorB();this.m_debugDraw.DrawSegment(c,s,h);this.m_debugDraw.DrawSegment(p,l,h);this.m_debugDraw.DrawSegment(c,p,h)}break;case Et.e_mouseJoint:this.m_debugDraw.DrawSegment(s,l,h);break;default:if(e!=this.m_groundBody)this.m_debugDraw.DrawSegment(a,s,h);this.m_debugDraw.DrawSegment(s,l,h);if(i!=this.m_groundBody)this.m_debugDraw.DrawSegment(o,l,h)}};ot.prototype.DrawShape=function(t,e,i){switch(t.m_type){case Y.e_circleShape:{var r=t instanceof G?t:null;var a=n.MulX(e,r.m_p);var o=r.m_radius;var s=e.R.col1;this.m_debugDraw.DrawSolidCircle(a,o,s,i)}break;case Y.e_polygonShape:{var l=0;var h=t instanceof J?t:null;var u=parseInt(h.GetVertexCount());var c=h.GetVertices();var p=new Vector(u);for(l=0;l<u;++l){p[l]=n.MulX(e,c[l])}this.m_debugDraw.DrawSolidPolygon(p,u,i)}break;case Y.e_edgeShape:{var f=t instanceof H?t:null;this.m_debugDraw.DrawSegment(n.MulX(e,f.GetVertex1()),n.MulX(e,f.GetVertex2()),i)}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new at;Box2D.Dynamics.b2World.s_xf=new a;Box2D.Dynamics.b2World.s_backupA=new r;Box2D.Dynamics.b2World.s_backupB=new r;Box2D.Dynamics.b2World.s_timestep=new at;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new l(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,a=Box2D.Collision.Shapes.b2Shape,o=Box2D.Dynamics.Contacts.b2CircleContact,s=Box2D.Dynamics.Contacts.b2Contact,l=Box2D.Dynamics.Contacts.b2ContactConstraint,h=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,u=Box2D.Dynamics.Contacts.b2ContactEdge,c=Box2D.Dynamics.Contacts.b2ContactFactory,p=Box2D.Dynamics.Contacts.b2ContactRegister,f=Box2D.Dynamics.Contacts.b2ContactResult,m=Box2D.Dynamics.Contacts.b2ContactSolver,d=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,y=Box2D.Dynamics.Contacts.b2NullContact,v=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,g=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,_=Box2D.Dynamics.Contacts.b2PolygonContact,I=Box2D.Dynamics.Contacts.b2PositionSolverManifold,x=Box2D.Dynamics.b2Body,w=Box2D.Dynamics.b2BodyDef,S=Box2D.Dynamics.b2ContactFilter,b=Box2D.Dynamics.b2ContactImpulse,C=Box2D.Dynamics.b2ContactListener,T=Box2D.Dynamics.b2ContactManager,D=Box2D.Dynamics.b2DebugDraw,U=Box2D.Dynamics.b2DestructionListener,A=Box2D.Dynamics.b2FilterData,E=Box2D.Dynamics.b2Fixture,M=Box2D.Dynamics.b2FixtureDef,P=Box2D.Dynamics.b2Island,B=Box2D.Dynamics.b2TimeStep,L=Box2D.Dynamics.b2World,R=Box2D.Common.b2Color,O=Box2D.Common.b2internal,V=Box2D.Common.b2Settings,F=Box2D.Common.Math.b2Mat22,k=Box2D.Common.Math.b2Mat33,N=Box2D.Common.Math.b2Math,G=Box2D.Common.Math.b2Sweep,W=Box2D.Common.Math.b2Transform,H=Box2D.Common.Math.b2Vec2,X=Box2D.Common.Math.b2Vec3,J=Box2D.Collision.b2AABB,Y=Box2D.Collision.b2Bound,z=Box2D.Collision.b2BoundValues,j=Box2D.Collision.b2Collision,K=Box2D.Collision.b2ContactID,q=Box2D.Collision.b2ContactPoint,Z=Box2D.Collision.b2Distance,Q=Box2D.Collision.b2DistanceInput,$=Box2D.Collision.b2DistanceOutput,tt=Box2D.Collision.b2DistanceProxy,et=Box2D.Collision.b2DynamicTree,it=Box2D.Collision.b2DynamicTreeBroadPhase,nt=Box2D.Collision.b2DynamicTreeNode,rt=Box2D.Collision.b2DynamicTreePair,at=Box2D.Collision.b2Manifold,ot=Box2D.Collision.b2ManifoldPoint,st=Box2D.Collision.b2Point,lt=Box2D.Collision.b2RayCastInput,ht=Box2D.Collision.b2RayCastOutput,ut=Box2D.Collision.b2Segment,ct=Box2D.Collision.b2SeparationFunction,pt=Box2D.Collision.b2Simplex,ft=Box2D.Collision.b2SimplexCache,mt=Box2D.Collision.b2SimplexVertex,dt=Box2D.Collision.b2TimeOfImpact,yt=Box2D.Collision.b2TOIInput,vt=Box2D.Collision.b2WorldManifold,gt=Box2D.Collision.ClipVertex,_t=Box2D.Collision.Features,It=Box2D.Collision.IBroadPhase;Box2D.inherit(o,Box2D.Dynamics.Contacts.b2Contact);o.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;o.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};o.Create=function(t){return new o};o.Destroy=function(t,e){};o.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);V.b2Assert(e.GetType()==a.e_circleShape)};o.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();j.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};s.b2Contact=function(){this.m_nodeA=new u;this.m_nodeB=new u;this.m_manifold=new at;this.m_oldManifold=new at};s.prototype.GetManifold=function(){return this.m_manifold};s.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();var n=this.m_fixtureA.GetShape();var r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)};s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag};s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag};s.prototype.SetSensor=function(t){if(t){this.m_flags|=s.e_sensorFlag}else{this.m_flags&=~s.e_sensorFlag}};s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag};s.prototype.SetEnabled=function(t){if(t){this.m_flags|=s.e_enabledFlag}else{this.m_flags&=~s.e_enabledFlag}};s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag};s.prototype.GetNext=function(){return this.m_next};s.prototype.GetFixtureA=function(){return this.m_fixtureA};s.prototype.GetFixtureB=function(){return this.m_fixtureB};s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag};s.prototype.b2Contact=function(){};s.prototype.Reset=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;this.m_flags=s.e_enabledFlag;if(!t||!e){this.m_fixtureA=null;this.m_fixtureB=null;return}if(t.IsSensor()||e.IsSensor()){this.m_flags|=s.e_sensorFlag}var i=t.GetBody();var n=e.GetBody();if(i.GetType()!=x.b2_dynamicBody||i.IsBullet()||n.GetType()!=x.b2_dynamicBody||n.IsBullet()){this.m_flags|=s.e_continuousFlag}this.m_fixtureA=t;this.m_fixtureB=e;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null};s.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=e;this.m_flags|=s.e_enabledFlag;var i=false;var n=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag;var r=this.m_fixtureA.m_body;var o=this.m_fixtureB.m_body;var l=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(l){var h=this.m_fixtureA.GetShape();var u=this.m_fixtureB.GetShape();var c=r.GetTransform();var p=o.GetTransform();i=a.TestOverlap(h,c,u,p)}this.m_manifold.m_pointCount=0}else{if(r.GetType()!=x.b2_dynamicBody||r.IsBullet()||o.GetType()!=x.b2_dynamicBody||o.IsBullet()){this.m_flags|=s.e_continuousFlag}else{this.m_flags&=~s.e_continuousFlag}if(l){this.Evaluate();i=this.m_manifold.m_pointCount>0;for(var f=0;f<this.m_manifold.m_pointCount;++f){var m=this.m_manifold.m_points[f];m.m_normalImpulse=0;m.m_tangentImpulse=0;var d=m.m_id;for(var y=0;y<this.m_oldManifold.m_pointCount;++y){var v=this.m_oldManifold.m_points[y];if(v.m_id.key==d.key){m.m_normalImpulse=v.m_normalImpulse;m.m_tangentImpulse=v.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(i!=n){r.SetAwake(true);o.SetAwake(true)}}if(i){this.m_flags|=s.e_touchingFlag}else{this.m_flags&=~s.e_touchingFlag}if(n==false&&i==true){t.BeginContact(this)}if(n==true&&i==false){t.EndContact(this)}if((this.m_flags&s.e_sensorFlag)==0){t.PreSolve(this,this.m_oldManifold)}};s.prototype.Evaluate=function(){};s.prototype.ComputeTOI=function(t,e){s.s_input.proxyA.Set(this.m_fixtureA.GetShape());s.s_input.proxyB.Set(this.m_fixtureB.GetShape());s.s_input.sweepA=t;s.s_input.sweepB=e;s.s_input.tolerance=V.b2_linearSlop;return dt.TimeOfImpact(s.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new yt});l.b2ContactConstraint=function(){this.localPlaneNormal=new H;this.localPoint=new H;this.normal=new H;this.normalMass=new F;this.K=new F};l.prototype.b2ContactConstraint=function(){this.points=new Vector(V.b2_maxManifoldPoints);for(var t=0;t<V.b2_maxManifoldPoints;t++){this.points[t]=new h}};h.b2ContactConstraintPoint=function(){this.localPoint=new H;this.rA=new H;this.rB=new H};u.b2ContactEdge=function(){};c.b2ContactFactory=function(){};c.prototype.b2ContactFactory=function(t){this.m_allocator=t;this.InitializeRegisters()};c.prototype.AddType=function(t,e,i,n){if(i===undefined)i=0;if(n===undefined)n=0;this.m_registers[i][n].createFcn=t;this.m_registers[i][n].destroyFcn=e;this.m_registers[i][n].primary=true;if(i!=n){this.m_registers[n][i].createFcn=t;this.m_registers[n][i].destroyFcn=e;this.m_registers[n][i].primary=false}};c.prototype.InitializeRegisters=function(){this.m_registers=new Vector(a.e_shapeTypeCount);for(var t=0;t<a.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(a.e_shapeTypeCount);for(var e=0;e<a.e_shapeTypeCount;e++){this.m_registers[t][e]=new p}}this.AddType(o.Create,o.Destroy,a.e_circleShape,a.e_circleShape);this.AddType(v.Create,v.Destroy,a.e_polygonShape,a.e_circleShape);this.AddType(_.Create,_.Destroy,a.e_polygonShape,a.e_polygonShape);this.AddType(d.Create,d.Destroy,a.e_edgeShape,a.e_circleShape);this.AddType(g.Create,g.Destroy,a.e_polygonShape,a.e_edgeShape)};c.prototype.Create=function(t,e){var i=parseInt(t.GetType());var n=parseInt(e.GetType());var r=this.m_registers[i][n];var a;if(r.pool&&r.pool.length>0){a=r.pool.pop();a.Reset(t,e);a.destroyed=false;return a}var o=r.createFcn;if(o!=null){if(r.primary){a=o(this.m_allocator);a.Reset(t,e);return a}else{a=o(this.m_allocator);a.Reset(e,t);return a}}else{return null}};c.prototype.Destroy=function(t){if(t.m_manifold.m_pointCount>0){t.m_fixtureA.m_body.SetAwake(true);t.m_fixtureB.m_body.SetAwake(true)}var e=parseInt(t.m_fixtureA.GetType());var i=parseInt(t.m_fixtureB.GetType());var n=this.m_registers[e][i];if(!n.pool){n.pool=[]}t.destroyed=true;n.pool.push(t);var r=n.destroyFcn;r(t,this.m_allocator)};p.b2ContactRegister=function(){};f.b2ContactResult=function(){this.position=new H;this.normal=new H;this.id=new K};m.b2ContactSolver=function(){this.m_step=new B;this.m_constraints=new Vector};m.prototype.b2ContactSolver=function(){};m.prototype.Initialize=function(t,e,i,n){if(i===undefined)i=0;var r;this.m_step.Set(t);this.m_allocator=n;var a=0;var o;var s;this.m_constraintCount=i;while(this.m_constraints.length<this.m_constraintCount){this.m_constraints[this.m_constraints.length]=new l}for(a=0;a<i;++a){r=e[a];var h=r.m_fixtureA;var u=r.m_fixtureB;var c=h.m_shape;var p=u.m_shape;var f=c.m_radius;var d=p.m_radius;var y=h.m_body;var v=u.m_body;var g=r.GetManifold();var _=V.b2MixFriction(h.GetFriction(),u.GetFriction());var I=V.b2MixRestitution(h.GetRestitution(),u.GetRestitution());var x=y.m_linearVelocity.x;var w=y.m_linearVelocity.y;var S=v.m_linearVelocity.x;var b=v.m_linearVelocity.y;var C=y.m_angularVelocity;var T=v.m_angularVelocity;V.b2Assert(g.m_pointCount>0);m.s_worldManifold.Initialize(g,y.m_xf,f,v.m_xf,d);var D=m.s_worldManifold.m_normal.x;var U=m.s_worldManifold.m_normal.y;var A=this.m_constraints[a];A.bodyA=y;A.bodyB=v;A.manifold=g;A.normal.x=D;A.normal.y=U;A.pointCount=g.m_pointCount;A.friction=_;A.restitution=I;A.localPlaneNormal.x=g.m_localPlaneNormal.x;A.localPlaneNormal.y=g.m_localPlaneNormal.y;A.localPoint.x=g.m_localPoint.x;A.localPoint.y=g.m_localPoint.y;A.radius=f+d;A.type=g.m_type;for(var E=0;E<A.pointCount;++E){var M=g.m_points[E];var P=A.points[E];P.normalImpulse=M.m_normalImpulse;P.tangentImpulse=M.m_tangentImpulse;P.localPoint.SetV(M.m_localPoint);var B=P.rA.x=m.s_worldManifold.m_points[E].x-y.m_sweep.c.x;var L=P.rA.y=m.s_worldManifold.m_points[E].y-y.m_sweep.c.y;var R=P.rB.x=m.s_worldManifold.m_points[E].x-v.m_sweep.c.x;var O=P.rB.y=m.s_worldManifold.m_points[E].y-v.m_sweep.c.y;var F=B*U-L*D;var k=R*U-O*D;F*=F;k*=k;var N=y.m_invMass+v.m_invMass+y.m_invI*F+v.m_invI*k;P.normalMass=1/N;var G=y.m_mass*y.m_invMass+v.m_mass*v.m_invMass;G+=y.m_mass*y.m_invI*F+v.m_mass*v.m_invI*k;P.equalizedMass=1/G;var W=U;var H=-D;var X=B*H-L*W;var J=R*H-O*W;X*=X;J*=J;var Y=y.m_invMass+v.m_invMass+y.m_invI*X+v.m_invI*J;P.tangentMass=1/Y;P.velocityBias=0;var z=S+-T*O-x- -C*L;var j=b+T*R-w-C*B;var K=A.normal.x*z+A.normal.y*j;if(K<-V.b2_velocityThreshold){P.velocityBias+=-A.restitution*K}}if(A.pointCount==2){var q=A.points[0];var Z=A.points[1];var Q=y.m_invMass;var $=y.m_invI;var tt=v.m_invMass;var et=v.m_invI;var it=q.rA.x*U-q.rA.y*D;var nt=q.rB.x*U-q.rB.y*D;var rt=Z.rA.x*U-Z.rA.y*D;var at=Z.rB.x*U-Z.rB.y*D;var ot=Q+tt+$*it*it+et*nt*nt;var st=Q+tt+$*rt*rt+et*at*at;var lt=Q+tt+$*it*rt+et*nt*at;var ht=100;if(ot*ot<ht*(ot*st-lt*lt)){A.K.col1.Set(ot,lt);A.K.col2.Set(lt,st);A.K.GetInverse(A.normalMass)}else{A.pointCount=1}}}};m.prototype.InitVelocityConstraints=function(t){var e;var i;var n;for(var r=0;r<this.m_constraintCount;++r){var a=this.m_constraints[r];var o=a.bodyA;var s=a.bodyB;var l=o.m_invMass;var h=o.m_invI;var u=s.m_invMass;var c=s.m_invI;var p=a.normal.x;var f=a.normal.y;var m=f;var d=-p;var y=0;var v=0;var g=0;if(t.warmStarting){g=a.pointCount;for(v=0;v<g;++v){var _=a.points[v];_.normalImpulse*=t.dtRatio;_.tangentImpulse*=t.dtRatio;var I=_.normalImpulse*p+_.tangentImpulse*m;var x=_.normalImpulse*f+_.tangentImpulse*d;o.m_angularVelocity-=h*(_.rA.x*x-_.rA.y*I);o.m_linearVelocity.x-=l*I;o.m_linearVelocity.y-=l*x;s.m_angularVelocity+=c*(_.rB.x*x-_.rB.y*I);s.m_linearVelocity.x+=u*I;s.m_linearVelocity.y+=u*x}}else{g=a.pointCount;for(v=0;v<g;++v){var w=a.points[v];w.normalImpulse=0;w.tangentImpulse=0}}}};m.prototype.SolveVelocityConstraints=function(){var t=0;var e;var i=0;var n=0;var r=0;var a=0;var o=0;var s=0;var l=0;var h=0;var u=0;var c=0;var p=0;var f=0;var m=0;var d=0;var y=0;var v=0;var g=0;var _=0;var I=0;var x;var w;for(var S=0;S<this.m_constraintCount;++S){var b=this.m_constraints[S];var C=b.bodyA;var T=b.bodyB;var D=C.m_angularVelocity;var U=T.m_angularVelocity;var A=C.m_linearVelocity;var E=T.m_linearVelocity;var M=C.m_invMass;var P=C.m_invI;var B=T.m_invMass;var L=T.m_invI;var R=b.normal.x;var O=b.normal.y;var V=O;var F=-R;var k=b.friction;var G=0;for(t=0;t<b.pointCount;t++){e=b.points[t];o=E.x-U*e.rB.y-A.x+D*e.rA.y;s=E.y+U*e.rB.x-A.y-D*e.rA.x;h=o*V+s*F;u=e.tangentMass*-h;c=k*e.normalImpulse;p=N.Clamp(e.tangentImpulse+u,-c,c);u=p-e.tangentImpulse;f=u*V;m=u*F;A.x-=M*f;A.y-=M*m;D-=P*(e.rA.x*m-e.rA.y*f);E.x+=B*f;E.y+=B*m;U+=L*(e.rB.x*m-e.rB.y*f);
e.tangentImpulse=p}var W=parseInt(b.pointCount);if(b.pointCount==1){e=b.points[0];o=E.x+-U*e.rB.y-A.x- -D*e.rA.y;s=E.y+U*e.rB.x-A.y-D*e.rA.x;l=o*R+s*O;u=-e.normalMass*(l-e.velocityBias);p=e.normalImpulse+u;p=p>0?p:0;u=p-e.normalImpulse;f=u*R;m=u*O;A.x-=M*f;A.y-=M*m;D-=P*(e.rA.x*m-e.rA.y*f);E.x+=B*f;E.y+=B*m;U+=L*(e.rB.x*m-e.rB.y*f);e.normalImpulse=p}else{var H=b.points[0];var X=b.points[1];var J=H.normalImpulse;var Y=X.normalImpulse;var z=E.x-U*H.rB.y-A.x+D*H.rA.y;var j=E.y+U*H.rB.x-A.y-D*H.rA.x;var K=E.x-U*X.rB.y-A.x+D*X.rA.y;var q=E.y+U*X.rB.x-A.y-D*X.rA.x;var Z=z*R+j*O;var Q=K*R+q*O;var $=Z-H.velocityBias;var tt=Q-X.velocityBias;x=b.K;$-=x.col1.x*J+x.col2.x*Y;tt-=x.col1.y*J+x.col2.y*Y;var et=.001;for(;;){x=b.normalMass;var it=-(x.col1.x*$+x.col2.x*tt);var nt=-(x.col1.y*$+x.col2.y*tt);if(it>=0&&nt>=0){d=it-J;y=nt-Y;v=d*R;g=d*O;_=y*R;I=y*O;A.x-=M*(v+_);A.y-=M*(g+I);D-=P*(H.rA.x*g-H.rA.y*v+X.rA.x*I-X.rA.y*_);E.x+=B*(v+_);E.y+=B*(g+I);U+=L*(H.rB.x*g-H.rB.y*v+X.rB.x*I-X.rB.y*_);H.normalImpulse=it;X.normalImpulse=nt;break}it=-H.normalMass*$;nt=0;Z=0;Q=b.K.col1.y*it+tt;if(it>=0&&Q>=0){d=it-J;y=nt-Y;v=d*R;g=d*O;_=y*R;I=y*O;A.x-=M*(v+_);A.y-=M*(g+I);D-=P*(H.rA.x*g-H.rA.y*v+X.rA.x*I-X.rA.y*_);E.x+=B*(v+_);E.y+=B*(g+I);U+=L*(H.rB.x*g-H.rB.y*v+X.rB.x*I-X.rB.y*_);H.normalImpulse=it;X.normalImpulse=nt;break}it=0;nt=-X.normalMass*tt;Z=b.K.col2.x*nt+$;Q=0;if(nt>=0&&Z>=0){d=it-J;y=nt-Y;v=d*R;g=d*O;_=y*R;I=y*O;A.x-=M*(v+_);A.y-=M*(g+I);D-=P*(H.rA.x*g-H.rA.y*v+X.rA.x*I-X.rA.y*_);E.x+=B*(v+_);E.y+=B*(g+I);U+=L*(H.rB.x*g-H.rB.y*v+X.rB.x*I-X.rB.y*_);H.normalImpulse=it;X.normalImpulse=nt;break}it=0;nt=0;Z=$;Q=tt;if(Z>=0&&Q>=0){d=it-J;y=nt-Y;v=d*R;g=d*O;_=y*R;I=y*O;A.x-=M*(v+_);A.y-=M*(g+I);D-=P*(H.rA.x*g-H.rA.y*v+X.rA.x*I-X.rA.y*_);E.x+=B*(v+_);E.y+=B*(g+I);U+=L*(H.rB.x*g-H.rB.y*v+X.rB.x*I-X.rB.y*_);H.normalImpulse=it;X.normalImpulse=nt;break}break}}C.m_angularVelocity=D;T.m_angularVelocity=U}};m.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t){var e=this.m_constraints[t];var i=e.manifold;for(var n=0;n<e.pointCount;++n){var r=i.m_points[n];var a=e.points[n];r.m_normalImpulse=a.normalImpulse;r.m_tangentImpulse=a.tangentImpulse}}};m.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;for(var i=0;i<this.m_constraintCount;i++){var n=this.m_constraints[i];var r=n.bodyA;var a=n.bodyB;var o=r.m_mass*r.m_invMass;var s=r.m_mass*r.m_invI;var l=a.m_mass*a.m_invMass;var h=a.m_mass*a.m_invI;m.s_psm.Initialize(n);var u=m.s_psm.m_normal;for(var c=0;c<n.pointCount;c++){var p=n.points[c];var f=m.s_psm.m_points[c];var d=m.s_psm.m_separations[c];var y=f.x-r.m_sweep.c.x;var v=f.y-r.m_sweep.c.y;var g=f.x-a.m_sweep.c.x;var _=f.y-a.m_sweep.c.y;e=e<d?e:d;var I=N.Clamp(t*(d+V.b2_linearSlop),-V.b2_maxLinearCorrection,0);var x=-p.equalizedMass*I;var w=x*u.x;var S=x*u.y;r.m_sweep.c.x-=o*w;r.m_sweep.c.y-=o*S;r.m_sweep.a-=s*(y*S-v*w);r.SynchronizeTransform();a.m_sweep.c.x+=l*w;a.m_sweep.c.y+=l*S;a.m_sweep.a+=h*(g*S-_*w);a.SynchronizeTransform()}}return e>-1.5*V.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new vt;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new I});Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact);d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;d.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};d.Create=function(t){return new d};d.Destroy=function(t,e){};d.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};d.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var n=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,n.m_xf)};d.prototype.b2CollideEdgeAndCircle=function(t,e,i,n,r){t.m_pointCount=0;var a;var o=0;var s=0;var l=0;var h=0;var u;var c;c=r.R;u=n.m_p;var p=r.position.x+(c.col1.x*u.x+c.col2.x*u.y);var f=r.position.y+(c.col1.y*u.x+c.col2.y*u.y);o=p-i.position.x;s=f-i.position.y;c=i.R;var m=o*c.col1.x+s*c.col1.y;var d=o*c.col2.x+s*c.col2.y;var y=0;var v=e.m_radius+n.m_radius;u=e.m_normal;var g=u.x*o+u.y*s;var _=e.m_v1;var I=e.m_v2;if(g<Number.MIN_VALUE){t.m_pointCount=1;t.m_type=at.e_faceA;t.m_localPlaneNormal.SetV(e.m_normal);t.m_localPoint.x=.5*(_.x+I.x);t.m_localPoint.y=.5*(_.y+I.y);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0;return}var x=(m-_.x)*(I.x-_.x)+(d-_.y)*(I.y-_.y);var w=(m-I.x)*(_.x-I.x)+(d-I.y)*(_.y-I.y);if(x<=0){if((m-_.x)*(m-_.x)+(d-_.y)*(d-_.y)>v*v)return;t.m_pointCount=1;t.m_type=at.e_faceA;t.m_localPlaneNormal.x=m-_.x;t.m_localPlaneNormal.y=d-_.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(_);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else if(w<=0){if((m-I.x)*(m-I.x)+(d-I.y)*(d-I.y)>v*v)return;t.m_pointCount=1;t.m_type=at.e_faceA;t.m_localPlaneNormal.x=m-I.x;t.m_localPlaneNormal.y=d-I.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(I);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}else{var S=.5*(_.x+I.x);var b=.5*(_.y+I.y);g=(m-S)*u.x+(d-b)*u.y;if(g>v)return;t.m_pointCount=1;t.m_type=at.e_faceA;t.m_localPlaneNormal.x=u.x;t.m_localPlaneNormal.y=u.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.Set(S,b);t.m_points[0].m_localPoint.SetV(n.m_p);t.m_points[0].m_id.key=0}};Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact);y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;y.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};y.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};y.prototype.Evaluate=function(){};Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(t){return new v};v.Destroy=function(t,e){};v.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);V.b2Assert(t.GetType()==a.e_polygonShape);V.b2Assert(e.GetType()==a.e_circleShape)};v.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body;var i=this.m_fixtureB.m_body;j.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact);g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;g.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};g.Create=function(t){return new g};g.Destroy=function(t,e){};g.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);V.b2Assert(t.GetType()==a.e_polygonShape);V.b2Assert(e.GetType()==a.e_edgeShape)};g.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)};g.prototype.b2CollidePolyAndEdge=function(t,e,i,n,r){};Box2D.inherit(_,Box2D.Dynamics.Contacts.b2Contact);_.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;_.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};_.Create=function(t){return new _};_.Destroy=function(t,e){};_.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};_.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();j.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,e.m_xf)};I.b2PositionSolverManifold=function(){};I.prototype.b2PositionSolverManifold=function(){this.m_normal=new H;this.m_separations=new Vector_a2j_Number(V.b2_maxManifoldPoints);this.m_points=new Vector(V.b2_maxManifoldPoints);for(var t=0;t<V.b2_maxManifoldPoints;t++){this.m_points[t]=new H}};I.prototype.Initialize=function(t){V.b2Assert(t.pointCount>0);var e=0;var i=0;var n=0;var r;var a;var o=0;var s=0;switch(t.type){case at.e_circles:{r=t.bodyA.m_xf.R;a=t.localPoint;var l=t.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);var h=t.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);r=t.bodyB.m_xf.R;a=t.points[0].localPoint;var u=t.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);var c=t.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);var p=u-l;var f=c-h;var m=p*p+f*f;if(m>Box2D.MIN_VALUE*Box2D.MIN_VALUE){var d=Math.sqrt(m);this.m_normal.x=p/d;this.m_normal.y=f/d}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=.5*(l+u);this.m_points[0].y=.5*(h+c);this.m_separations[0]=p*this.m_normal.x+f*this.m_normal.y-t.radius}break;case at.e_faceA:{r=t.bodyA.m_xf.R;a=t.localPlaneNormal;this.m_normal.x=r.col1.x*a.x+r.col2.x*a.y;this.m_normal.y=r.col1.y*a.x+r.col2.y*a.y;r=t.bodyA.m_xf.R;a=t.localPoint;o=t.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);s=t.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);r=t.bodyB.m_xf.R;for(e=0;e<t.pointCount;++e){a=t.points[e].localPoint;i=t.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);n=t.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);this.m_separations[e]=(i-o)*this.m_normal.x+(n-s)*this.m_normal.y-t.radius;this.m_points[e].x=i;this.m_points[e].y=n}}break;case at.e_faceB:{r=t.bodyB.m_xf.R;a=t.localPlaneNormal;this.m_normal.x=r.col1.x*a.x+r.col2.x*a.y;this.m_normal.y=r.col1.y*a.x+r.col2.y*a.y;r=t.bodyB.m_xf.R;a=t.localPoint;o=t.bodyB.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);s=t.bodyB.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);r=t.bodyA.m_xf.R;for(e=0;e<t.pointCount;++e){a=t.points[e].localPoint;i=t.bodyA.m_xf.position.x+(r.col1.x*a.x+r.col2.x*a.y);n=t.bodyA.m_xf.position.y+(r.col1.y*a.x+r.col2.y*a.y);this.m_separations[e]=(i-o)*this.m_normal.x+(n-s)*this.m_normal.y-t.radius;this.m_points[e].Set(i,n)}this.m_normal.x*=-1;this.m_normal.y*=-1}break}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new H;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new H})})();(function(){var t=Box2D.Dynamics.b2Body,e=Box2D.Dynamics.b2BodyDef,i=Box2D.Dynamics.b2ContactFilter,n=Box2D.Dynamics.b2ContactImpulse,r=Box2D.Dynamics.b2ContactListener,a=Box2D.Dynamics.b2ContactManager,o=Box2D.Dynamics.b2DebugDraw,s=Box2D.Dynamics.b2DestructionListener,l=Box2D.Dynamics.b2FilterData,h=Box2D.Dynamics.b2Fixture,u=Box2D.Dynamics.b2FixtureDef,c=Box2D.Dynamics.b2Island,p=Box2D.Dynamics.b2TimeStep,f=Box2D.Dynamics.b2World,m=Box2D.Common.Math.b2Mat22,d=Box2D.Common.Math.b2Mat33,y=Box2D.Common.Math.b2Math,v=Box2D.Common.Math.b2Sweep,g=Box2D.Common.Math.b2Transform,_=Box2D.Common.Math.b2Vec2,I=Box2D.Common.Math.b2Vec3,x=Box2D.Common.b2Color,w=Box2D.Common.b2internal,S=Box2D.Common.b2Settings,b=Box2D.Collision.Shapes.b2CircleShape,C=Box2D.Collision.Shapes.b2EdgeChainDef,T=Box2D.Collision.Shapes.b2EdgeShape,D=Box2D.Collision.Shapes.b2MassData,U=Box2D.Collision.Shapes.b2PolygonShape,A=Box2D.Collision.Shapes.b2Shape,E=Box2D.Dynamics.Controllers.b2BuoyancyController,M=Box2D.Dynamics.Controllers.b2ConstantAccelController,P=Box2D.Dynamics.Controllers.b2ConstantForceController,B=Box2D.Dynamics.Controllers.b2Controller,L=Box2D.Dynamics.Controllers.b2ControllerEdge,R=Box2D.Dynamics.Controllers.b2GravityController,O=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(E,Box2D.Dynamics.Controllers.b2Controller);E.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;E.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new _(0,-1);this.offset=0;this.density=0;this.velocity=new _(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};E.prototype.Step=function(t){if(!this.m_bodyList)return;if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()==false){continue}var n=new _;var r=new _;var a=0;var o=0;for(var s=i.GetFixtureList();s;s=s.GetNext()){var l=new _;var h=s.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),l);a+=h;n.x+=h*l.x;n.y+=h*l.y;var u=0;if(this.useDensity){u=1}else{u=1}o+=h*u;r.x+=h*l.x*u;r.y+=h*l.y*u}n.x/=a;n.y/=a;r.x/=o;r.y/=o;if(a<Box2D.MIN_VALUE)continue;var c=this.gravity.GetNegative();c.Multiply(this.density*a);i.ApplyForce(c,r);var p=i.GetLinearVelocityFromWorldPoint(n);p.Subtract(this.velocity);p.Multiply(-this.linearDrag*a);i.ApplyForce(p,n);i.ApplyTorque(-i.GetInertia()/i.GetMass()*a*i.GetAngularVelocity()*this.angularDrag)}};E.prototype.Draw=function(t){var e=1e3;var i=new _;var n=new _;i.x=this.normal.x*this.offset+this.normal.y*e;i.y=this.normal.y*this.offset-this.normal.x*e;n.x=this.normal.x*this.offset-this.normal.y*e;n.y=this.normal.y*this.offset+this.normal.x*e;var r=new x(0,0,1);t.DrawSegment(i,n,r)};Box2D.inherit(M,Box2D.Dynamics.Controllers.b2Controller);M.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;M.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new _(0,0)};M.prototype.Step=function(t){var e=new _(this.A.x*t.dt,this.A.y*t.dt);for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(!n.IsAwake())continue;n.SetLinearVelocity(new _(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}};Box2D.inherit(P,Box2D.Dynamics.Controllers.b2Controller);P.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;P.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new _(0,0)};P.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(!i.IsAwake())continue;i.ApplyForce(this.F,i.GetWorldCenter())}};B.b2Controller=function(){};B.prototype.Step=function(t){};B.prototype.Draw=function(t){};B.prototype.AddBody=function(t){var e=new L;e.controller=this;e.body=t;e.nextBody=this.m_bodyList;e.prevBody=null;this.m_bodyList=e;if(e.nextBody)e.nextBody.prevBody=e;this.m_bodyCount++;e.nextController=t.m_controllerList;e.prevController=null;t.m_controllerList=e;if(e.nextController)e.nextController.prevController=e;t.m_controllerCount++};B.prototype.RemoveBody=function(t){var e=t.m_controllerList;while(e&&e.controller!=this)e=e.nextController;if(e.prevBody)e.prevBody.nextBody=e.nextBody;if(e.nextBody)e.nextBody.prevBody=e.prevBody;if(e.nextController)e.nextController.prevController=e.prevController;if(e.prevController)e.prevController.nextController=e.nextController;if(this.m_bodyList==e)this.m_bodyList=e.nextBody;if(t.m_controllerList==e)t.m_controllerList=e.nextController;t.m_controllerCount--;this.m_bodyCount--};B.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)};B.prototype.GetNext=function(){return this.m_next};B.prototype.GetWorld=function(){return this.m_world};B.prototype.GetBodyList=function(){return this.m_bodyList};L.b2ControllerEdge=function(){};Box2D.inherit(R,Box2D.Dynamics.Controllers.b2Controller);R.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;R.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};R.prototype.Step=function(t){var e=null;var i=null;var n=null;var r=0;var a=null;var o=null;var s=null;var l=0;var h=0;var u=0;var c=null;if(this.invSqr){for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;n=i.GetWorldCenter();r=i.GetMass();for(a=this.m_bodyList;a!=e;a=a.nextBody){o=a.body;s=o.GetWorldCenter();l=s.x-n.x;h=s.y-n.y;u=l*l+h*h;if(u<Box2D.MIN_VALUE)continue;c=new _(l,h);c.Multiply(this.G/u/Math.sqrt(u)*r*o.GetMass());if(i.IsAwake())i.ApplyForce(c,n);c.Multiply(-1);if(o.IsAwake())o.ApplyForce(c,s)}}}else{for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;n=i.GetWorldCenter();r=i.GetMass();for(a=this.m_bodyList;a!=e;a=a.nextBody){o=a.body;s=o.GetWorldCenter();l=s.x-n.x;h=s.y-n.y;u=l*l+h*h;if(u<Box2D.MIN_VALUE)continue;c=new _(l,h);c.Multiply(this.G/u*r*o.GetMass());if(i.IsAwake())i.ApplyForce(c,n);c.Multiply(-1);if(o.IsAwake())o.ApplyForce(c,s)}}}};Box2D.inherit(O,Box2D.Dynamics.Controllers.b2Controller);O.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;O.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new m;this.maxTimestep=0};O.prototype.SetAxisAligned=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.T.col1.x=-t;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-e;if(t>0||e>0){this.maxTimestep=1/Math.max(t,e)}else{this.maxTimestep=0}};O.prototype.Step=function(t){var e=t.dt;if(e<=Box2D.MIN_VALUE)return;if(e>this.maxTimestep&&this.maxTimestep>0)e=this.maxTimestep;for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(!n.IsAwake()){continue}var r=n.GetWorldVector(y.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity())));n.SetLinearVelocity(new _(n.GetLinearVelocity().x+r.x*e,n.GetLinearVelocity().y+r.y*e))}}})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,a=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,h=Box2D.Common.Math.b2Vec3,u=Box2D.Dynamics.Joints.b2DistanceJoint,c=Box2D.Dynamics.Joints.b2DistanceJointDef,p=Box2D.Dynamics.Joints.b2FrictionJoint,f=Box2D.Dynamics.Joints.b2FrictionJointDef,m=Box2D.Dynamics.Joints.b2GearJoint,d=Box2D.Dynamics.Joints.b2GearJointDef,y=Box2D.Dynamics.Joints.b2Jacobian,v=Box2D.Dynamics.Joints.b2Joint,g=Box2D.Dynamics.Joints.b2JointDef,_=Box2D.Dynamics.Joints.b2JointEdge,I=Box2D.Dynamics.Joints.b2LineJoint,x=Box2D.Dynamics.Joints.b2LineJointDef,w=Box2D.Dynamics.Joints.b2MouseJoint,S=Box2D.Dynamics.Joints.b2MouseJointDef,b=Box2D.Dynamics.Joints.b2PrismaticJoint,C=Box2D.Dynamics.Joints.b2PrismaticJointDef,T=Box2D.Dynamics.Joints.b2PulleyJoint,D=Box2D.Dynamics.Joints.b2PulleyJointDef,U=Box2D.Dynamics.Joints.b2RevoluteJoint,A=Box2D.Dynamics.Joints.b2RevoluteJointDef,E=Box2D.Dynamics.Joints.b2WeldJoint,M=Box2D.Dynamics.Joints.b2WeldJointDef,P=Box2D.Dynamics.b2Body,B=Box2D.Dynamics.b2BodyDef,L=Box2D.Dynamics.b2ContactFilter,R=Box2D.Dynamics.b2ContactImpulse,O=Box2D.Dynamics.b2ContactListener,V=Box2D.Dynamics.b2ContactManager,F=Box2D.Dynamics.b2DebugDraw,k=Box2D.Dynamics.b2DestructionListener,N=Box2D.Dynamics.b2FilterData,G=Box2D.Dynamics.b2Fixture,W=Box2D.Dynamics.b2FixtureDef,H=Box2D.Dynamics.b2Island,X=Box2D.Dynamics.b2TimeStep,J=Box2D.Dynamics.b2World;Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint);u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;u.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_u=new l};u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};u.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)};u.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};u.prototype.GetLength=function(){return this.m_length};u.prototype.SetLength=function(t){if(t===undefined)t=0;this.m_length=t};u.prototype.GetFrequency=function(){return this.m_frequencyHz};u.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};u.prototype.GetDampingRatio=function(){return this.m_dampingRatio};u.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};u.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_length=t.length;this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};u.prototype.InitVelocityConstraints=function(t){var e;var n=0;var r=this.m_bodyA;var a=this.m_bodyB;e=r.m_xf.R;var o=this.m_localAnchor1.x-r.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-r.m_sweep.localCenter.y;n=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=n;e=a.m_xf.R;var l=this.m_localAnchor2.x-a.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-a.m_sweep.localCenter.y;n=e.col1.x*l+e.col2.x*h;h=e.col1.y*l+e.col2.y*h;l=n;this.m_u.x=a.m_sweep.c.x+l-r.m_sweep.c.x-o;this.m_u.y=a.m_sweep.c.y+h-r.m_sweep.c.y-s;var u=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(u>i.b2_linearSlop){this.m_u.Multiply(1/u)}else{this.m_u.SetZero()}var c=o*this.m_u.y-s*this.m_u.x;var p=l*this.m_u.y-h*this.m_u.x;var f=r.m_invMass+r.m_invI*c*c+a.m_invMass+a.m_invI*p*p;this.m_mass=f!=0?1/f:0;if(this.m_frequencyHz>0){var m=u-this.m_length;var d=2*Math.PI*this.m_frequencyHz;var y=2*this.m_mass*this.m_dampingRatio*d;var v=this.m_mass*d*d;this.m_gamma=t.dt*(y+t.dt*v);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=m*t.dt*v*this.m_gamma;this.m_mass=f+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(t.warmStarting){this.m_impulse*=t.dtRatio;var g=this.m_impulse*this.m_u.x;var _=this.m_impulse*this.m_u.y;r.m_linearVelocity.x-=r.m_invMass*g;r.m_linearVelocity.y-=r.m_invMass*_;r.m_angularVelocity-=r.m_invI*(o*_-s*g);a.m_linearVelocity.x+=a.m_invMass*g;a.m_linearVelocity.y+=a.m_invMass*_;a.m_angularVelocity+=a.m_invI*(l*_-h*g)}else{this.m_impulse=0}};u.prototype.SolveVelocityConstraints=function(t){var e;var i=this.m_bodyA;var n=this.m_bodyB;e=i.m_xf.R;var r=this.m_localAnchor1.x-i.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-i.m_sweep.localCenter.y;var o=e.col1.x*r+e.col2.x*a;a=e.col1.y*r+e.col2.y*a;r=o;e=n.m_xf.R;var s=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=o;var h=i.m_linearVelocity.x+-i.m_angularVelocity*a;var u=i.m_linearVelocity.y+i.m_angularVelocity*r;var c=n.m_linearVelocity.x+-n.m_angularVelocity*l;var p=n.m_linearVelocity.y+n.m_angularVelocity*s;var f=this.m_u.x*(c-h)+this.m_u.y*(p-u);var m=-this.m_mass*(f+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var d=m*this.m_u.x;var y=m*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*d;i.m_linearVelocity.y-=i.m_invMass*y;i.m_angularVelocity-=i.m_invI*(r*y-a*d);n.m_linearVelocity.x+=n.m_invMass*d;n.m_linearVelocity.y+=n.m_invMass*y;n.m_angularVelocity+=n.m_invI*(s*y-l*d)};u.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;if(this.m_frequencyHz>0){return true}var n=this.m_bodyA;var r=this.m_bodyB;e=n.m_xf.R;var o=this.m_localAnchor1.x-n.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-n.m_sweep.localCenter.y;var l=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=l;e=r.m_xf.R;var h=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var u=this.m_localAnchor2.y-r.m_sweep.localCenter.y;l=e.col1.x*h+e.col2.x*u;u=e.col1.y*h+e.col2.y*u;h=l;var c=r.m_sweep.c.x+h-n.m_sweep.c.x-o;var p=r.m_sweep.c.y+u-n.m_sweep.c.y-s;var f=Math.sqrt(c*c+p*p);c/=f;p/=f;var m=f-this.m_length;m=a.Clamp(m,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);var d=-this.m_mass*m;this.m_u.Set(c,p);var y=d*this.m_u.x;var v=d*this.m_u.y;n.m_sweep.c.x-=n.m_invMass*y;n.m_sweep.c.y-=n.m_invMass*v;n.m_sweep.a-=n.m_invI*(o*v-s*y);r.m_sweep.c.x+=r.m_invMass*y;r.m_sweep.c.y+=r.m_invMass*v;r.m_sweep.a+=r.m_invI*(h*v-u*y);n.SynchronizeTransform();r.SynchronizeTransform();return a.Abs(m)<i.b2_linearSlop};Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef);c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;c.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};c.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};c.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n));var r=n.x-i.x;var a=n.y-i.y;this.length=Math.sqrt(r*r+a*a);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(p,Box2D.Dynamics.Joints.b2Joint);p.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;p.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new l;this.m_localAnchorB=new l;this.m_linearMass=new n;this.m_linearImpulse=new l};p.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};p.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};p.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)};p.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_angularImpulse};p.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};p.prototype.GetMaxForce=function(){return this.m_maxForce};p.prototype.SetMaxTorque=function(t){if(t===undefined)t=0;this.m_maxTorque=t};p.prototype.GetMaxTorque=function(){return this.m_maxTorque};p.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=t.maxForce;this.m_maxTorque=t.maxTorque};p.prototype.InitVelocityConstraints=function(t){var e;var i=0;var r=this.m_bodyA;var a=this.m_bodyB;e=r.m_xf.R;var o=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var s=this.m_localAnchorA.y-r.m_sweep.localCenter.y;i=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=i;e=a.m_xf.R;var l=this.m_localAnchorB.x-a.m_sweep.localCenter.x;var h=this.m_localAnchorB.y-a.m_sweep.localCenter.y;i=e.col1.x*l+e.col2.x*h;h=e.col1.y*l+e.col2.y*h;l=i;var u=r.m_invMass;var c=a.m_invMass;var p=r.m_invI;var f=a.m_invI;var m=new n;m.col1.x=u+c;m.col2.x=0;m.col1.y=0;m.col2.y=u+c;m.col1.x+=p*s*s;m.col2.x+=-p*o*s;m.col1.y+=-p*o*s;m.col2.y+=p*o*o;m.col1.x+=f*h*h;m.col2.x+=-f*l*h;m.col1.y+=-f*l*h;m.col2.y+=f*l*l;m.GetInverse(this.m_linearMass);this.m_angularMass=p+f;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(t.warmStarting){this.m_linearImpulse.x*=t.dtRatio;this.m_linearImpulse.y*=t.dtRatio;this.m_angularImpulse*=t.dtRatio;var d=this.m_linearImpulse;r.m_linearVelocity.x-=u*d.x;r.m_linearVelocity.y-=u*d.y;r.m_angularVelocity-=p*(o*d.y-s*d.x+this.m_angularImpulse);a.m_linearVelocity.x+=c*d.x;a.m_linearVelocity.y+=c*d.y;a.m_angularVelocity+=f*(l*d.y-h*d.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};p.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;var o=n.m_linearVelocity;var s=n.m_angularVelocity;var h=r.m_linearVelocity;var u=r.m_angularVelocity;var c=n.m_invMass;var p=r.m_invMass;var f=n.m_invI;var m=r.m_invI;e=n.m_xf.R;var d=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var y=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*d+e.col2.x*y;y=e.col1.y*d+e.col2.y*y;d=i;e=r.m_xf.R;var v=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var g=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*v+e.col2.x*g;g=e.col1.y*v+e.col2.y*g;v=i;var _=0;{var I=u-s;var x=-this.m_angularMass*I;var w=this.m_angularImpulse;_=t.dt*this.m_maxTorque;this.m_angularImpulse=a.Clamp(this.m_angularImpulse+x,-_,_);x=this.m_angularImpulse-w;s-=f*x;u+=m*x}{var S=h.x-u*g-o.x+s*y;var b=h.y+u*v-o.y-s*d;var C=a.MulMV(this.m_linearMass,new l(-S,-b));var T=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(C);_=t.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>_*_){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(_)}C=a.SubtractVV(this.m_linearImpulse,T);o.x-=c*C.x;o.y-=c*C.y;s-=f*(d*C.y-y*C.x);h.x+=p*C.x;h.y+=p*C.y;u+=m*(v*C.y-g*C.x)}n.m_angularVelocity=s;r.m_angularVelocity=u};p.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(f,Box2D.Dynamics.Joints.b2JointDef);f.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;f.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};f.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_frictionJoint;this.maxForce=0;this.maxTorque=0};f.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))};Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint);m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;m.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new l;this.m_groundAnchor2=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_J=new y};m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};m.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)};m.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;var e=this.m_bodyB.m_xf.R;var i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x;var n=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y;var r=e.col1.x*i+e.col2.x*n;n=e.col1.y*i+e.col2.y*n;i=r;var a=this.m_impulse*this.m_J.linearB.x;var o=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*o+n*a)};m.prototype.GetRatio=function(){return this.m_ratio};m.prototype.SetRatio=function(t){if(t===undefined)t=0;this.m_ratio=t};m.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type);var i=parseInt(t.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var n=0;var r=0;this.m_ground1=t.joint1.GetBodyA();this.m_bodyA=t.joint1.GetBodyB();if(e==v.e_revoluteJoint){this.m_revolute1=t.joint1 instanceof U?t.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);n=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=t.joint1 instanceof b?t.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);n=this.m_prismatic1.GetJointTranslation()}this.m_ground2=t.joint2.GetBodyA();this.m_bodyB=t.joint2.GetBodyB();if(i==v.e_revoluteJoint){this.m_revolute2=t.joint2 instanceof U?t.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);r=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=t.joint2 instanceof b?t.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);r=this.m_prismatic2.GetJointTranslation()}this.m_ratio=t.ratio;this.m_constant=n+this.m_ratio*r;this.m_impulse=0};m.prototype.InitVelocityConstraints=function(t){var e=this.m_ground1;var i=this.m_ground2;var n=this.m_bodyA;var r=this.m_bodyB;var a=0;var o=0;var s=0;var l=0;var h;var u;var c=0;var p=0;var f=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;f+=n.m_invI}else{h=e.m_xf.R;u=this.m_prismatic1.m_localXAxis1;a=h.col1.x*u.x+h.col2.x*u.y;o=h.col1.y*u.x+h.col2.y*u.y;h=n.m_xf.R;s=this.m_localAnchor1.x-n.m_sweep.localCenter.x;l=this.m_localAnchor1.y-n.m_sweep.localCenter.y;p=h.col1.x*s+h.col2.x*l;l=h.col1.y*s+h.col2.y*l;s=p;c=s*o-l*a;this.m_J.linearA.Set(-a,-o);this.m_J.angularA=-c;f+=n.m_invMass+n.m_invI*c*c}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;f+=this.m_ratio*this.m_ratio*r.m_invI;
}else{h=i.m_xf.R;u=this.m_prismatic2.m_localXAxis1;a=h.col1.x*u.x+h.col2.x*u.y;o=h.col1.y*u.x+h.col2.y*u.y;h=r.m_xf.R;s=this.m_localAnchor2.x-r.m_sweep.localCenter.x;l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;p=h.col1.x*s+h.col2.x*l;l=h.col1.y*s+h.col2.y*l;s=p;c=s*o-l*a;this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*o);this.m_J.angularB=-this.m_ratio*c;f+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*c*c)}this.m_mass=f>0?1/f:0;if(t.warmStarting){n.m_linearVelocity.x+=n.m_invMass*this.m_impulse*this.m_J.linearA.x;n.m_linearVelocity.y+=n.m_invMass*this.m_impulse*this.m_J.linearA.y;n.m_angularVelocity+=n.m_invI*this.m_impulse*this.m_J.angularA;r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x;r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y;r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};m.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity);var r=-this.m_mass*n;this.m_impulse+=r;e.m_linearVelocity.x+=e.m_invMass*r*this.m_J.linearA.x;e.m_linearVelocity.y+=e.m_invMass*r*this.m_J.linearA.y;e.m_angularVelocity+=e.m_invI*r*this.m_J.angularA;i.m_linearVelocity.x+=i.m_invMass*r*this.m_J.linearB.x;i.m_linearVelocity.y+=i.m_invMass*r*this.m_J.linearB.y;i.m_angularVelocity+=i.m_invI*r*this.m_J.angularB};m.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var n=this.m_bodyA;var r=this.m_bodyB;var a=0;var o=0;if(this.m_revolute1){a=this.m_revolute1.GetJointAngle()}else{a=this.m_prismatic1.GetJointTranslation()}if(this.m_revolute2){o=this.m_revolute2.GetJointAngle()}else{o=this.m_prismatic2.GetJointTranslation()}var s=this.m_constant-(a+this.m_ratio*o);var l=-this.m_mass*s;n.m_sweep.c.x+=n.m_invMass*l*this.m_J.linearA.x;n.m_sweep.c.y+=n.m_invMass*l*this.m_J.linearA.y;n.m_sweep.a+=n.m_invI*l*this.m_J.angularA;r.m_sweep.c.x+=r.m_invMass*l*this.m_J.linearB.x;r.m_sweep.c.y+=r.m_invMass*l*this.m_J.linearB.y;r.m_sweep.a+=r.m_invI*l*this.m_J.angularB;n.SynchronizeTransform();r.SynchronizeTransform();return e<i.b2_linearSlop};Box2D.inherit(d,Box2D.Dynamics.Joints.b2JointDef);d.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;d.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};d.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};y.b2Jacobian=function(){this.linearA=new l;this.linearB=new l};y.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};y.prototype.Set=function(t,e,i,n){if(e===undefined)e=0;if(n===undefined)n=0;this.linearA.SetV(t);this.angularA=e;this.linearB.SetV(i);this.angularB=n};y.prototype.Compute=function(t,e,i,n){if(e===undefined)e=0;if(n===undefined)n=0;return this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*n};v.b2Joint=function(){this.m_edgeA=new _;this.m_edgeB=new _;this.m_localCenterA=new l;this.m_localCenterB=new l};v.prototype.GetType=function(){return this.m_type};v.prototype.GetAnchorA=function(){return null};v.prototype.GetAnchorB=function(){return null};v.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return null};v.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};v.prototype.GetBodyA=function(){return this.m_bodyA};v.prototype.GetBodyB=function(){return this.m_bodyB};v.prototype.GetNext=function(){return this.m_next};v.prototype.GetUserData=function(){return this.m_userData};v.prototype.SetUserData=function(t){this.m_userData=t};v.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};v.Create=function(t,e){var i=null;switch(t.type){case v.e_distanceJoint:{i=new u(t instanceof c?t:null)}break;case v.e_mouseJoint:{i=new w(t instanceof S?t:null)}break;case v.e_prismaticJoint:{i=new b(t instanceof C?t:null)}break;case v.e_revoluteJoint:{i=new U(t instanceof A?t:null)}break;case v.e_pulleyJoint:{i=new T(t instanceof D?t:null)}break;case v.e_gearJoint:{i=new m(t instanceof d?t:null)}break;case v.e_lineJoint:{i=new I(t instanceof x?t:null)}break;case v.e_weldJoint:{i=new E(t instanceof M?t:null)}break;case v.e_frictionJoint:{i=new p(t instanceof f?t:null)}break;default:break}return i};v.Destroy=function(t,e){};v.prototype.b2Joint=function(t){i.b2Assert(t.bodyA!=t.bodyB);this.m_type=t.type;this.m_prev=null;this.m_next=null;this.m_bodyA=t.bodyA;this.m_bodyB=t.bodyB;this.m_collideConnected=t.collideConnected;this.m_islandFlag=false;this.m_userData=t.userData};v.prototype.InitVelocityConstraints=function(t){};v.prototype.SolveVelocityConstraints=function(t){};v.prototype.FinalizeVelocityConstraints=function(){};v.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return false};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});g.b2JointDef=function(){};g.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=false};_.b2JointEdge=function(){};Box2D.inherit(I,Box2D.Dynamics.Joints.b2Joint);I.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;I.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_localXAxis1=new l;this.m_localYAxis1=new l;this.m_axis=new l;this.m_perp=new l;this.m_K=new n;this.m_impulse=new l};I.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};I.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};I.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};I.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};I.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var n=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var a=r.x-n.x;var o=r.y-n.y;var s=t.GetWorldVector(this.m_localXAxis1);var l=s.x*a+s.y*o;return l};I.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var a=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r;n=a;i=e.m_xf.R;var o=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var s=this.m_localAnchor2.y-e.m_sweep.localCenter.y;a=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s;o=a;var l=t.m_sweep.c.x+n;var h=t.m_sweep.c.y+r;var u=e.m_sweep.c.x+o;var c=e.m_sweep.c.y+s;var p=u-l;var f=c-h;var m=t.GetWorldVector(this.m_localXAxis1);var d=t.m_linearVelocity;var y=e.m_linearVelocity;var v=t.m_angularVelocity;var g=e.m_angularVelocity;var _=p*(-v*m.y)+f*(v*m.x)+(m.x*(y.x+-g*s-d.x- -v*r)+m.y*(y.y+g*o-d.y-v*n));return _};I.prototype.IsLimitEnabled=function(){return this.m_enableLimit};I.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};I.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};I.prototype.GetUpperLimit=function(){return this.m_upperTranslation};I.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};I.prototype.IsMotorEnabled=function(){return this.m_enableMotor};I.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};I.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};I.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};I.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};I.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};I.prototype.GetMotorForce=function(){return this.m_motorImpulse};I.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};I.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var o=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var s=e.GetTransform();var l=n.GetTransform();r=e.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x;var u=this.m_localAnchor1.y-this.m_localCenterA.y;o=r.col1.x*h+r.col2.x*u;u=r.col1.y*h+r.col2.y*u;h=o;r=n.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x;var p=this.m_localAnchor2.y-this.m_localCenterB.y;o=r.col1.x*c+r.col2.x*p;p=r.col1.y*c+r.col2.y*p;c=o;var f=n.m_sweep.c.x+c-e.m_sweep.c.x-h;var m=n.m_sweep.c.y+p-e.m_sweep.c.y-u;this.m_invMassA=e.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=n.m_invI;{this.m_axis.SetV(a.MulMV(s.R,this.m_localXAxis1));this.m_a1=(f+h)*this.m_axis.y-(m+u)*this.m_axis.x;this.m_a2=c*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Box2D.MIN_VALUE?1/this.m_motorMass:0}{this.m_perp.SetV(a.MulMV(s.R,this.m_localYAxis1));this.m_s1=(f+h)*this.m_perp.y-(m+u)*this.m_perp.x;this.m_s2=c*this.m_perp.y-p*this.m_perp.x;var d=this.m_invMassA;var y=this.m_invMassB;var g=this.m_invIA;var _=this.m_invIB;this.m_K.col1.x=d+y+g*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=g*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=d+y+g*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2}if(this.m_enableLimit){var I=this.m_axis.x*f+this.m_axis.y*m;if(a.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=v.e_equalLimits}else if(I<=this.m_lowerTranslation){if(this.m_limitState!=v.e_atLowerLimit){this.m_limitState=v.e_atLowerLimit;this.m_impulse.y=0}}else if(I>=this.m_upperTranslation){if(this.m_limitState!=v.e_atUpperLimit){this.m_limitState=v.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=v.e_inactiveLimit;this.m_impulse.y=0}}else{this.m_limitState=v.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var x=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;var w=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;var S=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;var b=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*x;e.m_linearVelocity.y-=this.m_invMassA*w;e.m_angularVelocity-=this.m_invIA*S;n.m_linearVelocity.x+=this.m_invMassB*x;n.m_linearVelocity.y+=this.m_invMassB*w;n.m_angularVelocity+=this.m_invIB*b}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};I.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=e.m_linearVelocity;var r=e.m_angularVelocity;var o=i.m_linearVelocity;var s=i.m_angularVelocity;var h=0;var u=0;var c=0;var p=0;if(this.m_enableMotor&&this.m_limitState!=v.e_equalLimits){var f=this.m_axis.x*(o.x-n.x)+this.m_axis.y*(o.y-n.y)+this.m_a2*s-this.m_a1*r;var m=this.m_motorMass*(this.m_motorSpeed-f);var d=this.m_motorImpulse;var y=t.dt*this.m_maxMotorForce;this.m_motorImpulse=a.Clamp(this.m_motorImpulse+m,-y,y);m=this.m_motorImpulse-d;h=m*this.m_axis.x;u=m*this.m_axis.y;c=m*this.m_a1;p=m*this.m_a2;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*c;o.x+=this.m_invMassB*h;o.y+=this.m_invMassB*u;s+=this.m_invIB*p}var g=this.m_perp.x*(o.x-n.x)+this.m_perp.y*(o.y-n.y)+this.m_s2*s-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){var _=this.m_axis.x*(o.x-n.x)+this.m_axis.y*(o.y-n.y)+this.m_a2*s-this.m_a1*r;var I=this.m_impulse.Copy();var x=this.m_K.Solve(new l,-g,-_);this.m_impulse.Add(x);if(this.m_limitState==v.e_atLowerLimit){this.m_impulse.y=a.Max(this.m_impulse.y,0)}else if(this.m_limitState==v.e_atUpperLimit){this.m_impulse.y=a.Min(this.m_impulse.y,0)}var w=-g-(this.m_impulse.y-I.y)*this.m_K.col2.x;var S=0;if(this.m_K.col1.x!=0){S=w/this.m_K.col1.x+I.x}else{S=I.x}this.m_impulse.x=S;x.x=this.m_impulse.x-I.x;x.y=this.m_impulse.y-I.y;h=x.x*this.m_perp.x+x.y*this.m_axis.x;u=x.x*this.m_perp.y+x.y*this.m_axis.y;c=x.x*this.m_s1+x.y*this.m_a1;p=x.x*this.m_s2+x.y*this.m_a2;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*c;o.x+=this.m_invMassB*h;o.y+=this.m_invMassB*u;s+=this.m_invIB*p}else{var b=0;if(this.m_K.col1.x!=0){b=-g/this.m_K.col1.x}else{b=0}this.m_impulse.x+=b;h=b*this.m_perp.x;u=b*this.m_perp.y;c=b*this.m_s1;p=b*this.m_s2;n.x-=this.m_invMassA*h;n.y-=this.m_invMassA*u;r-=this.m_invIA*c;o.x+=this.m_invMassB*h;o.y+=this.m_invMassB*u;s+=this.m_invIB*p}e.m_linearVelocity.SetV(n);e.m_angularVelocity=r;i.m_linearVelocity.SetV(o);i.m_angularVelocity=s};I.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var o=this.m_bodyA;var s=this.m_bodyB;var h=o.m_sweep.c;var u=o.m_sweep.a;var c=s.m_sweep.c;var p=s.m_sweep.a;var f;var m=0;var d=0;var y=0;var v=0;var g=0;var _=0;var I=0;var x=false;var w=0;var S=n.FromAngle(u);var b=n.FromAngle(p);f=S;var C=this.m_localAnchor1.x-this.m_localCenterA.x;var T=this.m_localAnchor1.y-this.m_localCenterA.y;m=f.col1.x*C+f.col2.x*T;T=f.col1.y*C+f.col2.y*T;C=m;f=b;var D=this.m_localAnchor2.x-this.m_localCenterB.x;var U=this.m_localAnchor2.y-this.m_localCenterB.y;m=f.col1.x*D+f.col2.x*U;U=f.col1.y*D+f.col2.y*U;D=m;var A=c.x+D-h.x-C;var E=c.y+U-h.y-T;if(this.m_enableLimit){this.m_axis=a.MulMV(S,this.m_localXAxis1);this.m_a1=(A+C)*this.m_axis.y-(E+T)*this.m_axis.x;this.m_a2=D*this.m_axis.y-U*this.m_axis.x;var M=this.m_axis.x*A+this.m_axis.y*E;if(a.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){w=a.Clamp(M,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);_=a.Abs(M);x=true}else if(M<=this.m_lowerTranslation){w=a.Clamp(M-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);_=this.m_lowerTranslation-M;x=true}else if(M>=this.m_upperTranslation){w=a.Clamp(M-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);_=M-this.m_upperTranslation;x=true}}this.m_perp=a.MulMV(S,this.m_localYAxis1);this.m_s1=(A+C)*this.m_perp.y-(E+T)*this.m_perp.x;this.m_s2=D*this.m_perp.y-U*this.m_perp.x;var P=new l;var B=this.m_perp.x*A+this.m_perp.y*E;_=a.Max(_,a.Abs(B));I=0;if(x){d=this.m_invMassA;y=this.m_invMassB;v=this.m_invIA;g=this.m_invIB;this.m_K.col1.x=d+y+v*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=d+y+v*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2;this.m_K.Solve(P,-B,-w)}else{d=this.m_invMassA;y=this.m_invMassB;v=this.m_invIA;g=this.m_invIB;var L=d+y+v*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2;var R=0;if(L!=0){R=-B/L}else{R=0}P.x=R;P.y=0}var O=P.x*this.m_perp.x+P.y*this.m_axis.x;var V=P.x*this.m_perp.y+P.y*this.m_axis.y;var F=P.x*this.m_s1+P.y*this.m_a1;var k=P.x*this.m_s2+P.y*this.m_a2;h.x-=this.m_invMassA*O;h.y-=this.m_invMassA*V;u-=this.m_invIA*F;c.x+=this.m_invMassB*O;c.y+=this.m_invMassB*V;p+=this.m_invIB*k;o.m_sweep.a=u;s.m_sweep.a=p;o.SynchronizeTransform();s.SynchronizeTransform();return _<=i.b2_linearSlop&&I<=i.b2_angularSlop};Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef);x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;x.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l;this.localAxisA=new l};x.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};x.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(n)};Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint);w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;w.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.m_localAnchor=new l;this.m_target=new l;this.m_impulse=new l;this.m_mass=new n;this.m_C=new l};w.prototype.GetAnchorA=function(){return this.m_target};w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};w.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};w.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};w.prototype.GetTarget=function(){return this.m_target};w.prototype.SetTarget=function(t){if(this.m_bodyB.IsAwake()==false){this.m_bodyB.SetAwake(true)}this.m_target=t};w.prototype.GetMaxForce=function(){return this.m_maxForce};w.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};w.prototype.GetFrequency=function(){return this.m_frequencyHz};w.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};w.prototype.GetDampingRatio=function(){return this.m_dampingRatio};w.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};w.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t);this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x;var i=this.m_target.y-this.m_bodyB.m_xf.position.y;var n=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*n.col1.x+i*n.col1.y;this.m_localAnchor.y=e*n.col2.x+i*n.col2.y;this.m_maxForce=t.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_beta=0;this.m_gamma=0};w.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB;var i=e.GetMass();var n=2*Math.PI*this.m_frequencyHz;var r=2*i*this.m_dampingRatio*n;var a=i*n*n;this.m_gamma=t.dt*(r+t.dt*a);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=t.dt*a*this.m_gamma;var o;o=e.m_xf.R;var s=this.m_localAnchor.x-e.m_sweep.localCenter.x;var l=this.m_localAnchor.y-e.m_sweep.localCenter.y;var h=o.col1.x*s+o.col2.x*l;l=o.col1.y*s+o.col2.y*l;s=h;var u=e.m_invMass;var c=e.m_invI;this.K1.col1.x=u;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=u;this.K2.col1.x=c*l*l;this.K2.col2.x=-c*s*l;this.K2.col1.y=-c*s*l;this.K2.col2.y=c*s*s;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=e.m_sweep.c.x+s-this.m_target.x;this.m_C.y=e.m_sweep.c.y+l-this.m_target.y;e.m_angularVelocity*=.98;this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;e.m_linearVelocity.x+=u*this.m_impulse.x;e.m_linearVelocity.y+=u*this.m_impulse.y;e.m_angularVelocity+=c*(s*this.m_impulse.y-l*this.m_impulse.x)};w.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyB;var i;var n=0;var r=0;i=e.m_xf.R;var a=this.m_localAnchor.x-e.m_sweep.localCenter.x;var o=this.m_localAnchor.y-e.m_sweep.localCenter.y;n=i.col1.x*a+i.col2.x*o;o=i.col1.y*a+i.col2.y*o;a=n;var s=e.m_linearVelocity.x+-e.m_angularVelocity*o;var l=e.m_linearVelocity.y+e.m_angularVelocity*a;i=this.m_mass;n=s+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;r=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var h=-(i.col1.x*n+i.col2.x*r);var u=-(i.col1.y*n+i.col2.y*r);var c=this.m_impulse.x;var p=this.m_impulse.y;this.m_impulse.x+=h;this.m_impulse.y+=u;var f=t.dt*this.m_maxForce;if(this.m_impulse.LengthSquared()>f*f){this.m_impulse.Multiply(f/this.m_impulse.Length())}h=this.m_impulse.x-c;u=this.m_impulse.y-p;e.m_linearVelocity.x+=e.m_invMass*h;e.m_linearVelocity.y+=e.m_invMass*u;e.m_angularVelocity+=e.m_invI*(a*u-o*h)};w.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(S,Box2D.Dynamics.Joints.b2JointDef);S.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;S.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new l};S.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(b,Box2D.Dynamics.Joints.b2Joint);b.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;b.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_localXAxis1=new l;this.m_localYAxis1=new l;this.m_axis=new l;this.m_perp=new l;this.m_K=new r;this.m_impulse=new h};b.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};b.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};b.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};b.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var n=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var a=r.x-n.x;var o=r.y-n.y;var s=t.GetWorldVector(this.m_localXAxis1);var l=s.x*a+s.y*o;return l};b.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var n=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var a=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r;n=a;i=e.m_xf.R;var o=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var s=this.m_localAnchor2.y-e.m_sweep.localCenter.y;a=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s;o=a;var l=t.m_sweep.c.x+n;var h=t.m_sweep.c.y+r;var u=e.m_sweep.c.x+o;var c=e.m_sweep.c.y+s;var p=u-l;var f=c-h;var m=t.GetWorldVector(this.m_localXAxis1);var d=t.m_linearVelocity;var y=e.m_linearVelocity;var v=t.m_angularVelocity;var g=e.m_angularVelocity;var _=p*(-v*m.y)+f*(v*m.x)+(m.x*(y.x+-g*s-d.x- -v*r)+m.y*(y.y+g*o-d.y-v*n));return _};b.prototype.IsLimitEnabled=function(){return this.m_enableLimit};b.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};b.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};b.prototype.GetUpperLimit=function(){return this.m_upperTranslation};b.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};b.prototype.IsMotorEnabled=function(){return this.m_enableMotor};b.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};b.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};b.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};b.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};b.prototype.GetMotorForce=function(){return this.m_motorImpulse};b.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};b.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var o=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var s=e.GetTransform();var l=n.GetTransform();r=e.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x;var u=this.m_localAnchor1.y-this.m_localCenterA.y;o=r.col1.x*h+r.col2.x*u;u=r.col1.y*h+r.col2.y*u;h=o;r=n.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x;var p=this.m_localAnchor2.y-this.m_localCenterB.y;o=r.col1.x*c+r.col2.x*p;p=r.col1.y*c+r.col2.y*p;c=o;var f=n.m_sweep.c.x+c-e.m_sweep.c.x-h;var m=n.m_sweep.c.y+p-e.m_sweep.c.y-u;this.m_invMassA=e.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=n.m_invI;{this.m_axis.SetV(a.MulMV(s.R,this.m_localXAxis1));this.m_a1=(f+h)*this.m_axis.y-(m+u)*this.m_axis.x;this.m_a2=c*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Box2D.MIN_VALUE)this.m_motorMass=1/this.m_motorMass}{this.m_perp.SetV(a.MulMV(s.R,this.m_localYAxis1));this.m_s1=(f+h)*this.m_perp.y-(m+u)*this.m_perp.x;this.m_s2=c*this.m_perp.y-p*this.m_perp.x;var d=this.m_invMassA;var y=this.m_invMassB;var g=this.m_invIA;var _=this.m_invIB;this.m_K.col1.x=d+y+g*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=g*this.m_s1+_*this.m_s2;this.m_K.col1.z=g*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=g+_;this.m_K.col2.z=g*this.m_a1+_*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=d+y+g*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2}if(this.m_enableLimit){var I=this.m_axis.x*f+this.m_axis.y*m;if(a.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=v.e_equalLimits}else if(I<=this.m_lowerTranslation){if(this.m_limitState!=v.e_atLowerLimit){this.m_limitState=v.e_atLowerLimit;this.m_impulse.z=0}}else if(I>=this.m_upperTranslation){if(this.m_limitState!=v.e_atUpperLimit){this.m_limitState=v.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=v.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=v.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var x=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;var w=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;var S=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;var b=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*x;e.m_linearVelocity.y-=this.m_invMassA*w;e.m_angularVelocity-=this.m_invIA*S;n.m_linearVelocity.x+=this.m_invMassB*x;n.m_linearVelocity.y+=this.m_invMassB*w;n.m_angularVelocity+=this.m_invIB*b}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};b.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n=e.m_linearVelocity;var r=e.m_angularVelocity;var o=i.m_linearVelocity;var s=i.m_angularVelocity;var u=0;var c=0;var p=0;var f=0;if(this.m_enableMotor&&this.m_limitState!=v.e_equalLimits){var m=this.m_axis.x*(o.x-n.x)+this.m_axis.y*(o.y-n.y)+this.m_a2*s-this.m_a1*r;var d=this.m_motorMass*(this.m_motorSpeed-m);var y=this.m_motorImpulse;var g=t.dt*this.m_maxMotorForce;this.m_motorImpulse=a.Clamp(this.m_motorImpulse+d,-g,g);d=this.m_motorImpulse-y;u=d*this.m_axis.x;c=d*this.m_axis.y;p=d*this.m_a1;f=d*this.m_a2;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*c;r-=this.m_invIA*p;o.x+=this.m_invMassB*u;o.y+=this.m_invMassB*c;s+=this.m_invIB*f}var _=this.m_perp.x*(o.x-n.x)+this.m_perp.y*(o.y-n.y)+this.m_s2*s-this.m_s1*r;var I=s-r;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){var x=this.m_axis.x*(o.x-n.x)+this.m_axis.y*(o.y-n.y)+this.m_a2*s-this.m_a1*r;var w=this.m_impulse.Copy();var S=this.m_K.Solve33(new h,-_,-I,-x);this.m_impulse.Add(S);if(this.m_limitState==v.e_atLowerLimit){this.m_impulse.z=a.Max(this.m_impulse.z,0)}else if(this.m_limitState==v.e_atUpperLimit){this.m_impulse.z=a.Min(this.m_impulse.z,0)}var b=-_-(this.m_impulse.z-w.z)*this.m_K.col3.x;var C=-I-(this.m_impulse.z-w.z)*this.m_K.col3.y;var T=this.m_K.Solve22(new l,b,C);T.x+=w.x;T.y+=w.y;this.m_impulse.x=T.x;this.m_impulse.y=T.y;S.x=this.m_impulse.x-w.x;S.y=this.m_impulse.y-w.y;S.z=this.m_impulse.z-w.z;u=S.x*this.m_perp.x+S.z*this.m_axis.x;c=S.x*this.m_perp.y+S.z*this.m_axis.y;p=S.x*this.m_s1+S.y+S.z*this.m_a1;f=S.x*this.m_s2+S.y+S.z*this.m_a2;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*c;r-=this.m_invIA*p;o.x+=this.m_invMassB*u;o.y+=this.m_invMassB*c;s+=this.m_invIB*f}else{var D=this.m_K.Solve22(new l,-_,-I);this.m_impulse.x+=D.x;this.m_impulse.y+=D.y;u=D.x*this.m_perp.x;c=D.x*this.m_perp.y;p=D.x*this.m_s1+D.y;f=D.x*this.m_s2+D.y;n.x-=this.m_invMassA*u;n.y-=this.m_invMassA*c;r-=this.m_invIA*p;o.x+=this.m_invMassB*u;o.y+=this.m_invMassB*c;s+=this.m_invIB*f}e.m_linearVelocity.SetV(n);e.m_angularVelocity=r;i.m_linearVelocity.SetV(o);i.m_angularVelocity=s};b.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var o=this.m_bodyA;var s=this.m_bodyB;var u=o.m_sweep.c;var c=o.m_sweep.a;var p=s.m_sweep.c;var f=s.m_sweep.a;var m;var d=0;var y=0;var v=0;var g=0;var _=0;var I=0;var x=0;var w=false;var S=0;var b=n.FromAngle(c);var C=n.FromAngle(f);m=b;var T=this.m_localAnchor1.x-this.m_localCenterA.x;var D=this.m_localAnchor1.y-this.m_localCenterA.y;d=m.col1.x*T+m.col2.x*D;D=m.col1.y*T+m.col2.y*D;T=d;m=C;var U=this.m_localAnchor2.x-this.m_localCenterB.x;var A=this.m_localAnchor2.y-this.m_localCenterB.y;d=m.col1.x*U+m.col2.x*A;A=m.col1.y*U+m.col2.y*A;U=d;var E=p.x+U-u.x-T;var M=p.y+A-u.y-D;if(this.m_enableLimit){this.m_axis=a.MulMV(b,this.m_localXAxis1);this.m_a1=(E+T)*this.m_axis.y-(M+D)*this.m_axis.x;this.m_a2=U*this.m_axis.y-A*this.m_axis.x;var P=this.m_axis.x*E+this.m_axis.y*M;if(a.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){S=a.Clamp(P,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);I=a.Abs(P);w=true}else if(P<=this.m_lowerTranslation){S=a.Clamp(P-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);I=this.m_lowerTranslation-P;w=true}else if(P>=this.m_upperTranslation){S=a.Clamp(P-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);I=P-this.m_upperTranslation;w=true}}this.m_perp=a.MulMV(b,this.m_localYAxis1);
this.m_s1=(E+T)*this.m_perp.y-(M+D)*this.m_perp.x;this.m_s2=U*this.m_perp.y-A*this.m_perp.x;var B=new h;var L=this.m_perp.x*E+this.m_perp.y*M;var R=f-c-this.m_refAngle;I=a.Max(I,a.Abs(L));x=a.Abs(R);if(w){y=this.m_invMassA;v=this.m_invMassB;g=this.m_invIA;_=this.m_invIB;this.m_K.col1.x=y+v+g*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;this.m_K.col1.y=g*this.m_s1+_*this.m_s2;this.m_K.col1.z=g*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=g+_;this.m_K.col2.z=g*this.m_a1+_*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=y+v+g*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2;this.m_K.Solve33(B,-L,-R,-S)}else{y=this.m_invMassA;v=this.m_invMassB;g=this.m_invIA;_=this.m_invIB;var O=y+v+g*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2;var V=g*this.m_s1+_*this.m_s2;var F=g+_;this.m_K.col1.Set(O,V,0);this.m_K.col2.Set(V,F,0);var k=this.m_K.Solve22(new l,-L,-R);B.x=k.x;B.y=k.y;B.z=0}var N=B.x*this.m_perp.x+B.z*this.m_axis.x;var G=B.x*this.m_perp.y+B.z*this.m_axis.y;var W=B.x*this.m_s1+B.y+B.z*this.m_a1;var H=B.x*this.m_s2+B.y+B.z*this.m_a2;u.x-=this.m_invMassA*N;u.y-=this.m_invMassA*G;c-=this.m_invIA*W;p.x+=this.m_invMassB*N;p.y+=this.m_invMassB*G;f+=this.m_invIB*H;o.m_sweep.a=c;s.m_sweep.a=f;o.SynchronizeTransform();s.SynchronizeTransform();return I<=i.b2_linearSlop&&x<=i.b2_angularSlop};Box2D.inherit(C,Box2D.Dynamics.Joints.b2JointDef);C.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;C.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l;this.localAxisA=new l};C.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};C.prototype.Initialize=function(t,e,i,n){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(n);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint);T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;T.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new l;this.m_groundAnchor2=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_u1=new l;this.m_u2=new l};T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};T.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)};T.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};T.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor1);return t};T.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor2);return t};T.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var n=t.x-e;var r=t.y-i;return Math.sqrt(n*n+r*r)};T.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var n=t.x-e;var r=t.y-i;return Math.sqrt(n*n+r*r)};T.prototype.GetRatio=function(){return this.m_ratio};T.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var n=0;this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_ratio=t.ratio;this.m_constant=t.lengthA+this.m_ratio*t.lengthB;this.m_maxLength1=a.Min(t.maxLengthA,this.m_constant-this.m_ratio*T.b2_minPulleyLength);this.m_maxLength2=a.Min(t.maxLengthB,(this.m_constant-T.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};T.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;r=e.m_xf.R;var a=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=r.col1.x*a+r.col2.x*o;o=r.col1.y*a+r.col2.y*o;a=s;r=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=r.col1.x*l+r.col2.x*h;h=r.col1.y*l+r.col2.y*h;l=s;var u=e.m_sweep.c.x+a;var c=e.m_sweep.c.y+o;var p=n.m_sweep.c.x+l;var f=n.m_sweep.c.y+h;var m=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var d=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var y=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(u-m,c-d);this.m_u2.Set(p-y,f-g);var _=this.m_u1.Length();var I=this.m_u2.Length();if(_>i.b2_linearSlop){this.m_u1.Multiply(1/_)}else{this.m_u1.SetZero()}if(I>i.b2_linearSlop){this.m_u2.Multiply(1/I)}else{this.m_u2.SetZero()}var x=this.m_constant-_-this.m_ratio*I;if(x>0){this.m_state=v.e_inactiveLimit;this.m_impulse=0}else{this.m_state=v.e_atUpperLimit}if(_<this.m_maxLength1){this.m_limitState1=v.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=v.e_atUpperLimit}if(I<this.m_maxLength2){this.m_limitState2=v.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=v.e_atUpperLimit}var w=a*this.m_u1.y-o*this.m_u1.x;var S=l*this.m_u2.y-h*this.m_u2.x;this.m_limitMass1=e.m_invMass+e.m_invI*w*w;this.m_limitMass2=n.m_invMass+n.m_invI*S*S;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(t.warmStarting){this.m_impulse*=t.dtRatio;this.m_limitImpulse1*=t.dtRatio;this.m_limitImpulse2*=t.dtRatio;var b=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;var C=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;var T=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;var D=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*b;e.m_linearVelocity.y+=e.m_invMass*C;e.m_angularVelocity+=e.m_invI*(a*C-o*b);n.m_linearVelocity.x+=n.m_invMass*T;n.m_linearVelocity.y+=n.m_invMass*D;n.m_angularVelocity+=n.m_invI*(l*D-h*T)}else{this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0}};T.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=n.col1.x*r+n.col2.x*o;o=n.col1.y*r+n.col2.y*o;r=s;n=i.m_xf.R;var l=this.m_localAnchor2.x-i.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=n.col1.x*l+n.col2.x*h;h=n.col1.y*l+n.col2.y*h;l=s;var u=0;var c=0;var p=0;var f=0;var m=0;var d=0;var y=0;var g=0;var _=0;var I=0;var x=0;if(this.m_state==v.e_atUpperLimit){u=e.m_linearVelocity.x+-e.m_angularVelocity*o;c=e.m_linearVelocity.y+e.m_angularVelocity*r;p=i.m_linearVelocity.x+-i.m_angularVelocity*h;f=i.m_linearVelocity.y+i.m_angularVelocity*l;_=-(this.m_u1.x*u+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*p+this.m_u2.y*f);I=this.m_pulleyMass*-_;x=this.m_impulse;this.m_impulse=a.Max(0,this.m_impulse+I);I=this.m_impulse-x;m=-I*this.m_u1.x;d=-I*this.m_u1.y;y=-this.m_ratio*I*this.m_u2.x;g=-this.m_ratio*I*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*m;e.m_linearVelocity.y+=e.m_invMass*d;e.m_angularVelocity+=e.m_invI*(r*d-o*m);i.m_linearVelocity.x+=i.m_invMass*y;i.m_linearVelocity.y+=i.m_invMass*g;i.m_angularVelocity+=i.m_invI*(l*g-h*y)}if(this.m_limitState1==v.e_atUpperLimit){u=e.m_linearVelocity.x+-e.m_angularVelocity*o;c=e.m_linearVelocity.y+e.m_angularVelocity*r;_=-(this.m_u1.x*u+this.m_u1.y*c);I=-this.m_limitMass1*_;x=this.m_limitImpulse1;this.m_limitImpulse1=a.Max(0,this.m_limitImpulse1+I);I=this.m_limitImpulse1-x;m=-I*this.m_u1.x;d=-I*this.m_u1.y;e.m_linearVelocity.x+=e.m_invMass*m;e.m_linearVelocity.y+=e.m_invMass*d;e.m_angularVelocity+=e.m_invI*(r*d-o*m)}if(this.m_limitState2==v.e_atUpperLimit){p=i.m_linearVelocity.x+-i.m_angularVelocity*h;f=i.m_linearVelocity.y+i.m_angularVelocity*l;_=-(this.m_u2.x*p+this.m_u2.y*f);I=-this.m_limitMass2*_;x=this.m_limitImpulse2;this.m_limitImpulse2=a.Max(0,this.m_limitImpulse2+I);I=this.m_limitImpulse2-x;y=-I*this.m_u2.x;g=-I*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*y;i.m_linearVelocity.y+=i.m_invMass*g;i.m_angularVelocity+=i.m_invI*(l*g-h*y)}};T.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=this.m_bodyA;var n=this.m_bodyB;var r;var o=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var u=0;var c=0;var p=0;var f=0;var m=0;var d=0;var y=0;var g=0;var _=0;var I=0;var x=0;var w=0;var S=0;var b=0;var C=0;var T=0;if(this.m_state==v.e_atUpperLimit){r=e.m_xf.R;u=this.m_localAnchor1.x-e.m_sweep.localCenter.x;c=this.m_localAnchor1.y-e.m_sweep.localCenter.y;C=r.col1.x*u+r.col2.x*c;c=r.col1.y*u+r.col2.y*c;u=C;r=n.m_xf.R;p=this.m_localAnchor2.x-n.m_sweep.localCenter.x;f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;C=r.col1.x*p+r.col2.x*f;f=r.col1.y*p+r.col2.y*f;p=C;m=e.m_sweep.c.x+u;d=e.m_sweep.c.y+c;y=n.m_sweep.c.x+p;g=n.m_sweep.c.y+f;this.m_u1.Set(m-o,d-s);this.m_u2.Set(y-l,g-h);_=this.m_u1.Length();I=this.m_u2.Length();if(_>i.b2_linearSlop){this.m_u1.Multiply(1/_)}else{this.m_u1.SetZero()}if(I>i.b2_linearSlop){this.m_u2.Multiply(1/I)}else{this.m_u2.SetZero()}x=this.m_constant-_-this.m_ratio*I;T=a.Max(T,-x);x=a.Clamp(x+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);w=-this.m_pulleyMass*x;m=-w*this.m_u1.x;d=-w*this.m_u1.y;y=-this.m_ratio*w*this.m_u2.x;g=-this.m_ratio*w*this.m_u2.y;e.m_sweep.c.x+=e.m_invMass*m;e.m_sweep.c.y+=e.m_invMass*d;e.m_sweep.a+=e.m_invI*(u*d-c*m);n.m_sweep.c.x+=n.m_invMass*y;n.m_sweep.c.y+=n.m_invMass*g;n.m_sweep.a+=n.m_invI*(p*g-f*y);e.SynchronizeTransform();n.SynchronizeTransform()}if(this.m_limitState1==v.e_atUpperLimit){r=e.m_xf.R;u=this.m_localAnchor1.x-e.m_sweep.localCenter.x;c=this.m_localAnchor1.y-e.m_sweep.localCenter.y;C=r.col1.x*u+r.col2.x*c;c=r.col1.y*u+r.col2.y*c;u=C;m=e.m_sweep.c.x+u;d=e.m_sweep.c.y+c;this.m_u1.Set(m-o,d-s);_=this.m_u1.Length();if(_>i.b2_linearSlop){this.m_u1.x*=1/_;this.m_u1.y*=1/_}else{this.m_u1.SetZero()}x=this.m_maxLength1-_;T=a.Max(T,-x);x=a.Clamp(x+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);w=-this.m_limitMass1*x;m=-w*this.m_u1.x;d=-w*this.m_u1.y;e.m_sweep.c.x+=e.m_invMass*m;e.m_sweep.c.y+=e.m_invMass*d;e.m_sweep.a+=e.m_invI*(u*d-c*m);e.SynchronizeTransform()}if(this.m_limitState2==v.e_atUpperLimit){r=n.m_xf.R;p=this.m_localAnchor2.x-n.m_sweep.localCenter.x;f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;C=r.col1.x*p+r.col2.x*f;f=r.col1.y*p+r.col2.y*f;p=C;y=n.m_sweep.c.x+p;g=n.m_sweep.c.y+f;this.m_u2.Set(y-l,g-h);I=this.m_u2.Length();if(I>i.b2_linearSlop){this.m_u2.x*=1/I;this.m_u2.y*=1/I}else{this.m_u2.SetZero()}x=this.m_maxLength2-I;T=a.Max(T,-x);x=a.Clamp(x+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);w=-this.m_limitMass2*x;y=-w*this.m_u2.x;g=-w*this.m_u2.y;n.m_sweep.c.x+=n.m_invMass*y;n.m_sweep.c.y+=n.m_invMass*g;n.m_sweep.a+=n.m_invI*(p*g-f*y);n.SynchronizeTransform()}return T<i.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef);D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;D.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new l;this.groundAnchorB=new l;this.localAnchorA=new l;this.localAnchorB=new l};D.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=true};D.prototype.Initialize=function(t,e,i,n,r,a,o){if(o===undefined)o=0;this.bodyA=t;this.bodyB=e;this.groundAnchorA.SetV(i);this.groundAnchorB.SetV(n);this.localAnchorA=this.bodyA.GetLocalPoint(r);this.localAnchorB=this.bodyB.GetLocalPoint(a);var s=r.x-i.x;var l=r.y-i.y;this.lengthA=Math.sqrt(s*s+l*l);var h=a.x-n.x;var u=a.y-n.y;this.lengthB=Math.sqrt(h*h+u*u);this.ratio=o;var c=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=c-this.ratio*T.b2_minPulleyLength;this.maxLengthB=(c-T.b2_minPulleyLength)/this.ratio};Box2D.inherit(U,Box2D.Dynamics.Joints.b2Joint);U.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;U.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.K3=new n;this.impulse3=new h;this.impulse2=new l;this.reduced=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_impulse=new h;this.m_mass=new r};U.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};U.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};U.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};U.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};U.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};U.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};U.prototype.IsLimitEnabled=function(){return this.m_enableLimit};U.prototype.EnableLimit=function(t){this.m_enableLimit=t};U.prototype.GetLowerLimit=function(){return this.m_lowerAngle};U.prototype.GetUpperLimit=function(){return this.m_upperAngle};U.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_lowerAngle=t;this.m_upperAngle=e};U.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};U.prototype.EnableMotor=function(t){this.m_enableMotor=t};U.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};U.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};U.prototype.SetMaxMotorTorque=function(t){if(t===undefined)t=0;this.m_maxMotorTorque=t};U.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};U.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=t.lowerAngle;this.m_upperAngle=t.upperAngle;this.m_maxMotorTorque=t.maxMotorTorque;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=v.e_inactiveLimit};U.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var n=this.m_bodyB;var r;var o=0;if(this.m_enableMotor||this.m_enableLimit){}r=e.m_xf.R;var s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;o=r.col1.x*s+r.col2.x*l;l=r.col1.y*s+r.col2.y*l;s=o;r=n.m_xf.R;var h=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=r.col1.x*h+r.col2.x*u;u=r.col1.y*h+r.col2.y*u;h=o;var c=e.m_invMass;var p=n.m_invMass;var f=e.m_invI;var m=n.m_invI;this.m_mass.col1.x=c+p+l*l*f+u*u*m;this.m_mass.col2.x=-l*s*f-u*h*m;this.m_mass.col3.x=-l*f-u*m;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=c+p+s*s*f+h*h*m;this.m_mass.col3.y=s*f+h*m;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=f+m;this.m_motorMass=1/(f+m);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var d=n.m_sweep.a-e.m_sweep.a-this.m_referenceAngle;if(a.Abs(this.m_upperAngle-this.m_lowerAngle)<2*i.b2_angularSlop){this.m_limitState=v.e_equalLimits}else if(d<=this.m_lowerAngle){if(this.m_limitState!=v.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=v.e_atLowerLimit}else if(d>=this.m_upperAngle){if(this.m_limitState!=v.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=v.e_atUpperLimit}else{this.m_limitState=v.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=v.e_inactiveLimit}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var y=this.m_impulse.x;var g=this.m_impulse.y;e.m_linearVelocity.x-=c*y;e.m_linearVelocity.y-=c*g;e.m_angularVelocity-=f*(s*g-l*y+this.m_motorImpulse+this.m_impulse.z);n.m_linearVelocity.x+=p*y;n.m_linearVelocity.y+=p*g;n.m_angularVelocity+=m*(h*g-u*y+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};U.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var n;var r=0;var o=0;var s=0;var l=0;var h=0;var u=0;var c=e.m_linearVelocity;var p=e.m_angularVelocity;var f=i.m_linearVelocity;var m=i.m_angularVelocity;var d=e.m_invMass;var y=i.m_invMass;var g=e.m_invI;var _=i.m_invI;if(this.m_enableMotor&&this.m_limitState!=v.e_equalLimits){var I=m-p-this.m_motorSpeed;var x=this.m_motorMass*-I;var w=this.m_motorImpulse;var S=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=a.Clamp(this.m_motorImpulse+x,-S,S);x=this.m_motorImpulse-w;p-=g*x;m+=_*x}if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){n=e.m_xf.R;s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*l;l=n.col1.y*s+n.col2.y*l;s=r;n=i.m_xf.R;h=this.m_localAnchor2.x-i.m_sweep.localCenter.x;u=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*h+n.col2.x*u;u=n.col1.y*h+n.col2.y*u;h=r;var b=f.x+-m*u-c.x- -p*l;var C=f.y+m*h-c.y-p*s;var T=m-p;this.m_mass.Solve33(this.impulse3,-b,-C,-T);if(this.m_limitState==v.e_equalLimits){this.m_impulse.Add(this.impulse3)}else if(this.m_limitState==v.e_atLowerLimit){o=this.m_impulse.z+this.impulse3.z;if(o<0){this.m_mass.Solve22(this.reduced,-b,-C);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==v.e_atUpperLimit){o=this.m_impulse.z+this.impulse3.z;if(o>0){this.m_mass.Solve22(this.reduced,-b,-C);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}c.x-=d*this.impulse3.x;c.y-=d*this.impulse3.y;p-=g*(s*this.impulse3.y-l*this.impulse3.x+this.impulse3.z);f.x+=y*this.impulse3.x;f.y+=y*this.impulse3.y;m+=_*(h*this.impulse3.y-u*this.impulse3.x+this.impulse3.z)}else{n=e.m_xf.R;s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*l;l=n.col1.y*s+n.col2.y*l;s=r;n=i.m_xf.R;h=this.m_localAnchor2.x-i.m_sweep.localCenter.x;u=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=n.col1.x*h+n.col2.x*u;u=n.col1.y*h+n.col2.y*u;h=r;var D=f.x+-m*u-c.x- -p*l;var U=f.y+m*h-c.y-p*s;this.m_mass.Solve22(this.impulse2,-D,-U);this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;c.x-=d*this.impulse2.x;c.y-=d*this.impulse2.y;p-=g*(s*this.impulse2.y-l*this.impulse2.x);f.x+=y*this.impulse2.x;f.y+=y*this.impulse2.y;m+=_*(h*this.impulse2.y-u*this.impulse2.x)}e.m_linearVelocity.SetV(c);e.m_angularVelocity=p;i.m_linearVelocity.SetV(f);i.m_angularVelocity=m};U.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var n=0;var r;var o=this.m_bodyA;var s=this.m_bodyB;var l=0;var h=0;var u=0;var c=0;var p=0;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){var f=s.m_sweep.a-o.m_sweep.a-this.m_referenceAngle;var m=0;if(this.m_limitState==v.e_equalLimits){n=a.Clamp(f-this.m_lowerAngle,-i.b2_maxAngularCorrection,i.b2_maxAngularCorrection);m=-this.m_motorMass*n;l=a.Abs(n)}else if(this.m_limitState==v.e_atLowerLimit){n=f-this.m_lowerAngle;l=-n;n=a.Clamp(n+i.b2_angularSlop,-i.b2_maxAngularCorrection,0);m=-this.m_motorMass*n}else if(this.m_limitState==v.e_atUpperLimit){n=f-this.m_upperAngle;l=n;n=a.Clamp(n-i.b2_angularSlop,0,i.b2_maxAngularCorrection);m=-this.m_motorMass*n}o.m_sweep.a-=o.m_invI*m;s.m_sweep.a+=s.m_invI*m;o.SynchronizeTransform();s.SynchronizeTransform()}{r=o.m_xf.R;var d=this.m_localAnchor1.x-o.m_sweep.localCenter.x;var y=this.m_localAnchor1.y-o.m_sweep.localCenter.y;u=r.col1.x*d+r.col2.x*y;y=r.col1.y*d+r.col2.y*y;d=u;r=s.m_xf.R;var g=this.m_localAnchor2.x-s.m_sweep.localCenter.x;var _=this.m_localAnchor2.y-s.m_sweep.localCenter.y;u=r.col1.x*g+r.col2.x*_;_=r.col1.y*g+r.col2.y*_;g=u;var I=s.m_sweep.c.x+g-o.m_sweep.c.x-d;var x=s.m_sweep.c.y+_-o.m_sweep.c.y-y;var w=I*I+x*x;var S=Math.sqrt(w);h=S;var b=o.m_invMass;var C=s.m_invMass;var T=o.m_invI;var D=s.m_invI;var A=10*i.b2_linearSlop;if(w>A*A){var E=I/S;var M=x/S;var P=b+C;var B=1/P;c=B*-I;p=B*-x;var L=.5;o.m_sweep.c.x-=L*b*c;o.m_sweep.c.y-=L*b*p;s.m_sweep.c.x+=L*C*c;s.m_sweep.c.y+=L*C*p;I=s.m_sweep.c.x+g-o.m_sweep.c.x-d;x=s.m_sweep.c.y+_-o.m_sweep.c.y-y}this.K1.col1.x=b+C;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=b+C;this.K2.col1.x=T*y*y;this.K2.col2.x=-T*d*y;this.K2.col1.y=-T*d*y;this.K2.col2.y=T*d*d;this.K3.col1.x=D*_*_;this.K3.col2.x=-D*g*_;this.K3.col1.y=-D*g*_;this.K3.col2.y=D*g*g;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(U.tImpulse,-I,-x);c=U.tImpulse.x;p=U.tImpulse.y;o.m_sweep.c.x-=o.m_invMass*c;o.m_sweep.c.y-=o.m_invMass*p;o.m_sweep.a-=o.m_invI*(d*p-y*c);s.m_sweep.c.x+=s.m_invMass*c;s.m_sweep.c.y+=s.m_invMass*p;s.m_sweep.a+=s.m_invI*(g*p-_*c);o.SynchronizeTransform();s.SynchronizeTransform()}return h<=i.b2_linearSlop&&l<=i.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new l});Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef);A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;A.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};A.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false};A.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(E,Box2D.Dynamics.Joints.b2Joint);E.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;E.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new l;this.m_localAnchorB=new l;this.m_impulse=new h;this.m_mass=new r};E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};E.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};E.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};E.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_mass=new r};E.prototype.InitVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;e=n.m_xf.R;var a=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var o=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*o;o=e.col1.y*a+e.col2.y*o;a=i;e=r.m_xf.R;var s=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var l=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=i;var h=n.m_invMass;var u=r.m_invMass;var c=n.m_invI;var p=r.m_invI;this.m_mass.col1.x=h+u+o*o*c+l*l*p;this.m_mass.col2.x=-o*a*c-l*s*p;this.m_mass.col3.x=-o*c-l*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=h+u+a*a*c+s*s*p;this.m_mass.col3.y=a*c+s*p;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=c+p;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_impulse.z*=t.dtRatio;n.m_linearVelocity.x-=h*this.m_impulse.x;n.m_linearVelocity.y-=h*this.m_impulse.y;n.m_angularVelocity-=c*(a*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z);r.m_linearVelocity.x+=u*this.m_impulse.x;r.m_linearVelocity.y+=u*this.m_impulse.y;r.m_angularVelocity+=p*(s*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};E.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var n=this.m_bodyA;var r=this.m_bodyB;var a=n.m_linearVelocity;var o=n.m_angularVelocity;var s=r.m_linearVelocity;var l=r.m_angularVelocity;var u=n.m_invMass;var c=r.m_invMass;var p=n.m_invI;var f=r.m_invI;e=n.m_xf.R;var m=this.m_localAnchorA.x-n.m_sweep.localCenter.x;var d=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=e.col1.x*m+e.col2.x*d;d=e.col1.y*m+e.col2.y*d;m=i;e=r.m_xf.R;var y=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var v=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*y+e.col2.x*v;v=e.col1.y*y+e.col2.y*v;y=i;var g=s.x-l*v-a.x+o*d;var _=s.y+l*y-a.y-o*m;var I=l-o;var x=new h;this.m_mass.Solve33(x,-g,-_,-I);this.m_impulse.Add(x);a.x-=u*x.x;a.y-=u*x.y;o-=p*(m*x.y-d*x.x+x.z);s.x+=c*x.x;s.y+=c*x.y;l+=f*(y*x.y-v*x.x+x.z);n.m_angularVelocity=o;r.m_angularVelocity=l};E.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;var n=0;var r=this.m_bodyA;var o=this.m_bodyB;e=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var l=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=n;e=o.m_xf.R;var u=this.m_localAnchorB.x-o.m_sweep.localCenter.x;var c=this.m_localAnchorB.y-o.m_sweep.localCenter.y;n=e.col1.x*u+e.col2.x*c;c=e.col1.y*u+e.col2.y*c;u=n;var p=r.m_invMass;var f=o.m_invMass;var m=r.m_invI;var d=o.m_invI;var y=o.m_sweep.c.x+u-r.m_sweep.c.x-s;var v=o.m_sweep.c.y+c-r.m_sweep.c.y-l;var g=o.m_sweep.a-r.m_sweep.a-this.m_referenceAngle;var _=10*i.b2_linearSlop;var I=Math.sqrt(y*y+v*v);var x=a.Abs(g);if(I>_){m*=1;d*=1}this.m_mass.col1.x=p+f+l*l*m+c*c*d;this.m_mass.col2.x=-l*s*m-c*u*d;this.m_mass.col3.x=-l*m-c*d;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=p+f+s*s*m+u*u*d;this.m_mass.col3.y=s*m+u*d;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+d;var w=new h;this.m_mass.Solve33(w,-y,-v,-g);r.m_sweep.c.x-=p*w.x;r.m_sweep.c.y-=p*w.y;r.m_sweep.a-=m*(s*w.y-l*w.x+w.z);o.m_sweep.c.x+=f*w.x;o.m_sweep.c.y+=f*w.y;o.m_sweep.a+=d*(u*w.y-c*w.x+w.z);r.SynchronizeTransform();o.SynchronizeTransform();return I<=i.b2_linearSlop&&x<=i.b2_angularSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_weldJoint;this.referenceAngle=0};M.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}};t.prototype._color=function(t,e){return"rgba("+((t&16711680)>>16)+","+((t&65280)>>8)+","+(t&255)+","+e+")"};t.prototype.b2DebugDraw=function(){this.m_drawFlags=0};t.prototype.SetFlags=function(t){if(t===undefined)t=0;this.m_drawFlags=t};t.prototype.GetFlags=function(){return this.m_drawFlags};t.prototype.AppendFlags=function(t){if(t===undefined)t=0;this.m_drawFlags|=t};t.prototype.ClearFlags=function(t){if(t===undefined)t=0;this.m_drawFlags&=~t};t.prototype.SetSprite=function(t){this.m_ctx=t};t.prototype.GetSprite=function(){return this.m_ctx};t.prototype.SetDrawScale=function(t){if(t===undefined)t=0;this.m_drawScale=t};t.prototype.GetDrawScale=function(){return this.m_drawScale};t.prototype.SetLineThickness=function(t){if(t===undefined)t=0;this.m_lineThickness=t;this.m_ctx.strokeWidth=t};t.prototype.GetLineThickness=function(){return this.m_lineThickness};t.prototype.SetAlpha=function(t){if(t===undefined)t=0;this.m_alpha=t};t.prototype.GetAlpha=function(){return this.m_alpha};t.prototype.SetFillAlpha=function(t){if(t===undefined)t=0;this.m_fillAlpha=t};t.prototype.GetFillAlpha=function(){return this.m_fillAlpha};t.prototype.SetXFormScale=function(t){if(t===undefined)t=0;this.m_xformScale=t};t.prototype.GetXFormScale=function(){return this.m_xformScale};t.prototype.DrawPolygon=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.moveTo(t[0].x*r,t[0].y*r);for(var a=1;a<e;a++){n.lineTo(t[a].x*r,t[a].y*r)}n.lineTo(t[0].x*r,t[0].y*r);n.closePath();n.stroke()};t.prototype.DrawSolidPolygon=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.fillStyle=this._color(i.color,this.m_fillAlpha);n.moveTo(t[0].x*r,t[0].y*r);for(var a=1;a<e;a++){n.lineTo(t[a].x*r,t[a].y*r)}n.lineTo(t[0].x*r,t[0].y*r);n.closePath();n.fill();n.stroke()};t.prototype.DrawCircle=function(t,e,i){if(!e)return;var n=this.m_ctx;var r=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(i.color,this.m_alpha);n.arc(t.x*r,t.y*r,e*r,0,Math.PI*2,true);n.closePath();n.stroke()};t.prototype.DrawSolidCircle=function(t,e,i,n){if(!e)return;var r=this.m_ctx,a=this.m_drawScale,o=t.x*a,s=t.y*a;r.moveTo(0,0);r.beginPath();r.strokeStyle=this._color(n.color,this.m_alpha);r.fillStyle=this._color(n.color,this.m_fillAlpha);r.arc(o,s,e*a,0,Math.PI*2,true);r.moveTo(o,s);r.lineTo((t.x+i.x*e)*a,(t.y+i.y*e)*a);r.closePath();r.fill();r.stroke()};t.prototype.DrawSegment=function(t,e,i){var n=this.m_ctx,r=this.m_drawScale;n.strokeStyle=this._color(i.color,this.m_alpha);n.beginPath();n.moveTo(t.x*r,t.y*r);n.lineTo(e.x*r,e.y*r);n.closePath();n.stroke()};t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(16711680,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i);e.strokeStyle=this._color(65280,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i);e.closePath();e.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;if(typeof require!=="undefined"&&typeof module!=="undefined"){module.exports=Box2D}window.b2Color=Box2D.Common.b2Color,window.b2internal=Box2D.Common.b2internal,window.b2Settings=Box2D.Common.b2Settings,window.b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,
window.b2EdgeChainDef=Box2D.Collision.Shapes.b2EdgeChainDef,window.b2EdgeShape=Box2D.Collision.Shapes.b2EdgeShape,window.b2MassData=Box2D.Collision.Shapes.b2MassData,window.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,window.b2Shape=Box2D.Collision.Shapes.b2Shape,window.b2Mat22=Box2D.Common.Math.b2Mat22,window.b2Mat33=Box2D.Common.Math.b2Mat33,window.b2Math=Box2D.Common.Math.b2Math,window.b2Sweep=Box2D.Common.Math.b2Sweep,window.b2Transform=Box2D.Common.Math.b2Transform,window.b2Vec2=Box2D.Common.Math.b2Vec2,window.b2Vec3=Box2D.Common.Math.b2Vec3,window.b2Body=Box2D.Dynamics.b2Body,window.b2BodyDef=Box2D.Dynamics.b2BodyDef,window.b2ContactFilter=Box2D.Dynamics.b2ContactFilter,window.b2ContactImpulse=Box2D.Dynamics.b2ContactImpulse,window.b2ContactListener=Box2D.Dynamics.b2ContactListener,window.b2ContactManager=Box2D.Dynamics.b2ContactManager,window.b2DebugDraw=Box2D.Dynamics.b2DebugDraw,window.b2DestructionListener=Box2D.Dynamics.b2DestructionListener,window.b2FilterData=Box2D.Dynamics.b2FilterData,window.b2Fixture=Box2D.Dynamics.b2Fixture,window.b2FixtureDef=Box2D.Dynamics.b2FixtureDef,window.b2Island=Box2D.Dynamics.b2Island,window.b2TimeStep=Box2D.Dynamics.b2TimeStep,window.b2World=Box2D.Dynamics.b2World,window.b2AABB=Box2D.Collision.b2AABB,window.b2Bound=Box2D.Collision.b2Bound,window.b2BoundValues=Box2D.Collision.b2BoundValues,window.b2Collision=Box2D.Collision.b2Collision,window.b2ContactID=Box2D.Collision.b2ContactID,window.b2ContactPoint=Box2D.Collision.b2ContactPoint,window.b2Distance=Box2D.Collision.b2Distance,window.b2DistanceInput=Box2D.Collision.b2DistanceInput,window.b2DistanceOutput=Box2D.Collision.b2DistanceOutput,window.b2DistanceProxy=Box2D.Collision.b2DistanceProxy,window.b2DynamicTree=Box2D.Collision.b2DynamicTree,window.b2DynamicTreeBroadPhase=Box2D.Collision.b2DynamicTreeBroadPhase,window.b2DynamicTreeNode=Box2D.Collision.b2DynamicTreeNode,window.b2DynamicTreePair=Box2D.Collision.b2DynamicTreePair,window.b2Manifold=Box2D.Collision.b2Manifold,window.b2ManifoldPoint=Box2D.Collision.b2ManifoldPoint,window.b2Point=Box2D.Collision.b2Point,window.b2RayCastInput=Box2D.Collision.b2RayCastInput,window.b2RayCastOutput=Box2D.Collision.b2RayCastOutput,window.b2Segment=Box2D.Collision.b2Segment,window.b2SeparationFunction=Box2D.Collision.b2SeparationFunction,window.b2Simplex=Box2D.Collision.b2Simplex,window.b2SimplexCache=Box2D.Collision.b2SimplexCache,window.b2SimplexVertex=Box2D.Collision.b2SimplexVertex,window.b2TimeOfImpact=Box2D.Collision.b2TimeOfImpact,window.b2TOIInput=Box2D.Collision.b2TOIInput,window.b2WorldManifold=Box2D.Collision.b2WorldManifold,window.b2DistanceJoint=Box2D.Dynamics.Joints.b2DistanceJoint,window.b2DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef,window.b2FrictionJoint=Box2D.Dynamics.Joints.b2FrictionJoint,window.b2FrictionJointDef=Box2D.Dynamics.Joints.b2FrictionJointDef,window.b2GearJoint=Box2D.Dynamics.Joints.b2GearJoint,window.b2GearJointDef=Box2D.Dynamics.Joints.b2GearJointDef,window.b2Jacobian=Box2D.Dynamics.Joints.b2Jacobian,window.b2Joint=Box2D.Dynamics.Joints.b2Joint,window.b2JointDef=Box2D.Dynamics.Joints.b2JointDef,window.b2JointEdge=Box2D.Dynamics.Joints.b2JointEdge,window.b2LineJoint=Box2D.Dynamics.Joints.b2LineJoint,window.b2LineJointDef=Box2D.Dynamics.Joints.b2LineJointDef,window.b2MouseJoint=Box2D.Dynamics.Joints.b2MouseJoint,window.b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef,window.b2PrismaticJoint=Box2D.Dynamics.Joints.b2PrismaticJoint,window.b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef,window.b2PulleyJoint=Box2D.Dynamics.Joints.b2PulleyJoint,window.b2PulleyJointDef=Box2D.Dynamics.Joints.b2PulleyJointDef,window.b2RevoluteJoint=Box2D.Dynamics.Joints.b2RevoluteJoint,window.b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,window.b2WeldJoint=Box2D.Dynamics.Joints.b2WeldJoint,window.b2WeldJointDef=Box2D.Dynamics.Joints.b2WeldJointDef;function RubeCantk(t){this.cantkScene=t;this.PTM=t.pixelsPerMeter;this.world=t.world;this.lastMousePosPixel={x:0,y:0};this.mousePosWorld={x:0,y:0};this.mouseDownQueryCallback=null;this.mouseJointGroundBody=null;this.mouseJoint=null;this.debugDraw=null}var hasOwnProperty=function(t,e){return typeof t[e]!=="undefined"};RubeCantk.prototype.getWorldPointFromPixelPoint=function(t){return{x:t.x/this.PTM,y:t.y/this.PTM}};RubeCantk.prototype.getPixelPointFromWorldPoint=function(t){return{x:this.worldPoint.x*this.PTM,y:this.worldPoint.y*this.PTM}};RubeCantk.prototype.updateMousePos=function(t){this.mousePosWorld=this.getWorldPointFromPixelPoint(t.point)};RubeCantk.MouseDownQueryCallback=function(){this.m_fixture=null;this.m_point=new b2Vec2};RubeCantk.MouseDownQueryCallback.prototype.ReportFixture=function(t){if(t.GetBody().GetType()==2){if(t.TestPoint(this.m_point)){this.m_fixture=t;return false}}return true};RubeCantk.prototype.tryStartMouseJoint=function(){if(this.mouseJoint!=null)return;var t=new b2AABB;var e=.001;t.lowerBound.Set(this.mousePosWorld.x-e,this.mousePosWorld.y-e);t.upperBound.Set(this.mousePosWorld.x+e,this.mousePosWorld.y+e);this.mouseDownQueryCallback.m_fixture=null;this.mouseDownQueryCallback.m_point.Set(this.mousePosWorld.x,this.mousePosWorld.y);this.world.QueryAABB(function(t){if(t.GetBody().GetType()!=b2Body.b2_staticBody){if(t.GetShape().TestPoint(t.GetBody().GetTransform(),this.mousePosWorld)){this.mouseDownQueryCallback.m_fixture=t;selectedBody=t.GetBody();return false}}selectedBody=undefined;return true}.bind(this),t);if(this.mouseDownQueryCallback.m_fixture){var i=this.mouseDownQueryCallback.m_fixture.GetBody();var n=new b2MouseJointDef;n.bodyA=this.mouseJointGroundBody;n.bodyB=i;n.target.Set(this.mousePosWorld.x,this.mousePosWorld.y);n.maxForce=300*i.GetMass();n.collideConnected=true;this.mouseJoint=this.world.CreateJoint(n);i.SetAwake(false)}};RubeCantk.prototype.setAssetsLoader=function(t){this.assetsLoader=t};RubeCantk.prototype.onImageAssetLoaded=function(t,e,i){var n=ShapeFactoryGet().createShape("ui-image","from RUBE");n.setAnchor(.5,.5);n.isUIRubeImage=true;n.name=t.name||"ui-image";t.element=n;n.setZIndex(i);n.setImageSrc(e.src);n.w=e.width;n.h=e.height;t.pixelHeight=n.h;n.images.display=UIElement.IMAGE_DISPLAY_SCALE;this.cantkScene.addChild(n);if(this.createdCallback){this.createdCallback(n)}};RubeCantk.prototype.createRube=function(t,e){if(!t){return}e=e||{};this.createdCallback=e.createdCallback;var i=this.cantkScene;function n(e){if(t[e]!==undefined){i[e]=t[e]}}var r=["allowSleep","autoClearForce","positionIterations","velocityIterations","warmStarting","subStepping","stepsPerSecond"];var a=r.length;for(var o=0;o<a;o++){}if(!i.world){i.setEnablePhysics(true);i.startPhysics()}this.world=i.world;if(!this.world){console.error("Start physics failed, igrone RUBE json");return}this.loadSceneFromRUBE(t,this.world,i);this.interactive=e.interactive||true;if(this.world.images){for(var o=0;o<this.world.images.length;o++){(function(t){var e=t;var i=this.world.images[t];var n=this.world.images[t].file;this.assetsLoader.loadImage(basename(n),function(t){this.onImageAssetLoaded(i,t,e)}.bind(this))}).bind(this)(o)}}this.mouseJointGroundBody=this.world.CreateBody(new b2BodyDef);this.mouseDownQueryCallback=new RubeCantk.MouseDownQueryCallback;if(this.interactive){i.addEventListener("pointerdown",this.onPointerDown.bind(this));i.addEventListener("pointermove",this.onPointerMove.bind(this));i.addEventListener("pointerup",this.onPointerUp.bind(this))}var s=e.debug||true;if(s){var l=new b2DebugDraw;l.SetSprite(UIElement.getMainCanvas().getContext("2d"));l.SetDrawScale(Physics.pixelsPerMeter);l.SetFillAlpha(.3);l.SetLineThickness(1);l.SetFlags(b2DebugDraw.e_shapeBit|b2DebugDraw.e_jointBit);this.debugDraw=l;this.world.SetDebugDraw(l)}i.addEventListener("updatetransform",this.onUpdateTransform.bind(this))};RubeCantk.prototype.onPointerDown=function(t){if(!t||t.beforeChild){return}this.updateMousePos(t);this.tryStartMouseJoint();this.lastMousePosPixel={x:t.point.x,y:t.point.y}};RubeCantk.prototype.onPointerMove=function(t){if(!t||t.beforeChild){return}this.updateMousePos(t);if(this.cantkScene.pointerDown){if(this.mouseJoint!=null){this.mouseJoint.SetTarget(this.mousePosWorld)}}this.lastMousePosPixel={x:t.point.x,y:t.point.y}};RubeCantk.prototype.onPointerUp=function(t){if(!t||t.beforeChild){return}if(this.mouseJoint){this.world.DestroyJoint(this.mouseJoint);this.mouseJoint=null}};RubeCantk.prototype.positionImages=function(){var t=this.world.images;if(this.world.images){var e=t.length;var i=this.PTM;for(var n=0;n<e;n++){var r=t[n];element=r.element;if(!element){continue}element.setRotation(r.angle);var a=i/r.pixelHeight*r.scale;element.setScale(r.aspectScale*a,a);if(r.flip){element.scale.x*=-1}if(r.body){var o=new b2Vec2(r.center.x,-r.center.y);var s=r.body.GetWorldPoint(o);element.setPosition(s.x,s.y);element.setRotation(r.body.GetAngle()+r.angle);if(r.body.element){r.body.element.setVisible(false)}}else{element.setPosition(this.pCenter.x+r.center.x,this.pCenter.y)}element.x*=i;element.y*=i}}};RubeCantk.prototype.onUpdateTransform=function(){this.positionImages()};RubeCantk.prototype.removeBodyFromScene=function(t){var e=[];for(i=0;i<this.world.images.length;i++){if(this.world.images[i].body==t)e.push(this.world.images[i])}for(var i=0;i<e.length;i++){e[i].element.remove(true);removeFromArray(this.world.images,e[i])}if(t.element){t.element.remove(true)}this.world.DestroyBody(t)};RubeCantk.prototype.removeImageFromScene=function(t){t.element.remove(true);removeFromArray(this.world.images,t)};RubeCantk.prototype.getVerticesArray=function(t){var e=false;if(ClockWise(t)===CLOCKWISE){console.warn("clock wise polygon");t.reverse()}if(Convex(t)===CONCAVE){e=true}var i=e?process(t):t;return{complex:e,vertices:i}};RubeCantk.prototype.loadFixtureFromRUBE=function(t,e){var i=new b2FixtureDef;if(hasOwnProperty(e,"friction"))i.friction=e.friction;if(hasOwnProperty(e,"density"))i.density=e.density;if(hasOwnProperty(e,"restitution"))i.restitution=e.restitution;if(hasOwnProperty(e,"sensor"))i.isSensor=e.sensor;if(hasOwnProperty(e,"filter-categoryBits"))i.filter.categoryBits=e["filter-categoryBits"];if(hasOwnProperty(e,"filter-maskBits"))i.filter.maskBits=e["filter-maskBits"];if(hasOwnProperty(e,"filter-groupIndex"))i.filter.groupIndex=e["filter-groupIndex"];if(hasOwnProperty(e,"circle")){i.shape=new b2CircleShape;i.shape.m_radius=e.circle.radius;if(e.circle.center)i.shape.m_p.SetV(e.circle.center);i.shape.m_p.y*=-1;var n=t.CreateFixture(i);if(e.name)n.name=e.name}else if(hasOwnProperty(e,"polygon")){i.shape=new b2PolygonShape;var r=[];for(v=0;v<e.polygon.vertices.x.length;v++)r.push(new b2Vec2(e.polygon.vertices.x[v],-e.polygon.vertices.y[v]));var a=this.getVerticesArray(r);if(a.complex){console.error("input vertices has convex polygon?")}else{r=a.vertices}i.shape.SetAsArray(r,r.length);var n=t.CreateFixture(i);if(n&&e.name)n.name=e.name}else if(hasOwnProperty(e,"chain")){i.shape=new b2PolygonShape;var o=new b2Vec2;for(v=0;v<e.chain.vertices.x.length;v++){var s=new b2Vec2(e.chain.vertices.x[v],e.chain.vertices.y[v]);if(v>0){i.shape.SetAsEdge(o,s);var n=t.CreateFixture(i);if(e.name)n.name=e.name}o=s}}else{console.log("Could not find shape type for fixture")}if(n){if(hasOwnProperty(e,"customProperties"))n.customProperties=e.customProperties}};RubeCantk.prototype.loadBodyFromRUBE=function(t,e,i){if(!t.hasOwnProperty("type")){console.log("Body does not have a 'type' property");return null}var n=new b2BodyDef;if(t.type==2)n.type=b2Body.b2_dynamicBody;else if(t.type==1)n.type=b2Body.b2_kinematicBody;else n.type=b2Body.b2_staticBody;var r=t.angle||0;if(hasOwnProperty(t,"angularVelocity")){n.angularVelocity=t.angularVelocity;n.angularVelocity.y*=-1}if(hasOwnProperty(t,"angularDamping")){n.angularDamping=t.angularDamping}n.awake=t.awake||false;n.bullet=t.bullet||false;n.fixedRotation=t.fixedRotation||false;if(hasOwnProperty(t,"linearDamping")){n.linearDamping=t.linearDamping}if(t.hasOwnProperty("linearVelocity")&&t.linearVelocity instanceof Object){n.linearVelocity=parseVec(t.linearVelocity);n.linearVelocity.y*=-1}else{n.linearVelocity=new b2Vec2(0,0)}var a={x:Physics.toMeter(i.w>>1),y:Physics.toMeter(i.h>>1)};this.pCenter=a;var o;if(t.hasOwnProperty("position")&&t.position instanceof Object){var s=parseVec(t.position);o=new b2Vec2(a.x+s.x,a.y-s.y)}else o=new b2Vec2(a.x,a.y);if(t.hasOwnProperty("gravityScale")&&!isNaN(parseFloat(t.gravityScale))&&isFinite(t.gravityScale)){n.gravityScale=t.gravityScale}else{n.gravityScale=1}var l=e.CreateBody(n);l.gravityScale=n.gravityScale;var h=new b2MassData;h.mass=t["massData-mass"]||0;if(t.hasOwnProperty("massData-center")&&t["massData-center"]instanceof Object)h.center=parseVec(t["massData-center"]);else h.center=new b2Vec2(0,0);h.I=t["massData-I"]||0;l.SetMassData(h);if(t.hasOwnProperty("fixture")){for(var u=0;u<t["fixture"].length;u++){var c=t["fixture"][u];this.loadFixtureFromRUBE(l,c)}}l.SetPositionAndAngle(o,-r);l.SetAngle(-r);if(t.hasOwnProperty("name"))l.name=t.name;if(t.hasOwnProperty("customProperties"))l.customProperties=t.customProperties;return l};function getVectorValue(t){if(t instanceof Object)return t;else return{x:0,y:0}}function parseVec(t){if(t instanceof Object)return new b2Vec2(t.x||0,t.y||0);else return new b2Vec2(0,0)}function makeClone(t){var e=t instanceof Array?[]:{};for(var i in t){if(t[i]&&typeof t[i]=="object")e[i]=makeClone(t[i]);else e[i]=t[i]}return e}RubeCantk.prototype.loadJointCommonProperties=function(t,e,i){t.bodyA=i[e.bodyA];t.bodyB=i[e.bodyB];t.localAnchorA.SetV(getVectorValue(e.anchorA));t.localAnchorA.y*=-1;t.localAnchorB.SetV(getVectorValue(e.anchorB));t.localAnchorB.y*=-1;if(e.collideConnected)t.collideConnected=e.collideConnected};RubeCantk.prototype.loadJointFromRUBE=function(t,e,i){if(!hasOwnProperty(t,"type")){console.log("Joint does not have a 'type' property");return null}if(t.bodyA>=i.length){console.log("Index for bodyA is invalid: "+t.bodyA);return null}if(t.bodyB>=i.length){console.log("Index for bodyB is invalid: "+t.bodyB);return null}var n=null;if(t.type=="revolute"){var r=new b2RevoluteJointDef;this.loadJointCommonProperties(r,t,i);if(hasOwnProperty(t,"refAngle"))r.referenceAngle=t.refAngle;if(hasOwnProperty(t,"lowerLimit"))r.lowerAngle=t.lowerLimit;if(hasOwnProperty(t,"upperLimit"))r.upperAngle=t.upperLimit;if(hasOwnProperty(t,"maxMotorTorque"))r.maxMotorTorque=t.maxMotorTorque;if(hasOwnProperty(t,"motorSpeed"))r.motorSpeed=-1*t.motorSpeed;if(hasOwnProperty(t,"enableLimit"))r.enableLimit=t.enableLimit;if(hasOwnProperty(t,"enableMotor"))r.enableMotor=t.enableMotor;n=e.CreateJoint(r)}else if(t.type=="distance"||t.type=="rope"){if(t.type=="rope")console.log("Replacing unsupported rope joint with distance joint!");var r=new b2DistanceJointDef;loadJointCommonProperties(r,t,i);if(hasOwnProperty(t,"length"))r.length=t.length;if(hasOwnProperty(t,"dampingRatio"))r.dampingRatio=t.dampingRatio;if(hasOwnProperty(t,"frequency"))r.frequencyHz=t.frequency;n=e.CreateJoint(r)}else if(t.type=="prismatic"){var r=new b2PrismaticJointDef;loadJointCommonProperties(r,t,i);if(hasOwnProperty(t,"localAxisA"))r.localAxisA.SetV(getVectorValue(t.localAxisA));if(hasOwnProperty(t,"refAngle"))r.referenceAngle=t.refAngle;if(hasOwnProperty(t,"enableLimit"))r.enableLimit=t.enableLimit;if(hasOwnProperty(t,"lowerLimit"))r.lowerTranslation=t.lowerLimit;if(hasOwnProperty(t,"upperLimit"))r.upperTranslation=t.upperLimit;if(hasOwnProperty(t,"enableMotor"))r.enableMotor=t.enableMotor;if(hasOwnProperty(t,"maxMotorForce"))r.maxMotorForce=t.maxMotorForce;if(hasOwnProperty(t,"motorSpeed"))r.motorSpeed=t.motorSpeed;n=e.CreateJoint(r)}else if(t.type=="wheel"){var r=new b2DistanceJointDef;loadJointCommonProperties(r,t,i);r.length=0;if(hasOwnProperty(t,"springDampingRatio"))r.dampingRatio=t.springDampingRatio;if(hasOwnProperty(t,"springFrequency"))r.frequencyHz=t.springFrequency;e.CreateJoint(r);r=new b2LineJointDef;loadJointCommonProperties(r,t,i);if(hasOwnProperty(t,"localAxisA"))r.localAxisA.SetV(getVectorValue(t.localAxisA));n=e.CreateJoint(r)}else if(t.type=="friction"){var r=new b2FrictionJointDef;loadJointCommonProperties(r,t,i);if(hasOwnProperty(t,"maxForce"))r.maxForce=t.maxForce;if(hasOwnProperty(t,"maxTorque"))r.maxTorque=t.maxTorque;n=e.CreateJoint(r)}else if(t.type=="weld"){var r=new b2WeldJointDef;loadJointCommonProperties(r,t,i);if(hasOwnProperty(t,"referenceAngle"))r.referenceAngle=t.referenceAngle;n=e.CreateJoint(r)}else{console.log("Unsupported joint type: "+t.type);console.log(t)}if(n){if(t.name)n.name=t.name;if(hasOwnProperty(t,"customProperties"))n.customProperties=t.customProperties}return n};RubeCantk.prototype.loadImageFromRUBE=function(t,e,i){var n=makeClone(t);if(n.hasOwnProperty("body")&&n.body>=0)n.body=i[n.body];else n.body=null;if(!n.hasOwnProperty("aspectScale"))n.aspectScale=1;if(!n.hasOwnProperty("angle"))n.angle=0;if(!n.hasOwnProperty("colorTint"))n.colorTint=[255,255,255,255];n.center=new b2Vec2;n.center.SetV(getVectorValue(t.center));return n};RubeCantk.prototype.loadSceneFromRUBE=function(t,e,i){var n=true;var r=[];if(hasOwnProperty(t,"body")){for(var a=0;a<t.body.length;a++){var o=t.body[a];var s=this.loadBodyFromRUBE(o,e,i);if(s){r.push(s);if(i){var l=i.onCreateRUBEBody(s);if(this.createdCallback){this.createdCallback(l)}}}else n=false}}var h=[];if(hasOwnProperty(t,"joint")){for(var a=0;a<t.joint.length;a++){var u=t.joint[a];var c=this.loadJointFromRUBE(u,e,r);if(c){h.push(c);if(i){i.onRUBEJointCreated(c)}}}}var p=[];if(hasOwnProperty(t,"image")){for(var a=0;a<t.image.length;a++){var f=t.image[a];var m=this.loadImageFromRUBE(f,e,r);if(m)p.push(m);else n=false}e.images=p}return n};function getNamedBody(t,e){for(b=t.m_bodyList;b;b=b.m_next){if(b.name==e)return b}return null}function getNamedBodies(t,e){var i=[];for(b=t.m_bodyList;b;b=b.m_next){if(b.name==e)i.push(b)}return i}function getNamedFixtures(t,e){var i=[];for(var n=t.m_bodyList;n;n=n.m_next){for(var r=n.m_fixtureList;r;r=r.m_next){if(r.name==e)i.push(r)}}return i}function getNamedJoints(t,e){var i=[];for(var n=t.m_jointList;n;n=n.m_next){if(n.name==e)i.push(n)}return i}function getNamedImages(t,e){var n=[];for(i=0;i<t.images.length;i++){if(t.images[i].name==e)n.push(t.images[i])}return n}function getBodiesByCustomProperty(t,e,i,n){var r=[];for(var a=t.m_bodyList;a;a=a.m_next){if(!a.hasOwnProperty("customProperties"))continue;for(var o=0;o<a.customProperties.length;o++){if(!a.customProperties[o].hasOwnProperty("name"))continue;if(!a.customProperties[o].hasOwnProperty(e))continue;if(a.customProperties[o].name==i&&a.customProperties[o][e]==n)r.push(a)}}return r}function hasCustomProperty(t,e,i){if(!t.hasOwnProperty("customProperties"))return false;for(var n=0;n<t.customProperties.length;n++){if(!t.customProperties[n].hasOwnProperty("name"))continue;if(!t.customProperties[n].hasOwnProperty(e))continue;return true}return false}function getCustomProperty(t,e,i,n){if(!t.hasOwnProperty("customProperties"))return n;for(var r=0;r<t.customProperties.length;r++){if(!t.customProperties[r].hasOwnProperty("name"))continue;if(!t.customProperties[r].hasOwnProperty(e))continue;if(t.customProperties[r].name==i)return t.customProperties[r][e]}return n}var __extends=this&&this.__extends||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)};var Matrix=function(){function t(t,e,i,n,r,a){if(t===void 0){t=1}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=1}if(r===void 0){r=0}if(a===void 0){a=0}this.a=t;this.b=e;this.c=i;this.d=n;this.tx=r;this.ty=a}var e=t.prototype;e.prepend=function(t,e,i,n,r,a){var o=this.tx;if(t!=1||e!=0||i!=0||n!=1){var s=this.a;var l=this.c;this.a=s*t+this.b*i;this.b=s*e+this.b*n;this.c=l*t+this.d*i;this.d=l*e+this.d*n}this.tx=o*t+this.ty*i+r;this.ty=o*e+this.ty*n+a;return this};e.append=function(t,e,i,n,r,a){var o=this.a;var s=this.b;var l=this.c;var h=this.d;if(t!=1||e!=0||i!=0||n!=1){this.a=t*o+e*l;this.b=t*s+e*h;this.c=i*o+n*l;this.d=i*s+n*h}this.tx=r*o+a*l+this.tx;this.ty=r*s+a*h+this.ty;return this};e.prependTransform=function(t,e,i,n,r,a,o,s,l){if(r%360){var h=r;var u=egret.NumberUtils.cos(h);var c=egret.NumberUtils.sin(h)}else{u=1;c=0}if(s||l){this.tx-=s;this.ty-=l}if(a||o){this.prepend(u*i,c*i,-c*n,u*n,0,0);this.prepend(egret.NumberUtils.cos(o),egret.NumberUtils.sin(o),-egret.NumberUtils.sin(a),egret.NumberUtils.cos(a),t,e)}else{this.prepend(u*i,c*i,-c*n,u*n,t,e)}return this};e.appendTransform=function(t,e,i,n,r,a,o,s,l){if(r%360){var h=r;var u=egret.NumberUtils.cos(h);var c=egret.NumberUtils.sin(h)}else{u=1;c=0}if(a||o){this.append(egret.NumberUtils.cos(o),egret.NumberUtils.sin(o),-egret.NumberUtils.sin(a),egret.NumberUtils.cos(a),t,e);this.append(u*i,c*i,-c*n,u*n,0,0)}else{this.append(u*i,c*i,-c*n,u*n,t,e)}if(s||l){this.tx-=s*this.a+l*this.c;this.ty-=s*this.b+l*this.d}return this};e.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;var r=this.c;var a=this.tx;this.a=n*e-this.b*i;this.b=n*i+this.b*e;this.c=r*e-this.d*i;this.d=r*i+this.d*e;this.tx=a*e-this.ty*i;this.ty=a*i+this.ty*e;return this};e.skew=function(t,e){this.append(egret.NumberUtils.cos(e),egret.NumberUtils.sin(e),-egret.NumberUtils.sin(t),egret.NumberUtils.cos(t),0,0);return this};e.scale=function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;return this};e.translate=function(t,e){this.tx+=t;this.ty+=e;return this};e.identity=function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this};e.identityMatrix=function(t){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.tx=t.tx;this.ty=t.ty;return this};e.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var a=t*n-e*i;this.a=n/a;this.b=-e/a;this.c=-i/a;this.d=t/a;this.tx=(i*this.ty-n*r)/a;this.ty=-(t*this.ty-e*r)/a;return this};t.transformCoords=function(t,e,i){var n=egret.Point.identity;n.x=t.a*e+t.c*i+t.tx;n.y=t.d*i+t.b*e+t.ty;return n};e.toArray=function(t){if(!this.array){this.array=new Float32Array(9)}if(t){this.array[0]=this.a;this.array[1]=this.b;this.array[2]=0;this.array[3]=this.c;this.array[4]=this.d;this.array[5]=0;this.array[6]=this.tx;this.array[7]=this.ty;this.array[8]=1}else{this.array[0]=this.a;this.array[1]=this.b;this.array[2]=this.tx;this.array[3]=this.c;this.array[4]=this.d;this.array[5]=this.ty;this.array[6]=0;this.array[7]=0;this.array[8]=1}return this.array};e.setTo=function(t,e,i,n,r,a){this.a=t;this.b=e;this.c=i;this.d=n;this.tx=r;this.ty=a};e.copyFrom=function(t){this.identityMatrix(t)};e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)};e.concat=function(t){var e=this.a;var i=this.b;var n=this.c;var r=this.d;var a=this.tx;var o=this.ty;var s=t.a;var l=t.b;var h=t.c;var u=t.d;var c=t.tx;var p=t.ty;var f=e*s;var m=0;var d=0;var y=r*u;var v=a*s+c;var g=o*u+p;if(i!=0||n!=0||l!=0||h!=0){f+=i*h;y+=n*l;m+=e*l+i*u;d+=n*s+r*h;v+=o*h;g+=a*l}this.a=f;this.b=m;this.c=d;this.d=y;this.tx=v;this.ty=g};e.deltaTransformPoint=function(t){var e=this;var i=e.a*t.x+e.c*t.y;var n=e.b*t.x+e.d*t.y;return new egret.Point(i,n)};e.transformPoint=function(t){var e=this;var i=e.a*t.x+e.c*t.y+e.tx;var n=e.b*t.x+e.d*t.y+e.ty;return new egret.Point(i,n)};e.toString=function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"};e.createBox=function(t,e,i,n,r){if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=0}var a=this;if(i!==0){i=i/egret.Matrix.DEG_TO_RAD;var o=egret.NumberUtils.cos(i);var s=egret.NumberUtils.sin(i);a.a=o*t;a.b=s*e;a.c=-s*t;a.d=o*e}else{a.a=t;a.b=0;a.c=0;a.d=e}a.tx=n;a.ty=r};e.createGradientBox=function(t,e,i,n,r){if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=0}this.createBox(t/1638.4,e/1638.4,i,n+t/2,r+e/2)};t.identity=new t;t.DEG_TO_RAD=Math.PI/180;return t}();var NumberUtils=function(){function t(){}var e=t.prototype;t.isNumber=function(t){return typeof t==="number"&&!isNaN(t)};t.sin=function(e){var i=Math.floor(e);var n=i+1;var r=t.sinInt(i);var a=t.sinInt(n);return(e-i)*a+(n-e)*r};t.sinInt=function(t){t=t%360;if(t<0){t+=360}if(t<90){return egret_sin_map[t]}if(t<180){return egret_cos_map[t-90]}if(t<270){return-egret_sin_map[t-180]}return-egret_cos_map[t-270]};t.cos=function(e){var i=Math.floor(e);var n=i+1;var r=t.cosInt(i);var a=t.cosInt(n);return(e-i)*a+(n-e)*r};t.cosInt=function(t){t=t%360;if(t<0){t+=360}if(t<90){return egret_cos_map[t]}if(t<180){return-egret_sin_map[t-90]}if(t<270){return-egret_cos_map[t-180]}return egret_sin_map[t-270]};return t}();var egret_sin_map={};var egret_cos_map={};for(var NumberUtils_i=0;NumberUtils_i<=90;NumberUtils_i++){egret_sin_map[NumberUtils_i]=Math.sin(NumberUtils_i*Matrix.DEG_TO_RAD);egret_cos_map[NumberUtils_i]=Math.cos(NumberUtils_i*Matrix.DEG_TO_RAD)}var Rectangle=function(){function t(t,e,i,n){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=0}this.x=t;this.y=e;this.width=i;this.height=n}var e=t.prototype;Object.defineProperty(e,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t;this.x=t},enumerable:true,configurable:true});Object.defineProperty(e,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:true,configurable:true});Object.defineProperty(e,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t;this.y=t},enumerable:true,configurable:true});Object.defineProperty(e,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:true,configurable:true});Object.defineProperty(e,"topLeft",{get:function(){return new egret.Point(this.left,this.top)},set:function(t){this.top=t.y;this.left=t.x},enumerable:true,configurable:true});Object.defineProperty(e,"bottomRight",{get:function(){return new egret.Point(this.right,this.bottom)},set:function(t){this.bottom=t.y;this.right=t.x},enumerable:true,configurable:true});e.initialize=function(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n;return this};e.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e};e.intersects=function(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)};e.setEmpty=function(){this.x=0;this.y=0;this.width=0;this.height=0};e.clone=function(){return new t(this.x,this.y,this.width,this.height)};e.containsPoint=function(t){if(this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y){return true}return false};e.setTo=function(t,e,i,n){this.initialize(t,e,i,n)};e.copyFrom=function(t){this.x=t.x;this.y=t.y;this.width=t.width;this.height=t.height};e.inflate=function(t,e){this.x-=t;this.width+=2*t;this.y-=e;this.height+=2*e};e.isEmpty=function(){return this.width==0||this.height==0};e.containsRect=function(t){var e=t.x+t.width;var i=t.y+t.height;var n=this.x+this.width;var r=this.y+this.height;return t.x>=this.x&&t.x<n&&t.y>=this.y&&t.y<r&&e>this.x&&e<=n&&i>this.y&&i<=r};e.equals=function(t){if(this===t){return true}return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height};e.inflatePoint=function(t){this.inflate(t.x,t.y)};e.intersection=function(t){var e=this.clone();var i=e.x;var n=e.y;var r=t.x;var a=t.y;var o=Math.max(i,r);var s=Math.min(i+e.width,r+t.width);if(o<=s){var l=Math.max(n,a);var h=Math.min(n+e.height,a+t.height);if(l<=h){e.setTo(o,l,s-o,h-l);return e}}e.setEmpty();return e};e.offset=function(t,e){this.x+=t;this.y+=e};e.offsetPoint=function(t){this.offset(t.x,t.y)};e.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"};e.union=function(t){var e=this.clone();if(t.isEmpty()){return e}if(e.isEmpty()){e.copyFrom(t);return e}var i=Math.min(e.x,t.x);var n=Math.min(e.y,t.y);e.setTo(i,n,Math.max(e.right,t.right)-i,Math.max(e.bottom,t.bottom)-n);return e};t.identity=new t(0,0,0,0);return t}();function DisplayObject(){this.visible;this.parent;this.name;this.x;this.y;this.width;this.height;this.scaleX;this.scaleY;this.anchorX;this.anchorY;this.anchorOffsetX;this.anchorOffsetY;this.rotation;this.alpha;this.worldAlpha;this.blendMode;this.needDraw;this.localMatrix;this.worldTransform}DisplayObject.create=function(){var t=new DisplayObject;t.init();return t};var BlendMode={NORMAL:"normal",ADD:"add",ERASE:"erase",ERASE_REVERSE:"eraseReverse"};DisplayObject.prototype.blendModes={};DisplayObject.prototype.blendModes[BlendMode.NORMAL]="source-over";DisplayObject.prototype.blendModes[BlendMode.ADD]="lighter";DisplayObject.prototype.blendModes[BlendMode.ERASE]="destination-out";DisplayObject.prototype.blendModes[BlendMode.ERASE_REVERSE]="destination-in";DisplayObject.prototype.init=function(){this.scaleX=1;this.scaleY=1;this.x=0;this.y=0;this.width=0;this.height=0;this.anchorOffsetX=0;this.anchorOffsetY=0;this.anchorX=0;this.anchorY=0;this.skewX=0;this.skewY=0;this.name="";this.rotation=0;this.alpha=1;this.worldAlpha=1;this.blendMode=null;this.parent=null;this.visible=true;this.needDraw=false;this.localMatrix=null;this.worldTransform=new Matrix};DisplayObject.prototype.setParent=function(t){this.parent=t;return this};DisplayObject.prototype.getParent=function(){return this.parent};DisplayObject.prototype.setScale=function(t,e){this.scaleX=t;this.scaleY=e;return this};DisplayObject.prototype.setAnchorOffset=function(t,e){this.anchorOffsetX=t;this.anchorOffsetY=e;return this};DisplayObject.prototype.setAnchor=function(t,e){this.anchorX=t;this.anchorY=e;return this};DisplayObject.prototype.isVisible=function(){return this.visible};DisplayObject.prototype.setVisible=function(t){this.visible=t;return this};DisplayObject.prototype.setRotation=function(t){this.rotation=t;return this};DisplayObject.prototype.setAlpha=function(t){this.alpha=t;return this};DisplayObject.prototype.setSkewX=function(t){this.skewX=t;return this};DisplayObject.prototype.setSkewY=function(t){this.skewY=t;return this};DisplayObject.prototype.setBlend=function(t){this.blendMode=t;return this};DisplayObject.prototype.getBlend=function(t){return this.blendMode};DisplayObject.prototype.setWidth=function(t){this.width=t;return this};DisplayObject.prototype.getWidth=function(){return this.width};DisplayObject.prototype.setHeight=function(t){this.height=t;return this};DisplayObject.prototype.getHeight=function(){return this.height};DisplayObject.prototype.setWorldAlpha=function(t){this.worldAlpha=t;return this};DisplayObject.prototype.getWorldAlpha=function(){return this.worldAlpha};DisplayObject.prototype.needDraw=function(){return!!this.needDraw};DisplayObject.prototype.setNeedDraw=function(t){this.needDraw=t;return this};DisplayObject.prototype.setTransform=function(t){this.localMatrix=t;return this};DisplayObject.prototype.draw=function(t){var e,i;if(!this.visible){return}if(this.blendMode){i=this.blendModes[this.blendMode]}else{i=this.blendModes[BlendMode.NORMAL]}t.save();t.globalAlpha=this.alpha;t.globalCompositeOperation=i;e=this.worldTransform;t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty);this.drawSelf(t);t.restore();return};DisplayObject.prototype.getOffsetPoint=function(){var t=this.anchorOffsetX;var e=this.anchorOffsetY;return{x:t,y:e}};DisplayObject.prototype.calcWorldTransform=function(){var t;var e;var i;t=this.parent;i=this.localMatrix;e=this.worldTransform;if(t){e.identityMatrix(t.worldTransform)}else{e.identityMatrix(new Matrix)}var n=this.getOffsetPoint();var r=n.x;var a=n.y;if(i){e.append(i.a,i.b,i.c,i.d,i.tx,i.ty);e.append(1,0,0,1,-r,-a)}else{e.appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,r,a)}if(t){this.worldAlpha=t.worldAlpha*this.alpha}else{this.worldAlpha=this.alpha}return};DisplayObject.prototype.doTransform=function(t){if(!this.visible){return}this.calcWorldTransform();if(this.needDraw){this.draw(t)}return};function DisplayObjectContainer(){DisplayObject.call(this);this.children;this.isContainer}__extends(DisplayObjectContainer,DisplayObject);DisplayObjectContainer.prototype.init=function(){DisplayObject.prototype.init.call(this);this.children=[];this.visible=true;
this.isContainer=true};DisplayObjectContainer.prototype.getChildCount=function(){return this.children.length};DisplayObjectContainer.prototype.addChild=function(t,e){var i;i=this.children.length;if(t.parent===this){i--}return this.addChildAt(t,i)};DisplayObjectContainer.prototype.addChildAt=function(t,e){if(t===this){return}if(t.parent===this){this.setChildIndex(t,e)}else{if(t.parent){this.parent.removeChild(t)}this.children.splice(e,0,t);t.setParent(this)}return t};DisplayObjectContainer.prototype.setChildIndex=function(t,e){var i;i=this.children.indexOf(t);if(i>=0){this.children.splice(i,1);if(e<0||this.children.length<=e){this.children.push(t)}else{this.children.splice(e,0,t)}}return};DisplayObjectContainer.prototype.removeAllChild=function(){this.children=[]};DisplayObjectContainer.prototype.removeChild=function(t){var e;e=this.children.indexOf(t);if(e>=0){return this.removeChildByIndex(e)}return};DisplayObjectContainer.prototype.removeChildByIndex=function(t){var e;e=this.children[t];e.setParent(null);this.children.splice(t,1);return e};DisplayObjectContainer.prototype.getChildIndex=function(t){return this.children.indexOf(t)};DisplayObjectContainer.prototype.updateTransform=function(t){if(!this.visible){return}this.doTransform(t);if(this.isContainer&&this.children.length){for(var e=0,i=this.children.length;e<i;e++){var n=this.children[e];if(n.isContainer){n.updateTransform(t)}else{n.doTransform(t)}}}};DisplayObjectContainer.prototype.drawSelf=function(t){};DisplayObjectContainer.create=function(){var t=new DisplayObjectContainer;t.init();return t};var MainContext=function(){function t(){this.timeScale=1;this.container=null}t.prototype.setObjectContainer=function(t){this.container=t};t.prototype.run=function(){var t=this;var e=Date.now();function i(){var n=Date.now();var r=n-e;t.renderLoop(r);dragonBones.WorldClock.clock.advanceTime(r/1e3);window.requestAnimationFrame(i);e=n}window.requestAnimationFrame(i)};t.prototype.setScale=function(t,e){this.container.scaleX=t;this.container.scaleY=e};t.prototype.setPosition=function(t,e){this.container.x=t;this.container.y=e};t.prototype.renderLoop=function(t){this.container.updateTransform(t)};return t}();MainContext.instance=new MainContext;function Bitmap(){DisplayObject.call(this);this.texture;this.needDraw}__extends(Bitmap,DisplayObject);Bitmap.prototype.init=function(){DisplayObject.prototype.init.call(this);this.needDraw=true};Bitmap.prototype.setTexture=function(t){this.texture=t;if(t){this.setWidth(t.dw);this.setHeight(t.dh)}return this};Bitmap.prototype.getTexture=function(){return this.texture};Bitmap.prototype.drawSelf=function(t){var e;var i;var n;var r;var a;var o;var s;var l;var h;if(!this.texture){return}texture=this.texture;e=texture.dw;i=texture.dh;n=texture.dx;r=texture.dy;a=texture.sx;o=texture.sy;s=texture.sw;l=texture.sh;t.drawImage(texture.texture,a,o,s,l,n,r,e,i);return};Bitmap.create=function(t){var e=new Bitmap;e.xname=t;e.init();return e};var __define=this.__define||function(t,e,i,n){Object.defineProperty(t,e,{configurable:true,enumerable:true,get:i,set:n})};var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t,n=i.prototype;t.DATA_VERSION="4.0";t.DATA_VERSION_4_5="4.5";t.PARENT_COORDINATE_DATA_VERSION="3.0";t.VERSION="4.5.10";return t}();t.DragonBones=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(t){this._animationStateCount=0;this._updateTimelineStates=false;this._updateFFDTimelineStates=false;this._armature=t;this._animationList=[];this._animationStateList=[];this._timeScale=1;this._isPlaying=false;this.tweenEnabled=true}var i=__define,n=e,r=n.prototype;r.dispose=function(){if(!this._armature){return}this._resetAnimationStateList();this._animationList.length=0;this._armature=null;this._animationDataList=null;this._animationList=null;this._animationStateList=null};r._resetAnimationStateList=function(){var e=this._animationStateList.length;var i;while(e--){i=this._animationStateList[e];i._resetTimelineStateList();t.AnimationState._returnObject(i)}this._animationStateList.length=0};r.gotoAndPlay=function(i,n,r,a,o,s,l,h,u){if(n===void 0){n=-1}if(r===void 0){r=-1}if(a===void 0){a=NaN}if(o===void 0){o=0}if(s===void 0){s=null}if(l===void 0){l=e.SAME_LAYER_AND_GROUP}if(h===void 0){h=true}if(u===void 0){u=true}if(!this._animationDataList){return null}var c=this._animationDataList.length;var p;while(c--){if(this._animationDataList[c].name==i){p=this._animationDataList[c];break}}if(!p){return null}var f=this._isPlaying==false;this._isPlaying=true;this._isFading=true;n=n<0?p.fadeTime<0?.3:p.fadeTime:n;var m;if(r<0){m=p.scale<0?1:p.scale}else{m=r*1e3/p.duration}a=isNaN(a)?p.playTimes:a;var d;switch(l){case e.NONE:break;case e.SAME_LAYER:c=this._animationStateList.length;while(c--){d=this._animationStateList[c];if(d.layer==o){d.fadeOut(n,h)}}break;case e.SAME_GROUP:c=this._animationStateList.length;while(c--){d=this._animationStateList[c];if(d.group==s){d.fadeOut(n,h)}}break;case e.ALL:c=this._animationStateList.length;while(c--){d=this._animationStateList[c];d.fadeOut(n,h)}break;case e.SAME_LAYER_AND_GROUP:default:c=this._animationStateList.length;while(c--){d=this._animationStateList[c];if(d.layer==o&&d.group==s){d.fadeOut(n,h)}}break}this._lastAnimationState=t.AnimationState._borrowObject();this._lastAnimationState._layer=o;this._lastAnimationState._group=s;this._lastAnimationState.autoTween=this.tweenEnabled;this._lastAnimationState._fadeIn(this._armature,p,n,1/m,a,u);this.addState(this._lastAnimationState);var y=this._armature.getSlots(false);c=y.length;while(c--){var v=y[c];if(v.childArmature){v.childArmature.animation.gotoAndPlay(i,n)}}if(f){this._armature.advanceTime(0)}return this._lastAnimationState};r.gotoAndStop=function(t,i,n,r,a,o,s,l){if(n===void 0){n=-1}if(r===void 0){r=0}if(a===void 0){a=-1}if(o===void 0){o=0}if(s===void 0){s=null}if(l===void 0){l=e.ALL}var h=this.gotoAndPlay(t,r,a,NaN,o,s,l);if(n>=0){h.setCurrentTime(h.totalTime*n)}else{h.setCurrentTime(i)}h.lastFrameAutoTween=false;h.stop();return h};r.play=function(){if(!this._animationDataList||this._animationDataList.length==0){return}if(!this._lastAnimationState){this.gotoAndPlay(this._animationDataList[0].name)}else if(!this._isPlaying){this._isPlaying=true}else{this.gotoAndPlay(this._lastAnimationState.name)}};r.stop=function(){this._isPlaying=false};r.getState=function(t,e){if(e===void 0){e=0}var i=this._animationStateList.length;while(i--){var n=this._animationStateList[i];if(n.name==t&&n.layer==e){return n}}return null};r.hasAnimation=function(t){var e=this._animationDataList.length;while(e--){if(this._animationDataList[e].name==t){return true}}return false};r._advanceTime=function(t){if(!this._isPlaying){return}if(this._updateTimelineStates){this._updateTimelineStates=false;this.updateTimelineStates()}else if(this._updateFFDTimelineStates){this._updateFFDTimelineStates=false;this.updateFFDTimelineStates()}var e=false;t*=this._timeScale;var i=this._animationStateList.length;while(i--){var n=this._animationStateList[i];if(n._advanceTime(t)){this.removeState(n)}else if(n.fadeState!=1){e=true}}this._isFading=e};r.updateTimelineStates=function(){var t=this._animationStateList.length;while(t--){this._animationStateList[t]._updateTimelineStates()}};r.updateFFDTimelineStates=function(){var t=this._animationStateList.length;while(t--){this._animationStateList[t]._updateFFDTimeline()}};r.addState=function(t){if(this._animationStateList.indexOf(t)<0){this._animationStateList.unshift(t);this._animationStateCount=this._animationStateList.length}};r.removeState=function(e){var i=this._animationStateList.indexOf(e);if(i>=0){this._animationStateList.splice(i,1);t.AnimationState._returnObject(e);if(this._lastAnimationState==e){if(this._animationStateList.length>0){this._lastAnimationState=this._animationStateList[0]}else{this._lastAnimationState=null}}this._animationStateCount=this._animationStateList.length}};i(r,"movementList",function(){return this._animationList});i(r,"movementID",function(){return this.lastAnimationName});i(r,"lastAnimationState",function(){return this._lastAnimationState});i(r,"lastAnimationName",function(){return this._lastAnimationState?this._lastAnimationState.name:null});i(r,"animationList",function(){return this._animationList});i(r,"isPlaying",function(){return this._isPlaying&&!this.isComplete});i(r,"isComplete",function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete){return false}var t=this._animationStateList.length;while(t--){if(!this._animationStateList[t].isComplete){return false}}return true}return true});i(r,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});i(r,"animationDataList",function(){return this._animationDataList},function(t){this._animationDataList=t;this._animationList.length=0;for(var e=0,i=this._animationDataList.length;e<i;e++){var n=this._animationDataList[e];this._animationList[this._animationList.length]=n.name}});e.NONE="none";e.SAME_LAYER="sameLayer";e.SAME_GROUP="sameGroup";e.SAME_LAYER_AND_GROUP="sameLayerAndGroup";e.ALL="all";return e}();t.Animation=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._layer=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._currentPlayTimes=0;this._totalTime=0;this._currentTime=0;this._lastTime=0;this._fadeState=0;this._playTimes=0;this._timelineStateList=[];this._slotTimelineStateList=[];this._ffdTimelineStateList=[];this._boneMasks=[]}var i=__define,n=e,r=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){t.clear();if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}};e._clear=function(){var i=e._pool.length;while(i--){e._pool[i].clear()}e._pool.length=0;t.TimelineState._clear()};r.clear=function(){this._resetTimelineStateList();this._boneMasks.length=0;this._armature=null;this._clip=null};r._resetTimelineStateList=function(){var e=this._timelineStateList.length;while(e--){t.TimelineState._returnObject(this._timelineStateList[e])}this._timelineStateList.length=0;e=this._slotTimelineStateList.length;while(e--){t.SlotTimelineState._returnObject(this._slotTimelineStateList[e])}this._slotTimelineStateList.length=0;e=this._ffdTimelineStateList.length;while(e--){t.FFDTimelineState._returnObject(this._ffdTimelineStateList[e])}this._ffdTimelineStateList.length=0};r.containsBoneMask=function(t){return this._boneMasks.length==0||this._boneMasks.indexOf(t)>=0};r.addBoneMask=function(t,e){if(e===void 0){e=true}this.addBoneToBoneMask(t);if(e){var i=this._armature.getBone(t);if(i){var n=this._armature.getBones(false);var r=n.length;while(r--){var a=n[r];if(i.contains(a)){this.addBoneToBoneMask(a.name)}}}}this._updateTimelineStates();return this};r.removeBoneMask=function(t,e){if(e===void 0){e=true}this.removeBoneFromBoneMask(t);if(e){var i=this._armature.getBone(t);if(i){var n=this._armature.getBones(false);var r=n.length;while(r--){var a=n[r];if(i.contains(a)){this.removeBoneFromBoneMask(a.name)}}}}this._updateTimelineStates();return this};r.removeAllMixingTransform=function(){this._boneMasks.length=0;this._updateTimelineStates();return this};r.addBoneToBoneMask=function(t){if(this._clip.getTimeline(t)&&this._boneMasks.indexOf(t)<0){this._boneMasks.push(t)}};r.removeBoneFromBoneMask=function(t){var e=this._boneMasks.indexOf(t);if(e>=0){this._boneMasks.splice(e,1)}};r._updateTimelineStates=function(){var t;var e;var i;var n=this._timelineStateList.length;var r;while(n--){t=this._timelineStateList[n];if(!this._armature.getBone(t.name)){this.removeTimelineState(t)}}n=this._slotTimelineStateList.length;while(n--){e=this._slotTimelineStateList[n];if(!this._armature.getSlot(e.name)){this.removeSlotTimelineState(e)}}if(this._boneMasks.length>0){n=this._timelineStateList.length;while(n--){t=this._timelineStateList[n];if(this._boneMasks.indexOf(t.name)<0){this.removeTimelineState(t)}}for(n=0,r=this._boneMasks.length;n<r;n++){var a=this._boneMasks[n];this.addTimelineState(a)}}else{for(n=0,r=this._clip.timelineList.length;n<r;n++){var o=this._clip.timelineList[n];this.addTimelineState(o.name)}}for(n=0,r=this._clip.slotTimelineList.length;n<r;n++){var s=this._clip.slotTimelineList[n];this.addSlotTimelineState(s.name)}this._updateFFDTimeline()};r._updateFFDTimeline=function(){var e=0,i=0;var n;var r;var a={};i=this._ffdTimelineStateList.length;for(e=0;e<i;++e){n=this._ffdTimelineStateList[e];r=this._armature.getSlot(n.name);if(!r||r.displayIndex!=n.displayIndex){this._ffdTimelineStateList.splice(e,1);t.FFDTimelineState._returnObject(s)}else{a[n.name]=n}}if(this._clip.ffdTimelineList){i=this._clip.ffdTimelineList.length;for(e=0;e<i;++e){var o=this._clip.ffdTimelineList[e];r=this._armature.getSlot(o.name);if(!a[o.name]&&r&&r.displayList.length>0&&r.displayIndex>=0&&r.displayIndex==o.displayIndex){var s=t.FFDTimelineState._borrowObject();s._fadeIn(r,this,o);this._ffdTimelineStateList.push(s);a[o.name]=s}}}var l=this._armature.getSlots(false);for(e=0,i=l.length;e<i;++e){r=l[e];if(r._meshData&&!a[r.name]){r._updateFFD(null,0)}}};r.addTimelineState=function(e){var i=this._armature.getBone(e);if(i){for(var n=0,r=this._timelineStateList.length;n<r;n++){var a=this._timelineStateList[n];if(a.name==e){return}}var o=t.TimelineState._borrowObject();o._fadeIn(i,this,this._clip.getTimeline(e));this._timelineStateList.push(o)}};r.removeTimelineState=function(e){var i=this._timelineStateList.indexOf(e);this._timelineStateList.splice(i,1);t.TimelineState._returnObject(e)};r.addSlotTimelineState=function(e){var i=this._armature.getSlot(e);if(i){for(var n=0,r=this._slotTimelineStateList.length;n<r;n++){var a=this._slotTimelineStateList[n];if(a.name==e){return}}var o=t.SlotTimelineState._borrowObject();o._fadeIn(i,this,this._clip.getSlotTimeline(e));this._slotTimelineStateList.push(o)}};r.removeSlotTimelineState=function(e){var i=this._slotTimelineStateList.indexOf(e);this._slotTimelineStateList.splice(i,1);t.SlotTimelineState._returnObject(e)};r.play=function(){this._isPlaying=true;return this};r.stop=function(){this._isPlaying=false;return this};r._fadeIn=function(t,e,i,n,r,a){this._armature=t;this._clip=e;this._pausePlayheadInFade=a;this._name=this._clip.name;this._totalTime=this._clip.duration;this.autoTween=this._clip.autoTween;this.setTimeScale(n);this.setPlayTimes(r);this._isComplete=false;this._currentFrameIndex=-1;this._currentPlayTimes=-1;if(Math.round(this._totalTime*this._clip.frameRate*.001)<2||n==Infinity){this._currentTime=this._totalTime}else{this._currentTime=-1}this._time=0;this._boneMasks.length=0;this._isFadeOut=false;this._fadeWeight=0;this._fadeTotalWeight=1;this._fadeState=-1;this._fadeCurrentTime=0;this._fadeBeginTime=this._fadeCurrentTime;this._fadeTotalTime=i*this._timeScale;this._isPlaying=true;this.displayControl=true;this.lastFrameAutoTween=true;this.additiveBlending=false;this.weight=1;this.fadeOutTime=i;this._updateTimelineStates();return this};r.fadeOut=function(t,e){if(!this._armature){return null}if(isNaN(t)||t<0){t=0}this._pausePlayheadInFade=e;if(this._isFadeOut){if(t>this._fadeTotalTime/this._timeScale-(this._fadeCurrentTime-this._fadeBeginTime)){return this}}else{for(var i=0,n=this._timelineStateList.length;i<n;i++){var r=this._timelineStateList[i];r._fadeOut()}}this._isFadeOut=true;this._fadeTotalWeight=this._fadeWeight;this._fadeState=-1;this._fadeBeginTime=this._fadeCurrentTime;this._fadeTotalTime=this._fadeTotalWeight>=0?t*this._timeScale:0;this.displayControl=false;return this};r._advanceTime=function(t){t*=this._timeScale;this.advanceFadeTime(t);if(this._fadeWeight){this.advanceTimelinesTime(t)}return this._isFadeOut&&this._fadeState==1};r.advanceFadeTime=function(e){var i=false;var n=false;if(this._fadeBeginTime>=0){var r=this._fadeState;this._fadeCurrentTime+=e<0?-e:e;if(this._fadeCurrentTime>=this._fadeBeginTime+this._fadeTotalTime){if(this._fadeWeight==1||this._fadeWeight==0){r=1;if(this._pausePlayheadInFade){this._pausePlayheadInFade=false;this._currentTime=-1}}this._fadeWeight=this._isFadeOut?0:1}else if(this._fadeCurrentTime>=this._fadeBeginTime){r=0;this._fadeWeight=(this._fadeCurrentTime-this._fadeBeginTime)/this._fadeTotalTime*this._fadeTotalWeight;if(this._isFadeOut){this._fadeWeight=this._fadeTotalWeight-this._fadeWeight}}else{r=-1;this._fadeWeight=this._isFadeOut?1:0}if(this._fadeState!=r){if(this._fadeState==-1){i=true}if(r==1){n=true}this._fadeState=r}}var a;if(i){if(this._isFadeOut){if(this._armature.hasEventListener(t.AnimationEvent.FADE_OUT)){a=new t.AnimationEvent(t.AnimationEvent.FADE_OUT);a.animationState=this;this._armature._eventList.push(a)}}else{this.hideBones();if(this._armature.hasEventListener(t.AnimationEvent.FADE_IN)){a=new t.AnimationEvent(t.AnimationEvent.FADE_IN);a.animationState=this;this._armature._eventList.push(a)}}}if(n){if(this._isFadeOut){if(this._armature.hasEventListener(t.AnimationEvent.FADE_OUT_COMPLETE)){a=new t.AnimationEvent(t.AnimationEvent.FADE_OUT_COMPLETE);a.animationState=this;this._armature._eventList.push(a)}}else{if(this._armature.hasEventListener(t.AnimationEvent.FADE_IN_COMPLETE)){a=new t.AnimationEvent(t.AnimationEvent.FADE_IN_COMPLETE);a.animationState=this;this._armature._eventList.push(a)}}}};r.advanceTimelinesTime=function(e){if(this._isPlaying&&!this._pausePlayheadInFade){this._time+=e}var i=false;var n=false;var r=false;var a=false;var o=0;var s=this._time*1e3;if(this._playTimes==0){a=false;o=Math.ceil(Math.abs(s)/this._totalTime)||1;if(s>=0){s-=Math.floor(s/this._totalTime)*this._totalTime}else{s-=Math.ceil(s/this._totalTime)*this._totalTime}if(s<0){s+=this._totalTime}}else{var l=this._playTimes*this._totalTime;if(s>=l){s=l;a=true}else if(s<=-l){s=-l;a=true}else{a=false}if(s<0){s+=l}o=Math.ceil(s/this._totalTime)||1;if(s>=0){s-=Math.floor(s/this._totalTime)*this._totalTime}else{s-=Math.ceil(s/this._totalTime)*this._totalTime}if(a){s=this._totalTime}}this._isComplete=a;var h=this._time*1e3/this._totalTime;var u=0;var c=0;for(u=0,c=this._timelineStateList.length;u<c;u++){var p=this._timelineStateList[u];p._update(h);this._isComplete=p._isComplete&&this._isComplete}for(u=0,c=this._slotTimelineStateList.length;u<c;u++){var f=this._slotTimelineStateList[u];f._update(h);this._isComplete=p._isComplete&&this._isComplete}for(u=0,c=this._ffdTimelineStateList.length;u<c;u++){var m=this._ffdTimelineStateList[u];m._update(h);this._isComplete=m._isComplete&&this._isComplete}if(this._currentTime!=s){if(this._currentPlayTimes!=o){if(this._currentPlayTimes>0&&o>1){r=true}this._currentPlayTimes=o}if(this._currentTime<0){i=true}if(this._isComplete){n=true}this._lastTime=this._currentTime;this._currentTime=s;this.updateMainTimeline(a)}var d;if(i){if(this._armature.hasEventListener(t.AnimationEvent.START)){d=new t.AnimationEvent(t.AnimationEvent.START);d.animationState=this;this._armature._eventList.push(d)}}if(n){if(this._armature.hasEventListener(t.AnimationEvent.COMPLETE)){d=new t.AnimationEvent(t.AnimationEvent.COMPLETE);d.animationState=this;this._armature._eventList.push(d)}if(this.autoFadeOut){this.fadeOut(this.fadeOutTime,true)}}else if(r){if(this._armature.hasEventListener(t.AnimationEvent.LOOP_COMPLETE)){d=new t.AnimationEvent(t.AnimationEvent.LOOP_COMPLETE);d.animationState=this;this._armature._eventList.push(d)}}};r.updateMainTimeline=function(t){var e=this._clip.frameList;if(e.length>0){var i;var n;for(var r=0,a=this._clip.frameList.length;r<a;++r){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=e.length){if(t){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}n=e[this._currentFrameIndex];if(i){this._armature._arriveAtFrame(i,null,this,true)}this._currentFrameDuration=n.duration;this._currentFramePosition=n.position;i=n}if(n){this._armature._arriveAtFrame(n,null,this,false)}}};r.hideBones=function(){for(var t=0,e=this._clip.hideTimelineNameMap.length;t<e;t++){var i=this._clip.hideTimelineNameMap[t];var n=this._armature.getBone(i);if(n){n._hideSlots()}}var r;for(t=0,e=this._clip.hideSlotTimelineNameMap.length;t<e;t++){r=this._clip.hideSlotTimelineNameMap[t];var a=this._armature.getSlot(r);if(a){a._resetToOrigin()}}};r.setAdditiveBlending=function(t){this.additiveBlending=t;return this};r.setAutoFadeOut=function(t,e){if(e===void 0){e=-1}this.autoFadeOut=t;if(e>=0){this.fadeOutTime=e*this._timeScale}return this};r.setWeight=function(t){if(isNaN(t)||t<0){t=1}this.weight=t;return this};r.setFrameTween=function(t,e){this.autoTween=t;this.lastFrameAutoTween=e;return this};r.setCurrentTime=function(t){if(t<0||isNaN(t)){t=0}this._time=t;this._currentTime=this._time*1e3;return this};r.setTimeScale=function(t){if(isNaN(t)||t==Infinity){t=1}this._timeScale=t;return this};r.setPlayTimes=function(t){if(t===void 0){t=0}if(Math.round(this._totalTime*.001*this._clip.frameRate)<2){this._playTimes=t<0?-1:1}else{this._playTimes=t<0?-t:t}this.autoFadeOut=t<0?true:false;return this};i(r,"name",function(){return this._name});i(r,"layer",function(){return this._layer});i(r,"group",function(){return this._group});i(r,"clip",function(){return this._clip});i(r,"isComplete",function(){return this._isComplete});i(r,"isPlaying",function(){return this._isPlaying&&!this._isComplete});i(r,"currentPlayTimes",function(){return this._currentPlayTimes<0?0:this._currentPlayTimes});i(r,"totalTime",function(){return this._totalTime*.001});i(r,"currentTime",function(){return this._currentTime<0?0:this._currentTime*.001});i(r,"fadeWeight",function(){return this._fadeWeight});i(r,"fadeState",function(){return this._fadeState});i(r,"fadeTotalTime",function(){return this._fadeTotalTime});i(r,"timeScale",function(){return this._timeScale});i(r,"playTimes",function(){return this._playTimes});e._pool=[];return e}();t.AnimationState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.skin=null;this.name=null;this.displayIndex=0;this._isComplete=false;this._animationState=null;this._totalTime=0;this._currentTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._tweenEasing=NaN;this._tweenCurve=null;this._tweenVertices=false;this._offset=0;this._durationVertices=[];this._updateVertices=[];this._rawAnimationScale=1;this._updateMode=0;this._slot=null;this._timelineData=null}var i=__define,n=e,r=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e._clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};r.clear=function(){this._slot=null;this._animationState=null;this._timelineData=null};r._fadeIn=function(t,e,i){this._slot=t;this._animationState=e;this._timelineData=i;this.name=i.name;this.skin=i.skin;this.displayIndex=i.displayIndex;this._totalTime=this._timelineData.duration;this._rawAnimationScale=this._animationState.clip.scale;this._isComplete=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}};r._fadeOut=function(){};r._update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};r.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}}}if(this._currentTime!=i){this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration){this._currentFrameIndex++;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this.updateToNextFrame(e)}if(this._tweenEasing==this._tweenEasing){this.updateTween()}}};r.updateToNextFrame=function(t){if(t===void 0){t=0}var e=this._currentFrameIndex+1;if(e>=this._timelineData.frameList.length){e=0}var i=this._timelineData.frameList[this._currentFrameIndex];var n=this._timelineData.frameList[e];var r=false;if(e==0&&(!this._animationState.lastFrameAutoTween||this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+t-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;r=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.clip.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=i.tweenEasing;this._tweenCurve=i.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){r=false}else{if(this._tweenEasing==10){this._tweenEasing=0}r=true}}else{r=true}}else{this._tweenEasing=i.tweenEasing;this._tweenCurve=i.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;r=false}else{r=true}}if(r){this._offset=i.offset<n.offset?i.offset:n.offset;var a=i.offset+i.vertices.length>n.offset+n.vertices.length?i.offset+i.vertices.length:n.offset+n.vertices.length;this._durationVertices.length=a-this._offset;var o;var s;this._tweenVertices=false;for(var l=this._offset;l<a;l++){o=0;s=0;if(i.offset<=l&&i.vertices.length+i.offset>l){o=Number(i.vertices[l-i.offset])}if(n.offset<=l&&n.vertices.length+n.offset>l){s=Number(n.vertices[l-n.offset])}this._durationVertices[l-this._offset]=s-o;if(this._durationVertices[l-this._offset]!=0){this._tweenVertices=true}}}else{this._tweenVertices=false;this._slot._updateFFD(i.vertices,i.offset)}};r.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenVertices&&this._animationState.displayControl){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}var n=this._offset+this._durationVertices.length;this._updateVertices.length=this._durationVertices.length;var r;for(var a=this._offset;a<n;a++){r=0;if(e.offset<=a&&e.vertices.length+e.offset>a){r=Number(e.vertices[a-e.offset])}this._updateVertices[a-this._offset]=r+this._durationVertices[a-this._offset]*i}this._slot._updateFFD(this._updateVertices,this._offset)}};r.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._isComplete=true;this._tweenEasing=NaN;this._tweenVertices=false;if(this._animationState.displayControl){this._slot._updateFFD(t.vertices,t.offset)}};e._pool=[];return e}();t.FFDTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._durationColor=new t.ColorTransform}var i=__define,n=e,r=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e._clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};r.clear=function(){if(this._slot){this._slot=null}this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null};r._fadeIn=function(t,e,i){this._slot=t;this._armature=this._slot.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this.name=i.name;this._totalTime=this._timelineData.duration;this._rawAnimationScale=this._animationState.clip.scale;this._isComplete=false;this._blendEnabled=false;this._tweenColor=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}};r._fadeOut=function(){};r._update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};r.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}}}if(this._currentTime!=i){this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration){this._currentFrameIndex++;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];if(o){this._slot._arriveAtFrame(o,this,this._animationState,true)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this._slot._arriveAtFrame(s,this,this._animationState,false);this._blendEnabled=s.displayIndex>=0;if(this._blendEnabled){this.updateToNextFrame(e)}else{this._tweenEasing=NaN;this._tweenColor=false}}if(this._blendEnabled){this.updateTween()}}};r.updateToNextFrame=function(t){if(t===void 0){t=0}var e=this._currentFrameIndex+1;if(e>=this._timelineData.frameList.length){e=0}var i=this._timelineData.frameList[this._currentFrameIndex];var n=this._timelineData.frameList[e];var r=false;if(e==0&&(!this._animationState.lastFrameAutoTween||this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+t-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;r=false}else if(i.displayIndex<0||n.displayIndex<0){this._tweenEasing=NaN;r=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.clip.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=i.tweenEasing;this._tweenCurve=i.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){r=false}else{if(this._tweenEasing==10){this._tweenEasing=0}r=true}}else{r=true}}else{this._tweenEasing=i.tweenEasing;this._tweenCurve=i.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;r=false}else{r=true}}if(r){if(i.color&&n.color){
this._durationColor.alphaOffset=n.color.alphaOffset-i.color.alphaOffset;this._durationColor.redOffset=n.color.redOffset-i.color.redOffset;this._durationColor.greenOffset=n.color.greenOffset-i.color.greenOffset;this._durationColor.blueOffset=n.color.blueOffset-i.color.blueOffset;this._durationColor.alphaMultiplier=n.color.alphaMultiplier-i.color.alphaMultiplier;this._durationColor.redMultiplier=n.color.redMultiplier-i.color.redMultiplier;this._durationColor.greenMultiplier=n.color.greenMultiplier-i.color.greenMultiplier;this._durationColor.blueMultiplier=n.color.blueMultiplier-i.color.blueMultiplier;if(this._durationColor.alphaOffset||this._durationColor.redOffset||this._durationColor.greenOffset||this._durationColor.blueOffset||this._durationColor.alphaMultiplier||this._durationColor.redMultiplier||this._durationColor.greenMultiplier||this._durationColor.blueMultiplier){this._tweenColor=true}else{this._tweenColor=false}}else if(i.color){this._tweenColor=true;this._durationColor.alphaOffset=-i.color.alphaOffset;this._durationColor.redOffset=-i.color.redOffset;this._durationColor.greenOffset=-i.color.greenOffset;this._durationColor.blueOffset=-i.color.blueOffset;this._durationColor.alphaMultiplier=1-i.color.alphaMultiplier;this._durationColor.redMultiplier=1-i.color.redMultiplier;this._durationColor.greenMultiplier=1-i.color.greenMultiplier;this._durationColor.blueMultiplier=1-i.color.blueMultiplier}else if(n.color){this._tweenColor=true;this._durationColor.alphaOffset=n.color.alphaOffset;this._durationColor.redOffset=n.color.redOffset;this._durationColor.greenOffset=n.color.greenOffset;this._durationColor.blueOffset=n.color.blueOffset;this._durationColor.alphaMultiplier=n.color.alphaMultiplier-1;this._durationColor.redMultiplier=n.color.redMultiplier-1;this._durationColor.greenMultiplier=n.color.greenMultiplier-1;this._durationColor.blueMultiplier=n.color.blueMultiplier-1}else{this._tweenColor=false}}else{this._tweenColor=false}if(!this._tweenColor&&this._animationState.displayControl){if(i.color){this._slot._updateDisplayColor(i.color.alphaOffset,i.color.redOffset,i.color.greenOffset,i.color.blueOffset,i.color.alphaMultiplier,i.color.redMultiplier,i.color.greenMultiplier,i.color.blueMultiplier,true)}else if(this._slot._isColorChanged){this._slot._updateDisplayColor(0,0,0,0,1,1,1,1,false)}}};r.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenColor&&this._animationState.displayControl){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}if(e.color){this._slot._updateDisplayColor(e.color.alphaOffset+this._durationColor.alphaOffset*i,e.color.redOffset+this._durationColor.redOffset*i,e.color.greenOffset+this._durationColor.greenOffset*i,e.color.blueOffset+this._durationColor.blueOffset*i,e.color.alphaMultiplier+this._durationColor.alphaMultiplier*i,e.color.redMultiplier+this._durationColor.redMultiplier*i,e.color.greenMultiplier+this._durationColor.greenMultiplier*i,e.color.blueMultiplier+this._durationColor.blueMultiplier*i,true)}else{this._slot._updateDisplayColor(this._durationColor.alphaOffset*i,this._durationColor.redOffset*i,this._durationColor.greenOffset*i,this._durationColor.blueOffset*i,1+this._durationColor.alphaMultiplier*i,1+this._durationColor.redMultiplier*i,1+this._durationColor.greenMultiplier*i,1+this._durationColor.blueMultiplier*i,true)}}};r.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._slot._arriveAtFrame(t,this,this._animationState,false);this._isComplete=true;this._tweenEasing=NaN;this._tweenColor=false;this._blendEnabled=t.displayIndex>=0;if(this._blendEnabled){if(this._animationState.displayControl){if(t.color){this._slot._updateDisplayColor(t.color.alphaOffset,t.color.redOffset,t.color.greenOffset,t.color.blueOffset,t.color.alphaMultiplier,t.color.redMultiplier,t.color.greenMultiplier,t.color.blueMultiplier,true)}else if(this._slot._isColorChanged){this._slot._updateDisplayColor(0,0,0,0,1,1,1,1,false)}}}};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.SlotTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._lastTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._transform=new t.DBTransform;this._pivot=new t.Point;this._durationTransform=new t.DBTransform;this._durationPivot=new t.Point;this._durationColor=new t.ColorTransform}var i=__define,n=e,r=n.prototype;e._borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e._returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e._clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};r.clear=function(){if(this._bone){this._bone._removeState(this);this._bone=null}this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null;this._originTransform=null;this._originPivot=null};r._fadeIn=function(t,e,i){this._bone=t;this._armature=this._bone.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this._originTransform=this._timelineData.originTransform;this._originPivot=this._timelineData.originPivot;this.name=i.name;this._totalTime=this._timelineData.duration;this._rawAnimationScale=this._animationState.clip.scale;this._isComplete=false;this._tweenTransform=false;this._tweenScale=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;this._transform.x=0;this._transform.y=0;this._transform.scaleX=1;this._transform.scaleY=1;this._transform.skewX=0;this._transform.skewY=0;this._pivot.x=0;this._pivot.y=0;this._durationTransform.x=0;this._durationTransform.y=0;this._durationTransform.scaleX=1;this._durationTransform.scaleY=1;this._durationTransform.skewX=0;this._durationTransform.skewY=0;this._durationPivot.x=0;this._durationPivot.y=0;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}this._bone._addState(this)};r._fadeOut=function(){this._transform.skewX=t.TransformUtil.formatRadian(this._transform.skewX);this._transform.skewY=t.TransformUtil.formatRadian(this._transform.skewY)};r._update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};r.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{if(i>=0){i-=Math.floor(i/this._totalTime)*this._totalTime}else{i-=Math.ceil(i/this._totalTime)*this._totalTime}}}if(this._currentTime!=i){this._lastTime=this._currentTime;this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];if(o){this._bone._arriveAtFrame(o,this,this._animationState,true)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this._bone._arriveAtFrame(s,this,this._animationState,false);this.updateToNextFrame(e)}this.updateTween()}};r.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var a=false;if(i==0&&(!this._animationState.lastFrameAutoTween||this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;a=false}else if(n.displayIndex<0||r.displayIndex<0){this._tweenEasing=NaN;a=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.clip.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){a=false}else{if(this._tweenEasing==10){this._tweenEasing=0}a=true}}else{a=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;a=false}else{a=true}}if(a){this._durationTransform.x=r.transform.x-n.transform.x;this._durationTransform.y=r.transform.y-n.transform.y;this._durationTransform.skewX=r.transform.skewX-n.transform.skewX;this._durationTransform.skewY=r.transform.skewY-n.transform.skewY;this._durationTransform.scaleX=r.transform.scaleX-n.transform.scaleX+r.scaleOffset.x;this._durationTransform.scaleY=r.transform.scaleY-n.transform.scaleY+r.scaleOffset.y;this._durationTransform.normalizeRotation();if(i==0){this._durationTransform.skewX=t.TransformUtil.formatRadian(this._durationTransform.skewX);this._durationTransform.skewY=t.TransformUtil.formatRadian(this._durationTransform.skewY)}this._durationPivot.x=r.pivot.x-n.pivot.x;this._durationPivot.y=r.pivot.y-n.pivot.y;if(this._durationTransform.x||this._durationTransform.y||this._durationTransform.skewX||this._durationTransform.skewY||this._durationTransform.scaleX||this._durationTransform.scaleY||this._durationPivot.x||this._durationPivot.y){this._tweenTransform=true;this._tweenScale=n.tweenScale}else{this._tweenTransform=false;this._tweenScale=false}}else{this._tweenTransform=false;this._tweenScale=false}if(!this._tweenTransform){if(this._animationState.additiveBlending){this._transform.x=n.transform.x;this._transform.y=n.transform.y;this._transform.skewX=n.transform.skewX;this._transform.skewY=n.transform.skewY;this._transform.scaleX=n.transform.scaleX;this._transform.scaleY=n.transform.scaleY;this._pivot.x=n.pivot.x;this._pivot.y=n.pivot.y}else{this._transform.x=this._originTransform.x+n.transform.x;this._transform.y=this._originTransform.y+n.transform.y;this._transform.skewX=this._originTransform.skewX+n.transform.skewX;this._transform.skewY=this._originTransform.skewY+n.transform.skewY;this._transform.scaleX=this._originTransform.scaleX*n.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*n.transform.scaleY;this._pivot.x=this._originPivot.x+n.pivot.x;this._pivot.y=this._originPivot.y+n.pivot.y}this._bone.invalidUpdate()}else if(!this._tweenScale){if(this._animationState.additiveBlending){this._transform.scaleX=n.transform.scaleX;this._transform.scaleY=n.transform.scaleY}else{this._transform.scaleX=this._originTransform.scaleX*n.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*n.transform.scaleY}}};r.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenTransform){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}var n=e.transform;var r=e.pivot;if(this._animationState.additiveBlending){this._transform.x=n.x+this._durationTransform.x*i;this._transform.y=n.y+this._durationTransform.y*i;this._transform.skewX=n.skewX+this._durationTransform.skewX*i;this._transform.skewY=n.skewY+this._durationTransform.skewY*i;if(this._tweenScale){this._transform.scaleX=n.scaleX+this._durationTransform.scaleX*i;this._transform.scaleY=n.scaleY+this._durationTransform.scaleY*i}this._pivot.x=r.x+this._durationPivot.x*i;this._pivot.y=r.y+this._durationPivot.y*i}else{this._transform.x=this._originTransform.x+n.x+this._durationTransform.x*i;this._transform.y=this._originTransform.y+n.y+this._durationTransform.y*i;this._transform.skewX=this._originTransform.skewX+n.skewX+this._durationTransform.skewX*i;this._transform.skewY=this._originTransform.skewY+n.skewY+this._durationTransform.skewY*i;if(this._tweenScale){this._transform.scaleX=this._originTransform.scaleX*n.scaleX+this._durationTransform.scaleX*i;this._transform.scaleY=this._originTransform.scaleY*n.scaleY+this._durationTransform.scaleY*i}this._pivot.x=this._originPivot.x+r.x+this._durationPivot.x*i;this._pivot.y=this._originPivot.y+r.y+this._durationPivot.y*i}this._bone.invalidUpdate()}};r.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._bone._arriveAtFrame(t,this,this._animationState,false);this._isComplete=true;this._tweenEasing=NaN;this._tweenTransform=false;this._tweenScale=false;this._tweenColor=false;if(this._animationState.additiveBlending){this._transform.x=t.transform.x;this._transform.y=t.transform.y;this._transform.skewX=t.transform.skewX;this._transform.skewY=t.transform.skewY;this._transform.scaleX=t.transform.scaleX;this._transform.scaleY=t.transform.scaleY;this._pivot.x=t.pivot.x;this._pivot.y=t.pivot.y}else{this._transform.x=this._originTransform.x+t.transform.x;this._transform.y=this._originTransform.y+t.transform.y;this._transform.skewX=this._originTransform.skewX+t.transform.skewX;this._transform.skewY=this._originTransform.skewY+t.transform.skewY;this._transform.scaleX=this._originTransform.scaleX*t.transform.scaleX;this._transform.scaleY=this._originTransform.scaleY*t.transform.scaleY;this._pivot.x=this._originPivot.x+t.pivot.x;this._pivot.y=this._originPivot.y+t.pivot.y}this._bone.invalidUpdate()};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.TimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e){if(t===void 0){t=-1}if(e===void 0){e=1}this._time=t>=0?t:(new Date).getTime()*.001;this._timeScale=isNaN(e)?1:e;this._animatableList=[]}var e=__define,i=t,n=i.prototype;e(n,"time",function(){return this._time});e(n,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});n.contains=function(t){return this._animatableList.indexOf(t)>=0};n.add=function(t){if(t&&this._animatableList.indexOf(t)==-1){this._animatableList.push(t)}};n.remove=function(t){var e=this._animatableList.indexOf(t);if(e>=0){this._animatableList[e]=null}};n.clear=function(){this._animatableList.length=0};n.advanceTime=function(t){if(t===void 0){t=-1}if(t<0){t=(new Date).getTime()*.001-this._time}t*=this._timeScale;this._time+=t;this._length=this._animatableList.length;if(this._length==0){return}this._currentIndex=0;for(this._i=0;this._i<this._length;this._i++){this._animatable=this._animatableList[this._i];if(this._animatable){if(this._currentIndex!=this._i){this._animatableList[this._currentIndex]=this._animatable;this._animatableList[this._i]=null}this._animatable.advanceTime(t);this._currentIndex++}}if(this._currentIndex!=this._i){this._length=this._animatableList.length;while(this._i<this._length){this._animatableList[this._currentIndex++]=this._animatableList[this._i++]}this._animatableList.length=this._currentIndex}};t.clock=new t;return t}();t.WorldClock=e})(dragonBones||(dragonBones={}));var __extends=this.__extends||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];function n(){this.constructor=t}n.prototype=e.prototype;t.prototype=new n};var dragonBones;(function(t){var e=function(){function t(){}t.prototype.hasEventListener=function(t){if(this._listenersMap&&this._listenersMap[t]){return true}return false};t.prototype.addEventListener=function(t,e){if(t&&e){if(!this._listenersMap){this._listenersMap={}}var i=this._listenersMap[t];if(i){this.removeEventListener(t,e)}if(i){i.push(e)}else{this._listenersMap[t]=[e]}}};t.prototype.removeEventListener=function(t,e){if(!this._listenersMap||!t||!e){return}var i=this._listenersMap[t];if(i){var n=i.length;for(var r=0;r<n;r++){if(i[r].toString()===e.toString()){if(n==1){i.length=0}else{i.splice(r,1)}}}}};t.prototype.removeAllEventListeners=function(t){if(t){delete this._listenersMap[t]}else{this._listenersMap=null}};t.prototype.dispatchEvent=function(t){if(t){var e=this._listenersMap[t.type];if(e){t.target=this;var i=e.concat();var n=e.length;for(var r=0;r<n;r++){i[r](t)}}}};return t}();t.EventDispatcher=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);if(e._instance){throw new Error("Singleton already constructed!")}}var i=__define,n=e,r=n.prototype;e.getInstance=function(){if(!e._instance){e._instance=new e}return e._instance};return e}(t.EventDispatcher);t.SoundEventManager=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this._boneIKList=[];this._display=i;this._animation=new t.Animation(this);this._slotsZOrderChanged=false;this._slotList=[];this._boneList=[];this._eventList=[];this._ikList=[];this._delayDispose=false;this._lockDispose=false;this._armatureData=null}var n=__define,r=i,a=r.prototype;n(a,"armatureData",function(){return this._armatureData});n(a,"display",function(){return this._display});a.getDisplay=function(){return this._display};n(a,"animation",function(){return this._animation});a.dispose=function(){this._delayDispose=true;if(!this._animation||this._lockDispose){return}this.userData=null;this._animation.dispose();var t=this._slotList.length;while(t--){this._slotList[t].dispose()}t=this._boneList.length;while(t--){this._boneList[t].dispose()}t=this._ikList.length;while(t--){this._ikList[t].dispose()}this._armatureData=null;this._animation=null;this._slotList=null;this._boneList=null;this._eventList=null;this._ikList=null};a.invalidUpdate=function(t){if(t===void 0){t=null}if(t){var e=this.getBone(t);if(e){e.invalidUpdate()}}else{var i=this._boneList.length;while(i--){this._boneList[i].invalidUpdate()}}};a.advanceTime=function(e){this._lockDispose=true;this._animation._advanceTime(e);e*=this._animation.timeScale;this._isFading=this._animation._isFading;var i=this._boneIKList.length;var n;var r;var a;for(this._i=0;this._i<i;this._i++){for(r=0,a=this._boneIKList[this._i].length;r<a;r++){n=this._boneIKList[this._i][r];if(n.isIKConstraint){var o=this._ikList[this._i-1];if(o.bones[0].name==n.name){n._update(this._isFading);n.rotationIK=n.global.rotation;if(o.bones.length>1){o.bones[1]._update(this._isFading);o.bones[1].rotationIK=o.bones[1].global.rotation}o.compute()}n.adjustGlobalTransformMatrixByIK()}else{n._update(this._isFading);n.rotationIK=n.global.rotation}}}this._i=this._slotList.length;while(this._i--){this._tmpSlot=this._slotList[this._i];this._tmpSlot._update();if(this._tmpSlot._isShowDisplay){var s=this._tmpSlot.childArmature;if(s){s.advanceTime(e)}}}if(this._slotsZOrderChanged){this.updateSlotsZOrder();if(this.hasEventListener(t.ArmatureEvent.Z_ORDER_UPDATED)){this.dispatchEvent(new t.ArmatureEvent(t.ArmatureEvent.Z_ORDER_UPDATED))}}if(this._eventList.length>0){for(this._i=0,this._len=this._eventList.length;this._i<this._len;this._i++){var l=this._eventList[this._i];this.dispatchEvent(l)}this._eventList.length=0}this._lockDispose=false;if(this._delayDispose){this.dispose()}};a.resetAnimation=function(){this.animation.stop();this.animation._resetAnimationStateList();for(var t=0,e=this._boneList.length;t<e;t++){this._boneList[t]._removeAllStates()}};a.getSlots=function(t){if(t===void 0){t=true}return t?this._slotList.concat():this._slotList};a.getSlot=function(t){var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];if(n.name==t){return n}}return null};a.getSlotByDisplay=function(t){if(t){var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];if(n.display==t){return n}}}return null};a.addSlot=function(t,e){var i=this.getBone(e);if(i){i.addSlot(t)}else{throw new Error}};a.removeSlot=function(t){if(!t||t.armature!=this){throw new Error}t.parent.removeSlot(t)};a.removeSlotByName=function(t){var e=this.getSlot(t);if(e){this.removeSlot(e)}return e};a.getBones=function(t){if(t===void 0){t=true}return t?this._boneList.concat():this._boneList};a.getBone=function(t){var e=this._boneList.length;for(var i=0;i<e;i++){var n=this._boneList[i];if(n.name==t){return n}}return null};a.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null};a.addBone=function(t,e,i){if(e===void 0){e=null}if(i===void 0){i=false}var n;if(e){n=this.getBone(e);if(!n){throw new Error}}if(n){n.addChildBone(t,i)}else{if(t.parent){t.parent.removeChildBone(t,i)}t._setArmature(this);if(!i){this._updateAnimationAfterBoneListChanged()}}};a.removeBone=function(t,e){if(e===void 0){e=false}if(!t||t.armature!=this){throw new Error}if(t.parent){t.parent.removeChildBone(t,e)}else{t._setArmature(null);if(!e){this._updateAnimationAfterBoneListChanged(false)}}};a.removeBoneByName=function(t){var e=this.getBone(t);if(e){this.removeBone(e)}return e};a._addBoneToBoneList=function(t){if(this._boneList.indexOf(t)<0){this._boneList[this._boneList.length]=t}};a._removeBoneFromBoneList=function(t){var e=this._boneList.indexOf(t);if(e>=0){this._boneList.splice(e,1)}};a._addSlotToSlotList=function(t){if(this._slotList.indexOf(t)<0){this._slotList[this._slotList.length]=t}};a._removeSlotFromSlotList=function(t){var e=this._slotList.indexOf(t);if(e>=0){this._slotList.splice(e,1)}};a.updateSlotsZOrder=function(){this._slotList.sort(this.sortSlot);var t=this._slotList.length;while(t--){var e=this._slotList[t];if(e._isShowDisplay){e._addDisplayToContainer(this._display)}}this._slotsZOrderChanged=false};a._updateAnimationAfterBoneListChanged=function(t){if(t===void 0){t=true}if(t){this.sortBoneList()}this._animation._updateTimelineStates=true};a.sortBoneList=function(){var e=this._boneList.length;if(e==0){return}var i=[];while(e--){var n=0;var r=this._boneList[e];var a=r;while(a){n++;a=a.parent}i[e]=[n,r]}i.sort(t.ArmatureData.sortBoneDataHelpArrayDescending);e=i.length;while(e--){this._boneList[e]=i[e][1]}i.length=0};a._arriveAtFrame=function(e,n,r,a){if(e.event&&this.hasEventListener(t.FrameEvent.ANIMATION_FRAME_EVENT)){var o=new t.FrameEvent(t.FrameEvent.ANIMATION_FRAME_EVENT);o.animationState=r;o.frameLabel=e.event;this._eventList.push(o)}if(e.sound&&i._soundManager.hasEventListener(t.SoundEvent.SOUND)){var s=new t.SoundEvent(t.SoundEvent.SOUND);s.armature=this;s.animationState=r;s.sound=e.sound;i._soundManager.dispatchEvent(s)}if(e.action){if(r.displayControl){this.animation.gotoAndPlay(e.action)}}};a.sortSlot=function(t,e){return t.zOrder<e.zOrder?1:-1};a.getAnimation=function(){return this._animation};a.getIKs=function(t){if(t===void 0){t=true}return t?this._ikList.concat():this._ikList};a.buildIK=function(){var e;this._ikList.length=0;for(var i=0,n=this._armatureData.ikDataList.length;i<n;i++){e=this._armatureData.ikDataList[i];this._ikList.push(new t.IKConstraint(e,this))}};a.updateBoneCache=function(){this._boneList.reverse();var t={};var e=this._ikList.length;var i=e+1;var n;var r;var a;var o;var s;var l;this._boneIKList=[];while(this._boneIKList.length<i){this._boneIKList[this._boneIKList.length]=[]}t[this._boneList[0].name]=0;for(n=0,r=this._ikList.length;n<r;n++){t[this._ikList[n].bones[0].name]=n+1}t:for(n=0,r=this._boneList.length;n<r;n++){s=this._boneList[n];l=s;while(l){if(l.parent==null){t[l.name]=0}if(t.hasOwnProperty(l.name)){this._boneIKList[t[l.name]].push(s);continue t}l=l.parent}}};a.getIKTargetData=function(t){var e=[];var i;for(var n=0,r=this._ikList.length;n<r;n++){i=this._ikList[n];if(t.name==i.target.name){e.push(i)}}return e};i._soundManager=t.SoundEventManager.getInstance();return i}(t.EventDispatcher);t.Armature=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0}var e=__define,i=t,n=i.prototype;n.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var a=t*n-e*i;this.a=n/a;this.b=-e/a;this.c=-i/a;this.d=t/a;this.tx=(i*this.ty-n*r)/a;this.ty=-(t*this.ty-e*r)/a};n.concat=function(t){var e=t.a;var i=t.b;var n=t.c;var r=t.d;var a=this.tx;var o=this.ty;if(e!=1||i!=0||n!=0||r!=1){var s=this.a;var l=this.b;var h=this.c;var u=this.d;this.a=s*e+l*n;this.b=s*i+l*r;this.c=h*e+u*n;this.d=h*i+u*r}this.tx=a*e+o*n+t.tx;this.ty=a*i+o*r+t.ty};n.copyFrom=function(t){this.tx=t.tx;this.ty=t.ty;this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d};n.transformPoint=function(t,e,i,n){if(n===void 0){n=false}i.x=this.a*t+this.c*e;i.y=this.b*t+this.d*e;if(!n){i.x+=this.tx;i.y+=this.ty}};return t}();t.Matrix=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.x=0;this.y=0;this.skewX=0;this.skewY=0;this.scaleX=1;this.scaleY=1}var i=__define,n=e,r=n.prototype;i(r,"rotation",function(){return this.skewX},function(t){this.skewX=this.skewY=t});r.copy=function(t){this.x=t.x;this.y=t.y;this.skewX=t.skewX;this.skewY=t.skewY;this.scaleX=t.scaleX;this.scaleY=t.scaleY};r.add=function(t){this.x+=t.x;this.y+=t.y;this.skewX+=t.skewX;this.skewY+=t.skewY;this.scaleX*=t.scaleX;this.scaleY*=t.scaleY};r.minus=function(t){this.x-=t.x;this.y-=t.y;this.skewX-=t.skewX;this.skewY-=t.skewY;this.scaleX/=t.scaleX;this.scaleY/=t.scaleY};r.normalizeRotation=function(){this.skewX=t.TransformUtil.normalizeRotation(this.skewX);this.skewY=t.TransformUtil.normalizeRotation(this.skewY)};r.clone=function(){var t=new e;t.copy(this);return t};r.toString=function(){var t="x:"+this.x+" y:"+this.y+" skewX:"+this.skewX+" skewY:"+this.skewY+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY;return t};return e}();t.DBTransform=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._globalTransformMatrix=new t.Matrix;this._global=new t.DBTransform;this._origin=new t.DBTransform;this._offset=new t.DBTransform;this._offset.scaleX=this._offset.scaleY=1;this._visible=true;this._armature=null;this._parent=null;this.userData=null;this.inheritRotation=true;this.inheritScale=true;this.inheritTranslation=true}var i=__define,n=e,r=n.prototype;i(r,"global",function(){return this._global});i(r,"origin",function(){return this._origin});i(r,"offset",function(){return this._offset});i(r,"armature",function(){return this._armature});r._setArmature=function(t){this._armature=t};i(r,"parent",function(){return this._parent});r._setParent=function(t){this._parent=t};r.dispose=function(){this.userData=null;this._globalTransformMatrix=null;this._global=null;this._origin=null;this._offset=null;this._armature=null;this._parent=null};r._calculateRelativeParentTransform=function(){};r._calculateParentTransform=function(){if(this.parent&&(this.inheritTranslation||this.inheritRotation||this.inheritScale)){var e=this._parent._globalTransformForChild;var i=this._parent._globalTransformMatrixForChild;return t.ParentTransformObject.create().setTo(e,i)}t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix);return null};r._updateGlobal=function(){this._calculateRelativeParentTransform();var e=this._calculateParentTransform();if(e!=null){var i=e.parentGlobalTransformMatrix;var n=e.parentGlobalTransform;var r=this._global.x;var a=this._global.y;this._global.x=i.a*r+i.c*a+i.tx;this._global.y=i.d*a+i.b*r+i.ty;if(this.inheritRotation){this._global.skewX+=n.skewX;this._global.skewY+=n.skewY}if(this.inheritScale){this._global.scaleX*=n.scaleX;this._global.scaleY*=n.scaleY}}t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix);return e};e._tempParentGlobalTransformMatrix=new t.Matrix;e._tempParentGlobalTransform=new t.DBTransform;return e}();t.DBObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.applyOffsetTranslationToChild=true;this.applyOffsetRotationToChild=true;this.applyOffsetScaleToChild=false;this.isIKConstraint=false;this.childrenBones=[];this._needUpdate=0;this._tween=new t.DBTransform;this._tweenPivot=new t.Point;this._tween.scaleX=this._tween.scaleY=1;this._boneList=[];this._slotList=[];this._timelineStateList=[];this._needUpdate=2;this._isColorChanged=false}var n=__define,r=i,a=r.prototype;i.initWithBoneData=function(t){var e=new i;e.name=t.name;e.length=t.length;e.inheritRotation=t.inheritRotation;e.inheritScale=t.inheritScale;e.origin.copy(t.transform);return e};a.dispose=function(){if(!this._boneList){return}e.prototype.dispose.call(this);var t=this._boneList.length;while(t--){this._boneList[t].dispose()}t=this._slotList.length;while(t--){this._slotList[t].dispose()}this._tween=null;this._tweenPivot=null;this._boneList=null;this._slotList=null;this._timelineStateList=null};a.contains=function(t){if(!t){throw new Error}if(t==this){return false}var e=t;while(!(e==this||e==null)){e=e.parent}return e==this};a.addChildBone=function(t,e){if(e===void 0){e=false}if(!t){throw new Error}if(t==this||t.contains(this)){throw new Error}if(t.parent==this){return}if(t.parent){t.parent.removeChildBone(t,e)}this._boneList[this._boneList.length]=t;t._setParent(this);t._setArmature(this._armature);var i=this.childrenBones.indexOf(t);if(i<0){this.childrenBones.push(t)}if(this._armature&&!e){this._armature._updateAnimationAfterBoneListChanged()}};a.removeChildBone=function(t,e){if(e===void 0){e=false}if(!t){throw new Error}var i=this._boneList.indexOf(t);if(i<0){throw new Error}this._boneList.splice(i,1);t._setParent(null);t._setArmature(null);var n=this.childrenBones.indexOf(t);if(n>=0){this.childrenBones.splice(n,1)}if(this._armature&&!e){this._armature._updateAnimationAfterBoneListChanged(false)}};a.addSlot=function(t){if(!t){throw new Error}if(t.parent){t.parent.removeSlot(t)}this._slotList[this._slotList.length]=t;t._setParent(this);t.setArmature(this._armature)};a.removeSlot=function(t){if(!t){throw new Error}var e=this._slotList.indexOf(t);if(e<0){throw new Error}this._slotList.splice(e,1);t._setParent(null);t.setArmature(null)};a._setArmature=function(t){if(this._armature==t){return}if(this._armature){this._armature._removeBoneFromBoneList(this);this._armature._updateAnimationAfterBoneListChanged(false)}this._armature=t;if(this._armature){this._armature._addBoneToBoneList(this)}var e=this._boneList.length;while(e--){this._boneList[e]._setArmature(this._armature)}e=this._slotList.length;while(e--){this._slotList[e].setArmature(this._armature)}};a.getBones=function(t){if(t===void 0){t=true}return t?this._boneList.concat():this._boneList};a.getSlots=function(t){if(t===void 0){t=true}return t?this._slotList.concat():this._slotList};a.invalidUpdate=function(){this._needUpdate=2;this.operationInvalidUpdate(this);var t;var e;for(t=0,e=this.childrenBones.length;t<e;t++){if(this.childrenBones[t]._needUpdate!=2){this.operationInvalidUpdate(this.childrenBones[t]);this.childrenBones[t].invalidUpdate()}}};a.operationInvalidUpdate=function(t){var e=this.armature.getIKTargetData(t);var i;var n;var r;var a;var o;var s;for(i=0,n=e.length;i<n;i++){o=e[i];for(r=0,a=o.bones.length;r<a;r++){s=o.bones[r];if(s._needUpdate!=2){s.invalidUpdate()}}}};a._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._tween.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._tween.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._tween.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._tween.skewY+this._offset.skewY;
this._global.x=this._origin.x+this._tween.x+this._offset.x;this._global.y=this._origin.y+this._tween.y+this._offset.y};a._update=function(t){if(t===void 0){t=false}this._needUpdate--;if(t||this._needUpdate>0||this._parent&&this._parent._needUpdate>0){this._needUpdate=1}else{return}this.updataLocalTransform();this.updateGlobalTransform()};a.updataLocalTransform=function(){this.blendingTimeline();this._calculateRelativeParentTransform()};a.updateGlobalTransform=function(){var e=this._updateGlobal();var i;var n;if(e){i=e.parentGlobalTransform;n=e.parentGlobalTransformMatrix;e.release()}var r=this._offset.x!=0||this._offset.y!=0;var a=this._offset.scaleX!=1||this._offset.scaleY!=1;var o=this._offset.skewX!=0||this._offset.skewY!=0;if((!r||this.applyOffsetTranslationToChild)&&(!a||this.applyOffsetScaleToChild)&&(!o||this.applyOffsetRotationToChild)){this._globalTransformForChild=this._global;this._globalTransformMatrixForChild=this._globalTransformMatrix}else{if(!this._tempGlobalTransformForChild){this._tempGlobalTransformForChild=new t.DBTransform}this._globalTransformForChild=this._tempGlobalTransformForChild;if(!this._tempGlobalTransformMatrixForChild){this._tempGlobalTransformMatrixForChild=new t.Matrix}this._globalTransformMatrixForChild=this._tempGlobalTransformMatrixForChild;this._globalTransformForChild.x=this._origin.x+this._tween.x;this._globalTransformForChild.y=this._origin.y+this._tween.y;this._globalTransformForChild.scaleX=this._origin.scaleX*this._tween.scaleX;this._globalTransformForChild.scaleY=this._origin.scaleY*this._tween.scaleY;this._globalTransformForChild.skewX=this._origin.skewX+this._tween.skewX;this._globalTransformForChild.skewY=this._origin.skewY+this._tween.skewY;if(this.applyOffsetTranslationToChild){this._globalTransformForChild.x+=this._offset.x;this._globalTransformForChild.y+=this._offset.y}if(this.applyOffsetScaleToChild){this._globalTransformForChild.scaleX*=this._offset.scaleX;this._globalTransformForChild.scaleY*=this._offset.scaleY}if(this.applyOffsetRotationToChild){this._globalTransformForChild.skewX+=this._offset.skewX;this._globalTransformForChild.skewY+=this._offset.skewY}t.TransformUtil.transformToMatrix(this._globalTransformForChild,this._globalTransformMatrixForChild);if(n){this._globalTransformMatrixForChild.concat(n);t.TransformUtil.matrixToTransform(this._globalTransformMatrixForChild,this._globalTransformForChild,this._globalTransformForChild.scaleX*i.scaleX>=0,this._globalTransformForChild.scaleY*i.scaleY>=0)}}};a._updateColor=function(t,e,i,n,r,a,o,s,l){var h=this._slotList.length;for(var u=0;u<h;u++){var c=this._slotList[u];c._updateDisplayColor(t,e,i,n,r,a,o,s)}this._isColorChanged=l};a.adjustGlobalTransformMatrixByIK=function(){if(!this.parent){return}this.updataLocalTransform();this._global.rotation=this.rotationIK-this.parentBoneRotation;this.updateGlobalTransform()};a._hideSlots=function(){var t=this._slotList.length;for(var e=0;e<t;e++){var i=this._slotList[e];i._changeDisplay(-1)}};a._arriveAtFrame=function(e,n,r,a){var o=r.displayControl&&(!this.displayController||this.displayController==r.name)&&r.containsBoneMask(this.name);if(o){var s=e;var l=s.displayIndex;var h;if(e.event&&this._armature.hasEventListener(t.FrameEvent.BONE_FRAME_EVENT)){var u=new t.FrameEvent(t.FrameEvent.BONE_FRAME_EVENT);u.bone=this;u.animationState=r;u.frameLabel=e.event;this._armature._eventList.push(u)}if(e.sound&&i._soundManager.hasEventListener(t.SoundEvent.SOUND)){var c=new t.SoundEvent(t.SoundEvent.SOUND);c.armature=this._armature;c.animationState=r;c.sound=e.sound;i._soundManager.dispatchEvent(c)}if(e.action){var p=this._slotList.length;for(var f=0;f<p;f++){h=this._slotList[f];var m=h.childArmature;if(m){m.animation.gotoAndPlay(e.action)}}}}};a._updateGlobal=function(){if(!this._armature._skewEnable){return e.prototype._updateGlobal.call(this)}var i=this._calculateParentTransform();if(i!=null&&i.parentGlobalTransformMatrix&&i.parentGlobalTransform){var n=i.parentGlobalTransformMatrix;var r=i.parentGlobalTransform;var a=this._global.scaleX*r.scaleX>0;var o=this._global.scaleY*r.scaleY>0;var s=this._global.rotation;var l=this._global.scaleX;var h=this._global.scaleY;var u=this.parentBoneRotation;this._localTransform=this._global;if(this.inheritScale&&!this.inheritRotation){if(u!=0){this._localTransform=this._localTransform.clone();this._localTransform.rotation-=u}}t.TransformUtil.transformToMatrix(this._localTransform,this._globalTransformMatrix);this._globalTransformMatrix.concat(n);if(this.inheritScale){t.TransformUtil.matrixToTransform(this._globalTransformMatrix,this._global,a,o)}else{t.TransformUtil.matrixToTransformPosition(this._globalTransformMatrix,this._global);this._global.scaleX=this._localTransform.scaleX;this._global.scaleY=this._localTransform.scaleY;this._global.rotation=this._localTransform.rotation+(this.inheritRotation?u:0);t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix)}}return i};a._addState=function(t){if(this._timelineStateList.indexOf(t)<0){this._timelineStateList.push(t);this._timelineStateList.sort(this.sortState)}};a._removeState=function(t){var e=this._timelineStateList.indexOf(t);if(e>=0){this._timelineStateList.splice(e,1)}};a._removeAllStates=function(){this._timelineStateList.length=0};a.blendingTimeline=function(){var t;var e;var i;var n;var r=this._timelineStateList.length;if(r==1){t=this._timelineStateList[0];n=t._animationState.weight*t._animationState.fadeWeight;t._weight=n;e=t._transform;i=t._pivot;this._tween.x=e.x*n;this._tween.y=e.y*n;this._tween.skewX=e.skewX*n;this._tween.skewY=e.skewY*n;this._tween.scaleX=1+(e.scaleX-1)*n;this._tween.scaleY=1+(e.scaleY-1)*n;this._tweenPivot.x=i.x*n;this._tweenPivot.y=i.y*n}else if(r>1){var a=0;var o=0;var s=0;var l=0;var h=1;var u=1;var c=0;var p=0;var f=1;var m=0;var d=this._timelineStateList[r-1]._animationState.layer;var y=0;while(r--){t=this._timelineStateList[r];y=t._animationState.layer;if(d!=y){if(m>=f){t._weight=0;break}else{f-=m}}d=y;n=t._animationState.weight*t._animationState.fadeWeight*f;t._weight=n;if(n){e=t._transform;i=t._pivot;a+=e.x*n;o+=e.y*n;s+=e.skewX*n;l+=e.skewY*n;h+=(e.scaleX-1)*n;u+=(e.scaleY-1)*n;c+=i.x*n;p+=i.y*n;m+=n}}this._tween.x=a;this._tween.y=o;this._tween.skewX=s;this._tween.skewY=l;this._tween.scaleX=h;this._tween.scaleY=u;this._tweenPivot.x=c;this._tweenPivot.y=p}};a.sortState=function(t,e){return t._animationState.layer<e._animationState.layer?-1:1};n(a,"childArmature",function(){if(this.slot){return this.slot.childArmature}return null});n(a,"display",function(){if(this.slot){return this.slot.display}return null},function(t){if(this.slot){this.slot.display=t}});n(a,"node",function(){return this._offset});n(a,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;var e=this._slotList.length;for(var i=0;i<e;i++){var n=this._slotList[i];n._updateDisplayVisible(this._visible)}}});n(a,"slot",function(){return this._slotList.length>0?this._slotList[0]:null});n(a,"parentBoneRotation",function(){return this.parent?this.parent.rotationIK:0});i._soundManager=t.SoundEventManager.getInstance();return i}(t.DBObject);t.Bone=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(t,e){this.animationCacheBend=0;this.animationCacheWeight=-1;this.ikdata=t;this.armature=e;this.weight=t.weight;this.bendDirection=t.bendPositive?1:-1;this.bones=[];var i;if(t.chain){i=e.getBone(t.bones).parent;i.isIKConstraint=true;this.bones.push(i)}i=e.getBone(t.bones);i.isIKConstraint=true;this.bones.push(i);this.target=e.getBone(t.target)}var i=__define,n=e,r=n.prototype;r.dispose=function(){};r.compute=function(){switch(this.bones.length){case 1:var t=this.animationCacheWeight>=0?this.animationCacheWeight:this.weight;this.compute1(this.bones[0],this.target,t);break;case 2:var e=this.animationCacheBend!=0?this.animationCacheBend:this.bendDirection;var i=this.animationCacheWeight>=0?this.animationCacheWeight:this.weight;var n=this.compute2(this.bones[0],this.bones[1],this.target.global.x,this.target.global.y,e,i);this.bones[0].rotationIK=this.bones[0].origin.rotation+(n.x-this.bones[0].origin.rotation)*i+this.bones[0].parent.rotationIK;this.bones[1].rotationIK=this.bones[1].origin.rotation+(n.y-this.bones[1].origin.rotation)*i+this.bones[0].rotationIK;break}};r.compute1=function(t,e,i){var n=!t.inheritRotation||t.parent==null?0:t.parent.global.rotation;var r=t.global.rotation;var a=Math.atan2(e.global.y-t.global.y,e.global.x-t.global.x);t.rotationIK=r+(a-r)*i};r.compute2=function(e,i,n,r,a,o){if(o==0){return new t.Point(e.global.rotation,i.global.rotation)}var s=new t.Point;var l=new t.Point(e.global.x,e.global.y);var h=new t.Point(i.global.x,i.global.y);var u=new t.Matrix;t.TransformUtil.transformToMatrix(e.parent.global,u);u.invert();var c=t.TransformUtil.applyMatrixToPoint(new t.Point(n,r),u,true);n=c.x;r=c.y;l=t.TransformUtil.applyMatrixToPoint(l,u,true);h=t.TransformUtil.applyMatrixToPoint(h,u,true);var p=e.origin.scaleX;var f=e.origin.scaleY;var m=i.origin.scaleX;var d=h.x-l.x;var y=h.y-l.y;var v=Math.sqrt(d*d+y*y);var g;var _;var I=1;var x=0;var w=0;if(p<0){p=-p;x=Math.PI;I=-1}else{x=0;I=1}if(f<0){f=-f;I=-I}if(m<0){m=-m;w=Math.PI}else{w=0}a=I*a;t:if(Math.abs(p-f)<=.001){var S=i.length;var b=S*m;n=n-l.x;r=r-l.y;var C=2*v*b;var T=(n*n+r*r-v*v-b*b)/C;if(T<-1)T=-1;else if(T>1)T=1;_=Math.acos(T)*a;var D=v+b*T;var U=b*Math.sin(_);g=Math.atan2(r*D-n*U,n*D+r*U)}else{var A=v;var E=n-l.x;var M=r-l.y;var P=i.length*i.origin.scaleX;var B=p*P;var L=f*P;var R=Math.atan2(M,E);var O=B*B;var V=L*L;var F=A*A;var k=E*E+M*M;var N=V*F+O*k-O*V;var G=-2*V*A;var W=V-O;var H=G*G-4*W*N;if(H>=0){var X=Math.sqrt(H);if(G<0){X=-X}X=-(G+X)/2;var J=X/W;var Y=N/X;var z=Math.abs(J)<Math.abs(Y)?J:Y;if(z*z<=k){var j=Math.sqrt(k-z*z)*a;g=R-Math.atan2(j,z);_=Math.atan2(j/f,(z-A)/p);break t}}var K=0;var q=Number.MAX_VALUE;var Z=0;var Q=0;var $=0;var tt=0;var et=0;var it=0;var nt=A+B;var rt=nt*nt;if(rt>tt){$=0;tt=rt;et=nt}nt=A-B;rt=nt*nt;if(rt<q){K=Math.PI;q=rt;Z=nt}var at=Math.acos(-B*A/(O-V));nt=B*Math.cos(at)+A;var ot=L*Math.sin(at);rt=nt*nt+ot*ot;if(rt<q){K=at;q=rt;Z=nt;Q=ot}if(rt>tt){$=at;tt=rt;et=nt;it=ot}if(k<=(q+tt)/2){g=R-Math.atan2(Q*a,Z);_=K*a}else{g=R-Math.atan2(it*a,et);_=$*a}}var st=i.origin.x;var lt=i.origin.y*f;var ht=Math.atan2(lt,st)*I;s.x=g-ht+x;s.y=(_+ht)*I+w;this.normalize(s.x);this.normalize(s.y);return s};r.normalize=function(t){if(t>Math.PI){t-=Math.PI*2}else if(t<-Math.PI){t+=Math.PI*2}};return e}();t.IKConstraint=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.isMeshEnabled=false;this._currentDisplayIndex=0;this._ffdChanged=false;this._ffdVertices=null;this._meshBones=null;this._meshData=null;this._ffdOffset=0;this._displayList=[];this._currentDisplayIndex=-1;this._originZOrder=0;this._tweenZOrder=0;this._offsetZOrder=0;this._isShowDisplay=false;this._colorTransform=new t.ColorTransform;this._displayDataList=null;this._currentDisplay=null;this.inheritRotation=true;this.inheritScale=true}var n=__define,r=i,a=r.prototype;n(a,"displayIndex",function(){return this._currentDisplayIndex});a.initWithSlotData=function(t){this.name=t.name;this.blendMode=t.blendMode;this._defaultGotoAndPlay=t.gotoAndPlay;this._originZOrder=t.zOrder;this._displayDataList=t.displayDataList;this._originDisplayIndex=t.displayIndex};a.dispose=function(){if(!this._displayList){return}e.prototype.dispose.call(this);this._displayList.length=0;this._displayDataList=null;this._displayList=null;this._currentDisplay=null};a.setArmature=function(t){if(this._armature==t){return}if(this._armature){this._armature._removeSlotFromSlotList(this)}this._armature=t;if(this._armature){this._armature._addSlotToSlotList(this);this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}else{this._removeDisplayFromContainer()}};a._update=function(){if(this._parent._needUpdate>0||this._needUpdate||this._ffdChanged||this.isMeshUpdate()){var t=this._updateGlobal();if(t){t.release()}this._updateTransform();if(this._meshData){this._updateMesh()}this._needUpdate=false}};a.isMeshUpdate=function(){if(this._meshData&&this._meshBones.length){for(var t=0,e=this._meshBones.length;t<e;++t){var i=this._meshBones[t];if(i._needUpdate>0){return true}}}return false};a._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._offset.skewY;this._global.x=this._origin.x+this._offset.x+this._parent._tweenPivot.x;this._global.y=this._origin.y+this._offset.y+this._parent._tweenPivot.y};a.updateChildArmatureAnimation=function(){if(this.childArmature){if(this._isShowDisplay){var t=this._gotoAndPlay;if(t==null){t=this._defaultGotoAndPlay;if(t==null){this.childArmature.armatureData.defaultAnimation}}if(t==null){if(this._armature&&this._armature.animation.lastAnimationState){t=this._armature.animation.lastAnimationState.name}}if(t&&this.childArmature.animation.hasAnimation(t)){this.childArmature.animation.gotoAndPlay(t)}else{this.childArmature.animation.play()}}else{this.childArmature.animation.stop();this.childArmature.animation._lastAnimationState=null}}};a._changeDisplay=function(e){if(e===void 0){e=0}if(e<0){if(this._isShowDisplay){this._isShowDisplay=false;this._removeDisplayFromContainer();this.updateChildArmatureAnimation();this._armature.animation._updateFFDTimelineStates=true}}else if(this._displayList.length>0){var i=this._displayList.length;if(e>=i){e=i-1}if(this._currentDisplayIndex!=e){this._isShowDisplay=true;this._currentDisplayIndex=e;this._updateSlotDisplay();this.updateChildArmatureAnimation();if(this._displayDataList&&this._displayDataList.length>0&&this._currentDisplayIndex<this._displayDataList.length){this._origin.copy(this._displayDataList[this._currentDisplayIndex].transform)}this._needUpdate=true;this._armature.animation._updateFFDTimelineStates=true}else if(!this._isShowDisplay){this._isShowDisplay=true;if(this._armature){this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}this.updateChildArmatureAnimation();this._armature.animation._updateFFDTimelineStates=true}}if(this._currentDisplayIndex>=0&&this._armature.animation._updateFFDTimelineStates){var n=this._displayDataList[this._currentDisplayIndex];if(n.type==t.DisplayData.MESH){this._meshData=n}else{this._meshData=null}if(this._meshData){if(this._meshBones){this._meshBones.length=this._meshData.bones.length}else{this._meshBones=[]}for(var r=0,a=this._meshData.bones.length;r<a;++r){var o=this._meshData.bones[r];this._meshBones[r]=this._armature.getBone(o.name)}}else{if(this._ffdVertices){this._ffdVertices.length=0}if(this._meshBones){this._meshBones.length=0}}}};a._updateSlotDisplay=function(){var e=-1;if(this._currentDisplay){e=this._getDisplayIndex();this._removeDisplayFromContainer()}var i=this._displayList[this._currentDisplayIndex];if(i){if(i instanceof t.Armature){this._currentDisplay=i.display}else{this._currentDisplay=i}}else{this._currentDisplay=null}this._updateDisplay(this._currentDisplay);if(this._currentDisplay){if(this._armature&&this._isShowDisplay){if(e<0){this._armature._slotsZOrderChanged=true;this._addDisplayToContainer(this._armature.display)}else{this._addDisplayToContainer(this._armature.display,e)}}this._updateDisplayBlendMode(this._blendMode);this._updateDisplayColor(this._colorTransform.alphaOffset,this._colorTransform.redOffset,this._colorTransform.greenOffset,this._colorTransform.blueOffset,this._colorTransform.alphaMultiplier,this._colorTransform.redMultiplier,this._colorTransform.greenMultiplier,this._colorTransform.blueMultiplier,true);this._updateDisplayVisible(this._visible);this._updateTransform()}};n(a,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;this._updateDisplayVisible(this._visible)}});n(a,"displayList",function(){return this._displayList},function(t){if(!t){throw new Error}if(this._currentDisplayIndex<0){this._currentDisplayIndex=0}var e=this._displayList.length=t.length;while(e--){this._displayList[e]=t[e]}var i=this._currentDisplayIndex;this._currentDisplayIndex=-1;this._changeDisplay(i)});n(a,"display",function(){return this._currentDisplay},function(t){if(this._currentDisplayIndex<0){this._currentDisplayIndex=0}if(this._displayList[this._currentDisplayIndex]==t){return}this._displayList[this._currentDisplayIndex]=t;this._updateSlotDisplay();this.updateChildArmatureAnimation();this._updateTransform()});a.getDisplay=function(){return this.display};a.setDisplay=function(t){this.display=t};n(a,"childArmature",function(){if(this._displayList[this._currentDisplayIndex]instanceof t.Armature){return this._displayList[this._currentDisplayIndex]}return null},function(t){this.display=t});n(a,"zOrder",function(){return this._originZOrder+this._tweenZOrder+this._offsetZOrder},function(t){if(this.zOrder!=t){this._offsetZOrder=t-this._originZOrder-this._tweenZOrder;if(this._armature){this._armature._slotsZOrderChanged=true}}});n(a,"blendMode",function(){return this._blendMode},function(t){if(this._blendMode!=t){this._blendMode=t;this._updateDisplayBlendMode(this._blendMode)}});n(a,"gotoAndPlay",undefined,function(t){if(this._gotoAndPlay!=t){this._gotoAndPlay=t;this.updateChildArmatureAnimation()}});a._updateDisplay=function(t){throw new Error("")};a._getDisplayIndex=function(){throw new Error(egret.getString(4001))};a._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}throw new Error(egret.getString(4001))};a._removeDisplayFromContainer=function(){throw new Error(egret.getString(4001))};a._updateTransform=function(){throw new Error(egret.getString(4001))};a._updateDisplayVisible=function(t){throw new Error(egret.getString(4001))};a._updateFFD=function(t,e){this._ffdChanged=true;this._ffdVertices=t;this._ffdOffset=e};a._updateDisplayColor=function(t,e,i,n,r,a,o,s,l){if(l===void 0){l=false}this._colorTransform.alphaOffset=t;this._colorTransform.redOffset=e;this._colorTransform.greenOffset=i;this._colorTransform.blueOffset=n;this._colorTransform.alphaMultiplier=r;this._colorTransform.redMultiplier=a;this._colorTransform.greenMultiplier=o;this._colorTransform.blueMultiplier=s;this._isColorChanged=l};a._updateDisplayBlendMode=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};a._arriveAtFrame=function(t,e,i,n){var r=i.displayControl&&i.containsBoneMask(this.parent.name);if(r){var a=t;var o=a.displayIndex;var s;this._changeDisplay(o);this._updateDisplayVisible(a.visible);if(o>=0){if(!isNaN(a.zOrder)&&a.zOrder!=this._tweenZOrder){this._tweenZOrder=a.zOrder;this._armature._slotsZOrderChanged=true}}if(t.action){if(this.childArmature){this.childArmature.animation.gotoAndPlay(t.action)}}else{this.gotoAndPlay=a.gotoAndPlay}}};a._updateGlobal=function(){this._calculateRelativeParentTransform();t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix);var e=this._calculateParentTransform();if(e){this._globalTransformMatrix.concat(e.parentGlobalTransformMatrix);t.TransformUtil.matrixToTransform(this._globalTransformMatrix,this._global,this._global.scaleX*e.parentGlobalTransform.scaleX>=0,this._global.scaleY*e.parentGlobalTransform.scaleY>=0)}return e};a._resetToOrigin=function(){this._changeDisplay(this._originDisplayIndex);this._updateDisplayColor(0,0,0,0,1,1,1,1,true)};a._updateMesh=function(){};return i}(t.DBObject);t.Slot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.slotTimelineCacheList=[];this.slotTimelineCacheDic={};this.frameNum=0;this._cahceList=[]}var i=__define,n=e,r=n.prototype;e.initWithAnimationData=function(i,n){var r=new e;r.name=i.name;var a;var o;var s;var l;var h;for(var u=0,c=n.boneDataList.length;u<c;u++){a=n.boneDataList[u].name;for(var p=0,f=n.slotDataList.length;p<f;p++){s=n.slotDataList[p];h=s.name;if(s.parent==a){if(r.slotTimelineCacheDic[h]==null){l=new t.SlotTimelineCache;l.name=h;r.slotTimelineCacheList.push(l);r.slotTimelineCacheDic[h]=l}}}}return r};r.initSlotTimelineCacheDic=function(t,e){var i;for(var n in this.slotTimelineCacheDic){var r=this.slotTimelineCacheDic[n];i=r.name;r.cacheGenerator=t[i];r.currentFrameCache=e[i]}};r.bindCacheUserSlotDic=function(t){for(var e in t){this.slotTimelineCacheDic[e].bindCacheUser(t[e])}};r.addFrame=function(t,e){var i;for(var n=0,r=this.slotTimelineCacheList.length;n<r;n++){i=this.slotTimelineCacheList[n];i.addFrame(t,e)}this._cahceList[t]=true};r.update=function(t){var e=Math.floor(t*(this.frameNum-1));var i;for(var n=0,r=this.slotTimelineCacheList.length;n<r;n++){i=this.slotTimelineCacheList[n];i.update(e)}};return e}();t.AnimationCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.animationCacheDic={};this.slotFrameCacheDic={}}var i=__define,n=e,r=n.prototype;e.initWithArmatureData=function(t,i){if(i===void 0){i=0}var n=new e;n.armatureData=t;if(i<=0){var r=t.animationDataList[0];if(r){n.frameRate=r.frameRate}}else{n.frameRate=i}return n};r.initAllAnimationCache=function(){var e=this.armatureData.animationDataList.length;for(var i=0;i<e;i++){var n=this.armatureData.animationDataList[i];this.animationCacheDic[n.name]=t.AnimationCache.initWithAnimationData(n,this.armatureData)}};r.initAnimationCache=function(e){this.animationCacheDic[e]=t.AnimationCache.initWithAnimationData(this.armatureData.getAnimationData(e),this.armatureData)};r.bindCacheUserArmatures=function(t){var e=t.length;for(var i=0;i<e;i++){var n=t[i];this.bindCacheUserArmature(n)}};r.bindCacheUserArmature=function(t){t.animation.animationCacheManager=this;var e};r.setCacheGeneratorArmature=function(e){this.cacheGeneratorArmature=e;var i;for(var n in e._slotDic){i=e._slotDic[n];this.slotFrameCacheDic[i.name]=new t.SlotFrameCache}for(var r in this.animationCacheDic){var a=this.animationCacheDic[r];a.initSlotTimelineCacheDic(e._slotDic,this.slotFrameCacheDic)}};r.generateAllAnimationCache=function(t){for(var e in this.animationCacheDic){var i=this.animationCacheDic[e];this.generateAnimationCache(i.name,t)}};r.generateAnimationCache=function(t,e){var i=this.cacheGeneratorArmature.enableCache;this.cacheGeneratorArmature.enableCache=false;var n=this.animationCacheDic[t];if(!n){return}var r=this.cacheGeneratorArmature.getAnimation().animationState;var a=1/this.frameRate;if(e){this.cacheGeneratorArmature.getAnimation().gotoAndPlay(t,0,-1,0)}else{this.cacheGeneratorArmature.getAnimation().gotoAndPlay(t,0,-1,1)}var o=this.cacheGeneratorArmature.enableEventDispatch;this.cacheGeneratorArmature.enableEventDispatch=false;var s;do{s=r.progress;this.cacheGeneratorArmature.advanceTime(a)}while(r.progress>=s&&r.progress<1);this.cacheGeneratorArmature.enableEventDispatch=o;this.resetCacheGeneratorArmature();this.cacheGeneratorArmature.enableCache=i};r.resetCacheGeneratorArmature=function(){this.cacheGeneratorArmature.resetAnimation()};r.getAnimationCache=function(t){return this.animationCacheDic[t]};return e}();t.AnimationCacheManager=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.globalTransform=new t.DBTransform;this.globalTransformMatrix=new t.Matrix}var i=__define,n=e,r=n.prototype;r.copy=function(t){this.globalTransform=t.globalTransform;this.globalTransformMatrix=t.globalTransformMatrix};r.clear=function(){this.globalTransform=e.ORIGIN_TRAMSFORM;this.globalTransformMatrix=e.ORIGIN_MATRIX};e.ORIGIN_TRAMSFORM=new t.DBTransform;e.ORIGIN_MATRIX=new t.Matrix;return e}();t.FrameCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.displayIndex=-1}var i=__define,n=e,r=n.prototype;r.copy=function(e){t.prototype.copy.call(this,e);this.colorTransform=e.colorTransform;this.displayIndex=e.displayIndex;this.gotoAndPlay=e.gotoAndPlay};r.clear=function(){t.prototype.clear.call(this);this.colorTransform=null;this.displayIndex=-1;this.gotoAndPlay=null};return e}(t.FrameCache);t.SlotFrameCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.frameCacheList=new Array}var e=__define,i=t,n=i.prototype;n.addFrame=function(t,e){};n.update=function(t){if(t===void 0){t=0}this.currentFrameCache.copy(this.frameCacheList[t])};n.bindCacheUser=function(t){t.frameCache=this.currentFrameCache};return t}();t.TimelineCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this)}var n=__define,r=i,a=r.prototype;a.addFrame=function(e,i){var n=new t.SlotFrameCache;var r=i.getSlot(this.name);if(r.global!=r._globalBackup){n.globalTransform=r.global;n.globalTransformMatrix=r.globalTransformMatrix}else{n.globalTransform.copy(r.global);n.globalTransformMatrix.copyFrom(r.globalTransformMatrix)}if(r.colorChanged){n.colorTransform=t.ColorTransformUtil.cloneColor(r.colorTransform)}n.displayIndex=r.displayIndex;n.gotoAndPlay=r.gotoAndPlay;this.frameCacheList[e]=n};return i}(t.TimelineCache);t.SlotTimelineCache=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){function e(t,e,i){if(e===void 0){e=false}if(i===void 0){i=false}this.bubbles=e;this.cancelable=i;this.type=t}var i=__define,n=e;p=n.prototype;return e}();t.Event=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e,r=n.prototype;i(e,"MOVEMENT_CHANGE",function(){return e.FADE_IN});i(r,"movementID",function(){return this.animationName});i(r,"armature",function(){return this.target});i(r,"animationName",function(){return this.animationState.name});e.FADE_IN="fadeIn";e.FADE_OUT="fadeOut";e.START="start";e.COMPLETE="complete";e.LOOP_COMPLETE="loopComplete";e.FADE_IN_COMPLETE="fadeInComplete";e.FADE_OUT_COMPLETE="fadeOutComplete";return e}(t.Event);t.AnimationEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e){t.call(this,e)}var i=__define,n=e,r=n.prototype;e.Z_ORDER_UPDATED="zOrderUpdated";return e}(t.Event);t.ArmatureEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e,r=n.prototype;i(e,"MOVEMENT_FRAME_EVENT",function(){return e.ANIMATION_FRAME_EVENT});i(r,"armature",function(){return this.target});e.ANIMATION_FRAME_EVENT="animationFrameEvent";e.BONE_FRAME_EVENT="boneFrameEvent";return e}(t.Event);t.FrameEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(e,i){if(i===void 0){i=false}t.call(this,e)}var i=__define,n=e,r=n.prototype;e.SOUND="sound";return e}(t.Event);t.SoundEvent=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(n,e);function n(){e.call(this);this.dragonBonesDataDic={};this.textureAtlasDic={}}var r=__define,a=n,o=a.prototype;o.dispose=function(t){if(t===void 0){t=true}if(t){for(var e in this.dragonBonesDataDic){this.dragonBonesDataDic[e].dispose();delete this.dragonBonesDataDic[e]}for(var i in this.textureAtlasDic){var n=this.textureAtlasDic[i];if(n){for(var r=0,a=n.length;r<a;r++){n[r].dispose()}}delete this.textureAtlasDic[i]}}this.dragonBonesDataDic=null;this.textureAtlasDic=null};o.getDragonBonesData=function(t){return this.dragonBonesDataDic[t]};o.getSkeletonData=function(t){return this.getDragonBonesData(t)};o.addDragonBonesData=function(t,e){if(e===void 0){e=null}if(!t){throw new Error}e=e||t.name;if(!e){throw new Error(egret.getString(4002))}this.dragonBonesDataDic[e]=t};o.addSkeletonData=function(t,e){if(e===void 0){e=null}this.addDragonBonesData(t,e)};o.removeDragonBonesData=function(t){delete this.dragonBonesDataDic[t]};o.removeSkeletonData=function(t){delete this.dragonBonesDataDic[t]};o.getTextureAtlas=function(t){return this.textureAtlasDic[t]};o.addTextureAtlas=function(t,e){if(e===void 0){e=null}if(!t){throw new Error}if(!e&&t.hasOwnProperty("name")){e=t.name}if(!e){throw new Error(egret.getString(4002))}var i=this.textureAtlasDic[e];if(i==null){i=[];this.textureAtlasDic[e]=i}if(i.indexOf(t)!=-1){return}i.push(t)};o.removeTextureAtlas=function(t){delete this.textureAtlasDic[t]};o.getTextureDisplay=function(t,e,i,n){if(e===void 0){e=null}if(i===void 0){i=NaN}if(n===void 0){n=NaN}var r;var a;var o;var s;if(e){a=this.textureAtlasDic[e];if(a){for(o=0,s=a.length;o<s;o++){r=a[o];if(r.getRegion(t)){break}r=null}}}else{for(e in this.textureAtlasDic){a=this.textureAtlasDic[e];if(a){for(o=0,s=a.length;o<s;o++){r=a[o];if(r.getRegion(t)){break}r=null}if(r!=null){break}}}}if(!r){return null}if(isNaN(i)||isNaN(n)){var l=this.dragonBonesDataDic[e];l=l?l:this.findFirstDragonBonesData();if(l){var h=l.getDisplayDataByName(t);if(h){i=h.pivot.x;n=h.pivot.y}}}return this._generateDisplay(r,t,i,n)};o.getMeshDisplay=function(t,e,i){if(i===void 0){i=null}var n;var r;var a;var o;var s=t.name;if(i){r=this.textureAtlasDic[i];if(r){for(a=0,o=r.length;a<o;a++){n=r[a];if(n.getRegion(s)){break}n=null}}}else{for(i in this.textureAtlasDic){r=this.textureAtlasDic[i];if(r){for(a=0,o=r.length;a<o;a++){n=r[a];if(n.getRegion(s)){break}n=null}if(n!=null){break}}}}if(!n){return null}return this._generateMesh(n,s,t,e)};o.buildArmature=function(t,e,i,n){if(e===void 0){e=null}if(i===void 0){i=null}if(n===void 0){n=null}var r={};this.fillBuildArmatureDataPackageArmatureInfo(t,e,r);if(i==null){i=r.dragonBonesDataName}var a=r.dragonBonesData;var o=r.armatureData;if(!o){return null}return this.buildArmatureUsingArmatureDataFromTextureAtlas(a,o,i,n)};o.buildFastArmature=function(t,e,n,r){if(e===void 0){e=null}if(n===void 0){n=null}if(r===void 0){r=null}var a=new i;this.fillBuildArmatureDataPackageArmatureInfo(t,e,a);if(n==null){n=a.dragonBonesDataName}var o=a.dragonBonesData;var s=a.armatureData;if(!s){return null}return this.buildFastArmatureUsingArmatureDataFromTextureAtlas(o,s,n,r)};o.buildArmatureUsingArmatureDataFromTextureAtlas=function(t,e,i,n){if(n===void 0){n=null}var r=this._generateArmature();r.name=e.name;r.__dragonBonesData=t;r._armatureData=e;r._skewEnable=t.version>=4.5;r.animation.animationDataList=e.animationDataList;this._buildBones(r);r.buildIK();r.updateBoneCache();this._buildSlots(r,n,i);r.advanceTime(0);return r};o.buildFastArmatureUsingArmatureDataFromTextureAtlas=function(t,e,i,n){if(n===void 0){n=null}var r=this._generateFastArmature();r.name=e.name;r.__dragonBonesData=t;r._armatureData=e;r._skewEnable=t.version>=4.5;r.animation.animationDataList=e.animationDataList;this._buildFastBones(r);r.buildIK();r.updateBoneCache();this._buildFastSlots(r,n,i);r.updateSlotsZOrder();r.advanceTime(0);return r};o.copyAnimationsToArmature=function(e,i,n,r){if(n===void 0){n=null}if(r===void 0){r=true}var a={};if(!this.fillBuildArmatureDataPackageArmatureInfo(i,n,a)){return false}var o=a.armatureData;e.animation.animationDataList=o.animationDataList;var s=o.getSkinData("");var l;var h;var u=e.getSlots(false);var c;var p;var f=0;var m;var d;var y=u.length;for(var v=0;v<y;v++){c=u[v];p=c.displayList;f=p.length;for(var g=0;g<f;g++){m=p[g];if(m instanceof t.Armature){d=m;l=s.getSlotData(c.name);h=l.displayDataList[g];if(h.type==t.DisplayData.ARMATURE){this.copyAnimationsToArmature(d,h.name,a.dragonBonesDataName,r)}}}}return true};o.fillBuildArmatureDataPackageArmatureInfo=function(t,e,i){if(e){i.dragonBonesDataName=e;i.dragonBonesData=this.dragonBonesDataDic[e];i.armatureData=i.dragonBonesData.getArmatureDataByName(t);return true}else{for(e in this.dragonBonesDataDic){i.dragonBonesData=this.dragonBonesDataDic[e];i.armatureData=i.dragonBonesData.getArmatureDataByName(t);if(i.armatureData){i.dragonBonesDataName=e;return true}}}return false};o.fillBuildArmatureDataPackageTextureInfo=function(t,e){e.textureAtlas=this.textureAtlasDic[t?t:e.dragonBonesDataName]};o.findFirstDragonBonesData=function(){
for(var t in this.dragonBonesDataDic){var e=this.dragonBonesDataDic[t];if(e){return e}}return null};o.findFirstTextureAtlas=function(){for(var t in this.textureAtlasDic){var e=this.textureAtlasDic[t];if(e){return e}}return null};o._buildBones=function(e){var i=e.armatureData.boneDataList;var n;var r;var a;for(var o=0;o<i.length;o++){n=i[o];r=t.Bone.initWithBoneData(n);a=n.parent;if(a&&e.armatureData.getBoneData(a)==null){a=null}e.addBone(r,a,true)}e._updateAnimationAfterBoneListChanged()};o._buildSlots=function(e,i,n){var r=e.armatureData.getSkinData(i);if(!r){return}e.armatureData.setSkinData(i);var a=[];var o=e.armatureData.slotDataList;var s;var l;var h;for(var u=0;u<o.length;u++){s=o[u];h=e.getBone(s.parent);if(!h){continue}l=this._generateSlot();l.initWithSlotData(s);h.addSlot(l);a.length=0;var c=s.displayDataList.length;while(c--){var p=s.displayDataList[c];switch(p.type){case t.DisplayData.ARMATURE:var f=this.buildArmatureUsingArmatureDataFromTextureAtlas(e.__dragonBonesData,e.__dragonBonesData.getArmatureDataByName(p.name),n,i);a[c]=f;break;case t.DisplayData.MESH:a[c]=this.getMeshDisplay(p,l,n);break;case t.DisplayData.IMAGE:default:a[c]=this.getTextureDisplay(p.name,n,p.pivot.x,p.pivot.y);break}}for(var m=0,d=a.length;m<d;m++){var y=a[m];if(!y){continue}if(y instanceof t.Armature){y=y.display}if(y.hasOwnProperty("name")){try{y["name"]=l.name}catch(v){}}}l.displayList=a;l._changeDisplay(s.displayIndex)}};o._buildFastBones=function(e){var i=e.armatureData.boneDataList;var n;var r;for(var a=0;a<i.length;a++){n=i[a];r=t.FastBone.initWithBoneData(n);e.addBone(r,n.parent)}};o._buildFastSlots=function(e,i,n){var r=e.armatureData.getSkinData(i);if(!r){return}e.armatureData.setSkinData(i);var a=e.armatureData.slotDataList;var o=[];var s=[];var l;var h;for(var u=0;u<a.length;u++){o.length=0;s.length=0;l=a[u];h=this._generateFastSlot();h.initWithSlotData(l);var c=l.displayDataList.length;while(c--){var p=l.displayDataList[c];switch(p.type){case t.DisplayData.ARMATURE:var f=this.buildFastArmatureUsingArmatureDataFromTextureAtlas(e.__dragonBonesData,e.__dragonBonesData.getArmatureDataByName(p.name),n,i);o[c]=[p,null];s[c]=f;h.hasChildArmature=true;break;case t.DisplayData.IMAGE:case t.DisplayData.MESH:o[c]=[p,this.getTextureData(p.name,n)];s[c]=h._rawDisplay;break;default:o[c]=[p,null];s[c]=null;break}}var m=s.length;for(var d=0;d<m;d++){var y=s[d];if(!y){continue}if(y instanceof t.FastArmature){y=y.display}if(y.hasOwnProperty("name")){try{y["name"]=h.name}catch(v){}}}e.addSlot(h,l.parent);h.displayDataList=o;h.displayList=s;h.displayIndex=l.displayIndex}};o.getTextureData=function(t,e){var i=null;var n=null;var r=this.textureAtlasDic[e];if(r){for(var a in r){n=r[a];i=n.getTextureData(t);if(i){i.textureAtlas=n;break}}}return i};o._generateArmature=function(){return null};o._generateSlot=function(){return null};o._generateFastArmature=function(){return null};o._generateFastSlot=function(){return null};o._generateDisplay=function(t,e,i,n){return null};o._generateMesh=function(t,e,i,n){return null};n._helpMatrix=new t.Matrix;return n}(t.EventDispatcher);t.BaseFactory=e;var i=function(){function t(){}var e=__define,i=t,n=i.prototype;return t}();t.BuildArmatureDataPackage=i})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this.isCacheManagerExclusive=false;this._cacheFrameIndex=-1;this._boneIKList=[];this._enableEventDispatch=true;this._useCache=true;this._isFrameCached=false;this._display=i;this._animation=new t.FastAnimation(this);this._slotsZOrderChanged=false;this._armatureData=null;this.boneList=[];this._boneDic={};this.slotList=[];this._slotDic={};this.slotHasChildArmatureList=[];this._eventList=[];this._ikList=[];this._delayDispose=false;this._lockDispose=false}var n=__define,r=i,a=r.prototype;a.dispose=function(){this._delayDispose=true;if(!this._animation||this._lockDispose){return}this.userData=null;this._animation.dispose();var t=this.slotList.length;while(t--){this.slotList[t].dispose()}t=this.boneList.length;while(t--){this.boneList[t].dispose()}t=this._ikList.length;while(t--){this._ikList[t].dispose()}this.slotList.length=0;this.boneList.length=0;this._armatureData=null;this._animation=null;this.slotList=null;this.boneList=null;this._eventList=null;this._ikList=null};a.advanceTime=function(t){this._lockDispose=true;this._isFrameCached=false;this._animation.advanceTime(t);var e;var i;var n=0;var r=this._boneIKList.length;var a;var o;if(this._isFrameCached){if(!this._useCache){this._useCache=true}n=this.slotList.length;while(n--){i=this.slotList[n];i.updateByCache(this._cacheFrameIndex)}}else{if(this._useCache){this._useCache=false}for(n=0;n<r;n++){for(a=0,o=this._boneIKList[n].length;a<o;a++){e=this._boneIKList[n][a];if(e.isIKConstraint){var s=this._ikList[n-1];if(s.bones[0].name==e.name){e.update();e.rotationIK=e.global.rotation;if(s.bones.length>1){s.bones[1].update();s.bones[1].rotationIK=s.bones[1].global.rotation}s.compute()}e.adjustGlobalTransformMatrixByIK()}else{e.update();e.rotationIK=e.global.rotation}}}n=this.slotList.length;while(n--){i=this.slotList[n];i._update()}}n=this.slotHasChildArmatureList.length;while(n--){i=this.slotHasChildArmatureList[n];var l=i.childArmature;if(l){l.advanceTime(t)}}if(this._slotsZOrderChanged){this.updateSlotsZOrder()}if(!this._isFrameCached){var h=this._animation.animationState.animationCache;if(h){h.addFrame(this._cacheFrameIndex,this)}}while(this._eventList.length>0){this.dispatchEvent(this._eventList.shift())}this._lockDispose=false;if(this._delayDispose){this.dispose()}};a.enableAnimationCache=function(e,i,n){if(i===void 0){i=null}if(n===void 0){n=true}var r=this._armatureData._cacheManager;if(r){this.enableCache=true;return r}this._armatureData._cacheManager=r=t.AnimationCacheManager.initWithArmatureData(this.armatureData,e);r.initAllAnimationCache();this.enableCache=true;return r};a.getBone=function(t){return this._boneDic[t]};a.getSlot=function(t){return this._slotDic[t]};a.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null};a.getSlotByDisplay=function(t){if(t){for(var e=0,i=this.slotList.length;e<i;e++){if(this.slotList[e].display==t){return this.slotList[e]}}}return null};a.getSlots=function(t){if(t===void 0){t=true}return t?this.slotList.concat():this.slotList};a._updateBonesByCache=function(){var t=this.boneList.length;var e;while(t--){e=this.boneList[t];e.update()}};a.addBone=function(t,e){if(e===void 0){e=null}var i;if(e){i=this.getBone(e);i.boneList.push(t)}t.armature=this;t.parentBoneData=i;this.boneList.unshift(t);this._boneDic[t.name]=t};a.addSlot=function(t,e){var i=this.getBone(e);if(i){t.armature=this;t.setParent(i);i.slotList.push(t);t._addDisplayToContainer(this.display);this.slotList.push(t);this._slotDic[t.name]=t;if(t.hasChildArmature){this.slotHasChildArmatureList.push(t)}}else{throw new Error}};a.updateSlotsZOrder=function(){this.slotList.sort(this.sortSlot);var t=this.slotList.length;while(t--){var e=this.slotList[t];e._addDisplayToContainer(this._display)}this._slotsZOrderChanged=false};a.sortBoneList=function(){var e=this.boneList.length;if(e==0){return}var i=[];while(e--){var n=0;var r=this.boneList[e];var a=r;while(a){n++;a=a.parent}i[e]=[n,r]}i.sort(t.ArmatureData.sortBoneDataHelpArrayDescending);e=i.length;while(e--){this.boneList[e]=i[e][1]}i.length=0};a.arriveAtFrame=function(e,i){if(e.event&&this.hasEventListener(t.FrameEvent.ANIMATION_FRAME_EVENT)){var n=new t.FrameEvent(t.FrameEvent.ANIMATION_FRAME_EVENT);n.animationState=i;n.frameLabel=e.event;n.bone=e.bone?this.getBone(e.bone):null;this._addEvent(n)}if(e.action){this.animation.gotoAndPlay(e.action)}};a.invalidUpdate=function(t){if(t===void 0){t=null}if(t){var e=this.getBone(t);if(e){e.invalidUpdate()}}else{var i=this.boneList.length;while(i--){this.boneList[i].invalidUpdate()}}};a.resetAnimation=function(){this.animation.animationState._resetTimelineStateList();var t=this.boneList.length;for(var e=0;e<t;e++){var i=this.boneList[e];i._timelineState=null}this.animation.stop()};a.sortSlot=function(t,e){return t.zOrder<e.zOrder?1:-1};a.getAnimation=function(){return this._animation};n(a,"armatureData",function(){return this._armatureData});n(a,"animation",function(){return this._animation});n(a,"display",function(){return this._display});n(a,"enableCache",function(){return this._enableCache},function(t){this._enableCache=t});n(a,"enableEventDispatch",function(){return this._enableEventDispatch},function(t){this._enableEventDispatch=t});a._addEvent=function(t){if(this._enableEventDispatch){this._eventList.push(t)}};a.getIKs=function(t){if(t===void 0){t=true}return t?this._ikList.concat():this._ikList};a.buildIK=function(){var e;this._ikList.length=0;for(var i=0,n=this._armatureData.ikDataList.length;i<n;i++){e=this._armatureData.ikDataList[i];this._ikList.push(new t.FastIKConstraint(e,this))}};a.updateBoneCache=function(){this.boneList.reverse();var t={};var e=this._ikList.length;var i=e+1;var n;var r;var a;var o;var s;var l;this._boneIKList=[];while(this._boneIKList.length<i){this._boneIKList[this._boneIKList.length]=[]}t[this.boneList[0].name]=0;for(n=0,r=this._ikList.length;n<r;n++){t[this._ikList[n].bones[0].name]=n+1}t:for(n=0,r=this.boneList.length;n<r;n++){s=this.boneList[n];l=s;while(l){if(l.parent==null){t[l.name]=0}if(t.hasOwnProperty(l.name)){this._boneIKList[t[l.name]].push(s);continue t}l=l.parent}}};a.getIKTargetData=function(t){var e=[];var i;for(var n=0,r=this._ikList.length;n<r;n++){i=this._ikList[n];if(t.name==i.target.name){e.push(i)}}return e};return i}(t.EventDispatcher);t.FastArmature=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._globalTransformMatrixBackup=this._globalTransformMatrix=new t.Matrix;this._globalBackup=this._global=new t.DBTransform;this._origin=new t.DBTransform;this._visible=true;this.armature=null;this._parent=null;this.userData=null;this.inheritRotation=true;this.inheritScale=true;this.inheritTranslation=true}var i=__define,n=e,r=n.prototype;r.updateByCache=function(t){this._global=this._frameCache.globalTransform;this._globalTransformMatrix=this._frameCache.globalTransformMatrix};r.switchTransformToBackup=function(){};r.setParent=function(t){this._parent=t};r.dispose=function(){this.userData=null;this._globalTransformMatrix=null;this._global=null;this._origin=null;this.armature=null;this._parent=null};r._calculateParentTransform=function(){if(this.parent&&(this.inheritTranslation||this.inheritRotation||this.inheritScale)){var e=this._parent._global;var i=this._parent._globalTransformMatrix;return t.ParentTransformObject.create().setTo(e,i)}t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix);return null};r._updateGlobal=function(){this._calculateRelativeParentTransform();var e=this._calculateParentTransform();if(e!=null){var i=e.parentGlobalTransformMatrix;var n=e.parentGlobalTransform;var r=this._global.x;var a=this._global.y;this._global.x=i.a*r+i.c*a+i.tx;this._global.y=i.d*a+i.b*r+i.ty;if(this.inheritRotation){this._global.skewX+=n.skewX;this._global.skewY+=n.skewY}if(this.inheritScale){this._global.scaleX*=n.scaleX;this._global.scaleY*=n.scaleY}}t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix);return e};r._calculateRelativeParentTransform=function(){};i(r,"name",function(){return this._name},function(t){this._name=t});i(r,"global",function(){return this._global});i(r,"globalTransformMatrix",function(){return this._globalTransformMatrix});i(r,"origin",function(){return this._origin});i(r,"parent",function(){return this._parent});i(r,"visible",function(){return this._visible},function(t){this._visible=t});i(r,"frameCache",undefined,function(t){this._frameCache=t});e._tempParentGlobalTransform=new t.DBTransform;return e}();t.FastDBObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.slotList=[];this.boneList=[];this._needUpdate=0;this.isIKConstraint=false;this.childrenBones=[];this._needUpdate=2;this._tweenPivot=new t.Point}var n=__define,r=i,a=r.prototype;i.initWithBoneData=function(t){var e=new i;e.name=t.name;e.length=t.length;e.inheritRotation=t.inheritRotation;e.inheritScale=t.inheritScale;e.origin.copy(t.transform);return e};a.getBones=function(t){if(t===void 0){t=true}return t?this.boneList.concat():this.boneList};a.getSlots=function(t){if(t===void 0){t=true}return t?this.slotList.concat():this.slotList};a.dispose=function(){e.prototype.dispose.call(this);this._timelineState=null;this._tweenPivot=null};a.invalidUpdate=function(){this._needUpdate=2;this.operationInvalidUpdate(this);var t;var e;for(t=0,e=this.childrenBones.length;t<e;t++){if(this.childrenBones[t]._needUpdate!=2){this.operationInvalidUpdate(this.childrenBones[t]);this.childrenBones[t].invalidUpdate()}}};a.operationInvalidUpdate=function(t){var e=this.armature.getIKTargetData(t);var i;var n;var r;var a;var o;var s;for(i=0,n=e.length;i<n;i++){o=e[i];for(r=0,a=o.bones.length;r<a;r++){s=o.bones[r];if(s._needUpdate!=2){s.invalidUpdate()}}}};a._calculateRelativeParentTransform=function(){this._global.copy(this._origin);if(this._timelineState){this._global.add(this._timelineState._transform)}};a.updateByCache=function(t){e.prototype.updateByCache.call(this,t);this._global=this._frameCache.globalTransform;this._globalTransformMatrix=this._frameCache.globalTransformMatrix};a.update=function(t){if(t===void 0){t=false}this._needUpdate--;if(t||this._needUpdate>0||this._parent&&this._parent._needUpdate>0){this._needUpdate=1}else{return}this.updataLocalTransform();this.updateGlobalTransform()};a.updataLocalTransform=function(){this.blendingTimeline();this._calculateRelativeParentTransform()};a.updateGlobalTransform=function(){var t=this._updateGlobal();if(t){t.release()}};a._updateGlobal=function(){if(!this.armature._skewEnable){return e.prototype._updateGlobal.call(this)}var i=this._calculateParentTransform();if(i!=null&&i.parentGlobalTransformMatrix&&i.parentGlobalTransform){var n=i.parentGlobalTransformMatrix;var r=i.parentGlobalTransform;var a=this._global.scaleX*r.scaleX>0;var o=this._global.scaleY*r.scaleY>0;var s=this._global.rotation;var l=this._global.scaleX;var h=this._global.scaleY;var u=this.parentBoneRotation;this._localTransform=this._global;if(this.inheritScale&&!this.inheritRotation){if(u!=0){this._localTransform=this._localTransform.clone();this._localTransform.rotation-=u}}t.TransformUtil.transformToMatrix(this._localTransform,this._globalTransformMatrix);this._globalTransformMatrix.concat(n);if(this.inheritScale){t.TransformUtil.matrixToTransform(this._globalTransformMatrix,this._global,a,o)}else{t.TransformUtil.matrixToTransformPosition(this._globalTransformMatrix,this._global);this._global.scaleX=this._localTransform.scaleX;this._global.scaleY=this._localTransform.scaleY;this._global.rotation=this._localTransform.rotation+(this.inheritRotation?u:0);t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix)}}return i};a.adjustGlobalTransformMatrixByIK=function(){if(!this.parent){return}this.updataLocalTransform();this._global.rotation=this.rotationIK-this.parentBoneRotation;this.updateGlobalTransform()};a._hideSlots=function(){var t=this.slotList.length;for(var e=0;e<t;e++){var i=this.slotList[e];i.hideSlots()}};a.blendingTimeline=function(){if(this._timelineState){this._tweenPivot.x=this._timelineState._pivot.x;this._tweenPivot.y=this._timelineState._pivot.y}};a.arriveAtFrame=function(e,i){var n;if(e.event&&this.armature.hasEventListener(t.FrameEvent.BONE_FRAME_EVENT)){var r=new t.FrameEvent(t.FrameEvent.BONE_FRAME_EVENT);r.bone=this;r.animationState=i;r.frameLabel=e.event;this.armature._addEvent(r)}};n(a,"childArmature",function(){var t=this.slot;if(t){return t.childArmature}return null});n(a,"display",function(){var t=this.slot;if(t){return t.display}return null},function(t){var e=this.slot;if(e){e.display=t}});n(a,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;for(var e=0,i=this.armature.slotList.length;e<i;e++){if(this.armature.slotList[e].parent==this){this.armature.slotList[e]._updateDisplayVisible(this._visible)}}}});n(a,"slot",function(){return this.slotList.length>0?this.slotList[0]:null});n(a,"parentBoneRotation",function(){return this.parent?this.parent.rotationIK:0});n(a,"parentBoneData",undefined,function(t){if(this._parent!=t){if(this._parent!=null){var e=this._parent.childrenBones.indexOf(this);if(e>=0){this._parent.childrenBones.splice(e,1)}}this.setParent(t);if(this._parent!=null){var i=this._parent.childrenBones.indexOf(this);if(i<0){this._parent.childrenBones.push(this)}}}});return i}(t.FastDBObject);t.FastBone=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(t,e){this.animationCacheBend=0;this.animationCacheWeight=-1;this.ikdata=t;this.armature=e;this.weight=t.weight;this.bendDirection=t.bendPositive?1:-1;this.bones=[];var i;if(t.chain){i=e.getBone(t.bones).parent;i.isIKConstraint=true;this.bones.push(i)}i=e.getBone(t.bones);i.isIKConstraint=true;this.bones.push(i);this.target=e.getBone(t.target)}var i=__define,n=e,r=n.prototype;r.dispose=function(){};r.compute=function(){switch(this.bones.length){case 1:var t=this.animationCacheWeight>=0?this.animationCacheWeight:this.weight;this.compute1(this.bones[0],this.target,t);break;case 2:var e=this.animationCacheBend!=0?this.animationCacheBend:this.bendDirection;var i=this.animationCacheWeight>=0?this.animationCacheWeight:this.weight;var n=this.compute2(this.bones[0],this.bones[1],this.target.global.x,this.target.global.y,e,i);this.bones[0].rotationIK=this.bones[0].origin.rotation+(n.x-this.bones[0].origin.rotation)*i+this.bones[0].parent.rotationIK;this.bones[1].rotationIK=this.bones[1].origin.rotation+(n.y-this.bones[1].origin.rotation)*i+this.bones[0].rotationIK;break}};r.compute1=function(t,e,i){var n=!t.inheritRotation||t.parent==null?0:t.parent.global.rotation;var r=t.global.rotation;var a=Math.atan2(e.global.y-t.global.y,e.global.x-t.global.x);t.rotationIK=r+(a-r)*i};r.compute2=function(e,i,n,r,a,o){if(o==0){return new t.Point(e.global.rotation,i.global.rotation)}var s=new t.Point;var l=new t.Point(e.global.x,e.global.y);var h=new t.Point(i.global.x,i.global.y);var u=new t.Matrix;t.TransformUtil.transformToMatrix(e.parent.global,u);u.invert();var c=t.TransformUtil.applyMatrixToPoint(new t.Point(n,r),u,true);n=c.x;r=c.y;l=t.TransformUtil.applyMatrixToPoint(l,u,true);h=t.TransformUtil.applyMatrixToPoint(h,u,true);var p=e.origin.scaleX;var f=e.origin.scaleY;var m=i.origin.scaleX;var d=h.x-l.x;var y=h.y-l.y;var v=Math.sqrt(d*d+y*y);var g;var _;var I=1;var x=0;var w=0;if(p<0){p=-p;x=Math.PI;I=-1}else{x=0;I=1}if(f<0){f=-f;I=-I}if(m<0){m=-m;w=Math.PI}else{w=0}a=I*a;t:if(Math.abs(p-f)<=.001){var S=i.length;var b=S*m;n=n-l.x;r=r-l.y;var C=2*v*b;var T=(n*n+r*r-v*v-b*b)/C;if(T<-1)T=-1;else if(T>1)T=1;_=Math.acos(T)*a;var D=v+b*T;var U=b*Math.sin(_);g=Math.atan2(r*D-n*U,n*D+r*U)}else{var A=v;var E=n-l.x;var M=r-l.y;var P=i.length*i.origin.scaleX;var B=p*P;var L=f*P;var R=Math.atan2(M,E);var O=B*B;var V=L*L;var F=A*A;var k=E*E+M*M;var N=V*F+O*k-O*V;var G=-2*V*A;var W=V-O;var H=G*G-4*W*N;if(H>=0){var X=Math.sqrt(H);if(G<0){X=-X}X=-(G+X)/2;var J=X/W;var Y=N/X;var z=Math.abs(J)<Math.abs(Y)?J:Y;if(z*z<=k){var j=Math.sqrt(k-z*z)*a;g=R-Math.atan2(j,z);_=Math.atan2(j/f,(z-A)/p);break t}}var K=0;var q=Number.MAX_VALUE;var Z=0;var Q=0;var $=0;var tt=0;var et=0;var it=0;var nt=A+B;var rt=nt*nt;if(rt>tt){$=0;tt=rt;et=nt}nt=A-B;rt=nt*nt;if(rt<q){K=Math.PI;q=rt;Z=nt}var at=Math.acos(-B*A/(O-V));nt=B*Math.cos(at)+A;var ot=L*Math.sin(at);rt=nt*nt+ot*ot;if(rt<q){K=at;q=rt;Z=nt;Q=ot}if(rt>tt){$=at;tt=rt;et=nt;it=ot}if(k<=(q+tt)/2){g=R-Math.atan2(Q*a,Z);_=K*a}else{g=R-Math.atan2(it*a,et);_=$*a}}var st=i.origin.x;var lt=i.origin.y*f;var ht=Math.atan2(lt,st)*I;s.x=g-ht+x;s.y=(_+ht)*I+w;this.normalize(s.x);this.normalize(s.y);return s};r.normalize=function(t){if(t>Math.PI){t-=Math.PI*2}else if(t<-Math.PI){t+=Math.PI*2}};return e}();t.FastIKConstraint=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(i){e.call(this);this.hasChildArmature=false;this._displayIndex=-1;this._rawDisplay=null;this._display=null;this._childArmature=null;this._displayList=[];this._displayDataList=[];this._cacheTimeline=null;this.hasChildArmature=false;this.inheritRotation=true;this.inheritScale=true;this._originZOrder=0;this._tweenZOrder=0;this._offsetZOrder=0;this._colorTransform=new t.ColorTransform;this._isColorChanged=false;this._rawDisplay=i}var n=__define,r=i,a=r.prototype;a.initWithSlotData=function(t){this.name=t.name;this.blendMode=t.blendMode;this._defaultGotoAndPlay=t.gotoAndPlay;this._originZOrder=t.zOrder;this._originDisplayIndex=t.displayIndex};a.dispose=function(){if(!this._displayList){return}e.prototype.dispose.call(this);this._rawDisplay=null;this._display=null;this._childArmature=null;this._displayDataList=null;this._displayList=null};a.updateByCache=function(i){var n=this._cacheTimeline.frameCacheList[i];var r=n.displayIndex;if(r!=this._displayIndex){this._displayIndex=r;this.changeDisplay()}if(this._displayIndex<0){return}if(this._frameCache&&n.globalTransform==this._frameCache.globalTransform){this._frameCache=n}else{this._frameCache=n;e.prototype.updateByCache.call(this,i);this._updateTransform()}var a=this._frameCache.colorTransform;var o=a!=null;if(this._isColorChanged!=o||this._isColorChanged&&o&&!t.ColorTransformUtil.isEqual(this._colorTransform,a)){a=a||t.ColorTransformUtil.originalColor;this._updateDisplayColor(a.alphaOffset,a.redOffset,a.greenOffset,a.blueOffset,a.alphaMultiplier,a.redMultiplier,a.greenMultiplier,a.blueMultiplier,o)}var s=this._frameCache.gotoAndPlay;if(this._gotoAndPlay!=s){this._gotoAndPlay=s;this.updateChildArmatureAnimation()}};a._update=function(t){if(t===void 0){t=false}if(this._parent&&(this._parent._needUpdate>0||t)){if(this._global!=this._globalBackup){this._global=this._globalBackup;this._globalTransformMatrix=this._globalTransformMatrixBackup}var e=this._updateGlobal();if(e){e.release()}this._updateTransform()}};a._calculateRelativeParentTransform=function(){this._global.copy(this._origin);this._global.x+=this._parent._tweenPivot.x;this._global.y+=this._parent._tweenPivot.y};a.updateChildArmatureAnimation=function(){if(this.childArmature){if(this._displayIndex>=0){var t=this._gotoAndPlay;if(t==null){t=this._defaultGotoAndPlay;if(t==null){this.childArmature.armatureData.defaultAnimation}}if(t==null){if(this.armature&&this.armature.animation.lastAnimationState){t=this.armature.animation.lastAnimationState.name}}if(t&&this.childArmature.animation.hasAnimation(t)){this.childArmature.animation.gotoAndPlay(t)}else{this.childArmature.animation.play()}}else{this.childArmature.animation.stop();this.childArmature.animation._lastAnimationState=null}}};a.changeDisplay=function(){var e=this._display;var i=this._childArmature;if(this._displayIndex<0||this._displayIndex>=this._displayList.length){this._display=this._rawDisplay}else{this._display=this._displayList[this._displayIndex]}if(this._display instanceof t.FastArmature){this._childArmature=this._display;this._display=this._display.display}else{this._childArmature=null;if(!this._display){this._display=this._rawDisplay}}if(this._childArmature!=i){if(this._childArmature){this._childArmature.animation.play()}else{}}if(this._display!=e){this._updateDisplay(this._display);if(this.armature){if(e){this._replaceDisplay(e)}else{this._addDisplay()}}}if(this._display==this._rawDisplay){this._updateFrame()}if(this._display!=e){this._updateDisplayBlendMode(this._blendMode);this._updateDisplayColor(this._colorTransform.alphaOffset,this._colorTransform.redOffset,this._colorTransform.greenOffset,this._colorTransform.blueOffset,this._colorTransform.alphaMultiplier,this._colorTransform.redMultiplier,this._colorTransform.greenMultiplier,this._colorTransform.blueMultiplier)}if(this._displayIndex>=0&&this._displayIndex<this._displayDataList.length){this._origin.copy(this._displayDataList[this._displayIndex][0].transform)}if(this.armature&&!this.armature._isFrameCached){this._update(true)}};n(a,"visible",undefined,function(t){if(this._visible!=t){this._visible=t;this._updateDisplayVisible(this._visible)}});n(a,"displayIndex",function(){return this._displayIndex},function(t){if(this._displayIndex==t){return}this._displayIndex=t;this.changeDisplay()});n(a,"display",function(){return this._display},function(t){var e=this._displayList.length;if(this._displayIndex>=e){if(e==0){this._displayList[0]=t}else{this._displayList[e-1]=t}}else{this._displayList[this._displayIndex]=t}if(this._displayIndex>=0){this.changeDisplay()}});n(a,"childArmature",function(){return this._childArmature},function(t){if(this._childArmature==t){return}this.display=t});n(a,"displayDataList",function(){return this._displayDataList},function(t){if(this._displayDataList!=t){if(t&&t.length){this._displayDataList.length=t.length;for(var e=0,i=this._displayDataList.length;e<i;++e){this._displayDataList[e]=t[e]}}else{this._displayDataList.length=0}}});n(a,"displayList",function(){return this._displayList},function(t){if(this._displayList!=t){if(t&&t.length){this._displayList.length=t.length;for(var e=0,i=this._displayList.length;e<i;++e){this._displayList[e]=t[e]}}else{this._displayList.length=0}}this.changeDisplay()});n(a,"zOrder",function(){return this._originZOrder+this._tweenZOrder+this._offsetZOrder},function(t){if(this.zOrder!=t){this._offsetZOrder=t-this._originZOrder-this._tweenZOrder;if(this.armature){this.armature._slotsZOrderChanged=true}}});n(a,"blendMode",function(){return this._blendMode},function(t){if(this._blendMode!=t){this._blendMode=t;this._updateDisplayBlendMode(this._blendMode)}});n(a,"gotoAndPlay",function(){return this._gotoAndPlay},function(t){if(this._gotoAndPlay!=t){this._gotoAndPlay=t;this.updateChildArmatureAnimation()}});n(a,"colorTransform",function(){return this._colorTransform});n(a,"colorChanged",function(){return this._isColorChanged});a._updateDisplay=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};a._addDisplay=function(){throw new Error("Abstract method needs to be implemented in subclass!")};a._replaceDisplay=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};a._removeDisplay=function(){throw new Error("Abstract method needs to be implemented in subclass!")};a._getDisplayIndex=function(){throw new Error("Abstract method needs to be implemented in subclass!")};a._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}throw new Error("Abstract method needs to be implemented in subclass!")};a._removeDisplayFromContainer=function(){throw new Error("Abstract method needs to be implemented in subclass!")};a._updateTransform=function(){throw new Error("Abstract method needs to be implemented in subclass!")};a._updateFrame=function(){throw new Error("Abstract method needs to be implemented in subclass!")};a._updateDisplayVisible=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};a._updateDisplayColor=function(t,e,i,n,r,a,o,s,l){if(l===void 0){l=false}this._colorTransform.alphaOffset=t;this._colorTransform.redOffset=e;this._colorTransform.greenOffset=i;this._colorTransform.blueOffset=n;this._colorTransform.alphaMultiplier=r;this._colorTransform.redMultiplier=a;this._colorTransform.greenMultiplier=o;this._colorTransform.blueMultiplier=s;this._isColorChanged=l};a._updateDisplayBlendMode=function(t){throw new Error("Abstract method needs to be implemented in subclass!")};a._arriveAtFrame=function(t,e){var i=t;this.displayIndex=i.displayIndex;this._updateDisplayVisible(i.visible);if(this._displayIndex>=0){if(!isNaN(i.zOrder)&&i.zOrder!=this._tweenZOrder){this._tweenZOrder=i.zOrder;this.armature._slotsZOrderChanged=true}}if(t.action){var n=this.childArmature;if(n){n.getAnimation().gotoAndPlay(t.action)}}else if(i.gotoAndPlay){this.gotoAndPlay=i.gotoAndPlay}};a.hideSlots=function(){this.displayIndex=-1};a._updateGlobal=function(){this._calculateRelativeParentTransform();t.TransformUtil.transformToMatrix(this._global,this._globalTransformMatrix);var e=this._calculateParentTransform();if(e){this._globalTransformMatrix.concat(e.parentGlobalTransformMatrix);t.TransformUtil.matrixToTransform(this._globalTransformMatrix,this._global,this._global.scaleX*e.parentGlobalTransform.scaleX>=0,this._global.scaleY*e.parentGlobalTransform.scaleY>=0)}return e};a._resetToOrigin=function(){this.displayIndex=this._originDisplayIndex;this._updateDisplayColor(0,0,0,0,1,1,1,1,true)};return i}(t.FastDBObject);t.FastSlot=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(e){this.animationState=new t.FastAnimationState;this._armature=e;this.animationState._armature=e;this.animationList=[];this._animationDataObj={};this._isPlaying=false;this._timeScale=1}var i=__define,n=e,r=n.prototype;r.dispose=function(){if(!this._armature){return}this._armature=null;this._animationDataList=null;this.animationList=null;this.animationState=null};r.gotoAndPlay=function(t,e,i,n){if(e===void 0){e=-1}if(i===void 0){i=-1}if(n===void 0){n=NaN}if(!this._animationDataList){return null}var r=this._animationDataObj[t];if(!r){return null}if(this._armature.enableCache){this.animationCacheManager=this._armature._armatureData._cacheManager;var a=this.animationCacheManager.getAnimationCache(t);a.frameNum=Math.ceil(r.duration*.001*this.animationCacheManager.frameRate/r.scale);this.animationState.animationCache=a;l=this._armature.slotList.length;while(l--){var o=this._armature.slotList[l];o._cacheTimeline=a.slotTimelineCacheDic[o.name]}}this._isPlaying=true;e=0;var s;if(i<0){s=r.scale<0?1:r.scale}else{s=i*1e3/r.duration}n=isNaN(n)?r.playTimes:n;this.animationState._fadeIn(r,n,1/s,e);var l=this._armature.slotHasChildArmatureList.length;while(l--){var o=this._armature.slotHasChildArmatureList[l];var h=o.childArmature;if(h){h.getAnimation().gotoAndPlay(t)}}return this.animationState};r.gotoAndStop=function(t,e,i,n,r){if(i===void 0){i=-1}if(n===void 0){n=0}if(r===void 0){r=-1}if(this.animationState.name!=t){this.gotoAndPlay(t,n,r)}if(i>=0){this.animationState.setCurrentTime(this.animationState.totalTime*i)}else{this.animationState.setCurrentTime(e)}this.animationState.stop();return this.animationState};r.play=function(){if(!this._animationDataList){return}if(!this.animationState.name){this.gotoAndPlay(this._animationDataList[0].name)}else if(!this._isPlaying){this._isPlaying=true}else{this.gotoAndPlay(this.animationState.name)}};r.stop=function(){this._isPlaying=false};r.advanceTime=function(t){if(!this._isPlaying){return}this.animationState._advanceTime(t*this._timeScale)};r.hasAnimation=function(t){return this._animationDataObj[t]!=null};i(r,"timeScale",function(){return this._timeScale},function(t){if(isNaN(t)||t<0){t=1}this._timeScale=t});i(r,"animationDataList",function(){return this._animationDataList},function(t){this._animationDataList=t;this.animationList.length=0;var e=this._animationDataList.length;for(var i=0;i<e;i++){var n=this._animationDataList[i];this.animationList.push(n.name);this._animationDataObj[n.name]=n}});i(r,"movementList",function(){return this.animationList});i(r,"movementID",function(){return this.lastAnimationName});r.isPlaying=function(){return this._isPlaying&&!this.isComplete};i(r,"isComplete",function(){return this.animationState.isComplete});i(r,"lastAnimationState",function(){return this.animationState});i(r,"lastAnimationName",function(){return this.animationState?this.animationState.name:null});return e}();t.FastAnimation=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._boneTimelineStateList=[];this._slotTimelineStateList=[];this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._currentPlayTimes=0;this._totalTime=0;this._currentTime=0;
this._lastTime=0;this._playTimes=0;this._fading=false}var i=__define,n=e,r=n.prototype;r.dispose=function(){this._resetTimelineStateList();this._armature=null};r.play=function(){this._isPlaying=true;return this};r.stop=function(){this._isPlaying=false;return this};r.setCurrentTime=function(t){if(t<0||isNaN(t)){t=0}this._time=t;this._currentTime=this._time*1e3;return this};r._resetTimelineStateList=function(){var e=this._boneTimelineStateList.length;while(e--){t.FastBoneTimelineState.returnObject(this._boneTimelineStateList[e])}this._boneTimelineStateList.length=0;e=this._slotTimelineStateList.length;while(e--){t.FastSlotTimelineState.returnObject(this._slotTimelineStateList[e])}this._slotTimelineStateList.length=0;this.name=null};r._fadeIn=function(t,e,i,n){this.animationData=t;this.name=this.animationData.name;this._totalTime=this.animationData.duration;this.autoTween=t.autoTween;this.setTimeScale(i);this.setPlayTimes(e);this._isComplete=false;this._currentFrameIndex=-1;this._currentPlayTimes=-1;if(Math.round(this._totalTime*this.animationData.frameRate*.001)<2){this._currentTime=this._totalTime}else{this._currentTime=-1}this._fadeTotalTime=n*this._timeScale;this._fading=this._fadeTotalTime>0;this._isPlaying=true;if(this._armature.enableCache&&this.animationCache&&this._fading&&this._boneTimelineStateList){this.updateTransformTimeline(this._progress)}this._time=0;this._progress=0;this._updateTimelineStateList();this.hideBones();return};r._updateTimelineStateList=function(){this._resetTimelineStateList();var e;var i=this.animationData.timelineList.length;for(var n=0;n<i;n++){var r=this.animationData.timelineList[n];e=r.name;var a=this._armature.getBone(e);if(a){var o=t.FastBoneTimelineState.borrowObject();o.fadeIn(a,this,r);this._boneTimelineStateList.push(o)}}var s=this.animationData.slotTimelineList.length;for(var l=0;l<s;l++){var h=this.animationData.slotTimelineList[l];e=h.name;var u=this._armature.getSlot(e);if(u&&u.displayList.length>0){var c=t.FastSlotTimelineState.borrowObject();c.fadeIn(u,this,h);this._slotTimelineStateList.push(c)}}};r._advanceTime=function(t){t*=this._timeScale;if(this._fading){this._time+=t;this._progress=this._time/this._fadeTotalTime;if(this._progress>=1){this._progress=0;this._time=0;this._fading=false}}if(this._fading){var e=this._boneTimelineStateList.length;for(var i=0;i<e;i++){var n=this._boneTimelineStateList[i];n.updateFade(this._progress)}var r=this._slotTimelineStateList.length;for(var a=0;a<r;a++){var o=this._slotTimelineStateList[a];o.updateFade(this._progress)}}else{this.advanceTimelinesTime(t)}};r.advanceTimelinesTime=function(e){if(this._isPlaying){this._time+=e}var i=false;var n=false;var r=false;var a=false;var o=0;var s=this._time*1e3;if(this._playTimes==0||s<this._playTimes*this._totalTime){a=false;this._progress=s/this._totalTime;o=Math.ceil(this._progress)||1;this._progress-=Math.floor(this._progress);s%=this._totalTime}else{o=this._playTimes;s=this._totalTime;a=true;this._progress=1}this._isComplete=a;if(this.animationCache){var l=Math.floor(this._progress*(this.animationCache.frameNum-1));this._armature._cacheFrameIndex=l;this._armature._isFrameCached=this.animationCache._cahceList[l];if(this._armature._isFrameCached){}else{this.updateTransformTimeline(this._progress)}}else{this.updateTransformTimeline(this._progress)}if(this._currentTime!=s){if(this._currentPlayTimes!=o){if(this._currentPlayTimes>0&&o>1){n=true}this._currentPlayTimes=o}if(this._currentTime<0){i=true}if(this._isComplete){r=true}this._lastTime=this._currentTime;this._currentTime=s;this.updateMainTimeline(a)}var h;if(i){if(this._armature.hasEventListener(t.AnimationEvent.START)){h=new t.AnimationEvent(t.AnimationEvent.START);h.animationState=this;this._armature._addEvent(h)}}if(r){if(this._armature.hasEventListener(t.AnimationEvent.COMPLETE)){h=new t.AnimationEvent(t.AnimationEvent.COMPLETE);h.animationState=this;this._armature._addEvent(h)}}else if(n){if(this._armature.hasEventListener(t.AnimationEvent.LOOP_COMPLETE)){h=new t.AnimationEvent(t.AnimationEvent.LOOP_COMPLETE);h.animationState=this;this._armature._addEvent(h)}}};r.updateTransformTimeline=function(t){var e=this._boneTimelineStateList.length;var i;var n;if(this._isComplete){while(e--){i=this._boneTimelineStateList[e];i.update(t);this._isComplete=i._isComplete&&this._isComplete}e=this._slotTimelineStateList.length;while(e--){n=this._slotTimelineStateList[e];n.update(t);this._isComplete=n._isComplete&&this._isComplete}}else{while(e--){i=this._boneTimelineStateList[e];i.update(t)}e=this._slotTimelineStateList.length;while(e--){n=this._slotTimelineStateList[e];n.update(t)}}};r.updateMainTimeline=function(t){var e=this.animationData._frameList;if(e.length>0){var i;var n;for(var r=0,a=e.length;r<a;++r){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._lastTime=this._currentTime;this._currentFrameIndex++;if(this._currentFrameIndex>=e.length){if(t){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}n=e[this._currentFrameIndex];if(i){this._armature.arriveAtFrame(i,this)}this._currentFrameDuration=n.duration;this._currentFramePosition=n.position;i=n}if(n){this._armature.arriveAtFrame(n,this)}}};r.setTimeScale=function(t){if(isNaN(t)||t==Infinity){t=1}this._timeScale=t;return this};r.setPlayTimes=function(t){if(t===void 0){t=0}if(Math.round(this._totalTime*.001*this.animationData.frameRate)<2){this._playTimes=1}else{this._playTimes=t}return this};i(r,"playTimes",function(){return this._playTimes});i(r,"currentPlayTimes",function(){return this._currentPlayTimes<0?0:this._currentPlayTimes});i(r,"isComplete",function(){return this._isComplete});i(r,"isPlaying",function(){return this._isPlaying&&!this._isComplete});i(r,"totalTime",function(){return this._totalTime*.001});i(r,"currentTime",function(){return this._currentTime<0?0:this._currentTime*.001});r.isUseCache=function(){return this._armature.enableCache&&this.animationCache&&!this._fading};r.hideBones=function(){var t=this.animationData.hideTimelineNameMap.length;for(var e=0;e<t;e++){var i=this.animationData.hideTimelineNameMap[e];var n=this._armature.getBone(i);if(n){n._hideSlots()}}var r;for(e=0,t=this.animationData.hideSlotTimelineNameMap.length;e<t;e++){r=this.animationData.hideSlotTimelineNameMap[e];var a=this._armature.getSlot(r);if(a){a._resetToOrigin()}}};i(r,"progress",function(){return this._progress});return e}();t.FastAnimationState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._lastTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._transform=new t.DBTransform;this._durationTransform=new t.DBTransform;this._transformToFadein=new t.DBTransform;this._pivot=new t.Point;this._durationPivot=new t.Point}var i=__define,n=e,r=n.prototype;e.borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e.returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e.clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};r.clear=function(){if(this._bone){this._bone._timelineState=null;this._bone=null}this._animationState=null;this._timelineData=null;this._originPivot=null};r.fadeIn=function(e,i,n){this._bone=e;this._animationState=i;this._timelineData=n;this.name=n.name;this._totalTime=this._timelineData.duration;this._isComplete=false;this._tweenTransform=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._durationPivot.x=0;this._durationPivot.y=0;this._pivot.x=0;this._pivot.y=0;this._originPivot=this._timelineData.originPivot;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}if(i._fadeTotalTime>0){var r;if(this._bone._timelineState){this._transformToFadein.copy(this._bone._timelineState._transform)}else{this._transformToFadein=new t.DBTransform}var a=this._timelineData.frameList[0];this._durationTransform.copy(a.transform);this._durationTransform.minus(this._transformToFadein)}this._bone._timelineState=this};r.updateFade=function(t){this._transform.x=this._transformToFadein.x+this._durationTransform.x*t;this._transform.y=this._transformToFadein.y+this._durationTransform.y*t;this._transform.scaleX=this._transformToFadein.scaleX*(1+(this._durationTransform.scaleX-1)*t);this._transform.scaleY=this._transformToFadein.scaleX*(1+(this._durationTransform.scaleY-1)*t);this._transform.rotation=this._transformToFadein.rotation+this._durationTransform.rotation*t;this._bone.invalidUpdate()};r.update=function(t){if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}else if(this._updateMode==-1){this.updateMultipleFrame(t)}};r.updateSingleFrame=function(){var t=this._timelineData.frameList[0];this._bone.arriveAtFrame(t,this._animationState);this._isComplete=true;this._tweenEasing=NaN;this._tweenTransform=false;this._pivot.x=this._originPivot.x+t.pivot.x;this._pivot.y=this._originPivot.y+t.pivot.y;this._transform.copy(t.transform);this._bone.invalidUpdate()};r.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;i-=Math.floor(i/this._totalTime)*this._totalTime;if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{i-=Math.floor(i/this._totalTime)*this._totalTime}}if(this._currentTime!=i){this._lastTime=this._currentTime;this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration||this._currentTime<this._lastTime){this._currentFrameIndex++;this._lastTime=this._currentTime;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];if(o){this._bone.arriveAtFrame(o,this._animationState)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this._bone.arriveAtFrame(s,this._animationState);this.updateToNextFrame(e)}if(this._tweenTransform){this.updateTween()}}};r.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var a=false;if(i==0&&(this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;a=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.animationData.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){a=false}else{if(this._tweenEasing==10){this._tweenEasing=0}a=true}}else{a=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;a=false}else{a=true}}if(a){this._durationTransform.x=r.transform.x-n.transform.x;this._durationTransform.y=r.transform.y-n.transform.y;this._durationTransform.skewX=r.transform.skewX-n.transform.skewX;this._durationTransform.skewY=r.transform.skewY-n.transform.skewY;this._durationTransform.scaleX=r.transform.scaleX-n.transform.scaleX+r.scaleOffset.x;this._durationTransform.scaleY=r.transform.scaleY-n.transform.scaleY+r.scaleOffset.y;this._durationPivot.x=r.pivot.x-n.pivot.x;this._durationPivot.y=r.pivot.y-n.pivot.y;this._durationTransform.normalizeRotation();if(i==0){this._durationTransform.skewX=t.TransformUtil.formatRadian(this._durationTransform.skewX);this._durationTransform.skewY=t.TransformUtil.formatRadian(this._durationTransform.skewY)}if(this._durationTransform.x||this._durationTransform.y||this._durationTransform.skewX||this._durationTransform.skewY||this._durationTransform.scaleX!=1||this._durationTransform.scaleY!=1||this._durationPivot.x||this._durationPivot.y){this._tweenTransform=true}else{this._tweenTransform=false}}else{this._tweenTransform=false}if(!this._tweenTransform){this._transform.copy(n.transform);this._pivot.x=this._originPivot.x+n.pivot.x;this._pivot.y=this._originPivot.y+n.pivot.y;this._bone.invalidUpdate()}};r.updateTween=function(){var e=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve){e=this._tweenCurve.getValueByProgress(e)}else if(this._tweenEasing){e=t.MathUtil.getEaseValue(e,this._tweenEasing)}var i=this._timelineData.frameList[this._currentFrameIndex];var n=i.transform;var r=i.pivot;this._transform.x=n.x+this._durationTransform.x*e;this._transform.y=n.y+this._durationTransform.y*e;this._transform.skewX=n.skewX+this._durationTransform.skewX*e;this._transform.skewY=n.skewY+this._durationTransform.skewY*e;this._transform.scaleX=n.scaleX+this._durationTransform.scaleX*e;this._transform.scaleY=n.scaleY+this._durationTransform.scaleY*e;this._pivot.x=r.x+this._durationPivot.x*e;this._pivot.y=r.y+this._durationPivot.y*e;this._bone.invalidUpdate()};e._pool=[];return e}();t.FastBoneTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._totalTime=0;this._currentTime=0;this._currentFrameIndex=0;this._currentFramePosition=0;this._currentFrameDuration=0;this._updateMode=0;this._durationColor=new t.ColorTransform}var i=__define,n=e,r=n.prototype;e.borrowObject=function(){if(e._pool.length==0){return new e}return e._pool.pop()};e.returnObject=function(t){if(e._pool.indexOf(t)<0){e._pool[e._pool.length]=t}t.clear()};e.clear=function(){var t=e._pool.length;while(t--){e._pool[t].clear()}e._pool.length=0};r.clear=function(){this._slot=null;this._armature=null;this._animation=null;this._animationState=null;this._timelineData=null};r.fadeIn=function(t,e,i){this._slot=t;this._armature=this._slot.armature;this._animation=this._armature.animation;this._animationState=e;this._timelineData=i;this.name=i.name;this._totalTime=this._timelineData.duration;this._isComplete=false;this._blendEnabled=false;this._tweenColor=false;this._currentFrameIndex=-1;this._currentTime=-1;this._tweenEasing=NaN;this._weight=1;switch(this._timelineData.frameList.length){case 0:this._updateMode=0;break;case 1:this._updateMode=1;break;default:this._updateMode=-1;break}};r.updateFade=function(t){};r.update=function(t){if(this._updateMode==-1){this.updateMultipleFrame(t)}else if(this._updateMode==1){this._updateMode=0;this.updateSingleFrame()}};r.updateMultipleFrame=function(t){var e=0;t/=this._timelineData.scale;t+=this._timelineData.offset;var i=this._totalTime*t;var n=this._animationState.playTimes;if(n==0){this._isComplete=false;e=Math.ceil(Math.abs(i)/this._totalTime)||1;i-=Math.floor(i/this._totalTime)*this._totalTime;if(i<0){i+=this._totalTime}}else{var r=n*this._totalTime;if(i>=r){i=r;this._isComplete=true}else if(i<=-r){i=-r;this._isComplete=true}else{this._isComplete=false}if(i<0){i+=r}e=Math.ceil(i/this._totalTime)||1;if(this._isComplete){i=this._totalTime}else{i-=Math.floor(i/this._totalTime)*this._totalTime}}if(this._currentTime!=i){this._currentTime=i;var a=this._timelineData.frameList;var o;var s;for(var l=0,h=this._timelineData.frameList.length;l<h;++l){if(this._currentFrameIndex<0){this._currentFrameIndex=0}else if(this._currentTime<this._currentFramePosition||this._currentTime>=this._currentFramePosition+this._currentFrameDuration){this._currentFrameIndex++;if(this._currentFrameIndex>=a.length){if(this._isComplete){this._currentFrameIndex--;break}else{this._currentFrameIndex=0}}}else{break}s=a[this._currentFrameIndex];if(o){this._slot._arriveAtFrame(o,this._animationState)}this._currentFrameDuration=s.duration;this._currentFramePosition=s.position;o=s}if(s){this._slot._arriveAtFrame(s,this._animationState);this._blendEnabled=s.displayIndex>=0;if(this._blendEnabled){this.updateToNextFrame(e)}else{this._tweenEasing=NaN;this._tweenColor=false}}if(this._blendEnabled){this.updateTween()}}};r.updateToNextFrame=function(e){if(e===void 0){e=0}var i=this._currentFrameIndex+1;if(i>=this._timelineData.frameList.length){i=0}var n=this._timelineData.frameList[this._currentFrameIndex];var r=this._timelineData.frameList[i];var a=false;if(i==0&&(this._animationState.playTimes&&this._animationState.currentPlayTimes>=this._animationState.playTimes&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+e-this._timelineData.offset)*this._timelineData.scale>.999999)){this._tweenEasing=NaN;a=false}else if(n.displayIndex<0||r.displayIndex<0){this._tweenEasing=NaN;a=false}else if(this._animationState.autoTween){this._tweenEasing=this._animationState.animationData.tweenEasing;if(isNaN(this._tweenEasing)){this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if(isNaN(this._tweenEasing)&&this._tweenCurve==null){a=false}else{if(this._tweenEasing==10){this._tweenEasing=0}a=true}}else{a=true}}else{this._tweenEasing=n.tweenEasing;this._tweenCurve=n.curve;if((isNaN(this._tweenEasing)||this._tweenEasing==10)&&this._tweenCurve==null){this._tweenEasing=NaN;a=false}else{a=true}}if(a){if(n.color||r.color){t.ColorTransformUtil.minus(r.color||t.ColorTransformUtil.originalColor,n.color||t.ColorTransformUtil.originalColor,this._durationColor);this._tweenColor=this._durationColor.alphaOffset!=0||this._durationColor.redOffset!=0||this._durationColor.greenOffset!=0||this._durationColor.blueOffset!=0||this._durationColor.alphaMultiplier!=0||this._durationColor.redMultiplier!=0||this._durationColor.greenMultiplier!=0||this._durationColor.blueMultiplier!=0}else{this._tweenColor=false}}else{this._tweenColor=false}if(!this._tweenColor){var o;var s;if(n.color){o=n.color;s=true}else{o=t.ColorTransformUtil.originalColor;s=false}if(this._slot._isColorChanged||s){if(!t.ColorTransformUtil.isEqual(this._slot._colorTransform,o)){this._slot._updateDisplayColor(o.alphaOffset,o.redOffset,o.greenOffset,o.blueOffset,o.alphaMultiplier,o.redMultiplier,o.greenMultiplier,o.blueMultiplier,s)}}}};r.updateTween=function(){var e=this._timelineData.frameList[this._currentFrameIndex];if(this._tweenColor){var i=(this._currentTime-this._currentFramePosition)/this._currentFrameDuration;if(this._tweenCurve!=null){i=this._tweenCurve.getValueByProgress(i)}else if(this._tweenEasing){i=t.MathUtil.getEaseValue(i,this._tweenEasing)}if(e.color){this._slot._updateDisplayColor(e.color.alphaOffset+this._durationColor.alphaOffset*i,e.color.redOffset+this._durationColor.redOffset*i,e.color.greenOffset+this._durationColor.greenOffset*i,e.color.blueOffset+this._durationColor.blueOffset*i,e.color.alphaMultiplier+this._durationColor.alphaMultiplier*i,e.color.redMultiplier+this._durationColor.redMultiplier*i,e.color.greenMultiplier+this._durationColor.greenMultiplier*i,e.color.blueMultiplier+this._durationColor.blueMultiplier*i,true)}else{this._slot._updateDisplayColor(this._durationColor.alphaOffset*i,this._durationColor.redOffset*i,this._durationColor.greenOffset*i,this._durationColor.blueOffset*i,this._durationColor.alphaMultiplier*i+1,this._durationColor.redMultiplier*i+1,this._durationColor.greenMultiplier*i+1,this._durationColor.blueMultiplier*i+1,true)}}};r.updateSingleFrame=function(){var e=this._timelineData.frameList[0];this._slot._arriveAtFrame(e,this._animationState);this._isComplete=true;this._tweenEasing=NaN;this._tweenColor=false;this._blendEnabled=e.displayIndex>=0;if(this._blendEnabled){var i;var n;if(e.color){i=e.color;n=true}else{i=t.ColorTransformUtil.originalColor;n=false}if(this._slot._isColorChanged||n){if(!t.ColorTransformUtil.isEqual(this._slot._colorTransform,i)){this._slot._updateDisplayColor(i.alphaOffset,i.redOffset,i.greenOffset,i.blueOffset,i.alphaMultiplier,i.redMultiplier,i.greenMultiplier,i.blueMultiplier,n)}}}};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._pool=[];return e}();t.FastSlotTimelineState=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e){if(t===void 0){t=0}if(e===void 0){e=0}this.x=t;this.y=e}var e=__define,i=t,n=i.prototype;n.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"};return t}();t.Point=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i,n){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(n===void 0){n=0}this.x=t;this.y=e;this.width=i;this.height=n}var e=__define,i=t,n=i.prototype;return t}();t.Rectangle=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.duration=0;this._frameList=[];this.duration=0;this.scale=1}var e=__define,i=t,n=i.prototype;n.dispose=function(){var t=this._frameList.length;while(t--){this._frameList[t].dispose()}this._frameList=null};n.addFrame=function(t){if(!t){throw new Error}if(this._frameList.indexOf(t)<0){this._frameList[this._frameList.length]=t}else{throw new Error}};e(n,"frameList",function(){return this._frameList});return t}();t.Timeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.frameRate=0;this.playTimes=0;this.lastFrameDuration=0;this.fadeTime=0;this.playTimes=0;this.autoTween=true;this.tweenEasing=NaN;this.hideTimelineNameMap=[];this.hideSlotTimelineNameMap=[];this._timelineList=[];this._slotTimelineList=[];this._ffdTimelineList=[]}var i=__define,n=e,r=n.prototype;i(r,"timelineList",function(){return this._timelineList});i(r,"slotTimelineList",function(){return this._slotTimelineList});i(r,"ffdTimelineList",function(){return this._ffdTimelineList});r.dispose=function(){t.prototype.dispose.call(this);this.hideTimelineNameMap=null;var e=0;var i=0;for(e=0,i=this._timelineList.length;e<i;e++){var n=this._timelineList[e];n.dispose()}this._timelineList=null;for(e=0,i=this._slotTimelineList.length;e<i;e++){var r=this._slotTimelineList[e];r.dispose()}this._slotTimelineList=null};r.getTimeline=function(t){var e=this._timelineList.length;while(e--){if(this._timelineList[e].name==t){return this._timelineList[e]}}return null};r.addTimeline=function(t){if(!t){throw new Error}if(this._timelineList.indexOf(t)<0){this._timelineList[this._timelineList.length]=t}};r.getSlotTimeline=function(t){var e=this._slotTimelineList.length;while(e--){if(this._slotTimelineList[e].name==t){return this._slotTimelineList[e]}}return null};r.addSlotTimeline=function(t){if(!t){throw new Error}if(this._slotTimelineList.indexOf(t)<0){this._slotTimelineList[this._slotTimelineList.length]=t}};r.addFFDTimeline=function(t){if(!t){throw new Error}if(this._ffdTimelineList.indexOf(t)<0){this._ffdTimelineList[this._ffdTimelineList.length]=t}};return e}(t.Timeline);t.AnimationData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._cacheManager=null;this._boneDataList=[];this._ikDataList=[];this._skinDataList=[];this._slotDataList=[];this._animationDataList=[]}var e=__define,i=t,n=i.prototype;t.sortBoneDataHelpArray=function(t,e){return t[0]>e[0]?1:-1};t.sortBoneDataHelpArrayDescending=function(t,e){return t[0]>e[0]?-1:1};n.setSkinData=function(t){var e=0;var i=this._slotDataList.length;for(e=0;e<i;e++){this._slotDataList[e].dispose()}var n;if(!t&&this._skinDataList.length>0){n=this._skinDataList[0]}else{e=0,i=this._skinDataList.length;for(;e<i;e++){if(this._skinDataList[e].name==t){n=this._skinDataList[e];break}}}if(n){var r;e=0,i=n.slotDataList.length;for(e=0;e<i;e++){r=this.getSlotData(n.slotDataList[e].name);if(r){var a=0;var o=n.slotDataList[e].displayDataList.length;for(a=0;a<o;a++){r.addDisplayData(n.slotDataList[e].displayDataList[a])}}}}};n.dispose=function(){var t=this._boneDataList.length;while(t--){this._boneDataList[t].dispose()}t=this._ikDataList.length;while(t--){this._ikDataList[t].dispose()}t=this._skinDataList.length;while(t--){this._skinDataList[t].dispose()}t=this._slotDataList.length;while(t--){this._slotDataList[t].dispose()}t=this._animationDataList.length;while(t--){this._animationDataList[t].dispose()}this._boneDataList=null;this._ikDataList=null;this._slotDataList=null;this._skinDataList=null;this._animationDataList=null};n.getBoneData=function(t){var e=this._boneDataList.length;while(e--){if(this._boneDataList[e].name==t){return this._boneDataList[e]}}return null};n.getIKData=function(t){var e=this._ikDataList.length;while(e--){if(this._ikDataList[e].name==t){return this._ikDataList[e]}}return null};n.getSlotData=function(t){var e=this._slotDataList.length;while(e--){if(this._slotDataList[e].name==t){return this._slotDataList[e]}}return null};n.getSkinData=function(t){if(!t&&this._skinDataList.length>0){return this._skinDataList[0]}var e=this._skinDataList.length;while(e--){if(this._skinDataList[e].name==t){return this._skinDataList[e]}}return null};n.getAnimationData=function(t){var e=this._animationDataList.length;while(e--){if(this._animationDataList[e].name==t){return this._animationDataList[e]}}return null};n.addBoneData=function(t){if(!t){throw new Error}if(this._boneDataList.indexOf(t)<0){this._boneDataList[this._boneDataList.length]=t}else{throw new Error}};n.addIKData=function(t){if(!t){throw new Error}if(this._ikDataList.indexOf(t)<0){this._ikDataList[this._ikDataList.length]=t}else{throw new Error}};n.addSlotData=function(t){if(!t){throw new Error}if(this._slotDataList.indexOf(t)<0){this._slotDataList[this._slotDataList.length]=t}else{throw new Error}};n.addSkinData=function(t){if(!t){throw new Error}if(this._skinDataList.indexOf(t)<0){this._skinDataList[this._skinDataList.length]=t}else{throw new Error}};n.addAnimationData=function(t){if(!t){throw new Error}if(this._animationDataList.indexOf(t)<0){this._animationDataList[this._animationDataList.length]=t}};n.sortBoneDataList=function(){var e=this._boneDataList.length;if(e==0){return}var i=[];while(e--){var n=this._boneDataList[e];var r=0;var a=n;while(a){r++;a=this.getBoneData(a.parent)}i[e]=[r,n]}i.sort(t.sortBoneDataHelpArray);e=i.length;while(e--){this._boneDataList[e]=i[e][1]}};e(n,"boneDataList",function(){return this._boneDataList});e(n,"ikDataList",function(){return this._ikDataList});e(n,"slotDataList",function(){return this._slotDataList});e(n,"skinDataList",function(){return this._skinDataList});e(n,"animationDataList",function(){return this._animationDataList});return t}();t.ArmatureData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.length=0;this.global=new t.DBTransform;this.transform=new t.DBTransform;this.inheritRotation=true;this.inheritScale=false}var i=__define,n=e,r=n.prototype;r.dispose=function(){this.global=null;this.transform=null};return e}();t.BoneData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.alphaMultiplier=1;this.alphaOffset=0;this.blueMultiplier=1;this.blueOffset=0;this.greenMultiplier=1;this.greenOffset=0;this.redMultiplier=1;this.redOffset=0}var e=__define,i=t,n=i.prototype;return t}();t.ColorTransform=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this._dataChanged=false;this._pointList=[];this.sampling=new Array(e.SamplingTimes);for(var i=0;i<e.SamplingTimes-1;i++){this.sampling[i]=new t.Point}}var i=__define,n=e,r=n.prototype;r.getValueByProgress=function(t){if(this._dataChanged){this.refreshSampling()}for(var i=0;i<e.SamplingTimes-1;i++){var n=this.sampling[i];if(n.x>=t){if(i==0){return n.y*t/n.x}else{var r=this.sampling[i-1];return r.y+(n.y-r.y)*(t-r.x)/(n.x-r.x)}}}return n.y+(1-n.y)*(t-n.x)/(1-n.x)};r.refreshSampling=function(){for(var t=0;t<e.SamplingTimes-1;t++){this.bezierCurve(e.SamplingStep*(t+1),this.sampling[t])}this._dataChanged=false};r.bezierCurve=function(t,e){var i=1-t;e.x=3*this.point1.x*t*i*i+3*this.point2.x*t*t*i+Math.pow(t,3);e.y=3*this.point1.y*t*i*i+3*this.point2.y*t*t*i+Math.pow(t,3)};i(r,"pointList",function(){return this._pointList},function(t){this._pointList=t;this._dataChanged=true});r.isCurve=function(){return this.point1.x!=0||this.point1.y!=0||this.point2.x!=1||this.point2.y!=1};i(r,"point1",function(){return this.pointList[0]});i(r,"point2",function(){return this.pointList[1]});e.SamplingTimes=20;e.SamplingStep=.05;return e}();t.CurveData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){this.transform=new t.DBTransform;this.pivot=new t.Point}var i=__define,n=e,r=n.prototype;r.dispose=function(){this.transform=null;this.pivot=null};e.ARMATURE="armature";e.IMAGE="image";e.MESH="mesh";return e}();t.DisplayData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.version=0;this._armatureDataList=[];this._displayDataDictionary={}}var e=__define,i=t,n=i.prototype;n.dispose=function(){for(var t=0,e=this._armatureDataList.length;t<e;t++){var i=this._armatureDataList[t];i.dispose()}this._armatureDataList=null;this.removeAllDisplayData();this._displayDataDictionary=null};e(n,"armatureDataList",function(){return this._armatureDataList});n.getArmatureDataByName=function(t){var e=this._armatureDataList.length;while(e--){if(this._armatureDataList[e].name==t){return this._armatureDataList[e]}}return null};n.addArmatureData=function(t){if(!t){throw new Error}if(this._armatureDataList.indexOf(t)<0){this._armatureDataList[this._armatureDataList.length]=t}else{throw new Error}};n.removeArmatureData=function(t){var e=this._armatureDataList.indexOf(t);if(e>=0){this._armatureDataList.splice(e,1)}};n.removeArmatureDataByName=function(t){var e=this._armatureDataList.length;while(e--){if(this._armatureDataList[e].name==t){this._armatureDataList.splice(e,1)}}};n.getDisplayDataByName=function(t){return this._displayDataDictionary[t]};n.addDisplayData=function(t){this._displayDataDictionary[t.name]=t};n.removeDisplayDataByName=function(t){delete this._displayDataDictionary[t]};n.removeAllDisplayData=function(){for(var t in this._displayDataDictionary){delete this._displayDataDictionary[t]}};return t}();t.DragonBonesData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.position=0;this.duration=0;this.position=0;this.duration=0}var e=__define,i=t,n=i.prototype;n.dispose=function(){};return t}();t.Frame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this)}var i=__define,n=e,r=n.prototype;return e}(t.Frame);t.FFDFrame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.offset=0}var i=__define,n=e,r=n.prototype;r.dispose=function(){t.prototype.dispose.call(this)};return e}(t.Timeline);t.FFDTimeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t,n=i.prototype;n.constructora=function(){};n.dispose=function(){};return t}();t.IKData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.skinned=false;this.numVertex=0;this.numTriangle=0;this.triangles=[];this.vertices=[];this.vertexBones=[];this.bones=[];this.inverseBindPose=[];this.slotPose=new t.Matrix}var n=__define,r=i,a=r.prototype;a.dispose=function(){e.prototype.dispose.call(this);this.triangles.length=0;this.vertices.length=0;
this.vertexBones.length=0;this.bones.length=0;this.inverseBindPose.length=0};return i}(t.DisplayData);t.MeshData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t,n=i.prototype;n.setTo=function(t,e){this.parentGlobalTransform=t;this.parentGlobalTransformMatrix=e;return this};n.release=function(){t.dispose(this)};t.create=function(){if(t._poolSize>0){t._poolSize--;return t._pool.pop()}return new t};t.dispose=function(e){e.parentGlobalTransform=null;e.parentGlobalTransformMatrix=null;t._pool[t._poolSize++]=e};t._pool=[];t._poolSize=0;return t}();t.ParentTransformObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.hasMesh=false;this._slotDataList=[]}var e=__define,i=t,n=i.prototype;n.dispose=function(){var t=this._slotDataList.length;while(t--){this._slotDataList[t].dispose()}this._slotDataList=null};n.getSlotData=function(t){var e=this._slotDataList.length;while(e--){if(this._slotDataList[e].name==t){return this._slotDataList[e]}}return null};n.addSlotData=function(t){if(!t){throw new Error}if(this._slotDataList.indexOf(t)<0){this._slotDataList[this._slotDataList.length]=t}else{throw new Error}};e(n,"slotDataList",function(){return this._slotDataList});return t}();t.SkinData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this._displayDataList=[];this.zOrder=0}var e=__define,i=t,n=i.prototype;n.dispose=function(){this._displayDataList.length=0};n.addDisplayData=function(t){if(!t){throw new Error}if(this._displayDataList.indexOf(t)<0){this._displayDataList[this._displayDataList.length]=t}else{throw new Error}};n.getDisplayData=function(t){var e=this._displayDataList.length;while(e--){if(this._displayDataList[e].name==t){return this._displayDataList[e]}}return null};e(n,"displayDataList",function(){return this._displayDataList});return t}();t.SlotData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.displayIndex=0;this.tweenEasing=10;this.displayIndex=0;this.visible=true;this.zOrder=NaN}var i=__define,n=e,r=n.prototype;r.dispose=function(){t.prototype.dispose.call(this);this.color=null};return e}(t.Frame);t.SlotFrame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.offset=0}var i=__define,n=e,r=n.prototype;r.dispose=function(){t.prototype.dispose.call(this)};return e}(t.Timeline);t.SlotTimeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.tweenRotate=0;this.displayIndex=0;this.tweenEasing=10;this.tweenRotate=0;this.tweenScale=true;this.displayIndex=0;this.visible=true;this.zOrder=NaN;this.global=new t.DBTransform;this.transform=new t.DBTransform;this.pivot=new t.Point;this.scaleOffset=new t.Point}var n=__define,r=i,a=r.prototype;a.dispose=function(){e.prototype.dispose.call(this);this.global=null;this.transform=null;this.pivot=null;this.scaleOffset=null;this.color=null};return i}(t.Frame);t.TransformFrame=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(i,e);function i(){e.call(this);this.originTransform=new t.DBTransform;this.originTransform.scaleX=1;this.originTransform.scaleY=1;this.originPivot=new t.Point;this.offset=0}var n=__define,r=i,a=r.prototype;a.dispose=function(){e.prototype.dispose.call(this);this.originTransform=null;this.originPivot=null};return i}(t.Timeline);t.TransformTimeline=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){this.indices=[];this.weights=[];this.vertices=[]}var e=__define,i=t,n=i.prototype;return t}();t.VertexBoneData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){t.call(this);this.u=0;this.v=0}var i=__define,n=e,r=n.prototype;return e}(t.Point);t.VertexData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e,r=n.prototype;e.parseDragonBonesData=function(i){if(!i){throw new Error}var n=i[t.ConstValues.A_VERSION];n=n.toString();if(n.toString()!=t.DragonBones.DATA_VERSION&&n.toString()!=t.DragonBones.PARENT_COORDINATE_DATA_VERSION&&n.toString()!="2.3"){throw new Error("Nonsupport version!")}var r=e.getNumber(i,t.ConstValues.A_FRAME_RATE,0)||0;var a=new t.DragonBonesData;a.name=i[t.ConstValues.A_NAME];a.isGlobal=i[t.ConstValues.A_IS_GLOBAL]=="0"?false:true;e.tempDragonBonesData=a;var o=i[t.ConstValues.ARMATURE];for(var s=0,l=o.length;s<l;s++){var h=o[s];a.addArmatureData(e.parseArmatureData(h,r))}e.tempDragonBonesData=null;return a};e.parseArmatureData=function(i,n){var r=new t.ArmatureData;r.name=i[t.ConstValues.A_NAME];var a;var o;var s=i[t.ConstValues.BONE];for(a=0,o=s.length;a<o;a++){var l=s[a];r.addBoneData(e.parseBoneData(l))}var h=i[t.ConstValues.SKIN];for(a=0,o=h.length;a<o;a++){var u=h[a];var c=u[t.ConstValues.SLOT];for(var p=0,f=c.length;p<f;p++){var m=c[p];r.addSlotData(e.parseSlotData(m))}}for(a=0,o=h.length;a<o;a++){var d=h[a];r.addSkinData(e.parseSkinData(d))}if(e.tempDragonBonesData.isGlobal){t.DBDataUtil.transformArmatureData(r)}r.sortBoneDataList();var y=i[t.ConstValues.ANIMATION];for(a=0,o=y.length;a<o;a++){var v=y[a];var g=e.parseAnimationData(v,n);t.DBDataUtil.addHideTimeline(g,r);t.DBDataUtil.transformAnimationData(g,r,e.tempDragonBonesData.isGlobal);r.addAnimationData(g)}return r};e.parseBoneData=function(i){var n=new t.BoneData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.length=Number(i[t.ConstValues.A_LENGTH])||0;n.inheritRotation=e.getBoolean(i,t.ConstValues.A_INHERIT_ROTATION,true);n.inheritScale=e.getBoolean(i,t.ConstValues.A_INHERIT_SCALE,true);e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform);if(e.tempDragonBonesData.isGlobal){n.global.copy(n.transform)}return n};e.parseSkinData=function(i){var n=new t.SkinData;n.name=i[t.ConstValues.A_NAME];var r=i[t.ConstValues.SLOT];for(var a=0,o=r.length;a<o;a++){var s=r[a];n.addSlotData(e.parseSkinSlotData(s))}return n};e.parseSkinSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=i[t.ConstValues.A_Z_ORDER];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.blendMode=i[t.ConstValues.A_BLENDMODE];var r=i[t.ConstValues.DISPLAY];if(r){for(var a=0,o=r.length;a<o;a++){var s=r[a];n.addDisplayData(e.parseDisplayData(s))}}return n};e.parseSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=i[t.ConstValues.A_Z_ORDER];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.blendMode=i[t.ConstValues.A_BLENDMODE];n.displayIndex=0;return n};e.parseDisplayData=function(i){var n=new t.DisplayData;n.name=i[t.ConstValues.A_NAME];n.type=i[t.ConstValues.A_TYPE];e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform,n.pivot);if(e.tempDragonBonesData!=null){e.tempDragonBonesData.addDisplayData(n)}return n};e.parseAnimationData=function(i,n){var r=new t.AnimationData;r.name=i[t.ConstValues.A_NAME];r.frameRate=n;r.duration=Math.round((e.getNumber(i,t.ConstValues.A_DURATION,1)||1)*1e3/n);r.playTimes=e.getNumber(i,t.ConstValues.A_LOOP,1);r.playTimes=r.playTimes!=NaN?r.playTimes:1;r.fadeTime=e.getNumber(i,t.ConstValues.A_FADE_IN_TIME,0)||0;r.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,NaN);r.autoTween=e.getBoolean(i,t.ConstValues.A_AUTO_TWEEN,true);e._currentAnimationData=r;var a=i[t.ConstValues.FRAME];var o=0;var s=0;if(a){for(o=0,s=a.length;o<s;o++){var l=a[o];var h=new t.Frame;e.parseFrame(l,h,n);r.addFrame(h)}}e.parseTimeline(i,r);var u=r.duration;var c=[];var p=[];var f=i[t.ConstValues.TIMELINE];var m;if(f){for(o=0,s=f.length;o<s;o++){var d=f[o];var y=e.parseTransformTimeline(d,r.duration,n);u=Math.min(u,y.frameList[y.frameList.length-1].duration);r.addTimeline(y);var v=e.parseSlotTimeline(d,r.duration,n);r.addSlotTimeline(v);if(r.autoTween&&!m){var g;for(var _=0,I=v.frameList.length;_<I;_++){g=v.frameList[_];if(g&&g.displayIndex<0){m=true;break}}}}var x=r.tweenEasing;if(m){s=r.slotTimelineList.length;for(o=0;o<s;o++){v=r.slotTimelineList[o];y=r.timelineList[o];var w;var S;var b;for(_=0,I=v.frameList.length;_<I;_++){S=v.frameList[_];w=y.frameList[_];b=_==I-1?v.frameList[0]:v.frameList[_+1];if(S.displayIndex<0||b.displayIndex<0){w.tweenEasing=S.tweenEasing=NaN}else if(x==10){w.tweenEasing=S.tweenEasing=0}else if(!isNaN(x)){w.tweenEasing=S.tweenEasing=x}else if(w.tweenEasing==10){w.tweenEasing=0}}}r.autoTween=false}}if(r.frameList.length>0){u=Math.min(u,r.frameList[r.frameList.length-1].duration)}r.lastFrameDuration=u;return r};e.parseSlotTimeline=function(i,n,r){var a=new t.SlotTimeline;a.name=i[t.ConstValues.A_NAME];a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.duration=n;var o=i[t.ConstValues.FRAME];for(var s=0,l=o.length;s<l;s++){var h=o[s];var u=e.parseSlotFrame(h,r);a.addFrame(u)}e.parseTimeline(i,a);return a};e.parseSlotFrame=function(i,n){var r=new t.SlotFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);r.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,e.tempDragonBonesData.isGlobal?NaN:0);var a=i[t.ConstValues.COLOR_TRANSFORM];if(a){r.color=new t.ColorTransform;e.parseColorTransform(a,r.color)}return r};e.parseTransformTimeline=function(i,n,r){var a=new t.TransformTimeline;a.name=i[t.ConstValues.A_NAME];a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.originPivot.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;a.originPivot.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0;a.duration=n;var o=false;var s=0;var l=null;var h=i[t.ConstValues.FRAME];var u;for(var c=0,p=h.length;c<p;c++){var f=h[c];if(c<p-1){u=h[c+1]}else if(c!=0){u=h[0]}else{u=null}var m=e.parseTransformFrame(f,u,r);a.addFrame(m);if(m.event||m.sound){if(!o){o=true;e._currentAnimationData.frameList.length=0}if(l){l.duration=s}else if(s!=0){l=new t.Frame;l.bone=a.name;l.duration=s;e._currentAnimationData.addFrame(l)}s=0;l=new t.Frame;l.bone=a.name;e.parseFrame(f,l,r);e._currentAnimationData.addFrame(l)}s+=m.duration}e.parseTimeline(i,a);if(l){e.parseTimeline(null,e._currentAnimationData)}return a};e.parseTransformFrame=function(i,n,r){var a=new t.TransformFrame;e.parseFrame(i,a,r);a.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);a.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);a.tweenRotate=Math.floor(e.getNumber(i,t.ConstValues.A_TWEEN_ROTATE,0)||0);a.tweenScale=e.getBoolean(i,t.ConstValues.A_TWEEN_SCALE,true);if(n&&Math.floor(e.getNumber(n,t.ConstValues.A_DISPLAY_INDEX,0)||0)==-1){a.tweenEasing=NaN}e.parseTransform(i[t.ConstValues.TRANSFORM],a.transform,a.pivot);if(e.tempDragonBonesData.isGlobal){a.global.copy(a.transform)}a.scaleOffset.x=e.getNumber(i,t.ConstValues.A_SCALE_X_OFFSET,0)||0;a.scaleOffset.y=e.getNumber(i,t.ConstValues.A_SCALE_Y_OFFSET,0)||0;return a};e.parseTimeline=function(t,e){var i=0;var n;var r=e.frameList;for(var a=0,o=r.length;a<o;a++){n=r[a];n.position=i;i+=n.duration}if(n){n.duration=e.duration-n.position}};e.parseFrame=function(e,i,n){if(n===void 0){n=0}i.duration=Math.round((e[t.ConstValues.A_DURATION]||1)*1e3/n);i.action=e[t.ConstValues.A_ACTION];i.event=e[t.ConstValues.A_EVENT];i.sound=e[t.ConstValues.A_SOUND]};e.parseTransform=function(i,n,r){if(r===void 0){r=null}if(i){if(n){n.x=e.getNumber(i,t.ConstValues.A_X,0)||0;n.y=e.getNumber(i,t.ConstValues.A_Y,0)||0;n.skewX=e.getNumber(i,t.ConstValues.A_SKEW_X,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.skewY=e.getNumber(i,t.ConstValues.A_SKEW_Y,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.scaleX=e.getNumber(i,t.ConstValues.A_SCALE_X,1)||0;n.scaleY=e.getNumber(i,t.ConstValues.A_SCALE_Y,1)||0}if(r){r.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;r.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0}}};e.parseColorTransform=function(i,n){if(i){if(n){n.alphaOffset=e.getNumber(i,t.ConstValues.A_ALPHA_OFFSET,0);n.redOffset=e.getNumber(i,t.ConstValues.A_RED_OFFSET,0);n.greenOffset=e.getNumber(i,t.ConstValues.A_GREEN_OFFSET,0);n.blueOffset=e.getNumber(i,t.ConstValues.A_BLUE_OFFSET,0);n.alphaMultiplier=e.getNumber(i,t.ConstValues.A_ALPHA_MULTIPLIER,100)*.01;n.redMultiplier=e.getNumber(i,t.ConstValues.A_RED_MULTIPLIER,100)*.01;n.greenMultiplier=e.getNumber(i,t.ConstValues.A_GREEN_MULTIPLIER,100)*.01;n.blueMultiplier=e.getNumber(i,t.ConstValues.A_BLUE_MULTIPLIER,100)*.01}}};e.getBoolean=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"0":case"NaN":case"":case"false":case"null":case"undefined":return false;case"1":case"true":default:return true}}return i};e.getNumber=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"NaN":case"":case"false":case"null":case"undefined":return NaN;default:return Number(t[e])}}return i};e._currentAnimationData=null;return e}();t.Data3Parser=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e,r=n.prototype;e.parseTextureAtlasData=function(i,n){if(n===void 0){n=1}var r={};var a;var o=i[t.ConstValues.SUB_TEXTURE];for(var s=0,l=o.length;s<l;s++){var h=o[s];var u=h[t.ConstValues.A_NAME];var c=new t.Rectangle;c.x=e.getNumber(h,t.ConstValues.A_X,0)/n;c.y=e.getNumber(h,t.ConstValues.A_Y,0)/n;c.width=e.getNumber(h,t.ConstValues.A_WIDTH,0)/n;c.height=e.getNumber(h,t.ConstValues.A_HEIGHT,0)/n;var p=h[t.ConstValues.A_ROTATED]=="true";var f=e.getNumber(h,t.ConstValues.A_FRAME_WIDTH,0)/n;var m=e.getNumber(h,t.ConstValues.A_FRAME_HEIGHT,0)/n;if(f>0&&m>0){a=new t.Rectangle;a.x=e.getNumber(h,t.ConstValues.A_FRAME_X,0)/n;a.y=e.getNumber(h,t.ConstValues.A_FRAME_Y,0)/n;a.width=f;a.height=m}else{a=null}r[u]=new t.TextureData(c,a,p)}return r};e.parseDragonBonesData=function(i){if(!i){throw new Error}var n=i[t.ConstValues.A_VERSION];n=n.toString();if(n.toString()!=t.DragonBones.DATA_VERSION&&n.toString()!=t.DragonBones.DATA_VERSION_4_5&&n.toString()!=t.DragonBones.PARENT_COORDINATE_DATA_VERSION&&n.toString()!="2.3"){throw new Error(egret.getString(4003))}else if(n.toString()==t.DragonBones.PARENT_COORDINATE_DATA_VERSION||n.toString()=="2.3"){return t.Data3Parser.parseDragonBonesData(i)}var r=e.getNumber(i,t.ConstValues.A_FRAME_RATE,0)||0;var a=new t.DragonBonesData;a.name=i[t.ConstValues.A_NAME];a.isGlobal=i[t.ConstValues.A_IS_GLOBAL]=="0"?false:true;a.version=parseFloat(n);e.tempDragonBonesData=a;var o=i[t.ConstValues.ARMATURE];for(var s=0,l=o.length;s<l;s++){var h=o[s];a.addArmatureData(e.parseArmatureData(h,r))}e.tempDragonBonesData=null;return a};e.parseArmatureData=function(i,n){var r=new t.ArmatureData;r.name=i[t.ConstValues.A_NAME];e._armatureData=r;var a=i[t.ConstValues.A_DEFAULT_ACTIONS];if(a&&a.length==1){r.defaultAnimation=a[0][t.ConstValues.A_GOTOANDPLAY]}r.frameRate=i[t.ConstValues.A_FRAME_RATE];if(isNaN(r.frameRate)||r.frameRate<=0){r.frameRate=n}n=r.frameRate;var o=i[t.ConstValues.BONE];var s;var l;e._rawBones.length=0;for(s=0,l=o.length;s<l;s++){var h=o[s];r.addBoneData(e.parseBoneData(h))}var u=i[t.ConstValues.IK];if(u){for(s=0,l=u.length;s<l;s++){var c=u[s];r.addIKData(e.parseIKData(c))}}r.sortBoneDataList();var p=i[t.ConstValues.SLOT];for(s=0,l=p.length;s<l;s++){var f=p[s];r.addSlotData(e.parseSlotData(f))}var m=i[t.ConstValues.SKIN];for(s=0,l=m.length;s<l;s++){var d=m[s];r.addSkinData(e.parseSkinData(d))}if(e.tempDragonBonesData.isGlobal){t.DBDataUtil.transformArmatureData(r)}var y=i[t.ConstValues.ANIMATION];for(s=0,l=y.length;s<l;s++){var v=y[s];var g=e.parseAnimationData(v,n);t.DBDataUtil.addHideTimeline(g,r,true);t.DBDataUtil.transformAnimationData(g,r,e.tempDragonBonesData.isGlobal);r.addAnimationData(g)}return r};e.parseBoneData=function(i){var n=new t.BoneData;e._rawBones.push(n);n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.length=Number(i[t.ConstValues.A_LENGTH])||0;n.inheritRotation=e.getBoolean(i,t.ConstValues.A_INHERIT_ROTATION,true);n.inheritScale=e.getBoolean(i,t.ConstValues.A_INHERIT_SCALE,true);e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform);if(e.tempDragonBonesData.isGlobal){n.global.copy(n.transform)}return n};e.parseIKData=function(i){var n=new t.IKData;n.name=i[t.ConstValues.A_NAME];n.target=i[t.ConstValues.A_TARGET];if(i.hasOwnProperty(t.ConstValues.A_WEIGHT)){n.weight=Number(i[t.ConstValues.A_WEIGHT])}else{n.weight=1}n.bendPositive=e.getBoolean(i,t.ConstValues.A_BENDPOSITIVE,true);if(i.hasOwnProperty(t.ConstValues.A_CHAIN)){n.chain=i[t.ConstValues.A_CHAIN]}else{n.chain=0}n.bones=i[t.ConstValues.A_BONES];return n};e.parseSkinData=function(i){var n=new t.SkinData;e._skinData=n;n.name=i[t.ConstValues.A_NAME];var r=i[t.ConstValues.SLOT];for(var a=0,o=r.length;a<o;a++){var s=r[a];n.addSlotData(e.parseSlotDisplayData(s))}return n};e.parseSlotData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];var r=i[t.ConstValues.A_ACTIONS];if(r&&r.length==1){n.gotoAndPlay=r[0][t.ConstValues.A_GOTOANDPLAY]}n.parent=i[t.ConstValues.A_PARENT];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;n.displayIndex=e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0);n.blendMode=i[t.ConstValues.A_BLENDMODE];return n};e.parseSlotDisplayData=function(i){var n=new t.SlotData;n.name=i[t.ConstValues.A_NAME];n.parent=i[t.ConstValues.A_PARENT];n.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,0)||0;e._skinSlotData=n;e._displayIndex=0;var r=i[t.ConstValues.DISPLAY];if(r){for(var a=0,o=r.length;a<o;a++){var s=r[a];n.addDisplayData(e.parseDisplayData(s));e._displayIndex++}}return n};e.parseDisplayData=function(i){var n=new t.DisplayData;if(i[t.ConstValues.A_TYPE]=="mesh"){n=e.parseMeshData(i)}else{n.name=i[t.ConstValues.A_NAME];n.type=i[t.ConstValues.A_TYPE];e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform,n.pivot);n.pivot.x=NaN;n.pivot.y=NaN;if(e.tempDragonBonesData!=null){e.tempDragonBonesData.addDisplayData(n)}}return n};e.parseMeshData=function(i){var n=new t.MeshData;n.name=i[t.ConstValues.A_NAME];n.type=i[t.ConstValues.A_TYPE];e.parseTransform(i[t.ConstValues.TRANSFORM],n.transform,n.pivot);n.pivot.x=NaN;n.pivot.y=NaN;var r=i.uvs;var a=i.triangles;var o=i.weights;var s=i.vertices;var l=i.bonePose;if(i.slotPose){n.slotPose.a=i.slotPose[0];n.slotPose.b=i.slotPose[1];n.slotPose.c=i.slotPose[2];n.slotPose.d=i.slotPose[3];n.slotPose.tx=i.slotPose[4];n.slotPose.ty=i.slotPose[5]}n.skinned=o&&o.length>0;n.numVertex=r.length/2;n.numTriangle=a.length/3;n.vertices.length=n.numVertex;n.triangles.length=n.numTriangle*3;var h=0;var u=0;var c=0;var p=0;var f=null;var m=null;var d=[];e._skinData.hasMesh=true;if(n.skinned){n.vertexBones.length=n.numVertex;if(l){for(u=0,h=l.length;u<h;u+=7){p=e._armatureData.boneDataList.indexOf(e._rawBones[l[u]]);f=new t.Matrix;f.a=l[u+1];f.b=l[u+2];f.c=l[u+3];f.d=l[u+4];f.tx=l[u+5];f.ty=l[u+6];f.invert();d[p]=f}}}for(u=0,h=r.length;u<h;u+=2){var y=u+1;var v=u*.5;var g=n.vertices[v]=new t.VertexData;g.u=Number(r[u]);g.v=Number(r[y]);g.x=Number(s[u]);g.y=Number(s[y]);if(n.skinned){var _=n.vertexBones[v]=new t.VertexBoneData;n.slotPose.transformPoint(g.x,g.y,g);for(var I=c+1,x=c+1+o[c]*2;I<x;I+=2){m=e._rawBones[o[I]];p=n.bones.indexOf(m);if(p<0){p=n.bones.length;n.bones[p]=m}var w=new t.Point(g.x,g.y);_.indices.push(p);_.weights.push(o[I+1]);_.vertices.push(w);if(n.inverseBindPose.length<=p){n.inverseBindPose.length=p+1}f=n.inverseBindPose[p];if(!f){f=d[e._armatureData.boneDataList.indexOf(m)];n.inverseBindPose[p]=f}if(f){f.transformPoint(w.x,w.y,w)}c=I+2}}}for(u=0,h=a.length;u<h;++u){n.triangles[u]=a[u]}return n};e.parseAnimationData=function(i,n){var r=new t.AnimationData;r.name=i[t.ConstValues.A_NAME];r.frameRate=n;r.duration=Math.ceil((e.getNumber(i,t.ConstValues.A_DURATION,1)||1)*1e3/n);r.playTimes=e.getNumber(i,t.ConstValues.A_PLAY_TIMES,1);r.playTimes=r.playTimes!=NaN?r.playTimes:1;r.fadeTime=e.getNumber(i,t.ConstValues.A_FADE_IN_TIME,0)||0;r.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,NaN);r.autoTween=e.getBoolean(i,t.ConstValues.A_AUTO_TWEEN,true);var a=i[t.ConstValues.FRAME];var o=0;var s=0;if(a){for(o=0,s=a.length;o<s;o++){var l=a[o];var h=e.parseTransformFrame(l,n);r.addFrame(h)}}e.parseTimeline(i,r);var u=r.duration;var c=i[t.ConstValues.BONE];if(c){for(o=0,s=c.length;o<s;o++){var p=c[o];if(p){var f=e.parseTransformTimeline(p,r.duration,n);if(f.frameList.length>0){u=Math.min(u,f.frameList[f.frameList.length-1].duration)}r.addTimeline(f)}}}var m=i[t.ConstValues.SLOT];if(m){for(o=0,s=m.length;o<s;o++){var d=m[o];if(d){var y=e.parseSlotTimeline(d,r.duration,n);if(y.frameList.length>0){u=Math.min(u,y.frameList[y.frameList.length-1].duration);r.addSlotTimeline(y)}}}}var v=i["ffd"];if(v){for(o=0,s=v.length;o<s;o++){var g=v[o];if(g){var _=e.parseFFDTimeline(g,r.duration,n);if(_.frameList.length>0){u=Math.min(u,_.frameList[_.frameList.length-1].duration);r.addFFDTimeline(_)}}}}if(r.frameList.length>0){u=Math.min(u,r.frameList[r.frameList.length-1].duration)}r.lastFrameDuration=u;return r};e.parseTransformTimeline=function(i,n,r){var a=new t.TransformTimeline;a.name=i[t.ConstValues.A_NAME];a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.originPivot.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;a.originPivot.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0;a.duration=n;var o=i[t.ConstValues.FRAME];for(var s=0,l=o.length;s<l;s++){var h=o[s];var u=e.parseTransformFrame(h,r);a.addFrame(u)}e.parseTimeline(i,a);return a};e.parseSlotTimeline=function(i,n,r){var a=new t.SlotTimeline;a.name=i[t.ConstValues.A_NAME];a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.duration=n;var o=i[t.ConstValues.FRAME];for(var s=0,l=o.length;s<l;s++){var h=o[s];var u=e.parseSlotFrame(h,r);a.addFrame(u)}e.parseTimeline(i,a);return a};e.parseFFDTimeline=function(i,n,r){var a=new t.FFDTimeline;a.skin=i[t.ConstValues.SKIN];a.name=i[t.ConstValues.SLOT];var o=e._armatureData.getSkinData(a.skin);var s=o.getSlotData(a.name);var l=s.getDisplayData(i[t.ConstValues.A_NAME]);a.displayIndex=s.displayDataList.indexOf(l);a.scale=e.getNumber(i,t.ConstValues.A_SCALE,1)||0;a.offset=e.getNumber(i,t.ConstValues.A_OFFSET,0)||0;a.duration=n;var h=new t.Point;var u=new t.Point;var c=i[t.ConstValues.FRAME];for(var p=0,f=c.length;p<f;p++){var m=c[p];var d=e.parseFFDFrame(m,r);if(l.skinned){var y=[];for(var v=0,g=l.vertices.length;v<g;++v){var _=l.vertexBones[v];if(v*2<d.offset||v*2-d.offset>=d.vertices.length){l.slotPose.transformPoint(0,0,h,true)}else{l.slotPose.transformPoint(d.vertices[v*2-d.offset],d.vertices[v*2+1-d.offset],h,true)}for(var I=0,x=_.indices.length;I<x;++I){var w=_.indices[I];l.inverseBindPose[w].transformPoint(h.x,h.y,u,true);y.push(u.x,u.y)}}d.offset=0;d.vertices=y}a.addFrame(d)}e.parseTimeline(i,a);return a};e.parseTransformFrame=function(i,n){var r=new t.TransformFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.tweenRotate=Math.floor(e.getNumber(i,t.ConstValues.A_TWEEN_ROTATE,0)||0);r.tweenScale=e.getBoolean(i,t.ConstValues.A_TWEEN_SCALE,true);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);e.parseTransform(i[t.ConstValues.TRANSFORM],r.transform,r.pivot);if(e.tempDragonBonesData.isGlobal){r.global.copy(r.transform)}r.scaleOffset.x=e.getNumber(i,t.ConstValues.A_SCALE_X_OFFSET,0)||0;r.scaleOffset.y=e.getNumber(i,t.ConstValues.A_SCALE_Y_OFFSET,0)||0;return r};e.parseSlotFrame=function(i,n){var r=new t.SlotFrame;e.parseFrame(i,r,n);r.visible=!e.getBoolean(i,t.ConstValues.A_HIDE,false);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.displayIndex=Math.floor(e.getNumber(i,t.ConstValues.A_DISPLAY_INDEX,0)||0);var a=i[t.ConstValues.A_ACTIONS];if(a&&a.length==1){r.gotoAndPlay=a[0][t.ConstValues.A_GOTOANDPLAY]}r.zOrder=e.getNumber(i,t.ConstValues.A_Z_ORDER,e.tempDragonBonesData.isGlobal?NaN:0);var o=i[t.ConstValues.COLOR];if(o){r.color=new t.ColorTransform;e.parseColorTransform(o,r.color)}return r};e.parseFFDFrame=function(i,n){var r=new t.FFDFrame;e.parseFrame(i,r,n);r.tweenEasing=e.getNumber(i,t.ConstValues.A_TWEEN_EASING,10);r.offset=i[t.ConstValues.A_OFFSET]||0;var a=i.vertices;var o=[];if(a){for(var s=0,l=a.length;s<l;s++){o.push(Number(a[s]))}}r.vertices=o;return r};e.parseTimeline=function(t,e){var i=0;var n;var r=e.frameList;for(var a=0,o=r.length;a<o;a++){n=r[a];n.position=i;i+=n.duration}if(n){n.duration=e.duration-n.position}};e.parseFrame=function(e,i,n){if(n===void 0){n=0}i.duration=Math.round((e[t.ConstValues.A_DURATION]||1)*1e3/n);i.action=e[t.ConstValues.A_ACTION];i.event=e[t.ConstValues.A_EVENT];i.sound=e[t.ConstValues.A_SOUND];var r=e[t.ConstValues.A_CURVE];if(r!=null&&r.length==4){i.curve=new t.CurveData;i.curve.pointList=[new t.Point(r[0],r[1]),new t.Point(r[2],r[3])]}};e.parseTransform=function(i,n,r){if(r===void 0){r=null}if(i){if(n){n.x=e.getNumber(i,t.ConstValues.A_X,0)||0;n.y=e.getNumber(i,t.ConstValues.A_Y,0)||0;n.skewX=e.getNumber(i,t.ConstValues.A_SKEW_X,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.skewY=e.getNumber(i,t.ConstValues.A_SKEW_Y,0)*t.ConstValues.ANGLE_TO_RADIAN||0;n.scaleX=e.getNumber(i,t.ConstValues.A_SCALE_X,1)||0;n.scaleY=e.getNumber(i,t.ConstValues.A_SCALE_Y,1)||0}if(r){r.x=e.getNumber(i,t.ConstValues.A_PIVOT_X,0)||0;r.y=e.getNumber(i,t.ConstValues.A_PIVOT_Y,0)||0}}};e.parseColorTransform=function(i,n){if(n){n.alphaOffset=e.getNumber(i,t.ConstValues.A_ALPHA_OFFSET,0);n.redOffset=e.getNumber(i,t.ConstValues.A_RED_OFFSET,0);n.greenOffset=e.getNumber(i,t.ConstValues.A_GREEN_OFFSET,0);n.blueOffset=e.getNumber(i,t.ConstValues.A_BLUE_OFFSET,0);n.alphaMultiplier=e.getNumber(i,t.ConstValues.A_ALPHA_MULTIPLIER,100)*.01;n.redMultiplier=e.getNumber(i,t.ConstValues.A_RED_MULTIPLIER,100)*.01;n.greenMultiplier=e.getNumber(i,t.ConstValues.A_GREEN_MULTIPLIER,100)*.01;n.blueMultiplier=e.getNumber(i,t.ConstValues.A_BLUE_MULTIPLIER,100)*.01}};e.getBoolean=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"0":case"NaN":case"":case"false":case"null":case"undefined":return false;case"1":case"true":default:return true}}return i};e.getNumber=function(t,e,i){if(t&&e in t){switch(String(t[e])){case"NaN":case"":case"false":case"null":case"undefined":return NaN;default:return Number(t[e])}}return i};e._rawBones=[];e._armatureData=null;e._skinData=null;e._skinSlotData=null;e._meshData=null;e._displayIndex=0;return e}();t.DataParser=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i){this.region=t;this.frame=e;this.rotated=i}var e=__define,i=t,n=i.prototype;return t}();t.TextureData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e,r=n.prototype;e.cloneColor=function(e){var i=new t.ColorTransform;i.redMultiplier=e.redMultiplier;i.greenMultiplier=e.greenMultiplier;i.blueMultiplier=e.blueMultiplier;i.alphaMultiplier=e.alphaMultiplier;i.redOffset=e.redOffset;i.greenOffset=e.greenOffset;i.blueOffset=e.blueOffset;i.alphaOffset=e.alphaOffset;return i};e.isEqual=function(t,e){return t.alphaOffset==e.alphaOffset&&t.redOffset==e.redOffset&&t.greenOffset==e.greenOffset&&t.blueOffset==e.blueOffset&&t.alphaMultiplier==e.alphaMultiplier&&t.redMultiplier==e.redMultiplier&&t.greenMultiplier==e.greenMultiplier&&t.blueMultiplier==e.blueMultiplier};e.minus=function(t,e,i){i.alphaOffset=t.alphaOffset-e.alphaOffset;i.redOffset=t.redOffset-e.redOffset;i.greenOffset=t.greenOffset-e.greenOffset;i.blueOffset=t.blueOffset-e.blueOffset;i.alphaMultiplier=t.alphaMultiplier-e.alphaMultiplier;i.redMultiplier=t.redMultiplier-e.redMultiplier;i.greenMultiplier=t.greenMultiplier-e.greenMultiplier;i.blueMultiplier=t.blueMultiplier-e.blueMultiplier};e.originalColor=new t.ColorTransform;return e}();t.ColorTransformUtil=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t,n=i.prototype;t.ANGLE_TO_RADIAN=Math.PI/180;t.RADIAN_TO_ANGLE=180/Math.PI;t.DRAGON_BONES="dragonBones";t.ARMATURE="armature";t.SKIN="skin";t.BONE="bone";t.IK="ik";t.SLOT="slot";t.DISPLAY="display";t.ANIMATION="animation";t.TIMELINE="timeline";t.FRAME="frame";t.TRANSFORM="transform";t.COLOR_TRANSFORM="colorTransform";t.COLOR="color";t.RECTANGLE="rectangle";t.ELLIPSE="ellipse";t.TEXTURE_ATLAS="TextureAtlas";t.SUB_TEXTURE="SubTexture";t.A_ROTATED="rotated";t.A_FRAME_X="frameX";t.A_FRAME_Y="frameY";t.A_FRAME_WIDTH="frameWidth";t.A_FRAME_HEIGHT="frameHeight";t.A_VERSION="version";t.A_IMAGE_PATH="imagePath";t.A_FRAME_RATE="frameRate";t.A_NAME="name";t.A_IS_GLOBAL="isGlobal";t.A_PARENT="parent";t.A_LENGTH="length";t.A_TYPE="type";t.A_FADE_IN_TIME="fadeInTime";t.A_DURATION="duration";t.A_SCALE="scale";t.A_OFFSET="offset";t.A_LOOP="loop";t.A_PLAY_TIMES="playTimes";t.A_EVENT="event";t.A_EVENT_PARAMETERS="eventParameters";t.A_SOUND="sound";t.A_ACTION="action";t.A_HIDE="hide";t.A_AUTO_TWEEN="autoTween";t.A_TWEEN_EASING="tweenEasing";t.A_TWEEN_ROTATE="tweenRotate";t.A_TWEEN_SCALE="tweenScale";t.A_DISPLAY_INDEX="displayIndex";t.A_Z_ORDER="z";t.A_BLENDMODE="blendMode";t.A_WIDTH="width";t.A_HEIGHT="height";t.A_INHERIT_SCALE="inheritScale";t.A_INHERIT_ROTATION="inheritRotation";t.A_X="x";t.A_Y="y";t.A_SKEW_X="skX";t.A_SKEW_Y="skY";t.A_SCALE_X="scX";t.A_SCALE_Y="scY";t.A_PIVOT_X="pX";t.A_PIVOT_Y="pY";t.A_ALPHA_OFFSET="aO";t.A_RED_OFFSET="rO";t.A_GREEN_OFFSET="gO";t.A_BLUE_OFFSET="bO";t.A_ALPHA_MULTIPLIER="aM";t.A_RED_MULTIPLIER="rM";t.A_GREEN_MULTIPLIER="gM";t.A_BLUE_MULTIPLIER="bM";t.A_CURVE="curve";t.A_SCALE_X_OFFSET="scXOffset";t.A_SCALE_Y_OFFSET="scYOffset";t.A_SCALE_MODE="scaleMode";t.A_FIXED_ROTATION="fixedRotation";t.A_DEFAULT_ACTIONS="defaultActions";t.A_ACTIONS="actions";t.A_GOTOANDPLAY="gotoAndPlay";t.A_TARGET="target";t.A_WEIGHT="weight";t.A_BONES="bone";t.A_BENDPOSITIVE="bendPositive";t.A_CHAIN="chain";return t}();t.ConstValues=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e,r=n.prototype;e.transformArmatureData=function(e){var i=e.boneDataList;var n=i.length;while(n--){var r=i[n];if(r.parent){var a=e.getBoneData(r.parent);if(a){r.transform.copy(r.global);t.TransformUtil.globalToLocal(r.transform,a.global)}}}};e.transformArmatureDataAnimations=function(t){var i=t.animationDataList;var n=i.length;while(n--){e.transformAnimationData(i[n],t,false)}};e.transformRelativeAnimationData=function(t,e){};e.transformAnimationData=function(i,n,r){if(!r){e.transformRelativeAnimationData(i,n);return}var a=n.getSkinData(null);var o=n.boneDataList;var s;if(a){s=a.slotDataList}for(var l=0;l<o.length;l++){var h=o[l];var u=i.getTimeline(h.name);var c=i.getSlotTimeline(h.name);if(!u&&!c){continue}var p=null;if(s){for(var f=0,m=s.length;f<m;f++){p=s[f];if(p.parent==h.name){break}}}var d=u.frameList;if(c){var y=c.frameList}var v=null;var g=null;var _=null;var I=d.length;for(var f=0;f<I;f++){var x=d[f];e.setFrameTransform(i,n,h,x);x.transform.x-=h.transform.x;x.transform.y-=h.transform.y;x.transform.skewX-=h.transform.skewX;x.transform.skewY-=h.transform.skewY;x.transform.scaleX/=h.transform.scaleX;x.transform.scaleY/=h.transform.scaleY;if(_){var w=x.transform.skewX-_.transform.skewX;if(_.tweenRotate){if(_.tweenRotate>0){if(w<0){x.transform.skewX+=Math.PI*2;x.transform.skewY+=Math.PI*2}if(_.tweenRotate>1){x.transform.skewX+=Math.PI*2*(_.tweenRotate-1);x.transform.skewY+=Math.PI*2*(_.tweenRotate-1)}}else{if(w>0){x.transform.skewX-=Math.PI*2;x.transform.skewY-=Math.PI*2}if(_.tweenRotate<1){x.transform.skewX+=Math.PI*2*(_.tweenRotate+1);x.transform.skewY+=Math.PI*2*(_.tweenRotate+1)}}}else{x.transform.skewX=_.transform.skewX+t.TransformUtil.formatRadian(x.transform.skewX-_.transform.skewX);x.transform.skewY=_.transform.skewY+t.TransformUtil.formatRadian(x.transform.skewY-_.transform.skewY);
}}_=x}if(c&&y){I=y.length;for(var f=0;f<I;f++){var S=y[f];if(!c.transformed){if(p){S.zOrder-=p.zOrder}}}c.transformed=true}u.transformed=true}};e.setFrameTransform=function(i,n,r,a){a.transform.copy(a.global);var o=n.getBoneData(r.parent);if(o){var s=i.getTimeline(o.name);if(s){var l=[];var h=[];while(s){l.push(s);h.push(o);o=n.getBoneData(o.parent);if(o){s=i.getTimeline(o.name)}else{s=null}}var u=l.length;var c;var p=new t.Matrix;var f=new t.DBTransform;var m=new t.Matrix;while(u--){s=l[u];o=h[u];e.getTimelineTransform(s,a.position,f,!c);if(!c){c=new t.DBTransform;c.copy(f)}else{f.x+=s.originTransform.x+o.transform.x;f.y+=s.originTransform.y+o.transform.y;f.skewX+=s.originTransform.skewX+o.transform.skewX;f.skewY+=s.originTransform.skewY+o.transform.skewY;f.scaleX*=s.originTransform.scaleX*o.transform.scaleX;f.scaleY*=s.originTransform.scaleY*o.transform.scaleY;t.TransformUtil.transformToMatrix(f,m);m.concat(p);t.TransformUtil.matrixToTransform(m,c,f.scaleX*c.scaleX>=0,f.scaleY*c.scaleY>=0)}t.TransformUtil.transformToMatrix(c,p)}t.TransformUtil.globalToLocal(a.transform,c)}}};e.getTimelineTransform=function(e,i,n,r){var a=e.frameList;var o=a.length;while(o--){var s=a[o];if(s.position<=i&&s.position+s.duration>i){if(o==a.length-1||i==s.position){n.copy(r?s.global:s.transform)}else{var l=s.tweenEasing;var h=(i-s.position)/s.duration;if(l&&l!=10){h=t.MathUtil.getEaseValue(h,l)}var u=a[o+1];var c=r?s.global:s.transform;var p=r?u.global:u.transform;n.x=c.x+(p.x-c.x)*h;n.y=c.y+(p.y-c.y)*h;n.skewX=t.TransformUtil.formatRadian(c.skewX+(p.skewX-c.skewX)*h);n.skewY=t.TransformUtil.formatRadian(c.skewY+(p.skewY-c.skewY)*h);n.scaleX=c.scaleX+(p.scaleX-c.scaleX)*h;n.scaleY=c.scaleY+(p.scaleY-c.scaleY)*h}break}}};e.addHideTimeline=function(t,e,i){if(i===void 0){i=false}var n=e.boneDataList;var r=e.slotDataList;var a=n.length;while(a--){var o=n[a];var s=o.name;if(!t.getTimeline(s)){if(t.hideTimelineNameMap.indexOf(s)<0){t.hideTimelineNameMap.push(s)}}}if(i){a=r.length;var l;var h;while(a--){l=r[a];h=l.name;if(!t.getSlotTimeline(h)){if(t.hideSlotTimelineNameMap.indexOf(h)<0){t.hideSlotTimelineNameMap.push(h)}}}}};return e}();t.DBDataUtil=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}var e=__define,i=t,n=i.prototype;t.getEaseValue=function(e,i){var n=1;if(i>1){n=.5*(1-t.cos(e*Math.PI));i-=1}else if(i>0){n=1-Math.pow(1-e,2)}else if(i<0){i*=-1;n=Math.pow(e,2)}return(n-e)*i+e};t.isNumber=function(t){return typeof t==="number"&&!isNaN(t)};t.sin=function(e){e*=t.RADIAN_TO_ANGLE;var i=Math.floor(e);var n=i+1;var r=t.sinInt(i);var a=t.sinInt(n);return(e-i)*a+(n-e)*r};t.sinInt=function(t){t=t%360;if(t<0){t+=360}if(t<90){return db_sin_map[t]}if(t<180){return db_sin_map[180-t]}if(t<270){return-db_sin_map[t-180]}return-db_sin_map[360-t]};t.cos=function(e){return t.sin(Math.PI/2-e)};t.ANGLE_TO_RADIAN=Math.PI/180;t.RADIAN_TO_ANGLE=180/Math.PI;return t}();t.MathUtil=e})(dragonBones||(dragonBones={}));var db_sin_map={};for(var dbMathIndex=0;dbMathIndex<=90;dbMathIndex++){db_sin_map[dbMathIndex]=Math.sin(dbMathIndex*dragonBones.MathUtil.ANGLE_TO_RADIAN)}var dragonBones;(function(t){var e=function(){function e(){}var i=__define,n=e,r=n.prototype;e.isEqual=function(t,i){if(t>=i){return t-i<=e.ACCURACY}else{return i-t<=e.ACCURACY}};e.globalToLocal=function(t,i){e.transformToMatrix(t,e._helpTransformMatrix);e.transformToMatrix(i,e._helpParentTransformMatrix);e._helpParentTransformMatrix.invert();e._helpTransformMatrix.concat(e._helpParentTransformMatrix);e.matrixToTransform(e._helpTransformMatrix,t,t.scaleX*i.scaleX>=0,t.scaleY*i.scaleY>=0)};e.transformToMatrix=function(e,i){i.a=e.scaleX*t.MathUtil.cos(e.skewY);i.b=e.scaleX*t.MathUtil.sin(e.skewY);i.c=-e.scaleY*t.MathUtil.sin(e.skewX);i.d=e.scaleY*t.MathUtil.cos(e.skewX);i.tx=e.x;i.ty=e.y};e.matrixToTransform=function(t,i,n,r){i.x=t.tx;i.y=t.ty;i.scaleX=Math.sqrt(t.a*t.a+t.b*t.b)*(n?1:-1);i.scaleY=Math.sqrt(t.d*t.d+t.c*t.c)*(r?1:-1);e.tmpSkewXArray[0]=Math.acos(t.d/i.scaleY);e.tmpSkewXArray[1]=-e.tmpSkewXArray[0];e.tmpSkewXArray[2]=Math.asin(-t.c/i.scaleY);e.tmpSkewXArray[3]=e.tmpSkewXArray[2]>=0?Math.PI-e.tmpSkewXArray[2]:e.tmpSkewXArray[2]-Math.PI;if(e.isEqual(e.tmpSkewXArray[0],e.tmpSkewXArray[2])||e.isEqual(e.tmpSkewXArray[0],e.tmpSkewXArray[3])){i.skewX=e.tmpSkewXArray[0]}else{i.skewX=e.tmpSkewXArray[1]}e.tmpSkewYArray[0]=Math.acos(t.a/i.scaleX);e.tmpSkewYArray[1]=-e.tmpSkewYArray[0];e.tmpSkewYArray[2]=Math.asin(t.b/i.scaleX);e.tmpSkewYArray[3]=e.tmpSkewYArray[2]>=0?Math.PI-e.tmpSkewYArray[2]:e.tmpSkewYArray[2]-Math.PI;if(e.isEqual(e.tmpSkewYArray[0],e.tmpSkewYArray[2])||e.isEqual(e.tmpSkewYArray[0],e.tmpSkewYArray[3])){i.skewY=e.tmpSkewYArray[0]}else{i.skewY=e.tmpSkewYArray[1]}};e.applyMatrixToPoint=function(e,i,n){if(n===void 0){n=false}this._helpMatrix.tx=e.x;this._helpMatrix.ty=e.y;this._helpMatrix.concat(i);if(n){return new t.Point(this._helpMatrix.tx,this._helpMatrix.ty)}else{e.x=this._helpMatrix.tx;e.y=this._helpMatrix.ty;return e}};e.formatRadian=function(t){if(t>Math.PI){t-=e.DOUBLE_PI}if(t<-Math.PI){t+=e.DOUBLE_PI}return t};e.normalizeRotation=function(t){t=(t+Math.PI)%(2*Math.PI);t=t>0?t:2*Math.PI+t;return t-Math.PI};e.matrixToTransformPosition=function(t,e){e.x=t.tx;e.y=t.ty};e.matrixToTransformScale=function(t,e,i,n){e.scaleX=Math.sqrt(t.a*t.a+t.b*t.b)*(i?1:-1);e.scaleY=Math.sqrt(t.d*t.d+t.c*t.c)*(n?1:-1)};e.matrixToTransformRotation=function(t,i,n,r){e.tmpSkewXArray[0]=Math.acos(t.d/r);e.tmpSkewXArray[1]=-e.tmpSkewXArray[0];e.tmpSkewXArray[2]=Math.asin(-t.c/r);e.tmpSkewXArray[3]=e.tmpSkewXArray[2]>=0?Math.PI-e.tmpSkewXArray[2]:e.tmpSkewXArray[2]-Math.PI;if(e.isEqual(e.tmpSkewXArray[0],e.tmpSkewXArray[2])||e.isEqual(e.tmpSkewXArray[0],e.tmpSkewXArray[3])){i.skewX=e.tmpSkewXArray[0]}else{i.skewX=e.tmpSkewXArray[1]}e.tmpSkewYArray[0]=Math.acos(t.a/n);e.tmpSkewYArray[1]=-e.tmpSkewYArray[0];e.tmpSkewYArray[2]=Math.asin(t.b/n);e.tmpSkewYArray[3]=e.tmpSkewYArray[2]>=0?Math.PI-e.tmpSkewYArray[2]:e.tmpSkewYArray[2]-Math.PI;if(e.isEqual(e.tmpSkewYArray[0],e.tmpSkewYArray[2])||e.isEqual(e.tmpSkewYArray[0],e.tmpSkewYArray[3])){i.skewY=e.tmpSkewYArray[0]}else{i.skewY=e.tmpSkewYArray[1]}};e.HALF_PI=Math.PI*.5;e.DOUBLE_PI=Math.PI*2;e._helpTransformMatrix=new t.Matrix;e._helpParentTransformMatrix=new t.Matrix;e.tmpSkewXArray=[];e.tmpSkewYArray=[];e.ACCURACY=1e-4;e._helpMatrix=new t.Matrix;return e}();t.TransformUtil=e})(dragonBones||(dragonBones={}));(function(t){function e(){t.BaseFactory.call(this)}__extends(e,t.BaseFactory);e.prototype._generateArmature=function(){return new t.Armature(DisplayObjectContainer.create())};e.prototype._generateSlot=function(){return new t.HolaSlot};e.prototype._generateDisplay=function(t,e,i,n){var r=t.getTexture(e);var a=Bitmap.create(e);a.setTexture(r);if(isNaN(i)||isNaN(n)){var o=t.getFrame(e);if(o!=null){i=o.width/2;n=o.height/2}else{i=a.width/2;n=a.height/2}}a.setAnchorOffset(i,n);return a};e.prototype._generateFastArmature=function(){return new t.FastArmature(DisplayObjectContainer.create())};e.prototype._generateFastSlot=function(){return new t.HolaFastSlot(Bitmap.create())};e.prototype._generateMesh=function(t,e,i,n){if(egret.Capabilities.renderMode=="webgl"){var r=new egret.Mesh;var a=r.$renderNode;r.texture=t.getTexture(e);var o=0,s=0,l=0;for(o=0,l=i.numVertex;o<l;o++){s=o*2;var h=i.vertices[o];a.uvs[s]=h.u;a.uvs[s+1]=h.v;a.vertices[s]=h.x;a.vertices[s+1]=h.y}for(o=0,l=i.triangles.length;o<l;o++){a.indices[o]=i.triangles[o]}n.isMeshEnabled=true;return r}var u=new egret.Bitmap;u.texture=t.getTexture(e);var c=t.getFrame(e);var p=0,f=0;if(c!=null){p=c.width/2;f=c.height/2}else{p=u.width/2;f=u.height/2}u.anchorOffsetX=p;u.anchorOffsetY=f;return u};t.HolaFactory=e})(dragonBones||(dragonBones={}));(function(t){function e(){t.Slot.call(this);this._holaDisplay=null}__extends(e,t.Slot);e.prototype.dispose=function(){if(this._displayList){var e=this._displayList.length;for(var i=0;i<e;i++){var n=this._displayList[i];if(n instanceof t.Armature){n.dispose()}}}t.Slot.prototype.dispose.call(this);this._holaDisplay=null};e.prototype._updateDisplay=function(t){this._holaDisplay=t};e.prototype._getDisplayIndex=function(){if(this._holaDisplay&&this._holaDisplay.parent){return this._holaDisplay.parent.getChildIndex(this._holaDisplay)}return-1};e.prototype._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}if(this._holaDisplay&&t){if(e<0){t.addChild(this._holaDisplay)}else{e=Math.min(e,t.getChildCount());t.addChildAt(this._holaDisplay,e)}}};e.prototype._removeDisplayFromContainer=function(){if(this._holaDisplay){var t=this._holaDisplay.getParent();if(t){t.removeChild(this._holaDisplay)}}};e.prototype._updateTransform=function(){if(this._holaDisplay){this._holaDisplay.setTransform(this._globalTransformMatrix)}};e.prototype._updateDisplayVisible=function(t){if(this._holaDisplay&&this._parent){this._holaDisplay.setVisible(this._parent._visible&&this._visible&&t)}};e.prototype._updateDisplayColor=function(e,i,n,r,a,o,s,l,h){if(h===void 0){h=false}t.Slot.prototype._updateDisplayColor.call(this,e,i,n,r,a,o,s,l,h);if(this._holaDisplay){this._holaDisplay.setAlpha(a)}};e.prototype._updateDisplayBlendMode=function(t){if(this._holaDisplay&&t){this._holaDisplay.setBlend(t)}};e.prototype._calculateRelativeParentTransform=function(){this._global.scaleX=this._origin.scaleX*this._offset.scaleX;this._global.scaleY=this._origin.scaleY*this._offset.scaleY;this._global.skewX=this._origin.skewX+this._offset.skewX;this._global.skewY=this._origin.skewY+this._offset.skewY;this._global.x=this._origin.x+this._offset.x+this._parent._tweenPivot.x;this._global.y=this._origin.y+this._offset.y+this._parent._tweenPivot.y;if(this._displayDataList&&this._currentDisplayIndex>=0&&this._displayDataList[this._currentDisplayIndex]&&t.HolaTextureAtlas.rotatedDic[this._displayDataList[this._currentDisplayIndex].name]==1){this._global.skewX-=1.57;this._global.skewY-=1.57}};e.prototype._updateMesh=function(){if(!this._meshData||!this.isMeshEnabled){return}var t=this._holaDisplay;var e=t.$renderNode;var i=0,n=0,r=0;var a=0,o=0;if(this._meshData.skinned){var s=this._armature.getBones(false);var l=0;for(i=0,r=this._meshData.numVertex;i<r;i++){var h=this._meshData.vertexBones[i];var u=0;var c=0;var p=0;n=i*2;a=0;o=0;for(var f=0,m=h.indices.length;f<m;++f){var d=h.indices[f];var y=this._meshBones[d];var v=y._globalTransformMatrix;var g=h.vertices[u];var _=Number(h.weights[u]);if(!this._ffdVertices||l<this._ffdOffset||l>=this._ffdVertices.length){c=g.x;p=g.y}else{c=g.x+this._ffdVertices[l];p=g.y+this._ffdVertices[l+1]}a+=(v.a*c+v.c*p+v.tx)*_;o+=(v.b*c+v.d*p+v.ty)*_;u++;l+=2}e.vertices[n]=a;e.vertices[n+1]=o}t.$updateVertices();t.$invalidateTransform()}else if(this._ffdChanged){this._ffdChanged=false;for(i=0,r=this._meshData.numVertex;i<r;++i){var I=this._meshData.vertices[i];n=i*2;if(!this._ffdVertices||n<this._ffdOffset||n>=this._ffdVertices.length){a=I.x;o=I.y}else{a=Number(I.x)+this._ffdVertices[n-this._ffdOffset];o=Number(I.y)+this._ffdVertices[n-this._ffdOffset+1]}e.vertices[n]=a;e.vertices[n+1]=o}t.$updateVertices();t.$invalidateTransform()}};t.HolaSlot=e})(dragonBones||(dragonBones={}));(function(t){function e(e){t.FastSlot.call(this,e);this._holaDisplay=null}__extends(e,t.FastSlot);e.prototype.dispose=function(){if(this._displayList){var e=this._displayList.length;for(var i=0;i<e;i++){var n=this._displayList[i];if(n instanceof t.FastArmature){n.dispose()}}}t.FastSlot.prototype.dispose.call(this);this._holaDisplay=null};e.prototype._updateDisplay=function(t){this._holaDisplay=t};e.prototype._addDisplay=function(){var t=this.armature.display;t.addChild(this._holaDisplay)};e.prototype._replaceDisplay=function(t){var e=this.armature.display;var i=t;e.addChild(this._holaDisplay);e.swapChildren(this._holaDisplay,i);e.removeChild(i)};e.prototype._removeDisplay=function(){this._holaDisplay.parent.removeChild(this._holaDisplay)};e.prototype._getDisplayIndex=function(){if(this._holaDisplay&&this._holaDisplay.parent){return this._holaDisplay.parent.getChildIndex(this._holaDisplay)}return-1};e.prototype._addDisplayToContainer=function(t,e){if(e===void 0){e=-1}if(!this._holaDisplay){this._holaDisplay=this._rawDisplay}if(this._holaDisplay&&t){if(e<0){t.addChild(this._holaDisplay)}else{e=Math.min(e,t.getChildCount());t.addChildAt(this._holaDisplay,e)}}};e.prototype._removeDisplayFromContainer=function(){if(this._holaDisplay&&this._holaDisplay.parent){this._holaDisplay.parent.removeChild(this._holaDisplay)}};e.prototype._updateTransform=function(){if(this._displayIndex>=0){this._holaDisplay.setTransform(this._globalTransformMatrix)}};e.prototype._updateDisplayVisible=function(t){if(this._holaDisplay&&this._parent){this._holaDisplay.visible=this._parent._visible&&this._visible&&t}};e.prototype._updateDisplayColor=function(e,i,n,r,a,o,s,l,h){if(h===void 0){h=false}t.FastSlot.prototype._updateDisplayColor.call(this,e,i,n,r,a,o,s,l,h);if(this._holaDisplay){this._holaDisplay.setAlpha(a)}};e.prototype._updateFrame=function(){var t=this._displayDataList.length;var e=this._displayIndex<t?this._displayIndex:t-1;var i=e<0?null:this._displayDataList[e][1];var n=this._holaDisplay;if(i){var r=i.textureAtlas;var a=this.displayDataList[this._displayIndex][0];var o=i.frame||i.region;var s=i.rotated?o.height:o.width;var l=i.rotated?o.width:o.height;var h=a.pivot.x==a.pivot.x?a.pivot.x:s*.5;var u=a.pivot.y==a.pivot.y?a.pivot.y:l*.5;if(!n.visible){n.setVisible(true)}n.setTexture(r.getTexture(a.name));n.setAnchorOffset(h,u)}else{if(n.visible){n.setVisible(false)}n.setTexture(null)}};e.prototype._updateDisplayBlendMode=function(t){if(this._holaDisplay&&t){this._holaDisplay.blendMode=t}};t.HolaFastSlot=e})(dragonBones||(dragonBones={}));function SpriteSheet(t,e){this.srcX=0;this.srcY=0;this.scale=e;this.textureMap={};this.srcTexture=t;this.srcWidth=t.width;this.srcHeight=t.height}SpriteSheet.prototype.getTexture=function(t){return this.srcTexture[t]};SpriteSheet.prototype.createTexture=function(t,e,i,n,r,a,o,s,l){var h;if(a===void 0||a==0){a=0}if(o===void 0||o==0){o=0}if(s===undefined){s=a+n}if(l===undefined){l=o+r}h=Object.create(null);h.sx=this.srcX+e;h.sy=this.srcY+i;h.sw=n*this.scale;h.sh=r*this.scale;h.dx=a;h.dy=o;h.dw=s*this.scale;h.dh=l*this.scale;h.name=t;h.texture=this.srcTexture;this.textureMap[t]=h;return h};SpriteSheet.prototype.dispose=function(){if(this.texture){this.texture.dispose()}};function HolaTextureAtlas(t,e,i){if(i===void 0){i=1}this.scale=i;this.texture=t;this.textureDatas={};this.textureAtlasRawData=e;this.name=e[dragonBones.ConstValues.A_NAME];this.parseData(e);this.spriteSheet=new SpriteSheet(t,i)}HolaTextureAtlas.prototype.parseData=function(t){this.textureDatas=dragonBones.DataParser.parseTextureAtlasData(t,this.scale)};HolaTextureAtlas.prototype.getTexture=function(t){var e=this.spriteSheet.getTexture(t);if(!e){var i=this.textureDatas[t];if(i){var n=i.frame;if(n){e=this.spriteSheet.createTexture(t,i.region.x,i.region.y,i.region.width,i.region.height,-n.x,-n.y,n.width,n.height)}else{e=this.spriteSheet.createTexture(t,i.region.x,i.region.y,i.region.width,i.region.height)}if(i.rotated){HolaTextureAtlas.rotatedDic[t]=1}}}return e};HolaTextureAtlas.prototype.dispose=function(){this.texture=null};HolaTextureAtlas.prototype.getRegion=function(t){var e=this.textureDatas[t];if(e&&e instanceof dragonBones.TextureData){return e.region}return null};HolaTextureAtlas.prototype.getFrame=function(t){var e=this.textureDatas[t];if(e&&e instanceof dragonBones.TextureData){return e.frame}return null};HolaTextureAtlas.prototype.getTextureData=function(t){return this.textureDatas[t]};HolaTextureAtlas.rotatedDic={};dragonBones=dragonBones||{};dragonBones.HolaTextureAtlas=HolaTextureAtlas;function UIDragonBones(){return}UIDragonBones.prototype=new UISkeletonAnimation;UIDragonBones.prototype.isUIDragonBones=true;UIDragonBones.prototype.initUIDragonBones=UISkeletonAnimation.prototype.initUISkeletonAnimation;UIDragonBones.prototype.pause=function(){if(this.armature){this.armature.animation.stop()}return this};UIDragonBones.prototype.resume=function(){if(this.armature){this.armature.animation.play()}return this};UIDragonBones.prototype.getEnableCache=function(){return!!this.enableCache};UIDragonBones.prototype.setEnableCache=function(t){this.enableCache=t;return this};UIDragonBones.prototype.setupLoop=function(t,e,i,n){var r=this;function a(t){if(!t||!t.animationState||t.armature!==r._armature){return}if(r.onOneCycle){try{r.onOneCycle()}catch(t){console.debug("onOneCycle:",t)}}}function o(){if(r.onDone){try{r.onDone()}catch(t){console.debug("onDone:",t)}}}if(!isNaN(e)){this.onDone=i;this.onOneCycle=n;this._armature.addEventListener(dragonBones.AnimationEvent.COMPLETE,o);this._armature.addEventListener(dragonBones.AnimationEvent.LOOP_COMPLETE,a)}};UIDragonBones.prototype.doPlay=UIDragonBones.prototype.gotoAndPlay=function(t,e,i,n,r,a){this.animationName=t;if(this.armature){var o=this.armature;if(t&&o.animation.animationList.indexOf(t)>=0){if(i||n||e){e=isNaN(e)?Number.MAX_VALUE:e;this.setupLoop.apply(o.animation,arguments)}var s=!r?0:undefined;o.animation.gotoAndPlay(t,s,a,e)}else if(this.animations&&t){this.animate(t)}else{console.log("Unknow animation name: "+t)}}return this};UIDragonBones.prototype.destroyArmature=function(){if(this.armature){this.armature=null}return};UISkeletonAnimation.prototype.destroy=function(){this.destroyArmature();UIElement.prototype.destroy.call(this);return};UISkeletonAnimation.prototype.getSlotRect=function(t){if(!this.armature){return null}var e=this.armature._slotList;for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t){var r=n.getDisplay();return r.textureAtlasRect}}return null};UISkeletonAnimation.prototype.replaceSlotImage=function(t,e,i){if(!this.armature){return this}if(i&&i.w){i.width=i.w}if(i&&i.h){i.height=i.h}var n=this.armature._slotList;for(var r=0;r<n.length;r++){var a=n[r];if(a.name===t){a.image=e;a.imageRect=i}}return};UIDragonBones.prototype.advanceTime=function(){var t=this;var e=this.armature;e.advanceTime=function(){if(t.isVisible()){dragonBones.Armature.prototype.advanceTime.apply(this,arguments)}};return this};UIDragonBones.prototype.createArmature=function(t,e,i){if(this.armature){this.armature=null}var n=null;if(!MainContext.instance.factory){n=new dragonBones.HolaFactory;MainContext.instance.factory=n}else{n=MainContext.instance.factory}if(!n.getSkeletonData(i.name)){n.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(i))}if(!n.getTextureAtlas(e.name)){n.addTextureAtlas(new dragonBones.HolaTextureAtlas(t,e))}if(this.enableCache){var r=n.buildFastArmature(i.armature[0].name,i.name);r.enableAnimationCache(24)}else{var r=n.buildArmature(i.armature[0].name,i.name)}this.armature=r;this.animationNames=r.animation.animationList;this.animationName=this.animationNames.indexOf(this.animationName)>-1?this.animationName:this.animationNames[0]};UIDragonBones.prototype.getDuration=UIDragonBones.prototype.getAnimationDuration=function(t){if(!this.armature)return 0;t=t||this.animationName;var e=this.armature.animation.animationList.indexOf(t);if(e>-1){return this.armature.animation.animationDataList[e].duration}return 0};UIDragonBones.prototype.paintSelfOnly=function(t){if(this.armature){if(!this.isPaused()){var e=t.timeStep*this.animTimeScale/1e3;this.armature.advanceTime(e)}var i=this.w>>1;var n=this.h>>1;t.save();var r=this.animationScaleX===1?1.01:this.animationScaleX;var a=this.animationScaleY===1?1.01:this.animationScaleY;MainContext.instance.setObjectContainer(this.armature.display);MainContext.instance.setScale(r,a);MainContext.instance.setPosition(i,n);MainContext.instance.renderLoop(t);t.restore();t.needRedraw++}return};function UISkeletonAnimationCreator(t){var e=[t,t,null,1];ShapeCreator.apply(this,e);this.createShape=function(t){var e=new UIDragonBones;return e.initUIDragonBones(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISkeletonAnimationCreator("ui-dragonbones"));ShapeFactoryGet().addShapeCreator(new UISkeletonAnimationCreator("ui-skeleton-animation"));function UIParticlesX(){return}UIParticlesX.prototype=new UIElement;UIParticlesX.prototype.isUIParticlesX=true;UIParticlesX.prototype.saveProps=["dataURL","textureURL"];UIParticlesX.prototype.initUIParticlesX=function(t){this.initUIElement(t);this.name="ui-particles";this.autoEmit=true;this.paused=false;this.setDefSize(200,200);this.setTextType(Shape.TEXT_NONE);this.setImage(UIElement.IMAGE_DEFAULT,null);this.images.display=UIElement.IMAGE_DISPLAY_CENTER;return this};UIParticlesX.prototype.setEmitterPosition=function(t,e){return this};UIParticlesX.prototype.onFromJsonDone=function(){return this};UIParticlesX.prototype.emit=function(t){this.particles.emit(t);return this};UIParticlesX.prototype.start=function(){this.particles.reset();return this};UIParticlesX.prototype.stop=function(){this.particles.stop();return this};UIParticlesX.prototype.pause=function(){this.paused=true;return this};UIParticlesX.prototype.resume=function(){this.paused=false;return this};UIParticlesX.prototype.loadPList=function(t,e){this.particles=new ParticleEmitter;this.particles.init(t);this.particles.setTexture(e);return};UIParticlesX.prototype.onInit=function(){var t=this;var e=null;if(this.dataURL){ResLoader.loadData(this.dataURL,function(i){try{e=JSON.parse(i)}catch(n){var r=new PList;e=r.parse(i);if(e.textureFileName){t.textureURL=t.dataURL.substring(0,t.dataURL.lastIndexOf("/")+1)+e.textureFileName}}delete t.particles;var a=e.imageData||t.textureURL;if(a){ResLoader.loadImage(a,function(i){if(i.width===0||i.height===0){console.debug("particlesx invalid img");return}t.loadPList(e,i)})}})}return};UIParticlesX.prototype.drawBgImage=function(){return};UIParticlesX.prototype.setDataURL=function(t){if(t===this.dataURL||!t)return;this.dataURL=t;if(/\.json$/.test(t)){this.saveProps=["dataURL"]}else{this.textureURL=t.substring(0,t.lastIndexOf(".")+1)+"png"}this.onInit()};UIParticlesX.prototype.getDataURL=function(){return this.dataURL};UIParticlesX.prototype.drawParticle=function(t){var e=this.timeScaleIsZero()||this.paused||this.isInDesignMode()&&this.disablePreview;if(!e){this.particles.update(t.timeStep/1e3)}this.particles.setScaleX(this.scaleX);this.particles.setScaleY(this.scaleY);this.particles.draw(t)};UIParticlesX.prototype.paintSelfOnly=function(t){if(this.particles){t.needRedraw++;t.save();t.translate(this.w/2,this.h/2);this.drawParticle(t);t.restore()}return};UIParticlesX.prototype.shapeCanBeChild=function(t){return false};function UIParticlesXCreator(){var t=["ui-particles-x","ui-particles-x",null,1];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UIParticlesX;return e.initUIParticlesX(this.type)};return}ShapeFactoryGet().addShapeCreator(new UIParticlesXCreator);void function(){function t(t,e){t.x*=e;t.y*=e}function e(t,e){t.x=e.x;t.y=e.y}function i(t,e){t.x+=e.x;t.y+=e.y}function n(t,e){t.x-=e.x;t.y-=e.y}function r(e){t(e,1/Math.sqrt(e.x*e.x+e.y*e.y))}function a(t){t.x=0;t.y=0}function o(t,e){if(!(this instanceof o)){return new o(t,e)}this.x=t;this.y=e}function s(t,e,i,n){if(!(this instanceof s)){return new s(t,e,i,n)}this.r=t;this.g=e;this.b=i;this.a=n}function l(t,e,i,n){if(!(this instanceof l)){return new l(t,e,i,n)}this.x=t;this.y=e;this.w=i;this.h=n}function h(t,e){var i=t.x,n=t.y,r=e.a,a=e.b,o=e.c,s=e.d,l=e.tx,h=e.ty;return{x:r*i+o*n+l,y:a*i+s*n+h}}var u=Math.PI/180;function c(t){return u*t}function p(){return(Math.random()-.5)*2}function f(t,e,i){if(e>i){var n=e;e=i;i=e}return t<e?e:t>i?i:t}var m=1;var d=770;var y=771;function v(){this.pos=o(0,0);this.startPos=o(0,0);this.drawPos=o(0,0);this.color=s(0,0,0,255);this.deltaColor=s(0,0,0,255);this.modeA=new v.ParamsGravity;this.modeB=new v.ParamsRadius;this.size=0;this.deltaSize=0;this.rotation=0;this.deltaRotation=0;this.timeToLive=0;this.isChangeColor=false}v.TemporaryPoints=[o(0,0),o(0,0),o(0,0),o(0,0)];v.ModeGravity=function(t,e,i,n,r,a,o,s,l){this.speed=t;this.speedVar=e;this.gravity={x:i,y:n};this.radialAccel=r;this.radialAccelVar=a;this.tangentialAccel=o;this.tangentialAccelVar=s;this.rotationIsDir=l};v.ModeGravity.prototype.randomFeatures=function(e,i){var n=i.modeA;var r=this.speed+this.speedVar*p();n.dir.x=Math.cos(e);n.dir.y=Math.sin(e);t(n.dir,r);n.radialAccel=this.radialAccel+this.radialAccelVar*p();n.tangentialAccel=this.tangentialAccel+this.tangentialAccelVar*p()};v.ParamsGravity=function(t,e,i){this.dir=t||o(0,0);this.radialAccel=e;this.tangentialAccel=i};v.ModeRadius=function(t,e,i,n,r,a){this.startRadius=t;this.startRadiusVar=e;this.endRadius=i;this.endRadiusVar=n;this.rotatePerSecond=r;this.rotatePerSecondVar=a};v.ModeRadius.prototype.randomFeatures=function(t,e){var i=e.modeB;var n=this.startRadius+this.startRadiusVar*p();var r=this.endRadius+this.endRadiusVar*p();i.angle=t;i.radius=n;i.deltaRadius=(r-n)/e.timeToLive;i.anglePerSecond=c(this.rotatePerSecond+this.rotatePerSecondVar*p())};v.ParamsRadius=function(t,e,i,n){this.angle=t;this.radius=i||0;this.deltaRadius=n||0;this.anglePerSecond=e||0};function g(t){this.emitMode=0;this.duration=0;this.emitRate=0;this.timeCounter=0;this.srcPos=o(0,0);this.srcPosVar=o(0,0);this.angle=0;this.angleVar=0;this.maxParticles=0;this.isRemoveOnFinish=false;this.particles=[];this.particleCounter=0;this.positionType=g.POS_TYPE_FREE;this.srcBlendFunc=0;this.dstBlendFunc=0;this.life=0;this.lifeVar=0;this.startSize=0;this.startSizeVar=0;this.endSize=0;this.endSizeVar=0;this.startColor=s(0,0,0,0);this.startColorVar=s(0,0,0,0);this.endColor=s(0,0,0,0);this.endColorVar=s(0,0,0,0);this.startSpin=0;this.startSpinVar=0;this.endSpin=0;this.endSpinVar=0;this.tmpZeroPoint=o(0,0);this.elapsed=0;this.timeScale=1;this.active=true;this.texture=null;this.scaleX=1;this.scaleY=1;this.transform={a:1,b:0,c:0,d:1,tx:0,ty:0};this.worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};this.anchorPointInPoints=o(0,0)}g.POS_TYPE_FREE=0;g.POS_TYPE_RELATIVE=1;g.POS_TYPE_GROUPED=2;g.MODE_GRAVITY=0;g.MODE_RADIUS=1;g.MODE_WIND=2;function _(t,e,i){return t[e]!=void 0?t[e]:i}function I(t,e){var i=t.width;var n=t.height;e[0].width=i;e[0].height=n;e[1].width=i;e[1].height=n;e[2].width=i;e[2].height=n;e[3].width=i;e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);var a=r.getImageData(0,0,i,n).data;var o;for(var s=0;s<4;s++){o=e[s].getContext("2d");var l=o.getImageData(0,0,i,n);var h=l.data;for(var u=0;u<a.length;u+=4){h[u]=s===0?a[u]:0;h[u+1]=s===1?a[u+1]:0;h[u+2]=s===2?a[u+2]:0;h[u+3]=a[u+3]}o.putImageData(l,0,0)}t.onload=null}g.prototype.parseModeGravity=function(t){return new v.ModeGravity(parseFloat(_(t,"speed")),parseFloat(_(t,"speedVariance")),parseFloat(_(t,"gravityx")),parseFloat(_(t,"gravityy")),parseFloat(_(t,"radialAcceleration")),parseFloat(_(t,"radialAccelVariance")),parseFloat(_(t,"tangentialAcceleration")),parseFloat(_(t,"tangentialAccelVariance")),_(t,"rotationIsDir",false))};g.prototype.parseModeRadius=function(t){return new v.ModeRadius(parseFloat(_(t,"maxRadius")),parseFloat(_(t,"maxRadiusVariance")),parseFloat(_(t,"minRadius")),0,parseFloat(_(t,"rotatePerSecond")),parseFloat(_(t,"rotatePerSecondVariance")))};g.prototype.init=function(t){this.maxParticles=parseInt(_(t,"maxParticles",0));for(var e=0;e<this.maxParticles;e++){this.particles.push(new v)}this.angle=parseInt(_(t,"angle",0));this.angleVar=parseInt(_(t,"angleVariance",0));this.duration=parseInt(_(t,"duration",0));this.backDuration=this.duration;this.srcBlendFunc=parseInt(_(t,"blendFuncSource",0));this.dstBlendFunc=parseInt(_(t,"blendFuncDestination",0));this.startColor.r=parseFloat(_(t,"startColorRed"))*255;this.startColor.g=parseFloat(_(t,"startColorGreen"))*255;this.startColor.b=parseFloat(_(t,"startColorBlue"))*255;this.startColor.a=parseFloat(_(t,"startColorAlpha"))*255;this.startColorVar.r=parseFloat(_(t,"startColorVarianceRed"))*255;this.startColorVar.g=parseFloat(_(t,"startColorVarianceGreen"))*255;this.startColorVar.b=parseFloat(_(t,"startColorVarianceBlue"))*255;this.startColorVar.a=parseFloat(_(t,"startColorVarianceAlpha"))*255;this.endColor.r=parseFloat(_(t,"finishColorRed"))*255;this.endColor.g=parseFloat(_(t,"finishColorGreen"))*255;this.endColor.b=parseFloat(_(t,"finishColorBlue"))*255;this.endColor.a=parseFloat(_(t,"finishColorAlpha"))*255;this.endColorVar.r=parseFloat(_(t,"finishColorVarianceRed"))*255;this.endColorVar.g=parseFloat(_(t,"finishColorVarianceGreen"))*255;this.endColorVar.b=parseFloat(_(t,"finishColorVarianceBlue"))*255;this.endColorVar.a=parseFloat(_(t,"finishColorVarianceAlpha"))*255;this.startSize=parseFloat(_(t,"startParticleSize"));this.startSizeVar=parseFloat(_(t,"startParticleSizeVariance"));this.endSize=parseFloat(_(t,"finishParticleSize"));this.endSizeVar=parseFloat(_(t,"finishParticleSizeVariance"));this.srcPos.x=parseFloat(_(t,"sourcePositionx"));this.srcPos.y=parseFloat(_(t,"sourcePositiony"));this.srcPosVar.x=parseFloat(_(t,"sourcePositionVariancex"));this.srcPosVar.y=parseFloat(_(t,"sourcePositionVariancey"));this.startSpin=parseFloat(_(t,"rotationStart"));this.startSpinVar=parseFloat(_(t,"rotationStartVariance"));this.endSpin=parseFloat(_(t,"rotationEnd"));this.endSpinVar=parseFloat(_(t,"rotationEndVariance"));this.life=parseFloat(_(t,"particleLifespan"));this.lifeVar=parseFloat(_(t,"particleLifespanVariance"));this.emitRate=this.maxParticles/this.life;this.isRemoveOnFinish=_(t,"isAutoRemoveOnFinish",false);this.emitMode=parseFloat(_(t,"emitterType"));this.imageData=_(t,"imageData",null)||_(t,"textureImageData",null);if(this.imageData){var i=new Image;i.src=this.imageData;this.setTexture(i)}if(this.emitMode===g.MODE_GRAVITY){this.mode=this.parseModeGravity(t)}else{this.mode=this.parseModeRadius(t)}};g.prototype.setScaleX=function(t){this.scaleX=t;return this};g.prototype.setScaleY=function(t){this.scaleY=t;return this};g.prototype.emit=function(t){this.reset();if(t){if("backDuration"in this){this.duration=this.backDuration}if(this.duration===-1){this.duration=1}}else{if("backDuration"in this){this.backDuration=this.duration}this.duration=-1}};g.prototype.reset=function(){this.active=true;this.elapsed=0;if("backDuration"in this){this.duration=this.backDuration}var t=this.particles;for(var e=0;e<t.length;e++){t[e].timeToLive=0}};g.prototype.reload=function(t){this.stop();this.init(t);this.start()};g.prototype.pause=function(){this.timeScale=0;return this};g.prototype.resume=function(){this.timeScale=1;return this};g.prototype.start=function(){this.reset();return this};g.prototype.stop=function(){if("backDuration"in this){this.duration=this.backDuration}this.active=false;this.elapsed=this.duration;this.timeCounter=0;return this};g.prototype.setTexture=function(t){if(t===this.texture)return;this.texture=t;this.textureRect=l(0,0,t.width,t.height);return this};g.prototype.getWorldTransform=function(){var t=this.transform;var e=1,i=0,n=0,r=1;t.tx=this.srcPos.x;t.ty=this.srcPos.y;t.a=e;t.b=i;t.c=n;t.d=r;var a=this.scaleX,o=this.scaleY;var s=this.anchorPointInPoints.x,l=this.anchorPointInPoints.y;a=a<1e-6&&a>-1e-6?1e-6:a;o=o<1e-6&&o>-1e-6?1e-6:o;if(a!==1||o!==1){e=t.a*=a;i=t.b*=a;n=t.c*=o;r=t.d*=o}t.tx-=e*s+n*l;t.ty-=i*s+r*l;return this.transform};g.prototype.convertToWorldSpace=function(t){return h(t,this.getWorldTransform())};g.prototype.initParticle=function(t){t.timeToLive=this.life+this.lifeVar*p();t.timeToLive=Math.max(0,t.timeToLive);t.pos.x=this.srcPosVar.x*p();t.pos.y=this.srcPosVar.y*p();var e={r:f(this.startColor.r+this.startColorVar.r*p(),0,255),g:f(this.startColor.g+this.startColorVar.g*p(),0,255),b:f(this.startColor.b+this.startColorVar.b*p(),0,255),a:f(this.startColor.a+this.startColorVar.a*p(),0,255)};var i={r:f(this.endColor.r+this.endColorVar.r*p(),0,255),g:f(this.endColor.g+this.endColorVar.g*p(),0,255),b:f(this.endColor.b+this.endColorVar.b*p(),0,255),a:f(this.endColor.a+this.endColorVar.a*p(),0,255)};t.color=e;t.deltaColor={r:(i.r-e.r)/t.timeToLive,g:(i.g-e.g)/t.timeToLive,b:(i.b-e.b)/t.timeToLive,a:(i.a-e.a)/t.timeToLive};var n=this.startSize+this.startSizeVar*p();var r=this.endSize+this.endSizeVar*p();t.size=Math.max(0,n);t.deltaSize=(r-n)/t.timeToLive;
var a=this.startSpin+this.startSpinVar*p();var o=this.endSpin+this.endSpinVar*p();t.rotation=a;t.deltaRotation=(o-a)/t.timeToLive;if(this.positionType===g.POS_TYPE_FREE){t.startPos=this.convertToWorldSpace(this.tmpZeroPoint)}else if(this.positionType===g.POS_TYPE_RELATIVE){t.startPos.x=this.srcPos.x;t.startPos.y=this.srcPos.y}var s=c(this.angle+this.angleVar*p());this.mode.randomFeatures(s,t)};g.prototype.isFull=function(){return this.particleCounter>=this.maxParticles};g.prototype.addParticle=function(){if(!this.isFull()){var t=null;if(this.particleCounter<this.particles.length){t=this.particles[this.particleCounter]}else{t=new v;this.particles.push(t)}this.initParticle(t);++this.particleCounter}};g.prototype.updateParticles=function(o){var s=v.TemporaryPoints[0];if(this.positionType===g.POS_TYPE_FREE){e(s,this.convertToWorldSpace(this.tmpZeroPoint))}else if(this.positionType===g.TYPE_RELATIVE){s.x=this.srcPos.x;s.y=this.srcPos.y}var l=null,h=0,u=this.particles,c=v.TemporaryPoints[1],p=v.TemporaryPoints[2],f=v.TemporaryPoints[3];while(h<this.particleCounter){a(c);a(p);a(f);l=u[h];l.timeToLive-=o;if(l.timeToLive>0){if(this.emitMode===g.MODE_GRAVITY){var m=f,d=c,y=p;if(l.pos.x||l.pos.y){e(d,l.pos);r(d)}else{a(d)}e(y,d);t(d,l.modeA.radialAccel);var _=y.x;y.x=-y.y;y.y=_;t(y,l.modeA.tangentialAccel);e(m,d);i(m,y);i(m,this.mode.gravity);t(m,o);i(l.modeA.dir,m);e(m,l.modeA.dir);t(m,o);i(l.pos,m)}else{var I=l.modeB;I.angle+=I.anglePerSecond*o;I.radius+=I.deltaRadius*o;l.pos.x=-Math.cos(I.angle)*I.radius;l.pos.y=-Math.sin(I.angle)*I.radius}l.color.r+=l.deltaColor.r*o;l.color.g+=l.deltaColor.g*o;l.color.b+=l.deltaColor.b*o;l.color.a+=l.deltaColor.a*o;l.isChangeColor=false;l.size+=l.deltaSize*o;l.size=Math.max(0,l.size);l.rotation+=l.deltaRotation*o;var x=c;if(this.positionType===g.POS_TYPE_FREE||this.positionType===g.POS_TYPE_RELATIVE){var w=p;e(w,s);n(w,l.startPos);e(x,l.pos);n(x,w)}else{e(x,l.pos)}e(l.drawPos,x);++h}else{if(h!==this.particleCounter-1){var S=u[h]=u[this.particleCounter-1];u[this.particleCounter-1]=l}--this.particleCounter}}return};g.prototype.update=function(t){var e=1/this.emitRate;t*=this.timeScale;if(this.active){if(this.particleCounter<this.maxParticles){this.timeCounter+=t}while(this.particleCounter<this.maxParticles&&this.timeCounter>e){this.addParticle();this.timeCounter-=e}this.elapsed+=t;if(this.duration!==-1&&this.duration<=this.elapsed){this.stop()}}this.updateParticles(t)};g.prototype.setTransform=function(t,e){t.transform(e.a,-e.b,-e.c,e.d,e.tx*this.scaleX,-(e.ty*this.scaleY))};g.prototype.isBlendAdditive=function(){return this.srcBlendFunc===d&&this.dstBlendFunc===m||this.srcBlendFunc===m&&this.dstBlendFunc===m};g.prototype.changeTextureColor=function(t,e,i){if(!this.tintCache){this.tintCache=document.createElement("canvas")}var n=this.tintCache;var r=n.getContext("2d");n.width=t.width;n.height=t.height;r.globalCompositeOperation="source-over";r.fillStyle="rgb("+(e.r|0)+","+(e.g|0)+","+(e.b|0)+")";r.fillRect(0,0,i.w,i.h);r.globalCompositeOperation="multiply";r.drawImage(t,i.x,i.y,i.w,i.h,0,0,i.w,i.h);r.globalCompositeOperation="destination-atop";r.drawImage(t,i.x,i.y,i.w,i.h,0,0,i.w,i.h);return n};g.prototype.draw=function(t){var e=this.texture,i=this.particles,n=this.textureRect,r=this.particleCounter;t.save();this.setTransform(t,this.worldTransform);if(this.isBlendAdditive()){t.globalCompositeOperation="lighter"}else{t.globalCompositeOperation="source-over"}var a,o,s,l,h=n.w,u=n.h;for(var p=0;p<r;p++){a=i[p];o=0|a.size*.5;s=a.color.a/255;if(s===0)continue;t.globalAlpha=s;t.save();t.translate(0|a.drawPos.x,-(0|a.drawPos.y));l=Math.floor(a.size/4)*4;t.scale(Math.max(1/h*l,1e-6),Math.max(1/u*l,1e-6));if(a.rotation){t.rotate(c(a.rotation))}var f=a.isChangeColor?this.changeTextureColor(e,a.color,n):e;t.drawImage(f,-(0|h/2),-(0|u/2));t.restore()}t.restore()};window.ParticleEmitter=g}();(function t(e,i,n){function r(o,s){if(!i[o]){if(!e[o]){var l=typeof require=="function"&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return r(i?i:t)},u,u.exports,t,e,i,n)}return i[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<n.length;o++)r(n[o]);return r})({1:[function(t,e,i){(function(i){e.exports=spine={Spine:t("./Spine"),SpineRuntime:t("./SpineRuntime"),mesh:t("./mesh/"),Texture:t("./texture/Texture.js"),BaseTexture:t("./texture/BaseTexture.js"),Sprite:t("./sprites/Sprite.js"),Container:t("./display/Container.js"),CanvasRenderer:t("./renderers/canvas/CanvasRenderer.js")};i.PIXI={VERSION:"3.0.11"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Spine":3,"./SpineRuntime":45,"./display/Container.js":54,"./mesh/":59,"./renderers/canvas/CanvasRenderer.js":61,"./sprites/Sprite.js":63,"./texture/BaseTexture.js":64,"./texture/Texture.js":65}],2:[function(t,e,i){"use strict";var n=Object.prototype.hasOwnProperty;var r=typeof Object.create!=="function"?"~":false;function a(t,e,i){this.fn=t;this.context=e;this.once=i||false}function o(){}o.prototype._events=undefined;o.prototype.eventNames=function s(){var t=this._events,e=[],i;if(!t)return e;for(i in t){if(n.call(t,i))e.push(r?i.slice(1):i)}if(Object.getOwnPropertySymbols){return e.concat(Object.getOwnPropertySymbols(t))}return e};o.prototype.listeners=function l(t,e){var i=r?r+t:t,n=this._events&&this._events[i];if(e)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var a=0,o=n.length,s=new Array(o);a<o;a++){s[a]=n[a].fn}return s};o.prototype.emit=function h(t,e,i,n,a,o){var s=r?r+t:t;if(!this._events||!this._events[s])return false;var l=this._events[s],h=arguments.length,u,c;if("function"===typeof l.fn){if(l.once)this.removeListener(t,l.fn,undefined,true);switch(h){case 1:return l.fn.call(l.context),true;case 2:return l.fn.call(l.context,e),true;case 3:return l.fn.call(l.context,e,i),true;case 4:return l.fn.call(l.context,e,i,n),true;case 5:return l.fn.call(l.context,e,i,n,a),true;case 6:return l.fn.call(l.context,e,i,n,a,o),true}for(c=1,u=new Array(h-1);c<h;c++){u[c-1]=arguments[c]}l.fn.apply(l.context,u)}else{var p=l.length,f;for(c=0;c<p;c++){if(l[c].once)this.removeListener(t,l[c].fn,undefined,true);switch(h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++){u[f-1]=arguments[f]}l[c].fn.apply(l[c].context,u)}}}return true};o.prototype.on=function u(t,e,i){var n=new a(e,i||this),o=r?r+t:t;if(!this._events)this._events=r?{}:Object.create(null);if(!this._events[o])this._events[o]=n;else{if(!this._events[o].fn)this._events[o].push(n);else this._events[o]=[this._events[o],n]}return this};o.prototype.once=function c(t,e,i){var n=new a(e,i||this,true),o=r?r+t:t;if(!this._events)this._events=r?{}:Object.create(null);if(!this._events[o])this._events[o]=n;else{if(!this._events[o].fn)this._events[o].push(n);else this._events[o]=[this._events[o],n]}return this};o.prototype.removeListener=function p(t,e,i,n){var a=r?r+t:t;if(!this._events||!this._events[a])return this;var o=this._events[a],s=[];if(e){if(o.fn){if(o.fn!==e||n&&!o.once||i&&o.context!==i){s.push(o)}}else{for(var l=0,h=o.length;l<h;l++){if(o[l].fn!==e||n&&!o[l].once||i&&o[l].context!==i){s.push(o[l])}}}}if(s.length){this._events[a]=s.length===1?s[0]:s}else{delete this._events[a]}return this};o.prototype.removeAllListeners=function f(t){if(!this._events)return this;if(t)delete this._events[r?r+t:t];else this._events=r?{}:Object.create(null);return this};o.prototype.off=o.prototype.removeListener;o.prototype.addListener=o.prototype.on;o.prototype.setMaxListeners=function m(){return this};o.prefixed=r;if("undefined"!==typeof e){e.exports=o}},{}],3:[function(t,e,i){var n=t("../SpineRuntime");var r=t("../mesh/");var a=t("../SpineUtil/Matrix.js");var o=t("../utils.js");var s=t("../sprites/Sprite.js");var l=t("../texture/Texture.js");var h=t("../display/Container.js");n.Bone.yDown=true;function u(t){h.call(this);if(!t){throw new Error("The spineData param is required.")}if(typeof t==="string"){throw new Error('spineData param cant be string. Please use PIXI.spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.')}this.spineData=t;this.skeleton=new n.Skeleton(t);this.skeleton.updateWorldTransform();this.stateData=new n.AnimationStateData(t);this.state=new n.AnimationState(this.stateData);this.slotContainers=[];for(var e=0,i=this.skeleton.slots.length;e<i;e++){var r=this.skeleton.slots[e];var a=r.attachment;var o=new h;this.slotContainers.push(o);this.addChild(o);if(a instanceof n.RegionAttachment){var s=a.rendererObject.name;var l=this.createSprite(r,a);r.currentSprite=l;r.currentSpriteName=s;o.addChild(l)}else if(a instanceof n.MeshAttachment){var u=this.createMesh(r,a);r.currentMesh=u;r.currentMeshName=a.name;o.addChild(u)}else{continue}}this.autoUpdate=true}u.fromAtlas=function(t){var e=atlasParser.AnimCache[t];if(!e){throw new Error('Spine data "'+t+'" does not exist in the animation cache')}return new u(e)};u.prototype=Object.create(h.prototype);u.prototype.constructor=u;e.exports=u;u.globalAutoUpdate=false;Object.defineProperties(u.prototype,{autoUpdate:{get:function(){return this.updateTransform===u.prototype.autoUpdateTransform},set:function(t){this.updateTransform=t?u.prototype.autoUpdateTransform:h.prototype.updateTransform}}});u.prototype.update=function(t){this.state.update(t);this.state.apply(this.skeleton);this.skeleton.updateWorldTransform();var e=this.skeleton.drawOrder;var i=this.skeleton.slots;for(var r=0,s=e.length;r<s;r++){this.children[r]=this.slotContainers[e[r]]}for(r=0,s=i.length;r<s;r++){var l=i[r];var h=l.attachment;var u=this.slotContainers[r];if(!h){u.visible=false;continue}var p=h.type;if(p===n.AttachmentType.region){if(h.rendererObject){if(!l.currentSpriteName||l.currentSpriteName!==h.rendererObject.name){var f=h.rendererObject.name;if(l.currentSprite!==undefined){l.currentSprite.visible=false}l.sprites=l.sprites||{};if(l.sprites[f]!==undefined){l.sprites[f].visible=true}else{var m=this.createSprite(l,h);u.addChild(m)}l.currentSprite=l.sprites[f];l.currentSpriteName=f}}if(u.transform){var d=u.transform;var y;if(u.transform.matrix2d){y=d.matrix2d;d._dirtyVersion++;d.version=d._dirtyVersion;d.isStatic=true;d.operMode=0}else if(PIXI.TransformManual){if(d.position){d=new PIXI.TransformManual;u.transform=d}y=d.localTransform}else{if(!d._dirtyLocal){d=new PIXI.TransformStatic;u.transform=d}y=d.localTransform;d._dirtyParentVersion=-1;d._dirtyLocal=1;d._versionLocal=1}l.bone.matrix.copy(y);y.tx+=l.bone.skeleton.x;y.ty+=l.bone.skeleton.y}else{var y=u.localTransform||new a;l.bone.matrix.copy(y);y.tx+=l.bone.skeleton.x;y.ty+=l.bone.skeleton.y;u.localTransform=y;u.displayObjectUpdateTransform=c}l.currentSprite.blendMode=l.blendMode;l.currentSprite.tint=o.rgb2hex([l.r*h.r,l.g*h.g,l.b*h.b])}else if(p===n.AttachmentType.skinnedmesh||p===n.AttachmentType.mesh||p===n.AttachmentType.linkedmesh){if(!l.currentMeshName||l.currentMeshName!==h.name){var v=h.name;if(l.currentMesh!==undefined){l.currentMesh.visible=false}l.meshes=l.meshes||{};if(l.meshes[v]!==undefined){l.meshes[v].visible=true}else{var g=this.createMesh(l,h);u.addChild(g)}l.currentMesh=l.meshes[v];l.currentMeshName=v}h.computeWorldVertices(l.bone.skeleton.x,l.bone.skeleton.y,l,l.currentMesh.vertices);if(PIXI.VERSION[0]!=="3"){l.currentMesh.dirty=true}}else{u.visible=false;continue}u.visible=true;u.alpha=l.a}};u.prototype.autoUpdateTransform=function(){if(u.globalAutoUpdate){this.lastTime=this.lastTime||Date.now();var t=(Date.now()-this.lastTime)*.001;this.lastTime=Date.now();this.update(t)}else{this.lastTime=0}h.prototype.updateTransform.call(this)};u.prototype.createSprite=function(t,e){var i=e.rendererObject;var r=i.texture;var a=new s(r);a.scale.x=e.scaleX*e.width/i.originalWidth;a.scale.y=-e.scaleY*e.height/i.originalHeight;a.rotation=e.rotation*n.degRad;a.anchor.x=.5;a.anchor.y=.5;a.position.x=e.x;a.position.y=e.y;a.alpha=e.a;t.sprites=t.sprites||{};t.sprites[i.name]=a;return a};u.prototype.createMesh=function(t,e){var i=e.rendererObject;var n=i.page.rendererObject;var a=new l(n);var o=new r.Mesh(a,new Float32Array(e.uvs.length),new Float32Array(e.uvs),new Uint16Array(e.triangles),r.Mesh.DRAW_MODES.TRIANGLES);o.canvasPadding=1.5;o.alpha=e.a;t.meshes=t.meshes||{};t.meshes[e.name]=o;return o};u.prototype.hackTextureBySlotIndex=function(t,e,i){var r=this.skeleton.slots[t];if(!r){return false}var a=r.attachment;if(!a||!a.hackRegion){return false}var o=null;if(e){o=new n.AtlasRegion;o.texture=e;o.size=i}a.hackRegion(o);var s=a.rendererObject;if(r.currentSprite){var l=r.currentSprite;l.texture=s.texture;l.scale.x=a.width/s.originalWidth;l.scale.y=-a.height/s.originalHeight}if(r.currentMesh){var h=r.currentMesh;h.texture=s.texture;for(var u=0;u<a.uvs.length;u++){h.uvs[u]=a.uvs[u]}if(PIXI.VERSION[0]!=="3"){h.indexDirty=true}else{h.dirty=true}}return true};u.prototype.hackTextureBySlotName=function(t,e,i){var n=this.skeleton.findSlotIndex(t);if(n==-1){return false}return this.hackTextureBySlotIndex(n,e,i)};function c(){var t=this.parent.worldTransform;var e=this.worldTransform;var i=this.localTransform;e.a=i.a*t.a+i.b*t.c;e.b=i.a*t.b+i.b*t.d;e.c=i.c*t.a+i.d*t.c;e.d=i.c*t.b+i.d*t.d;e.tx=i.tx*t.a+i.ty*t.c+t.tx;e.ty=i.tx*t.b+i.ty*t.d+t.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha;this._currentBounds=null}},{"../SpineRuntime":45,"../SpineUtil/Matrix.js":47,"../display/Container.js":54,"../mesh/":59,"../sprites/Sprite.js":63,"../texture/Texture.js":65,"../utils.js":67}],4:[function(t,e,i){var n=t("../SpineUtil");n.Animation=function(t,e,i){this.name=t;this.timelines=e;this.duration=i};n.Animation.prototype={apply:function(t,e,i,n,r){if(n&&this.duration!=0){i%=this.duration;e%=this.duration}var a=this.timelines;for(var o=0,s=a.length;o<s;o++)a[o].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,a){if(n&&this.duration!=0){i%=this.duration;e%=this.duration}var o=this.timelines;for(var s=0,l=o.length;s<l;s++)o[s].apply(t,e,i,r,a)}};n.Animation.binarySearch=function(t,e,i){var n=0;var r=Math.floor(t.length/i)-2;if(!r)return i;var a=r>>>1;while(true){if(t[(a+1)*i]<=e)n=a+1;else r=a;if(n==r)return(n+1)*i;a=n+r>>>1}};n.Animation.binarySearch1=function(t,e){var i=0;var n=t.length-2;if(!n)return 1;var r=n>>>1;while(true){if(t[r+1]<=e)i=r+1;else n=r;if(i==n)return i+1;r=i+n>>>1}};n.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1};e.exports=n.Animation},{"../SpineUtil":52}],5:[function(t,e,i){var n=t("../SpineUtil");n.TrackEntry=t("./TrackEntry");n.AnimationState=function(t){this.data=t;this.tracks=[];this.events=[]};n.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(!i)continue;i.time+=t*i.timeScale;if(i.previous){var n=t*i.previous.timeScale;i.previous.time+=n;i.mixTime+=n}var r=i.next;if(r){r.time=i.lastTime-r.delay;if(r.time>=0)this.setCurrent(e,r)}else{if(!i.loop&&i.lastTime>=i.endTime)this.clearTrack(e)}}},apply:function(t){t.resetDrawOrder();for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(!i)continue;this.events.length=0;var n=i.time;var r=i.lastTime;var a=i.endTime;var o=i.loop;if(!o&&n>a)n=a;var s=i.previous;if(!s){if(i.mix==1)i.animation.apply(t,i.lastTime,n,o,this.events);else i.animation.mix(t,i.lastTime,n,o,this.events,i.mix)}else{var l=s.time;if(!s.loop&&l>s.endTime)l=s.endTime;s.animation.apply(t,l,l,s.loop,null);var h=i.mixTime/i.mixDuration*i.mix;if(h>=1){h=1;i.previous=null}i.animation.mix(t,i.lastTime,n,o,this.events,h)}for(var u=0,c=this.events.length;u<c;u++){var p=this.events[u];if(i.onEvent)i.onEvent(e,p);if(this.onEvent)this.onEvent(e,p)}if(o?r%a>n%a:r<a&&n>=a){var f=Math.floor(n/a);if(i.onComplete)i.onComplete(e,f);if(this.onComplete)this.onComplete(e,f)}i.lastTime=i.time}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(t>=this.tracks.length)return;var e=this.tracks[t];if(!e)return;if(e.onEnd)e.onEnd(t);if(this.onEnd)this.onEnd(t);this.tracks[t]=null},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];while(t>=this.tracks.length)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null;if(i.onEnd)i.onEnd(t);if(this.onEnd)this.onEnd(t);e.mixDuration=this.data.getMix(i.animation,e.animation);if(e.mixDuration>0){e.mixTime=0;if(n&&i.mixTime/i.mixDuration<.5)e.previous=n;else e.previous=i}}this.tracks[t]=e;if(e.onStart)e.onStart(t);if(this.onStart)this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;return this.setAnimation(t,n,i)},setAnimation:function(t,e,i){var r=new n.TrackEntry;r.animation=e;r.loop=i;r.endTime=e.duration;this.setCurrent(t,r);return r},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,i,n)},addAnimation:function(t,e,i,r){var a=new n.TrackEntry;a.animation=e;a.loop=i;a.endTime=e.duration;var o=this._expandToIndex(t);if(o){while(o.next)o=o.next;o.next=a}else this.tracks[t]=a;if(r<=0){if(o)r+=o.endTime-this.data.getMix(o.animation,e);else r=0}a.delay=r;return a},hasAnimationByName:function(t){var e=this.data.skeletonData.findAnimation(t);return e!==null},getCurrent:function(t){if(t>=this.tracks.length)return null;return this.tracks[t]}};e.exports=n.AnimationState},{"../SpineUtil":52,"./TrackEntry":39}],6:[function(t,e,i){var n=t("../SpineUtil");n.AnimationStateData=function(t){this.skeletonData=t;this.animationToMixTime={}};n.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}};e.exports=n.AnimationStateData},{"../SpineUtil":52}],7:[function(t,e,i){var n=t("../SpineUtil");var r=t("../texture/Texture.js");var a=t("../SpineUtil/Rectangle.js");n.AtlasReader=t("./AtlasReader");n.AtlasPage=t("./AtlasPage");n.AtlasRegion=t("./AtlasRegion");n.Atlas=function(t,e,i){this.pages=[];this.regions=[];if(typeof t==="string"){this.addSpineAtlas.call(this,t,e,i)}};n.Atlas.prototype={addTexture:function(t,e){var i=this.pages;var r=null;for(var a=0;a<i.length;a++){if(i[a].rendererObject===e.baseTexture){r=i[a];break}}if(r===null){r=new n.AtlasPage;r.name="texturePage";var o=e.baseTexture;r.width=o.realWidth;r.height=o.realHeight;r.rendererObject=o;r.format="RGBA8888";r.minFilter=r.magFilter="Nearest";r.uWrap=n.Atlas.TextureWrap.clampToEdge;r.vWrap=n.Atlas.TextureWrap.clampToEdge;i.push(r)}var s=new n.AtlasRegion;s.name=t;s.page=r;s.texture=e;s.index=-1;this.regions.push(s);return s},addTextureHash:function(t,e){for(var i in t){if(t.hasOwnProperty(i)){this.addTexture(e&&i.indexOf(".")!==-1?i.substr(0,i.lastIndexOf(".")):i,t[i])}}},addSpineAtlas:function(t,e,i){if(typeof e!=="function"){var o=e;var s=i;e=syncImageLoaderAdapter(o,s);i=null}this.texturesLoading=0;var l=this;var h=new n.AtlasReader(t);var u=[];u.length=4;var c=null;p();function p(){while(true){var t=h.readLine();if(t===null){return i&&i(l)}t=h.trim(t);if(!t.length)c=null;else if(!c){c=new n.AtlasPage;c.name=t;if(h.readTuple(u)==2){c.width=parseInt(u[0]);c.height=parseInt(u[1]);h.readTuple(u)}else{}c.format=n.Atlas.Format[u[0]];h.readTuple(u);c.minFilter=n.Atlas.TextureFilter[u[0]];c.magFilter=n.Atlas.TextureFilter[u[1]];var o=h.readValue();c.uWrap=n.Atlas.TextureWrap.clampToEdge;c.vWrap=n.Atlas.TextureWrap.clampToEdge;if(o=="x")c.uWrap=n.Atlas.TextureWrap.repeat;else if(o=="y")c.vWrap=n.Atlas.TextureWrap.repeat;else if(o=="xy")c.uWrap=c.vWrap=n.Atlas.TextureWrap.repeat;e(t,function(t){c.rendererObject=t;if(!t.hasLoaded){t.width=c.width;t.height=c.height}l.pages.push(c);if(!c.width||!c.height){c.width=t.realWidth;c.height=t.realHeight;if(!c.width||!c.height){console.log("ERROR spine atlas page "+c.name+": meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)")}}p()});break}else{var s=new n.AtlasRegion;s.name=t;s.page=c;var f=h.readValue()==="true"?6:0;h.readTuple(u);var m=parseInt(u[0]);var d=parseInt(u[1]);h.readTuple(u);var y=parseInt(u[0]);var v=parseInt(u[1]);var g=c.rendererObject.resolution;m/=g;d/=g;y/=g;v/=g;var _=new a(m,d,f?v:y,f?y:v);if(h.readTuple(u)==4){s.splits=[parseInt(u[0]),parseInt(u[1]),parseInt(u[2]),parseInt(u[3])];if(h.readTuple(u)==4){s.pads=[parseInt(u[0]),parseInt(u[1]),parseInt(u[2]),parseInt(u[3])];h.readTuple(u)}}var I=parseInt(u[0])/g;var x=parseInt(u[1])/g;h.readTuple(u);var w=parseInt(u[0])/g;var S=parseInt(u[1])/g;var b=new a(0,0,I,x);var C=new a(w,x-v-S,y,v);var T=new a(m,d,y,v);var D=T.clone();C.width=I;C.height=x;s.texture=new r(s.page.rendererObject,T,D,C,f);s.index=parseInt(h.readValue());s.texture._updateUvs();l.regions.push(s)}}}},findRegion:function(t){var e=this.regions;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},dispose:function(){var t=this.pages;for(var e=0,i=t.length;e<i;e++)t[e].rendererObject.destroy(true)},updateUVs:function(t){var e=this.regions;for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.page!=t)continue;r.texture._updateUvs()}}};n.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};n.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};n.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};e.exports=n.Atlas},{"../SpineUtil":52,"../SpineUtil/Rectangle.js":50,"../texture/Texture.js":65,"./AtlasPage":9,"./AtlasReader":10,"./AtlasRegion":11}],8:[function(t,e,i){var n=t("../SpineUtil");n.RegionAttachment=t("./RegionAttachment");n.MeshAttachment=t("./MeshAttachment");n.WeightedMeshAttachment=t("./WeightedMeshAttachment");n.BoundingBoxAttachment=t("./BoundingBoxAttachment");n.AtlasAttachmentParser=function(t){this.atlas=t};n.AtlasAttachmentParser.prototype={newRegionAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (region attachment: "+e+")";var a=new n.RegionAttachment(e);a.rendererObject=r;a.setUVs(r.u,r.v,r.u2,r.v2,r.rotate);a.regionOffsetX=r.offsetX;a.regionOffsetY=r.spineOffsetY;a.regionWidth=r.width;a.regionHeight=r.height;a.regionOriginalWidth=r.originalWidth;a.regionOriginalHeight=r.originalHeight;return a},newMeshAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (mesh attachment: "+e+")";var a=new n.MeshAttachment(e);a.rendererObject=r;return a},newWeightedMeshAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (skinned mesh attachment: "+e+")";var a=new n.WeightedMeshAttachment(e);a.rendererObject=r;return a},newBoundingBoxAttachment:function(t,e){return new n.BoundingBoxAttachment(e)}};e.exports=n.AtlasAttachmentParser},{"../SpineUtil":52,"./BoundingBoxAttachment":16,"./MeshAttachment":27,"./RegionAttachment":28,"./WeightedMeshAttachment":44}],9:[function(t,e,i){var n=t("../SpineUtil");n.AtlasPage=function(){};n.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};e.exports=n.AtlasPage},{"../SpineUtil":52}],10:[function(t,e,i){var n=t("../SpineUtil");n.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)};n.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){if(this.index>=this.lines.length)return null;return this.lines[this.index++]},readValue:function(){var t=this.readLine();var e=t.indexOf(":");if(e==-1)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine();var i=e.indexOf(":");if(i==-1)throw"Invalid line: "+e;var n=0,r=i+1;for(;n<3;n++){var a=e.indexOf(",",r);if(a==-1)break;t[n]=this.trim(e.substr(r,a-r));r=a+1}t[n]=this.trim(e.substring(r));return n+1}};e.exports=n.AtlasReader},{"../SpineUtil":52}],11:[function(t,e,i){var n=t("../SpineUtil");n.AtlasRegion=function(){};n.AtlasRegion.prototype={name:null,texture:null,page:null,index:0,splits:null,pads:null};Object.defineProperties(n.AtlasRegion.prototype,{x:{get:function(){return this.texture.frame.x}},y:{get:function(){return this.texture.frame.y}},width:{get:function(){var t=this.texture;return t.crop.width}},height:{get:function(){var t=this.texture;return t.crop.height}},u:{get:function(){return this.texture._uvs.x0}},v:{get:function(){return this.texture._uvs.y0}},u2:{get:function(){return this.texture._uvs.x2}},v2:{get:function(){return this.texture._uvs.y2}},rotate:{get:function(){return!!this.texture.rotate}},offsetX:{get:function(){var t=this.texture;return t.trim?t.trim.x:0}},offsetY:{get:function(){console.warn("Deprecation Warning: @Hackerham: I guess, if you are using SPINE ATLAS region.offsetY, you want a texture, right? Use region.texture from now on.");return this.spineOffsetY}},pixiOffsetY:{get:function(){var t=this.texture;return t.trim?t.trim.y:0}},spineOffsetY:{get:function(){var t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)}},originalWidth:{get:function(){var t=this.texture;if(t.trim){return t.trim.width}return t.crop.width}},originalHeight:{get:function(){var t=this.texture;if(t.trim){return t.trim.height}return t.crop.height}}});e.exports=n.AtlasRegion},{"../SpineUtil":52}],12:[function(t,e,i){var n=t("../SpineUtil");n.Curves=t("./Curves");n.Animation=t("./Animation");n.AttachmentTimeline=function(t){this.curves=new n.Curves(t);this.frames=[];this.frames.length=t;this.attachmentNames=[];this.attachmentNames.length=t};n.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.attachmentNames[t]=i},apply:function(t,e,i,r,a){var o=this.frames;if(i<o[0]){if(e>i)this.apply(t,e,Number.MAX_VALUE,null,0);return}else if(e>i)e=-1;var s=i>=o[o.length-1]?o.length-1:n.Animation.binarySearch1(o,i)-1;if(o[s]<e)return;var l=this.attachmentNames[s];t.slots[this.slotIndex].setAttachment(!l?null:t.getAttachmentBySlotIndex(this.slotIndex,l))}};e.exports=n.AttachmentTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],13:[function(t,e,i){var n=t("../SpineUtil");n.AttachmentType={region:0,boundingbox:1,mesh:2,weightedmesh:3,skinnedmesh:3,linkedmesh:4,weightedlinkedmesh:5};e.exports=n.AttachmentType},{"../SpineUtil":52}],14:[function(t,e,i){var n=t("../SpineUtil");var r=t("../SpineUtil/Matrix.js");n.Bone=function(t,e,i){this.data=t;this.skeleton=e;this.parent=i;this.matrix=new r;this.setToSetupPose()};n.Bone.yDown=false;n.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,shearX:0,shearY:0,flipX:false,flipY:false,worldSignX:1,worldSignY:1,update:function(){this.rotationIK=this.rotation;this.updateWorldTransform()},updateWorldTransform:function(){var t=this.rotationIK;var e=this.scaleX;var i=this.scaleY;var r=this.x;var a=this.y;var o=t+this.shearX;var s=t+90+this.shearY;var l=Math.cos(o*n.degRad)*e,h=Math.cos(s*n.degRad)*i,u=Math.sin(o*n.degRad)*e,c=Math.sin(s*n.degRad)*i;var p=this.parent;var f=this.matrix;var m=this.skeleton;if(!p){if(m.flipX){r=-r;l=-l;h=-h}if(m.flipY!==n.Bone.yDown){a=-a;u=-u;c=-c}f.a=l;f.c=h;f.b=u;f.d=c;f.tx=r;f.ty=a;this.worldSignX=n.signum(e);this.worldSignY=n.signum(i);return}var d=p.matrix.a,y=p.matrix.c,v=p.matrix.b,g=p.matrix.d;f.tx=d*r+y*a+p.matrix.tx;f.ty=v*r+g*a+p.matrix.ty;this.worldSignX=p.worldSignX*n.signum(e);this.worldSignY=p.worldSignY*n.signum(i);var _=this.data;if(_.inheritRotation&&_.inheritScale){f.a=d*l+y*u;f.c=d*h+y*c;f.b=v*l+g*u;f.d=v*h+g*c}else{if(_.inheritRotation){d=1;y=0;v=0;g=1;do{cos=Math.cos(p.rotationIK*n.degRad);sin=Math.sin(p.rotationIK*n.degRad);var I=d*cos+y*sin;y=d*-sin+y*cos;d=I;I=v*cos+g*sin;g=v*-sin+g*cos;v=I;if(!p.data.inheritRotation)break;p=p.parent}while(p!=null);f.a=d*l+y*u;f.c=d*h+y*c;f.b=v*l+g*u;f.d=v*h+g*c}else if(_.inheritScale){d=1;y=0;v=0;g=1;do{var x=p.rotationIK;cos=Math.cos(x*n.degRad);sin=Math.sin(x*n.degRad);var w=p.scaleX,S=p.scaleY;var b=cos*w,C=-sin*S,T=sin*w,D=cos*S;I=d*b+y*T;y=d*C+y*D;d=I;I=v*b+g*T;g=v*C+g*D;v=I;if(w<0){x=-x}else{sin=-sin}I=d*cos+y*sin;y=d*-sin+y*cos;d=I;I=v*cos+g*sin;g=v*-sin+g*cos;v=I;if(!p.data.inheritScale)break;p=p.parent}while(p!=null);f.a=d*l+y*u;f.c=d*h+y*c;f.b=v*l+g*u;f.d=v*h+g*c}else{f.a=l;f.c=h;f.b=u;f.d=c}if(m.flipX){f.a=-f.a;f.c=-f.c}if(m.flipY!==n.Bone.yDown){f.b=-f.b;f.d=-f.d}}},setToSetupPose:function(){var t=this.data;this.x=t.x;this.y=t.y;this.rotation=t.rotation;this.rotationIK=this.rotation;this.scaleX=t.scaleX;this.scaleY=t.scaleY;this.shearX=t.shearX;this.shearY=t.shearY},worldToLocal:function(t){var e=this.matrix;var i=t[0]-e.tx,n=e.ty;var r=1/(e.a*e.d-e.b*e.c);t[0]=i*e.a*r-n*e.c*r;t[1]=n*e.d*r-i*e.b*r},localToWorld:function(t){var e=t[0],i=t[1];var n=this.matrix;t[0]=e*n.a+i*n.c+n.tx;t[1]=e*n.b+i*n.d+n.ty},getWorldRotationX:function(){return Math.atan2(this.matrix.b,this.matrix.a)*n.radDeg},getWorldRotationY:function(){return Math.atan2(this.matrix.d,this.matrix.c)*n.radDeg},getWorldScaleX:function(){var t=this.matrix.a;var e=this.matrix.b;return Math.sqrt(t*t+e*e)},getWorldScaleY:function(){var t=this.matrix.c;var e=this.matrix.d;return Math.sqrt(t*t+e*e)}};Object.defineProperties(n.Bone.prototype,{worldX:{get:function(){return this.matrix.tx}},worldY:{get:function(){return this.matrix.ty}}});e.exports=n.Bone},{"../SpineUtil":52,"../SpineUtil/Matrix.js":47}],15:[function(t,e,i){var n=t("../SpineUtil");n.BoneData=function(t,e){this.name=t;this.parent=e};n.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,shearX:0,shearY:0,inheritScale:true,inheritRotation:true};e.exports=n.BoneData},{"../SpineUtil":52}],16:[function(t,e,i){var n=t("../SpineUtil");n.AttachmentType=t("./AttachmentType");n.BoundingBoxAttachment=function(t){this.name=t;this.vertices=[]};n.BoundingBoxAttachment.prototype={type:n.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX;e+=i.worldY;var r=i.matrix.a,a=i.matrix.c,o=i.matrix.b,s=i.matrix.d;var l=this.vertices;for(var h=0,u=l.length;h<u;h+=2){var c=l[h];var p=l[h+1];n[h]=c*r+p*a+t;n[h+1]=c*o+p*s+e}}};e.exports=n.BoundingBoxAttachment},{"../SpineUtil":52,"./AttachmentType":13}],17:[function(t,e,i){var n=t("../SpineUtil");n.Animation=t("./Animation");n.Curves=t("./Curves");n.ColorTimeline=function(t){this.curves=new n.Curves(t);this.frames=[];this.frames.length=t*5};n.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,a){t*=5;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n;this.frames[t+3]=r;this.frames[t+4]=a},apply:function(t,e,i,r,a){var o=this.frames;if(i<o[0])return;var s,l,h,u;if(i>=o[o.length-5]){var c=o.length-1;s=o[c-3];l=o[c-2];h=o[c-1];u=o[c]}else{var p=n.Animation.binarySearch(o,i,5);var f=o[p-4];var m=o[p-3];var d=o[p-2];var y=o[p-1];var v=o[p];var g=1-(i-v)/(o[p-5]-v);g=this.curves.getCurvePercent(p/5-1,g);s=f+(o[p+1]-f)*g;l=m+(o[p+2]-m)*g;h=d+(o[p+3]-d)*g;u=y+(o[p+4]-y)*g}var _=t.slots[this.slotIndex];if(a<1){_.r+=(s-_.r)*a;_.g+=(l-_.g)*a;_.b+=(h-_.b)*a;_.a+=(u-_.a)*a}else{_.r=s;_.g=l;_.b=h;_.a=u}}};e.exports=n.ColorTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],18:[function(t,e,i){var n=t("../SpineUtil");n.Curves=function(t){this.curves=[]};n.Curves.prototype={setLinear:function(t){this.curves[t*19]=0},setStepped:function(t){this.curves[t*19]=1;
},setCurve:function(t,e,i,n,r){var a=1/10,o=a*a,s=o*a;var l=3*a,h=3*o,u=6*o,c=6*s;var p=-e*2+n,f=-i*2+r,m=(e-n)*3+1,d=(i-r)*3+1;var y=e*l+p*h+m*s,v=i*l+f*h+d*s;var g=p*u+m*c,_=f*u+d*c;var I=m*c,x=d*c;var w=t*19;var S=this.curves;S[w++]=2;var b=y,C=v;for(var T=w+19-1;w<T;w+=2){S[w]=b;S[w+1]=C;y+=g;v+=_;g+=I;_+=x;b+=y;C+=v}},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var i=this.curves;var n=t*19;var r=i[n];if(r===0)return e;if(r==1)return 0;n++;var a=0;for(var o=n,s=n+19-1;n<s;n+=2){a=i[n];if(a>=e){var l,h;if(n==o){l=0;h=0}else{l=i[n-2];h=i[n-1]}return h+(i[n+1]-h)*(e-l)/(a-l)}}var u=i[n-1];return u+(1-u)*(e-a)/(1-a)}};e.exports=n.Curves},{"../SpineUtil":52}],19:[function(t,e,i){var n=t("../SpineUtil");n.Animation=t("./Animation");n.DrawOrderTimeline=function(t){this.frames=[];this.frames.length=t;this.drawOrders=[];this.drawOrders.length=t};n.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.drawOrders[t]=i},apply:function(t,e,i,r,a){var o=this.frames;if(i<o[0])return;var s;if(i>=o[o.length-1])s=o.length-1;else s=n.Animation.binarySearch1(o,i)-1;var l=t.drawOrder;var h=t.slots;var u=this.drawOrders[s];if(u){for(var c=0,p=u.length;c<p;c++){l[c]=u[c]}}}};e.exports=n.DrawOrderTimeline},{"../SpineUtil":52,"./Animation":4}],20:[function(t,e,i){var n=t("../SpineUtil");n.Event=function(t){this.data=t};n.Event.prototype={intValue:0,floatValue:0,stringValue:null};e.exports=n.Event},{"../SpineUtil":52}],21:[function(t,e,i){var n=t("../SpineUtil");n.EventData=function(t){this.name=t};n.EventData.prototype={intValue:0,floatValue:0,stringValue:null};e.exports=n.EventData},{"../SpineUtil":52}],22:[function(t,e,i){var n=t("../SpineUtil");n.Animation=t("./Animation");n.EventTimeline=function(t){this.frames=[];this.frames.length=t;this.events=[];this.events.length=t};n.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.events[t]=i},apply:function(t,e,i,r,a){if(!r)return;var o=this.frames;var s=o.length;if(e>i){this.apply(t,e,Number.MAX_VALUE,r,a);e=-1}else if(e>=o[s-1])return;if(i<o[0])return;var l;if(e<o[0])l=0;else{l=n.Animation.binarySearch1(o,e);var h=o[l];while(l>0){if(o[l-1]!=h)break;l--}}var u=this.events;for(;l<s&&i>=o[l];l++)r.push(u[l])}};e.exports=n.EventTimeline},{"../SpineUtil":52,"./Animation":4}],23:[function(t,e,i){var n=t("../SpineUtil");n.Animation=t("./Animation");n.Curves=t("./Curves");n.FfdTimeline=function(t){this.curves=new n.Curves(t);this.frames=[];this.frames.length=t;this.frameVertices=[];this.frameVertices.length=t};n.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e;this.frameVertices[t]=i},apply:function(t,e,i,r,a){var o=t.slots[this.slotIndex];var s=o.attachment;if(s&&(!s.applyFFD||!s.applyFFD(this.attachment)))return;var l=this.frames;if(i<l[0])return;var h=this.frameVertices;var u=h[0].length;var c=o.attachmentVertices;if(c.length!=u){c=o.attachmentVertices=[];for(var p=0;p<u;p++)c.push(0);a=1}if(i>=l[l.length-1]){var f=h[l.length-1];if(a<1){for(var m=0;m<u;m++)c[m]+=(f[m]-c[m])*a}else{for(var m=0;m<u;m++)c[m]=f[m]}return}var d=n.Animation.binarySearch1(l,i);var y=l[d];var v=1-(i-y)/(l[d-1]-y);v=this.curves.getCurvePercent(d-1,v<0?0:v>1?1:v);var g=h[d-1];var _=h[d];if(a<1){for(var m=0;m<u;m++){var I=g[m];c[m]+=(I+(_[m]-I)*v-c[m])*a}}else{for(var m=0;m<u;m++){var I=g[m];c[m]=I+(_[m]-I)*v}}}};e.exports=n.FfdTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],24:[function(t,e,i){var n=t("../SpineUtil");n.IkConstraint=function(t,e){this.data=t;this.mix=t.mix;this.bendDirection=t.bendDirection;this.bones=[];for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)};n.IkConstraint.prototype={update:function(){this.apply()},apply:function(){var t=this.target;var e=this.bones;switch(e.length){case 1:n.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:n.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix);break}}};n.IkConstraint.apply1=function(t,e,i,r){var a=t.parent?t.parent.getWorldRotationX():0;var o=t.rotation;var s=Math.atan2(i-t.worldY,e-t.worldX)*n.radDeg-a;if(t.worldSignX!=t.worldSignY!=(t.skeleton.flipX!=(t.skeleton.flipY!=n.Bone.yDown)))s=360-s;if(s>180)s-=360;else if(s<-180)s+=360;t.rotationIK=o+(s-o)*r;t.updateWorldTransform()};n.IkConstraint.apply2=function(t,e,i,r,a,o){if(o==0)return;var s=t.x,l=t.y,h=t.scaleX,u=t.scaleY,c=e.scaleX,p=e.y;var f,m,d;if(h<0){h=-h;f=180;d=-1}else{f=0;d=1}if(u<0){u=-u;d=-d}if(c<0){c=-c;m=180}else m=0;var y=t.parent;var v=y.matrix;var g,_,I,x;if(y==null){g=i-s;_=r-l;I=e.worldX-s;x=e.worldY-l}else{var w=v.a,S=v.c,b=v.b,C=v.d,T=1/(w*C-S*b);var D=v.tx,U=v.ty,A=i-D,E=r-U;g=(A*C-E*S)*T-s;_=(E*w-A*b)*T-l;A=e.worldX-D;E=e.worldY-U;I=(A*C-E*S)*T-s;x=(E*w-A*b)*T-l}var M=Math.sqrt(I*I+x*x),P=e.data.length*c,B,L;t:if(Math.abs(h-u)<=1e-4){P*=h;var R=(g*g+_*_-M*M-P*P)/(2*M*P);if(R<-1)R=-1;else if(R>1)R=1;L=Math.acos(R)*a;var w=M+P*R,O=P*Math.sin(L);B=Math.atan2(_*w-g*O,g*w+_*O)}else{p=0;var w=h*P,S=u*P,V=Math.atan2(_,g);var F=w*w,k=S*S,N=M*M,G=g*g+_*_;var W=k*N+F*G-F*k,H=-2*k*M,X=k-F;var C=H*H-4*X*W;if(C>=0){var J=Math.sqrt(C);if(H<0)J=-J;J=-(H+J)/2;var Y=J/X,z=W/J;var j=Math.abs(Y)<Math.abs(z)?Y:z;if(j*j<=G){var E=Math.sqrt(G-j*j)*a;B=V-Math.atan2(E,j);L=Math.atan2(E/u,(j-M)/h);break t}}var K=0,q=Infinity,Z=0,Q=0;var $=0,tt=0,et=0,it=0;var A=M+w,nt=A*A;if(nt>tt){$=0;tt=nt;et=A}A=M-w;nt=A*A;if(nt<q){K=Math.PI;q=nt;Z=A}var rt=Math.acos(-w*M/(F-k));A=w*Math.cos(rt)+M;var E=S*Math.sin(rt);nt=A*A+E*E;if(nt<q){K=rt;q=nt;Z=A;Q=E}if(nt>tt){$=rt;tt=nt;et=A;it=E}if(G<=(q+tt)/2){B=V-Math.atan2(Q*a,Z);L=K*a}else{B=V-Math.atan2(it*a,et);L=$*a}}var at=Math.atan2(p,e.x)*d;B=(B-at)*n.radDeg+f;L=(L+at)*n.radDeg*d+m;if(B>180)B-=360;else if(B<-180)B+=360;if(L>180)L-=360;else if(L<-180)L+=360;var ot=t.rotation;t.rotationIK=ot+(B-ot)*o;t.updateWorldTransform();ot=e.rotation;e.rotationIK=ot+(L-ot)*o;e.updateWorldTransform()};e.exports=n.IkConstraint},{"../SpineUtil":52}],25:[function(t,e,i){var n=t("../SpineUtil")||{};n.IkConstraintData=function(t){this.name=t;this.bones=[]};n.IkConstraintData.prototype={target:null,bendDirection:1,mix:1};e.exports=n.IkConstraintData},{"../SpineUtil":52}],26:[function(t,e,i){var n=t("../SpineUtil")||{};n.Animation=t("./Animation");n.Curves=t("./Curves");n.IkConstraintTimeline=function(t){this.curves=new n.Curves(t);this.frames=[];this.frames.length=t*3};n.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,r,a){var o=this.frames;if(i<o[0])return;var s=t.ikConstraints[this.ikConstraintIndex];if(i>=o[o.length-3]){s.mix+=(o[o.length-2]-s.mix)*a;s.bendDirection=o[o.length-1];return}var l=n.Animation.binarySearch(o,i,3);var h=o[l+-2];var u=o[l];var c=1-(i-u)/(o[l+-3]-u);c=this.curves.getCurvePercent(l/3-1,c);var p=h+(o[l+1]-h)*c;s.mix+=(p-s.mix)*a;s.bendDirection=o[l+-1]}};e.exports=n.IkConstraintTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],27:[function(t,e,i){var n=t("../SpineUtil")||{};n.AttachmentType=t("./AttachmentType");n.MeshAttachment=function(t){this.name=t};n.MeshAttachment.prototype={type:n.AttachmentType.mesh,parentMesh:null,inheritFFD:false,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionUVs.length;if(!this.uvs||this.uvs.length!=t){this.uvs=new n.Float32Array(t)}var e=this.rendererObject;if(!e)return;var i=e.texture;var r=i._uvs;var a=e.width,o=e.height,s=e.originalWidth,l=e.originalHeight;var h=e.offsetX,u=e.pixiOffsetY;for(var c=0;c<t;c+=2){var p=this.regionUVs[c],f=this.regionUVs[c+1];p=(p*s-h)/a;f=(f*l-u)/o;this.uvs[c]=(r.x0*(1-p)+r.x1*p)*(1-f)+(r.x3*(1-p)+r.x2*p)*f;this.uvs[c+1]=(r.y0*(1-p)+r.y1*p)*(1-f)+(r.y3*(1-p)+r.y2*p)*f}},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX;e+=r.worldY;var a=r.matrix.a,o=r.matrix.c,s=r.matrix.b,l=r.matrix.d;var h=this.vertices;var u=h.length;if(i.attachmentVertices.length==u)h=i.attachmentVertices;for(var c=0;c<u;c+=2){var p=h[c];var f=h[c+1];n[c]=p*a+f*o+t;n[c+1]=p*s+f*l+e}},applyFFD:function(t){return this===t||this.inheritFFD&&parentMesh===t},setParentMesh:function(t){this.parentMesh=t;if(t!=null){this.vertices=t.vertices;this.regionUVs=t.regionUVs;this.triangles=t.triangles;this.hullLength=t.hullLength}},hackRegion:function(t){if(!t){if(!this.oldRegion)return;t=this.oldRegion}if(!this.oldRegion){this.oldRegion=this.rendererObject}this.rendererObject=t;this.updateUVs()}};e.exports=n.MeshAttachment},{"../SpineUtil":52,"./AttachmentType":13}],28:[function(t,e,i){var n=t("../SpineUtil");n.AttachmentType=t("./AttachmentType");n.RegionAttachment=function(t){this.name=t;this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};n.RegionAttachment.prototype={type:n.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var a=this.uvs;if(r){a[2]=t;a[3]=n;a[4]=t;a[5]=e;a[6]=i;a[7]=e;a[0]=i;a[1]=n}else{a[0]=t;a[1]=n;a[2]=t;a[3]=e;a[4]=i;a[5]=e;a[6]=i;a[7]=n}},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX;var e=this.height/this.regionOriginalHeight*this.scaleY;var i=-this.width/2*this.scaleX+this.regionOffsetX*t;var r=-this.height/2*this.scaleY+this.regionOffsetY*e;var a=i+this.regionWidth*t;var o=r+this.regionHeight*e;var s=this.rotation*n.degRad;var l=Math.cos(s);var h=Math.sin(s);var u=i*l+this.x;var c=i*h;var p=r*l+this.y;var f=r*h;var m=a*l+this.x;var d=a*h;var y=o*l+this.y;var v=o*h;var g=this.offset;g[0]=u-f;g[1]=p+c;g[2]=u-v;g[3]=y+c;g[4]=m-v;g[5]=y+d;g[6]=m-f;g[7]=p+d},computeVertices:function(t,e,i,n){t+=i.worldX;e+=i.worldY;var r=i.matrix.a,a=i.matrix.c,o=i.matrix.b,s=i.matrix.d;var l=this.offset;n[0]=l[0]*r+l[1]*a+t;n[1]=l[0]*o+l[1]*s+e;n[2]=l[2]*r+l[3]*a+t;n[3]=l[2]*o+l[3]*s+e;n[4]=l[4]*r+l[5]*a+t;n[5]=l[4]*o+l[5]*s+e;n[6]=l[6]*r+l[7]*a+t;n[7]=l[6]*o+l[7]*s+e},hackRegion:function(t){if(!t){if(!this.oldRegion)return;t=this.oldRegion}if(!this.oldRegion){this.oldRegion=this.rendererObject;this.oldRegion.size={width:this.width,height:this.height}}this.rendererObject=t;if(t.size){this.width=t.size.width;this.height=t.size.height}}};e.exports=n.RegionAttachment},{"../SpineUtil":52,"./AttachmentType":13}],29:[function(t,e,i){var n=t("../SpineUtil")||{};n.Animation=t("./Animation");n.Curves=t("./Curves");n.RotateTimeline=function(t){this.curves=new n.Curves(t);this.frames=[];this.frames.length=t*2};n.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2;this.frames[t]=e;this.frames[t+1]=i},apply:function(t,e,i,r,a){var o=this.frames;if(i<o[0])return;var s=t.bones[this.boneIndex];if(i>=o[o.length-2]){var l=s.data.rotation+o[o.length-1]-s.rotation;while(l>180)l-=360;while(l<-180)l+=360;s.rotation+=l*a;return}var h=n.Animation.binarySearch(o,i,2);var u=o[h-1];var c=o[h];var p=1-(i-c)/(o[h-2]-c);p=this.curves.getCurvePercent(h/2-1,p);var l=o[h+1]-u;while(l>180)l-=360;while(l<-180)l+=360;l=s.data.rotation+(u+l*p)-s.rotation;while(l>180)l-=360;while(l<-180)l+=360;s.rotation+=l*a}};e.exports=n.RotateTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],30:[function(t,e,i){var n=t("../SpineUtil");n.Animation=t("./Animation");n.Curves=t("./Curves");n.ScaleTimeline=function(t){this.curves=new n.Curves(t);this.frames=[];this.frames.length=t*3};n.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,r,a){var o=this.frames;if(i<o[0])return;var s=t.bones[this.boneIndex];if(i>=o[o.length-3]){s.scaleX+=(s.data.scaleX*o[o.length-2]-s.scaleX)*a;s.scaleY+=(s.data.scaleY*o[o.length-1]-s.scaleY)*a;return}var l=n.Animation.binarySearch(o,i,3);var h=o[l-2];var u=o[l-1];var c=o[l];var p=1-(i-c)/(o[l+-3]-c);p=this.curves.getCurvePercent(l/3-1,p);s.scaleX+=(s.data.scaleX*(h+(o[l+1]-h)*p)-s.scaleX)*a;s.scaleY+=(s.data.scaleY*(u+(o[l+2]-u)*p)-s.scaleY)*a}};e.exports=n.ScaleTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],31:[function(t,e,i){var n=t("../SpineUtil");n.Animation=t("./Animation");n.Curves=t("./Curves");n.ShearTimeline=function(t){this.curves=new n.Curves(t);this.frames=[];this.frames.length=t*3};n.ShearTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,r,a){var o=this.frames;if(i<o[0])return;var s=t.bones[this.boneIndex];if(i>=o[o.length-3]){s.shearX+=(s.data.shearX+o[o.length-2]-s.shearX)*a;s.shearY+=(s.data.shearY+o[o.length-1]-s.shearY)*a;return}var l=n.Animation.binarySearch(o,i,3);var h=o[l-2];var u=o[l-1];var c=o[l];var p=1-(i-c)/(o[l+-3]-c);p=this.curves.getCurvePercent(l/3-1,p);s.shearX+=(s.data.shearX+(h+(o[l+1]-h)*p)-s.shearX)*a;s.shearY+=(s.data.shearY+(u+(o[l+2]-u)*p)-s.shearY)*a}};e.exports=n.ShearTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],32:[function(t,e,i){var n=t("../SpineUtil");n.Bone=t("./Bone");n.Slot=t("./Slot");n.IkConstraint=t("./IkConstraint");n.Skeleton=function(t){this.data=t;this.bones=[];for(var e=0,i=t.bones.length;e<i;e++){var r=t.bones[e];var a=!r.parent?null:this.bones[t.bones.indexOf(r.parent)];this.bones.push(new n.Bone(r,this,a))}this.slots=[];this.drawOrder=[];for(var e=0,i=t.slots.length;e<i;e++){var o=t.slots[e];var s=this.bones[t.bones.indexOf(o.boneData)];var l=new n.Slot(o,s);this.slots.push(l);this.drawOrder.push(e)}this.ikConstraints=[];for(var e=0,i=t.ikConstraints.length;e<i;e++)this.ikConstraints.push(new n.IkConstraint(t.ikConstraints[e],this));this.transformConstraints=[];for(var e=0,i=t.transformConstraints.length;e<i;e++)this.transformConstraints.push(new n.TransformConstraint(t.transformConstraints[e],this));this.boneCache=[];this.updateCache()};n.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:false,flipY:false,updateCache:function(){var t=this.ikConstraints;var e=t.length;var i=this.transformConstraints;var n=i.length;var r=this.boneCache;r.length=0;var a=this.bones;for(var o=0,s=a.length;o<s;o++){var l=a[o];r.push(l);for(var h=0;h<n;h++){if(i[h].bone==l){r.push(i[h])}}for(var h=0;h<e;h++){if(t[h].bones[t[h].bones.length-1]==l){r.push(t[h]);break}}}},updateWorldTransform:function(){var t=this.bones;for(var e=0,i=t.length;e<i;e++){var n=t[e];n.rotationIK=n.rotation}var r=this.boneCache;for(var e=0,i=r.length;e<i;e++){r[e].update()}},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){var t=this.bones;for(var e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var n=this.ikConstraints;for(var e=0,i=n.length;e<i;e++){var r=n[e];r.bendDirection=r.data.bendDirection;r.mix=r.data.mix}var a=this.transformConstraints;for(var e=0,i=a.length;e<i;e++){var o=a[e];var s=o.data;o.rotateMix=s.rotateMix;o.translateMix=s.translateMix;o.scaleMix=s.scaleMix;o.shearMix=s.shearMix}},setSlotsToSetupPose:function(){var t=this.slots;for(var e=0,i=t.length;e<i;e++){t[e].setToSetupPose(e)}this.resetDrawOrder()},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t){if(this.skin)t._attachAll(this,this.skin);else{var e=this.slots;for(var i=0,n=e.length;i<n;i++){var r=e[i];var a=r.data.attachmentName;if(a){var o=t.getAttachment(i,a);if(o)r.setAttachment(o)}}}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}if(this.data.defaultSkin)return this.data.defaultSkin.getAttachment(t,e);return null},setAttachment:function(t,e){var i=this.slots;for(var n=0,r=i.length;n<r;n++){var a=i[n];if(a.data.name==t){var o=null;if(e){o=this.getAttachmentBySlotIndex(n,e);if(!o)throw"Attachment not found: "+e+", for slot: "+t}a.setAttachment(o);return}}throw"Slot not found: "+t},findIkConstraint:function(t){var e=this.ikConstraints;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findTransformConstraint:function(t){var e=this.transformConstraints;for(var i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t},resetDrawOrder:function(){for(var t=0,e=this.drawOrder.length;t<e;t++){this.drawOrder[t]=t}}};e.exports=n.Skeleton},{"../SpineUtil":52,"./Bone":14,"./IkConstraint":24,"./Slot":37}],33:[function(t,e,i){var n=t("../SpineRuntime")||{};n.AttachmentType=t("./AttachmentType");n.SkeletonBounds=function(){this.polygonPool=[];this.polygons=[];this.boundingBoxes=[]};n.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var i=t.slots;var r=i.length;var a=t.x,o=t.y;var s=this.boundingBoxes;var l=this.polygonPool;var h=this.polygons;s.length=0;for(var u=0,c=h.length;u<c;u++)l.push(h[u]);h.length=0;for(var u=0;u<r;u++){var p=i[u];var f=p.attachment;if(f.type!=n.AttachmentType.boundingbox)continue;s.push(f);var m=l.length,d;if(m>0){d=l[m-1];l.splice(m-1,1)}else d=[];h.push(d);d.length=f.vertices.length;f.computeWorldVertices(a,o,p.bone,d)}if(e)this.aabbCompute()},aabbCompute:function(){var t=this.polygons;var e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE;for(var a=0,o=t.length;a<o;a++){var s=t[a];for(var l=0,h=s.length;l<h;l+=2){var u=s[l];var c=s[l+1];e=Math.min(e,u);i=Math.min(i,c);n=Math.max(n,u);r=Math.max(r,c)}}this.minX=e;this.minY=i;this.maxX=n;this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,a=this.minY,o=this.maxX,s=this.maxY;if(t<=r&&i<=r||e<=a&&n<=a||t>=o&&i>=o||e>=s&&n>=s)return false;var l=(n-e)/(i-t);var h=l*(r-t)+e;if(h>a&&h<s)return true;h=l*(o-t)+e;if(h>a&&h<s)return true;var u=(a-e)/l+t;if(u>r&&u<o)return true;u=(s-e)/l+t;if(u>r&&u<o)return true;return false},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){var i=this.polygons;for(var n=0,r=i.length;n<r;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){var r=this.polygons;for(var a=0,o=r.length;a<o;a++)if(r[a].intersectsSegment(t,e,i,n))return this.boundingBoxes[a];return null},polygonContainsPoint:function(t,e,i){var n=t.length;var r=n-2;var a=false;for(var o=0;o<n;o+=2){var s=t[o+1];var l=t[r+1];if(s<i&&l>=i||l<i&&s>=i){var h=t[o];if(h+(i-s)/(l-s)*(t[r]-h)<e)a=!a}r=o}return a},polygonIntersectsSegment:function(t,e,i,n,r){var a=t.length;var o=e-n,s=i-r;var l=e*r-i*n;var h=t[a-2],u=t[a-1];for(var c=0;c<a;c+=2){var p=t[c],f=t[c+1];var m=h*f-u*p;var d=h-p,y=u-f;var v=o*y-s*d;var g=(l*d-o*m)/v;if((g>=h&&g<=p||g>=p&&g<=h)&&(g>=e&&g<=n||g>=n&&g<=e)){var _=(l*y-s*m)/v;if((_>=u&&_<=f||_>=f&&_<=u)&&(_>=i&&_<=r||_>=r&&_<=i))return true}h=p;u=f}return false},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return e==-1?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};e.exports=n.SkeletonBounds},{"../SpineRuntime":45,"./AttachmentType":13}],34:[function(t,e,i){var n=t("../SpineUtil");n.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[];this.transformConstraints=[]};n.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){var e=this.bones;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++){if(e[i].name==t)return this.slots[i]}return null},findSlotIndex:function(t){var e=this.slots;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){var e=this.skins;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){var e=this.events;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){var e=this.animations;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){var e=this.ikConstraints;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findTransformConstraint:function(t){var e=this.transformConstraints;for(var i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null}};e.exports=n.SkeletonData},{"../SpineUtil":52}],35:[function(t,e,i){var n=t("../SpineUtil");n.SkeletonData=t("./SkeletonData");n.BoneData=t("./BoneData");n.IkConstraintData=t("./IkConstraintData");n.TransformConstraintData=t("./TransformConstraintData");n.SlotData=t("./SlotData");n.Skin=t("./Skin");n.EventData=t("./EventData");n.AttachmentType=t("./AttachmentType");n.ColorTimeline=t("./ColorTimeline");n.AttachmentTimeline=t("./AttachmentTimeline");n.RotateTimeline=t("./RotateTimeline");n.ScaleTimeline=t("./ScaleTimeline");n.TranslateTimeline=t("./TranslateTimeline");n.ShearTimeline=t("./ShearTimeline");n.IkConstraintTimeline=t("./IkConstraintTimeline");n.TransformConstraintTimeline=t("./TransformConstraintTimeline");n.FfdTimeline=t("./FfdTimeline");n.DrawOrderTimeline=t("./DrawOrderTimeline");n.EventTimeline=t("./EventTimeline");n.Event=t("./Event");n.Animation=t("./Animation");function r(t,e,i,n){this.mesh=t;this.skin=e;this.slotIndex=i;this.parent=n}n.SkeletonJsonParser=function(t){if(t.pages){this.attachmentLoader=new n.AtlasAttachmentLoader(t)}else{this.attachmentLoader=t}if(!t.newRegionAttachment){console.warn("SkeletonJsonParser accepts AtlasAttachmentLoader or atlas as first parameter")}this.linkedMeshes=[]};n.SkeletonJsonParser.prototype={scale:1,readSkeletonData:function(t,e){var i=new n.SkeletonData;i.name=e;var r=this.scale;var a=t["skeleton"];if(a){i.hash=a["hash"];i.version=a["spine"];i.width=a["width"]||0;i.height=a["height"]||0}var o=t["bones"];for(var s=0,l=o.length;s<l;s++){var h=o[s];var u=null;if(h["parent"]){u=i.findBone(h["parent"]);if(!u)throw"Parent bone not found: "+h["parent"]}var c=new n.BoneData(h["name"],u);c.length=(h["length"]||0)*this.scale;c.x=(h["x"]||0)*this.scale;c.y=(h["y"]||0)*this.scale;c.rotation=h["rotation"]||0;c.scaleX=h.hasOwnProperty("scaleX")?h["scaleX"]:1;c.scaleY=h.hasOwnProperty("scaleY")?h["scaleY"]:1;c.shearX=h["shearX"]||0;c.shearY=h["shearY"]||0;c.inheritScale=h.hasOwnProperty("inheritScale")?h["inheritScale"]:true;c.inheritRotation=h.hasOwnProperty("inheritRotation")?h["inheritRotation"]:true;i.bones.push(c)}var p=t["ik"];if(p){for(var s=0,l=p.length;s<l;s++){var f=p[s];var m=new n.IkConstraintData(f["name"]);var o=f["bones"];for(var d=0,y=o.length;d<y;d++){var v=i.findBone(o[d]);if(!v)throw new Error("IK bone not found: "+o[d]);m.bones.push(v)}m.target=i.findBone(f["target"]);if(!m.target)throw new Error("Target bone not found: "+f["target"]);m.bendDirection=!f.hasOwnProperty("bendPositive")||f["bendPositive"]?1:-1;m.mix=f.hasOwnProperty("mix")?f["mix"]:1;i.ikConstraints.push(m)}}var g=t["transform"];if(g){for(var s=0,l=g.length;s<l;s++){var _=g[s];var I=new n.TransformConstraintData(_["name"]);I.bone=i.findBone(_["bone"]);if(!I.bone)throw new Error("Transform bone not found: "+I["bone"]);I.target=i.findBone(_["target"]);if(!I.target)throw new Error("Target bone not found: "+I["target"]);I.offsetRotation=_["rotation"]||0;I.offsetX=(_["offsetX"]||0)*r;I.offsetY=(_["offsetY"]||0)*r;I.offsetScaleX=(_["scaleX"]||0)*r;I.offsetScaleY=(_["scaleY"]||0)*r;I.offsetShearY=(_["offsetShearY"]||0)*r;I.rotateMix=_.hasOwnProperty("rotateMix")?_["rotateMix"]:1;I.translateMix=_.hasOwnProperty("translateMix")?_["translateMix"]:1;I.scaleMix=_.hasOwnProperty("scaleMix")?_["scaleMix"]:1;I.shearMix=_.hasOwnProperty("shearMix")?_["shearMix"]:1;i.transformConstraints.push(I)}}var x=t["slots"];for(var s=0,l=x.length;s<l;s++){var w=x[s];var c=i.findBone(w["bone"]);if(!c)throw"Slot bone not found: "+w["bone"];var S=new n.SlotData(w["name"],c);var b=w["color"];if(b){S.r=this.toColor(b,0);S.g=this.toColor(b,1);S.b=this.toColor(b,2);S.a=this.toColor(b,3)}S.attachmentName=w["attachment"];S.blendMode=w["blend"]&&n.SlotData.BLEND_MODE_MAP[w["blend"]]||n.SlotData.BLEND_MODE_MAP["normal"];i.slots.push(S)}var C=t["skins"];for(var T in C){if(!C.hasOwnProperty(T))continue;var D=C[T];var U=new n.Skin(T);for(var A in D){if(!D.hasOwnProperty(A))continue;var E=i.findSlotIndex(A);var M=D[A];for(var P in M){if(!M.hasOwnProperty(P))continue;var B=this.readAttachment(U,E,P,M[P]);if(B)U.addAttachment(E,P,B)}}i.skins.push(U);if(U.name=="default")i.defaultSkin=U}var L=this.linkedMeshes;for(var s=0,l=L.size;s<l;s++){var R=L[s];var U=R.skin?i.findSkin(R.skin):i.defaultSkin;var u=U.getAttachment(R.slotIndex,R.parent);R.mesh.setParentMesh(u);R.mesh.updateUVs()}L.length=0;var O=t["events"];for(var V in O){if(!O.hasOwnProperty(V))continue;var F=O[V];var k=new n.EventData(V);k.intValue=F["int"]||0;k.floatValue=F["float"]||0;k.stringValue=F["string"]||null;i.events.push(k)}var N=t["animations"];for(var G in N){if(!N.hasOwnProperty(G))continue;this.readAnimation(G,N[G],i)}return i},readAttachment:function(t,e,i,a){i=a["name"]||i;var o=n.AttachmentType[a["type"]||"region"];var s=a["path"]||i;var l=this.scale;if(o==n.AttachmentType.region){var h=this.attachmentLoader.newRegionAttachment(t,i,s);if(!h)return null;h.path=s;h.x=(a["x"]||0)*l;h.y=(a["y"]||0)*l;h.scaleX=a.hasOwnProperty("scaleX")?a["scaleX"]:1;h.scaleY=a.hasOwnProperty("scaleY")?a["scaleY"]:1;h.rotation=a["rotation"]||0;h.width=(a["width"]||0)*l;h.height=(a["height"]||0)*l;var u=a["color"];if(u){h.r=this.toColor(u,0);h.g=this.toColor(u,1);h.b=this.toColor(u,2);h.a=this.toColor(u,3)}h.updateOffset();return h}else if(o==n.AttachmentType.boundingbox){var c=this.attachmentLoader.newBoundingBoxAttachment(t,i);var p=a["vertices"];for(var f=0,m=p.length;f<m;f++)c.vertices.push(p[f]*l);return c}else if(o==n.AttachmentType.mesh||o==n.AttachmentType.linkedmesh){var d=this.attachmentLoader.newMeshAttachment(t,i,s);if(!d)return null;d.path=s;u=a["color"];if(u){d.r=this.toColor(u,0);d.g=this.toColor(u,1);d.b=this.toColor(u,2);d.a=this.toColor(u,3)}d.width=(a["width"]||0)*l;d.height=(a["height"]||0)*l;var y=a["parent"];if(!y){d.vertices=this.getFloatArray(a,"vertices",l);d.triangles=this.getIntArray(a,"triangles");d.regionUVs=this.getFloatArray(a,"uvs",1);d.updateUVs();d.hullLength=(a["hull"]||0)*2;if(a["edges"])d.edges=this.getIntArray(a,"edges")}else{d.inheritFFD=!!a["ffd"];this.linkedMeshes.push(new r(d,a["skin"]||null,e,y))}return d}else if(o==n.AttachmentType.weightedmesh||o==n.AttachmentType.weightedlinkedmesh){var d=this.attachmentLoader.newWeightedMeshAttachment(t,i,s);if(!d)return null;d.path=s;u=a["color"];if(u){d.r=this.toColor(u,0);d.g=this.toColor(u,1);d.b=this.toColor(u,2);d.a=this.toColor(u,3)}d.width=(a["width"]||0)*l;d.height=(a["height"]||0)*l;var y=a["parent"];if(!y){var v=this.getFloatArray(a,"uvs",1);var p=this.getFloatArray(a,"vertices",1);var g=[];var _=[];for(var f=0,m=p.length;f<m;){var I=p[f++]|0;_[_.length]=I;for(var x=f+I*4;f<x;){_[_.length]=p[f];g[g.length]=p[f+1]*l;g[g.length]=p[f+2]*l;g[g.length]=p[f+3];f+=4}}d.bones=_;d.weights=g;d.triangles=this.getIntArray(a,"triangles");d.regionUVs=v;d.updateUVs();d.hullLength=(a["hull"]||0)*2;if(a["edges"])d.edges=this.getIntArray(a,"edges")}else{d.inheritFFD=!!a["ffd"];this.linkedMeshes.push(new r(d,a["skin"]||null,e,y))}return d}throw"Unknown attachment type: "+o},readAnimation:function(t,e,i){var r=[];var a=0;var o=e["slots"];for(var s in o){if(!o.hasOwnProperty(s))continue;var l=o[s];var h=i.findSlotIndex(s);for(var u in l){if(!l.hasOwnProperty(u))continue;var c=l[u];if(u=="color"){var p=new n.ColorTimeline(c.length);p.slotIndex=h;var f=0;for(var m=0,d=c.length;m<d;m++){var y=c[m];var v=y["color"];var g=this.toColor(v,0);var _=this.toColor(v,1);var I=this.toColor(v,2);var x=this.toColor(v,3);p.setFrame(f,y["time"],g,_,I,x);this.readCurve(p,f,y);f++}r.push(p);a=Math.max(a,p.frames[p.getFrameCount()*5-5])}else if(u=="attachment"){var p=new n.AttachmentTimeline(c.length);p.slotIndex=h;var f=0;for(var m=0,d=c.length;m<d;m++){var y=c[m];p.setFrame(f++,y["time"],y["name"])}r.push(p);a=Math.max(a,p.frames[p.getFrameCount()-1])}else throw"Invalid timeline type for a slot: "+u+" ("+s+")"}}var w=e["bones"];for(var S in w){if(!w.hasOwnProperty(S))continue;var b=i.findBoneIndex(S);if(b==-1)throw"Bone not found: "+S;var C=w[S];for(var u in C){if(!C.hasOwnProperty(u))continue;var c=C[u];if(u=="rotate"){var p=new n.RotateTimeline(c.length);p.boneIndex=b;var f=0;for(var m=0,d=c.length;m<d;m++){var y=c[m];p.setFrame(f,y["time"],y["angle"]);this.readCurve(p,f,y);f++}r.push(p);a=Math.max(a,p.frames[p.getFrameCount()*2-2])}else if(u=="translate"||u=="scale"||u=="shear"){var p;var T=1;if(u=="scale"){p=new n.ScaleTimeline(c.length)}else if(u=="shear"){p=new n.ShearTimeline(c.length)}else{p=new n.TranslateTimeline(c.length);T=this.scale}p.boneIndex=b;var f=0;for(var m=0,d=c.length;m<d;m++){var y=c[m];var D=(y["x"]||0)*T;var U=(y["y"]||0)*T;p.setFrame(f,y["time"],D,U);this.readCurve(p,f,y);f++}r.push(p);a=Math.max(a,p.frames[p.getFrameCount()*3-3])}else if(u=="flipX"||u=="flipY"){throw"flipX and flipY are not supported in spine v3: ("+S+")"}else throw"Invalid timeline type for a bone: "+u+" ("+S+")"}}var A=e["ik"];for(var E in A){if(!A.hasOwnProperty(E))continue;var M=i.findIkConstraint(E);var c=A[E];var p=new n.IkConstraintTimeline(c.length);p.ikConstraintIndex=i.ikConstraints.indexOf(M);var f=0;for(var m=0,d=c.length;m<d;m++){var y=c[m];var P=y.hasOwnProperty("mix")?y["mix"]:1;var B=!y.hasOwnProperty("bendPositive")||y["bendPositive"]?1:-1;p.setFrame(f,y["time"],P,B);this.readCurve(p,f,y);f++}r.push(p);a=Math.max(a,p.frames[p.getFrameCount()*3-3])}var L=e["transform"];for(var R in L){if(!L.hasOwnProperty(R))continue;var O=i.findTransformConstraint(R);var c=L[R];var p=new n.TransformConstraintTimeline(c.length);p.transformConstraintIndex=i.transformConstraints.indexOf(O);var f=0;for(var m=0,d=c.length;m<d;m++){var y=c[m];var V=y.hasOwnProperty("rotateMix")?y["rotateMix"]:1;var F=y.hasOwnProperty("translateMix")?y["translateMix"]:1;var k=y.hasOwnProperty("scaleMix")?y["scaleMix"]:1;var N=y.hasOwnProperty("shearMix")?y["shearMix"]:1;p.setFrame(f,y["time"],F,k,N);this.readCurve(p,f,y);f++}r.push(p);a=Math.max(a,p.frames[p.getFrameCount()*5-5])}var G=e["ffd"];for(var W in G){var H=i.findSkin(W);var l=G[W];for(s in l){var h=i.findSlotIndex(s);var X=l[s];for(var J in X){var c=X[J];var p=new n.FfdTimeline(c.length);var Y=H.getAttachment(h,J);if(!Y)throw"FFD attachment not found: "+J;p.slotIndex=h;p.attachment=Y;var z=Y.type==n.AttachmentType.mesh;var j;if(z)j=Y.vertices.length;else j=Y.weights.length/3*2;var f=0;for(var m=0,d=c.length;m<d;m++){var y=c[m];var K;if(!y["vertices"]){if(z)K=Y.vertices;else{K=[];for(var q=0;q<j;++q)K.push(0);
}}else{var Z=y["vertices"];K=[];for(var q=0;q<j;++q)K.push(0);var Q=y["offset"]||0;var $=Z.length;if(this.scale==1){for(var tt=0;tt<$;tt++)K[tt+Q]=Z[tt]}else{for(var tt=0;tt<$;tt++)K[tt+Q]=Z[tt]*this.scale}if(z){var et=Y.vertices;for(var tt=0,$=K.length;tt<$;tt++)K[tt]+=et[tt]}}p.setFrame(f,y["time"],K);this.readCurve(p,f,y);f++}r[r.length]=p;a=Math.max(a,p.frames[p.getFrameCount()-1])}}}var it=e["drawOrder"];if(!it)it=e["draworder"];if(it){var p=new n.DrawOrderTimeline(it.length);var nt=i.slots.length;var f=0;for(var m=0,d=it.length;m<d;m++){var rt=it[m];var at=null;if(rt["offsets"]){at=[];at.length=nt;for(var tt=nt-1;tt>=0;tt--)at[tt]=-1;var ot=rt["offsets"];var st=[];st.length=nt-ot.length;var lt=0,ht=0;for(var tt=0,$=ot.length;tt<$;tt++){var ut=ot[tt];var h=i.findSlotIndex(ut["slot"]);if(h==-1)throw"Slot not found: "+ut["slot"];while(lt!=h)st[ht++]=lt++;at[lt+ut["offset"]]=lt++}while(lt<nt)st[ht++]=lt++;for(var tt=nt-1;tt>=0;tt--)if(at[tt]==-1)at[tt]=st[--ht]}p.setFrame(f++,rt["time"],at)}r.push(p);a=Math.max(a,p.frames[p.getFrameCount()-1])}var ct=e["events"];if(ct){var p=new n.EventTimeline(ct.length);var f=0;for(var m=0,d=ct.length;m<d;m++){var pt=ct[m];var ft=i.findEvent(pt["name"]);if(!ft)throw"Event not found: "+pt["name"];var mt=new n.Event(ft);mt.intValue=pt.hasOwnProperty("int")?pt["int"]:ft.intValue;mt.floatValue=pt.hasOwnProperty("float")?pt["float"]:ft.floatValue;mt.stringValue=pt.hasOwnProperty("string")?pt["string"]:ft.stringValue;p.setFrame(f++,pt["time"],mt)}r.push(p);a=Math.max(a,p.frames[p.getFrameCount()-1])}i.animations.push(new n.Animation(t,r,a))},readCurve:function(t,e,i){var n=i["curve"];if(!n)t.curves.setLinear(e);else if(n=="stepped")t.curves.setStepped(e);else if(n instanceof Array)t.curves.setCurve(e,n[0],n[1],n[2],n[3])},toColor:function(t,e){if(t.length!=8)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(e*2,e*2+2),16)/255},getFloatArray:function(t,e,i){var r=t[e];var a=new n.Float32Array(r.length);var o=0,s=r.length;if(i==1){for(;o<s;o++)a[o]=r[o]}else{for(;o<s;o++)a[o]=r[o]*i}return a},getIntArray:function(t,e){var i=t[e];var r=new n.Uint16Array(i.length);for(var a=0,o=i.length;a<o;a++)r[a]=i[a]|0;return r}};e.exports=n.SkeletonJsonParser},{"../SpineUtil":52,"./Animation":4,"./AttachmentTimeline":12,"./AttachmentType":13,"./BoneData":15,"./ColorTimeline":17,"./DrawOrderTimeline":19,"./Event":20,"./EventData":21,"./EventTimeline":22,"./FfdTimeline":23,"./IkConstraintData":25,"./IkConstraintTimeline":26,"./RotateTimeline":29,"./ScaleTimeline":30,"./ShearTimeline":31,"./SkeletonData":34,"./Skin":36,"./SlotData":38,"./TransformConstraintData":41,"./TransformConstraintTimeline":42,"./TranslateTimeline":43}],36:[function(t,e,i){var n=t("../SpineUtil");n.Skin=function(t){this.name=t;this.attachments={}};n.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":");var r=parseInt(i.substring(0,n));var a=i.substring(n+1);var o=t.slots[r];if(o.attachment&&o.attachment.name==a){var s=this.getAttachment(r,a);if(s)o.setAttachment(s)}}}};e.exports=n.Skin},{"../SpineUtil":52}],37:[function(t,e,i){var n=t("../SpineUtil");n.Slot=function(t,e){this.data=t;this.bone=e;this.setToSetupPose()};n.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t;this._attachmentTime=this.bone.skeleton.time;this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r;this.g=t.g;this.b=t.b;this.a=t.a;this.blendMode=t.blendMode;var e=this.bone.skeleton.data.slots;for(var i=0,n=e.length;i<n;i++){if(e[i]==t){this.setAttachment(!t.attachmentName?null:this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName));break}}}};e.exports=n.Slot},{"../SpineUtil":52}],38:[function(t,e,i){var n=t("../SpineUtil");var r=t("../SpineUtil/blend.js");n.SlotData=function(t,e){this.name=t;this.boneData=e};n.SlotData.BLEND_MODE_MAP={multiply:r.MULTIPLY,screen:r.SCREEN,additive:r.ADD,normal:r.NORMAL};n.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,blendMode:r.NORMAL};e.exports=n.SlotData},{"../SpineUtil":52,"../SpineUtil/blend.js":51}],39:[function(t,e,i){var n=t("../SpineUtil");n.TrackEntry=function(){};n.TrackEntry.prototype={next:null,previous:null,animation:null,loop:false,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null};e.exports=n.TrackEntry},{"../SpineUtil":52}],40:[function(t,e,i){var n=t("../SpineUtil");var r=[0,0];n.TransformConstraint=function(t,e){this.data=t;this.translateMix=t.translateMix;this.rotateMix=t.rotateMix;this.scaleMix=t.scaleMix;this.shearMix=t.shearMix;this.offsetX=t.offsetX;this.offsetY=t.offsetY;this.offsetScaleX=t.offsetScaleX;this.offsetScaleY=t.offsetScaleY;this.offsetShearY=t.offsetShearY;this.bone=e.findBone(t.bone.name);this.target=e.findBone(t.target.name)};n.TransformConstraint.prototype={update:function(){this.apply()},apply:function(){var t=this.bone.matrix;var e=this.target.matrix;var i=this.rotateMix;if(i>0){var a=t.a,o=t.c,s=t.b,l=t.d;var h=Math.atan2(e.b,e.a)-Math.atan2(s,a);if(h>Math.PI)h-=Math.PI*2;else if(h<-Math.PI)h+=Math.PI*2;h*=i;var u=Math.cos(h),c=Math.sin(h);t.a=u*a-c*s;t.c=u*o-c*l;t.b=c*a+u*s;t.d=c*o+u*l}var p=this.rotateMix;if(p>0){var f=Math.sqrt(t.a*t.a+t.b*t.b);var m=Math.sqrt(e.a*e.a+e.b*e.b);var d=f>1e-5?(f+(m-f+this.offsetScaleX)*p)/f:0;t.a*=d;t.b*=d;f=Math.sqrt(t.c*t.c+t.d*t.d);m=Math.sqrt(t.c*t.c+t.d*t.d);d=f>1e-5?(f+(m-f+this.offsetScaleY)*p)/f:0;t.c*=d;t.d*=d}var y=this.shearMix;if(y>0){var o=t.c,l=t.d;var v=Math.atan2(l,o);var h=Math.atan2(e.d,e.c)-Math.atan2(e.b,target.a)-(v-Math.atan2(t.b,t.a));if(h>Math.PI)h-=Math.PI*2;else if(h<-Math.PI)h+=Math.PI*2;h=v+(h+this.offsetShearY*n.degRad)*y;var d=Math.sqrt(o*o+l*l);t.c=Math.cos(h)*d;t.d=Math.sin(h)*d}var g=this.translateMix;if(g>0){r[0]=this.offsetX;r[1]=this.offsetY;this.target.localToWorld(r);t.tx+=(r[0]-t.tx)*g;t.ty+=(r[1]-t.ty)*g}}};e.exports=n.TransformConstraint},{"../SpineUtil":52}],41:[function(t,e,i){var n=t("../SpineUtil")||{};n.TransformConstraintData=function(t){this.name=t;this.bone=null};n.TransformConstraintData.prototype={target:null,rotateMix:1,translateMix:1,scaleMix:1,shearMix:1,offsetRotation:0,offsetX:0,offsetY:0,offsetScaleX:0,offsetScaleY:0,offsetShearY:0};e.exports=n.TransformConstraintData},{"../SpineUtil":52}],42:[function(t,e,n){var r=t("../SpineUtil")||{};r.Animation=t("./Animation");r.Curves=t("./Curves");r.TransformConstraintTimeline=function(t){this.curves=new r.Curves(t);this.frames=[];this.frames.length=t*3};r.TransformConstraintTimeline.prototype={transformConstraintIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,a){t*=5;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n;this.frames[t+3]=r;this.frames[t+4]=a},apply:function(t,e,n,a,o){var s=this.frames;if(n<s[0])return;var l=t.transformConstraints[this.transformConstraintIndex];if(n>=s[s.length-5]){l.rotateMix+=(s[i-3]-l.rotateMix)*o;l.translateMix+=(s[i-2]-l.translateMix)*o;l.scaleMix+=(s[i-1]-l.scaleMix)*o;l.shearMix+=(s[i]-l.shearMix)*o;return}var h=r.Animation.binarySearch(s,n,5);var u=s[h];var c=1-(n-u)/(s[h+-5]-u);c=this.curves.getCurvePercent(h/5-1,c);var p=s[h+-4];var f=s[h+-3];var m=s[h+-2];var d=s[h+-1];l.rotateMix+=(p+(s[h+1]-p)*c-l.rotateMix)*o;l.translateMix+=(f+(s[h+2]-f)*c-l.translateMix)*o;l.scaleMix+=(m+(s[h+3]-m)*c-l.scaleMix)*o;l.shearMix+=(d+(s[h+4]-d)*c-l.shearMix)*o}};e.exports=r.TransformConstraintTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],43:[function(t,e,i){var n=t("../SpineUtil");n.Animation=t("./Animation");n.Curves=t("./Curves");n.TranslateTimeline=function(t){this.curves=new n.Curves(t);this.frames=[];this.frames.length=t*3};n.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3;this.frames[t]=e;this.frames[t+1]=i;this.frames[t+2]=n},apply:function(t,e,i,r,a){var o=this.frames;if(i<o[0])return;var s=t.bones[this.boneIndex];if(i>=o[o.length-3]){s.x+=(s.data.x+o[o.length-2]-s.x)*a;s.y+=(s.data.y+o[o.length-1]-s.y)*a;return}var l=n.Animation.binarySearch(o,i,3);var h=o[l-2];var u=o[l-1];var c=o[l];var p=1-(i-c)/(o[l+-3]-c);p=this.curves.getCurvePercent(l/3-1,p);s.x+=(s.data.x+h+(o[l+1]-h)*p-s.x)*a;s.y+=(s.data.y+u+(o[l+2]-u)*p-s.y)*a}};e.exports=n.TranslateTimeline},{"../SpineUtil":52,"./Animation":4,"./Curves":18}],44:[function(t,e,i){var n=t("../SpineUtil")||{};n.AttachmentType=t("./AttachmentType");n.WeightedMeshAttachment=function(t){this.name=t};n.WeightedMeshAttachment.prototype={type:n.AttachmentType.weightedmesh,parentMesh:null,inheritFFD:false,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,edges:null,width:0,height:0,updateUVs:function(t,e,i,r,a){var o=this.regionU2-this.regionU,s=this.regionV2-this.regionV;var l=this.regionUVs.length;if(!this.uvs||this.uvs.length!=l){this.uvs=new n.Float32Array(l)}var h=this.rendererObject;if(!h)return;var u=h.texture;var c=u._uvs;var p=h.width,f=h.height,m=h.originalWidth,d=h.originalHeight;var y=h.offsetX,v=h.pixiOffsetY;for(var g=0;g<l;g+=2){var t=this.regionUVs[g],e=this.regionUVs[g+1];t=(t*m-y)/p;e=(e*d-v)/f;this.uvs[g]=(c.x0*(1-t)+c.x1*t)*(1-e)+(c.x3*(1-t)+c.x2*t)*e;this.uvs[g+1]=(c.y0*(1-t)+c.y1*t)*(1-e)+(c.y3*(1-t)+c.y2*t)*e}},computeWorldVertices:function(t,e,i,n){var r=i.bone.skeleton.bones;var a=this.weights;var o=this.bones;var s=0,l=0,h=0,u=0,c=o.length,p;var f,m,d,y,v;var g;if(!i.attachmentVertices.length){for(;l<c;s+=2){f=0;m=0;p=o[l++]+l;for(;l<p;l++,h+=3){g=r[o[l]].matrix;d=a[h];y=a[h+1];v=a[h+2];f+=(d*g.a+y*g.c+g.tx)*v;m+=(d*g.b+y*g.d+g.ty)*v}n[s]=f+t;n[s+1]=m+e}}else{var _=i.attachmentVertices;for(;l<c;s+=2){f=0;m=0;p=o[l++]+l;for(;l<p;l++,h+=3,u+=2){g=r[o[l]].matrix;d=a[h]+_[u];y=a[h+1]+_[u+1];v=a[h+2];f+=(d*g.a+y*g.c+g.tx)*v;m+=(d*g.b+y*g.d+g.ty)*v}n[s]=f+t;n[s+1]=m+e}}},applyFFD:function(t){return this===t||this.inheritFFD&&parentMesh===t},setParentMesh:function(t){this.parentMesh=t;if(t!=null){this.bones=t.bones;this.weights=t.weights;this.regionUVs=t.regionUVs;this.triangles=t.triangles;this.hullLength=t.hullLength}}};e.exports=n.WeightedMeshAttachment},{"../SpineUtil":52,"./AttachmentType":13}],45:[function(t,e,i){var n=t("../SpineUtil");n.Animation=t("./Animation");n.AnimationStateData=t("./AnimationStateData");n.AnimationState=t("./AnimationState");n.AtlasAttachmentParser=t("./AtlasAttachmentParser");n.Atlas=t("./Atlas");n.AtlasPage=t("./AtlasPage");n.AtlasReader=t("./AtlasReader");n.AtlasRegion=t("./AtlasRegion");n.AttachmentTimeline=t("./AttachmentTimeline");n.AttachmentType=t("./AttachmentType");n.BoneData=t("./BoneData");n.Bone=t("./Bone");n.BoundingBoxAttachment=t("./BoundingBoxAttachment");n.ColorTimeline=t("./ColorTimeline");n.Curves=t("./Curves");n.DrawOrderTimeline=t("./DrawOrderTimeline");n.EventData=t("./EventData");n.Event=t("./Event");n.EventTimeline=t("./EventTimeline");n.FfdTimeline=t("./FfdTimeline");n.IkConstraintData=t("./IkConstraintData");n.IkConstraint=t("./IkConstraint");n.IkConstraintTimeline=t("./IkConstraintTimeline");n.TransformConstraintData=t("./TransformConstraintData");n.TransformConstraint=t("./TransformConstraint");n.TransformConstraintTimeline=t("./TransformConstraintTimeline");n.MeshAttachment=t("./MeshAttachment");n.RegionAttachment=t("./RegionAttachment");n.RotateTimeline=t("./RotateTimeline");n.ScaleTimeline=t("./ScaleTimeline");n.ShearTimeline=t("./ShearTimeline");n.SkeletonBounds=t("./SkeletonBounds");n.SkeletonData=t("./SkeletonData");n.Skeleton=t("./Skeleton");n.SkeletonJsonParser=t("./SkeletonJsonParser");n.Skin=t("./Skin.js");n.WeightedMeshAttachment=t("./WeightedMeshAttachment");n.SlotData=t("./SlotData");n.Slot=t("./Slot");n.TrackEntry=t("./TrackEntry");n.TranslateTimeline=t("./TranslateTimeline");e.exports=n},{"../SpineUtil":52,"./Animation":4,"./AnimationState":5,"./AnimationStateData":6,"./Atlas":7,"./AtlasAttachmentParser":8,"./AtlasPage":9,"./AtlasReader":10,"./AtlasRegion":11,"./AttachmentTimeline":12,"./AttachmentType":13,"./Bone":14,"./BoneData":15,"./BoundingBoxAttachment":16,"./ColorTimeline":17,"./Curves":18,"./DrawOrderTimeline":19,"./Event":20,"./EventData":21,"./EventTimeline":22,"./FfdTimeline":23,"./IkConstraint":24,"./IkConstraintData":25,"./IkConstraintTimeline":26,"./MeshAttachment":27,"./RegionAttachment":28,"./RotateTimeline":29,"./ScaleTimeline":30,"./ShearTimeline":31,"./Skeleton":32,"./SkeletonBounds":33,"./SkeletonData":34,"./SkeletonJsonParser":35,"./Skin.js":36,"./Slot":37,"./SlotData":38,"./TrackEntry":39,"./TransformConstraint":40,"./TransformConstraintData":41,"./TransformConstraintTimeline":42,"./TranslateTimeline":43,"./WeightedMeshAttachment":44}],46:[function(t,e,i){var n=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1];var r=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1];var a=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1];var o=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1];var s=[];var l=t("./Matrix");var h=[];function u(t){if(t<0){return-1}if(t>0){return 1}return 0}function c(){for(var t=0;t<16;t++){var e=[];h.push(e);for(var i=0;i<16;i++){var c=u(n[t]*n[i]+a[t]*r[i]);var p=u(r[t]*n[i]+o[t]*r[i]);var f=u(n[t]*a[i]+a[t]*o[i]);var m=u(r[t]*a[i]+o[t]*o[i]);for(var d=0;d<16;d++){if(n[d]===c&&r[d]===p&&a[d]===f&&o[d]===m){e.push(d);break}}}}for(t=0;t<16;t++){var y=new l;y.set(n[t],r[t],a[t],o[t],0,0);s.push(y)}}c();var p={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(t){return n[t]},uY:function(t){return r[t]},vX:function(t){return a[t]},vY:function(t){return o[t]},inv:function(t){if(t&8){return t&15}return-t&7},add:function(t,e){return h[t][e]},sub:function(t,e){return h[t][p.inv(e)]},rotate180:function(t){return t^4},isSwapWidthHeight:function(t){return(t&3)===2},byDirection:function(t,e){if(Math.abs(t)*2<=Math.abs(e)){if(e>=0){return p.S}else{return p.N}}else if(Math.abs(e)*2<=Math.abs(t)){if(t>0){return p.E}else{return p.W}}else{if(e>0){if(t>0){return p.SE}else{return p.SW}}else if(t>0){return p.NE}else{return p.NW}}},matrixAppendRotationInv:function(t,e,i,n){var r=s[p.inv(e)];i=i||0;n=n||0;r.tx=i;r.ty=n;t.append(r)}};e.exports=p},{"./Matrix":47}],47:[function(t,e,i){var n=t("./Point");function r(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0}r.prototype.constructor=r;e.exports=r;r.prototype.fromArray=function(t){this.a=t[0];this.b=t[1];this.c=t[3];this.d=t[4];this.tx=t[2];this.ty=t[5]};r.prototype.set=function(t,e,i,n,r,a){this.a=t;this.b=e;this.c=i;this.d=n;this.tx=r;this.ty=a;return this};r.prototype.toArray=function(t,e){if(!this.array){this.array=new Float32Array(9)}var i=e||this.array;if(t){i[0]=this.a;i[1]=this.b;i[2]=0;i[3]=this.c;i[4]=this.d;i[5]=0;i[6]=this.tx;i[7]=this.ty;i[8]=1}else{i[0]=this.a;i[1]=this.c;i[2]=this.tx;i[3]=this.b;i[4]=this.d;i[5]=this.ty;i[6]=0;i[7]=0;i[8]=1}return i};r.prototype.apply=function(t,e){e=e||new n;var i=t.x;var r=t.y;e.x=this.a*i+this.c*r+this.tx;e.y=this.b*i+this.d*r+this.ty;return e};r.prototype.applyInverse=function(t,e){e=e||new n;var i=1/(this.a*this.d+this.c*-this.b);var r=t.x;var a=t.y;e.x=this.d*i*r+-this.c*i*a+(this.ty*this.c-this.tx*this.d)*i;e.y=this.a*i*a+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i;return e};r.prototype.translate=function(t,e){this.tx+=t;this.ty+=e;return this};r.prototype.scale=function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;return this};r.prototype.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;var r=this.c;var a=this.tx;this.a=n*e-this.b*i;this.b=n*i+this.b*e;this.c=r*e-this.d*i;this.d=r*i+this.d*e;this.tx=a*e-this.ty*i;this.ty=a*i+this.ty*e;return this};r.prototype.append=function(t){var e=this.a;var i=this.b;var n=this.c;var r=this.d;this.a=t.a*e+t.b*n;this.b=t.a*i+t.b*r;this.c=t.c*e+t.d*n;this.d=t.c*i+t.d*r;this.tx=t.tx*e+t.ty*n+this.tx;this.ty=t.tx*i+t.ty*r+this.ty;return this};r.prototype.setTransform=function(t,e,i,n,r,a,o,s,l){var h,u,c,p,f,m,d,y,v,g;f=Math.sin(o);m=Math.cos(o);d=Math.cos(l);y=Math.sin(l);v=-Math.sin(s);g=Math.cos(s);h=m*r;u=f*r;c=-f*a;p=m*a;this.a=d*h+y*c;this.b=d*u+y*p;this.c=v*h+g*c;this.d=v*u+g*p;this.tx=t+(i*h+n*c);this.ty=e+(i*u+n*p);return this};r.prototype.prepend=function(t){var e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){var i=this.a;var n=this.c;this.a=i*t.a+this.b*t.c;this.b=i*t.b+this.b*t.d;this.c=n*t.a+this.d*t.c;this.d=n*t.b+this.d*t.d}this.tx=e*t.a+this.ty*t.c+t.tx;this.ty=e*t.b+this.ty*t.d+t.ty;return this};r.prototype.invert=function(){var t=this.a;var e=this.b;var i=this.c;var n=this.d;var r=this.tx;var a=t*n-e*i;this.a=n/a;this.b=-e/a;this.c=-i/a;this.d=t/a;this.tx=(i*this.ty-n*r)/a;this.ty=-(t*this.ty-e*r)/a;return this};r.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};r.prototype.clone=function(){var t=new r;t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty;return t};r.prototype.copy=function(t){t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty;return t};r.IDENTITY=new r;r.TEMP_MATRIX=new r},{"./Point":48}],48:[function(t,e,i){function n(t,e){this.x=t||0;this.y=e||0}n.prototype.constructor=n;e.exports=n;n.prototype.clone=function(){return new n(this.x,this.y)};n.prototype.copy=function(t){this.set(t.x,t.y)};n.prototype.equals=function(t){return t.x===this.x&&t.y===this.y};n.prototype.set=function(t,e){this.x=t||0;this.y=e||(e!==0?this.x:0)}},{}],49:[function(t,e,i){var n=t("./Point"),r=t("../const");function a(t){var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i){e[i]=arguments[i]}}if(e[0]instanceof n){var r=[];for(var a=0,o=e.length;a<o;a++){r.push(e[a].x,e[a].y)}e=r}this.closed=true;this.points=e;this.type=0}a.prototype.constructor=a;e.exports=a;a.prototype.clone=function(){return new a(this.points.slice())};a.prototype.contains=function(t,e){var i=false;var n=this.points.length/2;for(var r=0,a=n-1;r<n;a=r++){var o=this.points[r*2],s=this.points[r*2+1],l=this.points[a*2],h=this.points[a*2+1],u=s>e!==h>e&&t<(l-o)*(e-s)/(h-s)+o;if(u){i=!i}}return i}},{"../const":53,"./Point":48}],50:[function(t,e,i){function n(t,e,i,n){this.x=t||0;this.y=e||0;this.width=i||0;this.height=n||0;this.type=1}n.prototype.constructor=n;e.exports=n;n.EMPTY=new n(0,0,0,0);n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)};n.prototype.contains=function(t,e){if(this.width<=0||this.height<=0){return false}if(t>=this.x&&t<this.x+this.width){if(e>=this.y&&e<this.y+this.height){return true}}return false}},{}],51:[function(t,e,i){e.exports={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16}},{}],52:[function(t,e,i){e.exports={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:typeof Float32Array==="undefined"?Array:Float32Array,Uint16Array:typeof Uint16Array==="undefined"?Array:Uint16Array,signum:function(t){if(t>0)return 1;if(t<0)return-1;return 0}}},{}],53:[function(t,e,i){e.exports={PI_2:Math.PI*2,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:false,forceFXAA:false,autoResize:false,transparent:false,backgroundColor:0,clearBeforeRender:true,preserveDrawingBuffer:false,roundPixels:false},RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1}}},{}],54:[function(t,e,i){var n=t("../utils.js"),r=t("../SpineUtil/Matrix.js"),a=t("../SpineUtil/Rectangle.js"),o=t("./DisplayObject"),s=new r;function l(){o.call(this);this.children=[]}l.prototype=Object.create(o.prototype);l.prototype.constructor=l;e.exports=l;Object.defineProperties(l.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;if(e!==0){this.scale.x=t/e}else{this.scale.x=1}this._width=t}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;if(e!==0){this.scale.y=t/e}else{this.scale.y=1}this._height=t}}});l.prototype.onChildrenChange=function(){};l.prototype.addChild=function(t){var e=arguments.length;if(e>1){for(var i=0;i<e;i++){this.addChild(arguments[i])}}else{if(t.parent){t.parent.removeChild(t)}t.parent=this;this.children.push(t);this.onChildrenChange(this.children.length-1);t.emit("added",this)}return t};l.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length){if(t.parent){t.parent.removeChild(t)}t.parent=this;this.children.splice(e,0,t);this.onChildrenChange(e);t.emit("added",this);return t}else{throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)}};l.prototype.swapChildren=function(t,e){if(t===e){return}var i=this.getChildIndex(t);var n=this.getChildIndex(e);if(i<0||n<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.")}this.children[i]=e;this.children[n]=t;this.onChildrenChange(i<n?i:n)};l.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(e===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return e};l.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length){throw new Error("The supplied index is out of bounds")}var i=this.getChildIndex(t);n.removeItems(this.children,i,1);this.children.splice(e,0,t);this.onChildrenChange(e)};l.prototype.getChildAt=function(t){if(t<0||t>=this.children.length){throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller")}return this.children[t]};l.prototype.removeChild=function(t){var e=arguments.length;if(e>1){for(var i=0;i<e;i++){this.removeChild(arguments[i])}}else{var r=this.children.indexOf(t);if(r===-1){return}t.parent=null;n.removeItems(this.children,r,1);this.onChildrenChange(r);t.emit("removed",this)}return t};l.prototype.removeChildAt=function(t){var e=this.getChildAt(t);e.parent=null;n.removeItems(this.children,t,1);this.onChildrenChange(t);e.emit("removed",this);return e};l.prototype.removeChildren=function(t,e){var i=t||0;var n=typeof e==="number"?e:this.children.length;var r=n-i;var a,o;if(r>0&&r<=n){a=this.children.splice(i,r);for(o=0;o<a.length;++o){a[o].parent=null}this.onChildrenChange(t);for(o=0;o<a.length;++o){a[o].emit("removed",this)}return a}else if(r===0&&this.children.length===0){return[]}else{throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}};l.prototype.generateTexture=function(t,e,i){var n=this.getLocalBounds();var r=new RenderTexture(t,n.width|0,n.height|0,i,e);s.tx=-n.x;s.ty=-n.y;r.render(this,s);return r};l.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();for(var t=0,e=this.children.length;t<e;++t){this.children[t].updateTransform()}};l.prototype.containerUpdateTransform=l.prototype.updateTransform;l.prototype.getBounds=function(){if(!this._currentBounds){if(this.children.length===0){return a.EMPTY}var t=Infinity;var e=Infinity;var i=-Infinity;var n=-Infinity;var r;var o;var s;var l=false;for(var h=0,u=this.children.length;h<u;++h){var c=this.children[h];if(!c.visible){continue}r=this.children[h].getBounds();if(r===a.EMPTY){continue}l=true;t=t<r.x?t:r.x;e=e<r.y?e:r.y;o=r.width+r.x;s=r.height+r.y;i=i>o?i:o;n=n>s?n:s}if(!l){this._currentBounds=a.EMPTY;return this._currentBounds}var p=this._bounds;p.x=t;p.y=e;p.width=i-t;p.height=n-e;this._currentBounds=p}return this._currentBounds};l.prototype.containerGetBounds=l.prototype.getBounds;l.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=r.IDENTITY;for(var e=0,i=this.children.length;e<i;++e){this.children[e].updateTransform()}this.worldTransform=t;this._currentBounds=null;return this.getBounds(r.IDENTITY)};l.prototype.renderWebGL=function(t){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}var e,i;if(this._mask||this._filters){t.currentRenderer.flush();if(this._filters&&this._filters.length){t.filterManager.pushFilter(this,this._filters)}if(this._mask){t.maskManager.pushMask(this,this._mask)}t.currentRenderer.start();this._renderWebGL(t);for(e=0,i=this.children.length;e<i;e++){this.children[e].renderWebGL(t)}t.currentRenderer.flush();if(this._mask){t.maskManager.popMask(this,this._mask)}if(this._filters){t.filterManager.popFilter()}t.currentRenderer.start()}else{this._renderWebGL(t);for(e=0,i=this.children.length;e<i;++e){this.children[e].renderWebGL(t)}}};l.prototype._renderWebGL=function(t){};l.prototype._renderCanvas=function(t){};l.prototype.renderCanvas=function(t){if(!this.visible||this.alpha<=0||!this.renderable){return}if(this._mask){t.maskManager.pushMask(this._mask,t)}t.context.save();this._renderCanvas(t);t.context.restore();for(var e=0,i=this.children.length;e<i;++e){this.children[e].renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}};l.prototype.destroy=function(t){o.prototype.destroy.call(this);if(t){for(var e=0,i=this.children.length;e<i;++e){this.children[e].destroy(t)}}this.removeChildren();this.children=null}},{"../SpineUtil/Matrix.js":47,"../SpineUtil/Rectangle.js":50,"../utils.js":67,"./DisplayObject":55}],55:[function(t,e,i){var n=t("../SpineUtil/Matrix.js"),r=t("../SpineUtil/Point.js"),a=t("../SpineUtil/Rectangle.js"),o=t("eventemitter3"),s=t("../const"),l=new n,h={worldTransform:new n,worldAlpha:1,children:[]};function u(){o.call(this);this.position=new r;this.scale=new r(1,1);this.pivot=new r(0,0);this.skew=new r(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.renderable=true;this.parent=null;this.worldAlpha=1;this.worldTransform=new n;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new a(0,0,1,1);this._currentBounds=null;this._mask=null}u.prototype=Object.create(o.prototype);u.prototype.constructor=u;e.exports=u;Object.defineProperties(u.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){var t=this;do{if(!t.visible){return false}t=t.parent}while(t);return true}},mask:{get:function(){return this._mask},set:function(t){if(this._mask){this._mask.renderable=true}this._mask=t;if(this._mask){this._mask.renderable=false}}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(t){this._filters=t&&t.slice()}}});u.prototype.updateTransform=function(){var t=this.parent.worldTransform;var e=this.worldTransform;var i,n,r,a,o,h;if(this.skew.x||this.skew.y){l.setTransform(this.position.x,this.position.y,this.pivot.x,this.pivot.y,this.scale.x,this.scale.y,this.rotation,this.skew.x,this.skew.y);e.a=l.a*t.a+l.b*t.c;e.b=l.a*t.b+l.b*t.d;e.c=l.c*t.a+l.d*t.c;e.d=l.c*t.b+l.d*t.d;e.tx=l.tx*t.a+l.ty*t.c+t.tx;e.ty=l.tx*t.b+l.ty*t.d+t.ty}else{if(this.rotation%s.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}i=this._cr*this.scale.x;n=this._sr*this.scale.x;r=-this._sr*this.scale.y;a=this._cr*this.scale.y;o=this.position.x;h=this.position.y;if(this.pivot.x||this.pivot.y){o-=this.pivot.x*i+this.pivot.y*r;h-=this.pivot.x*n+this.pivot.y*a}e.a=i*t.a+n*t.c;e.b=i*t.b+n*t.d;e.c=r*t.a+a*t.c;e.d=r*t.b+a*t.d;e.tx=o*t.a+h*t.c+t.tx;e.ty=o*t.b+h*t.d+t.ty}else{i=this.scale.x;a=this.scale.y;o=this.position.x-this.pivot.x*i;h=this.position.y-this.pivot.y*a;e.a=i*t.a;e.b=i*t.b;e.c=a*t.c;e.d=a*t.d;e.tx=o*t.a+h*t.c+t.tx;e.ty=o*t.b+h*t.d+t.ty}}this.worldAlpha=this.alpha*this.parent.worldAlpha;this._currentBounds=null};u.prototype.displayObjectUpdateTransform=u.prototype.updateTransform;u.prototype.getBounds=function(t){return a.EMPTY};u.prototype.getLocalBounds=function(){return this.getBounds(n.IDENTITY)};u.prototype.toGlobal=function(t){if(!this.parent){this.parent=h;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}return this.worldTransform.apply(t)};u.prototype.toLocal=function(t,e,i){if(e){t=e.toGlobal(t)}if(!this.parent){this.parent=h;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}return this.worldTransform.applyInverse(t,i)};u.prototype.renderWebGL=function(t){};u.prototype.renderCanvas=function(t){};u.prototype.generateTexture=function(t,e,i){var n=this.getLocalBounds();var r=new RenderTexture(t,n.width|0,n.height|0,e,i);l.tx=-n.x;l.ty=-n.y;r.render(this,l);return r};u.prototype.setParent=function(t){if(!t||!t.addChild){throw new Error("setParent: Argument must be a Container")}t.addChild(this);return t};u.prototype.setTransform=function(t,e,i,n,r,a,o,s,l){this.position.x=t||0;this.position.y=e||0;this.scale.x=!i?1:i;this.scale.y=!n?1:n;this.rotation=r||0;this.skew.x=a||0;this.skew.y=o||0;this.pivot.x=s||0;this.pivot.y=l||0;return this};u.prototype.destroy=function(){this.position=null;this.scale=null;this.pivot=null;this.skew=null;this.parent=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.worldTransform=null;this.filterArea=null}},{"../SpineUtil/Matrix.js":47,"../SpineUtil/Point.js":48,"../SpineUtil/Rectangle.js":50,"../const":53,eventemitter3:2}],56:[function(t,e,i){var n=t("../SpineUtil/Point.js"),r=t("../const.js"),a=t("../SpineUtil/Polygon.js"),o=t("../display/Container.js"),s=new n,l=new a;function h(t,e,i,n,a){o.call(this);this._texture=null;this.uvs=i||new Float32Array([0,0,1,0,1,1,0,1]);this.vertices=e||new Float32Array([0,0,100,0,100,100,0,100]);this.indices=n||new Uint16Array([0,1,3,2]);this.dirty=true;this.blendMode=r.BLEND_MODES.NORMAL;this.canvasPadding=0;this.drawMode=a||h.DRAW_MODES.TRIANGLE_MESH;this.texture=t;this.shader=null}h.prototype=Object.create(o.prototype);h.prototype.constructor=h;e.exports=h;Object.defineProperties(h.prototype,{texture:{get:function(){return this._texture},set:function(t){if(this._texture===t){return}this._texture=t;if(t){if(t.baseTexture.hasLoaded){this._onTextureUpdate()}else{t.once("update",this._onTextureUpdate,this)}}}}});h.prototype._renderWebGL=function(t){t.setObjectRenderer(t.plugins.mesh);t.plugins.mesh.render(this)};h.prototype._renderCanvas=function(t){var e=t.context;var i=this.worldTransform;var n=t.resolution;if(t.roundPixels){e.transform(i.a*n,i.b*n,i.c*n,i.d*n,i.tx*n|0,i.ty*n|0)}else{e.transform(i.a*n,i.b*n,i.c*n,i.d*n,i.tx*n,i.ty*n)}if(this.drawMode===h.DRAW_MODES.TRIANGLE_MESH){this._renderCanvasTriangleMesh(e)}else{this._renderCanvasTriangles(e)}};h.prototype._renderCanvasTriangleMesh=function(t){var e=this.vertices;var i=this.uvs;var n=e.length/2;for(var r=0;r<n-2;r++){var a=r*2;this._renderCanvasDrawTriangle(t,e,i,a,a+2,a+4)}};h.prototype._renderCanvasTriangles=function(t){var e=this.vertices;var i=this.uvs;var n=this.indices;var r=n.length;for(var a=0;a<r;a+=3){var o=n[a]*2,s=n[a+1]*2,l=n[a+2]*2;this._renderCanvasDrawTriangle(t,e,i,o,s,l)}};h.triArray=new Float32Array(12);h.prototype._renderCanvasDrawTriangle=function(t,e,i,n,r,a){var o=this._texture.baseTexture;var s=o.source;var l=o.width;var u=o.height;if(t.drawImageTriArr){h.triArray[0]=i[n]*o.width;h.triArray[1]=i[n+1]*o.height;h.triArray[2]=e[n];h.triArray[3]=e[n+1];h.triArray[4]=i[r]*o.width;h.triArray[5]=i[r+1]*o.height;h.triArray[6]=e[r];h.triArray[7]=e[r+1];h.triArray[8]=i[a]*o.width;h.triArray[9]=i[a+1]*o.height;h.triArray[10]=e[a];h.triArray[11]=e[a+1];t.drawImageTriArr(s,h.triArray);return}var c=e[n],p=e[r],f=e[a];var m=e[n+1],d=e[r+1],y=e[a+1];var v=i[n]*o.width,g=i[r]*o.width,_=i[a]*o.width;
var I=i[n+1]*o.height,x=i[r+1]*o.height,w=i[a+1]*o.height;if(this.canvasPadding>0){var S=this.canvasPadding/this.worldTransform.a;var b=this.canvasPadding/this.worldTransform.d;var C=(c+p+f)/3;var T=(m+d+y)/3;var D=c-C;var U=m-T;var A=Math.sqrt(D*D+U*U);c=C+D/A*(A+S);m=T+U/A*(A+b);D=p-C;U=d-T;A=Math.sqrt(D*D+U*U);p=C+D/A*(A+S);d=T+U/A*(A+b);D=f-C;U=y-T;A=Math.sqrt(D*D+U*U);f=C+D/A*(A+S);y=T+U/A*(A+b)}t.save();t.beginPath();t.moveTo(c,m);t.lineTo(p,d);t.lineTo(f,y);t.closePath();t.clip();var E=v*x+I*_+g*w-x*_-I*g-v*w;var M=c*x+I*f+p*w-x*f-I*p-c*w;var P=v*p+c*_+g*f-p*_-c*g-v*f;var B=v*x*f+I*p*_+c*g*w-c*x*_-I*g*f-v*p*w;var L=m*x+I*y+d*w-x*y-I*d-m*w;var R=v*d+m*_+g*y-d*_-m*g-v*y;var O=v*x*y+I*d*_+m*g*w-m*x*_-I*g*y-v*d*w;t.transform(M/E,L/E,P/E,R/E,B/E,O/E);t.drawImage(s,0,0,l*o.resolution,u*o.resolution,0,0,l,u);t.restore()};h.prototype.renderMeshFlat=function(t){var e=this.context;var i=t.vertices;var n=i.length/2;e.beginPath();for(var r=1;r<n-2;r++){var a=r*2;var o=i[a],s=i[a+2],l=i[a+4];var h=i[a+1],u=i[a+3],c=i[a+5];e.moveTo(o,h);e.lineTo(s,u);e.lineTo(l,c)}e.fillStyle="#FF0000";e.fill();e.closePath()};h.prototype._onTextureUpdate=function(){this.updateFrame=true};h.prototype.getBounds=function(t){if(!this._currentBounds){var e=t||this.worldTransform;var i=e.a;var n=e.b;var r=e.c;var a=e.d;var o=e.tx;var s=e.ty;var l=-Infinity;var h=-Infinity;var u=Infinity;var c=Infinity;var p=this.vertices;for(var f=0,m=p.length;f<m;f+=2){var d=p[f],y=p[f+1];var v=i*d+r*y+o;var g=a*y+n*d+s;u=v<u?v:u;c=g<c?g:c;l=v>l?v:l;h=g>h?g:h}if(u===-Infinity||h===Infinity){return Rectangle.EMPTY}var _=this._bounds;_.x=u;_.width=l-u;_.y=c;_.height=h-c;this._currentBounds=_}return this._currentBounds};h.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y)){return false}this.worldTransform.applyInverse(t,s);var e=this.vertices;var i=l.points;var n,r;if(this.drawMode===h.DRAW_MODES.TRIANGLES){var a=this.indices;r=this.indices.length;for(n=0;n<r;n+=3){var o=a[n]*2,u=a[n+1]*2,c=a[n+2]*2;i[0]=e[o];i[1]=e[o+1];i[2]=e[u];i[3]=e[u+1];i[4]=e[c];i[5]=e[c+1];if(l.contains(s.x,s.y)){return true}}}else{r=e.length;for(n=0;n<r;n+=6){i[0]=e[n];i[1]=e[n+1];i[2]=e[n+2];i[3]=e[n+3];i[4]=e[n+4];i[5]=e[n+5];if(l.contains(s.x,s.y)){return true}}}return false};h.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../SpineUtil/Point.js":48,"../SpineUtil/Polygon.js":49,"../const.js":53,"../display/Container.js":54}],57:[function(t,e,i){var n=t("./Mesh");function r(t,e,i){n.call(this,t);this._ready=true;this.segmentsX=e||10;this.segmentsY=i||10;this.drawMode=n.DRAW_MODES.TRIANGLES;this.refresh()}r.prototype=Object.create(n.prototype);r.prototype.constructor=r;e.exports=r;r.prototype.refresh=function(){var t=this.segmentsX*this.segmentsY;var e=[];var i=[];var n=[];var r=[];var a=this.texture;var o=this.segmentsX-1;var s=this.segmentsY-1;var l=0;var h=a.width/o;var u=a.height/s;for(l=0;l<t;l++){var c=l%this.segmentsX;var p=l/this.segmentsX|0;e.push(c*h,p*u);n.push(a._uvs.x0+(a._uvs.x1-a._uvs.x0)*(c/(this.segmentsX-1)),a._uvs.y0+(a._uvs.y3-a._uvs.y0)*(p/(this.segmentsY-1)))}var f=o*s;for(l=0;l<f;l++){var m=l%o;var d=l/o|0;var y=d*this.segmentsX+m;var v=d*this.segmentsX+m+1;var g=(d+1)*this.segmentsX+m;var _=(d+1)*this.segmentsX+m+1;r.push(y,v,g);r.push(v,_,g)}this.vertices=new Float32Array(e);this.uvs=new Float32Array(n);this.colors=new Float32Array(i);this.indices=new Uint16Array(r)};r.prototype._onTextureUpdate=function(){n.prototype._onTextureUpdate.call(this);if(this._ready){this.refresh()}}},{"./Mesh":56}],58:[function(t,e,i){var n=t("./Mesh");var r=t("../SpineUtil/Point.js");function a(t,e){n.call(this,t);this.points=e;this.vertices=new Float32Array(e.length*4);this.uvs=new Float32Array(e.length*4);this.colors=new Float32Array(e.length*2);this.indices=new Uint16Array(e.length*2);this._ready=true;this.refresh()}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;e.exports=a;a.prototype.refresh=function(){var t=this.points;if(t.length<1||!this._texture._uvs){return}var e=this.uvs;var i=this.indices;var n=this.colors;var a=this._texture._uvs;var o=new r(a.x0,a.y0);var s=new r(a.x2-a.x0,a.y2-a.y0);e[0]=0+o.x;e[1]=0+o.y;e[2]=0+o.x;e[3]=1*s.y+o.y;n[0]=1;n[1]=1;i[0]=0;i[1]=1;var l=t.length,h,u,c;for(var p=1;p<l;p++){h=t[p];u=p*4;c=p/(l-1);e[u]=c*s.x+o.x;e[u+1]=0+o.y;e[u+2]=c*s.x+o.x;e[u+3]=1*s.y+o.y;u=p*2;n[u]=1;n[u+1]=1;u=p*2;i[u]=u;i[u+1]=u+1}this.dirty=true};a.prototype._onTextureUpdate=function(){n.prototype._onTextureUpdate.call(this);if(this._ready){this.refresh()}};a.prototype.updateTransform=function(){var t=this.points;if(t.length<1){return}var e=t[0];var i;var n=0;var r=0;var a=this.vertices;var o=t.length,s,l,h,u,c;for(var p=0;p<o;p++){s=t[p];l=p*4;if(p<t.length-1){i=t[p+1]}else{i=s}r=-(i.x-e.x);n=i.y-e.y;h=(1-p/(o-1))*10;if(h>1){h=1}u=Math.sqrt(n*n+r*r);c=this._texture.height/2;n/=u;r/=u;n*=c;r*=c;a[l]=s.x+n;a[l+1]=s.y+r;a[l+2]=s.x-n;a[l+3]=s.y-r;e=s}this.containerUpdateTransform()}},{"../SpineUtil/Point.js":48,"./Mesh":56}],59:[function(t,e,i){e.exports={Mesh:t("./Mesh"),Plane:t("./Plane"),Rope:t("./Rope")}},{"./Mesh":56,"./Plane":57,"./Rope":58}],60:[function(t,e,i){var n=t("../utils"),r=t("../SpineUtil/Matrix.js"),a=t("../const"),o=t("eventemitter3");function s(t,e,i,n){o.call(this);if(n){for(var s in a.DEFAULT_RENDER_OPTIONS){if(typeof n[s]==="undefined"){n[s]=a.DEFAULT_RENDER_OPTIONS[s]}}}else{n=a.DEFAULT_RENDER_OPTIONS}this.type=a.RENDERER_TYPE.UNKNOWN;this.width=e||800;this.height=i||600;this.resolution=n.resolution;this.transparent=n.transparent;this.autoResize=n.autoResize||false;this.blendModes=null;this.preserveDrawingBuffer=n.preserveDrawingBuffer;this.clearBeforeRender=n.clearBeforeRender;this.roundPixels=n.roundPixels;this._backgroundColor=0;this._backgroundColorRgb=[0,0,0];this._backgroundColorString="#000000";this.backgroundColor=n.backgroundColor||this._backgroundColor;this._tempDisplayObjectParent={worldTransform:new r,worldAlpha:1,children:[]};this._lastObjectRendered=this._tempDisplayObjectParent}s.prototype=Object.create(o.prototype);s.prototype.constructor=s;e.exports=s;Object.defineProperties(s.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t;this._backgroundColorString=n.hex2string(t);n.hex2rgb(t,this._backgroundColorRgb)}}});s.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}};s.prototype.destroy=function(t){if(t&&this.view.parentNode){this.view.parentNode.removeChild(this.view)}this.type=a.RENDERER_TYPE.UNKNOWN;this.width=0;this.height=0;this.view=null;this.resolution=0;this.transparent=false;this.autoResize=false;this.blendModes=null;this.preserveDrawingBuffer=false;this.clearBeforeRender=false;this.roundPixels=false;this._backgroundColor=0;this._backgroundColorRgb=null;this._backgroundColorString=null}},{"../SpineUtil/Matrix.js":47,"../const":53,"../utils":67,eventemitter3:2}],61:[function(t,e,i){var n=t("../SystemRenderer"),r=t("../../utils"),a=t("../../SpineUtil/Matrix.js"),o=t("../../const");function s(t,e,i){i=i||{};n.call(this,"Canvas",t,e,i);this.type=o.RENDERER_TYPE.CANVAS;this.refresh=true;this._mapBlendModes();this._tempDisplayObjectParent={worldTransform:new a,worldAlpha:1}}s.prototype=Object.create(n.prototype);s.prototype.constructor=s;e.exports=s;s.prototype.setContext=function(t){this.context=t};s.prototype.render=function(t){var e=t.parent;this._lastObjectRendered=t;t.parent=this._tempDisplayObjectParent;t.updateTransform();t.parent=e;this.renderDisplayObject(t,this.context)};s.prototype.destroy=function(t){n.prototype.destroy.call(this,t);this.context=null;this.refresh=true};s.prototype.renderDisplayObject=function(t,e){var i=this.context;this.context=e;t.renderCanvas(this);this.context=i};s.prototype._mapBlendModes=function(){if(!this.blendModes){this.blendModes={};this.blendModes[o.BLEND_MODES.NORMAL]="source-over";this.blendModes[o.BLEND_MODES.ADD]="lighter";this.blendModes[o.BLEND_MODES.MULTIPLY]="multiply";this.blendModes[o.BLEND_MODES.SCREEN]="screen";this.blendModes[o.BLEND_MODES.OVERLAY]="overlay";this.blendModes[o.BLEND_MODES.DARKEN]="darken";this.blendModes[o.BLEND_MODES.LIGHTEN]="lighten";this.blendModes[o.BLEND_MODES.COLOR_DODGE]="color-dodge";this.blendModes[o.BLEND_MODES.COLOR_BURN]="color-burn";this.blendModes[o.BLEND_MODES.HARD_LIGHT]="hard-light";this.blendModes[o.BLEND_MODES.SOFT_LIGHT]="soft-light";this.blendModes[o.BLEND_MODES.DIFFERENCE]="difference";this.blendModes[o.BLEND_MODES.EXCLUSION]="exclusion";this.blendModes[o.BLEND_MODES.HUE]="hue";this.blendModes[o.BLEND_MODES.SATURATION]="saturate";this.blendModes[o.BLEND_MODES.COLOR]="color";this.blendModes[o.BLEND_MODES.LUMINOSITY]="luminosity"}}},{"../../SpineUtil/Matrix.js":47,"../../const":53,"../../utils":67,"../SystemRenderer":60}],62:[function(t,e,i){var n=t("../../../utils");var r={};e.exports=r;r.getTintedTexture=function(t,e){var i=t.texture;e=r.roundColor(e);var n="#"+("00000"+(e|0).toString(16)).substr(-6);i.tintCache=i.tintCache||{};if(i.tintCache[n]){return i.tintCache[n]}var a=r.canvas||document.createElement("canvas");r.tintMethod(i,e,a);if(r.convertTintToImage){var o=new Image;o.src=a.toDataURL();i.tintCache[n]=o}else{i.tintCache[n]=a;r.canvas=null}return a};r.tintWithMultiply=function(t,e,i){var n=i.getContext("2d");var r=t.baseTexture.resolution;var a=t.crop.clone();a.x*=r;a.y*=r;a.width*=r;a.height*=r;i.width=a.width;i.height=a.height;n.fillStyle="#"+("00000"+(e|0).toString(16)).substr(-6);n.fillRect(0,0,a.width,a.height);n.globalCompositeOperation="multiply";n.drawImage(t.baseTexture.source,a.x,a.y,a.width,a.height,0,0,a.width,a.height);n.globalCompositeOperation="destination-atop";n.drawImage(t.baseTexture.source,a.x,a.y,a.width,a.height,0,0,a.width,a.height)};r.tintWithOverlay=function(t,e,i){var n=i.getContext("2d");var r=t.baseTexture.resolution;var a=t.crop.clone();a.x*=r;a.y*=r;a.width*=r;a.height*=r;i.width=a.width;i.height=a.height;n.globalCompositeOperation="copy";n.fillStyle="#"+("00000"+(e|0).toString(16)).substr(-6);n.fillRect(0,0,a.width,a.height);n.globalCompositeOperation="destination-atop";n.drawImage(t.baseTexture.source,a.x,a.y,a.width,a.height,0,0,a.width,a.height)};r.tintWithPerPixel=function(t,e,i){var r=i.getContext("2d");var a=t.baseTexture.resolution;var o=t.crop.clone();o.x*=a;o.y*=a;o.width*=a;o.height*=a;i.width=o.width;i.height=o.height;r.globalCompositeOperation="copy";r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height);var s=n.hex2rgb(e);var l=s[0],h=s[1],u=s[2];var c=r.getImageData(0,0,o.width,o.height);var p=c.data;for(var f=0;f<p.length;f+=4){p[f+0]*=l;p[f+1]*=h;p[f+2]*=u}r.putImageData(c,0,0)};r.roundColor=function(t){var e=r.cacheStepsPerColorChannel;var i=n.hex2rgb(t);i[0]=Math.min(255,i[0]/e*e);i[1]=Math.min(255,i[1]/e*e);i[2]=Math.min(255,i[2]/e*e);return n.rgb2hex(i)};r.cacheStepsPerColorChannel=8;r.convertTintToImage=false;r.canUseMultiply=true;r.tintMethod=r.canUseMultiply?r.tintWithMultiply:r.tintWithPerPixel},{"../../../utils":67}],63:[function(t,e,i){var n=t("../texture/Texture"),r=t("../display/Container"),a=t("../renderers/canvas/utils/CanvasTinter"),o=t("../utils"),s=t("../const"),l=t("../SpineUtil/Matrix.js"),h=t("../SpineUtil/Point.js"),u=t("../SpineUtil/GroupD8.js"),c=new h,u=u,p=new l;function f(t){r.call(this);this.anchor=new h;this._texture=null;this._width=0;this._height=0;this.tint=16777215;this.blendMode=s.BLEND_MODES.NORMAL;this.shader=null;this.cachedTint=16777215;this.texture=t||n.EMPTY}f.prototype=Object.create(r.prototype);f.prototype.constructor=f;e.exports=f;Object.defineProperties(f.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture._frame.width},set:function(t){var e=o.sign(this.scale.x)||1;this.scale.x=e*t/this.texture._frame.width;this._width=t}},height:{get:function(){return Math.abs(this.scale.y)*this.texture._frame.height},set:function(t){var e=o.sign(this.scale.y)||1;this.scale.y=e*t/this.texture._frame.height;this._height=t}},texture:{get:function(){return this._texture},set:function(t){if(this._texture===t){return}this._texture=t;this.cachedTint=16777215;if(t){if(t.baseTexture.hasLoaded){this._onTextureUpdate()}else{t.once("update",this._onTextureUpdate,this)}}}}});f.prototype._onTextureUpdate=function(){if(this._width){this.scale.x=o.sign(this.scale.x)*this._width/this.texture.frame.width}if(this._height){this.scale.y=o.sign(this.scale.y)*this._height/this.texture.frame.height}};f.prototype._renderWebGL=function(t){t.setObjectRenderer(t.plugins.sprite);t.plugins.sprite.render(this)};f.prototype.getBounds=function(t){if(!this._currentBounds){var e=this._texture._frame.width;var i=this._texture._frame.height;var n=e*(1-this.anchor.x);var r=e*-this.anchor.x;var a=i*(1-this.anchor.y);var o=i*-this.anchor.y;var s=t||this.worldTransform;var l=s.a;var h=s.b;var u=s.c;var c=s.d;var p=s.tx;var f=s.ty;var m,d,y,v;var g=l*r+u*o+p;var _=c*o+h*r+f;var I=l*n+u*o+p;var x=c*o+h*n+f;var w=l*n+u*a+p;var S=c*a+h*n+f;var b=l*r+u*a+p;var C=c*a+h*r+f;m=g;m=I<m?I:m;m=w<m?w:m;m=b<m?b:m;y=_;y=x<y?x:y;y=S<y?S:y;y=C<y?C:y;d=g;d=I>d?I:d;d=w>d?w:d;d=b>d?b:d;v=_;v=x>v?x:v;v=S>v?S:v;v=C>v?C:v;if(this.children.length){var T=this.containerGetBounds();n=T.x;r=T.x+T.width;a=T.y;o=T.y+T.height;m=m<n?m:n;y=y<a?y:a;d=d>r?d:r;v=v>o?v:o}var D=this._bounds;D.x=m;D.width=d-m;D.y=y;D.height=v-y;this._currentBounds=D}return this._currentBounds};f.prototype.getLocalBounds=function(){this._bounds.x=-this._texture._frame.width*this.anchor.x;this._bounds.y=-this._texture._frame.height*this.anchor.y;this._bounds.width=this._texture._frame.width;this._bounds.height=this._texture._frame.height;return this._bounds};f.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,c);var e=this._texture._frame.width;var i=this._texture._frame.height;var n=-e*this.anchor.x;var r;if(c.x>n&&c.x<n+e){r=-i*this.anchor.y;if(c.y>r&&c.y<r+i){return true}}return false};f.prototype._renderCanvas=function(t){if(this.texture.crop.width<=0||this.texture.crop.height<=0){return}var e=t.blendModes[this.blendMode];if(e!==t.context.globalCompositeOperation){t.context.globalCompositeOperation=e}if(this.texture.valid){var i=this._texture,n=this.worldTransform,r,o,l=i.crop.width,h=i.crop.height;t.context.globalAlpha=this.worldAlpha;var c=i.baseTexture.scaleMode===s.SCALE_MODES.LINEAR;if(t.smoothProperty&&t.context[t.smoothProperty]!==c){t.context[t.smoothProperty]=c}if((i.rotate&3)===2){l=i.crop.height;h=i.crop.width}if(i.trim){r=i.crop.width/2+i.trim.x-this.anchor.x*i.trim.width;o=i.crop.height/2+i.trim.y-this.anchor.y*i.trim.height}else{r=(.5-this.anchor.x)*i._frame.width;o=(.5-this.anchor.y)*i._frame.height}if(i.rotate){n.copy(p);n=p;u.matrixAppendRotationInv(n,i.rotate,r,o);r=0;o=0}r-=l/2;o-=h/2;if(t.roundPixels){t.context.transform(n.a,n.b,n.c,n.d,n.tx*t.resolution|0,n.ty*t.resolution|0);r=r|0;o=o|0}else{t.context.transform(n.a,n.b,n.c,n.d,n.tx*t.resolution,n.ty*t.resolution)}var f=i.baseTexture.resolution;if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=a.getTintedTexture(this,this.tint)}t.context.drawImage(this.tintedTexture,0,0,l*f,h*f,r*t.resolution,o*t.resolution,l*t.resolution,h*t.resolution)}else{t.context.drawImage(i.baseTexture.source,i.crop.x*f,i.crop.y*f,l*f,h*f,r*t.resolution,o*t.resolution,l*t.resolution,h*t.resolution)}}};f.prototype.destroy=function(t,e){r.prototype.destroy.call(this);this.anchor=null;if(t){this._texture.destroy(e)}this._texture=null;this.shader=null};f.fromFrame=function(t){var e=o.TextureCache[t];if(!e){throw new Error('The frameId "'+t+'" does not exist in the texture cache')}return new f(e)};f.fromImage=function(t,e,i){return new f(n.fromImage(t,e,i))}},{"../SpineUtil/GroupD8.js":46,"../SpineUtil/Matrix.js":47,"../SpineUtil/Point.js":48,"../const":53,"../display/Container":54,"../renderers/canvas/utils/CanvasTinter":62,"../texture/Texture":65,"../utils":67}],64:[function(t,e,i){var n=t("../utils"),r=t("../const"),a=t("eventemitter3");function o(t,e,i){a.call(this);this.resolution=i||1;this.width=100;this.height=100;this.realWidth=100;this.realHeight=100;this.scaleMode=e||r.SCALE_MODES.DEFAULT;this.hasLoaded=false;this.isLoading=false;this.source=null;this.premultipliedAlpha=true;this.imageUrl=null;this.isPowerOfTwo=false;this.mipmap=false;this._glTextures={};if(t){this.loadSource(t)}}o.prototype=Object.create(a.prototype);o.prototype.constructor=o;e.exports=o;o.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width;this.realHeight=this.source.naturalHeight||this.source.height;this.width=this.realWidth/this.resolution;this.height=this.realHeight/this.resolution;this.isPowerOfTwo=n.isPowerOfTwo(this.realWidth,this.realHeight);this.emit("update",this)};o.prototype.loadSource=function(t){var e=this.isLoading;this.hasLoaded=false;this.isLoading=false;if(e&&this.source){this.source.onload=null;this.source.onerror=null}this.source=t;if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this._sourceLoaded()}else if(!t.getContext){this.isLoading=true;var i=this;t.onload=function(){t.onload=null;t.onerror=null;if(!i.isLoading){return}i.isLoading=false;i._sourceLoaded();i.emit("loaded",i)};t.onerror=function(){t.onload=null;t.onerror=null;if(!i.isLoading){return}i.isLoading=false;i.emit("error",i)};if(t.complete&&t.src){this.isLoading=false;t.onload=null;t.onerror=null;if(t.width&&t.height){this._sourceLoaded();if(e){this.emit("loaded",this)}}else{if(e){this.emit("error",this)}}}}};o.prototype._sourceLoaded=function(){this.hasLoaded=true;this.update()};o.prototype.destroy=function(){if(this.imageUrl){delete n.BaseTextureCache[this.imageUrl];delete n.TextureCache[this.imageUrl];this.imageUrl=null;if(!navigator.isCocoonJS){this.source.src=""}}else if(this.source&&this.source._pixiId){delete n.BaseTextureCache[this.source._pixiId]}this.source=null;this.dispose()};o.prototype.dispose=function(){this.emit("dispose",this)};o.prototype.updateSourceImage=function(t){this.source.src=t;this.loadSource(this.source)};o.fromImageObj=function(t){var e=new o(t);e.hasLoaded=true;e.update();return e};o.fromImage=function(t,e,i){var r=n.BaseTextureCache[t];if(e===undefined&&t.indexOf("data:")!==0){e=true}if(!r){var a=new Image;if(e){a.crossOrigin=""}r=new o(a,i);r.imageUrl=t;a.src=t;n.BaseTextureCache[t]=r;r.resolution=n.getResolutionOfUrl(t)}return r};o.fromCanvas=function(t,e){if(!t._pixiId){t._pixiId="canvas_"+n.uid()}var i=n.BaseTextureCache[t._pixiId];if(!i){i=new o(t,e);n.BaseTextureCache[t._pixiId]=i}return i}},{"../const":53,"../utils":67,eventemitter3:2}],65:[function(t,e,i){var n=t("./BaseTexture"),r=t("./TextureUvs"),a=t("eventemitter3"),o=t("../SpineUtil/Rectangle.js"),s=t("../utils");function l(t,e,i,n,r){a.call(this);this.noFrame=false;if(!e){this.noFrame=true;e=new o(0,0,1,1)}if(t instanceof l){t=t.baseTexture}this.baseTexture=t;this._frame=e;this.trim=n;this.valid=false;this.requiresUpdate=false;this._uvs=null;this.width=0;this.height=0;this.crop=i||e;this._rotate=+(r||0);if(r===true){this._rotate=2}else{if(this._rotate%2!==0){throw"attempt to use diamond-shaped UVs. If you are sure, set rotation manually"}}if(t.hasLoaded){if(this.noFrame){e=new o(0,0,t.width,t.height);t.on("update",this.onBaseTextureUpdated,this)}this.frame=e}else{t.once("loaded",this.onBaseTextureLoaded,this)}}l.prototype=Object.create(a.prototype);l.prototype.constructor=l;e.exports=l;Object.defineProperties(l.prototype,{frame:{get:function(){return this._frame},set:function(t){this._frame=t;this.noFrame=false;this.width=t.width;this.height=t.height;if(!this.trim&&!this.rotate&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=t&&t.width&&t.height&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this._frame.width=this.trim.width;this._frame.height=this.trim.height}else{this.crop=t}if(this.valid){this._updateUvs()}}},rotate:{get:function(){return this._rotate},set:function(t){this._rotate=t;if(this.valid){this._updateUvs()}}}});l.prototype.update=function(){this.baseTexture.update()};l.prototype.onBaseTextureLoaded=function(t){if(this.noFrame){this.frame=new o(0,0,t.width,t.height)}else{this.frame=this._frame}this.emit("update",this)};l.prototype.onBaseTextureUpdated=function(t){this._frame.width=t.width;this._frame.height=t.height;this.emit("update",this)};l.prototype.destroy=function(t){if(this.baseTexture){if(t){this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this);this.baseTexture.off("loaded",this.onBaseTextureLoaded,this);this.baseTexture=null}this._frame=null;this._uvs=null;this.trim=null;this.crop=null;this.valid=false;this.off("dispose",this.dispose,this);this.off("update",this.update,this)};l.prototype.clone=function(){return new l(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)};l.prototype._updateUvs=function(){if(!this._uvs){this._uvs=new r}this._uvs.set(this.crop,this.baseTexture,this.rotate)};l.fromImage=function(t,e,i){var r=s.TextureCache[t];if(!r){r=new l(n.fromImage(t,e,i));s.TextureCache[t]=r}return r};l.fromFrame=function(t){var e=s.TextureCache[t];if(!e){throw new Error('The frameId "'+t+'" does not exist in the texture cache')}return e};l.fromCanvas=function(t,e){return new l(n.fromCanvas(t,e))};l.fromVideo=function(t,e){if(typeof t==="string"){return l.fromVideoUrl(t,e)}else{return new l(VideoBaseTexture.fromVideo(t,e))}};l.fromVideoUrl=function(t,e){return new l(VideoBaseTexture.fromUrl(t,e))};l.addTextureToCache=function(t,e){s.TextureCache[e]=t};l.removeTextureFromCache=function(t){var e=s.TextureCache[t];delete s.TextureCache[t];delete s.BaseTextureCache[t];return e};l.EMPTY=new l(new n)},{"../SpineUtil/Rectangle.js":50,"../utils":67,"./BaseTexture":64,"./TextureUvs":66,eventemitter3:2}],66:[function(t,e,i){function n(){this.x0=0;this.y0=0;this.x1=1;this.y1=0;this.x2=1;this.y2=1;this.x3=0;this.y3=1}e.exports=n;var r=t("../SpineUtil/GroupD8");n.prototype.set=function(t,e,i){var n=e.width;var a=e.height;if(i){var o=r.isSwapWidthHeight(i);var s=(o?t.height:t.width)/2/n;var l=(o?t.width:t.height)/2/a;var h=t.x/n+s;var u=t.y/a+l;i=r.add(i,r.NW);this.x0=h+s*r.uX(i);this.y0=u+l*r.uY(i);i=r.add(i,2);this.x1=h+s*r.uX(i);this.y1=u+l*r.uY(i);i=r.add(i,2);this.x2=h+s*r.uX(i);this.y2=u+l*r.uY(i);i=r.add(i,2);this.x3=h+s*r.uX(i);this.y3=u+l*r.uY(i)}else{this.x0=t.x/n;this.y0=t.y/a;this.x1=(t.x+t.width)/n;this.y1=t.y/a;this.x2=(t.x+t.width)/n;this.y2=(t.y+t.height)/a;this.x3=t.x/n;this.y3=(t.y+t.height)/a}}},{"../SpineUtil/GroupD8":46}],67:[function(t,e,i){e.exports={hex2string:function(t){t=t.toString(16);t="000000".substr(0,6-t.length)+t;return"#"+t},hex2rgb:function(t,e){e=e||[];e[0]=(t>>16&255)/255;e[1]=(t>>8&255)/255;e[2]=(t&255)/255;return e},removeItems:function(t,e,i){var n=t.length;if(e>=n||i===0){return}i=e+i>n?n-e:i;for(var r=e,a=n-i;r<a;++r){t[r]=t[r+i]}t.length=a},isPowerOfTwo:function(t,e){return t>0&&(t&t-1)===0&&e>0&&(e&e-1)===0},rgb2hex:function(t){return(t[0]*255<<16)+(t[1]*255<<8)+t[2]*255}}},{}]},{},[1]);function UISpine(){}UISpine.prototype=new UISkeletonAnimation;UISpine.prototype.initUISpine=UISkeletonAnimation.prototype.initUISkeletonAnimation;UISpine.prototype.onComplete=function(t,e){if(e>=this.repeatTimes){if(this.onDone){this.onDone()}}else if(this.onOneCycle){this.onOneCycle()}if(this.repeatTimes>1&&e>=this.repeatTimes){var i=this.spineInstance.state.tracks[t];i.animation.apply(this.spineInstance.skeleton,i.lastTime,i.endTime,false,i.events);this.spineInstance.state.clearTrack(t)}};UISpine.prototype.doPlay=UISpine.prototype.gotoAndPlay=function(t,e,i,n,r,a){var o=this;this.animationName=t;if(this.spineInstance){this.onDone=i;this.onOneCycle=n;this.repeatTimes=e?e:Math.MAX_VALUE;this.spineInstance.state.setAnimationByName(0,t,this.repeatTimes!=1);this.spineInstance.state.onComplete=this.onComplete.bind(this)}return this};UISpine.prototype.pause=function(){if(this.spineInstance){this.spineInstance.state.timeScale=0}return this};UISpine.prototype.resume=function(){if(this.spineInstance){this.spineInstance.state.timeScale=1}return this};UISpine.prototype.createArmature=function(t,e,i,n){if(this.spineInstance){this.spineInstance=null}var r=new spine.SpineRuntime.Atlas(e,function(e,i){i(spine.BaseTexture.fromImageObj(t))});var a=new spine.SpineRuntime.AtlasAttachmentParser(r);var o=new spine.SpineRuntime.SkeletonJsonParser(a);var s=o.readSkeletonData(i);this.spineInstance=new spine.Spine(s);this.animationNames=[];this.spineInstance.spineData.animations.forEach(function(t){this.animationNames.push(t.name)},this);this.skinNames=[];this.spineInstance.spineData.skins.forEach(function(t){this.skinNames.push(t.name)},this);this.animationName=this.animationName&&this.animationNames.indexOf(this.animationName)>-1?this.animationName:this.animationNames[0];this.skinName=this.skinName&&this.skinNames.indexOf(this.skinName)>=0?this.skinName:this.skinNames[0];if(!spine.renderer){spine.renderer=new spine.CanvasRenderer}return};UISpine.prototype.update=function(t){var e=t.timeStep*this.animTimeScale;this.spineInstance.update(e/1e3)};UISpine.prototype.destroyArmature=function(){if(this.spineInstance){this.spineInstance=null;this.animationNames=null;this.animationName=void 0;this.skinName=void 0}};UISpine.prototype.paintSelfOnly=function(t){if(!this.spineInstance){return}var e=this.h;var i=this.w>>1;t.translate(i,e);t.scale(this.animationScaleX,this.animationScaleY);if(!this.isPaused()){this.update(t)}spine.renderer.setContext(t);spine.renderer.render(this.spineInstance);if(isNaN(t.needRedraw)){t.needRedraw=1}t.needRedraw++;return};UISpine.prototype.setSkin=function(t){if(this.spineInstance){this.skinName=t;this.spineInstance.skeleton.setSkin(null);this.spineInstance.skeleton.setSkinByName(t)}return this};UISpine.prototype.getBound=function(){if(!this.spineInstance){return{x:this.left,y:this.top,width:this.w,height:this.h}}var t=this.spineInstance.skeleton.findSlot("BoundingBox");if(t){var e=t.attachment.vertices;return{x:e[0],y:e[1],width:e[4]-e[0],height:e[5]-e[1]}}else{var i=this.spineInstance.getBounds();return{x:this.x+this.w/2+i.x,y:this.y+this.h+i.y,width:i.width,height:i.height}}};UISpine.prototype.getCurrentSkinKey=function(){if(this.spineInstance){return this.skinName}};UISpine.prototype.getCurrentAnimKey=function(){if(this.spineInstance){return this.animationName}};UISpine.prototype.getSkins=function(){if(this.spineInstance){return this.skinNames}return["default"]};UISpine.prototype.getDuration=UISpine.prototype.getAnimationDuration=function(t){if(!this.spineInstance)return 0;return this.spineInstance.state.tracks[0].animation.endTime};UISpine.prototype.replaceSlotImage=function(t,e,i){if(!this.spineInstance||!e){return}var n=this.spineInstance.skeleton.findSlotIndex(t);if(n<0){return}var r=this.spineInstance.skeleton.slots[n];var a=spine.BaseTexture.fromImageObj(e);if(r.currentSprite){r.currentSprite.texture.baseTexture=a}return this};function UISpineCreator(){var t=["ui-spine","ui-spine",null,true];ShapeCreator.apply(this,t);this.createShape=function(t){var e=new UISpine;return e.initUISpine(this.type,200,200)};return}ShapeFactoryGet().addShapeCreator(new UISpineCreator);
